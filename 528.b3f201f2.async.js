(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[528],{4157:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(Yr){try{let Ae=function(){K||(K=!0,_())},at=function(){try{Pe.documentElement.doScroll("left")}catch(gt){return void setTimeout(at,50)}Ae()};var ve=Ae,tt=at,ge=(ge=document.getElementsByTagName("script"))[ge.length-1],ie=ge.getAttribute("data-injectcss"),ge=ge.getAttribute("data-disable-injectsvg");if(!ge){var Oe,Z,_,Pe,K,xe=function(Mt,Ft){Ft.parentNode.insertBefore(Mt,Ft)};if(ie&&!Yr.__iconfont__svg__cssinject__){Yr.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(gt){console&&console.log(gt)}}Oe=function(){var Mt,Ft=document.createElement("div");Ft.innerHTML=Yr._iconfont_svg_string_3580659,(Ft=Ft.getElementsByTagName("svg")[0])&&(Ft.setAttribute("aria-hidden","true"),Ft.style.position="absolute",Ft.style.width=0,Ft.style.height=0,Ft.style.overflow="hidden",Ft=Ft,(Mt=document.body).firstChild?xe(Ft,Mt.firstChild):Mt.appendChild(Ft))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(Oe,0):(Z=function(){document.removeEventListener("DOMContentLoaded",Z,!1),Oe()},document.addEventListener("DOMContentLoaded",Z,!1)):document.attachEvent&&(_=Oe,Pe=Yr.document,K=!1,at(),Pe.onreadystatechange=function(){Pe.readyState=="complete"&&(Pe.onreadystatechange=null,Ae())})}}catch(Ae){}}(window)},31526:function(Yr,ge,ie){"use strict";ie.d(ge,{zP:function(){return NP},JE:function(){return F7},ns:function(){return BP}});var Oe={};ie.r(Oe),ie.d(Oe,{add:function(){return Gs},adjoint:function(){return nu},clone:function(){return Os},copy:function(){return As},create:function(){return _o},determinant:function(){return Yu},equals:function(){return cp},exactEquals:function(){return wd},frob:function(){return hs},fromQuat:function(){return Cp},fromQuat2:function(){return Gf},fromRotation:function(){return $s},fromRotationTranslation:function(){return $l},fromRotationTranslationScale:function(){return Qu},fromRotationTranslationScaleOrigin:function(){return Cs},fromScaling:function(){return Jo},fromTranslation:function(){return Pu},fromValues:function(){return Qo},fromXRotation:function(){return Ku},fromYRotation:function(){return so},fromZRotation:function(){return Ru},frustum:function(){return Bl},getRotation:function(){return Yc},getScaling:function(){return ca},getTranslation:function(){return Wo},identity:function(){return Fs},invert:function(){return Au},lookAt:function(){return Tc},mul:function(){return ed},multiply:function(){return Oo},multiplyScalar:function(){return Qp},multiplyScalarAndAdd:function(){return Jp},ortho:function(){return Mp},orthoNO:function(){return Kp},orthoZO:function(){return fh},perspective:function(){return Yp},perspectiveFromFieldOfView:function(){return qp},perspectiveNO:function(){return up},perspectiveZO:function(){return Tp},rotate:function(){return Bo},rotateX:function(){return po},rotateY:function(){return ja},rotateZ:function(){return qu},scale:function(){return ba},set:function(){return as},str:function(){return _f},sub:function(){return td},subtract:function(){return Ip},targetTo:function(){return lp},translate:function(){return Vs},transpose:function(){return pu}});var Z=ie(67294),_=(0,Z.createContext)({});function Pe(){return(0,Z.useContext)(_)}var K={},xe={},ve=function(i){return xe[i]},tt=function(i,t){xe[i]=t},Ae=function(i){return K[i]},at=function(i,t){K[i]=t},gt={},Mt={},Ft=34,mr=10,jt=13;function hr(e){return new Function("d","return {"+e.map(function(i,t){return JSON.stringify(i)+": d["+t+'] || ""'}).join(",")+"}")}function qt(e,i){var t=hr(e);return function(n,r){return i(t(n),r,e)}}function Dt(e){var i=Object.create(null),t=[];return e.forEach(function(n){for(var r in n)r in i||t.push(i[r]=r)}),t}function Pt(e,i){var t=e+"",n=t.length;return n<i?new Array(i-n+1).join(0)+t:t}function Cr(e){return e<0?"-"+Pt(-e,6):e>9999?"+"+Pt(e,6):Pt(e,4)}function ne(e){var i=e.getUTCHours(),t=e.getUTCMinutes(),n=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Cr(e.getUTCFullYear(),4)+"-"+Pt(e.getUTCMonth()+1,2)+"-"+Pt(e.getUTCDate(),2)+(r?"T"+Pt(i,2)+":"+Pt(t,2)+":"+Pt(n,2)+"."+Pt(r,3)+"Z":n?"T"+Pt(i,2)+":"+Pt(t,2)+":"+Pt(n,2)+"Z":t||i?"T"+Pt(i,2)+":"+Pt(t,2)+"Z":"")}function gr(e){var i=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function n(w,M){var k,D,N=r(w,function(V,q){if(k)return k(V,q-1);D=V,k=M?qt(V,M):hr(V)});return N.columns=D||[],N}function r(w,M){var k=[],D=w.length,N=0,V=0,q,fe=D<=0,he=!1;w.charCodeAt(D-1)===mr&&--D,w.charCodeAt(D-1)===jt&&--D;function Be(){if(fe)return Mt;if(he)return he=!1,gt;var St,Ut=N,Yt;if(w.charCodeAt(Ut)===Ft){for(;N++<D&&w.charCodeAt(N)!==Ft||w.charCodeAt(++N)===Ft;);return(St=N)>=D?fe=!0:(Yt=w.charCodeAt(N++))===mr?he=!0:Yt===jt&&(he=!0,w.charCodeAt(N)===mr&&++N),w.slice(Ut+1,St-1).replace(/""/g,'"')}for(;N<D;){if((Yt=w.charCodeAt(St=N++))===mr)he=!0;else if(Yt===jt)he=!0,w.charCodeAt(N)===mr&&++N;else if(Yt!==t)continue;return w.slice(Ut,St)}return fe=!0,w.slice(Ut,D)}for(;(q=Be())!==Mt;){for(var Ge=[];q!==gt&&q!==Mt;)Ge.push(q),q=Be();M&&(Ge=M(Ge,V++))==null||k.push(Ge)}return k}function o(w,M){return w.map(function(k){return M.map(function(D){return E(k[D])}).join(e)})}function u(w,M){return M==null&&(M=Dt(w)),[M.map(E).join(e)].concat(o(w,M)).join(`
`)}function l(w,M){return M==null&&(M=Dt(w)),o(w,M).join(`
`)}function p(w){return w.map(v).join(`
`)}function v(w){return w.map(E).join(e)}function E(w){return w==null?"":w instanceof Date?ne(w):i.test(w+="")?'"'+w.replace(/"/g,'""')+'"':w}return{parse:n,parseRows:r,format:u,formatBody:l,formatRows:p,formatRow:v,formatValue:E}}var It=gr(","),xt=It.parse,Jt=It.parseRows,Ct=It.format,br=It.formatBody,$r=It.formatRows,oe=It.formatRow,Ue=It.formatValue,H=ie(85061),U=ie(28991),de=ie(38163),Xe=ie.n(de),lt=63710088e-1,yt={centimeters:lt*100,centimetres:lt*100,degrees:lt/111325,feet:lt*3.28084,inches:lt*39.37,kilometers:lt/1e3,kilometres:lt/1e3,meters:lt,metres:lt,miles:lt/1609.344,millimeters:lt*1e3,millimetres:lt*1e3,nauticalmiles:lt/1852,radians:1,yards:lt*1.0936},Vt={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/lt,yards:1.0936133},pr={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function tn(e,i,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=i||{},n.geometry=e,n}function Kr(e,i,t){switch(t===void 0&&(t={}),e){case"Point":return si(i).geometry;case"LineString":return Di(i).geometry;case"Polygon":return ii(i).geometry;case"MultiPoint":return Bi(i).geometry;case"MultiLineString":return sa(i).geometry;case"MultiPolygon":return Yn(i).geometry;default:throw new Error(e+" is invalid")}}function si(e,i,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ir(e[0])||!ir(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return tn(n,i,t)}function xn(e,i,t){return t===void 0&&(t={}),ua(e.map(function(n){return si(n,i)}),t)}function ii(e,i,t){t===void 0&&(t={});for(var n=0,r=e;n<r.length;n++){var o=r[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return tn(l,i,t)}function Ra(e,i,t){return t===void 0&&(t={}),ua(e.map(function(n){return ii(n,i)}),t)}function Di(e,i,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return tn(n,i,t)}function Pi(e,i,t){return t===void 0&&(t={}),ua(e.map(function(n){return Di(n,i)}),t)}function ua(e,i){i===void 0&&(i={});var t={type:"FeatureCollection"};return i.id&&(t.id=i.id),i.bbox&&(t.bbox=i.bbox),t.features=e,t}function sa(e,i,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:e};return tn(n,i,t)}function Bi(e,i,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:e};return tn(n,i,t)}function Yn(e,i,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:e};return tn(n,i,t)}function bi(e,i,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:e};return tn(n,i,t)}function Ms(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,i||0);return Math.round(e*t)/t}function Ha(e,i){i===void 0&&(i="kilometers");var t=yt[i];if(!t)throw new Error(i+" units is invalid");return e*t}function eo(e,i){i===void 0&&(i="kilometers");var t=yt[i];if(!t)throw new Error(i+" units is invalid");return e/t}function Rt(e,i){return ce(eo(e,i))}function be(e){var i=e%360;return i<0&&(i+=360),i}function ce(e){var i=e%(2*Math.PI);return i*180/Math.PI}function Me(e){var i=e%360;return i*Math.PI/180}function j(e,i,t){if(i===void 0&&(i="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Ha(eo(e,i),t)}function ut(e,i,t){if(i===void 0&&(i="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=pr[i];if(!n)throw new Error("invalid original units");var r=pr[t];if(!r)throw new Error("invalid final units");return e/n*r}function ir(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Jr(e){return!!e&&e.constructor===Object}function nt(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!ir(i))throw new Error("bbox must only contain numbers")})}function Bt(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Ar(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function zr(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function un(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return un(e[0]);throw new Error("coordinates must only contain numbers")}function vn(e,i,t){if(!i||!t)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+t+": must be a "+i+", given "+e.type)}function ui(e,i,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+t+": must be a "+i+", given "+e.geometry.type)}function Jn(e,i,t){if(!e)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(var n=0,r=e.features;n<r.length;n++){var o=r[n];if(!o||o.type!=="Feature"||!o.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!o.geometry||o.geometry.type!==i)throw new Error("Invalid input to "+t+": must be a "+i+", given "+o.geometry.type)}}function mn(e){return e.type==="Feature"?e.geometry:e}function Ri(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function Si(e,i,t){if(e!==null)for(var n,r,o,u,l,p,v,E=0,w=0,M,k=e.type,D=k==="FeatureCollection",N=k==="Feature",V=D?e.features.length:1,q=0;q<V;q++){v=D?e.features[q].geometry:N?e.geometry:e,M=v?v.type==="GeometryCollection":!1,l=M?v.geometries.length:1;for(var fe=0;fe<l;fe++){var he=0,Be=0;if(u=M?v.geometries[fe]:v,u!==null){p=u.coordinates;var Ge=u.type;switch(E=t&&(Ge==="Polygon"||Ge==="MultiPolygon")?1:0,Ge){case null:break;case"Point":if(i(p,w,q,he,Be)===!1)return!1;w++,he++;break;case"LineString":case"MultiPoint":for(n=0;n<p.length;n++){if(i(p[n],w,q,he,Be)===!1)return!1;w++,Ge==="MultiPoint"&&he++}Ge==="LineString"&&he++;break;case"Polygon":case"MultiLineString":for(n=0;n<p.length;n++){for(r=0;r<p[n].length-E;r++){if(i(p[n][r],w,q,he,Be)===!1)return!1;w++}Ge==="MultiLineString"&&he++,Ge==="Polygon"&&Be++}Ge==="Polygon"&&he++;break;case"MultiPolygon":for(n=0;n<p.length;n++){for(Be=0,r=0;r<p[n].length;r++){for(o=0;o<p[n][r].length-E;o++){if(i(p[n][r][o],w,q,he,Be)===!1)return!1;w++}Be++}he++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(Si(u.geometries[n],i,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Wa(e,i,t,n){var r=t;return Si(e,function(o,u,l,p,v){u===0&&t===void 0?r=o:r=i(r,o,u,l,p,v)},n),r}function uo(e,i){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&i(e.features[t].properties,t)!==!1;t++);break;case"Feature":i(e.properties,0);break}}function Io(e,i,t){var n=t;return uo(e,function(r,o){o===0&&t===void 0?n=r:n=i(n,r,o)}),n}function to(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&i(e.features[t],t)!==!1;t++);}function La(e,i,t){var n=t;return to(e,function(r,o){o===0&&t===void 0?n=r:n=i(n,r,o)}),n}function te(e){var i=[];return Si(e,function(t){i.push(t)}),i}function le(e,i){var t,n,r,o,u,l,p,v,E,w,M=0,k=e.type==="FeatureCollection",D=e.type==="Feature",N=k?e.features.length:1;for(t=0;t<N;t++){for(l=k?e.features[t].geometry:D?e.geometry:e,v=k?e.features[t].properties:D?e.properties:{},E=k?e.features[t].bbox:D?e.bbox:void 0,w=k?e.features[t].id:D?e.id:void 0,p=l?l.type==="GeometryCollection":!1,u=p?l.geometries.length:1,r=0;r<u;r++){if(o=p?l.geometries[r]:l,o===null){if(i(null,M,v,E,w)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(o,M,v,E,w)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(i(o.geometries[n],M,v,E,w)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}M++}}function ye(e,i,t){var n=t;return le(e,function(r,o,u,l,p){o===0&&t===void 0?n=r:n=i(n,r,o,u,l,p)}),n}function Re(e,i){le(e,function(t,n,r,o,u){var l=t===null?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return i(tn(t,r,{bbox:o,id:u}),n,0)===!1?!1:void 0}var p;switch(l){case"MultiPoint":p="Point";break;case"MultiLineString":p="LineString";break;case"MultiPolygon":p="Polygon";break}for(var v=0;v<t.coordinates.length;v++){var E=t.coordinates[v],w={type:p,coordinates:E};if(i(tn(w,r),n,v)===!1)return!1}})}function He(e,i,t){var n=t;return Re(e,function(r,o,u){o===0&&u===0&&t===void 0?n=r:n=i(n,r,o,u)}),n}function ht(e,i){Re(e,function(t,n,r){var o=0;if(!!t.geometry){var u=t.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var l,p=0,v=0,E=0;if(Si(t,function(w,M,k,D,N){if(l===void 0||n>p||D>v||N>E){l=w,p=n,v=D,E=N,o=0;return}var V=lineString([l,w],t.properties);if(i(V,n,r,N,o)===!1)return!1;o++,l=w})===!1)return!1}}})}function At(e,i,t){var n=t,r=!1;return ht(e,function(o,u,l,p,v){r===!1&&t===void 0?n=o:n=i(n,o,u,l,p,v),r=!0}),n}function Te(e,i){if(!e)throw new Error("geojson is required");Re(e,function(t,n,r){if(t.geometry!==null){var o=t.geometry.type,u=t.geometry.coordinates;switch(o){case"LineString":if(i(t,n,r,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<u.length;l++)if(i(lineString(u[l],t.properties),n,r,l)===!1)return!1;break}}})}function Je(e,i,t){var n=t;return Te(e,function(r,o,u,l){o===0&&t===void 0?n=r:n=i(n,r,o,u,l)}),n}function Xt(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var t=i.featureIndex||0,n=i.multiFeatureIndex||0,r=i.geometryIndex||0,o=i.segmentIndex||0,u=i.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),u=u||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":u=u||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var p=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=p.length+o-1),lineString([p[o],p[o+1]],u,i);case"Polygon":return r<0&&(r=p.length+r),o<0&&(o=p[r].length+o-1),lineString([p[r][o],p[r][o+1]],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o-1),lineString([p[n][o],p[n][o+1]],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),r<0&&(r=p[n].length+r),o<0&&(o=p[n][r].length-o-1),lineString([p[n][r][o],p[n][r][o+1]],u,i)}throw new Error("geojson is invalid")}function Wr(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var t=i.featureIndex||0,n=i.multiFeatureIndex||0,r=i.geometryIndex||0,o=i.coordIndex||0,u=i.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),u=u||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":u=u||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var p=l.coordinates;switch(l.type){case"Point":return point(p,u,i);case"MultiPoint":return n<0&&(n=p.length+n),point(p[n],u,i);case"LineString":return o<0&&(o=p.length+o),point(p[o],u,i);case"Polygon":return r<0&&(r=p.length+r),o<0&&(o=p[r].length+o),point(p[r][o],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o),point(p[n][o],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),r<0&&(r=p[n].length+r),o<0&&(o=p[n][r].length-o),point(p[n][r][o],u,i)}throw new Error("geojson is invalid")}function cr(e,i){var t=i.x,n=i.y,r=i.x1,o=i.y1,u=i.coordinates,l=i.geometry,p=[];if(!Array.isArray(e))return{dataArray:[]};if(l)return e.filter(function(q){return q[l]&&q[l].type&&q[l].coordinates&&q[l].coordinates.length>0}).forEach(function(q,fe){var he=Xe()((0,U.Z)({},q[l]),!0);Re(he,function(Be){var Ge=zr(Be),St=(0,U.Z)((0,U.Z)({},q),{},{_id:fe,coordinates:Ge});p.push(St)})}),{dataArray:p};for(var v=0;v<e.length;v++){var E=e[v],w=[];if(u){var M="Polygon";Array.isArray(u[0])||(M="Point"),Array.isArray(u[0])&&!Array.isArray(u[0][0])&&(M="LineString");var k=Xe()({type:M,coordinates:(0,H.Z)(E[u])},!0);w=k.coordinates}else if(t&&n&&r&&o){var D=[parseFloat(E[t]),parseFloat(E[n])],N=[parseFloat(E[r]),parseFloat(E[o])];w=[D,N]}else t&&n&&(w=[parseFloat(E[t]),parseFloat(E[n])]);var V=(0,U.Z)((0,U.Z)({},E),{},{_id:v,coordinates:w});p.push(V)}return{dataArray:p}}function dr(e,i){var t=xt(e);return cr(t,i)}var jr=ie(90484);function qn(e){for(var i=e.toString(),t=5381,n=i.length;n;)t=t*33^i.charCodeAt(--n);return t>>>0}function Un(e,i){return i===void 0?null:(0,jr.Z)(e.properties[i])*1==="number"?e.properties[i]*1:e.properties&&e.properties[i]?qn(e.properties[i]+"")%1000019:null}function ar(e,i){var t=[],n={};return e.features?(e.features=e.features.filter(function(r){var o=r.geometry;return r!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),Xe()(e,!0),e.features.length===0?{dataArray:[],featureKeys:n}:(Re(e,function(r,o){var u=Un(r,i==null?void 0:i.featureId);u===null&&(u=o);var l=u,p=zr(r),v=(0,U.Z)((0,U.Z)({},r.properties),{},{coordinates:p,_id:l});t.push(v)}),{dataArray:t,featureKeys:n})):(e.features=[],{dataArray:[]})}var ot=ie(92137),Cn=ie(87757),se=ie.n(Cn);function Yi(e,i,t,n){for(var r=n,o=t-i>>1,u=t-i,l,p=e[i],v=e[i+1],E=e[t],w=e[t+1],M=i+3;M<t;M+=3){var k=Fn(e[M],e[M+1],p,v,E,w);if(k>r)l=M,r=k;else if(k===r){var D=Math.abs(M-o);D<u&&(l=M,u=D)}}r>n&&(l-i>3&&Yi(e,i,l,n),e[l+2]=r,t-l>3&&Yi(e,l,t,n))}function Fn(e,i,t,n,r,o){var u=r-t,l=o-n;if(u!==0||l!==0){var p=((e-t)*u+(i-n)*l)/(u*u+l*l);p>1?(t=r,n=o):p>0&&(t+=u*p,n+=l*p)}return u=e-t,l=i-n,u*u+l*l}function ta(e,i,t,n){var r={id:typeof e=="undefined"?null:e,type:i,geometry:t,tags:n,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return $a(r),r}function $a(e){var i=e.geometry,t=e.type;if(t==="Point"||t==="MultiPoint"||t==="LineString")ra(e,i);else if(t==="Polygon"||t==="MultiLineString")for(var n=0;n<i.length;n++)ra(e,i[n]);else if(t==="MultiPolygon")for(n=0;n<i.length;n++)for(var r=0;r<i[n].length;r++)ra(e,i[n][r])}function ra(e,i){for(var t=0;t<i.length;t+=3)e.minX=Math.min(e.minX,i[t]),e.minY=Math.min(e.minY,i[t+1]),e.maxX=Math.max(e.maxX,i[t]),e.maxY=Math.max(e.maxY,i[t+1])}function pa(e,i){var t=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)Xi(t,e.features[n],i,n);else e.type==="Feature"?Xi(t,e,i):Xi(t,{geometry:e},i);return t}function Xi(e,i,t,n){if(!!i.geometry){var r=i.geometry.coordinates,o=i.geometry.type,u=Math.pow(t.tolerance/((1<<t.maxZoom)*t.extent),2),l=[],p=i.id;if(t.promoteId?p=i.properties[t.promoteId]:t.generateId&&(p=n||0),o==="Point")Ui(r,l);else if(o==="MultiPoint")for(var v=0;v<r.length;v++)Ui(r[v],l);else if(o==="LineString")ma(r,l,u,!1);else if(o==="MultiLineString")if(t.lineMetrics){for(v=0;v<r.length;v++)l=[],ma(r[v],l,u,!1),e.push(ta(p,"LineString",l,i.properties));return}else bo(r,l,u,!1);else if(o==="Polygon")bo(r,l,u,!0);else if(o==="MultiPolygon")for(v=0;v<r.length;v++){var E=[];bo(r[v],E,u,!0),l.push(E)}else if(o==="GeometryCollection"){for(v=0;v<i.geometry.geometries.length;v++)Xi(e,{id:p,geometry:i.geometry.geometries[v],properties:i.properties},t,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(ta(p,o,l,i.properties))}}function Ui(e,i){i.push(Za(e[0])),i.push(fa(e[1])),i.push(0)}function ma(e,i,t,n){for(var r,o,u=0,l=0;l<e.length;l++){var p=Za(e[l][0]),v=fa(e[l][1]);i.push(p),i.push(v),i.push(0),l>0&&(n?u+=(r*v-p*o)/2:u+=Math.sqrt(Math.pow(p-r,2)+Math.pow(v-o,2))),r=p,o=v}var E=i.length-3;i[2]=1,Yi(i,0,E,t),i[E+2]=1,i.size=Math.abs(u),i.start=0,i.end=i.size}function bo(e,i,t,n){for(var r=0;r<e.length;r++){var o=[];ma(e[r],o,t,n),i.push(o)}}function Za(e){return e/360+.5}function fa(e){var i=Math.sin(e*Math.PI/180),t=.5-.25*Math.log((1+i)/(1-i))/Math.PI;return t<0?0:t>1?1:t}function na(e,i,t,n,r,o,u,l){if(t/=i,n/=i,o>=t&&u<n)return e;if(u<t||o>=n)return null;for(var p=[],v=0;v<e.length;v++){var E=e[v],w=E.geometry,M=E.type,k=r===0?E.minX:E.minY,D=r===0?E.maxX:E.maxY;if(k>=t&&D<n){p.push(E);continue}else if(D<t||k>=n)continue;var N=[];if(M==="Point"||M==="MultiPoint")To(w,N,t,n,r);else if(M==="LineString")Ou(w,N,t,n,r,!1,l.lineMetrics);else if(M==="MultiLineString")ao(w,N,t,n,r,!1);else if(M==="Polygon")ao(w,N,t,n,r,!0);else if(M==="MultiPolygon")for(var V=0;V<w.length;V++){var q=[];ao(w[V],q,t,n,r,!0),q.length&&N.push(q)}if(N.length){if(l.lineMetrics&&M==="LineString"){for(V=0;V<N.length;V++)p.push(ta(E.id,M,N[V],E.tags));continue}(M==="LineString"||M==="MultiLineString")&&(N.length===1?(M="LineString",N=N[0]):M="MultiLineString"),(M==="Point"||M==="MultiPoint")&&(M=N.length===3?"Point":"MultiPoint"),p.push(ta(E.id,M,N,E.tags))}}return p.length?p:null}function To(e,i,t,n,r){for(var o=0;o<e.length;o+=3){var u=e[o+r];u>=t&&u<=n&&(i.push(e[o]),i.push(e[o+1]),i.push(e[o+2]))}}function Ou(e,i,t,n,r,o,u){for(var l=ko(e),p=r===0?au:Ua,v=e.start,E,w,M=0;M<e.length-3;M+=3){var k=e[M],D=e[M+1],N=e[M+2],V=e[M+3],q=e[M+4],fe=r===0?k:D,he=r===0?V:q,Be=!1;u&&(E=Math.sqrt(Math.pow(k-V,2)+Math.pow(D-q,2))),fe<t?he>t&&(w=p(l,k,D,V,q,t),u&&(l.start=v+E*w)):fe>n?he<n&&(w=p(l,k,D,V,q,n),u&&(l.start=v+E*w)):iu(l,k,D,N),he<t&&fe>=t&&(w=p(l,k,D,V,q,t),Be=!0),he>n&&fe<=n&&(w=p(l,k,D,V,q,n),Be=!0),!o&&Be&&(u&&(l.end=v+E*w),i.push(l),l=ko(e)),u&&(v+=E)}var Ge=e.length-3;k=e[Ge],D=e[Ge+1],N=e[Ge+2],fe=r===0?k:D,fe>=t&&fe<=n&&iu(l,k,D,N),Ge=l.length-3,o&&Ge>=3&&(l[Ge]!==l[0]||l[Ge+1]!==l[1])&&iu(l,l[0],l[1],l[2]),l.length&&i.push(l)}function ko(e){var i=[];return i.size=e.size,i.start=e.start,i.end=e.end,i}function ao(e,i,t,n,r,o){for(var u=0;u<e.length;u++)Ou(e[u],i,t,n,r,o,!1)}function iu(e,i,t,n){e.push(i),e.push(t),e.push(n)}function au(e,i,t,n,r,o){var u=(o-i)/(n-i);return e.push(o),e.push(t+(r-t)*u),e.push(1),u}function Ua(e,i,t,n,r,o){var u=(o-t)/(r-t);return e.push(i+(n-i)*u),e.push(o),e.push(1),u}function zl(e,i){var t=i.buffer/i.extent,n=e,r=na(e,1,-1-t,t,0,-1,2,i),o=na(e,1,1-t,2+t,0,-1,2,i);return(r||o)&&(n=na(e,1,-t,1+t,0,-1,2,i)||[],r&&(n=Xo(r,1).concat(n)),o&&(n=n.concat(Xo(o,-1)))),n}function Xo(e,i){for(var t=[],n=0;n<e.length;n++){var r=e[n],o=r.type,u;if(o==="Point"||o==="MultiPoint"||o==="LineString")u=Eo(r.geometry,i);else if(o==="MultiLineString"||o==="Polygon"){u=[];for(var l=0;l<r.geometry.length;l++)u.push(Eo(r.geometry[l],i))}else if(o==="MultiPolygon")for(u=[],l=0;l<r.geometry.length;l++){for(var p=[],v=0;v<r.geometry[l].length;v++)p.push(Eo(r.geometry[l][v],i));u.push(p)}t.push(ta(r.id,o,u,r.tags))}return t}function Eo(e,i){var t=[];t.size=e.size,e.start!==void 0&&(t.start=e.start,t.end=e.end);for(var n=0;n<e.length;n+=3)t.push(e[n]+i,e[n+1],e[n+2]);return t}function jo(e,i){if(e.transformed)return e;var t=1<<e.z,n=e.x,r=e.y,o,u,l;for(o=0;o<e.features.length;o++){var p=e.features[o],v=p.geometry,E=p.type;if(p.geometry=[],E===1)for(u=0;u<v.length;u+=2)p.geometry.push(Va(v[u],v[u+1],i,t,n,r));else for(u=0;u<v.length;u++){var w=[];for(l=0;l<v[u].length;l+=2)w.push(Va(v[u][l],v[u][l+1],i,t,n,r));p.geometry.push(w)}}return e.transformed=!0,e}function Va(e,i,t,n,r,o){return[Math.round(t*(e*n-r)),Math.round(t*(i*n-o))]}function vs(e,i,t,n,r){for(var o=i===r.maxZoom?0:r.tolerance/((1<<i)*r.extent),u={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:t,y:n,z:i,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){u.numFeatures++,Hs(u,e[l],o,r);var p=e[l].minX,v=e[l].minY,E=e[l].maxX,w=e[l].maxY;p<u.minX&&(u.minX=p),v<u.minY&&(u.minY=v),E>u.maxX&&(u.maxX=E),w>u.maxY&&(u.maxY=w)}return u}function Hs(e,i,t,n){var r=i.geometry,o=i.type,u=[];if(o==="Point"||o==="MultiPoint")for(var l=0;l<r.length;l+=3)u.push(r[l]),u.push(r[l+1]),e.numPoints++,e.numSimplified++;else if(o==="LineString")Ml(u,r,e,t,!1,!1);else if(o==="MultiLineString"||o==="Polygon")for(l=0;l<r.length;l++)Ml(u,r[l],e,t,o==="Polygon",l===0);else if(o==="MultiPolygon")for(var p=0;p<r.length;p++){var v=r[p];for(l=0;l<v.length;l++)Ml(u,v[l],e,t,!0,l===0)}if(u.length){var E=i.tags||null;if(o==="LineString"&&n.lineMetrics){E={};for(var w in i.tags)E[w]=i.tags[w];E.mapbox_clip_start=r.start/r.size,E.mapbox_clip_end=r.end/r.size}var M={geometry:u,type:o==="Polygon"||o==="MultiPolygon"?3:o==="LineString"||o==="MultiLineString"?2:1,tags:E};i.id!==null&&(M.id=i.id),e.features.push(M)}}function Ml(e,i,t,n,r,o){var u=n*n;if(n>0&&i.size<(r?u:n)){t.numPoints+=i.length/3;return}for(var l=[],p=0;p<i.length;p+=3)(n===0||i[p+2]>u)&&(t.numSimplified++,l.push(i[p]),l.push(i[p+1])),t.numPoints++;r&&ms(l,o),e.push(l)}function ms(e,i){for(var t=0,n=0,r=e.length,o=r-2;n<r;o=n,n+=2)t+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(t>0===i)for(n=0,r=e.length;n<r/2;n+=2){var u=e[n],l=e[n+1];e[n]=e[r-2-n],e[n+1]=e[r-1-n],e[r-2-n]=u,e[r-1-n]=l}}function Bs(e,i){return new Da(e,i)}function Da(e,i){i=this.options=Ys(Object.create(this.options),i);var t=i.debug;if(t&&console.time("preprocess data"),i.maxZoom<0||i.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(i.promoteId&&i.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=pa(e,i);this.tiles={},this.tileCoords=[],t&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",i.indexMaxZoom,i.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=zl(n,i),n.length&&this.splitTile(n,0,0,0),t&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}Da.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Da.prototype.splitTile=function(e,i,t,n,r,o,u){for(var l=[e,i,t,n],p=this.options,v=p.debug;l.length;){n=l.pop(),t=l.pop(),i=l.pop(),e=l.pop();var E=1<<i,w=$o(i,t,n),M=this.tiles[w];if(!M&&(v>1&&console.time("creation"),M=this.tiles[w]=vs(e,i,t,n,p),this.tileCoords.push({z:i,x:t,y:n}),v)){v>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",i,t,n,M.numFeatures,M.numPoints,M.numSimplified),console.timeEnd("creation"));var k="z"+i;this.stats[k]=(this.stats[k]||0)+1,this.total++}if(M.source=e,r){if(i===p.maxZoom||i===r)continue;var D=1<<r-i;if(t!==Math.floor(o/D)||n!==Math.floor(u/D))continue}else if(i===p.indexMaxZoom||M.numPoints<=p.indexMaxPoints)continue;if(M.source=null,e.length!==0){v>1&&console.time("clipping");var N=.5*p.buffer/p.extent,V=.5-N,q=.5+N,fe=1+N,he,Be,Ge,St,Ut,Yt;he=Be=Ge=St=null,Ut=na(e,E,t-N,t+q,0,M.minX,M.maxX,p),Yt=na(e,E,t+V,t+fe,0,M.minX,M.maxX,p),e=null,Ut&&(he=na(Ut,E,n-N,n+q,1,M.minY,M.maxY,p),Be=na(Ut,E,n+V,n+fe,1,M.minY,M.maxY,p),Ut=null),Yt&&(Ge=na(Yt,E,n-N,n+q,1,M.minY,M.maxY,p),St=na(Yt,E,n+V,n+fe,1,M.minY,M.maxY,p),Yt=null),v>1&&console.timeEnd("clipping"),l.push(he||[],i+1,t*2,n*2),l.push(Be||[],i+1,t*2,n*2+1),l.push(Ge||[],i+1,t*2+1,n*2),l.push(St||[],i+1,t*2+1,n*2+1)}}},Da.prototype.getTile=function(e,i,t){var n=this.options,r=n.extent,o=n.debug;if(e<0||e>24)return null;var u=1<<e;i=(i%u+u)%u;var l=$o(e,i,t);if(this.tiles[l])return jo(this.tiles[l],r);o>1&&console.log("drilling down to z%d-%d-%d",e,i,t);for(var p=e,v=i,E=t,w;!w&&p>0;)p--,v=Math.floor(v/2),E=Math.floor(E/2),w=this.tiles[$o(p,v,E)];return!w||!w.source?null:(o>1&&console.log("found parent tile z%d-%d-%d",p,v,E),o>1&&console.time("drilling down"),this.splitTile(w.source,p,v,E,e,i,t),o>1&&console.timeEnd("drilling down"),this.tiles[l]?jo(this.tiles[l],r):null)};function $o(e,i,t){return((1<<e)*t+i)*32+e}function Ys(e,i){for(var t in i)e[t]=i[t];return e}var Ht=ie(6610),tr=ie(5991),J=ie(96156),Cu=function(){function e(i,t,n,r){(0,Ht.Z)(this,e),(0,J.Z)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=r,this.vectorTile=i}return(0,tr.Z)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),_e={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function Ne(e){for(var i=0,t=0,n=e.length,r=n-1,o,u;t<n;r=t++)o=e[t],u=e[r],i+=(u.x-o.x)*(o.y+u.y);return i}function wt(e){var i=e.length;if(i<=1)return[e];for(var t=[],n,r,o=0;o<i;o++){var u=Ne(e[o]);u!==0&&(r===void 0&&(r=u<0),r===u<0?(n&&t.push(n),n=[e[o]]):n.push(e[o]))}return n&&t.push(n),t}var ur=["Unknown","Point","LineString","Polygon"];function gn(e,i,t,n,r){var o=r.geometry,u=r.type,l=r.tags,p=r.id,v=e*Math.pow(2,n),E=e*i,w=e*t,M=ur[u],k,D;function N(fe){for(var he=0;he<fe.length;he++){var Be=fe[he];if(Be[3])break;var Ge=180-(Be[1]+w)*360/v,St=(Be[0]+E)*360/v-180,Ut=360/Math.PI*Math.atan(Math.exp(Ge*Math.PI/180))-90;fe[he]=[St,Ut,0,1]}}switch(u){case 1:var V=[];for(k=0;k<o.length;k++)V[k]=o[k][0];o=V,N(o);break;case 2:for(k=0;k<o.length;k++)N(o[k]);break;case 3:for(o=wt(o),k=0;k<o.length;k++)for(D=0;D<o[k].length;D++)N(o[k][D]);break}o.length===1?o=o[0]:M="Multi"+M;var q={type:"Feature",geometry:{type:M,coordinates:o},properties:l,id:p,tileOrigin:[0,0],coord:""};return q}var li=function(){var e=(0,ot.Z)(se().mark(function i(t,n,r,o){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(p){var v=n.getTile(t.z,t.x,t.y),E=v?v.features.map(function(k){return gn(o,r.x,r.y,r.z,k)}):[],w={layers:{defaultLayer:{features:E}}},M=new Cu(w,t.x,t.y,t.z);p(M)}));case 1:case"end":return l.stop()}},i)}));return function(t,n,r,o){return e.apply(this,arguments)}}();function da(e){var i={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?i:(0,U.Z)((0,U.Z)({},i),e.geojsonvtOptions)}function es(e,i){var t=da(i),n=t.extent||4096,r=Bs(e,t),o=function(p,v){return li(v,r,p,n)},u=(0,U.Z)((0,U.Z)((0,U.Z)({},_e),i),{},{getTileData:o});return{data:e,dataArray:[],tilesetOptions:u,isTile:!0}}var Fr=ie(10379),Nr=ie(46070),it=ie(77608),gu=ie(14665);function qs(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var Tu=ie(51814);function Ns(e,i,t){return(0,Tu.Z)()?Ns=Reflect.construct.bind():Ns=function(r,o,u){var l=[null];l.push.apply(l,o);var p=Function.bind.apply(r,l),v=new p;return u&&(0,gu.Z)(v,u.prototype),v},Ns.apply(null,arguments)}function yu(e){var i=typeof Map=="function"?new Map:void 0;return yu=function(n){if(n===null||!qs(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,r)}function r(){return Ns(n,arguments,(0,it.Z)(this).constructor)}return r.prototype=Object.create(n.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),(0,gu.Z)(r,n)},yu(e)}var _u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Ju(e){this.message=e}Ju.prototype=new Error,Ju.prototype.name="InvalidCharacterError";function Mu(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new Ju("'atob' failed: The string to be decoded is not correctly encoded.");for(var t="",n=0,r,o,u=0;o=i.charAt(u++);~o&&(r=n%4?r*64+o:o,n++%4)?t+=String.fromCharCode(255&r>>(-2*n&6)):0)o=_u.indexOf(o);return t}function lo(e){e=String(e);for(var i,t,n,r,o="",u=0,l=e.length%3;u<e.length;){if((t=e.charCodeAt(u++))>255||(n=e.charCodeAt(u++))>255||(r=e.charCodeAt(u++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=t<<16|n<<8|r,o+=_u.charAt(i>>18&63)+_u.charAt(i>>12&63)+_u.charAt(i>>6&63)+_u.charAt(i&63)}return l?o.slice(0,l-3)+"===".substring(l):o}var xa=function(){function e(i,t){(0,Ht.Z)(this,e),this.buffers=i,this.type=t}return(0,tr.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,n,r){throw new Error("not implemented")}}]),e}(),mo,Wf=function(){return mo||(mo=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof ie.g!="undefined"?ie.g:{})};mo=Wf();var Ks;typeof window=="undefined"?Ks={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,t,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,t){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ks=window;var Xf=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Jc=Xf?my.getSystemInfoSync().pixelRatio:Ks.devicePixelRatio,Il=(0,tr.Z)(function e(i,t){(0,Ht.Z)(this,e),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),Ke=ie(63349);function Rc(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=S(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function S(e,i){if(!!e){if(typeof e=="string")return R(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return R(e,i)}}function R(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}var W=new WeakMap,F=function(){function e(){(0,Ht.Z)(this,e),W.set(this,{})}return(0,tr.Z)(e,[{key:"addEventListener",value:function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=W.get(this);o||(o={}),o[t]||(o[t]=[]),o[t].push(n),W.set(this,o),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=W.get(this);if(o){var u=o[t];if(u&&u.length>0){for(var l=u.length;l--;l>0)if(u[l]===n){u.splice(l,1);break}}}}},{key:"dispatchEvent",value:function(t){var n=W.get(this)[t.type];if(n){var r=Rc(n),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u(t)}}catch(l){r.e(l)}finally{r.f()}}}}]),e}();function ue(e){var i=De();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function De(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ft=function(e){(0,Fr.Z)(t,e);var i=ue(t);function t(){var n;return(0,Ht.Z)(this,t),n=i.call(this),n.childNodes=[],n}return(0,tr.Z)(t,[{key:"appendChild",value:function(r){this.childNodes.push(r)}},{key:"cloneNode",value:function(){var r=Object.create(this);return Object.assign(r,this),r}},{key:"removeChild",value:function(r){var o=this.childNodes.findIndex(function(u){return u===r});return o>-1?this.childNodes.splice(o,1):null}}]),t}(F);function Gt(e){var i=Wt();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function Wt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Or=function(e){(0,Fr.Z)(t,e);var i=Gt(t);function t(){var n;return(0,Ht.Z)(this,t),n=i.call(this),n.className="",n.children=[],n}return(0,tr.Z)(t,[{key:"setAttribute",value:function(r,o){this[r]=o}},{key:"getAttribute",value:function(r){return this[r]}},{key:"setAttributeNS",value:function(r,o){this[r]=o}},{key:"getAttributeNS",value:function(r){return this[r]}}]),t}(ft),en=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ci,Gi,vi,ka;if(en){var ha=my.getSystemInfoSync();ci=ha.screenWidth,Gi=ha.screenHeight,vi=ha.windowWidth,ka=ha.windowHeight}else{var So=Ks.innerWidth,Sa=Ks.innerHeight;ci=So,Gi=Sa,vi=So,ka=Sa}var Ho={width:ci,height:Gi,availWidth:vi,availHeight:ka,availLeft:0,availTop:0},xu=Ho.availWidth,hl=Ho.availHeight,No={style:[]};function Iu(e,i){if(!("parentNode"in e)){var t;i===0?t=function(){return null}:i===1?t=function(){return No}:t=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:t})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return No}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function ef(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:xu+"px",height:hl+"px",margin:"0px",padding:"0px"})}function ql(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=xu,e.clientHeight=hl),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function kl(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=xu,e.offsetHeight=hl)}function Kl(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=xu,e.scrollHeight=hl)}function ts(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Hh(e){var i=Sh();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function Sh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function us(){}var el=function(e){(0,Fr.Z)(t,e);var i=Hh(t);function t(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return(0,Ht.Z)(this,t),n=i.call(this),n.className="",n.children=[],n.focus=us,n.blur=us,n.insertBefore=us,n.appendChild=us,n.removeChild=us,n.remove=us,n.innerHTML="",n.tagName=r.toUpperCase(),Iu((0,Ke.Z)(n),o),ef((0,Ke.Z)(n)),ts((0,Ke.Z)(n)),ql((0,Ke.Z)(n)),kl((0,Ke.Z)(n)),Kl((0,Ke.Z)(n)),n}return(0,tr.Z)(t)}(Or);function Ql(e){var i=tl();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function tl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kf=function(e){(0,Fr.Z)(t,e);var i=Ql(t);function t(n){return(0,Ht.Z)(this,t),i.call(this,n)}return(0,tr.Z)(t,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),t}(el);function Jl(e){var i=oo();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function oo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vc=function(e){(0,Fr.Z)(t,e);var i=Jl(t);function t(){return(0,Ht.Z)(this,t),i.call(this,"video")}return(0,tr.Z)(t)}(kf),rl={},zs={};function wh(e,i){rl=e,rl.id=i,"tagName"in rl||(rl.tagName="CANVAS"),rl.type="canvas",Mixin.parentNode(rl),Mixin.style(rl),Mixin.classList(rl),Mixin.clientRegion(rl),Mixin.offsetRegion(rl),rl.focus=function(){},rl.blur=function(){}}function dd(e,i){var t=1024,n=1024;zs={width:t,height:n,clientWidth:t/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in zs||(zs.tagName="CANVAS"),Mixin.parentNode(zs),Mixin.style(zs),Mixin.classList(zs),Mixin.clientRegion(zs),Mixin.offsetRegion(zs),zs.getContext=function(r){if(r==="2d")return e},zs.focus=function(){},zs.blur=function(){}}function Zl(){return rl}function Fu(){return zs}var mc=(0,tr.Z)(function e(){(0,Ht.Z)(this,e);var i=Zl(),t=i.createImage&&i.createImage()||{};return"tagName"in t||(t.tagName="IMG",t.__proto__=e.prototype),Iu(t),ts(t),Object.assign(t,{addEventListener:function(r,o){t["on".concat(r)]=o.bind(t)},removeEventListener:function(r){t["on".concat(r)]=null}}),t}),Pl={href:"",protocol:"",host:""};function gc(e){var i=Lc();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function Lc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Oc=function(e){(0,Fr.Z)(t,e);var i=gc(t);function t(){return(0,Ht.Z)(this,t),i.call(this,"body",0)}return(0,tr.Z)(t,[{key:"addEventListener",value:function(r,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(r,o,u){}},{key:"dispatchEvent",value:function(r){}}]),t}(el),tf=function(e){(0,Fr.Z)(t,e);var i=gc(t);function t(){return(0,Ht.Z)(this,t),i.call(this,"html",0)}return(0,tr.Z)(t,[{key:"addEventListener",value:function(r,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(r,o){}},{key:"dispatchEvent",value:function(r){}}]),t}(el),Rl={},gs={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Pl,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new mc:i==="video"?new vc:new el(i)},createElementNS:function(i,t){return this.createElement(t)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,t){return this.getElementsByTagName(t)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,t,n){Rl[i]||(Rl[i]=[]),Rl[i].push(t)},removeEventListener:function(i,t){var n=Rl[i];if(n&&n.length>0){for(var r=n.length;r--;r>0)if(n[r]===t){n.splice(r,1);break}}},dispatchEvent:function(i){var t=i.type,n=Rl[t];if(n)for(var r=0;r<n.length;r++)n[r](i);i.target&&typeof i.target["on"+t]=="function"&&i.target["on"+t](i)},createEvent:function(i){return new Il(i)}};gs.documentElement=new tf,gs.head=new el("head"),gs.body=new Oc;var Ah=Object,yc=function(){function e(){(0,Ht.Z)(this,e);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,jr.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,tr.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),Wh=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ec,Zs,_c;if(Wh){var pl=my.getSystemInfoSync();ec=pl.system,Zs=pl.platform,_c=pl.language}else{var Ws={versions:function(){var e=Ks.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ks.navigator.browserLanguage||Ks.navigator.language).toLowerCase()};Ws.versions.android?Zs="android":Ws.versions.trident?Zs="IE":Ws.versions.presto?Zs="Opera":Ws.versions.webKit?Zs="webKit":Ws.versions.gecko?Zs="Firefox":Ws.versions.mobile?Zs="mobile":Ws.versions.ios?Zs="ios":Ws.versions.iPhone?Zs="iPhone":Ws.versions.iPad?Zs="ipad":Ws.versions.webApp?Zs="webApp":Ws.versions.weixin?Zs="weixin":Ws.versions.qq&&(Zs="qq"),ec=Ks.navigator.userAgent,_c=Ws.language}var yp=ec.toLowerCase().indexOf("android")!==-1,Pf=yp?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Fc="Mozilla/5.0 (".concat(Pf,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(_c),xc={platform:Zs,language:_c,appVersion:"5.0 (".concat(Pf,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Fc},nl={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,t,n){return{duration:0}},now:function(){}},tc=0,Ch=0;function Xh(e){var i=Date.now(),t=Math.max(tc+23,i);return Ch=setTimeout(function(){e(tc=t)},t-i),Ch}function $h(e){var i=Zl();return i.requestAnimationFrame?i.requestAnimationFrame(e):Xh(e)}function rf(e){var i=Zl();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var _p=function(){function e(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,Ht.Z)(this,e),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=t+i}return(0,tr.Z)(e,null,[{key:"createObjectURL",value:function(t){var n=t.buffers[0],r=t.type,o=rc(n),u="data:".concat(r,";base64, ");return u+o}}]),e}();function rc(e){for(var i="",t=new Uint8Array(e),n=t.byteLength,r=0;r<n;r++)i+=String.fromCharCode(t[r]);return lo(i)}var kt={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},Zr={};function Mr(e){var i=fi();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function fi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vn=new Map,Ni=new Map,Xa=new Map,co={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function Ul(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Th(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,Ul.call(this,"readystatechange",i)}var ou=function(e){(0,Fr.Z)(t,e);var i=Mr(t);function t(){var n;return(0,Ht.Z)(this,t),n=i.call(this),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Vn.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,tr.Z)(t,[{key:"responseType",set:function(r){this._responseType=r}},{key:"abort",value:function(){var r=Xa.get("requestTask");r&&r.abort()}},{key:"getAllResponseHeaders",value:function(){var r=Ni.get("responseHeader");return Object.keys(r).map(function(o){return"".concat(o,": ").concat(r[o])}).join(`
`)}},{key:"getResponseHeader",value:function(r){return Ni.get("responseHeader")[r]}},{key:"open",value:function(r,o,u){this._method=r,this._url=o}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(r,o){var u=Vn.get("requestHeader");u[r]=o,Vn.set("requestHeader",u)}},{key:"addEventListener",value:function(r,o){var u=this;typeof o=="function"&&(this["on"+r]=function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};l.target=l.target||u,o.call(u,l)})}},{key:"removeEventListener",value:function(r,o){this["on"+r]===o&&(this["on"+r]=null)}}]),t}(F);ou.UNSEND=0,ou.OPENED=1,ou.HEADERS_RECEIVED=2,ou.LOADING=3,ou.DONE=4;function Mh(e){var i=$f();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function $f(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bc=function(e){(0,Fr.Z)(t,e);var i=Mh(t);function t(n){return(0,Ht.Z)(this,t),i.call(this,n)}return(0,tr.Z)(t)}(Il);function il(e){return function(i){i.type=e,gs.dispatchEvent(i)}}var ys=il("mousedown"),go=il("mousemove"),Yf=il("mouseup");function _s(e){var i=Gn();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function Gn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rs=function(e){(0,Fr.Z)(t,e);var i=_s(t);function t(n){var r;return(0,Ht.Z)(this,t),r=i.call(this,n),r.target=Zl(),r.currentTarget=Zl(),r}return(0,tr.Z)(t)}(Il),nc=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],nf=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],Du="touch";function Is(e,i,t){for(var n=new rs(e),r=0;r<nc.length;r++){var o=nc[r];n[o]=i[o]||nf[r]}return n.type=e,n.target=Zl(),n.currentTarget=Zl(),n.buttons=af(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=of(i),n.pointerType=Du,n.altKey=t.altKey,n.ctrlKey=t.ctrlKey,n.metaKey=t.metaKey,n.shiftKey=t.shiftKey,t.preventDefault&&(n.preventDefault=function(){t.preventDefault()}),n}function af(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var Sn=null;function of(e){return Sn===e.identifier}function qf(e){Sn===null&&(Sn=e.identifier)}function Ec(e){Sn===e.identifier&&(Sn=null)}function fo(e){return function(i){for(var t=i.changedTouches,n=0;n<t.length;n++){var r=t[n];n===0&&e==="pointerdown"?qf(r):(e==="pointerup"||e==="pointercancel")&&Ec(r);var o=Is(e,r,i);gs.dispatchEvent(o)}}}var Bu=fo("pointerdown"),Dc=fo("pointermove"),Nu=fo("pointerup");function su(e){var i=ic();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function ic(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xp=function(e){(0,Fr.Z)(t,e);var i=su(t);function t(n){var r;return(0,Ht.Z)(this,t),r=i.call(this,n),r.touches=[],r.targetTouches=[],r.changedTouches=[],r.target=Zl(),r.currentTarget=Zl(),r}return(0,tr.Z)(t)}(Il);function sf(e){var i=e||{},t=i.x,n=t===void 0?0:t,r=i.y,o=r===void 0?0:r,u=i.clientX,l=u===void 0?0:u,p=i.clientY,v=p===void 0?0:p;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=o):(e.x=l,e.y=v)}function Bc(e){return function(i){var t=new xp(e);t.changedTouches=i.changedTouches,t.touches=i.touches,t.targetTouches=Array.prototype.slice.call(i.touches),t.timeStamp=i.timeStamp,t.changedTouches.forEach(function(n){return sf(n)}),t.touches.forEach(function(n){return sf(n)}),t.targetTouches.forEach(function(n){return sf(n)}),gs.dispatchEvent(t)}}function Rf(e){return function(i){i.type=e,gs.dispatchEvent(i)}}var al=Bc("touchstart"),dl=Bc("touchmove"),ga=Bc("touchend"),ac=Rf("mapCameaParams"),vl=!1;function Ya(e){vl=e}var xs=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Nc=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Yo=(xs||Nc)&&vl,bu={atob:Mu,btoa:lo,devicePixelRatio:Jc,Blob:xa,document:gs,Element:Or,Event:Il,EventTarget:F,HTMLCanvasElement:Ah,HTMLElement:el,HTMLMediaElement:kf,HTMLVideoElement:vc,Image:mc,ImageData:yc,navigator:xc,Node:ft,requestAnimationFrame:$h,cancelAnimationFrame:rf,screen:Ho,XMLHttpRequest:ou,performance:nl,URL:_p,WebGLRenderingContext:kt,WebGL2RenderingContext:Zr,addEventListener:function(i,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};gs.addEventListener(i,t,n)},removeEventListener:function(i,t,n){gs.removeEventListener(i,t)},dispatchEvent:function(i){gs.dispatchEvent(i)},innerWidth:Ho.availWidth,innerHeight:Ho.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},wa=Yo?bu:Ks,mi=Yo?ou:Ks.XMLHttpRequest,ai=Yo?Pl:Ks.location;function uf(e){var i=ks();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function ks(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ku=function(e){(0,Fr.Z)(t,e);var i=uf(t);function t(n,r,o,u){var l;return(0,Ht.Z)(this,t),l=i.call(this,"AJAXError: ".concat(r," (").concat(n,"): ").concat(o)),l.status=n,l.statusText=r,l.url=o,l.body=u,l}return(0,tr.Z)(t)}(yu(Error));function ls(e,i){var t=new mi,n=Array.isArray(e.url)?e.url[0]:e.url;t.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var r in e.headers)e.headers.hasOwnProperty(r)&&t.setRequestHeader(r,e.headers[r]);return e.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=e.credentials==="include",t.onerror=function(){i(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var o=t.response;if(e.type==="json")try{o=JSON.parse(t.response)}catch(l){return i(l)}i(null,o,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"),t)}else{var u=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});i(new ku(t.status,t.statusText,n.toString(),u))}},t.send(e.body),t}function ol(e){return new Promise(function(i,t){ls(e,function(n,r,o,u,l){n?t({err:n,data:null,xhr:l}):i({err:null,data:r,cacheControl:o,expires:u,xhr:l})})})}function Vl(e,i){return ls(e,i)}var Kf=function(i,t){return Vl((0,U.Z)((0,U.Z)({},i),{},{type:"json"}),t)},qa=function(i,t){return Vl((0,U.Z)((0,U.Z)({},i),{},{type:"arrayBuffer"}),t)},zo=function(i,t){return Vl(_objectSpread(_objectSpread({},i),{},{method:"POST"}),t)};function bp(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var zc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function sl(e,i){var t=new wa.Image,n=wa.URL||wa.webkitURL;t.crossOrigin="anonymous",t.onload=function(){i(null,t),n.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=zc})},t.onerror=function(){return i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var r=new Blob([new Uint8Array(e)],{type:"image/png"});t.src=e.byteLength?n.createObjectURL(r):zc}function zu(e,i){var t=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(t).then(function(n){i(null,n)}).catch(function(n){i(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var bs=function(i,t,n){var r=function(u,l){if(u)t(u);else if(l){var p=typeof createImageBitmap=="function",v=n?n(l):l;p?zu(v,t):sl(v,t)}};return i.type==="json"?Kf(i,r):qa(i,r)},Ie;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right"})(Ie||(Ie={}));var Qs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Sc(e,i,t){var n=e.classList;for(var r in Qs)Qs.hasOwnProperty(r)&&n.remove("l7-".concat(t,"-anchor-").concat(r));n.add("l7-".concat(t,"-anchor-").concat(i))}var Js=ie(2650);function Ba(e){return typeof e=="string"?!!d3.color(e):!1}function Oa(e){var i=Js.ZP(e),t=[0,0,0,0];return i!=null&&(t[0]=i.r/255,t[1]=i.g/255,t[2]=i.b/255,t[3]=i.opacity),t}function Ll(e){var i=e&&e[0],t=e&&e[1],n=e&&e[2],r=i+t*256+n*65536-1;return r}function Zu(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Gl(e){var i=wa.document.createElement("canvas"),t=i.getContext("2d");i.width=256,i.height=1;for(var n=null,r=t.createLinearGradient(0,0,256,1),o=e.positions[0],u=e.positions[e.positions.length-1],l=0;l<e.colors.length;++l){var p=(e.positions[l]-o)/(u-o);r.addColorStop(p,e.colors[l])}if(t.fillStyle=r,t.fillRect(0,0,256,1),Yo)return n=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),i=null,t=null,{data:n,width:256,height:1};n=t.getImageData(0,0,256,1).data;for(var v=t.createImageData(256,1),E=0;E<v.data.length;E+=4)v.data[E+0]=n[E+0],v.data[E+1]=n[E+1],v.data[E+2]=n[E+2],v.data[E+3]=n[E+3];return i=null,t=null,v}function Zc(e,i){var t=wa.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r=n.createLinearGradient(0,0,256,1),o=i[1]-i[0],u=0;u<e.colors.length;++u){var l=Math.max((e.positions[u]-i[0])/o,0);r.addColorStop(l,e.colors[u])}n.fillStyle=r,n.fillRect(0,0,256,1);var p=n.getImageData(0,0,256,1).data,v=Uu(n,p);return t=null,n=null,v}function Uc(e){var i=wa.document.createElement("canvas"),t=i.getContext("2d");i.width=256,i.height=1;var n=t.createImageData(256,1);return n.data.fill(0),e.positions.forEach(function(r,o){var u=Oa(e.colors[o]);n.data[r*4+0]=u[0]*255,n.data[r*4+1]=u[1]*255,n.data[r*4+2]=u[2]*255,n.data[r*4+3]=u[3]*255}),i=null,t=null,n}function Ih(e){var i=wa.document.createElement("canvas"),t=i.getContext("2d");t.globalAlpha=1,i.width=256,i.height=1;for(var n=256/e.colors.length,r=0;r<e.colors.length;r++)t.beginPath(),t.lineWidth=2,t.strokeStyle=e.colors[r],t.moveTo(r*n,0),t.lineTo((r+1)*n,0),t.stroke();var o=t.getImageData(0,0,256,1).data,u=Uu(t,o);return i=null,t=null,u}function Vc(e,i){var t=wa.document.createElement("canvas"),n=t.getContext("2d");n.globalAlpha=1,t.width=256,t.height=1;var r=i[1]-i[0];e.positions.length-e.colors.length!=1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(var o=0;o<e.colors.length;o++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[o],n.moveTo((e.positions[o]-i[0])/r*255,0),n.lineTo((e.positions[o+1]-i[0])/r*255,0),n.stroke();var u=n.getImageData(0,0,256,1).data,l=Uu(n,u);return t=null,n=null,l}function Uu(e,i){for(var t=e.createImageData(256,1),n=0;n<t.data.length;n+=4)t.data[n+0]=i[n+0],t.data[n+1]=i[n+1],t.data[n+2]=i[n+2],t.data[n+3]=i[n+3];return t}function ul(e){switch(e.type){case"cat":return[0,255];default:return[0,1]}}var jl={BACK:1029,FRONT:1028};function Lf(e){switch(e){case"GAODE1.x":return jl.BACK;case"GAODE2.x":return jl.BACK;case"MAPBOX":return jl.FRONT;case"SIMPLE":return jl.FRONT;case"GLOBEL":return jl.BACK;case"DEBAULT":return jl.FRONT;default:return jl.FRONT}}var Ti=ie(28481),f=ie(96486);function d(e){var i=e;return typeof e=="string"&&(i=wa.document.getElementById(e)),i}function h(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function y(e){return h(e).split(/\s+/)}function C(e){var i,t,n=wa==null||(i=wa.document)===null||i===void 0||(t=i.documentElement)===null||t===void 0?void 0:t.style;if(!n)return e[0];for(var r in e)if(e[r]&&e[r]in n)return e[r];return e[0]}function I(e,i,t){var n=wa.document.createElement(e);return i&&(n.className=i||""),t&&t.appendChild(n),n}function L(e){var i=e.parentNode;i&&i.removeChild(e)}function B(e,i){if(e.classList!==void 0)for(var t=y(i),n=0,r=t.length;n<r;n++)e.classList.add(t[n]);else if(!ae(e,i)){var o=we(e);Ce(e,(o?o+" ":"")+i)}}function Y(e,i){e.classList!==void 0?e.classList.remove(i):Ce(e,h((" "+we(e)+" ").replace(" "+i+" "," ")))}function ae(e,i){if(e.classList!==void 0)return e.classList.contains(i);var t=we(e);return t.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(t)}function Ce(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function we(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function ke(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Qe=C(["transform","WebkitTransform"]);function Ye(e,i){e.style[Qe]=i}function mt(){if(typeof Event=="function")wa.dispatchEvent(new Event("resize"));else{var e=wa.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,wa,0),wa.dispatchEvent(e)}}function je(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function dt(){var e,i=wa.document.querySelector('meta[name="viewport"]');if(!i)return 1;var t=(e=i.content)===null||e===void 0?void 0:e.split(","),n=t.find(function(r){var o=r.split("="),u=(0,Ti.Z)(o,1),l=u[0];return l==="initial-scale"});return n?n.split("=")[1]*1:1}var vt=dt()<1?1:wa.devicePixelRatio;function $t(e,i){e.setAttribute("style","".concat(e.style.cssText).concat(i))}function Sr(e){return e.split(";").map(function(i){return i.trim()}).filter(function(i){return i})}function yr(e,i){var t,n=Sr((t=e.getAttribute("style"))!==null&&t!==void 0?t:""),r=Sr(i),o=f.pull.apply(void 0,[n].concat((0,H.Z)(r)));e.setAttribute("style",o.join(";"))}function wr(e){return Object.entries(e).map(function(i){var t=(0,Ti.Z)(i,2),n=t[0],r=t[1];return"".concat(n,": ").concat(r)}).join(";")}function Xr(e,i){return{left:e.left-i.left,top:e.top-i.top,right:i.left+i.width-e.left-e.width,bottom:i.top+i.height-e.top-e.height}}function yn(e,i){e.checked=i,i?e.setAttribute("checked","true"):e.removeAttribute("checked")}function ln(e){e.innerHTML=""}function Bn(e){e.setAttribute("draggable","false")}function ei(e,i){if(typeof i=="string"){var t=document.createElement("div");for(t.innerHTML=i;t.firstChild;)e.append(t.firstChild)}else Array.isArray(i)?e.append.apply(e,(0,H.Z)(i)):e.append(i)}function _i(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function gi(){return typeof importScripts=="function"}var Ki=gi()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},Nn=navigator.userAgent,Hi=!!Nn.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),Qi=Nn.indexOf("Android")>-1||Nn.indexOf("Adr")>-1;function Li(){for(var e=navigator.userAgent,i=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],t=!0,n=0,r=i;n<r.length;n++){var o=r[n];if(e.indexOf(o)>0){t=!1;break}}return t}function yi(e,i){e.forEach(function(t){!i[t]||(i[t]=i[t].bind(i))})}var ia=null;function Ii(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return Si(e,function(t){i[0]>t[0]&&(i[0]=t[0]),i[1]>t[1]&&(i[1]=t[1]),i[2]<t[0]&&(i[2]=t[0]),i[3]<t[1]&&(i[3]=t[1])}),i}Ii.default=Ii;var wi=Ii;function cs(e){return typeof e=="number"}var Po=2*Math.PI*6378137/2;function ro(e,i){var t=(0,Ti.Z)(i,4),n=t[0],r=t[1],o=t[2],u=t[3];return e.lng>n&&e.lng<=o&&e.lat>r&&e.lat<=u}function Ps(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(t){var n=t.coordinates;Zo(i,n)}),i}function Zo(e,i){return Array.isArray(i[0])?i.forEach(function(t){Zo(e,t)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function wo(e,i){return uu(e,i)}function uu(e,i){return Array.isArray(e[0])?e.map(function(t){return uu(t,i)}):i(e)}function Rs(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=Gu(e,i);var n=e[0],r=e[1],o=n*Po/180,u=Math.log(Math.tan((90+r)*Math.PI/360))/(Math.PI/180);return u=u*Po/180,t.enable&&(o=Number(o.toFixed(t.decimal)),u=Number(u.toFixed(t.decimal))),e.length===3?[o,u,e[2]]:[o,u]}function Vu(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=e[0],n=e[1],r=t/Po*180,o=n/Po*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),i!=null&&(r=Number(r.toFixed(i)),o=Number(o.toFixed(i))),e.length===3?[r,o,e[2]]:[r,o]}function lu(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function qo(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function Gu(e,i){if(i===!1)return e;var t=lu(e[0]),n=qo(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[t,n,e[2]]:[t,n]}function Es(e){var i=85.0511287798,t=Math.max(Math.min(i,e[1]),-i),n=256<<20,r=Math.PI/180,o=e[0]*r,u=t*r;u=Math.log(Math.tan(Math.PI/4+u/2));var l=.5/Math.PI,p=.5,v=-.5/Math.PI;return r=.5,o=n*(l*o+p),u=n*(v*u+r),[Math.floor(o),Math.floor(u)]}function Of(e){var i=.5/Math.PI,t=.5,n=-.5/Math.PI,r=.5,o=256<<20,u=_slicedToArray(e,2),l=u[0],p=u[1];l=(l/o-t)/i,p=(p/o-r)/n,p=(Math.atan(Math.pow(Math.E,p))-Math.PI/4)*2,r=Math.PI/180;var v=p/r,E=l/r;return[E,v]}function wc(e,i){var t=85.0511287798,n=Math.PI/180,r=6378137;return i=Math.max(Math.min(t,i),-t),e*=n,i*=n,i=Math.log(Math.tan(Math.PI/4+i/2)),[e*r,i*r]}function Gc(e,i){var t=Math.PI/180,n=6378137,r=e/n/t,o=2*(Math.atan(Math.exp(i/n))-Math.PI/4)/t;return[r,o]}function Ff(e,i,t){var n=Me(i[1]-e[1]),r=Me(i[0]-e[0]),o=Me(e[1]),u=Me(i[1]),l=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(r/2),2)*Math.cos(o)*Math.cos(u);return Ha(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),t="meters")}function ju(e){var i=Math.PI/180,t=85.0511287798,n=6378137,r=Math.max(Math.min(t,e[1]),-t),o=Math.sin(r*i),u=n*e[0]*i,l=n*Math.log((1+o)/(1-o))/2;return[u,l]}function Ol(e,i){var t=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-t],[e[1][0]+n,e[1][1]+t]]}function ml(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function ns(e){return[[e[0],e[1]],[e[2],e[3]]]}function Hu(e){var i=oc(e,[0,0]);return[e[0]/i,e[1]/i]}function oc(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Ac(e,i){return e[0]*i[0]+e[1]*i[1]}function Na(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function ll(e,i){return Math.acos(Ac(e,i)/(Na(e)*Na(i)))*180/Math.PI}function Eu(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function jc(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var t=[0,1],n=0,r=[],o=0;o<e.length-1;o++){var u=e[o],l=e[o+1],p=oc(u,l);n+=p;var v=[u[0]-l[0],u[1]-l[1]],E=Eu(t,v);if(o>0){var w=r[o-1].rotation;w-E>360-w+E&&(E=E+360)}r.push({start:u,end:l,dis:p,rotation:E,duration:0})}return r.map(function(M){M.duration=i*(M.dis/n)}),r}}function gl(e){if(cs(e[0]))return e;if(cs(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(cs(e[0][0][0])){var i=e,t=0,n=0,r=0;return i.forEach(function(o){o.forEach(function(u){t+=u[0],n+=u[1],r++})}),[t/r,n/r,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function Df(e){for(var i=e[0],t=e[1],n=e[0],r=e[1],o=0,u=0,l=0,p=0;p<e.length;p+=2){var v=e[p],E=e[p+1];v&&E&&(i=Math.max(v,i),t=Math.max(E,t),n=Math.min(v,n),r=Math.min(E,r),o+=v,u+=E,l++)}return{center:[o/l,u/l],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(t-r,2))/2}}function Bf(e){return wi(ua([Di(e)]))}function Fl(e){var i=131,t=137,n=0;e+="x";for(var r=Math.floor(9007199254740991/t),o=0;o<e.length;o++)n>r&&(n=Math.floor(n/t)),n=n*i+e.charCodeAt(o);return n}function lf(e){e=e.toString();for(var i=5381,t=e.length;t;)i=i*33^e.charCodeAt(--t);return i>>>0}function yl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=Math.random()*16|0,t=e==="x"?i:i&3|8;return t.toString(16)})}var sc;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(sc||(sc={}));function Qf(e,i,t,n,r){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,l=t;return u&&(l=Math.round(t*(o-1))/(o-1)),n?Jf(e,i,l,n,r):Jf(e,i,l,.314,r)}function Su(e,i){var t=1-i;return(e[0]*t+e[1]*i)*t+(e[1]*t+e[2]*i)*i}function Xs(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function cf(e,i,t){var n=[i[0]-e[0],i[1]-e[1]],r=Xs(n,[0,0]),o=Math.atan2(n[1],n[0]),u=r/2/Math.cos(t),l=o+t,p=[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]];return p}function Jf(e,i,t,n,r){if(r===Version["GAODE2.x"]){var o=amap2Project(e[0],e[1]),u=amap2Project(i[0],i[1]),l=cf(o,u,n),p=[o[0],l[0],u[0]],v=[o[1],l[1],u[1]];return[].concat(_toConsumableArray(amap2UnProject(Su(p,t),Su(v,t))),[0])}else{var E=cf(e,i,n),w=[e[0],E[0],i[0]],M=[e[1],E[1],i[1]];return[Su(w,t),Su(M,t),0]}}function zp(e,i,t,n,r){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,l=t;return u&&(l=Math.round(t*29)/29),ff(e,i,l,r)}function kh(e,i){var t=[i[0]-e[0],i[1]-e[1]],n=calDistance(t,[0,0]),r=Math.atan2(t[1],t[0]),o=.314,u=n/2/Math.cos(o),l=r+o,p=[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]];return p}function Ep(e,i){var t=1-i;return(e[0]*t+e[1]*i)*t+(e[1]*t+e[2]*i)*i}function Yh(e,i){var t=[e[0]-i[0],e[1]-i[1]],n=[Math.sin(t[0]/2),Math.sin(t[1]/2)],r=n[1]*n[1]+Math.cos(e[1])*Math.cos(i[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))}function ff(e,i,t,n){var r=[degreesToRadians(e[0]),degreesToRadians(e[1])],o=[degreesToRadians(i[0]),degreesToRadians(i[1])];if(n==="GAODE2.x"){var u=kh(r,o),l=[r[0],u[0],o[0]],p=[r[1],u[1],o[1]];return[Ep(l,t),Ep(p,t),0]}else{var v=Yh(r,o);if(Math.abs(v-Math.PI)<.001)return[(1-t)*r[0]+t*o[0],(1-t)*r[1]+t*o[1]];var E=Math.sin((1-t)*v)/Math.sin(v),w=Math.sin(t*v)/Math.sin(v),M=[Math.sin(r[0]),Math.sin(r[1])],k=[Math.cos(r[0]),Math.cos(r[1])],D=[Math.sin(o[0]),Math.sin(o[1])],N=[Math.cos(o[0]),Math.cos(o[1])],V=E*k[1]*k[0]+w*N[1]*N[0],q=E*k[1]*M[0]+w*N[1]*D[0],fe=E*M[1]+w*D[1];return[radiansToDegrees(Math.atan2(q,V)),radiansToDegrees(Math.atan2(fe,Math.sqrt(V*V+q*q)))]}}function eh(e,i){for(var t=0,n=[],r=0;r<e.length-1;r++){var o=e[r],u=e[r+1],l=wp(o,u),p=t;t+=l,n.push({p1:o,p2:u,totalDistance:t,distance:l,lastTotalDistance:p})}for(var v=t*i,E,w,M=0,k=n;M<k.length;M++){var D=k[M],N=D.totalDistance;if(N>v){var V=D.p1,q=D.p2,fe=(v-D.lastTotalDistance)/D.distance,he=Sp(q,V,fe);E=he[0],w=he[1];break}}return{lng:E,lat:w,height:0}}function Sp(e,i,t){return[e[0]*t+i[0]*(1-t),e[1]*t+i[1]*(1-t)]}function wp(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function ya(e,i){var t=i.featureId,n=e.data.dataArray;return typeof t=="number"&&(n=n.filter(function(r){var o=r.id;return o===t})),n.map(function(r){var o=vd(r,i);return _objectSpread(_objectSpread({},r),o)})}function qh(e,i){return new Promise(function(t){e.inited?t(ya(e,i)):e.once("update",function(){t(ya(e,i))})})}function vd(e,i){var t=i.offset,n=i.shape,r=i.thetaOffset,o=i.mapVersion,u=i.segmentNumber,l=u===void 0?30:u,p=i.autoFit,v=p===void 0?!0:p,E=e.coordinates;if(n==="line")return pathLineAtOffset(E,t);var w=E[0],M=E[1],k=typeof r=="string"?e[r]||0:r,D;switch(n){case"arc":D=arcLineAtOffset;break;case"greatcircle":D=greatCircleLineAtOffset;break;default:D=arcLineAtOffset}var N=D(w,M,t,k,o,l,v),V=_slicedToArray(N,3),q=V[0],fe=V[1],he=V[2];return{lng:q,lat:fe,height:he}}var Kh=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;(0,Ht.Z)(this,e),this.limit=i,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return(0,tr.Z)(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(n){t.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var n=this.cache[t];return n&&(this.deleteOrder(t),this.appendOrder(t)),n}},{key:"set",value:function(t,n){this.cache[t]?(this.delete(t),this.cache[t]=n,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=n,this.appendOrder(t))}},{key:"delete",value:function(t){var n=this.cache[t];n&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(n,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var n=this.order.findIndex(function(r){return r===t});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,n){return null}}]),e}();function th(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],t=1;t<e.length;t++)e[t]>i&&(i=e[t]);return i*1}function Zp(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],t=1;t<e.length;t++)e[t]<i&&(i=e[t]);return i*1}function md(e){if(e.length===0)return 0;for(var i=e[0]*1,t=1;t<e.length;t++)i+=e[t]*1;return i}function uc(e){if(e.length===0)throw new Error("mean requires at least one data point");return md(e)/e.length}function gd(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],t=NaN,n=0,r=1,o=1;o<e.length+1;o++)e[o]!==i?(r>n&&(n=r,t=i),r=1,i=e[o]):r++;return t*1}var Nf={min:Zp,max:th,mean:uc,sum:md,mode:gd};function Qh(e,i){return e.map(function(t){return t[i]})}function rh(e,i){return Nf[e](i)}function Uo(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}function yo(e,i){i===void 0&&(i={});var t=Number(e[0]),n=Number(e[1]),r=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var u=[t,n],l=[t,o],p=[r,o],v=[r,n];return ii([[u,v,p,l,u]],i.properties,{bbox:e,id:i.id})}var fs=ie(26729),Ph=ie.n(fs),Hc;(function(e){e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace"})(Hc||(Hc={}));var wu;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(wu||(wu={}));var nh=0,ih=1,hf=2;function Wc(e){e.forEach(function(i){i.isCurrent&&(i.isVisible=i.isLoaded)})}function zf(e){e.forEach(function(i){i.properties.state=nh}),e.forEach(function(i){i.isCurrent&&!Jh(i)&&Wu(i)}),e.forEach(function(i){i.isVisible=Boolean(i.properties.state&hf)})}function lc(e){e.forEach(function(t){t.properties.state=nh}),e.forEach(function(t){t.isCurrent&&Jh(t)});var i=e.slice().sort(function(t,n){return t.z-n.z});i.forEach(function(t){t.isVisible=Boolean(t.properties.state&hf),t.children.length&&(t.isVisible||t.properties.state&ih)?t.children.forEach(function(n){n.properties.state=ih}):t.isCurrent&&Wu(t)})}function Jh(e){for(;e;){if(e.isLoaded)return e.properties.state|=hf,!0;e=e.parent}return!1}function Wu(e){e.children.forEach(function(i){i.isLoaded?i.properties.state|=hf:Wu(i)})}var pf,ep=256,ah=[-Infinity,-Infinity,Infinity,Infinity],Rh=.2,Lh=5,_l=(pf={},(0,J.Z)(pf,Hc.Realtime,Wc),(0,J.Z)(pf,Hc.Overlap,zf),(0,J.Z)(pf,Hc.Replace,lc),pf),Oh=function(){};function Zf(e,i,t){var n=Math.floor((e+180)/360*Math.pow(2,t)),r=Math.floor((1-Math.log(Math.tan(i*Math.PI/180)+1/Math.cos(i*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[n,r]}function Fh(e,i,t){var n=e/Math.pow(2,t)*360-180,r=Math.PI-2*Math.PI*i/Math.pow(2,t),o=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[n,o]}var oh=function(i,t,n){var r=Fh(i,t,n),o=(0,Ti.Z)(r,2),u=o[0],l=o[1],p=Fh(i+1,t+1,n),v=(0,Ti.Z)(p,2),E=v[0],w=v[1];return[u,w,E,l]};function tp(e){var i=e.zoom,t=e.latLonBounds,n=e.maxZoom,r=n===void 0?Infinity:n,o=e.minZoom,u=o===void 0?0:o,l=e.zoomOffset,p=l===void 0?0:l,v=e.extent,E=v===void 0?ah:v,w=Math.ceil(i)+p;if(Number.isFinite(u)&&w<u)return[];Number.isFinite(r)&&w>r&&(w=r);for(var M=(0,Ti.Z)(t,4),k=M[0],D=M[1],N=M[2],V=M[3],q=[Math.max(k,E[0]),Math.max(D,E[1]),Math.min(N,E[2]),Math.min(V,E[3])],fe=[],he=Zf(q[0],q[1],w),Be=(0,Ti.Z)(he,2),Ge=Be[0],St=Be[1],Ut=Zf(q[2],q[3],w),Yt=(0,Ti.Z)(Ut,2),nr=Yt[0],Rr=Yt[1],Tr=Ge;Tr<=nr;Tr++)for(var on=Rr;on<=St;on++)fe.push({x:Tr,y:on,z:w});var Hn=(nr+Ge)/2,di=(St+Rr)/2,za=function(Ds,js){return Math.abs(Ds-Hn)+Math.abs(js-di)};return fe.sort(function(Co,Ds){return za(Co.x,Co.y)-za(Ds.x,Ds.y)}),fe}var Us=function(i,t,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,o=Math.pow(2,n),u=o-1,l=o,p=i,v=t;return r&&(p<0?p=p+l:p>u&&(p=p%l)),{warpX:p,warpY:v}};function cl(e){var i=yd();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function yd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ap=function(e){(0,Fr.Z)(t,e);var i=cl(t);function t(n){var r;(0,Ht.Z)(this,t),r=i.call(this),(0,J.Z)((0,Ke.Z)(r),"tileSize",256),(0,J.Z)((0,Ke.Z)(r),"isVisible",!1),(0,J.Z)((0,Ke.Z)(r),"isCurrent",!1),(0,J.Z)((0,Ke.Z)(r),"isVisibleChange",!1),(0,J.Z)((0,Ke.Z)(r),"loadedLayers",0),(0,J.Z)((0,Ke.Z)(r),"isLayerLoaded",!1),(0,J.Z)((0,Ke.Z)(r),"isLoad",!1),(0,J.Z)((0,Ke.Z)(r),"isChildLoad",!1),(0,J.Z)((0,Ke.Z)(r),"parent",null),(0,J.Z)((0,Ke.Z)(r),"children",[]),(0,J.Z)((0,Ke.Z)(r),"data",null),(0,J.Z)((0,Ke.Z)(r),"properties",{}),(0,J.Z)((0,Ke.Z)(r),"loadDataId",0);var o=n.x,u=n.y,l=n.z,p=n.tileSize,v=n.warp,E=v===void 0?!0:v;return r.x=o,r.y=u,r.z=l,r.warp=E||!0,r.tileSize=p,r}return(0,tr.Z)(t,[{key:"isLoading",get:function(){return this.loadStatus===wu.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===wu.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===wu.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===wu.Cancelled}},{key:"isDone",get:function(){return[wu.Loaded,wu.Cancelled,wu.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return oh(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var r=(0,Ti.Z)(this.bounds,4),o=r[0],u=r[1],l=r[2],p=r[3],v=[(l-o)/2,(p-u)/2],E=yo(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:v,meta:`
      `.concat(this.key,`
      `)}});return E}},{key:"key",get:function(){var r="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return r}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,ot.Z)(se().mark(function o(u){var l,p,v,E,w,M,k,D,N,V,q,fe,he,Be,Ge,St,Ut;return se().wrap(function(nr){for(;;)switch(nr.prev=nr.next){case 0:return l=u.getData,p=u.onLoad,v=u.onError,this.loadDataId++,E=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=wu.Loading,w=null,nr.prev=7,k=this.x,D=this.y,N=this.z,V=this.bounds,q=this.tileSize,fe=this.warp,he=Us(k,D,N,fe),Be=he.warpX,Ge=he.warpY,St=this.abortController.signal,Ut={x:Be,y:Ge,z:N,bounds:V,tileSize:q,signal:St,warp:fe},nr.next=14,l(Ut,this);case 14:w=nr.sent,nr.next=20;break;case 17:nr.prev=17,nr.t0=nr.catch(7),M=nr.t0;case 20:if(E===this.loadDataId){nr.next=22;break}return nr.abrupt("return");case 22:if(!(this.isCancelled&&!w)){nr.next=24;break}return nr.abrupt("return");case 24:if(!(M||!w)){nr.next=28;break}return this.loadStatus=wu.Failure,v(M,this),nr.abrupt("return");case 28:this.loadStatus=wu.Loaded,this.data=w,p(this);case 31:case"end":return nr.stop()}},o,this,[[7,17]])}));function r(o){return n.apply(this,arguments)}return r}()},{key:"reloadData",value:function(r){this.isLoading&&this.abortLoad(),this.loadData(r)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=wu.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),t}(fs.EventEmitter),rp=function(i,t){var n=ns(i),r=Ol(n,t),o=360*3-180,u=85.0511287798065,l=[Math.max(r[0][0],-o),Math.max(r[0][1],-u),Math.min(r[1][0],o),Math.min(r[1][1],u)];return l},Dh=function(i,t){var n=ns(i),r=ns(t),o=ml(n,r);return o};function df(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Dl(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function Dl(e,i){if(!!e){if(typeof e=="string")return Up(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Up(e,i)}}function Up(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function np(e){var i=Cc();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function Cc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xl=function(e){(0,Fr.Z)(t,e);var i=np(t);function t(n){var r;return(0,Ht.Z)(this,t),r=i.call(this),(0,J.Z)((0,Ke.Z)(r),"currentTiles",[]),(0,J.Z)((0,Ke.Z)(r),"cacheTiles",new Map),(0,J.Z)((0,Ke.Z)(r),"throttleUpdate",(0,f.throttle)(function(o,u){r.update(o,u)},16)),(0,J.Z)((0,Ke.Z)(r),"onTileLoad",function(o){r.emit("tile-loaded",o),r.updateTileVisible()}),(0,J.Z)((0,Ke.Z)(r),"onTileError",function(o,u){r.emit("tile-error",{error:o,tile:u}),r.updateTileVisible()}),(0,J.Z)((0,Ke.Z)(r),"onTileUnload",function(o){r.emit("tile-unload",o)}),r.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:ah,getTileData:Oh,warp:!0,updateStrategy:Hc.Overlap},r.updateOptions(n),r}return(0,tr.Z)(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(r){return r.isDone})}},{key:"tiles",get:function(){var r=Array.from(this.cacheTiles.values()).sort(function(o,u){return o.z-u.z});return r}},{key:"updateOptions",value:function(r){var o=r.minZoom===void 0?this.options.minZoom:Math.ceil(r.minZoom),u=r.maxZoom===void 0?this.options.maxZoom:Math.floor(r.maxZoom);this.options=(0,U.Z)((0,U.Z)((0,U.Z)({},this.options),r),{},{minZoom:o,maxZoom:u})}},{key:"update",value:function(r,o){var u=this,l=Math.max(0,Math.ceil(r));if(!(this.lastViewStates&&this.lastViewStates.zoom===l&&Dh(this.lastViewStates.latLonBoundsBuffer,o))){var p=rp(o,Rh);this.lastViewStates={zoom:l,latLonBounds:o,latLonBoundsBuffer:p};var v=!1,E=this.getTileIndices(l,p).filter(function(w){return u.options.warp||w.x>=0&&w.x<Math.pow(2,l)});this.currentTiles=E.map(function(w){var M=w.x,k=w.y,D=w.z,N=u.getTile(M,k,D);if(N){var V,q,fe=((V=N)===null||V===void 0?void 0:V.isFailure)||((q=N)===null||q===void 0?void 0:q.isCancelled);return fe&&N.loadData({getData:u.options.getTileData,onLoad:u.onTileLoad,onError:u.onTileError}),N}return N=u.createTile(M,k,D),v=!0,N}),v&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var r=df(this.cacheTiles),o;try{for(r.s();!(o=r.n()).done;){var u=(0,Ti.Z)(o.value,2),l=u[0],p=u[1];this.currentTiles.includes(p)||(this.cacheTiles.delete(l),this.onTileUnload(p)),this.onTileUnload(p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(v){r.e(v)}finally{r.f()}}},{key:"pruneRequests",value:function(){var r=[],o=df(this.cacheTiles.values()),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;l.isLoading&&!l.isCurrent&&!l.isVisible&&r.push(l)}}catch(v){o.e(v)}finally{o.f()}for(;r.length>0;){var p=r.shift();p.abortLoad()}}},{key:"getTileByLngLat",value:function(r,o,u){var l=this.options.zoomOffset,p=Math.ceil(u)+l,v=Zf(r,o,p),E=this.tiles.filter(function(w){return w.key==="".concat(v[0],"_").concat(v[1],"_").concat(p)});return E[0]}},{key:"destroy",value:function(){var r=df(this.cacheTiles.values()),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u.isLoading&&u.abortLoad()}}catch(l){r.e(l)}finally{r.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var r=this.options.updateStrategy,o=new Map,u=df(this.cacheTiles.values()),l;try{for(u.s();!(l=u.n()).done;){var p=l.value;o.set(p.key,p.isVisible),p.isCurrent=!1,p.isVisible=!1}}catch(D){u.e(D)}finally{u.f()}var v=df(this.currentTiles),E;try{for(v.s();!(E=v.n()).done;){var w=E.value;w.isCurrent=!0,w.isVisible=!0}}catch(D){v.e(D)}finally{v.f()}var M=Array.from(this.cacheTiles.values());typeof r=="function"?r(M):_l[r](M);var k=!1;Array.from(this.cacheTiles.values()).forEach(function(D){D.isVisible!==o.get(D.key)?(D.isVisibleChange=!0,k=!0):D.isVisibleChange=!1}),k&&this.emit("tile-update")}},{key:"getTileIndices",value:function(r,o){var u=this.options,l=u.tileSize,p=u.extent,v=u.zoomOffset,E=Math.floor(this.options.maxZoom),w=Math.ceil(this.options.minZoom),M=tp({maxZoom:E,minZoom:w,zoomOffset:v,tileSize:l,zoom:r,latLonBounds:o,extent:p});return M}},{key:"getTileId",value:function(r,o,u){var l="".concat(r,",").concat(o,",").concat(u);return l}},{key:"getTile",value:function(r,o,u){var l=this.getTileId(r,o,u),p=this.cacheTiles.get(l);return p}},{key:"createTile",value:function(r,o,u){var l=this.getTileId(r,o,u),p=new Ap({x:r,y:o,z:u,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(l,p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),p}},{key:"resizeCacheTiles",value:function(){var r=Lh*this.currentTiles.length,o=this.cacheTiles.size>r;if(o){var u=df(this.cacheTiles),l;try{for(u.s();!(l=u.n()).done;){var p=(0,Ti.Z)(l.value,2),v=p[0],E=p[1];if(!E.isVisible&&!this.currentTiles.includes(E)&&(this.cacheTiles.delete(v),this.onTileUnload(E)),this.cacheTiles.size<=r)break}}catch(w){u.e(w)}finally{u.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var r=df(this.cacheTiles.values()),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u.parent=null,u.children.length=0}}catch(w){r.e(w)}finally{r.f()}var l=df(this.cacheTiles.values()),p;try{for(l.s();!(p=l.n()).done;){var v=p.value,E=this.getNearestAncestor(v.x,v.y,v.z);v.parent=E,E!=null&&E.children&&E.children.push(v)}}catch(w){l.e(w)}finally{l.f()}}},{key:"getNearestAncestor",value:function(r,o,u){for(;u>this.options.minZoom;){r=Math.floor(r/2),o=Math.floor(o/2),u=u-1;var l=this.getTile(r,o,u);if(l)return l}return null}}]),t}(Ph());function zd(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function _d(e){var i=[],t=/\{([a-z])-([a-z])\}/.exec(e);if(t){var n=t[1].charCodeAt(0),r=t[2].charCodeAt(0),o;for(o=n;o<=r;++o)i.push(e.replace(t[0],String.fromCharCode(o)));return i}if(t=/\{(\d+)-(\d+)\}/.exec(e),t){for(var u=parseInt(t[2],10),l=parseInt(t[1],10);l<=u;l++)i.push(e.replace(t[0],l.toString()));return i}return i.push(e),i}function bl(e,i){if(!e||!e.length)throw new Error("url is not allowed to be empty");var t=i.x,n=i.y,r=i.z,o=_d(e),u=Math.abs(t+n)%o.length,l=o[u];return l.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,r.toString()).replace(/\{bbox\}/g,oh(t,n,r).join(",")).replace(/\{-y\}/g,(Math.pow(2,r)-n-1).toString())}function vf(e,i){var t=i.x,n=i.y,r=i.z,o=i.layer,u=i.version,l=u===void 0?"1.0.0":u,p=i.style,v=p===void 0?"default":p,E=i.format,w=i.service,M=w===void 0?"WMTS":w,k=i.tileMatrixset,D="".concat(e,"&SERVICE=").concat(M,"&REQUEST=GetTile&VERSION=").concat(l,"&LAYER=").concat(o,"&STYLE=").concat(v,"&TILEMATRIXSET=").concat(k,"&FORMAT=").concat(E,"&TILECOL=").concat(t,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(r);return D}function cc(e,i){if(!e)throw new Error(i||"web worker helper assertion failed.")}var Xu={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},Vp=Xu.self||Xu.window||{},ip=Xu.window||Xu.self||{},Gp=Xu.self||Xu.window||{},jp=Xu.document||{},no=typeof importScripts=="function",mf=typeof window!="undefined"&&typeof window.orientation!="undefined",Ss=function(){function e(i,t){var n=this;this.name=i,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(r,o){n.resolve=r,n.reject=o})}return e.prototype.postMessage=function(i,t){this.workerThread.postMessage({source:"Main thread",type:i,payload:t})},e.prototype.done=function(i){cc(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(i)},e.prototype.error=function(i){cc(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(i)},e}(),El=Ss,ap=new Map;function Xc(e){cc(e.source&&!e.url||!e.source&&e.url);var i=ap.get(e.source||e.url);return i||(e.url&&(i=xd(e.url),ap.set(e.url,i)),e.source&&(i=Hp(e.source),ap.set(e.source,i))),cc(i),i}function xd(e){if(!e.startsWith("http"))return e;var i=Zd(e);return Hp(i)}function Hp(e){var i=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(i)}function Zd(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function Bh(e,i,t){i===void 0&&(i=!0);var n=t||new Set;if(e){if(bd(e))n.add(e);else if(bd(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(i&&typeof e=="object")for(var r in e)Bh(e[r],i,n)}}return t===void 0?Array.from(n):[]}function bd(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var Wp=function(){},Hl=function(){function e(i){this.terminated=!1,this.loadableURL="";var t=i.name,n=i.source,r=i.url;cc(n||r),this.name=t,this.source=n,this.url=r,this.onMessage=Wp,this.onError=function(o){return console.log(o)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=Wp,this.onError=Wp,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(i,t){t=t||Bh(i),this.worker.postMessage(i,t)},e.prototype.getErrorFromErrorEvent=function(i){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",i.message&&(t+=i.message+" in "),i.lineno&&(t+=":"+i.lineno+":"+i.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var i=this;this.loadableURL=Xc({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(n){n.data?i.onMessage(n.data):i.onError(new Error("No data received"))},t.onerror=function(n){i.onError(i.getErrorFromErrorEvent(n)),i.terminated=!0},t.onmessageerror=function(n){return console.error("worker "+i.name+", message error: "+n)},t},e}(),op=Hl,sh=function(){return sh=Object.assign||function(e){for(var i,t=1,n=arguments.length;t<n;t++){i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},sh.apply(this,arguments)},Uf=function(e,i,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function l(E){try{v(n.next(E))}catch(w){u(w)}}function p(E){try{v(n.throw(E))}catch(w){u(w)}}function v(E){E.done?o(E.value):r(E.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},ho=function(e,i){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(E){return p([v,E])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=v[0]&2?r.return:v[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,v[1])).done)return o;switch(r=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,r=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){t.label=v[1];break}if(v[0]===6&&t.label<o[1]){t.label=o[1],o=v;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(v);break}o[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(e,t)}catch(E){v=[6,E],r=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},Vf=function(){function e(i){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=i.source,this.url=i.url,this.setProps(i)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(i){return i.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(i){this.props=sh(sh({},this.props),i),i.name!==void 0&&(this.name=i.name),i.maxConcurrency!==void 0&&(this.maxConcurrency=i.maxConcurrency),i.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=i.maxMobileConcurrency),i.reuseWorkers!==void 0&&(this.reuseWorkers=i.reuseWorkers),i.onDebug!==void 0&&(this.onDebug=i.onDebug)},e.prototype.startJob=function(i,t,n){return t===void 0&&(t=function(r,o,u){return r.done(u)}),n===void 0&&(n=function(r,o){return r.error(o)}),Uf(this,void 0,void 0,function(){var r,o=this;return ho(this,function(u){switch(u.label){case 0:return r=new Promise(function(l){return o.jobQueue.push({name:i,onMessage:t,onError:n,onStart:l}),o}),this.startQueuedJob(),[4,r];case 1:return[2,u.sent()]}})})},e.prototype.startQueuedJob=function(){return Uf(this,void 0,void 0,function(){var i,t,n;return ho(this,function(r){switch(r.label){case 0:if(!this.jobQueue.length)return[2];if(i=this.getAvailableWorker(),!i)return[2];if(t=this.jobQueue.shift(),!t)return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:i}),n=new El(t.name,i),i.onMessage=function(o){return t.onMessage(n,o.type,o.payload)},i.onError=function(o){return t.onError(n,o)},t.onStart(n),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,n.result];case 2:return r.sent(),[3,4];case 3:return this.returnWorkerToQueue(i),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(i){var t=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();t?(i.destroy(),this.count--):this.idleQueue.push(i),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var i=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new op({name:i,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return mf?this.maxMobileConcurrency:this.maxConcurrency},e}(),Wi=Vf,Wl=function(){return Wl=Object.assign||function(e){for(var i,t=1,n=arguments.length;t<n;t++){i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},Wl.apply(this,arguments)},Nh=function(e){var i=typeof Symbol=="function"&&Symbol.iterator,t=i&&e[i],n=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},uh={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},X=function(){function e(i){this.workerPools=new Map,this.props=Wl({},uh),this.setProps(i),this.workerPools=new Map}return e.isSupported=function(){return op.isSupported()},e.getWorkerFarm=function(i){return i===void 0&&(i={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(i),e.workerFarm},e.prototype.destroy=function(){var i,t;try{for(var n=Nh(this.workerPools.values()),r=n.next();!r.done;r=n.next()){var o=r.value;o.destroy()}}catch(u){i={error:u}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(i)throw i.error}}},e.prototype.setProps=function(i){var t,n;this.props=Wl(Wl({},this.props),i);try{for(var r=Nh(this.workerPools.values()),o=r.next();!o.done;o=r.next()){var u=o.value;u.setProps(this.getWorkerPoolProps())}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(i){var t=i.name,n=i.source,r=i.url,o=this.workerPools.get(t);return o||(o=new Wi({name:t,source:n,url:r}),o.setProps(this.getWorkerPoolProps()),this.workerPools.set(t,o)),o},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),Le=X,rt=new Map,Kt=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(i){self.onmessage=function(t){if(!!lr(t)){var n=t.data,r=n.type,o=n.payload;i(r,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(i){var t=rt.get(i);t||(t=function(n){if(!!lr(n)){var r=n.data,o=r.type,u=r.payload;i(o,u)}}),self.addEventListener("message",t)},e.removeEventListener=function(i){var t=rt.get(i);rt.delete(i),self.removeEventListener("message",t)},e.postMessage=function(i,t){if(self){var n={source:"Worker thread",type:i,payload:t},r=Bh(t);self.postMessage(n,r)}},e}(),Pr=Kt;function lr(e){var i=e.type,t=e.data;return i==="message"&&t&&typeof t.source=="string"&&t.source==="Main thread"}function Ir(e){return JSON.parse(Hr(e))}function Hr(e){var i=new Set;return JSON.stringify(e,function(t,n){if(typeof n=="object"&&n!==null){if(i.has(n))try{return JSON.parse(JSON.stringify(n))}catch(r){return}i.add(n)}return n})}function Qr(e){return""+e.name}function an(e,i){i===void 0&&(i={});var t=i[e.id]||{},n=e.name+".worker.js",r=t.workerUrl;return i._workerType==="test"&&(r=e.module+"/dist/"+n),r||(r="https://unpkg.com/"+e.module+"/dist/"+n),assert(r),r}var cn=function(e,i,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function l(E){try{v(n.next(E))}catch(w){u(w)}}function p(E){try{v(n.throw(E))}catch(w){u(w)}}function v(E){E.done?o(E.value):r(E.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},hn=function(e,i){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(E){return p([v,E])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=v[0]&2?r.return:v[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,v[1])).done)return o;switch(r=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,r=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){t.label=v[1];break}if(v[0]===6&&t.label<o[1]){t.label=o[1],o=v;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(v);break}o[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(e,t)}catch(E){v=[6,E],r=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}};function _n(e,i){return WorkerFarm.isSupported()?e.worker&&(i==null?void 0:i.worker):!1}function Ur(e,i,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),cn(this,void 0,void 0,function(){var r,o,u,l,p,v,E,w;return hn(this,function(M){switch(M.label){case 0:return r=getWorkerName(e),o=getWorkerURL(e,t),u=WorkerFarm.getWorkerFarm(t),l=u.getWorkerPool({name:r,url:o}),p=t.jobName||e.name,[4,l.startJob(p,sn.bind(null,n))];case 1:return v=M.sent(),E=removeNontransferableOptions(t),v.postMessage("process",{input:i,options:E}),[4,v.result];case 2:return w=M.sent(),[2,w.result]}})})}function sn(e,i,t,n){return cn(this,void 0,void 0,function(){var r,o,u,l,p,v,E;return hn(this,function(w){switch(w.label){case 0:switch(r=t,r){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return i.done(n),[3,9];case 2:return i.error(new Error(n.error)),[3,9];case 3:o=n.id,u=n.input,l=n.options,w.label=4;case 4:return w.trys.push([4,6,,7]),e.process?[4,e.process(u,l)]:(i.postMessage("error",{id:o,error:"Worker not set up to process on main thread"}),[2]);case 5:return p=w.sent(),i.postMessage("done",{id:o,result:p}),[3,7];case 6:return v=w.sent(),E=v instanceof Error?v.message:"unknown error",i.postMessage("error",{id:o,error:E}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+t),w.label=9;case 9:return[2]}})})}var zt=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(i){return this.enqueue(i)},e.prototype.enqueue=function(i){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();i instanceof Error?t.reject(i):t.resolve({value:i})}else this._values.push(i)},e.prototype.close=function(){for(;this._settlers.length>0;){var i=this._settlers.shift();i.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var i=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,r){i._settlers.push({resolve:n,reject:r})})},e}(),xr=zt,nn=function(e,i,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function l(E){try{v(n.next(E))}catch(w){u(w)}}function p(E){try{v(n.throw(E))}catch(w){u(w)}}function v(E){E.done?o(E.value):r(E.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},wn=function(e,i){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(E){return p([v,E])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=v[0]&2?r.return:v[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,v[1])).done)return o;switch(r=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,r=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){t.label=v[1];break}if(v[0]===6&&t.label<o[1]){t.label=o[1],o=v;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(v);break}o[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(e,t)}catch(E){v=[6,E],r=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},Dr=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e[Symbol.asyncIterator],t;return i?i.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=e[o]&&function(u){return new Promise(function(l,p){u=e[o](u),r(l,p,u.done,u.value)})}}function r(o,u,l,p){Promise.resolve(p).then(function(v){o({value:v,done:l})},u)}},pn=0,Mn,Ei;function kr(e,i){var t=this;if(typeof self!="undefined"){var n={process:Lr};Pr.onmessage=function(r,o){return nn(t,void 0,void 0,function(){var u,l,p,v,E,w,M,k,D,N,V;return wn(this,function(q){switch(q.label){case 0:switch(q.trys.push([0,19,,20]),u=r,u){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},n)];case 2:return l=q.sent(),Pr.postMessage("done",{result:l}),[3,18];case 3:if(!i)throw new Error("Worker does not support batched processing");Mn=new xr,Ei=o.options||{},p=i(Mn,Ei,n),q.label=4;case 4:q.trys.push([4,9,10,15]),v=Dr(p),q.label=5;case 5:return[4,v.next()];case 6:if(E=q.sent(),!!E.done)return[3,8];w=E.value,Pr.postMessage("output-batch",{result:w}),q.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return M=q.sent(),N={error:M},[3,15];case 10:return q.trys.push([10,,13,14]),E&&!E.done&&(V=v.return)?[4,V.call(v)]:[3,12];case 11:q.sent(),q.label=12;case 12:return[3,14];case 13:if(N)throw N.error;return[7];case 14:return[7];case 15:return Pr.postMessage("done",{}),[3,18];case 16:return Mn.push(o.input),[3,18];case 17:return Mn.close(),[3,18];case 18:return[3,20];case 19:return k=q.sent(),D=k instanceof Error?k.message:"",Pr.postMessage("error",{error:D}),[3,20];case 20:return[2]}})})}}}function Lr(e,i){return i===void 0&&(i={}),new Promise(function(t,n){var r=pn++,o=function(l,p){if(p.id===r)switch(l){case"done":Pr.removeEventListener(o),t(p.result);break;case"error":Pr.removeEventListener(o),n(p.error);break;default:}};Pr.addEventListener(o);var u={id:r,input:e,options:i};Pr.postMessage("process",u)})}var Kn=function(e,i,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function l(E){try{v(n.next(E))}catch(w){u(w)}}function p(E){try{v(n.throw(E))}catch(w){u(w)}}function v(E){E.done?o(E.value):r(E.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},In=function(e,i){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(E){return p([v,E])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=v[0]&2?r.return:v[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,v[1])).done)return o;switch(r=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,r=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){t.label=v[1];break}if(v[0]===6&&t.label<o[1]){t.label=o[1],o=v;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(v);break}o[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(e,t)}catch(E){v=[6,E],r=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},rn={};function On(e,i,t){return i===void 0&&(i=null),t===void 0&&(t={}),Kn(this,void 0,void 0,function(){return In(this,function(n){switch(n.label){case 0:return i&&(e=Rn(e,i,t)),rn[e]=rn[e]||aa(e),[4,rn[e]];case 1:return[2,n.sent()]}})})}function Rn(e,i,t){if(e.startsWith("http"))return e;var n=t.modules||{};return n[e]?n[e]:t.CDN?(assert(t.CDN.startsWith("http")),t.CDN+"/"+i+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+i+"/src/libs/"+e}function aa(e){return Kn(this,void 0,void 0,function(){var i,t,n;return In(this,function(r){switch(r.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return i=r.sent(),[4,i.arrayBuffer()];case 2:return[2,r.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return t=r.sent(),[4,t.text()];case 5:return n=r.sent(),[2,zi(n,e)]}})})}function zi(e,i){if(isWorker)return eval.call(global,e),null;var t=document.createElement("script");t.id=i;try{t.appendChild(document.createTextNode(e))}catch(n){t.text=e}return document.body.appendChild(t),null}var Pn="0.0.3",zn={id:"null",name:"null",module:"web-worker-helper",options:{}};function ki(e){var i=e.color;return!i||!i.length?[1,1,1,1]:i}function Vi(e,i,t){return t.length===2?[t[0],t[1],0]:[t[0],t[1],t[2]]}function _a(e){var i=e.filter;return i?[1]:[0]}function io(e,i){return[i]}var Ro=ie(9187),qi=ie.n(Ro),Gr=ie(31437),Lo=Gr.create(),cu=Gr.create(),Fa=Gr.create(),Ko=Gr.create(),is=Gr.create();function eu(e,i,t,n,r){Gr.add(e,t,n),Gr.normalize(e,e),i=Gr.fromValues(-e[1],e[0]);var o=Gr.fromValues(-t[1],t[0]);return[r/Gr.dot(i,o),i]}function Mo(e,i){return Gr.set(e,-i[1],i[0])}function $i(e,i,t){return Gr.sub(e,i,t),Gr.normalize(e,e),e}function Ls(e,i){return e[0]===i[0]&&e[1]===i[1]}function Ka(e){for(var i=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(t,1),t++):i.set(n,n)}return e}var fu=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Ht.Z)(this,e),(0,J.Z)(this,"lastFlip",-1),(0,J.Z)(this,"miter",Gr.fromValues(0,0)),(0,J.Z)(this,"started",!1),(0,J.Z)(this,"dash",!1),(0,J.Z)(this,"totalDistance",0),(0,J.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,tr.Z)(e,[{key:"extrude_gaode2",value:function(t,n){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,l=1;l<o;l++){var p,v,E,w=t[l-1];w.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var M=n[l-1],k=t[l];k.push((v=n[l][2])!==null&&v!==void 0?v:0);var D=n[l],N=l<t.length-1?[].concat((0,H.Z)(t[l+1]),[(E=n[l+1][2])!==null&&E!==void 0?E:0]):null,V=l<n.length-1?n[l+1]:null,q=this.segment_gaode2(r,u,w,k,N,M,D,V);u+=q}if(this.dash)for(var fe=0;fe<r.positions.length/6;fe++)r.positions[fe*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,n){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,l=1;l<o;l++){var p,v,E,w=t[l-1];w.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var M=n[l-1],k=t[l];k.push((v=n[l][2])!==null&&v!==void 0?v:0);var D=n[l],N=l<t.length-1?[].concat((0,H.Z)(t[l+1]),[(E=n[l+1][2])!==null&&E!==void 0?E:0]):null,V=l<n.length-1?n[l+1]:null,q=this.simpleSegment(r,u,w,k,N,M,D,V);u+=q}if(this.dash)for(var fe=0;fe<r.positions.length/6;fe++)r.positions[fe*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=n.startIndex,u=1;u<r;u++){var l=t[u-1],p=t[u],v=u<t.length-1?t[u+1]:null,E=this.segment(n,o,l,p,v);o+=E}if(this.dash)for(var w=0;w<n.positions.length/6;w++)n.positions[w*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=n.startIndex,u=1;u<r;u++){var l=t[u-1],p=t[u],v=u<t.length-1?t[u+1]:null,E=this.simpleSegment(n,o,l,p,v);o+=E}if(this.dash)for(var w=0;w<n.positions.length/6;w++)n.positions[w*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(t,n,r,o,u,l,p,v){var E=0,w=t.indices,M=t.positions,k=t.normals,D=this.cap==="square",N=this.join==="bevel",V=Es([p[0],p[1]]),q=Es([l[0],l[1]]);$i(Fa,o,r);var fe=0;if(this.dash&&(fe=this.lineSegmentDistance(V,q),this.totalDistance+=fe),this.normal||(this.normal=Gr.create(),Mo(this.normal,Fa)),!this.started)if(this.started=!0,D){var he=Gr.create(),Be=Gr.create();Gr.add(he,this.normal,Fa),Gr.add(Be,this.normal,Fa),k.push(Be[0],Be[1],0),k.push(he[0],he[1],0),M.push(r[0],r[1],r[2]|0,this.totalDistance-fe,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),M.push(r[0],r[1],r[2]|0,this.totalDistance-fe,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(M,k,r,this.normal,this.thickness,this.totalDistance-fe);if(w.push(n+0,n+1,n+2),u){Ls(o,u)&&Gr.add(u,o,Gr.normalize(u,Gr.subtract(u,o,r))),$i(Ko,u,o);var Ut=eu(is,Gr.create(),Fa,Ko,this.thickness),Yt=(0,Ti.Z)(Ut,2),nr=Yt[0],Rr=Yt[1],Tr=Gr.dot(is,this.normal)<0?-1:1,on=N;if(!on&&this.join==="miter"){var Hn=nr;Hn>this.miterLimit&&(on=!0)}on?(k.push(this.normal[0],this.normal[1],0),k.push(Rr[0],Rr[1],0),M.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Tr,o[2]|0),this.complex.indexes.push(this.currentIndex),M.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Tr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,w.push.apply(w,(0,H.Z)(this.lastFlip!==-Tr?[n,n+2,n+3]:[n+2,n+1,n+3])),w.push(n+2,n+3,n+4),Mo(Lo,Ko),Gr.copy(this.normal,Lo),k.push(this.normal[0],this.normal[1],0),M.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Tr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,E+=3):(this.extrusions(M,k,o,Rr,nr,this.totalDistance),w.push.apply(w,(0,H.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Tr=-1,Gr.copy(this.normal,Rr),E+=2),this.lastFlip=Tr}else{if(Mo(this.normal,Fa),D){var Ge=Gr.create(),St=Gr.create();Gr.sub(St,Fa,this.normal),Gr.add(Ge,Fa,this.normal),k.push(St[0],St[1],0),k.push(Ge[0],Ge[1],0),M.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),M.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(M,k,o,this.normal,this.thickness,this.totalDistance);w.push.apply(w,(0,H.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),E+=2}return E}},{key:"simpleSegment",value:function(t,n,r,o,u){var l=0,p=t.indices,v=t.positions,E=t.normals,w=Es([o[0],o[1]]),M=Es([r[0],r[1]]);$i(Fa,w,M);var k=0;if(this.dash&&(k=this.lineSegmentDistance(w,M),this.totalDistance+=k),this.normal||(this.normal=Gr.create(),Mo(this.normal,Fa)),this.started||(this.started=!0,this.extrusions(v,E,r,this.normal,this.thickness,this.totalDistance-k)),p.push(n+0,n+1,n+2),!u)Mo(this.normal,Fa),this.extrusions(v,E,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,H.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var D=Es([u[0],u[1]]);Ls(w,D)&&Gr.add(D,w,Gr.normalize(D,Gr.subtract(D,w,M))),$i(Ko,D,w);var N=eu(is,Gr.create(),Fa,Ko,this.thickness),V=(0,Ti.Z)(N,2),q=V[0],fe=V[1],he=Gr.dot(is,this.normal)<0?-1:1;this.extrusions(v,E,o,fe,q,this.totalDistance),p.push.apply(p,(0,H.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),he=-1,Gr.copy(this.normal,fe),l+=2,this.lastFlip=he}return l}},{key:"segment",value:function(t,n,r,o,u){var l=0,p=t.indices,v=t.positions,E=t.normals,w=this.cap==="square",M=this.join==="bevel",k=Es([o[0],o[1]]),D=Es([r[0],r[1]]);$i(Fa,k,D);var N=0;if(this.dash&&(N=this.lineSegmentDistance(k,D),this.totalDistance+=N),this.normal||(this.normal=Gr.create(),Mo(this.normal,Fa)),!this.started)if(this.started=!0,w){var V=Gr.create(),q=Gr.create();Gr.add(V,this.normal,Fa),Gr.add(q,this.normal,Fa),E.push(q[0],q[1],0),E.push(V[0],V[1],0),v.push(r[0],r[1],r[2]|0,this.totalDistance-N,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),v.push(r[0],r[1],r[2]|0,this.totalDistance-N,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,E,r,this.normal,this.thickness,this.totalDistance-N);if(p.push(n+0,n+1,n+2),u){var Be=Es([u[0],u[1]]);Ls(k,Be)&&Gr.add(Be,k,Gr.normalize(Be,Gr.subtract(Be,k,D))),$i(Ko,Be,k);var Ge=eu(is,Gr.create(),Fa,Ko,this.thickness),St=(0,Ti.Z)(Ge,2),Ut=St[0],Yt=St[1],nr=Gr.dot(is,this.normal)<0?-1:1,Rr=M;if(!Rr&&this.join==="miter"){var Tr=Ut;Tr>this.miterLimit&&(Rr=!0)}Rr?(E.push(this.normal[0],this.normal[1],0),E.push(Yt[0],Yt[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*nr,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*nr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,H.Z)(this.lastFlip!==-nr?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),Mo(Lo,Ko),Gr.copy(this.normal,Lo),E.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*nr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(v,E,o,Yt,Ut,this.totalDistance),p.push.apply(p,(0,H.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),nr=-1,Gr.copy(this.normal,Yt),l+=2),this.lastFlip=nr}else{if(Mo(this.normal,Fa),w){var fe=Gr.create(),he=Gr.create();Gr.sub(he,Fa,this.normal),Gr.add(fe,Fa,this.normal),E.push(he[0],he[1],0),E.push(fe[0],fe[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,E,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,H.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,r,o,u,l){n.push(o[0],o[1],0),n.push(o[0],o[1],0),t.push(r[0],r[1],r[2]|0,l,-u,r[2]|0),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],r[2]|0,l,u,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var r=n[0]-t[0],o=n[1]-t[1];return Math.sqrt(r*r+o*o)}}]),e}(),Oi=85.0511287798;function va(e){var i=e.coordinates,t=e.originCoordinates,n=e.version,r=new fu({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=t;Array.isArray(u[0][0])||(u=[t]);for(var l=0;l<o.length;l++){var p=o[l],v=u[l];r.extrude_gaode2(p,v)}}else{var E=i;E[0]&&!Array.isArray(E[0][0])&&(E=[i]),E.forEach(function(M){r.extrude(M)})}var w=r.complex;return{vertices:w.positions,indices:w.indices,normals:w.normals,indexes:w.indexes,size:6}}function Ga(e){var i=gl(e.coordinates);return{vertices:[].concat((0,H.Z)(i),(0,H.Z)(i),(0,H.Z)(i),(0,H.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function ws(e){var i=e.coordinates,t=qi().flatten(i),n=t.vertices,r=t.dimensions,o=t.holes,u=qi()(n,o,r);return{indices:u,vertices:n,size:r}}function gf(e,i){var t=i;return i>Oi&&(t=Oi),i<-Oi&&(t=-Oi),[Math.PI*e/180+Math.PI,Math.PI-Math.log(Math.tan(Math.PI*.25+Math.PI*t/180*.5))]}function We(e,i){return[(e-Math.PI)*180/Math.PI,(Math.atan(Math.exp(Math.PI-i))-Math.PI*.25)*2*180/Math.PI]}var vr=function(){var e=(0,ot.Z)(se().mark(function i(t){var n,r,o,u,l,p,v,E,w;return se().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return n=t.descriptors,r=t.features,o=t.enablePicking,u=t.iconMap,l={a_Color:ki,a_Position:Vi,filter:_a,a_vertexId:io,a_PickingColor:function(N){var V=N.id;return o?Zu(V):[0,0,0]},a_DistanceAndIndex:function(N,V,q,fe,he,Be){return Be===void 0?[q[3],10]:[q[3],Be]},a_Total_Distance:function(N,V,q){return[q[5]]},a_Size:function(N){var V=N.size,q=V===void 0?1:V;return Array.isArray(q)?[q[0],q[1]]:[q,0]},a_Normal:function(N,V,q,fe,he){return he},a_Miter:function(N,V,q){return[q[4]]},a_iconMapUV:function(N){var V=N.texture,q=u[V]||{x:0,y:0},fe=q.x,he=q.y;return[fe,he]}},p={sizePerElement:0,elements:[]},v=0,E=[],w=3,r.forEach(function(D,N){var V=va(D),q=V.indices,fe=V.vertices,he=V.normals,Be=V.size,Ge=V.indexes;q.forEach(function(nr){E.push(nr+v)}),w=Be;var St=fe.length/Be;p.sizePerElement=w,p.elements.push({featureIdx:N,vertices:fe,normals:he,offset:v}),v+=St;for(var Ut=function(Rr){var Tr=(he==null?void 0:he.slice(Rr*3,Rr*3+3))||[],on=fe.slice(Rr*Be,Rr*Be+Be),Hn=0;Ge&&Ge[Rr]!==void 0&&(Hn=Ge[Rr]),n.forEach(function(di){if(di&&l[di.name]){var za;(za=di.buffer.data).push.apply(za,(0,H.Z)(l[di.name](D,N,on,Rr,Tr,Hn)))}})},Yt=0;Yt<St;Yt++)Ut(Yt)}),k.abrupt("return",{descriptors:n,featureLayout:p,indices:E});case 8:case"end":return k.stop()}},i)}));return function(t){return e.apply(this,arguments)}}(),rr=function(){var e=(0,ot.Z)(se().mark(function i(t){var n,r,o,u,l,p,v,E,w;return se().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return n=t.descriptors,r=t.features,o=t.enablePicking,u=t.shape2d,l={a_Color:ki,a_Position:Vi,filter:_a,a_vertexId:io,a_PickingColor:function(N){var V=N.id;return o?Zu(V):[0,0,0]},a_Shape:function(N){var V=N.shape,q=V===void 0?2:V,fe=u.indexOf(q);return[fe]},a_Extrude:function(N,V,q,fe){var he=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Be=fe%4*3;return[he[Be],he[Be+1],he[Be+2]]},a_Size:function(N){var V=N.size,q=V===void 0?5:V;return Array.isArray(q)?[q[0]]:[q]}},p={sizePerElement:0,elements:[]},v=0,E=[],w=3,r.forEach(function(D,N){var V=Ga(D),q=V.indices,fe=V.vertices,he=V.normals,Be=V.size,Ge=V.indexes;q.forEach(function(nr){E.push(nr+v)}),w=Be;var St=fe.length/Be;p.sizePerElement=w,p.elements.push({featureIdx:N,vertices:fe,normals:he,offset:v}),v+=St;for(var Ut=function(Rr){var Tr=(he==null?void 0:he.slice(Rr*3,Rr*3+3))||[],on=fe.slice(Rr*Be,Rr*Be+Be),Hn=0;Ge&&Ge[Rr]!==void 0&&(Hn=Ge[Rr]),n.forEach(function(di){if(di&&l[di.name]){var za;(za=di.buffer.data).push.apply(za,(0,H.Z)(l[di.name](D,N,on,Rr,Tr,Hn)))}})},Yt=0;Yt<St;Yt++)Ut(Yt)}),k.abrupt("return",{descriptors:n,featureLayout:p,indices:E});case 8:case"end":return k.stop()}},i)}));return function(t){return e.apply(this,arguments)}}(),Xn=function(){var e=(0,ot.Z)(se().mark(function i(t){var n,r,o,u,l,p,v,E;return se().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return n=t.descriptors,r=t.features,o=t.enablePicking,u={a_Color:ki,a_Position:Vi,filter:_a,a_vertexId:io,a_PickingColor:function(D){var N=D.id;return o?Zu(N):[0,0,0]}},l={sizePerElement:0,elements:[]},p=0,v=[],E=3,r.forEach(function(k,D){var N=ws(k),V=N.indices,q=N.vertices,fe=N.normals,he=N.size,Be=N.indexes;V.forEach(function(Yt){v.push(Yt+p)}),E=he;var Ge=q.length/he;l.sizePerElement=E,l.elements.push({featureIdx:D,vertices:q,normals:fe,offset:p}),p+=Ge;for(var St=function(nr){var Rr=(fe==null?void 0:fe.slice(nr*3,nr*3+3))||[],Tr=q.slice(nr*he,nr*he+he),on=0;Be&&Be[nr]!==void 0&&(on=Be[nr]),n.forEach(function(Hn){if(Hn&&u[Hn.name]){var di;(di=Hn.buffer.data).push.apply(di,(0,H.Z)(u[Hn.name](k,D,Tr,nr,Rr,on)))}})},Ut=0;Ut<Ge;Ut++)St(Ut)}),M.abrupt("return",{descriptors:n,featureLayout:l,indices:v});case 8:case"end":return M.stop()}},i)}));return function(t){return e.apply(this,arguments)}}(),Aa={pointFill:rr,line:vr,polygonFill:Xn},Ze=(0,U.Z)({},Aa);function Se(e){return pt.apply(this,arguments)}function pt(){return pt=(0,ot.Z)(se().mark(function e(i){var t,n;return se().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(t=i.workerType,n=i.data,!Ze[t]){o.next=3;break}return o.abrupt("return",Ze[t](n));case 3:return o.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(t,'" non-existent.'))));case 4:case"end":return o.stop()}},e)})),pt.apply(this,arguments)}kr(Se);var Lt=new Map;function sr(e,i){Lt.set(e,i)}function Et(e){var i=Lt.get(e);return i}var et=`var L7=function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(){r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var o=e&&e.prototype instanceof h?e:h,i=Object.create(o.prototype),a=new O(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return T()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=w(a,r);if(u){if(u===l)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=f(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(t,r,a),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function p(){}function v(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(S([])));g&&g!==e&&n.call(g,i)&&(d=g);var m=v.prototype=h.prototype=Object.create(d);function x(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,u){var s=f(t[o],t,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=f(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return p.prototype=v,s(m,"constructor",v),s(v,"constructor",p),p.displayName=s(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,s(t,u,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},x(b.prototype),s(b.prototype,a,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(m),s(m,u,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function n(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function u(t){n(a,o,i,u,s,"next",t)}function s(t){n(a,o,i,u,s,"throw",t)}u(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f(t);if(e){var o=f(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function b(t,e){return t(e={exports:{}},e.exports),e.exports}var w,E,A=function(t){return t&&t.Math==Math&&t},O=A("object"==typeof globalThis&&globalThis)||A("object"==typeof window&&window)||A("object"==typeof self&&self)||A("object"==typeof x&&x)||function(){return this}()||Function("return this")(),S=Object.defineProperty,T=function(t,e){try{S(O,t,{value:e,configurable:!0,writable:!0})}catch(r){O[t]=e}return e},k=O["__core-js_shared__"]||T("__core-js_shared__",{}),I=b((function(t){(t.exports=function(t,e){return k[t]||(k[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.25.5",mode:"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.5/LICENSE",source:"https://github.com/zloirock/core-js"})})),j=function(t){try{return!!t()}catch(t){return!0}},P=!j((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),_=Function.prototype,M=_.call,L=P&&_.bind.bind(M,M),R=function(t){return P?L(t):function(){return M.apply(t,arguments)}},C=R({}.toString),N=R("".slice),D=function(t){return N(C(t),8,-1)},F=function(t){if("Function"===D(t))return R(t)},W=function(t){return null==t},z=TypeError,B=function(t){if(W(t))throw z("Can't call method on "+t);return t},U=Object,G=function(t){return U(B(t))},H=F({}.hasOwnProperty),V=Object.hasOwn||function(t,e){return H(G(t),e)},q=0,Z=Math.random(),Y=F(1..toString),$=function(t){return"Symbol("+(void 0===t?"":t)+")_"+Y(++q+Z,36)},K="object"==typeof document&&document.all,Q={all:K,IS_HTMLDDA:void 0===K&&void 0!==K},X=Q.all,J=Q.IS_HTMLDDA?function(t){return"function"==typeof t||t===X}:function(t){return"function"==typeof t},tt=function(t){return J(t)?t:void 0},et=function(t,e){return arguments.length<2?tt(O[t]):O[t]&&O[t][e]},rt=et("navigator","userAgent")||"",nt=O.process,ot=O.Deno,it=nt&&nt.versions||ot&&ot.version,at=it&&it.v8;at&&(E=(w=at.split("."))[0]>0&&w[0]<4?1:+(w[0]+w[1])),!E&&rt&&(!(w=rt.match(/Edge\\/(\\d+)/))||w[1]>=74)&&(w=rt.match(/Chrome\\/(\\d+)/))&&(E=+w[1]);var ut=E,st=!!Object.getOwnPropertySymbols&&!j((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&ut&&ut<41})),ct=st&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ft=I("wks"),lt=O.Symbol,ht=lt&&lt.for,pt=ct?lt:lt&&lt.withoutSetter||$,vt=function(t){if(!V(ft,t)||!st&&"string"!=typeof ft[t]){var e="Symbol."+t;st&&V(lt,t)?ft[t]=lt[t]:ft[t]=ct&&ht?ht(e):pt(e)}return ft[t]},dt={};dt[vt("toStringTag")]="z";var yt="[object z]"===String(dt),gt=!j((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),mt=Q.all,xt=Q.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:J(t)||t===mt}:function(t){return"object"==typeof t?null!==t:J(t)},bt=O.document,wt=xt(bt)&&xt(bt.createElement),Et=function(t){return wt?bt.createElement(t):{}},At=!gt&&!j((function(){return 7!=Object.defineProperty(Et("div"),"a",{get:function(){return 7}}).a})),Ot=gt&&j((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),St=String,Tt=TypeError,kt=function(t){if(xt(t))return t;throw Tt(St(t)+" is not an object")},It=Function.prototype.call,jt=P?It.bind(It):function(){return It.apply(It,arguments)},Pt=F({}.isPrototypeOf),_t=Object,Mt=ct?function(t){return"symbol"==typeof t}:function(t){var e=et("Symbol");return J(e)&&Pt(e.prototype,_t(t))},Lt=String,Rt=function(t){try{return Lt(t)}catch(t){return"Object"}},Ct=TypeError,Nt=function(t){if(J(t))return t;throw Ct(Rt(t)+" is not a function")},Dt=function(t,e){var r=t[e];return W(r)?void 0:Nt(r)},Ft=TypeError,Wt=TypeError,zt=vt("toPrimitive"),Bt=function(t,e){if(!xt(t)||Mt(t))return t;var r,n=Dt(t,zt);if(n){if(void 0===e&&(e="default"),r=jt(n,t,e),!xt(r)||Mt(r))return r;throw Wt("Can't convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var r,n;if("string"===e&&J(r=t.toString)&&!xt(n=jt(r,t)))return n;if(J(r=t.valueOf)&&!xt(n=jt(r,t)))return n;if("string"!==e&&J(r=t.toString)&&!xt(n=jt(r,t)))return n;throw Ft("Can't convert object to primitive value")}(t,e)},Ut=function(t){var e=Bt(t,"string");return Mt(e)?e:e+""},Gt=TypeError,Ht=Object.defineProperty,Vt=Object.getOwnPropertyDescriptor,qt={f:gt?Ot?function(t,e,r){if(kt(t),e=Ut(e),kt(r),"function"==typeof t&&"prototype"===e&&"value"in r&&"writable"in r&&!r.writable){var n=Vt(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return Ht(t,e,r)}:Ht:function(t,e,r){if(kt(t),e=Ut(e),kt(r),At)try{return Ht(t,e,r)}catch(t){}if("get"in r||"set"in r)throw Gt("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},Zt=Function.prototype,Yt=gt&&Object.getOwnPropertyDescriptor,$t=V(Zt,"name"),Kt={EXISTS:$t,PROPER:$t&&"something"===function(){}.name,CONFIGURABLE:$t&&(!gt||gt&&Yt(Zt,"name").configurable)},Qt=F(Function.toString);J(k.inspectSource)||(k.inspectSource=function(t){return Qt(t)});var Xt,Jt,te,ee=k.inspectSource,re=O.WeakMap,ne=J(re)&&/native code/.test(String(re)),oe=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},ie=gt?function(t,e,r){return qt.f(t,e,oe(1,r))}:function(t,e,r){return t[e]=r,t},ae=I("keys"),ue=function(t){return ae[t]||(ae[t]=$(t))},se={},ce=O.TypeError,fe=O.WeakMap;if(ne||k.state){var le=k.state||(k.state=new fe);le.get=le.get,le.has=le.has,le.set=le.set,Xt=function(t,e){if(le.has(t))throw ce("Object already initialized");return e.facade=t,le.set(t,e),e},Jt=function(t){return le.get(t)||{}},te=function(t){return le.has(t)}}else{var he=ue("state");se[he]=!0,Xt=function(t,e){if(V(t,he))throw ce("Object already initialized");return e.facade=t,ie(t,he,e),e},Jt=function(t){return V(t,he)?t[he]:{}},te=function(t){return V(t,he)}}var pe={set:Xt,get:Jt,has:te,enforce:function(t){return te(t)?Jt(t):Xt(t,{})},getterFor:function(t){return function(e){var r;if(!xt(e)||(r=Jt(e)).type!==t)throw ce("Incompatible receiver, "+t+" required");return r}}},ve=b((function(t){var e=Kt.CONFIGURABLE,r=pe.enforce,n=pe.get,o=Object.defineProperty,i=gt&&!j((function(){return 8!==o((function(){}),"length",{value:8}).length})),a=String(String).split("String"),u=t.exports=function(t,n,u){"Symbol("===String(n).slice(0,7)&&(n="["+String(n).replace(/^Symbol\\(([^)]*)\\)/,"$1")+"]"),u&&u.getter&&(n="get "+n),u&&u.setter&&(n="set "+n),(!V(t,"name")||e&&t.name!==n)&&(gt?o(t,"name",{value:n,configurable:!0}):t.name=n),i&&u&&V(u,"arity")&&t.length!==u.arity&&o(t,"length",{value:u.arity});try{u&&V(u,"constructor")&&u.constructor?gt&&o(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var s=r(t);return V(s,"source")||(s.source=a.join("string"==typeof n?n:"")),t};Function.prototype.toString=u((function(){return J(this)&&n(this).source||ee(this)}),"toString")})),de=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if(J(r)&&ve(r,i,n),n.global)o?t[e]=r:T(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:qt.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},ye=vt("toStringTag"),ge=Object,me="Arguments"==D(function(){return arguments}()),xe=yt?D:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=ge(t),ye))?r:me?D(e):"Object"==(n=D(e))&&J(e.callee)?"Arguments":n},be=yt?{}.toString:function(){return"[object "+xe(this)+"]"};yt||de(Object.prototype,"toString",be,{unsafe:!0});var we={}.propertyIsEnumerable,Ee=Object.getOwnPropertyDescriptor,Ae={f:Ee&&!we.call({1:2},1)?function(t){var e=Ee(this,t);return!!e&&e.enumerable}:we},Oe=Object,Se=F("".split),Te=j((function(){return!Oe("z").propertyIsEnumerable(0)}))?function(t){return"String"==D(t)?Se(t,""):Oe(t)}:Oe,ke=function(t){return Te(B(t))},Ie=Object.getOwnPropertyDescriptor,je={f:gt?Ie:function(t,e){if(t=ke(t),e=Ut(e),At)try{return Ie(t,e)}catch(t){}if(V(t,e))return oe(!jt(Ae.f,t,e),t[e])}},Pe=Math.ceil,_e=Math.floor,Me=Math.trunc||function(t){var e=+t;return(e>0?_e:Pe)(e)},Le=function(t){var e=+t;return e!=e||0===e?0:Me(e)},Re=Math.max,Ce=Math.min,Ne=function(t,e){var r=Le(t);return r<0?Re(r+e,0):Ce(r,e)},De=Math.min,Fe=function(t){return t>0?De(Le(t),9007199254740991):0},We=function(t){return Fe(t.length)},ze=function(t){return function(e,r,n){var o,i=ke(e),a=We(i),u=Ne(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},Be={includes:ze(!0),indexOf:ze(!1)},Ue=Be.indexOf,Ge=F([].push),He=function(t,e){var r,n=ke(t),o=0,i=[];for(r in n)!V(se,r)&&V(n,r)&&Ge(i,r);for(;e.length>o;)V(n,r=e[o++])&&(~Ue(i,r)||Ge(i,r));return i},Ve=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],qe=Ve.concat("length","prototype"),Ze={f:Object.getOwnPropertyNames||function(t){return He(t,qe)}},Ye={f:Object.getOwnPropertySymbols},$e=F([].concat),Ke=et("Reflect","ownKeys")||function(t){var e=Ze.f(kt(t)),r=Ye.f;return r?$e(e,r(t)):e},Qe=function(t,e,r){for(var n=Ke(e),o=qt.f,i=je.f,a=0;a<n.length;a++){var u=n[a];V(t,u)||r&&V(r,u)||o(t,u,i(e,u))}},Xe=/#|\\.prototype\\./,Je=function(t,e){var r=er[tr(t)];return r==nr||r!=rr&&(J(e)?j(e):!!e)},tr=Je.normalize=function(t){return String(t).replace(Xe,".").toLowerCase()},er=Je.data={},rr=Je.NATIVE="N",nr=Je.POLYFILL="P",or=Je,ir=je.f,ar=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?O:c?O[u]||T(u,{}):(O[u]||{}).prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(a=ir(r,n))&&a.value:r[n],!or(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Qe(i,o)}(t.sham||o&&o.sham)&&ie(i,"sham",!0),de(r,n,i,t)}},ur="process"==D(O.process),sr=String,cr=TypeError,fr=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=F(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return kt(r),function(t){if("object"==typeof t||J(t))return t;throw cr("Can't set "+sr(t)+" as a prototype")}(n),e?t(r,n):r.__proto__=n,r}}():void 0),lr=qt.f,hr=vt("toStringTag"),pr=function(t,e,r){t&&!r&&(t=t.prototype),t&&!V(t,hr)&&lr(t,hr,{configurable:!0,value:e})},vr=vt("species"),dr=function(t){var e=et(t),r=qt.f;gt&&e&&!e[vr]&&r(e,vr,{configurable:!0,get:function(){return this}})},yr=TypeError,gr=function(t,e){if(Pt(e,t))return t;throw yr("Incorrect invocation")},mr=function(){},xr=[],br=et("Reflect","construct"),wr=/^\\s*(?:class|function)\\b/,Er=F(wr.exec),Ar=!wr.exec(mr),Or=function(t){if(!J(t))return!1;try{return br(mr,xr,t),!0}catch(t){return!1}},Sr=function(t){if(!J(t))return!1;switch(xe(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ar||!!Er(wr,ee(t))}catch(t){return!0}};Sr.sham=!0;var Tr,kr,Ir,jr,Pr=!br||j((function(){var t;return Or(Or.call)||!Or(Object)||!Or((function(){t=!0}))||t}))?Sr:Or,_r=TypeError,Mr=function(t){if(Pr(t))return t;throw _r(Rt(t)+" is not a constructor")},Lr=vt("species"),Rr=function(t,e){var r,n=kt(t).constructor;return void 0===n||W(r=kt(n)[Lr])?e:Mr(r)},Cr=Function.prototype,Nr=Cr.apply,Dr=Cr.call,Fr="object"==typeof Reflect&&Reflect.apply||(P?Dr.bind(Nr):function(){return Dr.apply(Nr,arguments)}),Wr=F(F.bind),zr=function(t,e){return Nt(t),void 0===e?t:P?Wr(t,e):function(){return t.apply(e,arguments)}},Br=et("document","documentElement"),Ur=F([].slice),Gr=TypeError,Hr=function(t,e){if(t<e)throw Gr("Not enough arguments");return t},Vr=/(?:ipad|iphone|ipod).*applewebkit/i.test(rt),qr=O.setImmediate,Zr=O.clearImmediate,Yr=O.process,$r=O.Dispatch,Kr=O.Function,Qr=O.MessageChannel,Xr=O.String,Jr=0,tn={};try{Tr=O.location}catch(t){}var en=function(t){if(V(tn,t)){var e=tn[t];delete tn[t],e()}},rn=function(t){return function(){en(t)}},nn=function(t){en(t.data)},on=function(t){O.postMessage(Xr(t),Tr.protocol+"//"+Tr.host)};qr&&Zr||(qr=function(t){Hr(arguments.length,1);var e=J(t)?t:Kr(t),r=Ur(arguments,1);return tn[++Jr]=function(){Fr(e,void 0,r)},kr(Jr),Jr},Zr=function(t){delete tn[t]},ur?kr=function(t){Yr.nextTick(rn(t))}:$r&&$r.now?kr=function(t){$r.now(rn(t))}:Qr&&!Vr?(jr=(Ir=new Qr).port2,Ir.port1.onmessage=nn,kr=zr(jr.postMessage,jr)):O.addEventListener&&J(O.postMessage)&&!O.importScripts&&Tr&&"file:"!==Tr.protocol&&!j(on)?(kr=on,O.addEventListener("message",nn,!1)):kr="onreadystatechange"in Et("script")?function(t){Br.appendChild(Et("script")).onreadystatechange=function(){Br.removeChild(this),en(t)}}:function(t){setTimeout(rn(t),0)});var an,un,sn,cn,fn,ln,hn,pn,vn={set:qr,clear:Zr},dn=/ipad|iphone|ipod/i.test(rt)&&void 0!==O.Pebble,yn=/web0s(?!.*chrome)/i.test(rt),gn=je.f,mn=vn.set,xn=O.MutationObserver||O.WebKitMutationObserver,bn=O.document,wn=O.process,En=O.Promise,An=gn(O,"queueMicrotask"),On=An&&An.value;On||(an=function(){var t,e;for(ur&&(t=wn.domain)&&t.exit();un;){e=un.fn,un=un.next;try{e()}catch(t){throw un?cn():sn=void 0,t}}sn=void 0,t&&t.enter()},Vr||ur||yn||!xn||!bn?!dn&&En&&En.resolve?((hn=En.resolve(void 0)).constructor=En,pn=zr(hn.then,hn),cn=function(){pn(an)}):ur?cn=function(){wn.nextTick(an)}:(mn=zr(mn,O),cn=function(){mn(an)}):(fn=!0,ln=bn.createTextNode(""),new xn(an).observe(ln,{characterData:!0}),cn=function(){ln.data=fn=!fn}));var Sn=On||function(t){var e={fn:t,next:void 0};sn&&(sn.next=e),un||(un=e,cn()),sn=e},Tn=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},kn=function(){this.head=null,this.tail=null};kn.prototype={add:function(t){var e={item:t,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var In,jn,Pn,_n=kn,Mn=O.Promise,Ln="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Rn=!Ln&&!ur&&"object"==typeof window&&"object"==typeof document,Cn=(Mn&&Mn.prototype,vt("species")),Nn=!1,Dn=J(O.PromiseRejectionEvent),Fn={CONSTRUCTOR:or("Promise",(function(){var t=ee(Mn),e=t!==String(Mn);if(!e&&66===ut)return!0;if(!ut||ut<51||!/native code/.test(t)){var r=new Mn((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[Cn]=n,!(Nn=r.then((function(){}))instanceof n))return!0}return!e&&(Rn||Ln)&&!Dn})),REJECTION_EVENT:Dn,SUBCLASSING:Nn},Wn=TypeError,zn=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw Wn("Bad Promise constructor");e=t,r=n})),this.resolve=Nt(e),this.reject=Nt(r)},Bn={f:function(t){return new zn(t)}},Un=vn.set,Gn=Fn.CONSTRUCTOR,Hn=Fn.REJECTION_EVENT,Vn=Fn.SUBCLASSING,qn=pe.getterFor("Promise"),Zn=pe.set,Yn=Mn&&Mn.prototype,$n=Mn,Kn=Yn,Qn=O.TypeError,Xn=O.document,Jn=O.process,to=Bn.f,eo=to,ro=!!(Xn&&Xn.createEvent&&O.dispatchEvent),no=function(t){var e;return!(!xt(t)||!J(e=t.then))&&e},oo=function(t,e){var r,n,o,i=e.value,a=1==e.state,u=a?t.ok:t.fail,s=t.resolve,c=t.reject,f=t.domain;try{u?(a||(2===e.rejection&&co(e),e.rejection=1),!0===u?r=i:(f&&f.enter(),r=u(i),f&&(f.exit(),o=!0)),r===t.promise?c(Qn("Promise-chain cycle")):(n=no(r))?jt(n,r,s,c):s(r)):c(i)}catch(t){f&&!o&&f.exit(),c(t)}},io=function(t,e){t.notified||(t.notified=!0,Sn((function(){for(var r,n=t.reactions;r=n.get();)oo(r,t);t.notified=!1,e&&!t.rejection&&uo(t)})))},ao=function(t,e,r){var n,o;ro?((n=Xn.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),O.dispatchEvent(n)):n={promise:e,reason:r},!Hn&&(o=O["on"+t])?o(n):"unhandledrejection"===t&&function(t,e){var r=O.console;r&&r.error&&(1==arguments.length?r.error(t):r.error(t,e))}("Unhandled promise rejection",r)},uo=function(t){jt(Un,O,(function(){var e,r=t.facade,n=t.value;if(so(t)&&(e=Tn((function(){ur?Jn.emit("unhandledRejection",n,r):ao("unhandledrejection",r,n)})),t.rejection=ur||so(t)?2:1,e.error))throw e.value}))},so=function(t){return 1!==t.rejection&&!t.parent},co=function(t){jt(Un,O,(function(){var e=t.facade;ur?Jn.emit("rejectionHandled",e):ao("rejectionhandled",e,t.value)}))},fo=function(t,e,r){return function(n){t(e,n,r)}},lo=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,io(t,!0))},ho=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw Qn("Promise can't be resolved itself");var n=no(e);n?Sn((function(){var r={done:!1};try{jt(n,e,fo(ho,r,t),fo(lo,r,t))}catch(e){lo(r,e,t)}})):(t.value=e,t.state=1,io(t,!1))}catch(e){lo({done:!1},e,t)}}};if(Gn&&(Kn=($n=function(t){gr(this,Kn),Nt(t),jt(In,this);var e=qn(this);try{t(fo(ho,e),fo(lo,e))}catch(t){lo(e,t)}}).prototype,(In=function(t){Zn(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new _n,rejection:!1,state:0,value:void 0})}).prototype=de(Kn,"then",(function(t,e){var r=qn(this),n=to(Rr(this,$n));return r.parent=!0,n.ok=!J(t)||t,n.fail=J(e)&&e,n.domain=ur?Jn.domain:void 0,0==r.state?r.reactions.add(n):Sn((function(){oo(n,r)})),n.promise})),jn=function(){var t=new In,e=qn(t);this.promise=t,this.resolve=fo(ho,e),this.reject=fo(lo,e)},Bn.f=to=function(t){return t===$n||void 0===t?new jn(t):eo(t)},J(Mn)&&Yn!==Object.prototype)){Pn=Yn.then,Vn||de(Yn,"then",(function(t,e){var r=this;return new $n((function(t,e){jt(Pn,r,t,e)})).then(t,e)}),{unsafe:!0});try{delete Yn.constructor}catch(t){}fr&&fr(Yn,Kn)}ar({global:!0,constructor:!0,wrap:!0,forced:Gn},{Promise:$n}),pr($n,"Promise",!1),dr("Promise");var po={},vo=vt("iterator"),yo=Array.prototype,go=function(t){return void 0!==t&&(po.Array===t||yo[vo]===t)},mo=vt("iterator"),xo=function(t){if(!W(t))return Dt(t,mo)||Dt(t,"@@iterator")||po[xe(t)]},bo=TypeError,wo=function(t,e){var r=arguments.length<2?xo(t):e;if(Nt(r))return kt(jt(r,t));throw bo(Rt(t)+" is not iterable")},Eo=function(t,e,r){var n,o;kt(t);try{if(!(n=Dt(t,"return"))){if("throw"===e)throw r;return r}n=jt(n,t)}catch(t){o=!0,n=t}if("throw"===e)throw r;if(o)throw n;return kt(n),r},Ao=TypeError,Oo=function(t,e){this.stopped=t,this.result=e},So=Oo.prototype,To=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),d=zr(e,f),y=function(t){return n&&Eo(n,"normal",t),new Oo(!0,t)},g=function(t){return l?(kt(t),v?d(t[0],t[1],y):d(t[0],t[1])):v?d(t,y):d(t)};if(h)n=t.iterator;else if(p)n=t;else{if(!(o=xo(t)))throw Ao(Rt(t)+" is not iterable");if(go(o)){for(i=0,a=We(t);a>i;i++)if((u=g(t[i]))&&Pt(So,u))return u;return new Oo(!1)}n=wo(t,o)}for(s=h?t.next:n.next;!(c=jt(s,n)).done;){try{u=g(c.value)}catch(t){Eo(n,"throw",t)}if("object"==typeof u&&u&&Pt(So,u))return u}return new Oo(!1)},ko=vt("iterator"),Io=!1;try{var jo=0,Po={next:function(){return{done:!!jo++}},return:function(){Io=!0}};Po[ko]=function(){return this},Array.from(Po,(function(){throw 2}))}catch(t){}var _o=function(t,e){if(!e&&!Io)return!1;var r=!1;try{var n={};n[ko]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},Mo=Fn.CONSTRUCTOR||!_o((function(t){Mn.all(t).then(void 0,(function(){}))}));ar({target:"Promise",stat:!0,forced:Mo},{all:function(t){var e=this,r=Bn.f(e),n=r.resolve,o=r.reject,i=Tn((function(){var r=Nt(e.resolve),i=[],a=0,u=1;To(t,(function(t){var s=a++,c=!1;u++,jt(r,e,t).then((function(t){c||(c=!0,i[s]=t,--u||n(i))}),o)})),--u||n(i)}));return i.error&&o(i.value),r.promise}});var Lo=Fn.CONSTRUCTOR,Ro=Mn&&Mn.prototype;if(ar({target:"Promise",proto:!0,forced:Lo,real:!0},{catch:function(t){return this.then(void 0,t)}}),J(Mn)){var Co=et("Promise").prototype.catch;Ro.catch!==Co&&de(Ro,"catch",Co,{unsafe:!0})}ar({target:"Promise",stat:!0,forced:Mo},{race:function(t){var e=this,r=Bn.f(e),n=r.reject,o=Tn((function(){var o=Nt(e.resolve);To(t,(function(t){jt(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}}),ar({target:"Promise",stat:!0,forced:Fn.CONSTRUCTOR},{reject:function(t){var e=Bn.f(this);return jt(e.reject,void 0,t),e.promise}});var No=Fn.CONSTRUCTOR;et("Promise");function Do(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}ar({target:"Promise",stat:!0,forced:No},{resolve:function(t){return function(t,e){if(kt(t),xt(e)&&e.constructor===t)return e;var r=Bn.f(t);return(0,r.resolve)(e),r.promise}(this,t)}});var Fo="undefined"!=typeof window&&void 0!==window.orientation,Wo=function(){function t(t,e){var r=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){r.resolve=t,r.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),zo=new Map;function Bo(t){Do(t.source&&!t.url||!t.source&&t.url);var e=zo.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return Uo((e=t,"try {\\n  importScripts('"+e+"');\\n} catch (error) {\\n  console.error(error);\\n  throw error;\\n}"));var e}(t.url),zo.set(t.url,e)),t.source&&(e=Uo(t.source),zo.set(t.source,e))),Do(e),e}function Uo(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Go(t,e,r){void 0===e&&(e=!0);var n=r||new Set;if(t){if(Ho(t))n.add(t);else if(Ho(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var o in t)Go(t[o],e,n)}else;return void 0===r?Array.from(n):[]}function Ho(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var Vo=function(){},qo=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,r=t.source,n=t.url;Do(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=Vo,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=Vo,this.onError=Vo,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||Go(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=Bo({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e},t}(),Zo=self&&self.__assign||function(){return(Zo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Yo=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},$o=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Ko=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=Zo(Zo({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,r){return void 0===e&&(e=function(t,e,r){return t.done(r)}),void 0===r&&(r=function(t,e){return t.error(e)}),Yo(this,void 0,void 0,(function(){var n,o=this;return $o(this,(function(i){switch(i.label){case 0:return n=new Promise((function(n){return o.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),o})),this.startQueuedJob(),[4,n];case 1:return[2,i.sent()]}}))}))},t.prototype.startQueuedJob=function(){return Yo(this,void 0,void 0,(function(){var t,e,r;return $o(this,(function(n){switch(n.label){case 0:if(!this.jobQueue.length)return[2];if(!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),r=new Wo(e.name,t),t.onMessage=function(t){return e.onMessage(r,t.type,t.payload)},t.onError=function(t){return e.onError(r,t)},e.onStart(r),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,r.result];case 2:return n.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new qo({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return Fo?this.maxMobileConcurrency:this.maxConcurrency},t}(),Qo=self&&self.__assign||function(){return(Qo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Xo=self&&self.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Jo={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ti=(function(){function t(t){this.workerPools=new Map,this.props=Qo({},Jo),this.setProps(t),this.workerPools=new Map}t.isSupported=function(){return qo.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var r=Xo(this.workerPools.values()),n=r.next();!n.done;n=r.next()){n.value.destroy()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,r;this.props=Qo(Qo({},this.props),t);try{for(var n=Xo(this.workerPools.values()),o=n.next();!o.done;o=n.next()){o.value.setProps(this.getWorkerPoolProps())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,r=t.source,n=t.url,o=this.workerPools.get(e);return o||((o=new Ko({name:e,source:r,url:n})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,o)),o},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),ei=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=ti.get(t);e||(e=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=ti.get(t);ti.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var r={source:"Worker thread",type:t,payload:e},n=Go(e);self.postMessage(r,n)}},t}();function ri(t){var e=t.type,r=t.data;return"message"===e&&r&&"string"==typeof r.source&&"Main thread"===r.source}self&&self.__awaiter,self&&self.__generator;var ni,oi,ii=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,r){t._settlers.push({resolve:e,reject:r})}))},t}(),ai=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},ui=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},si=self&&self.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,o){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,o,(e=t[r](e)).done,e.value)}))}}},ci=0;function fi(t,e){var r=this;if("undefined"!=typeof self){var n={process:li};ei.onmessage=function(o,i){return ai(r,void 0,void 0,(function(){var r,a,u,s,c,f,l,h,p,v;return ui(this,(function(d){switch(d.label){case 0:switch(d.trys.push([0,19,,20]),o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(i.input,i.options||{},n)];case 2:return r=d.sent(),ei.postMessage("done",{result:r}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");ni=new ii,oi=i.options||{},a=e(ni,oi,n),d.label=4;case 4:d.trys.push([4,9,10,15]),u=si(a),d.label=5;case 5:return[4,u.next()];case 6:if((s=d.sent()).done)return[3,8];c=s.value,ei.postMessage("output-batch",{result:c}),d.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return f=d.sent(),p={error:f},[3,15];case 10:return d.trys.push([10,,13,14]),s&&!s.done&&(v=u.return)?[4,v.call(u)]:[3,12];case 11:d.sent(),d.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return ei.postMessage("done",{}),[3,18];case 16:return ni.push(i.input),[3,18];case 17:return ni.close(),[3,18];case 18:return[3,20];case 19:return l=d.sent(),h=l instanceof Error?l.message:"",ei.postMessage("error",{error:h}),[3,20];case 20:return[2]}}))}))}}}function li(t,e){return void 0===e&&(e={}),new Promise((function(r,n){var o=ci++,i=function(t,e){if(e.id===o)switch(t){case"done":ei.removeEventListener(i),r(e.result);break;case"error":ei.removeEventListener(i),n(e.error)}};ei.addEventListener(i);var a={id:o,input:t,options:e};ei.postMessage("process",a)}))}self&&self.__awaiter,self&&self.__generator;var hi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},pi=Et("span").classList,vi=pi&&pi.constructor&&pi.constructor.prototype,di=vi===Object.prototype?void 0:vi,yi=Array.isArray||function(t){return"Array"==D(t)},gi=vt("species"),mi=Array,xi=function(t,e){return new(function(t){var e;return yi(t)&&(e=t.constructor,(Pr(e)&&(e===mi||yi(e.prototype))||xt(e)&&null===(e=e[gi]))&&(e=void 0)),void 0===e?mi:e}(t))(0===e?0:e)},bi=F([].push),wi=function(t){var e=1==t,r=2==t,n=3==t,o=4==t,i=6==t,a=7==t,u=5==t||i;return function(s,c,f,l){for(var h,p,v=G(s),d=Te(v),y=zr(c,f),g=We(d),m=0,x=l||xi,b=e?x(s,g):r||a?x(s,0):void 0;g>m;m++)if((u||m in d)&&(p=y(h=d[m],m,v),t))if(e)b[m]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return m;case 2:bi(b,h)}else switch(t){case 4:return!1;case 7:bi(b,h)}return i?-1:n||o?o:b}},Ei={forEach:wi(0),map:wi(1),filter:wi(2),some:wi(3),every:wi(4),find:wi(5),findIndex:wi(6),filterReject:wi(7)},Ai=function(t,e){var r=[][t];return!!r&&j((function(){r.call(null,e||function(){return 1},1)}))},Oi=Ei.forEach,Si=Ai("forEach")?[].forEach:function(t){return Oi(this,t,arguments.length>1?arguments[1]:void 0)},Ti=function(t){if(t&&t.forEach!==Si)try{ie(t,"forEach",Si)}catch(e){t.forEach=Si}};for(var ki in hi)hi[ki]&&Ti(O[ki]&&O[ki].prototype);Ti(di);var Ii=function(t,e,r){var n=Ut(e);n in t?qt.f(t,n,oe(0,r)):t[n]=r},ji=vt("species"),Pi=function(t){return ut>=51||!j((function(){var e=[];return(e.constructor={})[ji]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},_i=Pi("slice"),Mi=vt("species"),Li=Array,Ri=Math.max;ar({target:"Array",proto:!0,forced:!_i},{slice:function(t,e){var r,n,o,i=ke(this),a=We(i),u=Ne(t,a),s=Ne(void 0===e?a:e,a);if(yi(i)&&(r=i.constructor,(Pr(r)&&(r===Li||yi(r.prototype))||xt(r)&&null===(r=r[Mi]))&&(r=void 0),r===Li||void 0===r))return Ur(i,u,s);for(n=new(void 0===r?Li:r)(Ri(s-u,0)),o=0;u<s;u++,o++)u in i&&Ii(n,o,i[u]);return n.length=o,n}});var Ci=Kt.EXISTS,Ni=qt.f,Di=Function.prototype,Fi=F(Di.toString),Wi=/function\\b(?:\\s|\\/\\*[\\S\\s]*?\\*\\/|\\/\\/[^\\n\\r]*[\\n\\r]+)*([^\\s(/]*)/,zi=F(Wi.exec);gt&&!Ci&&Ni(Di,"name",{configurable:!0,get:function(){try{return zi(Wi,Fi(this))[1]}catch(t){return""}}});var Bi=Ei.map,Ui=Pi("map");ar({target:"Array",proto:!0,forced:!Ui},{map:function(t){return Bi(this,t,arguments.length>1?arguments[1]:void 0)}});var Gi,Hi=Object.keys||function(t){return He(t,Ve)},Vi={f:gt&&!Ot?Object.defineProperties:function(t,e){kt(t);for(var r,n=ke(e),o=Hi(e),i=o.length,a=0;i>a;)qt.f(t,r=o[a++],n[r]);return t}},qi=ue("IE_PROTO"),Zi=function(){},Yi=function(t){return"<script>"+t+"<\\/script>"},$i=function(t){t.write(Yi("")),t.close();var e=t.parentWindow.Object;return t=null,e},Ki=function(){try{Gi=new ActiveXObject("htmlfile")}catch(t){}var t,e;Ki="undefined"!=typeof document?document.domain&&Gi?$i(Gi):((e=Et("iframe")).style.display="none",Br.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(Yi("document.F=Object")),t.close(),t.F):$i(Gi);for(var r=Ve.length;r--;)delete Ki.prototype[Ve[r]];return Ki()};se[qi]=!0;var Qi=Object.create||function(t,e){var r;return null!==t?(Zi.prototype=kt(t),r=new Zi,Zi.prototype=null,r[qi]=t):r=Ki(),void 0===e?r:Vi.f(r,e)},Xi=qt.f,Ji=vt("unscopables"),ta=Array.prototype;null==ta[Ji]&&Xi(ta,Ji,{configurable:!0,value:Qi(null)});var ea,ra,na,oa=function(t){ta[Ji][t]=!0},ia=!j((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),aa=ue("IE_PROTO"),ua=Object,sa=ua.prototype,ca=ia?ua.getPrototypeOf:function(t){var e=G(t);if(V(e,aa))return e[aa];var r=e.constructor;return J(r)&&e instanceof r?r.prototype:e instanceof ua?sa:null},fa=vt("iterator"),la=!1;[].keys&&("next"in(na=[].keys())?(ra=ca(ca(na)))!==Object.prototype&&(ea=ra):la=!0),(!xt(ea)||j((function(){var t={};return ea[fa].call(t)!==t})))&&(ea={}),J(ea[fa])||de(ea,fa,(function(){return this}));var ha={IteratorPrototype:ea,BUGGY_SAFARI_ITERATORS:la},pa=ha.IteratorPrototype,va=function(){return this},da=Kt.PROPER,ya=Kt.CONFIGURABLE,ga=ha.IteratorPrototype,ma=ha.BUGGY_SAFARI_ITERATORS,xa=vt("iterator"),ba=function(){return this},wa=function(t,e,r,n,o,i,a){!function(t,e,r,n){var o=e+" Iterator";t.prototype=Qi(pa,{next:oe(+!n,r)}),pr(t,o,!1),po[o]=va}(r,e,n);var u,s,c,f=function(t){if(t===o&&d)return d;if(!ma&&t in p)return p[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},l=e+" Iterator",h=!1,p=t.prototype,v=p[xa]||p["@@iterator"]||o&&p[o],d=!ma&&v||f(o),y="Array"==e&&p.entries||v;if(y&&(u=ca(y.call(new t)))!==Object.prototype&&u.next&&(ca(u)!==ga&&(fr?fr(u,ga):J(u[xa])||de(u,xa,ba)),pr(u,l,!0)),da&&"values"==o&&v&&"values"!==v.name&&(ya?ie(p,"name","values"):(h=!0,d=function(){return jt(v,this)})),o)if(s={values:f("values"),keys:i?d:f("keys"),entries:f("entries")},a)for(c in s)(ma||h||!(c in p))&&de(p,c,s[c]);else ar({target:e,proto:!0,forced:ma||h},s);return p[xa]!==d&&de(p,xa,d,{name:o}),po[e]=d,s},Ea=function(t,e){return{value:t,done:e}},Aa=qt.f,Oa=pe.set,Sa=pe.getterFor("Array Iterator"),Ta=wa(Array,"Array",(function(t,e){Oa(this,{type:"Array Iterator",target:ke(t),index:0,kind:e})}),(function(){var t=Sa(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,Ea(void 0,!0)):Ea("keys"==r?n:"values"==r?e[n]:[n,e[n]],!1)}),"values"),ka=po.Arguments=po.Array;if(oa("keys"),oa("values"),oa("entries"),gt&&"values"!==ka.name)try{Aa(ka,"name",{value:"values"})}catch(t){}var Ia,ja,Pa,_a="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Ma=qt.f,La=pe.enforce,Ra=pe.get,Ca=O.Int8Array,Na=Ca&&Ca.prototype,Da=O.Uint8ClampedArray,Fa=Da&&Da.prototype,Wa=Ca&&ca(Ca),za=Na&&ca(Na),Ba=Object.prototype,Ua=O.TypeError,Ga=vt("toStringTag"),Ha=$("TYPED_ARRAY_TAG"),Va=_a&&!!fr&&"Opera"!==xe(O.opera),qa=!1,Za={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ya={BigInt64Array:8,BigUint64Array:8},$a=function(t){var e=ca(t);if(xt(e)){var r=Ra(e);return r&&V(r,"TypedArrayConstructor")?r.TypedArrayConstructor:$a(e)}},Ka=function(t){if(!xt(t))return!1;var e=xe(t);return V(Za,e)||V(Ya,e)};for(Ia in Za)(Pa=(ja=O[Ia])&&ja.prototype)?La(Pa).TypedArrayConstructor=ja:Va=!1;for(Ia in Ya)(Pa=(ja=O[Ia])&&ja.prototype)&&(La(Pa).TypedArrayConstructor=ja);if((!Va||!J(Wa)||Wa===Function.prototype)&&(Wa=function(){throw Ua("Incorrect invocation")},Va))for(Ia in Za)O[Ia]&&fr(O[Ia],Wa);if((!Va||!za||za===Ba)&&(za=Wa.prototype,Va))for(Ia in Za)O[Ia]&&fr(O[Ia].prototype,za);if(Va&&ca(Fa)!==za&&fr(Fa,za),gt&&!V(za,Ga))for(Ia in qa=!0,Ma(za,Ga,{get:function(){return xt(this)?this[Ha]:void 0}}),Za)O[Ia]&&ie(O[Ia],Ha,Ia);var Qa={NATIVE_ARRAY_BUFFER_VIEWS:Va,TYPED_ARRAY_TAG:qa&&Ha,aTypedArray:function(t){if(Ka(t))return t;throw Ua("Target is not a typed array")},aTypedArrayConstructor:function(t){if(J(t)&&(!fr||Pt(Wa,t)))return t;throw Ua(Rt(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(gt){if(r)for(var o in Za){var i=O[o];if(i&&V(i.prototype,t))try{delete i.prototype[t]}catch(r){try{i.prototype[t]=e}catch(t){}}}za[t]&&!r||de(za,t,r?e:Va&&Na[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(gt){if(fr){if(r)for(n in Za)if((o=O[n])&&V(o,t))try{delete o[t]}catch(t){}if(Wa[t]&&!r)return;try{return de(Wa,t,r?e:Va&&Wa[t]||e)}catch(t){}}for(n in Za)!(o=O[n])||o[t]&&!r||de(o,t,e)}},getTypedArrayConstructor:$a,isView:function(t){if(!xt(t))return!1;var e=xe(t);return"DataView"===e||V(Za,e)||V(Ya,e)},isTypedArray:Ka,TypedArray:Wa,TypedArrayPrototype:za},Xa=Qa.NATIVE_ARRAY_BUFFER_VIEWS,Ja=O.ArrayBuffer,tu=O.Int8Array,eu=!Xa||!j((function(){tu(1)}))||!j((function(){new tu(-1)}))||!_o((function(t){new tu,new tu(null),new tu(1.5),new tu(t)}),!0)||j((function(){return 1!==new tu(new Ja(2),1,void 0).length})),ru=function(t,e,r){for(var n in e)de(t,n,e[n],r);return t},nu=RangeError,ou=function(t){if(void 0===t)return 0;var e=Le(t),r=Fe(e);if(e!==r)throw nu("Wrong length or index");return r},iu=Array,au=Math.abs,uu=Math.pow,su=Math.floor,cu=Math.log,fu=Math.LN2,lu=function(t,e,r){var n,o,i,a=iu(r),u=8*r-e-1,s=(1<<u)-1,c=s>>1,f=23===e?uu(2,-24)-uu(2,-77):0,l=t<0||0===t&&1/t<0?1:0,h=0;for((t=au(t))!=t||t===1/0?(o=t!=t?1:0,n=s):(n=su(cu(t)/fu),t*(i=uu(2,-n))<1&&(n--,i*=2),(t+=n+c>=1?f/i:f*uu(2,1-c))*i>=2&&(n++,i/=2),n+c>=s?(o=0,n=s):n+c>=1?(o=(t*i-1)*uu(2,e),n+=c):(o=t*uu(2,c-1)*uu(2,e),n=0));e>=8;)a[h++]=255&o,o/=256,e-=8;for(n=n<<e|o,u+=e;u>0;)a[h++]=255&n,n/=256,u-=8;return a[--h]|=128*l,a},hu=function(t,e){var r,n=t.length,o=8*n-e-1,i=(1<<o)-1,a=i>>1,u=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;u>0;)f=256*f+t[s--],u-=8;for(r=f&(1<<-u)-1,f>>=-u,u+=e;u>0;)r=256*r+t[s--],u-=8;if(0===f)f=1-a;else{if(f===i)return r?NaN:c?-1/0:1/0;r+=uu(2,e),f-=a}return(c?-1:1)*r*uu(2,f-e)},pu=function(t){for(var e=G(this),r=We(e),n=arguments.length,o=Ne(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,a=void 0===i?r:Ne(i,r);a>o;)e[o++]=t;return e},vu=Array,du=Math.max,yu=function(t,e,r){for(var n=We(t),o=Ne(e,n),i=Ne(void 0===r?n:r,n),a=vu(du(i-o,0)),u=0;o<i;o++,u++)Ii(a,u,t[o]);return a.length=u,a},gu=Ze.f,mu=qt.f,xu=Kt.PROPER,bu=Kt.CONFIGURABLE,wu=pe.get,Eu=pe.set,Au=O.ArrayBuffer,Ou=Au,Su=Ou&&Ou.prototype,Tu=O.DataView,ku=Tu&&Tu.prototype,Iu=Object.prototype,ju=O.Array,Pu=O.RangeError,_u=F(pu),Mu=F([].reverse),Lu=lu,Ru=hu,Cu=function(t){return[255&t]},Nu=function(t){return[255&t,t>>8&255]},Du=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Fu=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Wu=function(t){return Lu(t,23,4)},zu=function(t){return Lu(t,52,8)},Bu=function(t,e){mu(t.prototype,e,{get:function(){return wu(this)[e]}})},Uu=function(t,e,r,n){var o=ou(r),i=wu(t);if(o+e>i.byteLength)throw Pu("Wrong index");var a=wu(i.buffer).bytes,u=o+i.byteOffset,s=yu(a,u,u+e);return n?s:Mu(s)},Gu=function(t,e,r,n,o,i){var a=ou(r),u=wu(t);if(a+e>u.byteLength)throw Pu("Wrong index");for(var s=wu(u.buffer).bytes,c=a+u.byteOffset,f=n(+o),l=0;l<e;l++)s[c+l]=f[i?l:e-l-1]};if(_a){var Hu=xu&&"ArrayBuffer"!==Au.name;if(j((function(){Au(1)}))&&j((function(){new Au(-1)}))&&!j((function(){return new Au,new Au(1.5),new Au(NaN),1!=Au.length||Hu&&!bu})))Hu&&bu&&ie(Au,"name","ArrayBuffer");else{(Ou=function(t){return gr(this,Su),new Au(ou(t))}).prototype=Su;for(var Vu,qu=gu(Au),Zu=0;qu.length>Zu;)(Vu=qu[Zu++])in Ou||ie(Ou,Vu,Au[Vu]);Su.constructor=Ou}fr&&ca(ku)!==Iu&&fr(ku,Iu);var Yu=new Tu(new Ou(2)),$u=F(ku.setInt8);Yu.setInt8(0,2147483648),Yu.setInt8(1,2147483649),!Yu.getInt8(0)&&Yu.getInt8(1)||ru(ku,{setInt8:function(t,e){$u(this,t,e<<24>>24)},setUint8:function(t,e){$u(this,t,e<<24>>24)}},{unsafe:!0})}else Su=(Ou=function(t){gr(this,Su);var e=ou(t);Eu(this,{bytes:_u(ju(e),0),byteLength:e}),gt||(this.byteLength=e)}).prototype,ku=(Tu=function(t,e,r){gr(this,ku),gr(t,Su);var n=wu(t).byteLength,o=Le(e);if(o<0||o>n)throw Pu("Wrong offset");if(o+(r=void 0===r?n-o:Fe(r))>n)throw Pu("Wrong length");Eu(this,{buffer:t,byteLength:r,byteOffset:o}),gt||(this.buffer=t,this.byteLength=r,this.byteOffset=o)}).prototype,gt&&(Bu(Ou,"byteLength"),Bu(Tu,"buffer"),Bu(Tu,"byteLength"),Bu(Tu,"byteOffset")),ru(ku,{getInt8:function(t){return Uu(this,1,t)[0]<<24>>24},getUint8:function(t){return Uu(this,1,t)[0]},getInt16:function(t){var e=Uu(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Uu(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Fu(Uu(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return Fu(Uu(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return Ru(Uu(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return Ru(Uu(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){Gu(this,1,t,Cu,e)},setUint8:function(t,e){Gu(this,1,t,Cu,e)},setInt16:function(t,e){Gu(this,2,t,Nu,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){Gu(this,2,t,Nu,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){Gu(this,4,t,Du,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){Gu(this,4,t,Du,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){Gu(this,4,t,Wu,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){Gu(this,8,t,zu,e,arguments.length>2?arguments[2]:void 0)}});pr(Ou,"ArrayBuffer"),pr(Tu,"DataView");var Ku={ArrayBuffer:Ou,DataView:Tu},Qu=Math.floor,Xu=Number.isInteger||function(t){return!xt(t)&&isFinite(t)&&Qu(t)===t},Ju=RangeError,ts=RangeError,es=function(t,e){var r=function(t){var e=Le(t);if(e<0)throw Ju("The argument can't be less than 0");return e}(t);if(r%e)throw ts("Wrong offset");return r},rs=F("".slice),ns=function(t){return"Big"===rs(xe(t),0,3)},os=TypeError,is=function(t){var e=Bt(t,"number");if("number"==typeof e)throw os("Can't convert number to bigint");return BigInt(e)},as=Qa.aTypedArrayConstructor,us=function(t){var e,r,n,o,i,a,u,s,c=Mr(this),f=G(t),l=arguments.length,h=l>1?arguments[1]:void 0,p=void 0!==h,v=xo(f);if(v&&!go(v))for(s=(u=wo(f,v)).next,f=[];!(a=jt(s,u)).done;)f.push(a.value);for(p&&l>2&&(h=zr(h,arguments[2])),r=We(f),n=new(as(c))(r),o=ns(n),e=0;r>e;e++)i=p?h(f[e],e):f[e],n[e]=o?is(i):+i;return n},ss=function(t,e,r){var n,o;return fr&&J(n=e.constructor)&&n!==r&&xt(o=n.prototype)&&o!==r.prototype&&fr(t,o),t},cs=b((function(t){var e=Ze.f,r=Ei.forEach,n=pe.get,o=pe.set,i=pe.enforce,a=qt.f,u=je.f,s=Math.round,c=O.RangeError,f=Ku.ArrayBuffer,l=f.prototype,h=Ku.DataView,p=Qa.NATIVE_ARRAY_BUFFER_VIEWS,v=Qa.TYPED_ARRAY_TAG,d=Qa.TypedArray,y=Qa.TypedArrayPrototype,g=Qa.aTypedArrayConstructor,m=Qa.isTypedArray,x=function(t,e){g(t);for(var r=0,n=e.length,o=new t(n);n>r;)o[r]=e[r++];return o},b=function(t,e){a(t,e,{get:function(){return n(this)[e]}})},w=function(t){var e;return Pt(l,t)||"ArrayBuffer"==(e=xe(t))||"SharedArrayBuffer"==e},E=function(t,e){return m(t)&&!Mt(e)&&e in t&&Xu(+e)&&e>=0},A=function(t,e){return e=Ut(e),E(t,e)?oe(2,t[e]):u(t,e)},S=function(t,e,r){return e=Ut(e),!(E(t,e)&&xt(r)&&V(r,"value"))||V(r,"get")||V(r,"set")||r.configurable||V(r,"writable")&&!r.writable||V(r,"enumerable")&&!r.enumerable?a(t,e,r):(t[e]=r.value,t)};gt?(p||(je.f=A,qt.f=S,b(y,"buffer"),b(y,"byteOffset"),b(y,"byteLength"),b(y,"length")),ar({target:"Object",stat:!0,forced:!p},{getOwnPropertyDescriptor:A,defineProperty:S}),t.exports=function(t,u,l){var g=t.match(/\\d+$/)[0]/8,b=t+(l?"Clamped":"")+"Array",E="get"+t,A="set"+t,S=O[b],T=S,k=T&&T.prototype,I={},j=function(t,e){a(t,e,{get:function(){return function(t,e){var r=n(t);return r.view[E](e*g+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,r){var o=n(t);l&&(r=(r=s(r))<0?0:r>255?255:255&r),o.view[A](e*g+o.byteOffset,r,!0)}(this,e,t)},enumerable:!0})};p?eu&&(T=u((function(t,e,r,n){return gr(t,k),ss(xt(e)?w(e)?void 0!==n?new S(e,es(r,g),n):void 0!==r?new S(e,es(r,g)):new S(e):m(e)?x(T,e):jt(us,T,e):new S(ou(e)),t,T)})),fr&&fr(T,d),r(e(S),(function(t){t in T||ie(T,t,S[t])})),T.prototype=k):(T=u((function(t,e,r,n){gr(t,k);var i,a,u,s=0,l=0;if(xt(e)){if(!w(e))return m(e)?x(T,e):jt(us,T,e);i=e,l=es(r,g);var p=e.byteLength;if(void 0===n){if(p%g)throw c("Wrong length");if((a=p-l)<0)throw c("Wrong length")}else if((a=Fe(n)*g)+l>p)throw c("Wrong length");u=a/g}else u=ou(e),i=new f(a=u*g);for(o(t,{buffer:i,byteOffset:l,byteLength:a,length:u,view:new h(i)});s<u;)j(t,s++)})),fr&&fr(T,d),k=T.prototype=Qi(y)),k.constructor!==T&&ie(k,"constructor",T),i(k).TypedArrayConstructor=T,v&&ie(k,v,b);var P=T!=S;I[b]=T,ar({global:!0,constructor:!0,forced:P,sham:!p},I),"BYTES_PER_ELEMENT"in T||ie(T,"BYTES_PER_ELEMENT",g),"BYTES_PER_ELEMENT"in k||ie(k,"BYTES_PER_ELEMENT",g),dr(b)}):t.exports=function(){}}));cs("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}),!0);var fs=TypeError,ls=function(t,e){if(!delete t[e])throw fs("Cannot delete property "+Rt(e)+" of "+Rt(t))},hs=Math.min,ps=F([].copyWithin||function(t,e){var r=G(this),n=We(r),o=Ne(t,n),i=Ne(e,n),a=arguments.length>2?arguments[2]:void 0,u=hs((void 0===a?n:Ne(a,n))-i,n-o),s=1;for(i<o&&o<i+u&&(s=-1,i+=u-1,o+=u-1);u-- >0;)i in r?r[o]=r[i]:ls(r,o),o+=s,i+=s;return r}),vs=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("copyWithin",(function(t,e){return ps(vs(this),t,e,arguments.length>2?arguments[2]:void 0)}));var ds=Ei.every,ys=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("every",(function(t){return ds(ys(this),t,arguments.length>1?arguments[1]:void 0)}));var gs=Qa.aTypedArray,ms=Qa.exportTypedArrayMethod,xs=F("".slice);ms("fill",(function(t){var e=arguments.length;gs(this);var r="Big"===xs(xe(this),0,3)?is(t):+t;return jt(pu,this,r,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),j((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})));var bs=Qa.aTypedArrayConstructor,ws=Qa.getTypedArrayConstructor,Es=function(t){return bs(Rr(t,ws(t)))},As=function(t,e){return function(t,e){for(var r=0,n=We(e),o=new t(n);n>r;)o[r]=e[r++];return o}(Es(t),e)},Os=Ei.filter,Ss=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("filter",(function(t){var e=Os(Ss(this),t,arguments.length>1?arguments[1]:void 0);return As(this,e)}));var Ts=Ei.find,ks=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("find",(function(t){return Ts(ks(this),t,arguments.length>1?arguments[1]:void 0)}));var Is=Ei.findIndex,js=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("findIndex",(function(t){return Is(js(this),t,arguments.length>1?arguments[1]:void 0)}));var Ps=Ei.forEach,_s=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("forEach",(function(t){Ps(_s(this),t,arguments.length>1?arguments[1]:void 0)}));var Ms=Be.includes,Ls=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("includes",(function(t){return Ms(Ls(this),t,arguments.length>1?arguments[1]:void 0)}));var Rs=Be.indexOf,Cs=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("indexOf",(function(t){return Rs(Cs(this),t,arguments.length>1?arguments[1]:void 0)}));var Ns=vt("iterator"),Ds=O.Uint8Array,Fs=F(Ta.values),Ws=F(Ta.keys),zs=F(Ta.entries),Bs=Qa.aTypedArray,Us=Qa.exportTypedArrayMethod,Gs=Ds&&Ds.prototype,Hs=!j((function(){Gs[Ns].call([1])})),Vs=!!Gs&&Gs.values&&Gs[Ns]===Gs.values&&"values"===Gs.values.name,qs=function(){return Fs(Bs(this))};Us("entries",(function(){return zs(Bs(this))}),Hs),Us("keys",(function(){return Ws(Bs(this))}),Hs),Us("values",qs,Hs||!Vs,{name:"values"}),Us(Ns,qs,Hs||!Vs,{name:"values"});var Zs=Qa.aTypedArray,Ys=Qa.exportTypedArrayMethod,$s=F([].join);Ys("join",(function(t){return $s(Zs(this),t)}));var Ks=Math.min,Qs=[].lastIndexOf,Xs=!!Qs&&1/[1].lastIndexOf(1,-0)<0,Js=Ai("lastIndexOf"),tc=Xs||!Js?function(t){if(Xs)return Fr(Qs,this,arguments)||0;var e=ke(this),r=We(e),n=r-1;for(arguments.length>1&&(n=Ks(n,Le(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}:Qs,ec=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return Fr(tc,ec(this),e>1?[t,arguments[1]]:[t])}));var rc=Ei.map,nc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("map",(function(t){return rc(nc(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(Es(t))(e)}))}));var oc=TypeError,ic=function(t){return function(e,r,n,o){Nt(r);var i=G(e),a=Te(i),u=We(i),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw oc("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},ac={left:ic(!1),right:ic(!0)},uc=ac.left,sc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return uc(sc(this),t,e,e>1?arguments[1]:void 0)}));var cc=ac.right,fc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return cc(fc(this),t,e,e>1?arguments[1]:void 0)}));var lc=Qa.aTypedArray,hc=Qa.exportTypedArrayMethod,pc=Math.floor;hc("reverse",(function(){for(var t,e=lc(this).length,r=pc(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this}));var vc=O.RangeError,dc=O.Int8Array,yc=dc&&dc.prototype,gc=yc&&yc.set,mc=Qa.aTypedArray,xc=Qa.exportTypedArrayMethod,bc=!j((function(){var t=new Uint8ClampedArray(2);return jt(gc,t,{length:1,0:3},1),3!==t[1]})),wc=bc&&Qa.NATIVE_ARRAY_BUFFER_VIEWS&&j((function(){var t=new dc(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));xc("set",(function(t){mc(this);var e=es(arguments.length>1?arguments[1]:void 0,1),r=G(t);if(bc)return jt(gc,this,r,e);var n=this.length,o=We(r),i=0;if(o+e>n)throw vc("Wrong length");for(;i<o;)this[e+i]=r[i++]}),!bc||wc);var Ec=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("slice",(function(t,e){for(var r=Ur(Ec(this),t,e),n=Es(this),o=0,i=r.length,a=new n(i);i>o;)a[o]=r[o++];return a}),j((function(){new Int8Array(1).slice()})));var Ac=Ei.some,Oc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("some",(function(t){return Ac(Oc(this),t,arguments.length>1?arguments[1]:void 0)}));var Sc=Math.floor,Tc=function(t,e){var r=t.length,n=Sc(r/2);return r<8?kc(t,e):Ic(t,Tc(yu(t,0,n),e),Tc(yu(t,n),e),e)},kc=function(t,e){for(var r,n,o=t.length,i=1;i<o;){for(n=i,r=t[i];n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==i++&&(t[n]=r)}return t},Ic=function(t,e,r,n){for(var o=e.length,i=r.length,a=0,u=0;a<o||u<i;)t[a+u]=a<o&&u<i?n(e[a],r[u])<=0?e[a++]:r[u++]:a<o?e[a++]:r[u++];return t},jc=Tc,Pc=rt.match(/firefox\\/(\\d+)/i),_c=!!Pc&&+Pc[1],Mc=/MSIE|Trident/.test(rt),Lc=rt.match(/AppleWebKit\\/(\\d+)\\./),Rc=!!Lc&&+Lc[1],Cc=Qa.aTypedArray,Nc=Qa.exportTypedArrayMethod,Dc=O.Uint16Array,Fc=Dc&&F(Dc.prototype.sort),Wc=!(!Fc||j((function(){Fc(new Dc(2),null)}))&&j((function(){Fc(new Dc(2),{})}))),zc=!!Fc&&!j((function(){if(ut)return ut<74;if(_c)return _c<67;if(Mc)return!0;if(Rc)return Rc<602;var t,e,r=new Dc(516),n=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,n[t]=t-2*e+3;for(Fc(r,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==n[t])return!0}));Nc("sort",(function(t){return void 0!==t&&Nt(t),zc?Fc(this,t):jc(Cc(this),function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t))}),!zc||Wc);var Bc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("subarray",(function(t,e){var r=Bc(this),n=r.length,o=Ne(t,n);return new(Es(r))(r.buffer,r.byteOffset+o*r.BYTES_PER_ELEMENT,Fe((void 0===e?n:Ne(e,n))-o))}));var Uc=O.Int8Array,Gc=Qa.aTypedArray,Hc=Qa.exportTypedArrayMethod,Vc=[].toLocaleString,qc=!!Uc&&j((function(){Vc.call(new Uc(1))}));Hc("toLocaleString",(function(){return Fr(Vc,qc?Ur(Gc(this)):Gc(this),Ur(arguments))}),j((function(){return[1,2].toLocaleString()!=new Uc([1,2]).toLocaleString()}))||!j((function(){Uc.prototype.toLocaleString.call([1,2])})));var Zc=Qa.exportTypedArrayMethod,Yc=O.Uint8Array,$c=Yc&&Yc.prototype||{},Kc=[].toString,Qc=F([].join);j((function(){Kc.call({})}))&&(Kc=function(){return Qc(this)});var Xc=$c.toString!=Kc;Zc("toString",Kc,Xc);var Jc,tf,ef=String,rf=function(t){if("Symbol"===xe(t))throw TypeError("Cannot convert a Symbol value to a string");return ef(t)},nf=function(){var t=kt(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},of=O.RegExp,af=j((function(){var t=of("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),uf=af||j((function(){return!of("a","y").sticky})),sf={BROKEN_CARET:af||j((function(){var t=of("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:uf,UNSUPPORTED_Y:af},cf=O.RegExp,ff=j((function(){var t=cf(".","s");return!(t.dotAll&&t.exec("\\n")&&"s"===t.flags)})),lf=O.RegExp,hf=j((function(){var t=lf("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),pf=pe.get,vf=I("native-string-replace",String.prototype.replace),df=RegExp.prototype.exec,yf=df,gf=F("".charAt),mf=F("".indexOf),xf=F("".replace),bf=F("".slice),wf=(tf=/b*/g,jt(df,Jc=/a/,"a"),jt(df,tf,"a"),0!==Jc.lastIndex||0!==tf.lastIndex),Ef=sf.BROKEN_CARET,Af=void 0!==/()??/.exec("")[1];(wf||Af||Ef||ff||hf)&&(yf=function(t){var e,r,n,o,i,a,u,s=this,c=pf(s),f=rf(t),l=c.raw;if(l)return l.lastIndex=s.lastIndex,e=jt(yf,l,f),s.lastIndex=l.lastIndex,e;var h=c.groups,p=Ef&&s.sticky,v=jt(nf,s),d=s.source,y=0,g=f;if(p&&(v=xf(v,"y",""),-1===mf(v,"g")&&(v+="g"),g=bf(f,s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\\n"!==gf(f,s.lastIndex-1))&&(d="(?: "+d+")",g=" "+g,y++),r=new RegExp("^(?:"+d+")",v)),Af&&(r=new RegExp("^"+d+"$(?!\\\\s)",v)),wf&&(n=s.lastIndex),o=jt(df,p?r:s,g),p?o?(o.input=bf(o.input,y),o[0]=bf(o[0],y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:wf&&o&&(s.lastIndex=s.global?o.index+o[0].length:n),Af&&o&&o.length>1&&jt(vf,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&h)for(o.groups=a=Qi(null),i=0;i<h.length;i++)a[(u=h[i])[0]]=o[u[1]];return o});var Of=yf;ar({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Sf,Tf=vt("species"),kf=RegExp.prototype,If=function(t,e,r,n){var o=vt(t),i=!j((function(){var e={};return e[o]=function(){return 7},7!=""[t](e)})),a=i&&!j((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[Tf]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return e=!0,null},r[o](""),!e}));if(!i||!a||r){var u=F(/./[o]),s=e(o,""[t],(function(t,e,r,n,o){var a=F(t),s=e.exec;return s===Of||s===kf.exec?i&&!o?{done:!0,value:u(e,r,n)}:{done:!0,value:a(r,e,n)}:{done:!1}}));de(String.prototype,t,s[0]),de(kf,o,s[1])}n&&ie(kf[o],"sham",!0)},jf=F("".charAt),Pf=F("".charCodeAt),_f=F("".slice),Mf=function(t){return function(e,r){var n,o,i=rf(B(e)),a=Le(r),u=i.length;return a<0||a>=u?t?"":void 0:(n=Pf(i,a))<55296||n>56319||a+1===u||(o=Pf(i,a+1))<56320||o>57343?t?jf(i,a):n:t?_f(i,a,a+2):o-56320+(n-55296<<10)+65536}},Lf={codeAt:Mf(!1),charAt:Mf(!0)},Rf=Lf.charAt,Cf=function(t,e,r){return e+(r?Rf(t,e).length:1)},Nf=Math.floor,Df=F("".charAt),Ff=F("".replace),Wf=F("".slice),zf=/\\$([$&'\`]|\\d{1,2}|<[^>]*>)/g,Bf=/\\$([$&'\`]|\\d{1,2})/g,Uf=function(t,e,r,n,o,i){var a=r+t.length,u=n.length,s=Bf;return void 0!==o&&(o=G(o),s=zf),Ff(i,s,(function(i,s){var c;switch(Df(s,0)){case"$":return"$";case"&":return t;case"\`":return Wf(e,0,r);case"'":return Wf(e,a);case"<":c=o[Wf(s,1,-1)];break;default:var f=+s;if(0===f)return i;if(f>u){var l=Nf(f/10);return 0===l?i:l<=u?void 0===n[l-1]?Df(s,1):n[l-1]+Df(s,1):i}c=n[f-1]}return void 0===c?"":c}))},Gf=TypeError,Hf=function(t,e){var r=t.exec;if(J(r)){var n=jt(r,t,e);return null!==n&&kt(n),n}if("RegExp"===D(t))return jt(Of,t,e);throw Gf("RegExp#exec called on incompatible receiver")},Vf=vt("replace"),qf=Math.max,Zf=Math.min,Yf=F([].concat),$f=F([].push),Kf=F("".indexOf),Qf=F("".slice),Xf="$0"==="a".replace(/./,"$0"),Jf=!!/./[Vf]&&""===/./[Vf]("a","$0");function tl(t){this.message=t}If("replace",(function(t,e,r){var n=Jf?"$":"$0";return[function(t,r){var n=B(this),o=W(t)?void 0:Dt(t,Vf);return o?jt(o,t,n,r):jt(e,rf(n),t,r)},function(t,o){var i=kt(this),a=rf(t);if("string"==typeof o&&-1===Kf(o,n)&&-1===Kf(o,"$<")){var u=r(e,i,a,o);if(u.done)return u.value}var s=J(o);s||(o=rf(o));var c=i.global;if(c){var f=i.unicode;i.lastIndex=0}for(var l=[];;){var h=Hf(i,a);if(null===h)break;if($f(l,h),!c)break;""===rf(h[0])&&(i.lastIndex=Cf(a,Fe(i.lastIndex),f))}for(var p,v="",d=0,y=0;y<l.length;y++){for(var g=rf((h=l[y])[0]),m=qf(Zf(Le(h.index),a.length),0),x=[],b=1;b<h.length;b++)$f(x,void 0===(p=h[b])?p:String(p));var w=h.groups;if(s){var E=Yf([g],x,m,a);void 0!==w&&$f(E,w);var A=rf(Fr(o,void 0,E))}else A=Uf(g,a,m,x,w,o);m>=d&&(v+=Qf(a,d,m)+A,d=m+g.length)}return v+Qf(a,d)}]}),!!j((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!Xf||Jf),tl.prototype=new Error,tl.prototype.name="InvalidCharacterError",ar({global:!0,forced:O.globalThis!==O},{globalThis:O}),Sf="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,r){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:Sf.devicePixelRatio;var el=TypeError,rl=Object.getOwnPropertyDescriptor,nl=gt&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(yi(t)&&!rl(t,"length").writable)throw el("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},ol=TypeError,il=function(t){if(t>9007199254740991)throw ol("Maximum allowed index exceeded");return t},al=Pi("splice"),ul=Math.max,sl=Math.min;ar({target:"Array",proto:!0,forced:!al},{splice:function(t,e){var r,n,o,i,a,u,s=G(this),c=We(s),f=Ne(t,c),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=c-f):(r=l-2,n=sl(ul(Le(e),0),c-f)),il(c+r-n),o=xi(s,n),i=0;i<n;i++)(a=f+i)in s&&Ii(o,i,s[a]);if(o.length=n,r<n){for(i=f;i<c-n;i++)u=i+r,(a=i+n)in s?s[u]=s[a]:ls(s,u);for(i=c;i>c-n+r;i--)ls(s,i-1)}else if(r>n)for(i=c-n;i>f;i--)u=i+r-1,(a=i+n-1)in s?s[u]=s[a]:ls(s,u);for(i=0;i<r;i++)s[i+f]=arguments[i+2];return nl(s,c-n+r),o}});var cl=u((function t(e,r){i(this,t),s(this,"cancelBubble",void 0),s(this,"cancelable",void 0),s(this,"target",void 0),s(this,"currentTarget",void 0),s(this,"preventDefault",void 0),s(this,"stopPropagation",void 0),s(this,"type",void 0),s(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),fl=Object.assign,ll=Object.defineProperty,hl=F([].concat),pl=!fl||j((function(){if(gt&&1!==fl({b:1},fl(ll({},"a",{enumerable:!0,get:function(){ll(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol();return t[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=fl({},t)[r]||"abcdefghijklmnopqrst"!=Hi(fl({},e)).join("")}))?function(t,e){for(var r=G(t),n=arguments.length,o=1,i=Ye.f,a=Ae.f;n>o;)for(var u,s=Te(arguments[o++]),c=i?hl(Hi(s),i(s)):Hi(s),f=c.length,l=0;f>l;)u=c[l++],gt&&!jt(a,s,u)||(r[u]=s[u]);return r}:fl;ar({target:"Object",stat:!0,arity:2,forced:Object.assign!==pl},{assign:pl});var vl=Ei.findIndex,dl=!0;"findIndex"in[]&&Array(1).findIndex((function(){dl=!1})),ar({target:"Array",proto:!0,forced:dl},{findIndex:function(t){return vl(this,t,arguments.length>1?arguments[1]:void 0)}}),oa("findIndex");var yl=Lf.charAt,gl=pe.set,ml=pe.getterFor("String Iterator");wa(String,"String",(function(t){gl(this,{type:"String Iterator",string:rf(t),index:0})}),(function(){var t,e=ml(this),r=e.string,n=e.index;return n>=r.length?Ea(void 0,!0):(t=yl(r,n),e.index+=t.length,Ea(t,!1))}));var xl=Ze.f,bl="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],wl={f:function(t){return bl&&"Window"==D(t)?function(t){try{return xl(t)}catch(t){return yu(bl)}}(t):xl(ke(t))}},El=j((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),Al=Object.isExtensible,Ol=j((function(){Al(1)}))||El?function(t){return!!xt(t)&&((!El||"ArrayBuffer"!=D(t))&&(!Al||Al(t)))}:Al,Sl=!j((function(){return Object.isExtensible(Object.preventExtensions({}))})),Tl=b((function(t){var e=qt.f,r=!1,n=$("meta"),o=0,i=function(t){e(t,n,{value:{objectID:"O"+o++,weakData:{}}})},a=t.exports={enable:function(){a.enable=function(){},r=!0;var t=Ze.f,e=F([].splice),o={};o[n]=1,t(o).length&&(Ze.f=function(r){for(var o=t(r),i=0,a=o.length;i<a;i++)if(o[i]===n){e(o,i,1);break}return o},ar({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:wl.f}))},fastKey:function(t,e){if(!xt(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!V(t,n)){if(!Ol(t))return"F";if(!e)return"E";i(t)}return t[n].objectID},getWeakData:function(t,e){if(!V(t,n)){if(!Ol(t))return!0;if(!e)return!1;i(t)}return t[n].weakData},onFreeze:function(t){return Sl&&r&&Ol(t)&&!V(t,n)&&i(t),t}};se[n]=!0})),kl=(Tl.enable,Tl.fastKey,Tl.getWeakData,Tl.onFreeze,function(t,e,r){var n=-1!==t.indexOf("Map"),o=-1!==t.indexOf("Weak"),i=n?"set":"add",a=O[t],u=a&&a.prototype,s=a,c={},f=function(t){var e=F(u[t]);de(u,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!xt(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return o&&!xt(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!xt(t))&&e(this,0===t?0:t)}:function(t,r){return e(this,0===t?0:t,r),this})};if(or(t,!J(a)||!(o||u.forEach&&!j((function(){(new a).entries().next()})))))s=r.getConstructor(e,t,n,i),Tl.enable();else if(or(t,!0)){var l=new s,h=l[i](o?{}:-0,1)!=l,p=j((function(){l.has(1)})),v=_o((function(t){new a(t)})),d=!o&&j((function(){for(var t=new a,e=5;e--;)t[i](e,e);return!t.has(-0)}));v||((s=e((function(t,e){gr(t,u);var r=ss(new a,t,s);return W(e)||To(e,r[i],{that:r,AS_ENTRIES:n}),r}))).prototype=u,u.constructor=s),(p||d)&&(f("delete"),f("has"),n&&f("get")),(d||h)&&f(i),o&&u.clear&&delete u.clear}return c[t]=s,ar({global:!0,constructor:!0,forced:s!=a},c),pr(s,t),o||r.setStrong(s,t,n),s}),Il=Tl.getWeakData,jl=pe.set,Pl=pe.getterFor,_l=Ei.find,Ml=Ei.findIndex,Ll=F([].splice),Rl=0,Cl=function(t){return t.frozen||(t.frozen=new Nl)},Nl=function(){this.entries=[]},Dl=function(t,e){return _l(t.entries,(function(t){return t[0]===e}))};Nl.prototype={get:function(t){var e=Dl(this,t);if(e)return e[1]},has:function(t){return!!Dl(this,t)},set:function(t,e){var r=Dl(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=Ml(this.entries,(function(e){return e[0]===t}));return~e&&Ll(this.entries,e,1),!!~e}};var Fl,Wl={getConstructor:function(t,e,r,n){var o=t((function(t,o){gr(t,i),jl(t,{type:e,id:Rl++,frozen:void 0}),W(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Pl(e),u=function(t,e,r){var n=a(t),o=Il(kt(e),!0);return!0===o?Cl(n).set(e,r):o[n.id]=r,t};return ru(i,{delete:function(t){var e=a(this);if(!xt(t))return!1;var r=Il(t);return!0===r?Cl(e).delete(t):r&&V(r,e.id)&&delete r[e.id]},has:function(t){var e=a(this);if(!xt(t))return!1;var r=Il(t);return!0===r?Cl(e).has(t):r&&V(r,e.id)}}),ru(i,r?{get:function(t){var e=a(this);if(xt(t)){var r=Il(t);return!0===r?Cl(e).get(t):r?r[e.id]:void 0}},set:function(t,e){return u(this,t,e)}}:{add:function(t){return u(this,t,!0)}}),o}},zl=pe.enforce,Bl=!O.ActiveXObject&&"ActiveXObject"in O,Ul=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Gl=kl("WeakMap",Ul,Wl);if(ne&&Bl){Fl=Wl.getConstructor(Ul,"WeakMap",!0),Tl.enable();var Hl=Gl.prototype,Vl=F(Hl.delete),ql=F(Hl.has),Zl=F(Hl.get),Yl=F(Hl.set);ru(Hl,{delete:function(t){if(xt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),Vl(this,t)||e.frozen.delete(t)}return Vl(this,t)},has:function(t){if(xt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),ql(this,t)||e.frozen.has(t)}return ql(this,t)},get:function(t){if(xt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),ql(this,t)?Zl(this,t):e.frozen.get(t)}return Zl(this,t)},set:function(t,e){if(xt(t)&&!Ol(t)){var r=zl(this);r.frozen||(r.frozen=new Fl),ql(this,t)?Yl(this,t,e):r.frozen.set(t,e)}else Yl(this,t,e);return this}})}var $l=vt("iterator"),Kl=vt("toStringTag"),Ql=Ta.values,Xl=function(t,e){if(t){if(t[$l]!==Ql)try{ie(t,$l,Ql)}catch(e){t[$l]=Ql}if(t[Kl]||ie(t,Kl,e),hi[e])for(var r in Ta)if(t[r]!==Ta[r])try{ie(t,r,Ta[r])}catch(e){t[r]=Ta[r]}}};for(var Jl in hi)Xl(O[Jl]&&O[Jl].prototype,Jl);Xl(di,"DOMTokenList");var th,eh,rh,nh,oh=new WeakMap,ih=function(){function t(){i(this,t),oh.set(this,{})}return u(t,[{key:"addEventListener",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=oh.get(this);n||(n={}),n[t]||(n[t]=[]),n[t].push(e),oh.set(this,n),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,e){var r=oh.get(this);if(r){var n=r[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}}},{key:"dispatchEvent",value:function(t){var e=oh.get(this)[t.type];if(e){var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(e);try{for(n.s();!(r=n.n()).done;){(0,r.value)(t)}}catch(t){n.e(t)}finally{n.f()}}}}]),t}(),ah=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),t.className="",t.children=[],t}return u(r,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"childNodes",void 0),t.childNodes=[],t}return u(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),r}(ih));if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var uh=my.getSystemInfoSync();th=uh.screenWidth,eh=uh.screenHeight,rh=uh.windowWidth,nh=uh.windowHeight}else{var sh=Sf.innerWidth,ch=Sf.innerHeight;th=sh,eh=ch,rh=sh,nh=ch}var fh={width:th,height:eh,availWidth:rh,availHeight:nh,availLeft:0,availTop:0},lh=fh.availWidth,hh=fh.availHeight,ph={style:[]};function vh(t,e){var r,n;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return ph}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r}));"parentElement"in t||(n=0===e?function(){return null}:1===e?function(){return ph}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:n}))}function dh(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:lh+"px",height:hh+"px",margin:"0px",padding:"0px"})}function yh(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=lh,t.clientHeight=hh),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function gh(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=lh,t.offsetHeight=hh)}function mh(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=lh,t.scrollHeight=hh)}function xh(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function bh(){}var wh=function(t){c(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),s(h(t),"focus",void 0),s(h(t),"blur",void 0),s(h(t),"insertBefore",void 0),s(h(t),"appendChild",void 0),s(h(t),"removeChild",void 0),s(h(t),"remove",void 0),s(h(t),"innerHTML",void 0),s(h(t),"tagName",void 0),t.className="",t.children=[],t.focus=bh,t.blur=bh,t.insertBefore=bh,t.appendChild=bh,t.removeChild=bh,t.remove=bh,t.innerHTML="",t.tagName=n.toUpperCase(),vh(h(t),o),dh(h(t)),xh(h(t)),yh(h(t)),gh(h(t)),mh(h(t)),t}return u(r)}(ah),Eh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"video")}return u(r)}(function(t){c(r,t);var e=v(r);function r(t){return i(this,r),e.call(this,t)}return u(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(wh)),Ah={};function Oh(){return Ah}var Sh=u((function t(){i(this,t);var e=Oh(),r=e.createImage&&e.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=t.prototype),vh(r),xh(r),Object.assign(r,{addEventListener:function(t,e){r["on".concat(t)]=e.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r})),Th={href:"",protocol:"",host:""},kh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"body",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,r){}},{key:"dispatchEvent",value:function(t){}}]),r}(wh),Ih=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"html",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),r}(wh),jh={},Ph={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Th,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new Sh:"video"===t?new Eh:new wh(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,r){jh[t]||(jh[t]=[]),jh[t].push(e)},removeEventListener:function(t,e){var r=jh[t];if(r&&r.length>0)for(var n=r.length;n--;n>0)if(r[n]===e){r.splice(n,1);break}},dispatchEvent:function(t){var e=t.type,r=jh[e];if(r)for(var n=0;n<r.length;n++)r[n](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new cl(t)}};Ph.documentElement=new Ih,Ph.head=new wh("head"),Ph.body=new kh,If("match",(function(t,e,r){return[function(e){var r=B(this),n=W(e)?void 0:Dt(e,t);return n?jt(n,e,r):new RegExp(e)[t](rf(r))},function(t){var n=kt(this),o=rf(t),i=r(e,n,o);if(i.done)return i.value;if(!n.global)return Hf(n,o);var a=n.unicode;n.lastIndex=0;for(var u,s=[],c=0;null!==(u=Hf(n,o));){var f=rf(u[0]);s[c]=f,""===f&&(n.lastIndex=Cf(o,Fe(n.lastIndex),a)),c++}return 0===c?null:s}]}));var _h,Mh,Lh=vt("isConcatSpreadable"),Rh=ut>=51||!j((function(){var t=[];return t[Lh]=!1,t.concat()[0]!==t})),Ch=Pi("concat"),Nh=function(t){if(!xt(t))return!1;var e=t[Lh];return void 0!==e?!!e:yi(t)};if(ar({target:"Array",proto:!0,arity:1,forced:!Rh||!Ch},{concat:function(t){var e,r,n,o,i,a=G(this),u=xi(a,0),s=0;for(e=-1,n=arguments.length;e<n;e++)if(Nh(i=-1===e?a:arguments[e]))for(o=We(i),il(s+o),r=0;r<o;r++,s++)r in i&&Ii(u,s,i[r]);else il(s+1),Ii(u,s++,i);return u.length=s,u}}),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Dh=my.getSystemInfoSync();_h=Dh.system,Dh.platform,Dh.language}else{var Fh={versions:(Mh=Sf.navigator.userAgent,{trident:Mh.indexOf("Trident")>-1,presto:Mh.indexOf("Presto")>-1,webKit:Mh.indexOf("AppleWebKit")>-1,gecko:Mh.indexOf("Gecko")>-1&&-1===Mh.indexOf("KHTML"),mobile:!!Mh.match(/AppleWebKit.*Mobile.*/),ios:!!Mh.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Mh.indexOf("Android")>-1||Mh.indexOf("Linux")>-1,iPhone:Mh.indexOf("iPhone")>-1,iPad:Mh.indexOf("iPad")>-1,webApp:-1===Mh.indexOf("Safari"),weixin:Mh.indexOf("MicroMessenger")>-1,qq:" qq"===Mh.match(/\\sQQ/i)}),language:(Sf.navigator.browserLanguage||Sf.navigator.language).toLowerCase()};Fh.versions.android?"android":Fh.versions.trident?"IE":Fh.versions.presto?"Opera":Fh.versions.webKit?"webKit":Fh.versions.gecko?"Firefox":Fh.versions.mobile?"mobile":Fh.versions.ios?"ios":Fh.versions.iPhone?"iPhone":Fh.versions.iPad?"ipad":Fh.versions.webApp?"webApp":Fh.versions.weixin?"weixin":Fh.versions.qq&&"qq",_h=Sf.navigator.userAgent,Fh.language}_h.toLowerCase().indexOf("android");cs("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}));var Wh=qt.f,zh=Tl.fastKey,Bh=pe.set,Uh=pe.getterFor;kl("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(t,e,r,n){var o=t((function(t,o){gr(t,i),Bh(t,{type:e,index:Qi(null),first:void 0,last:void 0,size:0}),gt||(t.size=0),W(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Uh(e),u=function(t,e,r){var n,o,i=a(t),u=s(t,e);return u?u.value=r:(i.last=u={index:o=zh(e,!0),key:e,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=u),n&&(n.next=u),gt?i.size++:t.size++,"F"!==o&&(i.index[o]=u)),t},s=function(t,e){var r,n=a(t),o=zh(e);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==e)return r};return ru(i,{clear:function(){for(var t=a(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,gt?t.size=0:this.size=0},delete:function(t){var e=a(this),r=s(this,t);if(r){var n=r.next,o=r.previous;delete e.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),e.first==r&&(e.first=n),e.last==r&&(e.last=o),gt?e.size--:this.size--}return!!r},forEach:function(t){for(var e,r=a(this),n=zr(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:r.first;)for(n(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!s(this,t)}}),ru(i,r?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return u(this,0===t?0:t,e)}}:{add:function(t){return u(this,t=0===t?0:t,t)}}),gt&&Wh(i,"size",{get:function(){return a(this).size}}),o},setStrong:function(t,e,r){var n=e+" Iterator",o=Uh(e),i=Uh(n);wa(t,e,(function(t,e){Bh(this,{type:n,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=i(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?Ea("keys"==e?r.key:"values"==e?r.value:[r.key,r.value],!1):(t.target=void 0,Ea(void 0,!0))}),r?"entries":"values",!r,!0),dr(e)}});var Gh=F([].join),Hh=Te!=Object,Vh=Ai("join",",");ar({target:"Array",proto:!0,forced:Hh||!Vh},{join:function(t){return Gh(ke(this),void 0===t?",":t)}});var qh=j((function(){Hi(1)}));ar({target:"Object",stat:!0,forced:qh},{keys:function(t){return Hi(G(t))}});var Zh=new Map,Yh=new Map,$h=new Map,Kh=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"onabort",void 0),s(h(t),"onerror",void 0),s(h(t),"onload",void 0),s(h(t),"onloadstart",void 0),s(h(t),"onprogress",void 0),s(h(t),"ontimeout",void 0),s(h(t),"onloadend",void 0),s(h(t),"onreadystatechange",void 0),s(h(t),"readyState",void 0),s(h(t),"response",void 0),s(h(t),"responseText",void 0),s(h(t),"_responseType",void 0),s(h(t),"responseXML",void 0),s(h(t),"status",void 0),s(h(t),"statusText",void 0),s(h(t),"upload",void 0),s(h(t),"withCredentials",void 0),s(h(t),"timeout",void 0),s(h(t),"_url",void 0),s(h(t),"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Zh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return u(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=$h.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Yh.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\\n")}},{key:"getResponseHeader",value:function(t){return Yh.get("responseHeader")[t]}},{key:"open",value:function(t,e,r){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var r=Zh.get("requestHeader");r[t]=e,Zh.set("requestHeader",r)}},{key:"addEventListener",value:function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||r,e.call(r,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),r}(ih);s(Kh,"UNSEND",void 0),s(Kh,"OPENED",void 0),s(Kh,"HEADERS_RECEIVED",void 0),s(Kh,"LOADING",void 0),s(Kh,"DONE",void 0),Kh.UNSEND=0,Kh.OPENED=1,Kh.HEADERS_RECEIVED=2,Kh.LOADING=3,Kh.DONE=4;var Qh="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,Xh="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),Jh=Qh||Xh;Jh||Sf.XMLHttpRequest,Jh||Sf.location;function tp(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}var ep=Ei.filter,rp=Pi("filter");function np(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function op(t,e,r){return 2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]]}function ip(t){return t.filter?[1]:[0]}function ap(t,e){return[e]}ar({target:"Array",proto:!0,forced:!rp},{filter:function(t){return ep(this,t,arguments.length>1?arguments[1]:void 0)}});var up=cp,sp=cp;function cp(t,e,r){r=r||2;var n,o,i,a,u,s,c,f=e&&e.length,l=f?e[0]*r:t.length,h=fp(t,0,l,r,!0),p=[];if(!h||h.next===h.prev)return p;if(f&&(h=function(t,e,r,n){var o,i,a,u,s,c=[];for(o=0,i=e.length;o<i;o++)a=e[o]*n,u=o<i-1?e[o+1]*n:t.length,(s=fp(t,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(wp(s));for(c.sort(gp),o=0;o<c.length;o++)r=mp(c[o],r);return r}(t,e,h,r)),t.length>80*r){n=i=t[0],o=a=t[1];for(var v=r;v<l;v+=r)(u=t[v])<n&&(n=u),(s=t[v+1])<o&&(o=s),u>i&&(i=u),s>a&&(a=s);c=0!==(c=Math.max(i-n,a-o))?32767/c:0}return hp(h,p,r,n,o,c,0),p}function fp(t,e,r,n,o){var i,a;if(o===Rp(t,e,r,n)>0)for(i=e;i<r;i+=n)a=_p(i,t[i],t[i+1],a);else for(i=r-n;i>=e;i-=n)a=_p(i,t[i],t[i+1],a);return a&&Sp(a,a.next)&&(Mp(a),a=a.next),a}function lp(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Sp(n,n.next)&&0!==Op(n.prev,n,n.next))n=n.next;else{if(Mp(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function hp(t,e,r,n,o,i,a){if(t){!a&&i&&function(t,e,r,n){var o=t;do{0===o.z&&(o.z=bp(o.x,o.y,e,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,r,n,o,i,a,u,s,c=1;do{for(r=t,t=null,i=null,a=0;r;){for(a++,n=r,u=0,e=0;e<c&&(u++,n=n.nextZ);e++);for(s=c;u>0||s>0&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(o=r,r=r.nextZ,u--):(o=n,n=n.nextZ,s--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(t,n,o,i);for(var u,s,c=t;t.prev!==t.next;)if(u=t.prev,s=t.next,i?vp(t,n,o,i):pp(t))e.push(u.i/r|0),e.push(t.i/r|0),e.push(s.i/r|0),Mp(t),t=s.next,c=s.next;else if((t=s)===c){a?1===a?hp(t=dp(lp(t),e,r),e,r,n,o,i,2):2===a&&yp(t,e,r,n,o,i):hp(lp(t),e,r,n,o,i,1);break}}}function pp(t){var e=t.prev,r=t,n=t.next;if(Op(e,r,n)>=0)return!1;for(var o=e.x,i=r.x,a=n.x,u=e.y,s=r.y,c=n.y,f=o<i?o<a?o:a:i<a?i:a,l=u<s?u<c?u:c:s<c?s:c,h=o>i?o>a?o:a:i>a?i:a,p=u>s?u>c?u:c:s>c?s:c,v=n.next;v!==e;){if(v.x>=f&&v.x<=h&&v.y>=l&&v.y<=p&&Ep(o,u,i,s,a,c,v.x,v.y)&&Op(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function vp(t,e,r,n){var o=t.prev,i=t,a=t.next;if(Op(o,i,a)>=0)return!1;for(var u=o.x,s=i.x,c=a.x,f=o.y,l=i.y,h=a.y,p=u<s?u<c?u:c:s<c?s:c,v=f<l?f<h?f:h:l<h?l:h,d=u>s?u>c?u:c:s>c?s:c,y=f>l?f>h?f:h:l>h?l:h,g=bp(p,v,e,r,n),m=bp(d,y,e,r,n),x=t.prevZ,b=t.nextZ;x&&x.z>=g&&b&&b.z<=m;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Ep(u,f,s,l,c,h,x.x,x.y)&&Op(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Ep(u,f,s,l,c,h,b.x,b.y)&&Op(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;x&&x.z>=g;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Ep(u,f,s,l,c,h,x.x,x.y)&&Op(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=m;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Ep(u,f,s,l,c,h,b.x,b.y)&&Op(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function dp(t,e,r){var n=t;do{var o=n.prev,i=n.next.next;!Sp(o,i)&&Tp(o,n,n.next,i)&&jp(o,i)&&jp(i,o)&&(e.push(o.i/r|0),e.push(n.i/r|0),e.push(i.i/r|0),Mp(n),Mp(n.next),n=t=i),n=n.next}while(n!==t);return lp(n)}function yp(t,e,r,n,o,i){var a=t;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&Ap(a,u)){var s=Pp(a,u);return a=lp(a,a.next),s=lp(s,s.next),hp(a,e,r,n,o,i,0),void hp(s,e,r,n,o,i,0)}u=u.next}a=a.next}while(a!==t)}function gp(t,e){return t.x-e.x}function mp(t,e){var r=function(t,e){var r,n=e,o=t.x,i=t.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=o&&u>a&&(a=u,r=n.x<n.next.x?n:n.next,u===o))return r}n=n.next}while(n!==e);if(!r)return null;var s,c=r,f=r.x,l=r.y,h=1/0;n=r;do{o>=n.x&&n.x>=f&&o!==n.x&&Ep(i<l?o:a,i,f,l,i<l?a:o,i,n.x,n.y)&&(s=Math.abs(i-n.y)/(o-n.x),jp(n,t)&&(s<h||s===h&&(n.x>r.x||n.x===r.x&&xp(r,n)))&&(r=n,h=s)),n=n.next}while(n!==c);return r}(t,e);if(!r)return e;var n=Pp(r,t);return lp(n,n.next),lp(r,r.next)}function xp(t,e){return Op(t.prev,t,e.prev)<0&&Op(e.next,t,t.next)<0}function bp(t,e,r,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function wp(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Ep(t,e,r,n,o,i,a,u){return(o-a)*(e-u)>=(t-a)*(i-u)&&(t-a)*(n-u)>=(r-a)*(e-u)&&(r-a)*(i-u)>=(o-a)*(n-u)}function Ap(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Tp(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(jp(t,e)&&jp(e,t)&&function(t,e){var r=t,n=!1,o=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(Op(t.prev,t,e.prev)||Op(t,e.prev,e))||Sp(t,e)&&Op(t.prev,t,t.next)>0&&Op(e.prev,e,e.next)>0)}function Op(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Sp(t,e){return t.x===e.x&&t.y===e.y}function Tp(t,e,r,n){var o=Ip(Op(t,e,r)),i=Ip(Op(t,e,n)),a=Ip(Op(r,n,t)),u=Ip(Op(r,n,e));return o!==i&&a!==u||(!(0!==o||!kp(t,r,e))||(!(0!==i||!kp(t,n,e))||(!(0!==a||!kp(r,t,n))||!(0!==u||!kp(r,e,n)))))}function kp(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Ip(t){return t>0?1:t<0?-1:0}function jp(t,e){return Op(t.prev,t,t.next)<0?Op(t,e,t.next)>=0&&Op(t,t.prev,e)>=0:Op(t,e,t.prev)<0||Op(t,t.next,e)<0}function Pp(t,e){var r=new Lp(t.i,t.x,t.y),n=new Lp(e.i,e.x,e.y),o=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function _p(t,e,r,n){var o=new Lp(t,e,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Mp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Lp(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Rp(t,e,r,n){for(var o=0,i=e,a=r-n;i<r;i+=n)o+=(t[a]-t[i])*(t[i+1]+t[a+1]),a=i;return o}cp.deviation=function(t,e,r,n){var o=e&&e.length,i=o?e[0]*r:t.length,a=Math.abs(Rp(t,0,i,r));if(o)for(var u=0,s=e.length;u<s;u++){var c=e[u]*r,f=u<s-1?e[u+1]*r:t.length;a-=Math.abs(Rp(t,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;l+=Math.abs((t[h]-t[v])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[v+1]-t[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},cp.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var i=0;i<t[o].length;i++)for(var a=0;a<e;a++)r.vertices.push(t[o][i][a]);o>0&&(n+=t[o-1].length,r.holes.push(n))}return r},up.default=sp;var Cp=F(1..valueOf),Np=F("".replace),Dp="[\\t\\n\\v\\f\\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\\u2028\\u2029\\ufeff]",Fp=RegExp("^"+Dp+Dp+"*"),Wp=RegExp(Dp+Dp+"*$"),zp=function(t){return function(e){var r=rf(B(e));return 1&t&&(r=Np(r,Fp,"")),2&t&&(r=Np(r,Wp,"")),r}},Bp={start:zp(1),end:zp(2),trim:zp(3)},Up=Ze.f,Gp=je.f,Hp=qt.f,Vp=Bp.trim,qp=O.Number,Zp=qp.prototype,Yp=O.TypeError,$p=F("".slice),Kp=F("".charCodeAt),Qp=function(t){var e=Bt(t,"number");return"bigint"==typeof e?e:Xp(e)},Xp=function(t){var e,r,n,o,i,a,u,s,c=Bt(t,"number");if(Mt(c))throw Yp("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=Vp(c),43===(e=Kp(c,0))||45===e){if(88===(r=Kp(c,2))||120===r)return NaN}else if(48===e){switch(Kp(c,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(a=(i=$p(c,2)).length,u=0;u<a;u++)if((s=Kp(i,u))<48||s>o)return NaN;return parseInt(i,n)}return+c};if(or("Number",!qp(" 0o1")||!qp("0b1")||qp("+0x1"))){for(var Jp,tv=function(t){var e=arguments.length<1?0:qp(Qp(t)),r=this;return Pt(Zp,r)&&j((function(){Cp(r)}))?ss(Object(e),r,tv):e},ev=gt?Up(qp):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),rv=0;ev.length>rv;rv++)V(qp,Jp=ev[rv])&&!V(tv,Jp)&&Hp(tv,Jp,Gp(qp,Jp));tv.prototype=Zp,Zp.constructor=tv,de(O,"Number",tv,{constructor:!0})}var nv=RangeError,ov=RangeError,iv=String,av=Math.floor,uv=F((function(t){var e=rf(B(this)),r="",n=Le(t);if(n<0||n==1/0)throw nv("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(r+=e);return r})),sv=F("".slice),cv=F(1..toFixed),fv=function(t,e,r){return 0===e?r:e%2==1?fv(t,e-1,r*t):fv(t*t,e/2,r)},lv=function(t,e,r){for(var n=-1,o=r;++n<6;)o+=e*t[n],t[n]=o%1e7,o=av(o/1e7)},hv=function(t,e){for(var r=6,n=0;--r>=0;)n+=t[r],t[r]=av(n/e),n=n%e*1e7},pv=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var n=iv(t[e]);r=""===r?n:r+uv("0",7-n.length)+n}return r},vv=j((function(){return"0.000"!==cv(8e-5,3)||"1"!==cv(.9,0)||"1.25"!==cv(1.255,2)||"1000000000000000128"!==cv(0xde0b6b3a7640080,0)}))||!j((function(){cv({})}));function dv(t){return"number"==typeof t}function yv(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),r=Math.PI/180,n=t[0]*r,o=e*r;o=Math.log(Math.tan(Math.PI/4+o/2));return n=(256<<20)*(.5/Math.PI*n+.5),o=(256<<20)*(-.5/Math.PI*o+(r=.5)),[Math.floor(n),Math.floor(o)]}ar({target:"Number",proto:!0,forced:vv},{toFixed:function(t){var e,r,n,o,i=Cp(this),a=Le(t),u=[0,0,0,0,0,0],s="",c="0";if(a<0||a>20)throw ov("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return iv(i);if(i<0&&(s="-",i=-i),i>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(i*fv(2,69,1))-69)<0?i*fv(2,-e,1):i/fv(2,e,1),r*=4503599627370496,(e=52-e)>0){for(lv(u,0,r),n=a;n>=7;)lv(u,1e7,0),n-=7;for(lv(u,fv(10,n,1),0),n=e-1;n>=23;)hv(u,1<<23),n-=23;hv(u,1<<n),lv(u,1,1),hv(u,2),c=pv(u)}else lv(u,0,r),lv(u,1<<-e,0),c=pv(u)+uv("0",a);return c=a>0?s+((o=c.length)<=a?"0."+uv("0",a-o)+c:sv(c,0,o-a)+"."+sv(c,o-a)):s+c}});var gv,mv=/"/g,xv=F("".replace);ar({target:"String",proto:!0,forced:(gv="sub",j((function(){var t=""[gv]('"');return t!==t.toLowerCase()||t.split('"').length>3})))},{sub:function(){return t="sub",e="",r="",n=rf(B(this)),o="<"+t,""!==e&&(o+=" "+e+'="'+xv(rf(r),mv,"&quot;")+'"'),o+">"+n+"</"+t+">";var t,e,r,n,o}});var bv=RegExp.prototype,wv=Kt.PROPER,Ev=RegExp.prototype.toString,Av=j((function(){return"/a/b"!=Ev.call({source:"a",flags:"b"})})),Ov=wv&&"toString"!=Ev.name;(Av||Ov)&&de(RegExp.prototype,"toString",(function(){var t=kt(this);return"/"+rf(t.source)+"/"+rf(function(t){var e=t.flags;return void 0!==e||"flags"in bv||V(t,"flags")||!Pt(bv,t)?e:jt(nf,t)}(t))}),{unsafe:!0});var Sv="undefined"!=typeof Float32Array?Float32Array:Array;function Tv(){var t=new Sv(2);return Sv!=Float32Array&&(t[0]=0,t[1]=0),t}function kv(t,e){var r=new Sv(2);return r[0]=t,r[1]=e,r}function Iv(t,e){return t[0]=e[0],t[1]=e[1],t}function jv(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Pv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function _v(t,e){var r=e[0],n=e[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function Mv(t,e){return t[0]*e[0]+t[1]*e[1]}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Lv,Rv=Pv,Cv=(Lv=Tv(),Tv()),Nv=(Tv(),Tv()),Dv=Tv(),Fv=Tv();function Wv(t,e,r,n,o){return jv(t,r,n),_v(t,t),[o/Mv(e=kv(-t[1],t[0]),kv(-r[1],r[0])),e]}function zv(t,e){return function(t,e,r){return t[0]=e,t[1]=r,t}(t,-e[1],e[0])}function Bv(t,e,r){return Rv(t,e,r),_v(t,t),t}function Uv(t,e){return t[0]===e[0]&&t[1]===e[1]}var Gv=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),s(this,"complex",void 0),s(this,"join",void 0),s(this,"cap",void 0),s(this,"miterLimit",void 0),s(this,"thickness",void 0),s(this,"normal",void 0),s(this,"lastFlip",-1),s(this,"miter",kv(0,0)),s(this,"started",!1),s(this,"dash",!1),s(this,"totalDistance",0),s(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return u(t,[{key:"extrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.segment_gaode2(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.simpleSegment(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.segment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.simpleSegment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,r,n,o,i,a,u){var s=0,c=t.indices,f=t.positions,l=t.normals,h="square"===this.cap,p="bevel"===this.join,v=yv([a[0],a[1]]),g=yv([i[0],i[1]]);Bv(Nv,n,r);var m=0;if(this.dash&&(m=this.lineSegmentDistance(v,g),this.totalDistance+=m),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),!this.started)if(this.started=!0,h){var x=Tv(),b=Tv();jv(x,this.normal,Nv),jv(b,this.normal,Nv),l.push(b[0],b[1],0),l.push(x[0],x[1],0),f.push(r[0],r[1],0|r[2],this.totalDistance-m,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),f.push(r[0],r[1],0|r[2],this.totalDistance-m,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,r,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),o){Uv(n,o)&&jv(o,n,_v(o,Pv(o,n,r))),Bv(Dv,o,n);var w=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),E=w[0],A=w[1],O=Mv(Fv,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join)E>this.miterLimit&&(S=!0);S?(l.push(this.normal[0],this.normal[1],0),l.push(A[0],A[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,y(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),zv(Cv,Dv),Iv(this.normal,Cv),l.push(this.normal[0],this.normal[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(f,l,n,A,E,this.totalDistance),c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,Iv(this.normal,A),s+=2),this.lastFlip=O}else{if(zv(this.normal,Nv),h){var T=Tv(),k=Tv();Rv(k,Nv,this.normal),jv(T,Nv,this.normal),l.push(k[0],k[1],0),l.push(T[0],T[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,n,this.normal,this.thickness,this.totalDistance);c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"simpleSegment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c=yv([n[0],n[1]]),f=yv([r[0],r[1]]);Bv(Nv,c,f);var l=0;if(this.dash&&(l=this.lineSegmentDistance(c,f),this.totalDistance+=l),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),this.started||(this.started=!0,this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-l)),a.push(e+0,e+1,e+2),o){var h=yv([o[0],o[1]]);Uv(c,h)&&jv(h,c,_v(h,Pv(h,c,f))),Bv(Dv,h,c);var p=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),v=p[0],g=p[1];Mv(Fv,this.normal);this.extrusions(u,s,n,g,v,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,Iv(this.normal,g),i+=2,this.lastFlip=-1}else zv(this.normal,Nv),this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2;return i}},{key:"segment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c="square"===this.cap,f="bevel"===this.join,l=yv([n[0],n[1]]),h=yv([r[0],r[1]]);Bv(Nv,l,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(l,h),this.totalDistance+=p),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),!this.started)if(this.started=!0,c){var v=Tv(),g=Tv();jv(v,this.normal,Nv),jv(g,this.normal,Nv),s.push(g[0],g[1],0),s.push(v[0],v[1],0),u.push(r[0],r[1],0|r[2],this.totalDistance-p,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),u.push(r[0],r[1],0|r[2],this.totalDistance-p,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),o){var m=yv([o[0],o[1]]);Uv(l,m)&&jv(m,l,_v(m,Pv(m,l,h))),Bv(Dv,m,l);var x=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),b=x[0],w=x[1],E=Mv(Fv,this.normal)<0?-1:1,A=f;if(!A&&"miter"===this.join)b>this.miterLimit&&(A=!0);A?(s.push(this.normal[0],this.normal[1],0),s.push(w[0],w[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,y(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),zv(Cv,Dv),Iv(this.normal,Cv),s.push(this.normal[0],this.normal[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,i+=3):(this.extrusions(u,s,n,w,b,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,Iv(this.normal,w),i+=2),this.lastFlip=E}else{if(zv(this.normal,Nv),c){var O=Tv(),S=Tv();Rv(S,Nv,this.normal),jv(O,Nv,this.normal),s.push(S[0],S[1],0),s.push(O[0],O[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance);a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2}return i}},{key:"extrusions",value:function(t,e,r,n,o,i){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(r[0],r[1],0|r[2],i,-o,0|r[2]),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],0|r[2],i,o,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}}]),t}();function Hv(t){var e=t.coordinates,r=t.originCoordinates,n=t.version,o=new Gv({dash:!0,join:"bevel"});if("GAODE2.x"===n){var i=e;Array.isArray(i[0][0])||(i=[e]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<i.length;u++){var s=i[u],c=a[u];o.extrude_gaode2(s,c)}}else{var f=e;f[0]&&!Array.isArray(f[0][0])&&(f=[e]),f.forEach((function(t){o.extrude(t)}))}var l=o.complex;return{vertices:l.positions,indices:l.indices,normals:l.normals,indexes:l.indexes,size:6}}function Vv(t){var e=function(t){if(dv(t[0]))return t;if(dv(t[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(dv(t[0][0][0])){var e=0,r=0,n=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],r+=t[1],n++}))})),[e/n,r/n,0]}throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}(t.coordinates);return{vertices:[].concat(y(e),y(e),y(e),y(e)),indices:[0,1,2,2,3,0],size:e.length}}function qv(t){var e=t.coordinates,r=up.flatten(e),n=r.vertices,o=r.dimensions,i=r.holes;return{indices:up(n,i,o),vertices:n,size:o}}var Zv=function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.iconMap,u={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]},a_DistanceAndIndex:function(t,e,r,n,o,i){return void 0===i?[r[3],10]:[r[3],i]},a_Total_Distance:function(t,e,r){return[r[5]]},a_Size:function(t){var e=t.size,r=void 0===e?1:e;return Array.isArray(r)?[r[0],r[1]]:[r,0]},a_Normal:function(t,e,r,n,o){return o},a_Miter:function(t,e,r){return[r[4]]},a_iconMapUV:function(t){var e=t.texture,r=a[e]||{x:0,y:0};return[r.x,r.y]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Hv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size,p=r.indexes;o.forEach((function(t){f.push(t+c)})),l=h;var v=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=v;for(var d=function(r){var o=(null==a?void 0:a.slice(3*r,3*r+3))||[],s=i.slice(r*h,r*h+h),c=0;p&&void 0!==p[r]&&(c=p[r]),n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,s,r,o,c)))}))},g=0;g<v;g++)d(g)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Yv={pointFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.shape2d,u={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]},a_Shape:function(t){var e=t.shape,r=void 0===e?2:e;return[a.indexOf(r)]},a_Extrude:function(t,e,r,n){var o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],i=n%4*3;return[o[i],o[i+1],o[i+2]]},a_Size:function(t){var e=t.size,r=void 0===e?5:e;return Array.isArray(r)?[r[0]]:[r]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Vv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size;o.forEach((function(t){f.push(t+c)})),l=h;var p=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=p;for(var v=function(r){var o=[],a=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,a,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),line:Zv,polygonFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]}},u={sizePerElement:0,elements:[]},s=0,c=[],f=3,o.forEach((function(t,e){var r=qv(t),o=r.indices,i=r.vertices,l=r.normals,h=r.size;o.forEach((function(t){c.push(t+s)})),f=h;var p=i.length/h;u.sizePerElement=f,u.elements.push({featureIdx:e,vertices:i,normals:l,offset:s}),s+=p;for(var v=function(r){var o=[],u=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&a[n.name]&&(i=n.buffer.data).push.apply(i,y(a[n.name](t,e,u,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},$v=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Yv);function Kv(t){return Qv.apply(this,arguments)}function Qv(){return(Qv=o(r().mark((function t(e){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.workerType,o=e.data,!$v[n]){t.next=3;break}return t.abrupt("return",$v[n](o));case 3:return t.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(n,'" non-existent.'))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return fi(Kv),t.WorkerSourceMap=Yv,t.createWorker=fi,t.worker=Kv,t}({});
`,Tt="l7-worker",Fe=3,ct=!0;function Ve(e){sr(Tt,e)}function Zt(){var e=Et(Tt);if(!e)throw new Error("get worker failed by workerName: ".concat(Tt,"."));return e}function Qt(e,i){return Vr.apply(this,arguments)}function Vr(){return Vr=(0,ot.Z)(se().mark(function e(i,t){var n,r,o,u,l;return se().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n=Zt(),r=Le.getWorkerFarm({maxConcurrency:Fe,reuseWorkers:ct}),o=r.getWorkerPool({name:Tt,source:n}),v.next=5,o.startJob(Tt,function(E,w,M){return E.done(M)});case 5:return u=v.sent,u.postMessage("process",{input:{workerType:i,data:t}}),v.next=9,u.result;case 9:return l=v.sent,v.abrupt("return",l.result);case 11:case"end":return v.stop()}},e)})),Vr.apply(this,arguments)}Ve(et);function En(e,i){var t=i.extent,n=t===void 0?[121.168,30.2828,121.384,30.4219]:t,r=new Promise(function(u){e instanceof HTMLImageElement||_i(e)?u([e]):An(e,function(l){u(l)})}),o={originData:e,images:r,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return o}function An(e,i){var t=e,n=[];if(typeof t=="string")bs({url:t},function(u,l){l&&(n.push(l),i(n))});else{var r=t.length,o=0;t.forEach(function(u){bs({url:u},function(l,p){o++,p&&n.push(p),o===r&&i(n)})})}return En}var Dn=ie(38929),bn=ie(3614),oi=ie.n(bn),Zn=function(){function e(i,t,n,r){(0,Ht.Z)(this,e),(0,J.Z)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=r,this.vectorTile=new Dn.VectorTile(new(oi())(i))}return(0,tr.Z)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];if(Array.isArray(n.features))return this.vectorLayerCache[t]=n.features,n.features;for(var r=[],o=0;o<n.length;o++){var u=n.feature(o),l=u.toGeoJSON(this.x,this.y,this.z);r.push((0,U.Z)((0,U.Z)({},l),{},{properties:(0,U.Z)({id:l.id},l.properties)}))}return this.vectorLayerCache[t]=r,r}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),ti={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},Qn=function(){var e=(0,ot.Z)(se().mark(function i(t,n,r,o,u){var l;return se().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l=bl(t,n),v.abrupt("return",new Promise(function(E){if(u)u({x:r.x,y:r.y,z:r.z},function(M,k){if(M||!k)E(void 0);else{var D=new Zn(k,r.x,r.y,r.z);E(D)}});else{var w=qa((0,U.Z)((0,U.Z)({},o),{},{url:l}),function(M,k){if(M||!k)E(void 0);else{var D=new Zn(k,r.x,r.y,r.z);E(D)}});r.xhrCancel=function(){return w.abort()}}}));case 2:case"end":return v.stop()}},i)}));return function(t,n,r,o,u){return e.apply(this,arguments)}}();function $n(e,i){var t=Array.isArray(e)?e[0]:e,n=function(u,l){return Qn(t,u,l,i==null?void 0:i.requestParameters,i==null?void 0:i.getCustomData)},r=(0,U.Z)((0,U.Z)((0,U.Z)({},ti),i),{},{getTileData:n});return{data:t,dataArray:[],tilesetOptions:r,isTile:!0}}function Zi(e,i,t){switch(e){case"+":return i+t;case"-":return i-t;case"*":return i*t;case"/":return i/t;case"%":return i%t;case"^":return Math.pow(i,t);case"abs":return Math.abs(i);case"floor":return Math.floor(i);case"round":return Math.round(i);case"ceil":return Math.ceil(i);case"sin":return Math.sin(i);case"cos":return Math.cos(i);case"atan":return t===-1?Math.atan(i):Math.atan2(i,t);case"min":return Math.min(i,t);case"max":return Math.max(i,t);case"log10":return Math.log(i);case"log2":return Math.log2(i);default:return console.warn("Calculate symbol err! Return default 0"),0}}function Qa(e,i){for(var t=i[0],n=t.width,r=t.height,o=i.map(function(k){return k.rasterData}),u=n*r,l=[],p=JSON.stringify(e),v=0;v<u;v++){var E=JSON.parse(p),w=tu(E,o,v);if(typeof w=="number")l.push(w);else{var M=Ja(E);l.push(M)}}return l}function tu(e,i,t){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return i[e[1]][t]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,r){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[r]=i[n[1]][t]}catch(o){console.warn("Raster Data err!"),e[r]=0}break;default:tu(n,i,t)}})}function Do(e){var i=(0,Ti.Z)(e,3),t=i[0],n=i[1],r=n===void 0?-1:n,o=i[2],u=o===void 0?-1:o;if(t===void 0)return console.warn("Express err!"),["+",0,0];var l=t.replace(/\s+/g,"");return[l,r,u]}function Ja(e){var i=Do(e),t=i[0],n=i[1],r=i[2];return Array.isArray(n)&&(n=Ja(e[1])),Array.isArray(r)&&(r=Ja(e[2])),Zi(t,n,r)}var $c={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:$u}};function $u(e,i){for(var t=e[0].rasterData,n=e[1].rasterData,r=e[2].rasterData,o=[],u=(i==null?void 0:i.countCut)||[2,98],l=(0,Ti.Z)(u,2),p=l[0],v=l[1],E=(i==null?void 0:i.RMinMax)||Xl(t,p,v),w=(i==null?void 0:i.GMinMax)||Xl(n,p,v),M=(i==null?void 0:i.BMinMax)||Xl(r,p,v),k=0;k<t.length;k++)o.push(Math.max(0,t[k]-E[0])),o.push(Math.max(0,n[k]-w[0])),o.push(Math.max(0,r[k]-M[0]));return{rasterData:o,rMinMax:E,gMinMax:w,bMinMax:M}}function Xl(e,i,t){var n=e.slice().sort(function(l,p){return l-p}),r=n.length,o=n[Math.ceil(r*i/100)],u=n[Math.ceil(r*t/100)];return[o,u]}function Sl(e,i,t){return sp.apply(this,arguments)}function sp(){return sp=(0,ot.Z)(se().mark(function e(i,t,n){var r,o,u,l,p,v;return se().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(i.length!==0){w.next=2;break}return w.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return w.next=4,Promise.all(i.map(function(M){var k=M.data,D=M.bands,N=D===void 0?[0]:D;return t(k,N)}));case 4:r=w.sent,o=[],r.forEach(function(M){Array.isArray(M)?o.push.apply(o,(0,H.Z)(M)):o.push(M)}),u=o[0],l=u.width,p=u.height,w.t0=(0,jr.Z)(n),w.next=w.t0==="function"?11:w.t0==="object"?13:15;break;case 11:return v=n(o),w.abrupt("break",16);case 13:return Array.isArray(n)?v={rasterData:Qa(n,o)}:v=wl(n,o),w.abrupt("break",16);case 15:v={rasterData:o[0].rasterData};case 16:return w.abrupt("return",(0,U.Z)((0,U.Z)({},v),{},{width:l,height:p}));case 17:case"end":return w.stop()}},e)})),sp.apply(this,arguments)}function wl(e,i){var t=$c[e.type];if(t.type==="function")return t.method(i,e==null?void 0:e.options);if(t.type==="operation")return e.type==="rgb"?yf(t.expression,i):{rasterData:Qa(t.expression,i)}}function yf(e,i){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var t=Qa(e.r||["band",0],i),n=Qa(e.g||["band",0],i),r=Qa(e.b||["band",0],i);return[t,n,r]}function lh(e,i,t,n){return Ed.apply(this,arguments)}function Ed(){return Ed=(0,ot.Z)(se().mark(function e(i,t,n,r){var o;return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,Sl(i,t,n);case 2:o=l.sent,r(null,{data:o});case 4:case"end":return l.stop()}},e)})),Ed.apply(this,arguments)}function ru(e,i){return e.map(function(t){return t[i]*1})}function Xp(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function zh(e){return Array.isArray(e)?e.length===0?!1:!!Xp(e[0]):!1}function $p(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function Sd(e,i){var t=i.extent,n=i.width,r=i.height,o=i.min,u=i.max,l=i.format,p=i.operation,v,E,w;if(l===void 0||$p(e))v=Array.from(e),E=n,w=r;else{var M=Array.isArray(e)?e:[e];v=Sl(M,l,p)}var k={_id:1,dataArray:[{_id:1,data:v,width:E,height:w,min:o,max:u,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return k}var hv=ie(28660),kn=ie(86700),ch=ie(84879),fr={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},pv=ie(31745),n0=ie.n(pv);function hu(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Zh(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function Zh(e,i){if(!!e){if(typeof e=="string")return Ud(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ud(e,i)}}function Ud(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}var a=30;function s(e){var i=e.characterSet,t=e.getFontWidth,n=e.fontHeight,r=e.buffer,o=e.maxCanvasWidth,u=e.mapping,l=u===void 0?{}:u,p=e.xOffset,v=p===void 0?0:p,E=e.yOffset,w=E===void 0?0:E,M=0,k=v;Array.from(i).forEach(function(N,V){if(!l[N]){var q=t(N,V);k+a>o&&(k=0,M++),l[N]={x:k,y:w+M*a,width:a,height:a,advance:q},k+=a}});var D=n+r*2;return{mapping:l,xOffset:k,yOffset:w+M*D,canvasHeight:b(w+(M+1)*D)}}function c(e,i,t){var n=0,r=0,o=0,u=[],l={},p=hu(e),v;try{for(p.s();!(v=p.n()).done;){var E=v.value;if(!l[E.id]){var w=E.size;n+w+i>t&&(g(l,u,r),n=0,r=o+r+i,o=0,u=[]),u.push({icon:E,xOffset:n}),n=n+w+i,o=Math.max(o,w)}}}catch(k){p.e(k)}finally{p.f()}u.length>0&&g(l,u,r);var M=b(o+r+i);return{mapping:l,canvasHeight:M}}function g(e,i,t){var n=hu(i),r;try{for(n.s();!(r=n.n()).done;){var o=r.value,u=o.icon,l=o.xOffset;e[u.id]=(0,U.Z)((0,U.Z)({},u),{},{x:l,y:t,image:u.image,width:u.width,height:u.height})}}catch(p){n.e(p)}finally{n.f()}}function b(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var A,T;function O(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=z(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function z(e,i){if(!!e){if(typeof e=="string")return $(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return $(e,i)}}function $(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function Q(e){var i=re();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function re(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var me=Ln(),Ee="sans-serif",$e="normal",qe=24,bt=3,st=.25,Nt=8,er=1024,_r=1,Er=1,Br=3,dn=null;function Ln(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function xi(e,i,t,n){e.font="".concat(n," ").concat(t,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function jn(e,i){for(var t=0;t<e.length;t++)i.data[4*t+3]=e[t]}var Ai=(A=(0,kn.b2)(),A(T=function(e){(0,Fr.Z)(t,e);var i=Q(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"fontAtlas",void 0),(0,J.Z)((0,Ke.Z)(n),"iconFontMap",void 0),(0,J.Z)((0,Ke.Z)(n),"iconFontGlyphs",{}),(0,J.Z)((0,Ke.Z)(n),"fontOptions",void 0),(0,J.Z)((0,Ke.Z)(n),"key",void 0),(0,J.Z)((0,Ke.Z)(n),"cache",new Kh(Br)),n}return(0,tr.Z)(t,[{key:"scale",get:function(){return Er}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Ee,fontWeight:$e,characterSet:me,fontSize:qe,buffer:bt,sdf:!0,cutoff:st,radius:Nt,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var o=this;r.forEach(function(u){o.iconFontGlyphs[u.name]=u.unicode})}},{key:"addIconFont",value:function(r,o){this.iconFontMap.set(r,o)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=(0,U.Z)((0,U.Z)({},this.fontOptions),r),this.key=this.getKey();var o=this.getNewChars(this.key,this.fontOptions.characterSet),u=this.cache.get(this.key);if(!(u&&o.length===0)){var l=this.generateFontAtlas(this.key,o,u);this.fontAtlas=l,this.cache.set(this.key,l)}}},{key:"addFontFace",value:function(r,o){var u=this,l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(r,`';
            src: url('`).concat(o,`') format('woff2'),
            url('`).concat(o,`') format('woff'),
            url('`).concat(o,`') format('truetype');
        }`),l.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(r),"L7text"),document.fonts.ready.then(function(){u.emit("fontloaded",{fontFamily:r})})}catch(p){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(p)}},document.getElementsByTagName("head")[0].appendChild(l)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,o,u){var l=this.fontOptions,p=l.fontFamily,v=l.fontWeight,E=l.fontSize,w=l.buffer,M=l.sdf,k=l.radius,D=l.cutoff,N=l.iconfont,V=u&&u.data;V||(V=wa.document.createElement("canvas"),V.width=er);var q=V.getContext("2d",{willReadFrequently:!0});xi(q,p,E,v);var fe=s((0,U.Z)({getFontWidth:function(vu){return q.measureText(vu).width},fontHeight:E*Er,buffer:w,characterSet:o,maxCanvasWidth:er},u&&{mapping:u.mapping,xOffset:u.xOffset,yOffset:u.yOffset})),he=fe.mapping,Be=fe.canvasHeight,Ge=fe.xOffset,St=fe.yOffset,Ut=q.getImageData(0,0,V.width,V.height);if(V.height=Be,q.putImageData(Ut,0,0),xi(q,p,E,v),M){var Yt=new(n0())(E,w,k,D,p,v),nr=q.getImageData(0,0,Yt.size,Yt.size),Rr=O(o),Tr;try{for(Rr.s();!(Tr=Rr.n()).done;){var on=Tr.value;if(N){var Hn=String.fromCharCode(parseInt(on.replace("&#x","").replace(";",""),16)),di=Yt.draw(Hn);jn(di,nr)}else jn(Yt.draw(on),nr);q.putImageData(nr,he[on].x,he[on].y)}}catch(js){Rr.e(js)}finally{Rr.f()}}else{var za=O(o),Co;try{for(za.s();!(Co=za.n()).done;){var Ds=Co.value;q.fillText(Ds,he[Ds].x,he[Ds].y+E*_r)}}catch(js){za.e(js)}finally{za.f()}}return{xOffset:Ge,yOffset:St,mapping:he,data:V,width:V.width,height:V.height}}},{key:"getKey",value:function(){var r=this.fontOptions,o=r.fontFamily,u=r.fontWeight;return"".concat(o,"_").concat(u)}},{key:"getNewChars",value:function(r,o){var u=this.cache.get(r);if(!u)return o;var l=[],p=u.mapping,v=new Set(Object.keys(p)),E=new Set(o);return E.forEach(function(w){v.has(w)||l.push(w)}),l}}]),t}(fs.EventEmitter))||T),Wn,la;function ji(e){var i=hi();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function hi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ca=3,oa=1024,Pa=64,Ci=(Wn=(0,kn.b2)(),Wn(la=function(e){(0,Fr.Z)(t,e);var i=ji(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"canvasHeight",128),(0,J.Z)((0,Ke.Z)(n),"texture",void 0),(0,J.Z)((0,Ke.Z)(n),"canvas",void 0),(0,J.Z)((0,Ke.Z)(n),"iconData",void 0),(0,J.Z)((0,Ke.Z)(n),"iconMap",void 0),(0,J.Z)((0,Ke.Z)(n),"ctx",void 0),(0,J.Z)((0,Ke.Z)(n),"loadingImageCount",0),n}return(0,tr.Z)(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=wa.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=(0,ot.Z)(se().mark(function o(u,l){var p,v;return se().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return p=new Image,this.loadingImageCount++,this.hasImage(u)?console.warn("Image Id already exists"):this.iconData.push({id:u,size:Pa}),this.updateIconMap(),w.next=6,this.loadImage(l);case 6:p=w.sent,v=this.iconData.find(function(M){return M.id===u}),v&&(v.image=p,v.width=p.width,v.height=p.height),this.update();case 10:case"end":return w.stop()}},o,this)}));function r(o,u){return n.apply(this,arguments)}return r}()},{key:"addImageMini",value:function(r,o,u){var l=this,p=u.getSceneConfig().canvas,v=p.createImage();if(this.loadingImageCount++,this.hasImage(r))throw new Error("Image Id already exists");this.iconData.push({id:r,size:Pa}),this.updateIconMap(),this.loadImageMini(o,p).then(function(E){v=E;var w=l.iconData.find(function(M){return M.id===r});w&&(w.image=v,w.width=v.width,w.height=v.height),l.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(r){return this.iconMap.hasOwnProperty(r)}},{key:"removeImage",value:function(r){this.hasImage(r)&&(this.iconData=this.iconData.filter(function(o){return o.id!==r}),delete this.iconMap[r],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(r){return new Promise(function(o,u){if(r instanceof HTMLImageElement){o(r);return}var l=new Image;l.crossOrigin="anonymous",l.onload=function(){o(l)},l.onerror=function(){u(new Error("Could not load image at "+r))},l.src=r instanceof File?URL.createObjectURL(r):r})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var r=this;this.canvas.width=oa,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(o){var u=r.iconMap[o],l=u.x,p=u.y,v=u.image,E=u.width,w=E===void 0?64:E,M=u.height,k=M===void 0?64:M,D=Math.max(w,k),N=D/Pa,V=k/N,q=w/N;v&&r.ctx.drawImage(v,l+(Pa-q)/2,p+(Pa-V)/2,q,V)})}},{key:"updateIconMap",value:function(){var r=c(this.iconData,Ca,oa),o=r.mapping,u=r.canvasHeight;this.iconMap=o,this.canvasHeight=u}},{key:"loadImageMini",value:function(r,o){return new Promise(function(u,l){var p=o.createImage();p.crossOrigin="anonymous",p.onload=function(){u(p)},p.onerror=function(){l(new Error("Could not load image at "+r))},p.src=r})}}]),t}(fs.EventEmitter))||la),Mi=ie(49685);function _o(){var e=new Mi.WT(16);return Mi.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Os(e){var i=new Mi.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function As(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Qo(e,i,t,n,r,o,u,l,p,v,E,w,M,k,D,N){var V=new Mi.WT(16);return V[0]=e,V[1]=i,V[2]=t,V[3]=n,V[4]=r,V[5]=o,V[6]=u,V[7]=l,V[8]=p,V[9]=v,V[10]=E,V[11]=w,V[12]=M,V[13]=k,V[14]=D,V[15]=N,V}function as(e,i,t,n,r,o,u,l,p,v,E,w,M,k,D,N,V){return e[0]=i,e[1]=t,e[2]=n,e[3]=r,e[4]=o,e[5]=u,e[6]=l,e[7]=p,e[8]=v,e[9]=E,e[10]=w,e[11]=M,e[12]=k,e[13]=D,e[14]=N,e[15]=V,e}function Fs(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pu(e,i){if(e===i){var t=i[1],n=i[2],r=i[3],o=i[6],u=i[7],l=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=t,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=o,e[11]=i[14],e[12]=r,e[13]=u,e[14]=l}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function Au(e,i){var t=i[0],n=i[1],r=i[2],o=i[3],u=i[4],l=i[5],p=i[6],v=i[7],E=i[8],w=i[9],M=i[10],k=i[11],D=i[12],N=i[13],V=i[14],q=i[15],fe=t*l-n*u,he=t*p-r*u,Be=t*v-o*u,Ge=n*p-r*l,St=n*v-o*l,Ut=r*v-o*p,Yt=E*N-w*D,nr=E*V-M*D,Rr=E*q-k*D,Tr=w*V-M*N,on=w*q-k*N,Hn=M*q-k*V,di=fe*Hn-he*on+Be*Tr+Ge*Rr-St*nr+Ut*Yt;return di?(di=1/di,e[0]=(l*Hn-p*on+v*Tr)*di,e[1]=(r*on-n*Hn-o*Tr)*di,e[2]=(N*Ut-V*St+q*Ge)*di,e[3]=(M*St-w*Ut-k*Ge)*di,e[4]=(p*Rr-u*Hn-v*nr)*di,e[5]=(t*Hn-r*Rr+o*nr)*di,e[6]=(V*Be-D*Ut-q*he)*di,e[7]=(E*Ut-M*Be+k*he)*di,e[8]=(u*on-l*Rr+v*Yt)*di,e[9]=(n*Rr-t*on-o*Yt)*di,e[10]=(D*St-N*Be+q*fe)*di,e[11]=(w*Be-E*St-k*fe)*di,e[12]=(l*nr-u*Tr-p*Yt)*di,e[13]=(t*Tr-n*nr+r*Yt)*di,e[14]=(N*he-D*Ge-V*fe)*di,e[15]=(E*Ge-w*he+M*fe)*di,e):null}function nu(e,i){var t=i[0],n=i[1],r=i[2],o=i[3],u=i[4],l=i[5],p=i[6],v=i[7],E=i[8],w=i[9],M=i[10],k=i[11],D=i[12],N=i[13],V=i[14],q=i[15];return e[0]=l*(M*q-k*V)-w*(p*q-v*V)+N*(p*k-v*M),e[1]=-(n*(M*q-k*V)-w*(r*q-o*V)+N*(r*k-o*M)),e[2]=n*(p*q-v*V)-l*(r*q-o*V)+N*(r*v-o*p),e[3]=-(n*(p*k-v*M)-l*(r*k-o*M)+w*(r*v-o*p)),e[4]=-(u*(M*q-k*V)-E*(p*q-v*V)+D*(p*k-v*M)),e[5]=t*(M*q-k*V)-E*(r*q-o*V)+D*(r*k-o*M),e[6]=-(t*(p*q-v*V)-u*(r*q-o*V)+D*(r*v-o*p)),e[7]=t*(p*k-v*M)-u*(r*k-o*M)+E*(r*v-o*p),e[8]=u*(w*q-k*N)-E*(l*q-v*N)+D*(l*k-v*w),e[9]=-(t*(w*q-k*N)-E*(n*q-o*N)+D*(n*k-o*w)),e[10]=t*(l*q-v*N)-u*(n*q-o*N)+D*(n*v-o*l),e[11]=-(t*(l*k-v*w)-u*(n*k-o*w)+E*(n*v-o*l)),e[12]=-(u*(w*V-M*N)-E*(l*V-p*N)+D*(l*M-p*w)),e[13]=t*(w*V-M*N)-E*(n*V-r*N)+D*(n*M-r*w),e[14]=-(t*(l*V-p*N)-u*(n*V-r*N)+D*(n*p-r*l)),e[15]=t*(l*M-p*w)-u*(n*M-r*w)+E*(n*p-r*l),e}function Yu(e){var i=e[0],t=e[1],n=e[2],r=e[3],o=e[4],u=e[5],l=e[6],p=e[7],v=e[8],E=e[9],w=e[10],M=e[11],k=e[12],D=e[13],N=e[14],V=e[15],q=i*u-t*o,fe=i*l-n*o,he=i*p-r*o,Be=t*l-n*u,Ge=t*p-r*u,St=n*p-r*l,Ut=v*D-E*k,Yt=v*N-w*k,nr=v*V-M*k,Rr=E*N-w*D,Tr=E*V-M*D,on=w*V-M*N;return q*on-fe*Tr+he*Rr+Be*nr-Ge*Yt+St*Ut}function Oo(e,i,t){var n=i[0],r=i[1],o=i[2],u=i[3],l=i[4],p=i[5],v=i[6],E=i[7],w=i[8],M=i[9],k=i[10],D=i[11],N=i[12],V=i[13],q=i[14],fe=i[15],he=t[0],Be=t[1],Ge=t[2],St=t[3];return e[0]=he*n+Be*l+Ge*w+St*N,e[1]=he*r+Be*p+Ge*M+St*V,e[2]=he*o+Be*v+Ge*k+St*q,e[3]=he*u+Be*E+Ge*D+St*fe,he=t[4],Be=t[5],Ge=t[6],St=t[7],e[4]=he*n+Be*l+Ge*w+St*N,e[5]=he*r+Be*p+Ge*M+St*V,e[6]=he*o+Be*v+Ge*k+St*q,e[7]=he*u+Be*E+Ge*D+St*fe,he=t[8],Be=t[9],Ge=t[10],St=t[11],e[8]=he*n+Be*l+Ge*w+St*N,e[9]=he*r+Be*p+Ge*M+St*V,e[10]=he*o+Be*v+Ge*k+St*q,e[11]=he*u+Be*E+Ge*D+St*fe,he=t[12],Be=t[13],Ge=t[14],St=t[15],e[12]=he*n+Be*l+Ge*w+St*N,e[13]=he*r+Be*p+Ge*M+St*V,e[14]=he*o+Be*v+Ge*k+St*q,e[15]=he*u+Be*E+Ge*D+St*fe,e}function Vs(e,i,t){var n=t[0],r=t[1],o=t[2],u,l,p,v,E,w,M,k,D,N,V,q;return i===e?(e[12]=i[0]*n+i[4]*r+i[8]*o+i[12],e[13]=i[1]*n+i[5]*r+i[9]*o+i[13],e[14]=i[2]*n+i[6]*r+i[10]*o+i[14],e[15]=i[3]*n+i[7]*r+i[11]*o+i[15]):(u=i[0],l=i[1],p=i[2],v=i[3],E=i[4],w=i[5],M=i[6],k=i[7],D=i[8],N=i[9],V=i[10],q=i[11],e[0]=u,e[1]=l,e[2]=p,e[3]=v,e[4]=E,e[5]=w,e[6]=M,e[7]=k,e[8]=D,e[9]=N,e[10]=V,e[11]=q,e[12]=u*n+E*r+D*o+i[12],e[13]=l*n+w*r+N*o+i[13],e[14]=p*n+M*r+V*o+i[14],e[15]=v*n+k*r+q*o+i[15]),e}function ba(e,i,t){var n=t[0],r=t[1],o=t[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*o,e[9]=i[9]*o,e[10]=i[10]*o,e[11]=i[11]*o,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Bo(e,i,t,n){var r=n[0],o=n[1],u=n[2],l=Math.hypot(r,o,u),p,v,E,w,M,k,D,N,V,q,fe,he,Be,Ge,St,Ut,Yt,nr,Rr,Tr,on,Hn,di,za;return l<Mi.Ib?null:(l=1/l,r*=l,o*=l,u*=l,p=Math.sin(t),v=Math.cos(t),E=1-v,w=i[0],M=i[1],k=i[2],D=i[3],N=i[4],V=i[5],q=i[6],fe=i[7],he=i[8],Be=i[9],Ge=i[10],St=i[11],Ut=r*r*E+v,Yt=o*r*E+u*p,nr=u*r*E-o*p,Rr=r*o*E-u*p,Tr=o*o*E+v,on=u*o*E+r*p,Hn=r*u*E+o*p,di=o*u*E-r*p,za=u*u*E+v,e[0]=w*Ut+N*Yt+he*nr,e[1]=M*Ut+V*Yt+Be*nr,e[2]=k*Ut+q*Yt+Ge*nr,e[3]=D*Ut+fe*Yt+St*nr,e[4]=w*Rr+N*Tr+he*on,e[5]=M*Rr+V*Tr+Be*on,e[6]=k*Rr+q*Tr+Ge*on,e[7]=D*Rr+fe*Tr+St*on,e[8]=w*Hn+N*di+he*za,e[9]=M*Hn+V*di+Be*za,e[10]=k*Hn+q*di+Ge*za,e[11]=D*Hn+fe*di+St*za,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function po(e,i,t){var n=Math.sin(t),r=Math.cos(t),o=i[4],u=i[5],l=i[6],p=i[7],v=i[8],E=i[9],w=i[10],M=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=o*r+v*n,e[5]=u*r+E*n,e[6]=l*r+w*n,e[7]=p*r+M*n,e[8]=v*r-o*n,e[9]=E*r-u*n,e[10]=w*r-l*n,e[11]=M*r-p*n,e}function ja(e,i,t){var n=Math.sin(t),r=Math.cos(t),o=i[0],u=i[1],l=i[2],p=i[3],v=i[8],E=i[9],w=i[10],M=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*r-v*n,e[1]=u*r-E*n,e[2]=l*r-w*n,e[3]=p*r-M*n,e[8]=o*n+v*r,e[9]=u*n+E*r,e[10]=l*n+w*r,e[11]=p*n+M*r,e}function qu(e,i,t){var n=Math.sin(t),r=Math.cos(t),o=i[0],u=i[1],l=i[2],p=i[3],v=i[4],E=i[5],w=i[6],M=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*r+v*n,e[1]=u*r+E*n,e[2]=l*r+w*n,e[3]=p*r+M*n,e[4]=v*r-o*n,e[5]=E*r-u*n,e[6]=w*r-l*n,e[7]=M*r-p*n,e}function Pu(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Jo(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $s(e,i,t){var n=t[0],r=t[1],o=t[2],u=Math.hypot(n,r,o),l,p,v;return u<Mi.Ib?null:(u=1/u,n*=u,r*=u,o*=u,l=Math.sin(i),p=Math.cos(i),v=1-p,e[0]=n*n*v+p,e[1]=r*n*v+o*l,e[2]=o*n*v-r*l,e[3]=0,e[4]=n*r*v-o*l,e[5]=r*r*v+p,e[6]=o*r*v+n*l,e[7]=0,e[8]=n*o*v+r*l,e[9]=r*o*v-n*l,e[10]=o*o*v+p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Ku(e,i){var t=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=t,e[7]=0,e[8]=0,e[9]=-t,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function so(e,i){var t=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-t,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=t,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ru(e,i){var t=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=t,e[2]=0,e[3]=0,e[4]=-t,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $l(e,i,t){var n=i[0],r=i[1],o=i[2],u=i[3],l=n+n,p=r+r,v=o+o,E=n*l,w=n*p,M=n*v,k=r*p,D=r*v,N=o*v,V=u*l,q=u*p,fe=u*v;return e[0]=1-(k+N),e[1]=w+fe,e[2]=M-q,e[3]=0,e[4]=w-fe,e[5]=1-(E+N),e[6]=D+V,e[7]=0,e[8]=M+q,e[9]=D-V,e[10]=1-(E+k),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Gf(e,i){var t=new Mi.WT(3),n=-i[0],r=-i[1],o=-i[2],u=i[3],l=i[4],p=i[5],v=i[6],E=i[7],w=n*n+r*r+o*o+u*u;return w>0?(t[0]=(l*u+E*n+p*o-v*r)*2/w,t[1]=(p*u+E*r+v*n-l*o)*2/w,t[2]=(v*u+E*o+l*r-p*n)*2/w):(t[0]=(l*u+E*n+p*o-v*r)*2,t[1]=(p*u+E*r+v*n-l*o)*2,t[2]=(v*u+E*o+l*r-p*n)*2),$l(e,i,t),e}function Wo(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function ca(e,i){var t=i[0],n=i[1],r=i[2],o=i[4],u=i[5],l=i[6],p=i[8],v=i[9],E=i[10];return e[0]=Math.hypot(t,n,r),e[1]=Math.hypot(o,u,l),e[2]=Math.hypot(p,v,E),e}function Yc(e,i){var t=new Mi.WT(3);ca(t,i);var n=1/t[0],r=1/t[1],o=1/t[2],u=i[0]*n,l=i[1]*r,p=i[2]*o,v=i[4]*n,E=i[5]*r,w=i[6]*o,M=i[8]*n,k=i[9]*r,D=i[10]*o,N=u+E+D,V=0;return N>0?(V=Math.sqrt(N+1)*2,e[3]=.25*V,e[0]=(w-k)/V,e[1]=(M-p)/V,e[2]=(l-v)/V):u>E&&u>D?(V=Math.sqrt(1+u-E-D)*2,e[3]=(w-k)/V,e[0]=.25*V,e[1]=(l+v)/V,e[2]=(M+p)/V):E>D?(V=Math.sqrt(1+E-u-D)*2,e[3]=(M-p)/V,e[0]=(l+v)/V,e[1]=.25*V,e[2]=(w+k)/V):(V=Math.sqrt(1+D-u-E)*2,e[3]=(l-v)/V,e[0]=(M+p)/V,e[1]=(w+k)/V,e[2]=.25*V),e}function Qu(e,i,t,n){var r=i[0],o=i[1],u=i[2],l=i[3],p=r+r,v=o+o,E=u+u,w=r*p,M=r*v,k=r*E,D=o*v,N=o*E,V=u*E,q=l*p,fe=l*v,he=l*E,Be=n[0],Ge=n[1],St=n[2];return e[0]=(1-(D+V))*Be,e[1]=(M+he)*Be,e[2]=(k-fe)*Be,e[3]=0,e[4]=(M-he)*Ge,e[5]=(1-(w+V))*Ge,e[6]=(N+q)*Ge,e[7]=0,e[8]=(k+fe)*St,e[9]=(N-q)*St,e[10]=(1-(w+D))*St,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Cs(e,i,t,n,r){var o=i[0],u=i[1],l=i[2],p=i[3],v=o+o,E=u+u,w=l+l,M=o*v,k=o*E,D=o*w,N=u*E,V=u*w,q=l*w,fe=p*v,he=p*E,Be=p*w,Ge=n[0],St=n[1],Ut=n[2],Yt=r[0],nr=r[1],Rr=r[2],Tr=(1-(N+q))*Ge,on=(k+Be)*Ge,Hn=(D-he)*Ge,di=(k-Be)*St,za=(1-(M+q))*St,Co=(V+fe)*St,Ds=(D+he)*Ut,js=(V-fe)*Ut,vu=(1-(M+N))*Ut;return e[0]=Tr,e[1]=on,e[2]=Hn,e[3]=0,e[4]=di,e[5]=za,e[6]=Co,e[7]=0,e[8]=Ds,e[9]=js,e[10]=vu,e[11]=0,e[12]=t[0]+Yt-(Tr*Yt+di*nr+Ds*Rr),e[13]=t[1]+nr-(on*Yt+za*nr+js*Rr),e[14]=t[2]+Rr-(Hn*Yt+Co*nr+vu*Rr),e[15]=1,e}function Cp(e,i){var t=i[0],n=i[1],r=i[2],o=i[3],u=t+t,l=n+n,p=r+r,v=t*u,E=n*u,w=n*l,M=r*u,k=r*l,D=r*p,N=o*u,V=o*l,q=o*p;return e[0]=1-w-D,e[1]=E+q,e[2]=M-V,e[3]=0,e[4]=E-q,e[5]=1-v-D,e[6]=k+N,e[7]=0,e[8]=M+V,e[9]=k-N,e[10]=1-v-w,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Bl(e,i,t,n,r,o,u){var l=1/(t-i),p=1/(r-n),v=1/(o-u);return e[0]=o*2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*p,e[6]=0,e[7]=0,e[8]=(t+i)*l,e[9]=(r+n)*p,e[10]=(u+o)*v,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*o*2*v,e[15]=0,e}function up(e,i,t,n,r){var o=1/Math.tan(i/2),u;return e[0]=o/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==Infinity?(u=1/(n-r),e[10]=(r+n)*u,e[14]=2*r*n*u):(e[10]=-1,e[14]=-2*n),e}var Yp=up;function Tp(e,i,t,n,r){var o=1/Math.tan(i/2),u;return e[0]=o/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==Infinity?(u=1/(n-r),e[10]=r*u,e[14]=r*n*u):(e[10]=-1,e[14]=-n),e}function qp(e,i,t,n){var r=Math.tan(i.upDegrees*Math.PI/180),o=Math.tan(i.downDegrees*Math.PI/180),u=Math.tan(i.leftDegrees*Math.PI/180),l=Math.tan(i.rightDegrees*Math.PI/180),p=2/(u+l),v=2/(r+o);return e[0]=p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=v,e[6]=0,e[7]=0,e[8]=-((u-l)*p*.5),e[9]=(r-o)*v*.5,e[10]=n/(t-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*t/(t-n),e[15]=0,e}function Kp(e,i,t,n,r,o,u){var l=1/(i-t),p=1/(n-r),v=1/(o-u);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*v,e[11]=0,e[12]=(i+t)*l,e[13]=(r+n)*p,e[14]=(u+o)*v,e[15]=1,e}var Mp=Kp;function fh(e,i,t,n,r,o,u){var l=1/(i-t),p=1/(n-r),v=1/(o-u);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=v,e[11]=0,e[12]=(i+t)*l,e[13]=(r+n)*p,e[14]=o*v,e[15]=1,e}function Tc(e,i,t,n){var r,o,u,l,p,v,E,w,M,k,D=i[0],N=i[1],V=i[2],q=n[0],fe=n[1],he=n[2],Be=t[0],Ge=t[1],St=t[2];return Math.abs(D-Be)<Mi.Ib&&Math.abs(N-Ge)<Mi.Ib&&Math.abs(V-St)<Mi.Ib?Fs(e):(E=D-Be,w=N-Ge,M=V-St,k=1/Math.hypot(E,w,M),E*=k,w*=k,M*=k,r=fe*M-he*w,o=he*E-q*M,u=q*w-fe*E,k=Math.hypot(r,o,u),k?(k=1/k,r*=k,o*=k,u*=k):(r=0,o=0,u=0),l=w*u-M*o,p=M*r-E*u,v=E*o-w*r,k=Math.hypot(l,p,v),k?(k=1/k,l*=k,p*=k,v*=k):(l=0,p=0,v=0),e[0]=r,e[1]=l,e[2]=E,e[3]=0,e[4]=o,e[5]=p,e[6]=w,e[7]=0,e[8]=u,e[9]=v,e[10]=M,e[11]=0,e[12]=-(r*D+o*N+u*V),e[13]=-(l*D+p*N+v*V),e[14]=-(E*D+w*N+M*V),e[15]=1,e)}function lp(e,i,t,n){var r=i[0],o=i[1],u=i[2],l=n[0],p=n[1],v=n[2],E=r-t[0],w=o-t[1],M=u-t[2],k=E*E+w*w+M*M;k>0&&(k=1/Math.sqrt(k),E*=k,w*=k,M*=k);var D=p*M-v*w,N=v*E-l*M,V=l*w-p*E;return k=D*D+N*N+V*V,k>0&&(k=1/Math.sqrt(k),D*=k,N*=k,V*=k),e[0]=D,e[1]=N,e[2]=V,e[3]=0,e[4]=w*V-M*N,e[5]=M*D-E*V,e[6]=E*N-w*D,e[7]=0,e[8]=E,e[9]=w,e[10]=M,e[11]=0,e[12]=r,e[13]=o,e[14]=u,e[15]=1,e}function _f(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function hs(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Gs(e,i,t){return e[0]=i[0]+t[0],e[1]=i[1]+t[1],e[2]=i[2]+t[2],e[3]=i[3]+t[3],e[4]=i[4]+t[4],e[5]=i[5]+t[5],e[6]=i[6]+t[6],e[7]=i[7]+t[7],e[8]=i[8]+t[8],e[9]=i[9]+t[9],e[10]=i[10]+t[10],e[11]=i[11]+t[11],e[12]=i[12]+t[12],e[13]=i[13]+t[13],e[14]=i[14]+t[14],e[15]=i[15]+t[15],e}function Ip(e,i,t){return e[0]=i[0]-t[0],e[1]=i[1]-t[1],e[2]=i[2]-t[2],e[3]=i[3]-t[3],e[4]=i[4]-t[4],e[5]=i[5]-t[5],e[6]=i[6]-t[6],e[7]=i[7]-t[7],e[8]=i[8]-t[8],e[9]=i[9]-t[9],e[10]=i[10]-t[10],e[11]=i[11]-t[11],e[12]=i[12]-t[12],e[13]=i[13]-t[13],e[14]=i[14]-t[14],e[15]=i[15]-t[15],e}function Qp(e,i,t){return e[0]=i[0]*t,e[1]=i[1]*t,e[2]=i[2]*t,e[3]=i[3]*t,e[4]=i[4]*t,e[5]=i[5]*t,e[6]=i[6]*t,e[7]=i[7]*t,e[8]=i[8]*t,e[9]=i[9]*t,e[10]=i[10]*t,e[11]=i[11]*t,e[12]=i[12]*t,e[13]=i[13]*t,e[14]=i[14]*t,e[15]=i[15]*t,e}function Jp(e,i,t,n){return e[0]=i[0]+t[0]*n,e[1]=i[1]+t[1]*n,e[2]=i[2]+t[2]*n,e[3]=i[3]+t[3]*n,e[4]=i[4]+t[4]*n,e[5]=i[5]+t[5]*n,e[6]=i[6]+t[6]*n,e[7]=i[7]+t[7]*n,e[8]=i[8]+t[8]*n,e[9]=i[9]+t[9]*n,e[10]=i[10]+t[10]*n,e[11]=i[11]+t[11]*n,e[12]=i[12]+t[12]*n,e[13]=i[13]+t[13]*n,e[14]=i[14]+t[14]*n,e[15]=i[15]+t[15]*n,e}function wd(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function cp(e,i){var t=e[0],n=e[1],r=e[2],o=e[3],u=e[4],l=e[5],p=e[6],v=e[7],E=e[8],w=e[9],M=e[10],k=e[11],D=e[12],N=e[13],V=e[14],q=e[15],fe=i[0],he=i[1],Be=i[2],Ge=i[3],St=i[4],Ut=i[5],Yt=i[6],nr=i[7],Rr=i[8],Tr=i[9],on=i[10],Hn=i[11],di=i[12],za=i[13],Co=i[14],Ds=i[15];return Math.abs(t-fe)<=Mi.Ib*Math.max(1,Math.abs(t),Math.abs(fe))&&Math.abs(n-he)<=Mi.Ib*Math.max(1,Math.abs(n),Math.abs(he))&&Math.abs(r-Be)<=Mi.Ib*Math.max(1,Math.abs(r),Math.abs(Be))&&Math.abs(o-Ge)<=Mi.Ib*Math.max(1,Math.abs(o),Math.abs(Ge))&&Math.abs(u-St)<=Mi.Ib*Math.max(1,Math.abs(u),Math.abs(St))&&Math.abs(l-Ut)<=Mi.Ib*Math.max(1,Math.abs(l),Math.abs(Ut))&&Math.abs(p-Yt)<=Mi.Ib*Math.max(1,Math.abs(p),Math.abs(Yt))&&Math.abs(v-nr)<=Mi.Ib*Math.max(1,Math.abs(v),Math.abs(nr))&&Math.abs(E-Rr)<=Mi.Ib*Math.max(1,Math.abs(E),Math.abs(Rr))&&Math.abs(w-Tr)<=Mi.Ib*Math.max(1,Math.abs(w),Math.abs(Tr))&&Math.abs(M-on)<=Mi.Ib*Math.max(1,Math.abs(M),Math.abs(on))&&Math.abs(k-Hn)<=Mi.Ib*Math.max(1,Math.abs(k),Math.abs(Hn))&&Math.abs(D-di)<=Mi.Ib*Math.max(1,Math.abs(D),Math.abs(di))&&Math.abs(N-za)<=Mi.Ib*Math.max(1,Math.abs(N),Math.abs(za))&&Math.abs(V-Co)<=Mi.Ib*Math.max(1,Math.abs(V),Math.abs(Co))&&Math.abs(q-Ds)<=Mi.Ib*Math.max(1,Math.abs(q),Math.abs(Ds))}var ed=Oo,td=Ip,kp,xf,Pp=(kp=(0,kn.b2)(),kp(xf=function(){function e(){(0,Ht.Z)(this,e),(0,J.Z)(this,"viewport",void 0),(0,J.Z)(this,"overridedViewProjectionMatrix",void 0),(0,J.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,J.Z)(this,"jitteredProjectionMatrix",void 0),(0,J.Z)(this,"viewMatrixInverse",void 0),(0,J.Z)(this,"cameraPosition",void 0)}return(0,tr.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=_o(),Au(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),n=(0,Ti.Z)(t,2),r=n[0],o=n[1];return[r,o]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,n){var r=Pu(_o(),[t,n,0]);this.jitteredProjectionMatrix=Oo(_o(),r,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Oo(_o(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||xf),fc;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom"})(fc||(fc={}));var fp,bf;function Al(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Ef(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function Ef(e,i){if(!!e){if(typeof e=="string")return Ad(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ad(e,i)}}function Ad(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}var dv={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},Vd=(fp=(0,kn.b2)(),fp(bf=function(){function e(){(0,Ht.Z)(this,e),(0,J.Z)(this,"container",void 0),(0,J.Z)(this,"controlCorners",void 0),(0,J.Z)(this,"controlContainer",void 0),(0,J.Z)(this,"scene",void 0),(0,J.Z)(this,"mapsService",void 0),(0,J.Z)(this,"controls",[]),(0,J.Z)(this,"unAddControls",[])}return(0,tr.Z)(e,[{key:"init",value:function(t,n){this.container=t.container,this.scene=n,this.mapsService=n.get(fr.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,n){var r=n.get(fr.IMapService);r.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(n){return n.controlOption.name===t})}},{key:"removeControl",value:function(t){var n=this.controls.indexOf(t);return n>-1&&this.controls.splice(n,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(n){n.addTo(t.scene),t.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=Al(this.controls),n;try{for(t.s();!(n=t.n()).done;){var r=n.value;r.remove()}}catch(o){t.e(o)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},n="l7-",r=this.controlContainer=I("div",n+"control-container",this.container);function o(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],p=l.map(function(v){return n+v}).join(" ");t[l.filter(function(v){return!["row","column"].includes(v)}).join("")]=I("div",p,r)}function u(l){var p=l.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,H.Z)(p),[dv[l]])}Object.values(fc).forEach(function(l){o(u(l))})}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&L(this.controlCorners[t]);this.controlContainer&&L(this.controlContainer)}}]),e}())||bf),Gd,Cd,vv=(Gd=(0,kn.b2)(),Gd(Cd=function(){function e(){(0,Ht.Z)(this,e),(0,J.Z)(this,"container",void 0),(0,J.Z)(this,"scene",void 0),(0,J.Z)(this,"mapsService",void 0),(0,J.Z)(this,"markers",[]),(0,J.Z)(this,"markerLayers",[]),(0,J.Z)(this,"unAddMarkers",[]),(0,J.Z)(this,"unAddMarkerLayers",[])}return(0,tr.Z)(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var n=this.markerLayers.indexOf(t);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(n){n.addTo(t.scene),t.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(n){t.markerLayers.push(n),n.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var n=this.markers.indexOf(t);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(fr.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||Cd),hc,Fi,qc=(hc=(0,kn.b2)(),hc(Fi=function(){function e(){(0,Ht.Z)(this,e),(0,J.Z)(this,"scene",void 0),(0,J.Z)(this,"mapsService",void 0),(0,J.Z)(this,"popups",[]),(0,J.Z)(this,"unAddPopups",[])}return(0,tr.Z)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(t){t!=null&&t.isOpen()&&t.remove();var n=this.popups.indexOf(t);n>-1&&this.popups.splice(n,1);var r=this.unAddPopups.indexOf(t);r>-1&&this.unAddPopups.splice(r,1)}},{key:"destroy",value:function(){this.popups.forEach(function(t){return t.remove()})}},{key:"addPopup",value:function(t){var n=this;t&&t.getOptions().autoClose&&[].concat((0,H.Z)(this.popups),(0,H.Z)(this.unAddPopups)).forEach(function(r){r.getOptions().autoClose&&n.removePopup(r)}),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",function(){n.removePopup(t)})}},{key:"initPopup",value:function(){var t=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){t.addPopup(n),t.unAddPopups=[]})}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(fr.IMapService)}}]),e}())||Fi),Kc={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},hh=Kc,Td,Vo,Md={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,isMini:!1,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Sf={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},hp=(Td=(0,kn.b2)(),Td(Vo=function(){function e(){(0,Ht.Z)(this,e),(0,J.Z)(this,"sceneConfigCache",{}),(0,J.Z)(this,"layerConfigCache",{}),(0,J.Z)(this,"layerAttributeConfigCache",{})}return(0,tr.Z)(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return hh[t]}},{key:"setSceneConfig",value:function(t,n){this.sceneConfigCache[t]=(0,U.Z)((0,U.Z)({},Md),n)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,n,r){this.layerConfigCache[n]=(0,U.Z)({},(0,f.merge)({},this.sceneConfigCache[t],Sf,r))}},{key:"getAttributeConfig",value:function(t){return this.layerAttributeConfigCache[t]}},{key:"setAttributeConfig",value:function(t,n){this.layerAttributeConfigCache[t]=(0,U.Z)((0,U.Z)({},this.layerAttributeConfigCache[t]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Vo);function Ta(e,i,t,n){!t||Object.defineProperty(e,i,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function Ma(e,i,t,n,r){var o={};return Object.keys(n).forEach(function(u){o[u]=n[u]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=t.slice().reverse().reduce(function(u,l){return l(e,i,u)||u},o),r&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,i,o),o=null),o}function rd(){var e=new Mi.WT(4);return Mi.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function mv(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function gv(e,i,t,n){var r=new Mi.WT(4);return r[0]=e,r[1]=i,r[2]=t,r[3]=n,r}function Id(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function i0(e,i,t,n,r){return e[0]=i,e[1]=t,e[2]=n,e[3]=r,e}function a0(e,i,t){return e[0]=i[0]+t[0],e[1]=i[1]+t[1],e[2]=i[2]+t[2],e[3]=i[3]+t[3],e}function o0(e,i,t){return e[0]=i[0]-t[0],e[1]=i[1]-t[1],e[2]=i[2]-t[2],e[3]=i[3]-t[3],e}function s0(e,i,t){return e[0]=i[0]*t[0],e[1]=i[1]*t[1],e[2]=i[2]*t[2],e[3]=i[3]*t[3],e}function u0(e,i,t){return e[0]=i[0]/t[0],e[1]=i[1]/t[1],e[2]=i[2]/t[2],e[3]=i[3]/t[3],e}function Mc(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function jd(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function Hd(e,i,t){return e[0]=Math.min(i[0],t[0]),e[1]=Math.min(i[1],t[1]),e[2]=Math.min(i[2],t[2]),e[3]=Math.min(i[3],t[3]),e}function ph(e,i,t){return e[0]=Math.max(i[0],t[0]),e[1]=Math.max(i[1],t[1]),e[2]=Math.max(i[2],t[2]),e[3]=Math.max(i[3],t[3]),e}function yv(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function _v(e,i,t){return e[0]=i[0]*t,e[1]=i[1]*t,e[2]=i[2]*t,e[3]=i[3]*t,e}function Rp(e,i,t,n){return e[0]=i[0]+t[0]*n,e[1]=i[1]+t[1]*n,e[2]=i[2]+t[2]*n,e[3]=i[3]+t[3]*n,e}function nd(e,i){var t=i[0]-e[0],n=i[1]-e[1],r=i[2]-e[2],o=i[3]-e[3];return Math.hypot(t,n,r,o)}function du(e,i){var t=i[0]-e[0],n=i[1]-e[1],r=i[2]-e[2],o=i[3]-e[3];return t*t+n*n+r*r+o*o}function fl(e){var i=e[0],t=e[1],n=e[2],r=e[3];return Math.hypot(i,t,n,r)}function id(e){var i=e[0],t=e[1],n=e[2],r=e[3];return i*i+t*t+n*n+r*r}function l0(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function c0(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function xv(e,i){var t=i[0],n=i[1],r=i[2],o=i[3],u=t*t+n*n+r*r+o*o;return u>0&&(u=1/Math.sqrt(u)),e[0]=t*u,e[1]=n*u,e[2]=r*u,e[3]=o*u,e}function f0(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function bv(e,i,t,n){var r=t[0]*n[1]-t[1]*n[0],o=t[0]*n[2]-t[2]*n[0],u=t[0]*n[3]-t[3]*n[0],l=t[1]*n[2]-t[2]*n[1],p=t[1]*n[3]-t[3]*n[1],v=t[2]*n[3]-t[3]*n[2],E=i[0],w=i[1],M=i[2],k=i[3];return e[0]=w*v-M*p+k*l,e[1]=-(E*v)+M*u-k*o,e[2]=E*p-w*u+k*r,e[3]=-(E*l)+w*o-M*r,e}function Ev(e,i,t,n){var r=i[0],o=i[1],u=i[2],l=i[3];return e[0]=r+n*(t[0]-r),e[1]=o+n*(t[1]-o),e[2]=u+n*(t[2]-u),e[3]=l+n*(t[3]-l),e}function dh(e,i){i=i||1;var t,n,r,o,u,l;do t=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,u=t*t+n*n;while(u>=1);do r=glMatrix.RANDOM()*2-1,o=glMatrix.RANDOM()*2-1,l=r*r+o*o;while(l>=1);var p=Math.sqrt((1-u)/l);return e[0]=i*t,e[1]=i*n,e[2]=i*r*p,e[3]=i*o*p,e}function kd(e,i,t){var n=i[0],r=i[1],o=i[2],u=i[3];return e[0]=t[0]*n+t[4]*r+t[8]*o+t[12]*u,e[1]=t[1]*n+t[5]*r+t[9]*o+t[13]*u,e[2]=t[2]*n+t[6]*r+t[10]*o+t[14]*u,e[3]=t[3]*n+t[7]*r+t[11]*o+t[15]*u,e}function Sv(e,i,t){var n=i[0],r=i[1],o=i[2],u=t[0],l=t[1],p=t[2],v=t[3],E=v*n+l*o-p*r,w=v*r+p*n-u*o,M=v*o+u*r-l*n,k=-u*n-l*r-p*o;return e[0]=E*v+k*-u+w*-p-M*-l,e[1]=w*v+k*-l+M*-u-E*-p,e[2]=M*v+k*-p+E*-l-w*-u,e[3]=i[3],e}function wv(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Av(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Wd(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function h0(e,i){var t=e[0],n=e[1],r=e[2],o=e[3],u=i[0],l=i[1],p=i[2],v=i[3];return Math.abs(t-u)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(u))&&Math.abs(n-l)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(o-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))}var p0=null,Cv=null,d0=null,vh=null,v0=null,Xd=null,tm=null,m0=function(){var e=rd();return function(i,t,n,r,o,u){var l,p;for(t||(t=4),n||(n=0),r?p=Math.min(r*t+n,i.length):p=i.length,l=n;l<p;l+=t)e[0]=i[l],e[1]=i[l+1],e[2]=i[l+2],e[3]=i[l+3],o(e,e,u),i[l]=e[0],i[l+1]=e[1],i[l+2]=e[2],i[l+3]=e[3];return i}}(),$d=Math.PI/180,Tv=512,Yd=4003e4;function Mv(e){var i=e.latitude,t=i===void 0?0:i,n=e.zoom,r=n===void 0?0:n,o=e.scale,u=e.highPrecision,l=u===void 0?!1:u,p=e.flipY,v=p===void 0?!1:p;o=o!==void 0?o:Math.pow(2,r);var E={},w=Tv*o,M=Math.cos(t*$d),k=w/360,D=k/M,N=w/Yd/M;if(E.pixelsPerMeter=[N,-N,N],E.metersPerPixel=[1/N,-1/N,1/N],E.pixelsPerDegree=[k,-D,N],E.degreesPerPixel=[1/k,-1/D,1/N],l){var V=$d*Math.tan(t*$d)/M,q=k*V/2,fe=w/Yd*V,he=fe/D*N;E.pixelsPerDegree2=[0,-q,fe],E.pixelsPerMeter2=[he,0,he],v&&(E.pixelsPerDegree2[1]=-E.pixelsPerDegree2[1],E.pixelsPerMeter2[1]=-E.pixelsPerMeter2[1])}return v&&(E.pixelsPerMeter[1]=-E.pixelsPerMeter[1],E.metersPerPixel[1]=-E.metersPerPixel[1],E.pixelsPerDegree[1]=-E.pixelsPerDegree[1],E.degreesPerPixel[1]=-E.degreesPerPixel[1]),E}var Uh;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Uh||(Uh={}));var pp={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Iv,kv,wf,Lp,qd,ad=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Pv=(Iv=(0,kn.b2)(),kv=(0,kn.f3)(fr.ICameraService),Iv(wf=(Lp=function(){function e(){(0,Ht.Z)(this,e),(0,J.Z)(this,"needRefresh",!0),Ta(this,"cameraService",qd,this),(0,J.Z)(this,"coordinateSystem",void 0),(0,J.Z)(this,"viewportCenter",void 0),(0,J.Z)(this,"viewportCenterProjection",void 0),(0,J.Z)(this,"pixelsPerDegree",void 0),(0,J.Z)(this,"pixelsPerDegree2",void 0),(0,J.Z)(this,"pixelsPerMeter",void 0)}return(0,tr.Z)(e,[{key:"refresh",value:function(t){var n=this.cameraService.getZoom(),r=this.cameraService.getZoomScale(),o=t||this.cameraService.getCenter(),u=Mv({latitude:o[1],zoom:n}),l=u.pixelsPerMeter,p=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=p,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Uh.LNGLAT||this.coordinateSystem===Uh.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Uh.LNGLAT_OFFSET?this.calculateLnglatOffset(o,n):this.coordinateSystem===Uh.P20_OFFSET&&this.calculateLnglatOffset(o,n,r,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,n,r,o){var u=Mv({latitude:t[1],zoom:n,scale:r,flipY:o,highPrecision:!0}),l=u.pixelsPerMeter,p=u.pixelsPerDegree,v=u.pixelsPerDegree2,E=this.cameraService.getViewMatrix(),w=this.cameraService.getProjectionMatrix(),M=Oo([],w,E),k=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,n));this.viewportCenterProjection=kd([],[k[0],k[1],0,1],M),E=this.cameraService.getViewMatrixUncentered()||E,M=Oo([],w,E),M=Oo([],M,ad),this.cameraService.setViewProjectionMatrix(M),this.pixelsPerMeter=l,this.pixelsPerDegree=p,this.pixelsPerDegree2=v}}]),e}(),qd=Ma(Lp.prototype,"cameraService",[kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lp))||wf),rm,nm;function yg(e){var i=_g();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function _g(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xg=(rm=(0,kn.b2)(),rm(nm=function(e){(0,Fr.Z)(t,e);var i=yg(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"renderMap",new Map),(0,J.Z)((0,Ke.Z)(n),"enable",!1),(0,J.Z)((0,Ke.Z)(n),"renderEnable",!1),(0,J.Z)((0,Ke.Z)(n),"cacheLogs",{}),n}return(0,tr.Z)(t,[{key:"setEnable",value:function(r){this.enable=!!r}},{key:"log",value:function(r,o){var u=this;if(!!this.enable){var l=r.split("."),p=null;l.forEach(function(v,E){p!==null?(p[v]||(p[v]={}),E!==l.length-1&&(p=p[v])):(u.cacheLogs[v]||(u.cacheLogs[v]={}),E!==l.length-1&&(p=u.cacheLogs[v])),E===l.length-1&&(p[v]=(0,U.Z)((0,U.Z)({time:Date.now()},p[v]),o))})}}},{key:"getLog",value:function(r){var o=this;switch((0,jr.Z)(r)){case"string":return this.cacheLogs[r];case"object":return r.map(function(u){return o.cacheLogs[u]}).filter(function(u){return u!==void 0});case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(r){delete this.cacheLogs[r]}},{key:"generateRenderUid",value:function(){return this.renderEnable?yl():""}},{key:"renderDebug",value:function(r){this.renderEnable=r}},{key:"renderStart",value:function(r){if(!(!this.renderEnable||!this.enable)){var o=this.renderMap.get(r)||{};this.renderMap.set(r,(0,U.Z)((0,U.Z)({},o),{},{renderUid:r,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(r){if(!(!this.renderEnable||!this.enable)){var o=this.renderMap.get(r);if(o){var u=o.renderStart,l=Date.now();this.emit("renderEnd",(0,U.Z)((0,U.Z)({},o),{},{renderEnd:l,renderDuration:l-u})),this.renderMap.delete(r)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),t}(fs.EventEmitter))||nm),bg=ie(20396),Kd=ie.n(bg),Yl;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Yl||(Yl={}));var im,am,om,g0,sm;function Eg(e){var i=Sg();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function Sg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y0={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},um=(im=(0,kn.b2)(),am=(0,kn.f3)(fr.IMapService),im(om=(g0=function(e){(0,Fr.Z)(t,e);var i=Eg(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"indragging",!1),Ta((0,Ke.Z)(n),"mapService",sm,(0,Ke.Z)(n)),(0,J.Z)((0,Ke.Z)(n),"hammertime",void 0),(0,J.Z)((0,Ke.Z)(n),"lastClickTime",0),(0,J.Z)((0,Ke.Z)(n),"lastClickXY",[-1,-1]),(0,J.Z)((0,Ke.Z)(n),"clickTimer",void 0),(0,J.Z)((0,Ke.Z)(n),"$containter",void 0),(0,J.Z)((0,Ke.Z)(n),"onDrag",function(l){var p=n.interactionEvent(l);p.type=y0[p.type],p.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(Yl.Drag,p)}),(0,J.Z)((0,Ke.Z)(n),"onHammer",function(l){l.srcEvent.stopPropagation();var p=n.interactionEvent(l);n.emit(Yl.Hover,p)}),(0,J.Z)((0,Ke.Z)(n),"onTouch",function(l){var p=l.touches[0];n.onHover({x:p.pageX,y:p.pageY,type:"touch"})}),(0,J.Z)((0,Ke.Z)(n),"onHover",function(l){var p=l.clientX,v=l.clientY,E=p,w=v,M=l.type,k=n.mapService.getMapContainer();if(k)if(Yo)E=E-k.left-0,w=w-k.top-0;else{var D=k.getBoundingClientRect(),N=D.top,V=D.left;E=E-V-k.clientLeft,w=w-N-k.clientTop}var q=n.mapService.containerToLngLat([E,w]);if(M==="click"){if(!Yo&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(E,w,q);return}if(M==="touch"){n.isDoubleTap(E,w,q);return}M!=="click"&&M!=="dblclick"&&n.emit(Yl.Hover,{x:E,y:w,lngLat:q,type:M,target:l})}),n}return(0,tr.Z)(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Yl.Hover)}},{key:"triggerHover",value:function(r){var o=r.x,u=r.y;this.emit(Yl.Hover,{x:o,y:u})}},{key:"triggerSelect",value:function(r){this.emit(Yl.Select,{featureId:r})}},{key:"triggerActive",value:function(r){this.emit(Yl.Active,{featureId:r})}},{key:"handleMiniEvent",value:function(r){this.onHover({clientX:r.touches[0].pageX,clientY:r.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var r=this.mapService.getMapContainer();if(r)if(Yo)wa.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=new(Kd()).Manager(r);o.add(new(Kd()).Tap({event:"dblclick",taps:2})),o.add(new(Kd()).Tap({event:"click"})),o.add(new(Kd()).Pan({threshold:0,pointers:0})),o.add(new(Kd()).Press({})),o.on("dblclick click",this.onHammer),o.on("panstart panmove panend pancancel",this.onDrag),r.addEventListener("mousemove",this.onHover),r.addEventListener("mousedown",this.onHover,!0),r.addEventListener("mouseup",this.onHover),r.addEventListener("contextmenu",this.onHover),this.hammertime=o}}},{key:"removeEventListenerOnMap",value:function(){if(Yo)wa.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var r=this.mapService.getMapContainer();r&&(r.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),r.removeEventListener("mousedown",this.onHover),r.removeEventListener("mouseup",this.onHover),r.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(r){var o=r.type,u=r.pointerType,l,p;u==="touch"?(p=Math.floor(r.pointers[0].clientY),l=Math.floor(r.pointers[0].clientX)):(p=Math.floor(r.srcEvent.y),l=Math.floor(r.srcEvent.x));var v=this.mapService.getMapContainer();if(v){var E=v.getBoundingClientRect(),w=E.top,M=E.left;l-=M,p-=w}var k=this.mapService.containerToLngLat([l,p]);return{x:l,y:p,lngLat:k,type:o,target:r.srcEvent}}},{key:"isDoubleTap",value:function(r,o,u){var l=this,p=new Date().getTime(),v="click";p-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-r)<10&&Math.abs(this.lastClickXY[1]-o)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),v="dblclick",this.emit(Yl.Hover,{x:r,y:o,lngLat:u,type:v})):(this.lastClickTime=p,this.lastClickXY=[r,o],this.clickTimer=setTimeout(function(){v="click",l.emit(Yl.Hover,{x:r,y:o,lngLat:u,type:v})},400))}}]),t}(Ph()),sm=Ma(g0.prototype,"mapService",[am],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g0))||om),lm=0;function wg(e){if(Yo)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(lm++),t.classList.add("l7-scene"),i.appendChild(t),t}return null}function Ag(e){var i,t,n=!0;return e==null||(i=e.target)===null||i===void 0||(t=i.path)===null||t===void 0||t.map(function(r){if(r!=null&&r.classList){var o;r==null||(o=r.classList)===null||o===void 0||o.forEach(function(u){(u==="l7-marker"||u==="l7-popup")&&(n=!1)})}}),n}var ee;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(ee||(ee={}));var Rv,cm,fm,hm,Ic,Lv,pm,od,dm,vm,Ov,mm,Fv,Cg=(Rv=(0,kn.b2)(),cm=(0,kn.f3)(fr.IMapService),fm=(0,kn.f3)(fr.IRendererService),hm=(0,kn.f3)(fr.IGlobalConfigService),Ic=(0,kn.f3)(fr.IInteractionService),Lv=(0,kn.f3)(fr.ILayerService),Rv(pm=(od=function(){function e(){var i=this;(0,Ht.Z)(this,e),(0,J.Z)(this,"pickedColors",void 0),(0,J.Z)(this,"pickedTileLayers",[]),Ta(this,"mapService",dm,this),Ta(this,"rendererService",vm,this),Ta(this,"configService",Ov,this),Ta(this,"interactionService",mm,this),Ta(this,"layerService",Fv,this),(0,J.Z)(this,"pickingFBO",void 0),(0,J.Z)(this,"width",0),(0,J.Z)(this,"height",0),(0,J.Z)(this,"alreadyInPicking",!1),(0,J.Z)(this,"pickBufferScale",1),(0,J.Z)(this,"pickFromPickingFBO",function(t,n){var r=n.x,o=n.y,u=n.lngLat,l=n.type,p=n.target,v=!1,E=i.rendererService,w=E.readPixels,M=E.getContainer,k=i.getContainerSize(M()),D=k.width,N=k.height;D*=vt,N*=vt;var V=t.getLayerConfig(),q=V.enableHighlight,fe=V.enableSelect,he=r*vt,Be=o*vt;if(he>D-1*vt||he<0||Be>N-1*vt||Be<0)return!1;var Ge=w({x:Math.floor(he/i.pickBufferScale),y:Math.floor((N-(o+1)*vt)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO});if(i.pickedColors=Ge,Ge[0]!==0||Ge[1]!==0||Ge[2]!==0){var St=Ll(Ge),Ut=t.layerPickService.getFeatureById(St);St!==t.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");var Yt={x:r,y:o,type:l,lngLat:u,featureId:St,feature:Ut,target:p};Ut&&(v=!0,t.setCurrentPickId(St),i.triggerHoverOnLayer(t,Yt))}else{var nr={x:r,y:o,lngLat:u,type:t.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:p,feature:null};i.triggerHoverOnLayer(t,(0,U.Z)((0,U.Z)({},nr),{},{type:"unpick"})),i.triggerHoverOnLayer(t,nr),t.setCurrentPickId(null)}if(q&&t.layerPickService.highlightPickedFeature(Ge),fe&&l==="click"&&(Ge==null?void 0:Ge.toString())!==[0,0,0,0].toString()){var Rr=Ll(Ge);t.getCurrentSelectedId()===null||Rr!==t.getCurrentSelectedId()?(t.layerPickService.selectFeature(Ge),t.setCurrentSelectedId(Rr)):(t.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return v})}return(0,tr.Z)(e,[{key:"init",value:function(t){var n=this.rendererService,r=n.createTexture2D,o=n.createFramebuffer,u=n.getContainer,l=this.getContainerSize(u()),p=l.width,v=l.height;p*=vt,v*=vt,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=o({color:r({width:Math.round(p/this.pickBufferScale),height:Math.round(v/this.pickBufferScale),wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE})}),this.interactionService.on(Yl.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,ot.Z)(se().mark(function n(r,o,u){var l=this,p,v,E;return se().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:p=this.rendererService,v=p.useFramebuffer,E=p.clear,this.resizePickingFBO(),v(this.pickingFBO,function(){E({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),r.hooks.beforePickingEncode.call(),r.renderModels(),r.hooks.afterPickingEncode.call();var k=l.pickBox(r,o);u(k)});case 3:case"end":return M.stop()}},n,this)}));function t(n,r,o){return i.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,n){var r=this,o=n.map(function(Rr){var Tr=Rr<0?0:Rr;return Math.floor(Tr*vt/r.pickBufferScale)}),u=(0,Ti.Z)(o,4),l=u[0],p=u[1],v=u[2],E=u[3],w=this.rendererService,M=w.readPixels,k=w.getContainer,D=this.getContainerSize(k()),N=D.width,V=D.height;if(N*=vt,V*=vt,l>(N-1)*vt/this.pickBufferScale||v<0||p>(V-1)*vt/this.pickBufferScale||E<0)return[];for(var q=Math.min(N/this.pickBufferScale,v)-l,fe=Math.min(V/this.pickBufferScale,E)-p,he=M({x:l,y:Math.floor(V/this.pickBufferScale-(E+1)),width:q,height:fe,data:new Uint8Array(q*fe*4),framebuffer:this.pickingFBO}),Be=[],Ge={},St=0;St<he.length/4;St=St+1){var Ut=he.slice(St*4,St*4+4),Yt=Ll(Ut);if(Yt!==-1&&!Ge[Yt]){var nr=t.layerPickService.getFeatureById(Yt);Be.push((0,U.Z)((0,U.Z)({},nr),{},{pickedFeatureIdx:Yt})),Ge[Yt]=!0}}return Be}},{key:"handleCursor",value:function(t,n){var r=t.getLayerConfig(),o=r.cursor,u=o===void 0?"":o,l=r.cursorEnabled;if(l){var p=this.mapService.version,v=p==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),E=v==null?void 0:v.style.getPropertyValue("cursor");n==="unmousemove"&&E!==""?v==null||v.style.setProperty("cursor",""):n==="mousemove"&&(v==null||v.style.setProperty("cursor",u))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/vt,height:t.height/vt}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,ot.Z)(se().mark(function n(r){return se().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(!this.layerService.needPick(r.type)||!this.isPickingAllLayer())){u.next=2;break}return u.abrupt("return");case 2:return this.alreadyInPicking=!0,u.next=5,this.pickingLayers(r);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return u.stop()}},n,this)}));function t(n){return i.apply(this,arguments)}return t}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,n=this.getContainerSize(t()),r=n.width,o=n.height;r*=vt,o*=vt,(this.width!==r||this.height!==o)&&(this.pickingFBO.resize({width:Math.round(r/this.pickBufferScale),height:Math.round(o/this.pickBufferScale)}),this.width=r,this.height=o)}},{key:"pickingLayers",value:function(){var i=(0,ot.Z)(se().mark(function n(r){var o=this,u,l,p;return se().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:u=this.rendererService,l=u.useFramebuffer,p=u.clear,this.resizePickingFBO(),l(this.pickingFBO,function(){var w=o.layerService.getRenderList();w.filter(function(M){return M.needPick(r.type)}).reverse().some(function(M){p({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),M.layerPickService.pickRender(r);var k=o.pickFromPickingFBO(M,r);return o.layerService.pickedLayerId=k?+M.id:-1,k&&!M.getLayerConfig().enablePropagation})});case 3:case"end":return E.stop()}},n,this)}));function t(n){return i.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,n){Ag(n)&&(this.handleCursor(t,n.type),t.emit(n.type,n))}}]),e}(),dm=Ma(od.prototype,"mapService",[cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vm=Ma(od.prototype,"rendererService",[fm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ov=Ma(od.prototype,"configService",[hm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mm=Ma(od.prototype,"interactionService",[Ic],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fv=Ma(od.prototype,"layerService",[Lv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),od))||pm),Tg=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,Ht.Z)(this,e),(0,J.Z)(this,"autoStart",void 0),(0,J.Z)(this,"startTime",0),(0,J.Z)(this,"oldTime",0),(0,J.Z)(this,"running",!1),(0,J.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,tr.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();t=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=t}return t}}]),e}(),gm,ym,_0,_m,xm,Qd,Dv,Bv,bm;function Mg(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Ig(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function Ig(e,i){if(!!e){if(typeof e=="string")return Em(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Em(e,i)}}function Em(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function kg(e){var i=Pg();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function Pg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rg=(gm=(0,kn.b2)(),ym=(0,kn.f3)(fr.IRendererService),_0=(0,kn.f3)(fr.IMapService),_m=(0,kn.f3)(fr.IDebugService),gm(xm=(Qd=function(e){(0,Fr.Z)(t,e);var i=kg(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"pickedLayerId",-1),(0,J.Z)((0,Ke.Z)(n),"clock",new Tg),(0,J.Z)((0,Ke.Z)(n),"alreadyInRendering",!1),(0,J.Z)((0,Ke.Z)(n),"layers",[]),(0,J.Z)((0,Ke.Z)(n),"layerList",[]),(0,J.Z)((0,Ke.Z)(n),"layerRenderID",void 0),(0,J.Z)((0,Ke.Z)(n),"sceneInited",!1),(0,J.Z)((0,Ke.Z)(n),"animateInstanceCount",0),(0,J.Z)((0,Ke.Z)(n),"shaderPicking",!0),(0,J.Z)((0,Ke.Z)(n),"enableRender",!0),Ta((0,Ke.Z)(n),"renderService",Dv,(0,Ke.Z)(n)),Ta((0,Ke.Z)(n),"mapService",Bv,(0,Ke.Z)(n)),Ta((0,Ke.Z)(n),"debugService",bm,(0,Ke.Z)(n)),(0,J.Z)((0,Ke.Z)(n),"reRender",(0,f.throttle)(function(){n.updateLayerRenderList(),n.renderLayers()},32)),(0,J.Z)((0,Ke.Z)(n),"throttleRenderLayers",(0,f.throttle)(function(){n.renderLayers()},16)),n}return(0,tr.Z)(t,[{key:"needPick",value:function(r){return this.layerList.some(function(o){return o.needPick(r)})}},{key:"add",value:function(r){var o=this;this.layers.push(r),this.sceneInited&&r.init().then(function(){o.updateLayerRenderList(),o.renderLayers()})}},{key:"addMask",value:function(r){var o=this;this.sceneInited&&r.init().then(function(){o.renderLayers()})}},{key:"initLayers",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u=this;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var v=(0,ot.Z)(se().mark(function E(w){return se().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(w.startInit){k.next=4;break}return k.next=3,w.init();case 3:u.updateLayerRenderList();case 4:case"end":return k.stop()}},E)}));return function(E){return v.apply(this,arguments)}}());case 2:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(o){return o.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(o){return o.name===r})}},{key:"remove",value:function(){var n=(0,ot.Z)(se().mark(function o(u,l){var p,v;return se().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:l?(p=l.layerChildren.indexOf(u),p>-1&&l.layerChildren.splice(p,1)):(v=this.layers.indexOf(u),v>-1&&this.layers.splice(v,1)),this.updateLayerRenderList(),u.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 5:case"end":return w.stop()}},o,this)}));function r(o,u){return n.apply(this,arguments)}return r}()},{key:"removeAllLayers",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:this.destroy(),this.reRender();case 2:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v;return se().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){w.next=2;break}return w.abrupt("return");case 2:u=this.debugService.generateRenderUid(),this.debugService.renderStart(u),this.alreadyInRendering=!0,this.clear(),l=Mg(this.layerList),w.prev=7,l.s();case 9:if((p=l.n()).done){w.next=21;break}if(v=p.value,v.masks.filter(function(M){return M.inited}).length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),v.masks.map(function(){var M=(0,ot.Z)(se().mark(function k(D){return se().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:D.render();case 1:case"end":return V.stop()}},k)}));return function(k){return M.apply(this,arguments)}}())),!v.getLayerConfig().enableMultiPassRenderer){w.next=17;break}return w.next=15,v.renderMultiPass();case 15:w.next=19;break;case 17:return w.next=19,v.render();case 19:w.next=9;break;case 21:w.next=26;break;case 23:w.prev=23,w.t0=w.catch(7),l.e(w.t0);case 26:return w.prev=26,l.f(),w.finish(26);case 29:this.debugService.renderEnd(u),this.alreadyInRendering=!1;case 31:case"end":return w.stop()}},o,this,[[7,23,26,29]])}));function r(){return n.apply(this,arguments)}return r}()},{key:"renderMask",value:function(r){r.filter(function(o){return o.inited}).map(function(o){o.render()})}},{key:"beforeRenderData",value:function(){var n=(0,ot.Z)(se().mark(function o(u){var l;return se().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,u.hooks.beforeRenderData.promise();case 2:l=v.sent,l&&this.renderLayers();case 4:case"end":return v.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"renderLayer",value:function(){var n=(0,ot.Z)(se().mark(function o(u){var l=this;return se().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(u.masks.filter(function(E){return E.inited}).length>0&&u.masks.map(function(E){l.renderService.clear({stencil:0,depth:1,framebuffer:null}),E.render()}),!u.getLayerConfig().enableMultiPassRenderer){v.next=6;break}return v.next=4,u.renderMultiPass();case 4:v.next=8;break;case 6:return v.next=8,u.render();case 8:case"end":return v.stop()}},o)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).sort(function(o,u){return o.zIndex-u.zIndex}).forEach(function(o){r.layerList.push(o)})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var r=Oa(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=wa.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){wa.cancelAnimationFrame(this.layerRenderID)}}]),t}(fs.EventEmitter),Dv=Ma(Qd.prototype,"renderService",[ym],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bv=Ma(Qd.prototype,"mapService",[_0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bm=Ma(Qd.prototype,"debugService",[_m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qd))||xm),Af=ie(81253),Lg=function(){function e(i){var t=this;(0,Ht.Z)(this,e),(0,J.Z)(this,"name",void 0),(0,J.Z)(this,"type",void 0),(0,J.Z)(this,"scale",void 0),(0,J.Z)(this,"descriptor",void 0),(0,J.Z)(this,"featureBufferLayout",[]),(0,J.Z)(this,"needRescale",!1),(0,J.Z)(this,"needRemapping",!1),(0,J.Z)(this,"needRegenerateVertices",!1),(0,J.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,J.Z)(this,"vertexAttribute",void 0),(0,J.Z)(this,"defaultCallback",function(n){if(n.length===0){var r;return((r=t.scale)===null||r===void 0?void 0:r.defaultValues)||[]}return n.map(function(o,u){var l,p=(l=t.scale)===null||l===void 0?void 0:l.scalers[u].func,v=p(o);return v})}),this.setProps(i)}return(0,tr.Z)(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var r,o=(r=this.scale)===null||r===void 0?void 0:r.callback.apply(r,(0,H.Z)(t));if(!(0,f.isNil)(o))return[o]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Og=["modelType"],Fg=["buffer","update","name"],Dg=["buffer","update","name"],Bg=["buffer","update","name"],Jd,Sm,wm,Am,x0,Cm,Ng=(Jd={},(0,J.Z)(Jd,ee.FLOAT,4),(0,J.Z)(Jd,ee.UNSIGNED_BYTE,1),(0,J.Z)(Jd,ee.UNSIGNED_SHORT,2),Jd),zg=(Sm=(0,kn.b2)(),wm=(0,kn.f3)(fr.IRendererService),Sm(Am=(x0=function(){function e(){(0,Ht.Z)(this,e),(0,J.Z)(this,"attributesAndIndices",void 0),Ta(this,"rendererService",Cm,this),(0,J.Z)(this,"attributes",[]),(0,J.Z)(this,"triangulation",void 0),(0,J.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,tr.Z)(e,[{key:"registerStyleAttribute",value:function(t){var n=this.getLayerStyleAttribute(t.name||"");return n?n.setProps(t):(n=new Lg(t),this.attributes.push(n)),n}},{key:"updateScaleAttribute",value:function(t){this.attributes.forEach(function(n){var r,o=n.name,u=(r=n.scale)===null||r===void 0?void 0:r.field;(t[o]||u&&t[u])&&(n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(t,n,r){var o=this.getLayerStyleAttribute(t);o||(o=this.registerStyleAttribute((0,U.Z)((0,U.Z)({},n),{},{name:t})));var u=n.scale;u&&o&&(o.scale=u,o.needRescale=!0,o.needRemapping=!0,o.needRegenerateVertices=!0,r&&r.featureRange&&(o.featureRange=r.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(n){return n.name===t})}},{key:"getLayerAttributeScale",value:function(t){var n,r=this.getLayerStyleAttribute(t),o=r==null||(n=r.scale)===null||n===void 0?void 0:n.scalers;return o&&o[0]?o[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,l=this.attributes.find(function(Ge){return Ge.name===t});if(l&&l.descriptor){var p=l.descriptor,v=p.update,E=p.buffer,w=p.size,M=w===void 0?0:w,k=Ng[E.type||ee.FLOAT];if(v){var D=this.featureLayout,N=D.elements,V=D.sizePerElement,q=N.slice(r,o);if(!q.length)return;var fe=q[0].offset,he=fe*M*k,Be=q.map(function(Ge,St){for(var Ut=Ge.featureIdx,Yt=Ge.vertices,nr=Ge.normals,Rr=Yt.length/V,Tr=[],on=0;on<Rr;on++){var Hn=nr?nr.slice(on*3,on*3+3):[];Tr.push.apply(Tr,(0,H.Z)(v(n[Ut],Ut,Yt.slice(on*V,on*V+V),St,Hn)))}return Tr}).reduce(function(Ge,St){return Ge.push.apply(Ge,(0,H.Z)(St)),Ge},[]);l.vertexAttribute.updateBuffer({data:Be,offset:he}),u==null||u.emit("legend:".concat(t),{type:t,attr:l})}}}},{key:"createAttributesAndIndicesAscy",value:function(t,n,r){var o=this;this.featureLayout={sizePerElement:0,elements:[]};var u=this.attributes.map(function(D){return D.resetDescriptor(),D.descriptor}).filter(function(D){return D}),l=r.modelType,p=(0,Af.Z)(r,Og),v=this.rendererService,E=v.createAttribute,w=v.createBuffer,M=v.createElements,k={};return new Promise(function(D,N){Qt(l,(0,U.Z)({descriptors:o.getDescriptorsWithOutFunc(u),features:t,segmentNumber:n},p)).then(function(V){V.descriptors.forEach(function(fe,he){if(fe){var Be=fe.buffer,Ge=fe.update,St=fe.name,Ut=(0,Af.Z)(fe,Fg),Yt=E((0,U.Z)({buffer:w(Be)},Ut));k[fe.name||""]=Yt,o.attributes[he].vertexAttribute=Yt}}),o.featureLayout=V.featureLayout;var q=M({data:V.indices,type:ee.UNSIGNED_INT,count:V.indices.length});o.attributesAndIndices={attributes:k,elements:q,count:null},D(o.attributesAndIndices)}).catch(function(V){console.warn(V),N(V)})})}},{key:"createAttributesAndIndices",value:function(t,n,r){var o=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var u=this.attributes.map(function(he){return he.resetDescriptor(),he.descriptor}),l=0,p=0,v=[],E=[],w=[],M=3;t.forEach(function(he,Be){var Ge=o.triangulation(he,r),St=Ge.indices,Ut=Ge.vertices,Yt=Ge.normals,nr=Ge.size,Rr=Ge.indexes,Tr=Ge.count;typeof Tr=="number"&&(p+=Tr),St.forEach(function(za){E.push(za+l)}),M=nr;var on=Ut.length/nr;o.featureLayout.sizePerElement=M,o.featureLayout.elements.push({featureIdx:Be,vertices:Ut,normals:Yt,offset:l}),l+=on;for(var Hn=function(Co){var Ds=(Yt==null?void 0:Yt.slice(Co*3,Co*3+3))||[],js=Ut.slice(Co*nr,Co*nr+nr),vu=0;Rr&&Rr[Co]!==void 0&&(vu=Rr[Co]),u.forEach(function(jf,J0){if(jf&&jf.update){var r0;(r0=jf.buffer.data).push.apply(r0,(0,H.Z)(jf.update(he,Be,js,Co,Ds,vu)))}})},di=0;di<on;di++)Hn(di)});var k=this.rendererService,D=k.createAttribute,N=k.createBuffer,V=k.createElements,q={};u.forEach(function(he,Be){if(he){var Ge=he.buffer,St=he.update,Ut=he.name,Yt=(0,Af.Z)(he,Dg),nr=D((0,U.Z)({buffer:N(Ge)},Yt));q[he.name||""]=nr,o.attributes[Be].vertexAttribute=nr}});var fe=V({data:E,type:ee.UNSIGNED_INT,count:E.length});return this.attributesAndIndices={attributes:q,elements:fe,count:p},this.attributesAndIndices}},{key:"createAttributes",value:function(t,n){var r=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(k){return k.resetDescriptor(),k.descriptor}),u=0,l=[],p=3;t.forEach(function(k,D){var N=r.triangulation(k),V=N.indices,q=N.vertices,fe=N.normals,he=N.size,Be=N.indexes;V.forEach(function(Yt){l.push(Yt+u)}),p=he;var Ge=q.length/he;r.featureLayout.sizePerElement=p,r.featureLayout.elements.push({featureIdx:D,vertices:q,normals:fe,offset:u}),u+=Ge;for(var St=function(nr){var Rr=(fe==null?void 0:fe.slice(nr*3,nr*3+3))||[],Tr=q.slice(nr*he,nr*he+he),on=0;Be&&Be[nr]!==void 0&&(on=Be[nr]),o.forEach(function(Hn,di){if(Hn&&Hn.update){var za;(za=Hn.buffer.data).push.apply(za,(0,H.Z)(Hn.update(k,D,Tr,nr,Rr,on)))}})},Ut=0;Ut<Ge;Ut++)St(Ut)});var v=this.rendererService,E=v.createAttribute,w=v.createBuffer,M={};return o.forEach(function(k,D){if(k){var N=k.buffer,V=k.update,q=k.name,fe=(0,Af.Z)(k,Bg),he=E((0,U.Z)({buffer:w(N)},fe));M[k.name||""]=he,r.attributes[D].vertexAttribute=he}}),{attributes:M}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}},{key:"getDescriptorsWithOutFunc",value:function(t){return t.map(function(n){return{buffer:n.buffer,name:n.name,size:n.size}})}}]),e}(),Cm=Ma(x0.prototype,"rendererService",[wm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x0))||Am),m=ie(34155);function x(e,i,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function l(E){try{v(n.next(E))}catch(w){u(w)}}function p(E){try{v(n.throw(E))}catch(w){u(w)}}function v(E){E.done?o(E.value):r(E.value).then(l,p)}v((n=n.apply(e,i||[])).next())})}function P(e,i){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(E){return p([v,E])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=v[0]&2?r.return:v[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,v[1])).done)return o;switch(r=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,r=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){t.label=v[1];break}if(v[0]===6&&t.label<o[1]){t.label=o[1],o=v;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(v);break}o[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(e,t)}catch(E){v=[6,E],r=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function G(e,i){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),r,o=[],u;try{for(;(i===void 0||i-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){u={error:l}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(u)throw u.error}}return o}function pe(e,i,t){if(t||arguments.length===2)for(var n=0,r=i.length,o;n<r;n++)(o||!(n in i))&&(o||(o=Array.prototype.slice.call(i,0,n)),o[n]=i[n]);return e.concat(o||Array.prototype.slice.call(i))}function ze(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var _t={exports:{}},Ot={exports:{}},or={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=t;function t(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default})(or,or.exports);var qr={},fn={exports:{}},Tn={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t){return function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];var o=n.pop();return t.call(this,n,o)}},e.exports=i.default})(Tn,Tn.exports);var pi={};Object.defineProperty(pi,"__esModule",{value:!0}),pi.fallback=Ea,pi.wrap=Ao;var Ji=pi.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,Ia=pi.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,vo=pi.hasNextTick=typeof m=="object"&&typeof m.nextTick=="function";function Ea(e){setTimeout(e,0)}function Ao(e){return function(i){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return e(function(){return i.apply(void 0,t)})}}var xo;Ji?xo=queueMicrotask:Ia?xo=setImmediate:vo?xo=m.nextTick:xo=Ea,pi.default=Ao(xo),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=p;var t=Tn.exports,n=l(t),r=pi,o=l(r),u=qr;function l(w){return w&&w.__esModule?w:{default:w}}function p(w){return(0,u.isAsync)(w)?function(){for(var M=[],k=arguments.length;k--;)M[k]=arguments[k];var D=M.pop(),N=w.apply(this,M);return v(N,D)}:(0,n.default)(function(M,k){var D;try{D=w.apply(this,M)}catch(N){return k(N)}if(D&&typeof D.then=="function")return v(D,k);k(null,D)})}function v(w,M){return w.then(function(k){E(M,null,k)},function(k){E(M,k&&k.message?k:new Error(k))})}function E(w,M,k){try{w(M,k)}catch(D){(0,o.default)(function(N){throw N},D)}}e.exports=i.default}(fn,fn.exports),Object.defineProperty(qr,"__esModule",{value:!0}),qr.isAsyncIterable=qr.isAsyncGenerator=qr.isAsync=void 0;var Cf=fn.exports,kc=Tf(Cf);function Tf(e){return e&&e.__esModule?e:{default:e}}function Lu(e){return e[Symbol.toStringTag]==="AsyncFunction"}function mh(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function dp(e){return typeof e[Symbol.asyncIterator]=="function"}function Tm(e){if(typeof e!="function")throw new Error("expected a function");return Lu(e)?(0,kc.default)(e):e}qr.default=Tm,qr.isAsync=Lu,qr.isAsyncGenerator=mh,qr.isAsyncIterable=dp;var ev={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=t;function t(n,r){if(r===void 0&&(r=n.length),!r)throw new Error("arity is undefined");function o(){for(var u=this,l=[],p=arguments.length;p--;)l[p]=arguments[p];return typeof l[r-1]=="function"?n.apply(this,l):new Promise(function(v,E){l[r-1]=function(w){for(var M=[],k=arguments.length-1;k-- >0;)M[k]=arguments[k+1];if(w)return E(w);v(M.length>1?M:M[0])},n.apply(u,l)})}return o}e.exports=i.default})(ev,ev.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=or.exports,n=p(t),r=qr,o=p(r),u=ev.exports,l=p(u);function p(v){return v&&v.__esModule?v:{default:v}}i.default=(0,l.default)(function(v,E,w){var M=(0,n.default)(E)?[]:{};v(E,function(k,D,N){(0,o.default)(k)(function(V){for(var q,fe=[],he=arguments.length-1;he-- >0;)fe[he]=arguments[he+1];fe.length<2&&(q=fe,fe=q[0]),M[D]=fe,N(V)})},function(k){return w(k,M)})},3),e.exports=i.default}(Ot,Ot.exports);var Zg={exports:{}},Mm={exports:{}},Ug={exports:{}},b0={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=t;function t(n){function r(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(n!==null){var l=n;n=null,l.apply(this,o)}}return Object.assign(r,n),r}e.exports=i.default})(b0,b0.exports);var Vg={exports:{}},Gg={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},e.exports=i.default})(Gg,Gg.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=E;var t=or.exports,n=u(t),r=Gg.exports,o=u(r);function u(w){return w&&w.__esModule?w:{default:w}}function l(w){var M=-1,k=w.length;return function(){return++M<k?{value:w[M],key:M}:null}}function p(w){var M=-1;return function(){var D=w.next();return D.done?null:(M++,{value:D.value,key:M})}}function v(w){var M=w?Object.keys(w):[],k=-1,D=M.length;return function N(){var V=M[++k];return V==="__proto__"?N():k<D?{value:w[V],key:V}:null}}function E(w){if((0,n.default)(w))return l(w);var M=(0,o.default)(w);return M?p(M):v(w)}e.exports=i.default}(Vg,Vg.exports);var E0={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=t;function t(n){return function(){for(var r=[],o=arguments.length;o--;)r[o]=arguments[o];if(n===null)throw new Error("Callback was already called.");var u=n;n=null,u.apply(this,r)}}e.exports=i.default})(E0,E0.exports);var jg={exports:{}},S0={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t={};i.default=t,e.exports=i.default})(S0,S0.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=o;var t=S0.exports,n=r(t);function r(u){return u&&u.__esModule?u:{default:u}}function o(u,l,p,v){var E=!1,w=!1,M=!1,k=0,D=0;function N(){k>=l||M||E||(M=!0,u.next().then(function(fe){var he=fe.value,Be=fe.done;if(!(w||E)){if(M=!1,Be){E=!0,k<=0&&v(null);return}k++,p(he,D,V),D++,N()}}).catch(q))}function V(fe,he){if(k-=1,!w){if(fe)return q(fe);if(fe===!1){E=!0,w=!0;return}if(he===n.default||E&&k<=0)return E=!0,v(null);N()}}function q(fe){w||(M=!1,E=!0,v(fe))}N()}e.exports=i.default}(jg,jg.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=b0.exports,n=k(t),r=Vg.exports,o=k(r),u=E0.exports,l=k(u),p=qr,v=jg.exports,E=k(v),w=S0.exports,M=k(w);function k(D){return D&&D.__esModule?D:{default:D}}i.default=function(D){return function(N,V,q){if(q=(0,n.default)(q),D<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!N)return q(null);if((0,p.isAsyncGenerator)(N))return(0,E.default)(N,D,V,q);if((0,p.isAsyncIterable)(N))return(0,E.default)(N[Symbol.asyncIterator](),D,V,q);var fe=(0,o.default)(N),he=!1,Be=!1,Ge=0,St=!1;function Ut(nr,Rr){if(!Be)if(Ge-=1,nr)he=!0,q(nr);else if(nr===!1)he=!0,Be=!0;else{if(Rr===M.default||he&&Ge<=0)return he=!0,q(null);St||Yt()}}function Yt(){for(St=!0;Ge<D&&!he;){var nr=fe();if(nr===null){he=!0,Ge<=0&&q(null);return}Ge+=1,V(nr.value,nr.key,(0,l.default)(Ut))}St=!1}Yt()}},e.exports=i.default}(Ug,Ug.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=Ug.exports,n=p(t),r=qr,o=p(r),u=ev.exports,l=p(u);function p(E){return E&&E.__esModule?E:{default:E}}function v(E,w,M,k){return(0,n.default)(w)(E,(0,o.default)(M),k)}i.default=(0,l.default)(v,4),e.exports=i.default}(Mm,Mm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=Mm.exports,n=u(t),r=ev.exports,o=u(r);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v,E){return(0,n.default)(p,1,v,E)}i.default=(0,o.default)(l,3),e.exports=i.default}(Zg,Zg.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=l;var t=Ot.exports,n=u(t),r=Zg.exports,o=u(r);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v){return(0,n.default)(o.default,p,v)}e.exports=i.default}(_t,_t.exports);var Im=ze(_t.exports),Op=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,t=[],n=0;n<arguments.length;n++)t[n]=i[n];return this.args=t,Im(this.tasks)},e.prototype.tap=function(i,t){var n=this;this.tasks.push(function(r){t.apply(void 0,pe([],G(n.args),!1)),r(null,i)})},e}(),Hg={exports:{}},Wg={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=or.exports,n=V(t),r=S0.exports,o=V(r),u=Mm.exports,l=V(u),p=b0.exports,v=V(p),E=E0.exports,w=V(E),M=qr,k=V(M),D=ev.exports,N=V(D);function V(Be){return Be&&Be.__esModule?Be:{default:Be}}function q(Be,Ge,St){St=(0,v.default)(St);var Ut=0,Yt=0,nr=Be.length,Rr=!1;nr===0&&St(null);function Tr(on,Hn){on===!1&&(Rr=!0),Rr!==!0&&(on?St(on):(++Yt===nr||Hn===o.default)&&St(null))}for(;Ut<nr;Ut++)Ge(Be[Ut],Ut,(0,w.default)(Tr))}function fe(Be,Ge,St){return(0,l.default)(Be,Infinity,Ge,St)}function he(Be,Ge,St){var Ut=(0,n.default)(Be)?q:fe;return Ut(Be,(0,k.default)(Ge),St)}i.default=(0,N.default)(he,3),e.exports=i.default})(Wg,Wg.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=l;var t=Wg.exports,n=u(t),r=Ot.exports,o=u(r);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v){return(0,o.default)(n.default,p,v)}e.exports=i.default}(Hg,Hg.exports);var HE=ze(Hg.exports),aR=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return HE(this.tasks)},e.prototype.tapPromise=function(i,t){var n=this;this.tasks.push(function(r){return x(n,void 0,void 0,function(){return P(this,function(o){switch(o.label){case 0:return[4,t()];case 1:return o.sent(),r(null,i),[2]}})})})},e}(),Xg={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=b0.exports,n=E(t),r=E0.exports,o=E(r),u=qr,l=E(u),p=ev.exports,v=E(p);function E(M){return M&&M.__esModule?M:{default:M}}function w(M,k){if(k=(0,n.default)(k),!Array.isArray(M))return k(new Error("First argument to waterfall must be an array of functions"));if(!M.length)return k();var D=0;function N(q){var fe=(0,l.default)(M[D++]);fe.apply(void 0,q.concat([(0,o.default)(V)]))}function V(q){for(var fe=[],he=arguments.length-1;he-- >0;)fe[he]=arguments[he+1];if(q!==!1){if(q||D===M.length)return k.apply(void 0,[q].concat(fe));N(fe)}}N([])}i.default=(0,v.default)(w),e.exports=i.default})(Xg,Xg.exports);var Wy=ze(Xg.exports),oR=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return Wy(this.tasks)},e.prototype.tap=function(i,t){this.tasks.length===0?this.tasks.push(function(n){var r=t();n(r?null:!1,r)}):this.tasks.push(function(n,r){var o=t.apply(void 0,pe([],G(n),!1));r(o?null:!1,i)})},e}(),Xy=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return Im(this.tasks)},e.prototype.tap=function(i,t){this.tasks.push(function(n){var r=t();n(r,i)})},e}(),WE=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,t=[],n=0;n<arguments.length;n++)t[n]=i[n];return this.args=t,Im(this.tasks)},e.prototype.tapPromise=function(i,t){var n=this;this.tasks.push(function(r){return x(n,void 0,void 0,function(){return P(this,function(o){switch(o.label){case 0:return[4,t.apply(void 0,pe([],G(this.args),!1))];case 1:return o.sent(),r(null,i),[2]}})})})},e}(),XE=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,t=[],n=0;n<arguments.length;n++)t[n]=i[n];return this.args=t,Im(this.tasks)},e.prototype.tapPromise=function(i,t){var n=this;this.tasks.push(function(r){return x(n,void 0,void 0,function(){var o;return P(this,function(u){switch(u.label){case 0:return[4,t.apply(void 0,pe([],G(this.args),!1))];case 1:return o=u.sent(),r(o,i),[2]}})})})},e}(),$E=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return Wy(this.tasks)},e.prototype.tapPromise=function(i,t){this.tasks.length===0?this.tasks.push(function(n){t().then(function(r){n(null,r)})}):this.tasks.push(function(n,r){t(n).then(function(o){r(null,o)})})},e}(),$y=ie(67709),YE=ie.n($y),Yy,qy,Ky,Qy,Jy,e_,t_,r_,n_,i_,a_,o_,s_,u_,l_,c_,f_,h_,pc,p_,d_,v_,m_,g_,y_,__,x_,b_,E_,S_,w_,A_,C_,T_,M_;function qE(e){var i=KE();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function KE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QE=(Yy=(0,kn.b2)(),qy=(0,kn.f3)(fr.SceneID),Ky=(0,kn.f3)(fr.IIconService),Qy=(0,kn.f3)(fr.IFontService),Jy=(0,kn.f3)(fr.IControlService),e_=(0,kn.f3)(fr.IGlobalConfigService),t_=(0,kn.f3)(fr.IMapService),r_=(0,kn.f3)(fr.ICoordinateSystemService),n_=(0,kn.f3)(fr.IRendererService),i_=(0,kn.f3)(fr.ILayerService),a_=(0,kn.f3)(fr.IDebugService),o_=(0,kn.f3)(fr.ICameraService),s_=(0,kn.f3)(fr.IInteractionService),u_=(0,kn.f3)(fr.IPickingService),l_=(0,kn.f3)(fr.IShaderModuleService),c_=(0,kn.f3)(fr.IMarkerService),f_=(0,kn.f3)(fr.IPopupService),Yy(h_=(pc=function(e){(0,Fr.Z)(t,e);var i=qE(t);function t(){var n;return(0,Ht.Z)(this,t),n=i.call(this),(0,J.Z)((0,Ke.Z)(n),"destroyed",!1),(0,J.Z)((0,Ke.Z)(n),"loaded",!1),Ta((0,Ke.Z)(n),"id",p_,(0,Ke.Z)(n)),Ta((0,Ke.Z)(n),"iconService",d_,(0,Ke.Z)(n)),Ta((0,Ke.Z)(n),"fontService",v_,(0,Ke.Z)(n)),Ta((0,Ke.Z)(n),"controlService",m_,(0,Ke.Z)(n)),Ta((0,Ke.Z)(n),"configService",g_,(0,Ke.Z)(n)),Ta((0,Ke.Z)(n),"map",y_,(0,Ke.Z)(n)),Ta((0,Ke.Z)(n),"coordinateSystemService",__,(0,Ke.Z)(n)),Ta((0,Ke.Z)(n),"rendererService",x_,(0,Ke.Z)(n)),Ta((0,Ke.Z)(n),"layerService",b_,(0,Ke.Z)(n)),Ta((0,Ke.Z)(n),"debugService",E_,(0,Ke.Z)(n)),Ta((0,Ke.Z)(n),"cameraService",S_,(0,Ke.Z)(n)),Ta((0,Ke.Z)(n),"interactionService",w_,(0,Ke.Z)(n)),Ta((0,Ke.Z)(n),"pickingService",A_,(0,Ke.Z)(n)),Ta((0,Ke.Z)(n),"shaderModuleService",C_,(0,Ke.Z)(n)),Ta((0,Ke.Z)(n),"markerService",T_,(0,Ke.Z)(n)),Ta((0,Ke.Z)(n),"popupService",M_,(0,Ke.Z)(n)),(0,J.Z)((0,Ke.Z)(n),"inited",!1),(0,J.Z)((0,Ke.Z)(n),"initPromise",void 0),(0,J.Z)((0,Ke.Z)(n),"rendering",!1),(0,J.Z)((0,Ke.Z)(n),"$container",void 0),(0,J.Z)((0,Ke.Z)(n),"canvas",void 0),(0,J.Z)((0,Ke.Z)(n),"markerContainer",void 0),(0,J.Z)((0,Ke.Z)(n),"hooks",void 0),(0,J.Z)((0,Ke.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),mt(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,J.Z)((0,Ke.Z)(n),"handleMapCameraChanged",function(r){n.cameraService.update(r),n.render()}),n.hooks={init:new WE},n}return(0,tr.Z)(t,[{key:"init",value:function(r){var o=this;this.configService.setSceneConfig(this.id,r),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,ot.Z)(se().mark(function u(){return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o.debugService.log("map.mapInitStart",{type:o.map.version}),p.next=3,new Promise(function(v){o.map.onCameraChanged(function(E){o.cameraService.init(),o.cameraService.update(E),v()}),o.map.init()});case 3:o.map.onCameraChanged(o.handleMapCameraChanged),o.map.addMarkerContainer(),o.markerService.addMarkers(),o.markerService.addMarkerLayers(),o.popupService.initPopup(),o.interactionService.init(),o.interactionService.on(Yl.Drag,o.addSceneEvent.bind(o));case 10:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,ot.Z)(se().mark(function u(){var l,p;return se().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(l=o.map.getOverlayContainer(),l?o.$container=l:o.$container=wg(o.configService.getSceneConfig(o.id).id||""),!o.$container){E.next=13;break}return o.canvas=I("canvas","",o.$container),o.setCanvas(),E.next=7,o.rendererService.init(o.canvas,o.configService.getSceneConfig(o.id),r.gl);case 7:o.registerContextLost(),o.initContainer(),YE()(o.$container,o.handleWindowResized),wa.matchMedia&&((p=wa.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||p===void 0||p.addListener(o.handleWindowResized)),E.next=14;break;case 13:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 14:o.pickingService.init(o.id);case 15:case"end":return E.stop()}},u)}))),this.render()}},{key:"registerContextLost",value:function(){var r=this,o=this.rendererService.getCanvas();o&&o.addEventListener("webglcontextlost",function(){return r.emit("webglcontextlost")})}},{key:"initMiniScene",value:function(r){var o=this;this.configService.setSceneConfig(this.id,r),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,ot.Z)(se().mark(function u(){return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,new Promise(function(v){o.map.onCameraChanged(function(E){o.cameraService.init(),o.cameraService.update(E),o.map.version!=="GAODE2.x"&&v()}),o.map.initMiniMap()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.interactionService.init(),o.interactionService.on(Yl.Drag,o.addSceneEvent.bind(o));case 5:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,ot.Z)(se().mark(function u(){var l;return se().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(l=r.canvas,o.$container=l||null,!o.$container){v.next=7;break}return v.next=5,o.rendererService.init(r.canvas,o.configService.getSceneConfig(o.id),void 0);case 5:v.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:o.pickingService.init(o.id);case 9:case"end":return v.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(r){this.layerService.sceneService=this,this.layerService.add(r)}},{key:"addMask",value:function(r){this.layerService.sceneService=this,this.layerService.addMask(r)}},{key:"render",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.rendering||this.destroyed)){l.next=2;break}return l.abrupt("return");case 2:if(this.rendering=!0,this.inited){l.next=16;break}return l.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),l.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,l.next=20;break;case 16:return l.next=18,this.layerService.initLayers();case 18:return l.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"addFontFace",value:function(r,o){this.fontService.addFontFace(r,o)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var n=(0,ot.Z)(se().mark(function o(u){var l,p,v;return se().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return p=(l=this.$container)===null||l===void 0?void 0:l.getElementsByTagName("canvas")[0],w.next=3,this.render();case 3:return v=u==="jpg"?p==null?void 0:p.toDataURL("image/jpeg"):p==null?void 0:p.toDataURL("image/png"),w.abrupt("return",v);case 5:case"end":return w.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var r=this.$container.parentElement;r!==null&&(this.markerContainer=I("div","l7-marker-container",r))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var r=this,o,u;if(!this.inited){this.destroyed=!0;return}if((0,$y.unbind)(this.$container,this.handleWindowResized),wa.matchMedia){var l;(l=wa.matchMedia("screen and (min-resolution: 2dppx)"))===null||l===void 0||l.removeListener(this.handleWindowResized)}this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var p;(p=r.$container)===null||p===void 0||p.removeChild(r.canvas),r.canvas=null,r.rendererService.destroy()}),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var r,o,u=vt,l=((r=this.$container)===null||r===void 0?void 0:r.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v&&(v.width=l*u,v.height=p*u),this.rendererService.viewport({x:0,y:0,width:u*l,height:u*p})}},{key:"setCanvas",value:function(){var r,o,u=vt,l=((r=this.$container)===null||r===void 0?void 0:r.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v.width=l*u,v.height=p*u,v.style.width="100%",v.style.height="100%"}},{key:"addSceneEvent",value:function(r){this.emit(r.type,r)}}]),t}(fs.EventEmitter),p_=Ma(pc.prototype,"id",[qy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d_=Ma(pc.prototype,"iconService",[Ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v_=Ma(pc.prototype,"fontService",[Qy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m_=Ma(pc.prototype,"controlService",[Jy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g_=Ma(pc.prototype,"configService",[e_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y_=Ma(pc.prototype,"map",[t_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),__=Ma(pc.prototype,"coordinateSystemService",[r_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x_=Ma(pc.prototype,"rendererService",[n_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b_=Ma(pc.prototype,"layerService",[i_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E_=Ma(pc.prototype,"debugService",[a_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S_=Ma(pc.prototype,"cameraService",[o_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w_=Ma(pc.prototype,"interactionService",[s_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A_=Ma(pc.prototype,"pickingService",[u_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C_=Ma(pc.prototype,"shaderModuleService",[l_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T_=Ma(pc.prototype,"markerService",[c_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M_=Ma(pc.prototype,"popupService",[f_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pc))||h_);function JE(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var eS=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function I_(e){var i={};return e=e.replace(eS,function(t,n,r){var o=r.split(":"),u=o[0].trim(),l="";switch(o.length>1&&(l=o[1].trim()),n){case"bool":l=l==="true";break;case"float":case"int":l=Number(l);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":l?l=l.replace("[","").replace("]","").split(",").reduce(function(p,v){return p.push(Number(v.trim())),p},[]):l=new Array(JE(n)).fill(0);break;default:}return i[u]=l,"uniform ".concat(n," ").concat(u,`;
`)}),{content:e,uniforms:i}}var k_,P_,R_="#define PI 3.14159265359",tS=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,rS=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,nS=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,iS=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,aS=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,oS=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,sS=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,uS=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,lS=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,cS=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,fS=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,hS=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,pS=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,dS=/precision\s+(high|low|medium)p\s+float/,vS=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,mS=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,gS=(k_=(0,kn.b2)(),k_(P_=function(){function e(){(0,Ht.Z)(this,e),(0,J.Z)(this,"moduleCache",{}),(0,J.Z)(this,"rawContentCache",{})}return(0,tr.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:R_,fs:R_}),this.registerModule("decode",{vs:tS,fs:""}),this.registerModule("projection",{vs:sS,fs:""}),this.registerModule("project",{vs:oS,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:uS}),this.registerModule("lighting",{vs:nS,fs:""}),this.registerModule("light",{vs:rS,fs:""}),this.registerModule("picking",{vs:aS,fs:iS}),this.registerModule("styleMapping",{vs:lS,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:pS,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:cS,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:fS,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:hS,fs:""})}},{key:"registerModule",value:function(t,n){if(!this.rawContentCache[t]){var r=n.vs,o=n.fs,u=n.uniforms,l=I_(r),p=l.content,v=l.uniforms,E=I_(o),w=E.content,M=E.uniforms;this.rawContentCache[t]={fs:w,uniforms:(0,U.Z)((0,U.Z)((0,U.Z)({},v),M),u),vs:p}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var n=this;if(this.moduleCache[t])return this.moduleCache[t];var r=this.rawContentCache[t].vs,o=this.rawContentCache[t].fs,u=this.processModule(r,[],"vs"),l=u.content,p=u.includeList,v=this.processModule(o,[],"fs"),E=v.content,w=v.includeList,M=E,k=(0,f.uniq)(p.concat(w).concat(t)).reduce(function(D,N){return(0,U.Z)((0,U.Z)({},D),n.rawContentCache[N].uniforms)},{});return dS.test(E)||(M=vS+E),this.moduleCache[t]={fs:M.trim(),uniforms:k,vs:l.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,n,r){var o=this,u=t.replace(mS,function(l,p){var v=p.split(" "),E=v[0].replace(/"/g,"");if(n.indexOf(E)>-1)return"";var w=o.rawContentCache[E][r];n.push(E);var M=o.processModule(w,n,r),k=M.content;return k});return{content:u,includeList:n}}}]),e}())||P_);function yS(e,i){for(;!Object.prototype.hasOwnProperty.call(e,i)&&(e=(0,it.Z)(e),e!==null););return e}function Fo(){return typeof Reflect!="undefined"&&Reflect.get?Fo=Reflect.get.bind():Fo=function(i,t,n){var r=yS(i,t);if(!!r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?i:n):o.value}},Fo.apply(this,arguments)}var Pd;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Pd||(Pd={}));var L_,O_,km=(L_=(0,kn.b2)(),L_(O_=function(){function e(){(0,Ht.Z)(this,e),(0,J.Z)(this,"shaderModuleService",void 0),(0,J.Z)(this,"rendererService",void 0),(0,J.Z)(this,"cameraService",void 0),(0,J.Z)(this,"mapService",void 0),(0,J.Z)(this,"interactionService",void 0),(0,J.Z)(this,"layerService",void 0),(0,J.Z)(this,"config",void 0)}return(0,tr.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Pd.Normal}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(fr.IRendererService),this.cameraService=t.getContainer().get(fr.ICameraService),this.mapService=t.getContainer().get(fr.IMapService),this.interactionService=t.getContainer().get(fr.IInteractionService),this.layerService=t.getContainer().get(fr.ILayerService),this.shaderModuleService=t.getContainer().get(fr.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||O_),F_,D_;function _S(e){var i=xS();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function xS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bS=(F_=(0,kn.b2)(),F_(D_=function(e){(0,Fr.Z)(t,e);var i=_S(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(r,o){Fo((0,it.Z)(t.prototype),"init",this).call(this,r,o)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(km))||D_),B_,N_,z_,$g,Z_;function ES(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=SS(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function SS(e,i){if(!!e){if(typeof e=="string")return U_(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return U_(e,i)}}function U_(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}var wS=(B_=(0,kn.b2)(),N_=(0,kn.f3)(fr.IPostProcessor),B_(z_=($g=function(){function e(){(0,Ht.Z)(this,e),(0,J.Z)(this,"passes",[]),Ta(this,"postProcessor",Z_,this),(0,J.Z)(this,"layer",void 0),(0,J.Z)(this,"renderFlag",void 0),(0,J.Z)(this,"width",0),(0,J.Z)(this,"height",0)}return(0,tr.Z)(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,ot.Z)(se().mark(function n(){var r,o,u;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:r=ES(this.passes),p.prev=1,r.s();case 3:if((o=r.n()).done){p.next=9;break}return u=o.value,p.next=7,u.render(this.layer);case 7:p.next=3;break;case 9:p.next=14;break;case 11:p.prev=11,p.t0=p.catch(1),r.e(p.t0);case 14:return p.prev=14,r.f(),p.finish(14);case 17:return p.next=19,this.postProcessor.render(this.layer);case 19:case"end":return p.stop()}},n,this,[[1,11,14,17]])}));function t(){return i.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){(this.width!==t||this.height!==n)&&(this.postProcessor.resize(t,n),this.width=t,this.height=n)}},{key:"add",value:function(t,n){t.getType()===Pd.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(t,n,r){t.init(this.layer,n),this.passes.splice(r,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Z_=Ma($g.prototype,"postProcessor",[N_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$g))||z_),V_,G_;function AS(e){var i=CS();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function CS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TS=(V_=(0,kn.b2)(),V_(G_=function(e){(0,Fr.Z)(t,e);var i=AS(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"pickingFBO",void 0),(0,J.Z)((0,Ke.Z)(n),"layer",void 0),(0,J.Z)((0,Ke.Z)(n),"width",0),(0,J.Z)((0,Ke.Z)(n),"height",0),(0,J.Z)((0,Ke.Z)(n),"alreadyInRendering",!1),(0,J.Z)((0,Ke.Z)(n),"pickFromPickingFBO",function(l){var p=l.x,v=l.y,E=l.lngLat,w=l.type;if(!(!n.layer.isVisible()||!n.layer.needPick(w))){var M=n.rendererService,k=M.getViewportSize,D=M.readPixels,N=M.useFramebuffer,V=k(),q=V.width,fe=V.height,he=n.layer.getLayerConfig(),Be=he.enableHighlight,Ge=he.enableSelect,St=p*vt,Ut=v*vt;if(!(St>q||St<0||Ut>fe||Ut<0)){var Yt;N(n.pickingFBO,function(){var nr;if(Yt=D({x:Math.round(St),y:Math.round(fe-(v+1)*vt),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),Yt[0]!==0||Yt[1]!==0||Yt[2]!==0){var Rr=Ll(Yt),Tr=n.layer.getSource().getFeatureById(Rr),on={x:p,y:v,type:w,lngLat:E,featureId:Rr,feature:Tr};Tr&&(n.layer.setCurrentPickId(Rr),n.triggerHoverOnLayer(on))}else{var Hn={x:p,y:v,lngLat:E,type:n.layer.getCurrentPickId()===null?"un"+w:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,U.Z)((0,U.Z)({},Hn),{},{type:"unpick"})),n.triggerHoverOnLayer(Hn),n.layer.setCurrentPickId(null)}Be&&n.highlightPickedFeature(Yt),Ge&&w==="click"&&((nr=Yt)===null||nr===void 0?void 0:nr.toString())!==[0,0,0,0].toString()&&n.selectFeature(Yt)})}}}),n}return(0,tr.Z)(t,[{key:"getType",value:function(){return Pd.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(r,o){Fo((0,it.Z)(t.prototype),"init",this).call(this,r,o),this.layer=r;var u=this.rendererService,l=u.createTexture2D,p=u.createFramebuffer,v=u.getViewportSize,E=v(),w=E.width,M=E.height;this.pickingFBO=p({color:l({width:w,height:M,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE})}),this.interactionService.on(Yl.Hover,this.pickFromPickingFBO),this.interactionService.on(Yl.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Yl.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(r){var o=this;if(!this.alreadyInRendering){var u=this.rendererService,l=u.getViewportSize,p=u.useFramebuffer,v=u.clear,E=l(),w=E.width,M=E.height;this.alreadyInRendering=!0,(this.width!==w||this.height!==M)&&(this.pickingFBO.resize({width:w,height:M}),this.width=w,this.height=M),p(this.pickingFBO,function(){v({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var k=o.layer.multiPassRenderer.getRenderFlag();o.layer.multiPassRenderer.setRenderFlag(!1),r.hooks.beforePickingEncode.call(),r.render(),r.hooks.afterPickingEncode.call(),o.layer.multiPassRenderer.setRenderFlag(k),o.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(r){this.layer.emit(r.type,r)}},{key:"highlightPickedFeature",value:function(r){var o=(0,Ti.Z)(r,3),u=o[0],l=o[1],p=o[2];this.layer.hooks.beforeHighlight.call([u,l,p]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(r){var o=(0,Ti.Z)(r,3),u=o[0],l=o[1],p=o[2];this.layer.hooks.beforeSelect.call([u,l,p]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(r){var o=r.featureId,u=Zu(o);this.selectFeature(new Uint8Array(u))}},{key:"highlightFeatureHandle",value:function(r){var o=r.featureId,u=Zu(o);this.highlightPickedFeature(new Uint8Array(u))}}]),t}(km))||G_),j_,H_,W_,Yg,X_,MS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,sd=(j_=(0,kn.b2)(),H_=(0,kn.f3)(fr.IShaderModuleService),j_(W_=(Yg=function(){function e(){(0,Ht.Z)(this,e),Ta(this,"shaderModuleService",X_,this),(0,J.Z)(this,"rendererService",void 0),(0,J.Z)(this,"config",void 0),(0,J.Z)(this,"quad",MS),(0,J.Z)(this,"enabled",!0),(0,J.Z)(this,"renderToScreen",!1),(0,J.Z)(this,"model",void 0),(0,J.Z)(this,"name",void 0),(0,J.Z)(this,"optionsToUpdate",{})}return(0,tr.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return Pd.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(fr.IRendererService),this.shaderModuleService=t.getContainer().get(fr.IShaderModuleService);var r=this.rendererService,o=r.createAttribute,u=r.createBuffer,l=r.createModel,p=this.setupShaders(),v=p.vs,E=p.fs,w=p.uniforms;this.model=l({vs:v,fs:E,attributes:{a_Position:o({buffer:u({data:[-4,-4,4,-4,0,4],type:ee.FLOAT}),size:2})},uniforms:(0,U.Z)((0,U.Z)({u_Texture:null},w),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,n){var r=this,o=t.multiPassRenderer.getPostProcessor(),u=this.rendererService,l=u.useFramebuffer,p=u.getViewportSize,v=u.clear,E=p(),w=E.width,M=E.height;l(this.renderToScreen?null:o.getWriteFBO(),function(){v({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var k=(0,U.Z)({u_BloomFinal:0,u_Texture:o.getReadFBO(),u_ViewportSize:[w,M]},r.convertOptionsToUniforms(r.optionsToUpdate));n&&(k.u_BloomFinal=1,k.u_Texture2=n),r.model.draw({uniforms:k})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=(0,U.Z)((0,U.Z)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var n={};return Object.keys(t).forEach(function(r){(0,f.isNil)(t[r])||(n["u_".concat((0,f.upperFirst)((0,f.camelCase)(r)))]=t[r])}),n}}]),e}(),X_=Ma(Yg.prototype,"shaderModuleService",[H_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yg))||W_),$_,Y_;function IS(e){var i=kS();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function kS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PS=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,RS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,LS=($_=(0,kn.b2)(),$_(Y_=function(e){(0,Fr.Z)(t,e);var i=IS(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:RS,fs:PS});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,l=r.uniforms,p=this.rendererService.getViewportSize(),v=p.width,E=p.height;return{vs:o,fs:u,uniforms:(0,U.Z)((0,U.Z)({},l),{},{u_ViewportSize:[v,E]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,f.isNil)(r.bloomRadius)||(o.u_radius=r.bloomRadius),(0,f.isNil)(r.bloomIntensity)||(o.u_intensity=r.bloomIntensity),(0,f.isNil)(r.bloomBaseRadio)||(o.u_baseRadio=r.bloomBaseRadio),o}}]),t}(sd))||Y_),q_,K_;function OS(e){var i=FS();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function FS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,BS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,NS=(q_=(0,kn.b2)(),q_(K_=function(e){(0,Fr.Z)(t,e);var i=OS(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:BS,fs:DS});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,l=r.uniforms,p=this.rendererService.getViewportSize(),v=p.width,E=p.height;return{vs:o,fs:u,uniforms:(0,U.Z)((0,U.Z)({},l),{},{u_ViewportSize:[v,E]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,f.isNil)(r.blurRadius)||(o.u_BlurDir=[r.blurRadius,0]),o}}]),t}(sd))||K_),Q_,J_;function zS(e){var i=ZS();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function ZS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var US=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,VS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,GS=(Q_=(0,kn.b2)(),Q_(J_=function(e){(0,Fr.Z)(t,e);var i=zS(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:VS,fs:US});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,l=r.uniforms,p=this.rendererService.getViewportSize(),v=p.width,E=p.height;return{vs:o,fs:u,uniforms:(0,U.Z)((0,U.Z)({},l),{},{u_ViewportSize:[v,E]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,f.isNil)(r.blurRadius)||(o.u_BlurDir=[0,r.blurRadius]),o}}]),t}(sd))||J_),e1,t1;function jS(e){var i=HS();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function HS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,XS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,$S=(e1=(0,kn.b2)(),e1(t1=function(e){(0,Fr.Z)(t,e);var i=jS(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:XS,fs:WS});var r=this.shaderModuleService.getModule("colorhalftone-pass"),o=r.vs,u=r.fs,l=r.uniforms,p=this.rendererService.getViewportSize(),v=p.width,E=p.height;return{vs:o,fs:u,uniforms:(0,U.Z)((0,U.Z)({},l),{},{u_ViewportSize:[v,E]})}}}]),t}(sd))||t1),r1,n1;function YS(e){var i=qS();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function qS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,QS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,JS=(r1=(0,kn.b2)(),r1(n1=function(e){(0,Fr.Z)(t,e);var i=YS(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:QS,fs:KS}),this.shaderModuleService.getModule("copy-pass")}}]),t}(sd))||n1),i1,a1;function ew(e){var i=tw();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function tw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rw=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,nw=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,iw=(i1=(0,kn.b2)(),i1(a1=function(e){(0,Fr.Z)(t,e);var i=ew(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:nw,fs:rw});var r=this.shaderModuleService.getModule("hexagonalpixelate-pass"),o=r.vs,u=r.fs,l=r.uniforms,p=this.rendererService.getViewportSize(),v=p.width,E=p.height;return{vs:o,fs:u,uniforms:(0,U.Z)((0,U.Z)({},l),{},{u_ViewportSize:[v,E]})}}}]),t}(sd))||a1),o1,s1;function aw(e){var i=ow();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function ow(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sw=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,uw=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,lw=(o1=(0,kn.b2)(),o1(s1=function(e){(0,Fr.Z)(t,e);var i=aw(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:uw,fs:sw});var r=this.shaderModuleService.getModule("ink-pass"),o=r.vs,u=r.fs,l=r.uniforms,p=this.rendererService.getViewportSize(),v=p.width,E=p.height;return{vs:o,fs:u,uniforms:(0,U.Z)((0,U.Z)({},l),{},{u_ViewportSize:[v,E]})}}}]),t}(sd))||s1),u1,l1;function cw(e){var i=fw();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function fw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hw=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,pw=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,dw=(u1=(0,kn.b2)(),u1(l1=function(e){(0,Fr.Z)(t,e);var i=cw(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:pw,fs:hw}),this.shaderModuleService.getModule("noise-pass")}}]),t}(sd))||l1),c1,f1;function vw(e){var i=mw();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function mw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gw=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yw=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,_w=(c1=(0,kn.b2)(),c1(f1=function(e){(0,Fr.Z)(t,e);var i=vw(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:gw,fs:yw}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(sd))||f1),h1,p1,d1,v1,Nv,m1,xw=(h1=(0,kn.b2)(),p1=(0,kn.f3)(fr.IRendererService),d1=(0,kn.zY)(),h1(v1=(Nv=function(){function e(){(0,Ht.Z)(this,e),Ta(this,"rendererService",m1,this),(0,J.Z)(this,"passes",[]),(0,J.Z)(this,"readFBO",void 0),(0,J.Z)(this,"writeFBO",void 0)}return(0,tr.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,n=t.getViewportSize,r=t.createTexture2D,o=n(),u=o.width,l=o.height;return r({x:0,y:0,width:u,height:l,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,n=this.rendererService.useFramebuffer;return new Promise(function(r){n(t.readFBO,(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:r(t.getCurrentFBOTex());case 1:case"end":return l.stop()}},o)})))})}},{key:"renderBloomPass",value:function(){var i=(0,ot.Z)(se().mark(function n(r,o){var u,l;return se().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.getReadFBOTex();case 2:u=v.sent,l=0;case 4:if(!(l<4)){v.next=11;break}return v.next=7,o.render(r,u);case 7:this.swap(),l++,v.next=4;break;case 11:case"end":return v.stop()}},n,this)}));function t(n,r){return i.apply(this,arguments)}return t}()},{key:"render",value:function(){var i=(0,ot.Z)(se().mark(function n(r){var o,u;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:o=0;case 1:if(!(o<this.passes.length)){p.next=15;break}if(u=this.passes[o],u.setRenderToScreen(this.isLastEnabledPass(o)),u.getName()!=="bloom"){p.next=9;break}return p.next=7,this.renderBloomPass(r,u);case 7:p.next=12;break;case 9:return p.next=11,u.render(r);case 11:o!==this.passes.length-1&&this.swap();case 12:o++,p.next=1;break;case 15:case"end":return p.stop()}},n,this)}));function t(n){return i.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){this.readFBO.resize({width:t,height:n}),this.writeFBO.resize({width:t,height:n})}},{key:"add",value:function(t,n,r){t.init(n,r),this.passes.push(t)}},{key:"insert",value:function(t,n,r,o){t.init(r,o),this.passes.splice(n,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(n){return n.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,r=t.createTexture2D;this.readFBO=n({color:r({width:1,height:1,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE})}),this.writeFBO=n({color:r({width:1,height:1,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),m1=Ma(Nv.prototype,"rendererService",[p1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ma(Nv.prototype,"init",[d1],Object.getOwnPropertyDescriptor(Nv.prototype,"init"),Nv.prototype),Nv))||v1),g1,y1;function bw(e){var i=Ew();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function Ew(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sw=(g1=(0,kn.b2)(),g1(y1=function(e){(0,Fr.Z)(t,e);var i=bw(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getType",value:function(){return Pd.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(r,o){Fo((0,it.Z)(t.prototype),"init",this).call(this,r,o)}},{key:"render",value:function(r){var o=this.rendererService,u=o.useFramebuffer,l=o.clear,p=r.multiPassRenderer.getPostProcessor().getReadFBO();u(p,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:p}),r.multiPassRenderer.setRenderFlag(!1),r.models.forEach(function(v){v.draw({uniforms:r.layerModel.getUninforms()})}),r.multiPassRenderer.setRenderFlag(!0)})}}]),t}(km))||y1),_1,x1,b1,qg,E1;function ww(e){var i=Aw();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function Aw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cw=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,S1=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Tw=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function w1(e,i){for(var t=0,n=1/i,r=e;r>0;)t=t+n*(r%i),r=Math.floor(r/i),n=n/i;return t}var Mw=1,Iw=(_1=(0,kn.b2)(),x1=(0,kn.f3)(fr.IShaderModuleService),_1(b1=(qg=function(e){(0,Fr.Z)(t,e);var i=ww(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),Ta((0,Ke.Z)(n),"shaderModuleService",E1,(0,Ke.Z)(n)),(0,J.Z)((0,Ke.Z)(n),"haltonSequence",[]),(0,J.Z)((0,Ke.Z)(n),"accumulatingId",0),(0,J.Z)((0,Ke.Z)(n),"frame",0),(0,J.Z)((0,Ke.Z)(n),"timer",void 0),(0,J.Z)((0,Ke.Z)(n),"sampleRenderTarget",void 0),(0,J.Z)((0,Ke.Z)(n),"prevRenderTarget",void 0),(0,J.Z)((0,Ke.Z)(n),"outputRenderTarget",void 0),(0,J.Z)((0,Ke.Z)(n),"copyRenderTarget",void 0),(0,J.Z)((0,Ke.Z)(n),"blendModel",void 0),(0,J.Z)((0,Ke.Z)(n),"outputModel",void 0),(0,J.Z)((0,Ke.Z)(n),"copyModel",void 0),n}return(0,tr.Z)(t,[{key:"getType",value:function(){return Pd.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(r,o){Fo((0,it.Z)(t.prototype),"init",this).call(this,r,o);var u=this.rendererService,l=u.createFramebuffer,p=u.createTexture2D;this.sampleRenderTarget=l({color:p({width:1,height:1,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE})}),this.prevRenderTarget=l({color:p({width:1,height:1,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE})}),this.outputRenderTarget=l({color:p({width:1,height:1,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE})}),this.copyRenderTarget=l({color:p({width:1,height:1,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE})});for(var v=0;v<30;v++)this.haltonSequence.push([w1(v,2),w1(v,3)]);this.blendModel=this.createTriangleModel("blend-pass",Cw),this.outputModel=this.createTriangleModel("copy-pass",S1,{blend:{enable:!0,func:{srcRGB:ee.ONE,dstRGB:ee.ONE_MINUS_SRC_ALPHA,srcAlpha:ee.ONE,dstAlpha:ee.ONE_MINUS_SRC_ALPHA},equation:{rgb:ee.FUNC_ADD,alpha:ee.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",S1)}},{key:"render",value:function(r){var o=this,u=this.rendererService,l=u.clear,p=u.getViewportSize,v=u.useFramebuffer,E=p(),w=E.width,M=E.height;this.sampleRenderTarget.resize({width:w,height:M}),this.prevRenderTarget.resize({width:w,height:M}),this.outputRenderTarget.resize({width:w,height:M}),this.copyRenderTarget.resize({width:w,height:M}),this.resetFrame(),this.stopAccumulating();var k=r.multiPassRenderer.getPostProcessor().getReadFBO();v(k,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:k}),r.multiPassRenderer.setRenderFlag(!1),r.render(),r.multiPassRenderer.setRenderFlag(!0)});var D=function N(V){!o.accumulatingId||V!==o.accumulatingId||o.isFinished()||(o.doRender(r),wa.requestAnimationFrame(function(){N(V)}))};this.accumulatingId=Mw++,this.timer=wa.setTimeout(function(){D(o.accumulatingId)},50)}},{key:"doRender",value:function(r){var o=this,u=this.rendererService,l=u.clear,p=u.getViewportSize,v=u.useFramebuffer,E=p(),w=E.width,M=E.height,k=r.getLayerConfig(),D=k.jitterScale,N=D===void 0?1:D,V=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((V[0]*2-1)/w*N,(V[1]*2-1)/M*N),r.multiPassRenderer.setRenderFlag(!1),r.hooks.beforeRender.call(),v(this.sampleRenderTarget,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.sampleRenderTarget}),r.render()}),r.hooks.afterRender.call(),r.multiPassRenderer.setRenderFlag(!0);var q=r.getLayerConfig();v(this.outputRenderTarget,function(){o.blendModel.draw({uniforms:{u_opacity:q.opacity||1,u_MixRatio:o.frame===0?1:.9,u_Diffuse1:o.sampleRenderTarget,u_Diffuse2:o.frame===0?r.multiPassRenderer.getPostProcessor().getReadFBO():o.prevRenderTarget}})}),this.frame===0&&l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(v(this.copyRenderTarget,function(){o.outputModel.draw({uniforms:{u_Texture:o.outputRenderTarget}})}),v(r.multiPassRenderer.getPostProcessor().getReadFBO(),function(){o.copyModel.draw({uniforms:{u_Texture:o.copyRenderTarget}})}),r.multiPassRenderer.getPostProcessor().render(r));var fe=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=fe,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,wa.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(r,o,u){this.shaderModuleService.registerModule(r,{vs:Tw,fs:o});var l=this.shaderModuleService.getModule(r),p=l.vs,v=l.fs,E=l.uniforms,w=this.rendererService,M=w.createAttribute,k=w.createBuffer,D=w.createModel;return D((0,U.Z)({vs:p,fs:v,attributes:{a_Position:M({buffer:k({data:[-4,-4,4,-4,0,4],type:ee.FLOAT}),size:2})},uniforms:(0,U.Z)({},E),depth:{enable:!1},count:3},u))}}]),t}(km),E1=Ma(qg.prototype,"shaderModuleService",[x1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qg))||b1),w0=new kn.W2;w0.bind(fr.IGlobalConfigService).to(hp).inSingletonScope(),(0,kn.GW)((0,kn.b2)(),fs.EventEmitter),w0.bind(fr.IEventEmitter).to(fs.EventEmitter);var A1=(0,ch.Z)(w0,!1),Kg=function(i){var t=A1.lazyInject(i);return function(n,r,o){t.call(this,n,r),o&&(o.initializer=function(){return n[r]})}},sR=function(i){var t=A1.lazyMultiInject(i);return function(n,r,o){t.call(this,n,r),o&&(o.initializer=function(){return n[r]})}},gh=w0,kw=0;function Pw(){var e=new kn.W2;return e.parent=w0,e.bind(fr.SceneID).toConstantValue("".concat(kw++)),e.bind(fr.IShaderModuleService).to(gS).inSingletonScope(),e.bind(fr.ILayerService).to(Rg).inSingletonScope(),e.bind(fr.IDebugService).to(xg).inSingletonScope(),e.bind(fr.ISceneService).to(QE).inSingletonScope(),e.bind(fr.ICameraService).to(Pp).inSingletonScope(),e.bind(fr.ICoordinateSystemService).to(Pv).inSingletonScope(),e.bind(fr.IInteractionService).to(um).inSingletonScope(),e.bind(fr.IPickingService).to(Cg).inSingletonScope(),e.bind(fr.IControlService).to(Vd).inSingletonScope(),e.bind(fr.IMarkerService).to(vv).inSingletonScope(),e.bind(fr.IIconService).to(Ci).inSingletonScope(),e.bind(fr.IFontService).to(Ai).inSingletonScope(),e.bind(fr.IPopupService).to(qc).inSingletonScope(),e.bind(fr.INormalPass).to(bS).whenTargetNamed("clear"),e.bind(fr.INormalPass).to(TS).whenTargetNamed("pixelPicking"),e.bind(fr.INormalPass).to(Sw).whenTargetNamed("render"),e.bind(fr.INormalPass).to(Iw).whenTargetNamed("taa"),e.bind(fr.IFactoryNormalPass).toFactory(function(i){return function(t){return i.container.getNamed(fr.INormalPass,t)}}),e.bind(fr.IPostProcessingPass).to(JS).whenTargetNamed("copy"),e.bind(fr.IPostProcessingPass).to(LS).whenTargetNamed("bloom"),e.bind(fr.IPostProcessingPass).to(NS).whenTargetNamed("blurH"),e.bind(fr.IPostProcessingPass).to(GS).whenTargetNamed("blurV"),e.bind(fr.IPostProcessingPass).to(dw).whenTargetNamed("noise"),e.bind(fr.IPostProcessingPass).to(_w).whenTargetNamed("sepia"),e.bind(fr.IPostProcessingPass).to($S).whenTargetNamed("colorHalftone"),e.bind(fr.IPostProcessingPass).to(iw).whenTargetNamed("hexagonalPixelate"),e.bind(fr.IPostProcessingPass).to(lw).whenTargetNamed("ink"),e.bind(fr.IFactoryPostProcessingPass).toFactory(function(i){return function(t){var n=i.container.getNamed(fr.IPostProcessingPass,t);return n.setName(t),n}}),e}function Pm(e){var i=new kn.W2;return i.parent=e,i.bind(fr.IStyleAttributeService).to(zg).inSingletonScope(),i.bind(fr.IMultiPassRenderer).to(wS).inSingletonScope(),i.bind(fr.IPostProcessor).to(xw).inSingletonScope(),i}var Rw=null;function uR(e){return Rw.indexOf(e)}var Lw=2,lR=4,Ow=64,cR=128,Fw=256,Dw=512,fR=8192,hR=16384,pR=32768,Bw=null,C1=131072,dR=262144,Nw=524288,vR=1048576,zw=2097152,mR=4194304,Zw=8388608,Uw=16777216,Vw=null;function Rm(e,i){return e=clamp(Math.floor(e),0,255),i=clamp(Math.floor(i),0,255),256*e+i}function gR(e){var i=e.color,t=e.radius,n=e.tileX,r=e.tileY,o=e.shape,u=e.opacity,l=e.stroke,p=e.strokeWidth,v=e.strokeOpacity,E=[],w=[],M=[],k=[Rm(i[0],i[1]),Rm(i[2],i[3])],D=[Rm(l[0],l[1]),Rm(l[2],l[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(N){var V=_slicedToArray(N,2),q=V[0],fe=V[1];E.push([].concat(k,[(q+1)*Zw+(fe+1)*zw+getShapeIndex(o)*C1+t,(n+512)*Nw+(r+512)*Ow])),w.push([].concat(D,[p,v])),M.push([u,0,0,0])}),{packedBuffer:E,packedBuffer2:w,packedBuffer3:M}}function yR(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var t=i?1:0,n=Math.floor(e*127);return n*Vw+t*Uw+n*C1+t*Bw+n*Dw+t*Fw+n*Lw+t}var tv={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Cl={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"},vp;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(vp||(vp={}));var Tl;(function(e){e.INIT="init",e.UPDATE="update"})(Tl||(Tl={}));var Ts;(function(e){e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging"})(Ts||(Ts={}));var Rd;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Rd||(Rd={}));var ri;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(ri||(ri={}));var Gw=["mapload","mapchange","mapAfterFrameChange"],Lm=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],mp;(function(e){e.IMAGE="image",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer"})(mp||(mp={}));var jw=function(){var e=(0,ot.Z)(se().mark(function i(t,n,r,o){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(p,v){n({x:t.x,y:t.y,z:t.z},function(E,w){if(E||w.length===0){v(E);return}w&&lh([{data:w,bands:[0]}],r,o,function(M,k){M?v(M):k&&p(k)})})}));case 1:case"end":return l.stop()}},i)}));return function(t,n,r,o){return e.apply(this,arguments)}}();function Hw(e,i){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(t){return bl(t,i)}):e.map(function(t){return{url:bl(t.url,i),bands:t.bands||[0]}}):bl(e,i)}function Ww(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(i){return{url:i,bands:[0]}}):e}function T1(e,i){e.xhrCancel=function(){i.map(function(t){t.abort()})}}var Xw=function(){var e=(0,ot.Z)(se().mark(function i(t,n,r,o,u){var l,p,v,E,w,M;return se().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(l=Ww(n.url),!(l.length>1)){D.next=15;break}return D.next=4,$w(l,n);case 4:if(p=D.sent,v=p.rasterFiles,E=p.xhrList,w=p.errList,T1(t,E),!(w.length>0)){D.next=12;break}return r(w,null),D.abrupt("return");case 12:lh(v,o,u,r),D.next=17;break;case 15:M=qa(n,function(N,V){if(N)r(N);else if(V){var q=[{data:V,bands:l[0].bands}];lh(q,o,u,r)}}),T1(t,[M]);case 17:case"end":return D.stop()}},i)}));return function(t,n,r,o,u){return e.apply(this,arguments)}}();function $w(e,i){return Qg.apply(this,arguments)}function Qg(){return Qg=(0,ot.Z)(se().mark(function e(i,t){var n,r,o,u,l,p,v,E,w,M,k;return se().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:n=[],r=[],o=[],u=0;case 4:if(!(u<i.length)){N.next=20;break}return l=i[u],p=(0,U.Z)((0,U.Z)({},t),{},{url:l.url}),v=l.bands,N.next=10,ol((0,U.Z)((0,U.Z)({},p),{},{type:"arrayBuffer"}));case 10:E=N.sent,w=E.err,M=E.data,k=E.xhr,w&&o.push(w),r.push(k),n.push({data:M,bands:v});case 17:u++,N.next=4;break;case 20:return N.abrupt("return",{rasterFiles:n,xhrList:r,errList:o});case 21:case"end":return N.stop()}},e)})),Qg.apply(this,arguments)}var Yw=function(){var e=(0,ot.Z)(se().mark(function i(t,n,r,o,u){var l;return se().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l={url:Hw(t,n)},v.abrupt("return",new Promise(function(E,w){Xw(r,l,function(M,k){M?w(M):k&&E(k)},o,u)}));case 2:case"end":return v.stop()}},i)}));return function(t,n,r,o,u){return e.apply(this,arguments)}}(),M1=function(){var e=(0,ot.Z)(se().mark(function i(t,n,r,o){var u,l,p,v;return se().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return l=Array.isArray(t)?t[0]:t,o.wmtsOptions?(p=(o==null?void 0:o.getURLFromTemplate)||vf,u=p(l,(0,U.Z)((0,U.Z)({},n),o.wmtsOptions))):(v=(o==null?void 0:o.getURLFromTemplate)||bl,u=v(l,n)),w.abrupt("return",new Promise(function(M,k){var D,N=bs({url:u,type:(o==null||(D=o.requestParameters)===null||D===void 0?void 0:D.type)||"arrayBuffer"},function(V,q){V?k(V):q&&M(q)},o.transformResponse);r.xhrCancel=function(){return N.abort()}}));case 3:case"end":return w.stop()}},i)}));return function(t,n,r,o){return e.apply(this,arguments)}}(),I1=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},qw={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},_R=[mp.ARRAYBUFFER,mp.RGB];function Kw(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function Qw(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Kw(e))throw new Error("tile server url is error");var t=(i==null?void 0:i.dataType)||mp.IMAGE;t===mp.RGB&&(t=mp.ARRAYBUFFER);var n=function(u,l){switch(t){case mp.IMAGE:return M1(e,u,l,i);case mp.ARRAYBUFFER:return Yw(e,u,l,(i==null?void 0:i.format)||I1,i==null?void 0:i.operation);case mp.CUSTOMARRAYBUFFER:case mp.CUSTOMRGB:return jw(l,i==null?void 0:i.getCustomData,(i==null?void 0:i.format)||I1,i==null?void 0:i.operation);default:return M1(e,u,l,i)}},r=(0,U.Z)((0,U.Z)((0,U.Z)({},qw),i),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:r,isTile:!0}}var Jw=["extent","min","max","width","height","format","operation"];function eA(e,i){var t=i.extent,n=i.min,r=i.max,o=i.width,u=i.height,l=i.format,p=i.operation,v=(0,Af.Z)(i,Jw),E;if(l===void 0||$p(e))E=Array.from(e);else{var w=Array.isArray(e)?e:[e];E=Sl(w,l,p)}var M={_id:1,dataArray:[(0,U.Z)((0,U.Z)({_id:1,data:E,width:o,height:u},v),{},{min:n,max:r,coordinates:[[t[0],t[1]],[t[2],t[3]]]})]};return M}var tA={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},rA=function(){var e=(0,ot.Z)(se().mark(function i(t){return se().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise(function(o){var u=(0,Ti.Z)(t.bounds,4),l=u[0],p=u[1],v=u[2],E=u[3],w={layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,textLng:(l+v)/2,textLat:(p+E)/2},geometry:{type:"LineString",coordinates:[[v,E],[v,p],[l,p],[l,p]]}}]}}};o(w)}));case 1:case"end":return r.stop()}},i)}));return function(t){return e.apply(this,arguments)}}();function nA(e,i){var t=function(o){return rA(o)},n=(0,U.Z)((0,U.Z)((0,U.Z)({},tA),i),{},{getTileData:t});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var iA=ie(69848),k1=ie.n(iA);function P1(e,i){var t=i.radius,n=t===void 0?40:t,r=i.maxZoom,o=r===void 0?18:r,u=i.minZoom,l=u===void 0?0:u,p=i.zoom,v=p===void 0?2:p;if(e.pointIndex){var E=e.pointIndex.getClusters(e.extent,Math.floor(v));return e.dataArray=aA(E),e}var w=new(k1())({radius:n,minZoom:l,maxZoom:o}),M={type:"FeatureCollection",features:[]};return M.features=e.dataArray.map(function(k){return{type:"Feature",geometry:{type:"Point",coordinates:k.coordinates},properties:(0,U.Z)({},k)}}),w.load(M.features),w}function aA(e){return e.map(function(i,t){return(0,U.Z)({coordinates:i.geometry.coordinates,_id:t+1},i.properties)})}function oA(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],t=1;t<e.length;t++)e[t]>i&&(i=e[t]);return i}function sA(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],t=1;t<e.length;t++)e[t]<i&&(i=e[t]);return i}function R1(e){if(e.length===0)return 0;for(var i=e[0],t=0,n,r=1;r<e.length;r++)n=i+e[r]*1,Math.abs(i)>=Math.abs(e[r])?t+=i-n+e[r]:t+=e[r]-n+i,i=n;return i+t*1}function uA(e){if(e.length===0)throw new Error("mean requires at least one data point");return R1(e)/e.length}var lA={min:sA,max:oA,mean:uA,sum:R1};function cA(e){var i=fA();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function fA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function hA(e,i){if(Array.isArray(i))return i}var pA=function(e){(0,Fr.Z)(t,e);var i=cA(t);function t(n,r){var o;return(0,Ht.Z)(this,t),o=i.call(this),(0,J.Z)((0,Ke.Z)(o),"type","source"),(0,J.Z)((0,Ke.Z)(o),"isTile",!1),(0,J.Z)((0,Ke.Z)(o),"inited",!1),(0,J.Z)((0,Ke.Z)(o),"hooks",{init:new Op}),(0,J.Z)((0,Ke.Z)(o),"parser",{type:"geojson"}),(0,J.Z)((0,Ke.Z)(o),"transforms",[]),(0,J.Z)((0,Ke.Z)(o),"cluster",!1),(0,J.Z)((0,Ke.Z)(o),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,J.Z)((0,Ke.Z)(o),"invalidExtent",!1),(0,J.Z)((0,Ke.Z)(o),"dataArrayChanged",!1),(0,J.Z)((0,Ke.Z)(o),"cfg",{autoRender:!0}),o.originData=n,o.initCfg(r),o.init().then(function(){o.inited=!0,o.emit("update",{type:"inited"})}),o}return(0,tr.Z)(t,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(r){return this.clusterIndex.getClusters(this.caculClusterExtent(2),r)}},{key:"getClustersLeaves",value:function(r){return this.clusterIndex.getLeaves(r,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(r){var o=this,u=this.clusterOptions,l=u.method,p=l===void 0?"sum":l,v=u.field,E=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(r));this.clusterOptions.zoom=r,E.forEach(function(w){w.id||(w.properties.point_count=1)}),(v||(0,f.isFunction)(p))&&(E=E.map(function(w){var M=w.id;if(M){var k=o.clusterIndex.getLeaves(M,Infinity),D=k.map(function(q){return q.properties}),N;if((0,f.isString)(p)&&v){var V=ru(D,v);N=lA[p](V)}(0,f.isFunction)(p)&&(N=p(D)),w.properties.stat=N}else w.properties.point_count=1;return w})),this.data=ve("geojson")({type:"FeatureCollection",features:E}),this.executeTrans()}},{key:"getFeatureById",value:function(r){var o=this.parser,u=o.type,l=u===void 0?"geojson":u,p=o.geometry;if(l==="geojson"&&!this.cluster){var v=r<this.originData.features.length?this.originData.features[r]:"null",E=(0,f.cloneDeep)(v);if(E!=null&&E.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var w=this.data.dataArray.find(function(M){return M._id===r});E.properties=w}return E}else return l==="json"&&p?this.data.dataArray.find(function(M){return M._id===r}):r<this.data.dataArray.length?this.data.dataArray[r]:"null"}},{key:"updateFeaturePropertiesById",value:function(r,o){this.data.dataArray=this.data.dataArray.map(function(u){return u._id===r?(0,U.Z)((0,U.Z)({},u),o):u}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(r,o){var u=this.data.dataArray.find(function(l){return l[r]===o});return u==null?void 0:u._id}},{key:"setData",value:function(r,o){var u=this;this.originData=r,this.dataArrayChanged=!1,this.initCfg(o),this.init().then(function(){u.emit("update",{type:"update"})})}},{key:"destroy",value:function(){var r;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(r=this.tileset)===null||r===void 0||r.destroy()}},{key:"processData",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u=this;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",new Promise(function(v,E){try{u.excuteParser(),u.initCluster(),u.executeTrans(),v({})}catch(w){E(w)}}));case 1:case"end":return p.stop()}},o)}));function r(){return n.apply(this,arguments)}return r}()},{key:"initCfg",value:function(r){this.cfg=(0,f.mergeWith)(this.cfg,r,hA);var o=this.cfg;o&&(o.parser&&(this.parser=o.parser),o.transforms&&(this.transforms=o.transforms),this.cluster=o.cluster||!1,o.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,U.Z)((0,U.Z)({},this.clusterOptions),o.clusterOptions)))}},{key:"init",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.inited=!1,l.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"excuteParser",value:function(){var r=this.parser,o=r.type||"geojson",u=ve(o);this.data=u(this.originData,r),this.tileset=this.initTileset(),!r.cancelExtent&&(this.extent=Ps(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(r){this.center=[(r[0]+r[2])/2,(r[1]+r[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var r=this.data.tilesetOptions;if(!!r){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(r),this.tileset;var o=new xl((0,U.Z)({},r));return o}}},{key:"executeTrans",value:function(){var r=this,o=this.transforms;o.forEach(function(u){var l=u.type,p=Ae(l)(r.data,u);Object.assign(r.data,p)})}},{key:"initCluster",value:function(){if(!!this.cluster){var r=this.clusterOptions||{};this.clusterIndex=P1(this.data,r)}}},{key:"caculClusterExtent",value:function(r){var o=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(o=Ol(ns(this.extent),r)),o[0].concat(o[1])}}]),t}(fs.EventEmitter);function dA(e,i){var t=i.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function L1(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=vA(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function vA(e,i){if(!!e){if(typeof e=="string")return O1(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return O1(e,i)}}function O1(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}var Jg=6378e3;function mA(e,i){var t=e.dataArray,n=i.size,r=n===void 0?10:n,o=r/(2*Math.PI*Jg)*(256<<20)/2,u=gA(t,r),l=u.gridHash,p=u.gridOffset,v=bA(l,p,i);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:v}}function gA(e,i){var t=Infinity,n=-Infinity,r,o=L1(e),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;r=l.coordinates[1],Number.isFinite(r)&&(t=r<t?r:t,n=r>n?r:n)}}catch(he){o.e(he)}finally{o.f()}var p=(t+n)/2,v=yA(i,p);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var E={},w=L1(e),M;try{for(w.s();!(M=w.n()).done;){var k=M.value,D=k.coordinates[1],N=k.coordinates[0];if(Number.isFinite(D)&&Number.isFinite(N)){var V=Math.floor((D+90)/v.yOffset),q=Math.floor((N+180)/v.xOffset),fe="".concat(V,"-").concat(q);E[fe]=E[fe]||{count:0,points:[]},E[fe].count+=1,E[fe].points.push(k)}}}catch(he){w.e(he)}finally{w.f()}return{gridHash:E,gridOffset:v}}function yA(e,i){var t=_A(e),n=xA(i,e);return{yOffset:t,xOffset:n}}function _A(e){return e/Jg*(180/Math.PI)}function xA(e,i){return i/Jg*(180/Math.PI)/Math.cos(e*Math.PI/180)}function bA(e,i,t){return Object.keys(e).reduce(function(n,r,o){var u=r.split("-"),l=parseInt(u[0],10),p=parseInt(u[1],10),v={};if(t.field&&t.method){var E=Qh(e[r].points,t.field);v[t.method]=Nf[t.method](E)}return Object.assign(v,{_id:o,coordinates:Es([-180+i.xOffset*(p+.5),-90+i.yOffset*(l+.5)]),rawData:e[r].points,count:e[r].count}),n.push(v),n},[])}var zv=Math.PI/3,EA=[0,zv,2*zv,3*zv,4*zv,5*zv];function SA(e){return e[0]}function wA(e){return e[1]}function AA(){var e=0,i=0,t=1,n=1,r=SA,o=wA,u,l,p;function v(w){var M={},k=[],D,N=w.length;for(D=0;D<N;++D)if(!(isNaN(q=+r.call(null,V=w[D],D,w))||isNaN(fe=+o.call(null,V,D,w)))){var V,q,fe,he=Math.round(fe=fe/p),Be=Math.round(q=q/l-(he&1)/2),Ge=fe-he;if(Math.abs(Ge)*3>1){var St=q-Be,Ut=Be+(q<Be?-1:1)/2,Yt=he+(fe<he?-1:1),nr=q-Ut,Rr=fe-Yt;St*St+Ge*Ge>nr*nr+Rr*Rr&&(Be=Ut+(he&1?1:-1)/2,he=Yt)}var Tr=Be+"-"+he,on=M[Tr];on?on.push(V):(k.push(on=M[Tr]=[V]),on.x=(Be+(he&1)/2)*l,on.y=he*p)}return k}function E(w){var M=0,k=0;return EA.map(function(D){var N=Math.sin(D)*w,V=-Math.cos(D)*w,q=N-M,fe=V-k;return M=N,k=V,[q,fe]})}return v.hexagon=function(w){return"m"+E(w==null?u:+w).join("l")+"z"},v.centers=function(){for(var w=[],M=Math.round(i/p),k=Math.round(e/l),D=M*p;D<n+u;D+=p,++M)for(var N=k*l+(M&1)*l/2;N<t+l/2;N+=l)w.push([N,D]);return w},v.mesh=function(){var w=E(u).slice(0,4).join("l");return v.centers().map(function(M){return"M"+M+"m"+w}).join("")},v.x=function(w){return arguments.length?(r=w,v):r},v.y=function(w){return arguments.length?(o=w,v):o},v.radius=function(w){return arguments.length?(u=+w,l=u*2*Math.sin(zv),p=u*1.5,v):u},v.size=function(w){return arguments.length?(e=i=0,t=+w[0],n=+w[1],v):[t-e,n-i]},v.extent=function(w){return arguments.length?(e=+w[0][0],i=+w[0][1],t=+w[1][0],n=+w[1][1],v):[[e,i],[t,n]]},v.radius(1)}var CA=6378e3;function TA(e,i){var t=e.dataArray,n=i.size,r=n===void 0?10:n,o=i.method,u=o===void 0?"sum":o,l=r/(2*Math.PI*CA)*(256<<20)/2,p=t.map(function(M){var k=Es(M.coordinates),D=(0,Ti.Z)(k,2),N=D[0],V=D[1];return(0,U.Z)((0,U.Z)({},M),{},{coordinates:[N,V]})}),v=AA().radius(l).x(function(M){return M.coordinates[0]}).y(function(M){return M.coordinates[1]}),E=v(p),w={dataArray:E.map(function(M,k){var D;if(i.field&&u){var N=Qh(M,i.field);M[u]=Nf[u](N)}return D={},(0,J.Z)(D,i.method,M[u]),(0,J.Z)(D,"count",M.length),(0,J.Z)(D,"rawData",M),(0,J.Z)(D,"coordinates",[M.x,M.y]),(0,J.Z)(D,"_id",k),D}),radius:l,xOffset:l,yOffset:l,type:"hexagon"};return w}function MA(e,i){var t=i.sourceField,n=i.targetField,r=i.data,o={};return r.forEach(function(u){o[u[t]]=u}),e.dataArray=e.dataArray.map(function(u){var l=u[n];return(0,U.Z)((0,U.Z)({},u),o[l])}),e}function IA(e,i){var t=i.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}tt("rasterTile",Qw),tt("mvt",$n),tt("geojsonvt",es),tt("testTile",nA),tt("geojson",ar),tt("image",En),tt("csv",dr),tt("json",cr),tt("raster",Sd),tt("rasterRgb",eA),at("cluster",P1),at("filter",dA),at("join",MA),at("map",IA),at("grid",mA),at("hexagon",TA);var ey=pA;function kA(e){var i=PA();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function PA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var F1=function(e){(0,Fr.Z)(t,e);var i=kA(t);function t(n){var r;return(0,Ht.Z)(this,t),r=i.call(this),(0,J.Z)((0,Ke.Z)(r),"added",!1),(0,J.Z)((0,Ke.Z)(r),"eventHandle",function(o){r.polyfillEvent(o),r.emit(o.type,{target:o,data:r.markerOption.extData,lngLat:r.lngLat})}),r.markerOption=(0,U.Z)((0,U.Z)({},r.getDefault()),n),yi(["update","onMove","onMapClick"],(0,Ke.Z)(r)),r.init(),r}return(0,tr.Z)(t,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:Ie.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(r){this.scene=r,this.mapsService=r.get(fr.IMapService),this.sceneSerive=r.get(fr.ISceneService);var o=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var r=this.markerOption.element;return r&&L(r),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(r){return this.lngLat=r,Array.isArray(r)&&(this.lngLat={lng:r[0],lat:r[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(r){var o=this;if(!this.added)return this.once("added",function(){o.setElement(r)}),this;var u=this.markerOption.element;return u&&L(u),this.markerOption.element=r,this.init(),this.mapsService.getMarkerContainer().appendChild(r),this.registerMarkerEvent(r),this.update(),this}},{key:"openPopup",value:function(){var r=this;if(!this.added)return this.once("added",function(){r.openPopup()}),this;var o=this.popup;return o?(o.isOpen()||o.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var r=this;this.added||this.once("added",function(){r.closePopup()});var o=this.popup;return o&&o.remove(),this}},{key:"setPopup",value:function(r){return this.popup=r,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var r=this.popup;if(r)r.isOpen()?r.remove():r.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(r){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(r){this.markerOption.extData=r}},{key:"update",value:function(){if(!!this.mapsService){var r=this.markerOption,o=r.element,u=r.anchor;this.updatePosition(),Ye(o,"".concat(Qs[u]))}}},{key:"onMapClick",value:function(r){var o=this.markerOption.element;this.popup&&o&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var r=this.mapsService.getContainer();return{containerHeight:(r==null?void 0:r.scrollHeight)||0,containerWidth:(r==null?void 0:r.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var r=this.markerOption,o=r.element,u=r.offsets,l=this.lngLat,p=l.lng,v=l.lat,E=this.mapsService.lngLatToContainer([p,v]);if(o){o.style.display="block",o.style.whiteSpace="nowrap";var w=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),M=w.containerHeight,k=w.containerWidth,D=w.bounds;if(!D)return;if(Math.abs(D[0][0])>180||Math.abs(D[1][0])>180){if(E.x>k){var N=this.mapsService.lngLatToContainer([p-360,v]);E.x=N.x}if(E.x<0){var V=this.mapsService.lngLatToContainer([p+360,v]);E.x=V.x}}(E.x>k||E.x<0||E.y>M||E.y<0)&&(o.style.display="none"),o.style.left=E.x+u[0]+"px",o.style.top=E.y-u[1]+"px"}}}},{key:"init",value:function(){var r=this,o=this.markerOption.element,u=this.markerOption,l=u.color,p=u.anchor;if(!o){this.defaultMarker=!0,o=I("div"),this.markerOption.element=o;var v=document.createElementNS("http://www.w3.org/2000/svg","svg");v.setAttributeNS(null,"display","block"),v.setAttributeNS(null,"height","48px"),v.setAttributeNS(null,"width","48px"),v.setAttributeNS(null,"viewBox","0 0 1024 1024");var E=document.createElementNS("http://www.w3.org/2000/svg","path");E.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),E.setAttributeNS(null,"fill",l),v.appendChild(E),o.appendChild(v)}B(o,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(w){var M,k,D=((M=r.markerOption)===null||M===void 0?void 0:M.style)&&((k=r.markerOption)===null||k===void 0?void 0:k.style[w]);o&&(o.style[w]=D)}),o.addEventListener("click",function(w){r.onMapClick(w)}),o.addEventListener("click",this.eventHandle),Sc(o,p,"marker")}},{key:"registerMarkerEvent",value:function(r){r.addEventListener("mousemove",this.eventHandle),r.addEventListener("click",this.eventHandle),r.addEventListener("mousedown",this.eventHandle),r.addEventListener("mouseup",this.eventHandle),r.addEventListener("dblclick",this.eventHandle),r.addEventListener("contextmenu",this.eventHandle),r.addEventListener("mouseover",this.eventHandle),r.addEventListener("mouseout",this.eventHandle),r.addEventListener("touchstart",this.eventHandle),r.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var r=this.getElement();r.removeEventListener("mousemove",this.eventHandle),r.removeEventListener("click",this.eventHandle),r.removeEventListener("mousedown",this.eventHandle),r.removeEventListener("mouseup",this.eventHandle),r.removeEventListener("dblclick",this.eventHandle),r.removeEventListener("contextmenu",this.eventHandle),r.removeEventListener("mouseover",this.eventHandle),r.removeEventListener("mouseout",this.eventHandle),r.removeEventListener("touchstart",this.eventHandle),r.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(r){!this.mapsService||this.mapsService.version!=="GAODE2.x"||!Li()&&Hi&&(r.type==="touchstart"&&(this.touchStartTime=Date.now()),r.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:r,data:this.markerOption.extData,lngLat:this.lngLat}))}},{key:"addDragHandler",value:function(r){return null}},{key:"onUp",value:function(r){throw new Error("Method not implemented.")}}]),t}(fs.EventEmitter);function RA(e){var i=LA();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function LA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xR=function(e){(0,Fr.Z)(t,e);var i=RA(t);function t(n){var r,o;return(0,Ht.Z)(this,t),o=i.call(this),(0,J.Z)((0,Ke.Z)(o),"markers",[]),(0,J.Z)((0,Ke.Z)(o),"points",[]),(0,J.Z)((0,Ke.Z)(o),"clusterMarkers",[]),o.markerLayerOption=(0,f.merge)(o.getDefault(),n),yi(["update"],(0,Ke.Z)(o)),o.zoom=((r=o.markerLayerOption.clusterOption)===null||r===void 0?void 0:r.zoom)||-99,o}return(0,tr.Z)(t,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(r){return this.scene=r,this.mapsService=r.get(fr.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var r=this.mapsService.getContainer();this.containerSize={containerWidth:(r==null?void 0:r.scrollWidth)||0,containerHeight:(r==null?void 0:r.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(r){var o=this.markerLayerOption.cluster;if(r.getMarkerLayerContainerSize=this.getContainerSize.bind(this),o&&(this.addPoint(r,this.markers.length),this.mapsService)){var u=this.mapsService.getZoom(),l=this.mapsService.getBounds();this.bbox=Ol(l,.5),this.zoom=Math.floor(u),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(r)}},{key:"removeMarker",value:function(r){this.markers.indexOf(r);var o=this.markers.indexOf(r);o>-1&&this.markers.splice(o,1)}},{key:"hide",value:function(){this.markers.map(function(r){r.getElement().style.opacity="0"}),this.clusterMarkers.map(function(r){r.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(r){r.getElement().style.opacity="1"}),this.clusterMarkers.map(function(r){r.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var r=this.markerLayerOption.cluster;return r?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var r=this;this.getMarkers().forEach(function(o){o.addTo(r.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(r){r.remove()}),this.clusterMarkers.forEach(function(r){r.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(r,o){var u=r.getLnglat(),l=u.lng,p=u.lat,v={geometry:{type:"Point",coordinates:[l,p]},properties:(0,U.Z)((0,U.Z)({},r.getExtData()),{},{marker_id:o})};this.points.push(v),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var r=this.markerLayerOption.clusterOption,o=r.radius,u=r.minZoom,l=u===void 0?0:u,p=r.maxZoom;this.clusterIndex=new(k1())({radius:o,minZoom:l,maxZoom:p}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(r,o){var u=this,l=r[0].concat(r[1]),p=this.clusterIndex.getClusters(l,o);this.clusterMarkers.forEach(function(v){v.remove()}),this.clusterMarkers=[],p.forEach(function(v){var E,w=u.markerLayerOption.clusterOption,M=w.field,k=w.method;if((E=v.properties)!==null&&E!==void 0&&E.cluster_id){var D,N=u.getLeaves((D=v.properties)===null||D===void 0?void 0:D.cluster_id);if(v.properties.clusterData=N,M&&k){var V=N==null?void 0:N.map(function(Ge){var St=(0,J.Z)({},M,Ge.properties[M]);return St}),q=Qh(V,M),fe=rh(k,q),he="point_"+k;v.properties[he]=fe.toFixed(2)}}var Be=u.clusterMarker(v);u.clusterMarkers.push(Be),Be.addTo(u.scene)})}},{key:"getLeaves",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return r?this.clusterIndex.getLeaves(r,o,u):null}},{key:"clusterMarker",value:function(r){var o=this.markerLayerOption.clusterOption,u=o,l=u.element,p=l===void 0?this.generateElement.bind(this):l,v=new F1({element:p(r)}).setLnglat({lng:r.geometry.coordinates[0],lat:r.geometry.coordinates[1]});return v}},{key:"normalMarker",value:function(r){var o=r.properties.marker_id;return this.markers[o]}},{key:"update",value:function(){if(!!this.mapsService&&this.markers.length!==0){var r=this.mapsService.getZoom(),o=this.mapsService.getBounds();(!this.bbox||Math.abs(r-this.zoom)>=1||!ml(this.bbox,o))&&(this.bbox=Ol(o,.5),this.zoom=Math.floor(r),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(r){var o=I("div","l7-marker-cluster"),u=I("div","",o),l=I("span","",u),p=this.markerLayerOption.clusterOption,v=p.field,E=p.method;r.properties.point_count=r.properties.point_count||1;var w=v&&E?r.properties["point_"+E]||r.properties[v]:r.properties.point_count;return l.textContent=w,o}}]),t}(fs.EventEmitter),bR=ie(4157);function OA(e){var i=FA();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function FA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zv=function(e){(0,Fr.Z)(t,e);var i=OA(t);function t(n){var r;return(0,Ht.Z)(this,t),r=i.call(this),t.controlCount++,r.controlOption=(0,U.Z)((0,U.Z)({},r.getDefault(n)),n||{}),r}return(0,tr.Z)(t,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(r){var o=this.getDefault(r);Object.entries(r).forEach(function(u){var l=(0,Ti.Z)(u,2),p=l[0],v=l[1];v===void 0&&(r[p]=o[p])}),"position"in r&&this.setPosition(r.position),"className"in r&&this.setClassName(r.className),"style"in r&&this.setStyle(r.style),this.controlOption=(0,U.Z)((0,U.Z)({},this.controlOption),r)}},{key:"addTo",value:function(r){this.mapsService=r.get(fr.IMapService),this.renderService=r.get(fr.IRendererService),this.layerService=r.get(fr.ILayerService),this.controlService=r.get(fr.IControlService),this.configService=r.get(fr.IGlobalConfigService),this.scene=r.get(fr.ISceneService),this.sceneContainer=r,this.isShow=!0,this.container=this.onAdd(),B(this.container,"l7-control");var o=this.controlOption,u=o.className,l=o.style;return u&&this.setClassName(u),l&&this.setStyle(l),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;L(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return I("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var r=this.container;Y(r,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var r=this.container;B(r,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(r){return{position:fc.TOPRIGHT,name:"".concat(t.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(r){if(this.mapsService&&r&&r.screenX>0&&r.screenY>0){var o=this.mapsService.getContainer();o!==null&&o.focus()}}},{key:"setPosition",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:fc.TOPLEFT,o=this.controlService;return o&&o.removeControl(this),this.controlOption.position=r,o&&o.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(r){var o=this.container,u=this.controlOption.className;u&&Y(o,u),r&&B(o,r)}},{key:"setStyle",value:function(r){var o=this.container;r?o.setAttribute("style",r):o.removeAttribute("style")}},{key:"insertContainer",value:function(){var r=this.controlOption.position,o=this.container;if(r instanceof Element)r.appendChild(o);else{var u=this.controlService.controlCorners[r];r.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o)}}},{key:"checkUpdateOption",value:function(r,o){return o.some(function(u){return u in r})}}]),t}(Ph());(0,J.Z)(Zv,"controlCount",0);function DA(e){var i=BA();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function BA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Om=function(e){(0,Fr.Z)(t,e);var i=DA(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"isDisable",!1),n}return(0,tr.Z)(t,[{key:"setIsDisable",value:function(r){if(this.isDisable=r,r){var o;(o=this.button)===null||o===void 0||o.setAttribute("disabled","true")}else{var u;(u=this.button)===null||u===void 0||u.removeAttribute("disabled")}}},{key:"createButton",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return I("button","l7-button-control ".concat(r))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var r=this.controlOption,o=r.title,u=r.btnText,l=r.btnIcon;return this.setBtnTitle(o),this.setBtnText(u),this.setBtnIcon(l),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(r){var o=r.title,u=r.btnText,l=r.btnIcon;this.checkUpdateOption(r,["title"])&&this.setBtnTitle(o),this.checkUpdateOption(r,["btnIcon"])&&this.setBtnIcon(l),this.checkUpdateOption(r,["btnText"])&&this.setBtnText(u),Fo((0,it.Z)(t.prototype),"setOptions",this).call(this,r)}},{key:"setBtnTitle",value:function(r){var o;(o=this.button)===null||o===void 0||o.setAttribute("title",r!=null?r:"")}},{key:"setBtnIcon",value:function(r){if(this.buttonIcon&&L(this.buttonIcon),r){var o,u=(o=this.button)===null||o===void 0?void 0:o.firstChild;if(u){var l;(l=this.button)===null||l===void 0||l.insertBefore(r,u)}else{var p;(p=this.button)===null||p===void 0||p.appendChild(r)}this.buttonIcon=r}}},{key:"setBtnText",value:function(r){if(!!this.button)if(Y(this.button,"l7-button-control--row"),Y(this.button,"l7-button-control--column"),r){var o=this.buttonText;if(!o){var u;o=I("div","l7-button-control__text"),(u=this.button)===null||u===void 0||u.appendChild(o),this.buttonText=o}o.innerText=r,B(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!r&&this.buttonText&&(L(this.buttonText),this.buttonText=void 0)}}]),t}(Zv);function NA(e){var i=zA();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function zA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D1=function(e){(0,Fr.Z)(t,e);var i=NA(t);function t(n,r){var o;return(0,Ht.Z)(this,t),o=i.call(this),(0,J.Z)((0,Ke.Z)(o),"isShow",!1),(0,J.Z)((0,Ke.Z)(o),"timeout",null),(0,J.Z)((0,Ke.Z)(o),"show",function(){return o.isShow||!o.contentDOM.innerHTML||(o.resetPopperPosition(),Y(o.popperDOM,"l7-popper-hide"),o.isShow=!0,o.option.unique&&t.conflictPopperList.forEach(function(u){u!==(0,Ke.Z)(o)&&u.isShow&&u.hide()}),o.emit("show")),(0,Ke.Z)(o)}),(0,J.Z)((0,Ke.Z)(o),"hide",function(){return o.isShow&&(B(o.popperDOM,"l7-popper-hide"),o.isShow=!1,o.emit("hide")),(0,Ke.Z)(o)}),(0,J.Z)((0,Ke.Z)(o),"setHideTimeout",function(){o.timeout||(o.timeout=window.setTimeout(function(){!o.isShow||(o.hide(),o.timeout=null)},300))}),(0,J.Z)((0,Ke.Z)(o),"clearHideTimeout",function(){o.timeout&&(window.clearTimeout(o.timeout),o.timeout=null)}),(0,J.Z)((0,Ke.Z)(o),"onBtnClick",function(){o.isShow?o.hide():o.show()}),(0,J.Z)((0,Ke.Z)(o),"onBtnMouseLeave",function(){o.setHideTimeout()}),(0,J.Z)((0,Ke.Z)(o),"onBtnMouseMove",function(){o.clearHideTimeout(),!o.isShow&&o.show()}),o.button=n,o.option=r,o.init(),r.unique&&t.conflictPopperList.push((0,Ke.Z)(o)),o}return(0,tr.Z)(t,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(r){typeof r=="string"?this.contentDOM.innerHTML=r:r instanceof HTMLElement&&(ln(this.contentDOM),this.contentDOM.appendChild(r)),this.content=r}},{key:"init",value:function(){var r=this.option.trigger;this.popperDOM=this.createPopper(),r==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),L(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var r={},o=this.option,u=o.container,l=o.offset,p=l===void 0?[0,0]:l,v=o.placement,E=(0,Ti.Z)(p,2),w=E[0],M=E[1],k=this.button.getBoundingClientRect(),D=u.getBoundingClientRect(),N=Xr(k,D),V=N.left,q=N.right,fe=N.top,he=N.bottom,Be=!1,Ge=!1;/^(left|right)/.test(v)?(v.includes("left")?r.right="".concat(k.width+q,"px"):v.includes("right")&&(r.left="".concat(k.width+V,"px")),v.includes("start")?r.top="".concat(fe,"px"):v.includes("end")?r.bottom="".concat(he,"px"):(r.top="".concat(fe+k.height/2,"px"),Ge=!0,r.transform="translate(".concat(w,"px, calc(").concat(M,"px - 50%))"))):/^(top|bottom)/.test(v)&&(v.includes("top")?r.bottom="".concat(k.height+he,"px"):v.includes("bottom")&&(r.top="".concat(k.height+fe,"px")),v.includes("start")?r.left="".concat(V,"px"):v.includes("end")?r.right="".concat(q,"px"):(r.left="".concat(V+k.width/2,"px"),Be=!0,r.transform="translate(calc(".concat(w,"px - 50%), ").concat(M,"px)"))),r.transform="translate(calc(".concat(w,"px - ").concat(Be?"50%":"0%","), calc(").concat(M,"px - ").concat(Ge?"50%":"0%",")");var St=v.split("-");St.length&&B(this.popperDOM,St.map(function(Ut){return"l7-popper-".concat(Ut)}).join(" ")),$t(this.popperDOM,wr(r))}},{key:"createPopper",value:function(){var r=this.option,o=r.container,u=r.className,l=u===void 0?"":u,p=r.content,v=I("div","l7-popper l7-popper-hide ".concat(l)),E=I("div","l7-popper-content"),w=I("div","l7-popper-arrow");return v.appendChild(E),v.appendChild(w),o.appendChild(v),this.popperDOM=v,this.contentDOM=E,p&&this.setContent(p),v}}]),t}(fs.EventEmitter);(0,J.Z)(D1,"conflictPopperList",[]);function ZA(e){var i=UA();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function UA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VA={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},GA=function(e){(0,Fr.Z)(t,e);var i=ZA(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),Fo((0,it.Z)(t.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(r){var o,u=Fo((0,it.Z)(t.prototype),"getDefault",this).call(this,r),l=(o=r==null?void 0:r.position)!==null&&o!==void 0?o:u.position;return(0,U.Z)((0,U.Z)({},Fo((0,it.Z)(t.prototype),"getDefault",this).call(this,r)),{},{popperPlacement:l instanceof Element?"bottom":VA[l],popperTrigger:"click"})}},{key:"onAdd",value:function(){var r=Fo((0,it.Z)(t.prototype),"onAdd",this).call(this);return this.initPopper(),r}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var r=this,o=this.controlOption,u=o.popperClassName,l=o.popperPlacement,p=o.popperTrigger,v=this.mapsService.getMapContainer();return this.popper=new D1(this.button,{className:u,placement:l,trigger:p,container:v,unique:!0}),this.popper.on("show",function(){r.emit("popperShow",r)}).on("hide",function(){r.emit("popperHide",r)}),this.popper}},{key:"setOptions",value:function(r){if(Fo((0,it.Z)(t.prototype),"setOptions",this).call(this,r),this.checkUpdateOption(r,["popperPlacement","popperTrigger","popperClassName"])){var o=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(o)}}}]),t}(Om);function jA(e){var i=HA();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function HA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ud;(function(e){e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index"})(ud||(ud={}));var B1=function(e){(0,Fr.Z)(t,e);var i=jA(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"selectValue",[]),(0,J.Z)((0,Ke.Z)(n),"createNormalOption",function(l){var p=n.selectValue.includes(l.value),v=I("div","l7-select-control-item ".concat(p?ud.ActiveOptionClassName:""));n.getIsMultiple()&&v.appendChild(n.createCheckbox(p)),l.icon&&v.appendChild(l.icon);var E=I("span");return E.innerText=l.text,v.appendChild(E),v}),(0,J.Z)((0,Ke.Z)(n),"onItemClick",function(l){if(n.getIsMultiple()){var p=n.selectValue.findIndex(function(v){return v===l.value});p>-1?n.selectValue.splice(p,1):n.selectValue=[].concat((0,H.Z)(n.selectValue),[l.value])}else n.selectValue=[l.value];n.setSelectValue(n.selectValue)}),n}return(0,tr.Z)(t,[{key:"setOptions",value:function(r){Fo((0,it.Z)(t.prototype),"setOptions",this).call(this,r);var o=r.options;o&&this.popper.setContent(this.getPopperContent(o))}},{key:"onAdd",value:function(){var r=Fo((0,it.Z)(t.prototype),"onAdd",this).call(this),o=this.controlOption.defaultValue;return o&&(this.selectValue=this.transSelectValue(o)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),r}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(r){var o=this,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,l=this.transSelectValue(r);this.optionDOMList.forEach(function(p){var v=p.getAttribute(ud.OptionValueAttrKey),E=o.getIsMultiple()?p.querySelector("input[type=checkbox]"):void 0;l.includes(v)?(B(p,ud.ActiveOptionClassName),E&&yn(E,!0)):(Y(p,ud.ActiveOptionClassName),E&&yn(E,!1))}),this.selectValue=l,u&&this.emit("selectChange",this.getIsMultiple()?l:l[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(r){var o=this,u=this.isImageOptions(),l=I("div",u?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&B(l,"l7-select-control--multiple");var p=r.map(function(v,E){var w=u?o.createImageOption(v):o.createNormalOption(v);return w.setAttribute(ud.OptionValueAttrKey,v.value),w.setAttribute(ud.OptionIndexAttrKey,window.String(E)),w.addEventListener("click",o.onItemClick.bind(o,v)),w});return l.append.apply(l,(0,H.Z)(p)),this.optionDOMList=p,l}},{key:"createImageOption",value:function(r){var o=this.selectValue.includes(r.value),u=I("div","l7-select-control-item ".concat(o?ud.ActiveOptionClassName:"")),l=I("img");l.setAttribute("src",r.img),Bn(l),u.appendChild(l);var p=I("div","l7-select-control-item-row");this.getIsMultiple()&&u.appendChild(this.createCheckbox(o));var v=I("span");return v.innerText=r.text,p.appendChild(v),u.appendChild(p),u}},{key:"createCheckbox",value:function(r){var o=I("input");return o.setAttribute("type","checkbox"),r&&yn(o,!0),o}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(r){return r.img})}},{key:"transSelectValue",value:function(r){return Array.isArray(r)?r:[r]}}]),t}(GA),ld=function(i){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(i)),t.appendChild(n),t};function WA(e){var i=XA();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function XA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $A=function(e){(0,Fr.Z)(t,e);var i=WA(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"onClick",(0,ot.Z)(se().mark(function l(){var p;return se().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(p=n.controlOption.onExport,p!=null){E.next=5;break}E.next=10;break;case 5:return E.t0=p,E.next=8,n.getImage();case 8:E.t1=E.sent,(0,E.t0)(E.t1);case 10:case"end":return E.stop()}},l)}))),(0,J.Z)((0,Ke.Z)(n),"mergeImage",(0,ot.Z)(se().mark(function l(){var p,v,E,w,M,k,D,N,V,q,fe,he,Be,Ge,St=arguments;return se().wrap(function(Yt){for(;;)switch(Yt.prev=Yt.next){case 0:for(E=n.controlOption.imageType,w=(p=(v=n.mapsService.getContainer())===null||v===void 0?void 0:v.getBoundingClientRect())!==null&&p!==void 0?p:{},M=w.width,k=M===void 0?0:M,D=w.height,N=D===void 0?0:D,V=document.createElement("canvas"),V.width=k,V.height=N,q=V.getContext("2d"),fe=St.length,he=new Array(fe),Be=0;Be<fe;Be++)he[Be]=St[Be];return Yt.next=9,Promise.all(he.map(function(nr){return new Promise(function(Rr){var Tr=new Image;Tr.onload=function(){Rr(Tr)},Tr.src=nr})}));case 9:return Ge=Yt.sent,Ge.forEach(function(nr){q==null||q.drawImage(nr,0,0,k,N)}),Yt.abrupt("return",V.toDataURL("image/".concat(E)));case 12:case"end":return Yt.stop()}},l)}))),n}return(0,tr.Z)(t,[{key:"onAdd",value:function(){var r=Fo((0,it.Z)(t.prototype),"onAdd",this).call(this);return r.addEventListener("click",this.onClick),r}},{key:"getDefault",value:function(r){return(0,U.Z)((0,U.Z)({},Fo((0,it.Z)(t.prototype),"getDefault",this).call(this,r)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:ld("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l;return se().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.mapsService.exportMap("png");case 2:return u=v.sent,v.next=5,this.scene.exportPng("png");case 5:return l=v.sent,v.abrupt("return",this.mergeImage(u,l));case 7:case"end":return v.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()}]),t}(Om);function N1(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=YA(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function YA(e,i){if(!!e){if(typeof e=="string")return z1(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return z1(e,i)}}function z1(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}var Z1=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],cd=function(){if(typeof document=="undefined")return!1;var e=Z1[0],i={},t=N1(Z1),n;try{for(t.s();!(n=t.n()).done;){var r=n.value,o=r==null?void 0:r[1];if(o in document){var u=N1(r.entries()),l;try{for(u.s();!(l=u.n()).done;){var p=(0,Ti.Z)(l.value,2),v=p[0],E=p[1];i[e[v]]=E}}catch(w){u.e(w)}finally{u.f()}return i}}}catch(w){t.e(w)}finally{t.f()}return!1}(),U1={change:cd.fullscreenchange,error:cd.fullscreenerror},yh={request:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,r){var o=function l(){yh.off("change",l),n()};yh.on("change",o);var u=i[cd.requestFullscreen](t);u instanceof Promise&&u.then(o).catch(r)})},exit:function(){return new Promise(function(i,t){if(!yh.isFullscreen){i();return}var n=function o(){yh.off("change",o),i()};yh.on("change",n);var r=document[cd.exitFullscreen]();r instanceof Promise&&r.then(n).catch(t)})},toggle:function(i,t){return yh.isFullscreen?yh.exit():yh.request(i,t)},onchange:function(i){yh.on("change",i)},onerror:function(i){yh.on("error",i)},on:function(i,t){var n=U1[i];n&&document.addEventListener(n,t,!1)},off:function(i,t){var n=U1[i];n&&document.removeEventListener(n,t,!1)},raw:cd};Object.defineProperties(yh,{isFullscreen:{get:function(){return Boolean(document[cd.fullscreenElement])}},element:{enumerable:!0,get:function(){var i;return(i=document[cd.fullscreenElement])!==null&&i!==void 0?i:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[cd.fullscreenEnabled])}}}),cd||(yh={isEnabled:!1});var ty=yh;function qA(e){var i=KA();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function KA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QA=function(e){(0,Fr.Z)(t,e);var i=qA(t);function t(n){var r;return(0,Ht.Z)(this,t),r=i.call(this,n),(0,J.Z)((0,Ke.Z)(r),"isFullscreen",!1),(0,J.Z)((0,Ke.Z)(r),"toggleFullscreen",(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!ty.isEnabled){l.next=3;break}return l.next=3,ty.toggle(r.mapContainer);case 3:case"end":return l.stop()}},o)}))),(0,J.Z)((0,Ke.Z)(r),"onClick",function(){r.toggleFullscreen()}),(0,J.Z)((0,Ke.Z)(r),"onFullscreenChange",function(){r.isFullscreen=!!document.fullscreenElement;var o=r.controlOption,u=o.btnText,l=o.btnIcon,p=o.title,v=o.exitBtnText,E=o.exitBtnIcon,w=o.exitTitle;r.isFullscreen?(r.setBtnTitle(w),r.setBtnText(v),r.setBtnIcon(E)):(r.setBtnTitle(p),r.setBtnText(u),r.setBtnIcon(l)),r.emit("fullscreenChange",r.isFullscreen)}),ty.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),r}return(0,tr.Z)(t,[{key:"setOptions",value:function(r){var o=r.exitBtnText,u=r.exitBtnIcon,l=r.exitTitle;this.isFullscreen&&(this.checkUpdateOption(r,["exitBtnIcon"])&&this.setBtnIcon(u),this.checkUpdateOption(r,["exitBtnText"])&&this.setBtnText(o),this.checkUpdateOption(r,["exitTitle"])&&this.setBtnTitle(l)),Fo((0,it.Z)(t.prototype),"setOptions",this).call(this,r)}},{key:"onAdd",value:function(){var r=Fo((0,it.Z)(t.prototype),"onAdd",this).call(this);return r.addEventListener("click",this.onClick),this.mapContainer=d(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),r}},{key:"onRemove",value:function(){Fo((0,it.Z)(t.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(r){return(0,U.Z)((0,U.Z)({},Fo((0,it.Z)(t.prototype),"getDefault",this).call(this,r)),{},{title:"\u5168\u5C4F",btnIcon:ld("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:ld("l7-icon-exit-fullscreen")})}}]),t}(Om);function JA(e){var i=eC();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function eC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tC=function(e){(0,Fr.Z)(t,e);var i=JA(t);function t(n){var r;return(0,Ht.Z)(this,t),r=i.call(this,n),(0,J.Z)((0,Ke.Z)(r),"getGeoLocation",function(){return new Promise(function(o,u){window.navigator.geolocation.getCurrentPosition(function(l){var p=l.coords,v=p!=null?p:{},E=v.longitude,w=v.latitude;!(0,f.isNaN)(E)&&!(0,f.isNaN)(w)?o([E,w]):u()},function(l){u(l)})})}),(0,J.Z)((0,Ke.Z)(r),"onClick",(0,ot.Z)(se().mark(function o(){var u,l,p;return se().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(window.navigator.geolocation){E.next=2;break}return E.abrupt("return");case 2:return u=r.controlOption.transform,E.next=5,r.getGeoLocation();case 5:if(l=E.sent,p=r.mapsService.getZoom(),E.t0=r.mapsService,E.t1=p>15?p:15,!u){E.next=15;break}return E.next=12,u(l);case 12:E.t2=E.sent,E.next=16;break;case 15:E.t2=l;case 16:E.t3=E.t2,E.t0.setZoomAndCenter.call(E.t0,E.t1,E.t3);case 18:case"end":return E.stop()}},o)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),r}return(0,tr.Z)(t,[{key:"getDefault",value:function(r){return(0,U.Z)((0,U.Z)({},Fo((0,it.Z)(t.prototype),"getDefault",this).call(this,r)),{},{title:"\u5B9A\u4F4D",btnIcon:ld("l7-icon-reposition")})}},{key:"onAdd",value:function(){var r=Fo((0,it.Z)(t.prototype),"onAdd",this).call(this);return r.addEventListener("click",this.onClick),r}}]),t}(Om);function rC(e){var i=nC();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function nC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V1=function(e){(0,Fr.Z)(t,e);var i=rC(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"onLayerChange",function(){var l;(l=n.controlOption.layers)!==null&&l!==void 0&&l.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),(0,J.Z)((0,Ke.Z)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),(0,J.Z)((0,Ke.Z)(n),"onSelectChange",function(){n.layers.forEach(function(l){var p=n.selectValue.includes(l.name),v=l.isVisible();p&&!v&&l.show(),!p&&v&&l.hide()})}),n}return(0,tr.Z)(t,[{key:"layers",get:function(){var r=this.layerService,o=this.controlOption.layers;if(Array.isArray(o)&&o.length){var u=[];return o.forEach(function(l){if(l instanceof Object&&u.push(l),typeof l=="string"){var p=r.getLayer(l)||r.getLayerByName(l);p&&u.push(p)}}),u}return r.getLayers()||[]}},{key:"getDefault",value:function(r){return(0,U.Z)((0,U.Z)({},Fo((0,it.Z)(t.prototype),"getDefault",this).call(this,r)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:ld("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(r){return r.isVisible()}).map(function(r){return r.name})}},{key:"getLayerOptions",value:function(){return this.layers.map(function(r){return{text:r.name,value:r.name}})}},{key:"setOptions",value:function(r){var o=this.checkUpdateOption(r,["layers"]);Fo((0,it.Z)(t.prototype),"setOptions",this).call(this,r),o&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var r;return(r=this.controlOption.options)!==null&&r!==void 0&&r.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),Fo((0,it.Z)(t.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),t}(B1);function iC(e){var i=aC();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function aC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var G1=function(e){(0,Fr.Z)(t,e);var i=iC(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getDefault",value:function(){return{position:fc.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var r=I("div","l7-control-logo");return this.setLogoContent(r),r}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(r){Fo((0,it.Z)(t.prototype),"setOptions",this).call(this,r),this.checkUpdateOption(r,["img","href"])&&(ln(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(r){var o=this.controlOption,u=o.href,l=o.img,p=I("img");if(p.setAttribute("src",l),p.setAttribute("aria-label","AntV logo"),Bn(p),u){var v=I("a","l7-control-logo-link");v.target="_blank",v.href=u,v.rel="noopener nofollow",v.setAttribute("rel","noopener nofollow"),v.appendChild(p),r.appendChild(v)}else r.appendChild(p)}}]),t}(Zv),oC={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},sC={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function uC(e){var i=lC();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function lC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cC=function(e){(0,Fr.Z)(t,e);var i=uC(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return(0,tr.Z)(t,[{key:"getDefault",value:function(r){return(0,U.Z)((0,U.Z)({},Fo((0,it.Z)(t.prototype),"getDefault",this).call(this,r)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:ld("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var r=this.mapsService.getType()==="mapbox"?sC:oC;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(o){var u=(0,Ti.Z)(o,2),l=u[0],p=u[1];return typeof p=="string"&&l!=="blank"}).map(function(o){var u,l=(0,Ti.Z)(o,2),p=l[0],v=l[1],E=(u=r[p])!==null&&u!==void 0?u:{},w=E.text,M=E.img;return{text:w!=null?w:p,value:v,img:M,key:p}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var r,o=this;if((r=this.controlOption.options)!==null&&r!==void 0&&r.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var u,l,p=this.controlOption.defaultValue;this.controlOption.defaultValue=(u=(l=this.controlOption.options.find(function(E){return E.key===p}))===null||l===void 0?void 0:l.value)!==null&&u!==void 0?u:p}else{var v=this.getMapStyle();v?this.controlOption.defaultValue=v:this.mapsService.map.once("styledata",function(){var E=o.mapsService.getMapStyle();o.controlOption.defaultValue=E,o.setSelectValue(E,!1)})}return this.on("selectChange",this.onMapThemeChange),Fo((0,it.Z)(t.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),t}(B1);function fC(e){var i=hC();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function hC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pC=function(e){(0,Fr.Z)(t,e);var i=fC(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"location",[0,0]),(0,J.Z)((0,Ke.Z)(n),"onMouseMove",function(l){var p=n.location,v=l.lngLat||l.lnglat,E=n.controlOption.transform;v&&(p=[v.lng,v.lat]),n.location=p,E&&(p=E(p)),n.insertLocation2HTML(p),n.emit("locationChange",p)}),n}return(0,tr.Z)(t,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(r){return(0,U.Z)((0,U.Z)({},Fo((0,it.Z)(t.prototype),"getDefault",this).call(this,r)),{},{position:fc.BOTTOMLEFT,transform:function(u){var l=(0,Ti.Z)(u,2),p=l[0],v=l[1];return[+(+p).toFixed(6),+(+v).toFixed(6)]}})}},{key:"onAdd",value:function(){var r=I("div","l7-control-mouse-location");return r.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),r}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(r){this.container.innerText=r.join(", ")}}]),t}(Zv);function dC(e){var i=vC();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function vC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mC=function(e){(0,Fr.Z)(t,e);var i=dC(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"update",function(){var l=n.mapsService,p=n.controlOption.maxWidth,v=l.getSize()[1]/2,E=l.containerToLngLat([0,v]),w=l.containerToLngLat([p,v]),M=Ff([E.lng,E.lat],[w.lng,w.lat]);n.updateScales(M)}),n}return(0,tr.Z)(t,[{key:"getDefault",value:function(r){return(0,U.Z)((0,U.Z)({},Fo((0,it.Z)(t.prototype),"getDefault",this).call(this,r)),{},{name:"scale",position:fc.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var r="l7-control-scale",o=I("div",r);this.resetScaleLines(o);var u=this.controlOption.updateWhenIdle;return this.mapsService.on(u?"moveend":"mapmove",this.update),this.mapsService.on(u?"zoomend":"zoomchange",this.update),o}},{key:"onRemove",value:function(){var r=this.controlOption.updateWhenIdle;this.mapsService.off(r?"zoomend":"zoomchange",this.update),this.mapsService.off(r?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(r){Fo((0,it.Z)(t.prototype),"setOptions",this).call(this,r),this.checkUpdateOption(r,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(r){var o=this.controlOption,u=o.metric,l=o.imperial;u&&r&&this.updateMetric(r),l&&r&&this.updateImperial(r)}},{key:"resetScaleLines",value:function(r){ln(r);var o=this.controlOption,u=o.metric,l=o.imperial,p=o.maxWidth,v=o.lockWidth;v&&$t(r,"width: ".concat(p,"px")),u&&(this.mScale=I("div","l7-control-scale-line",r)),l&&(this.iScale=I("div","l7-control-scale-line",r)),this.update()}},{key:"updateScale",value:function(r,o,u){var l=this.controlOption.maxWidth;r.style.width=Math.round(l*u)+"px",r.innerHTML=o}},{key:"getRoundNum",value:function(r){var o=Math.pow(10,(Math.floor(r)+"").length-1),u=r/o;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:1,o*u}},{key:"updateMetric",value:function(r){var o=this.getRoundNum(r),u=o<1e3?o+" m":o/1e3+" km";this.updateScale(this.mScale,u,o/r)}},{key:"updateImperial",value:function(r){var o=r*3.2808399,u,l,p;o>5280?(u=o/5280,l=this.getRoundNum(u),this.updateScale(this.iScale,l+" mi",l/u)):(p=this.getRoundNum(o),this.updateScale(this.iScale,p+" ft",p/o))}}]),t}(Zv);function gC(e){var i=yC();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function yC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _C=function(e){(0,Fr.Z)(t,e);var i=gC(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),(0,J.Z)((0,Ke.Z)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),(0,J.Z)((0,Ke.Z)(n),"updateDisabled",function(){var l=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||l.getZoom()<=l.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),(n.disabled||l.getZoom()>=l.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return(0,tr.Z)(t,[{key:"getDefault",value:function(r){return(0,U.Z)((0,U.Z)({},Fo((0,it.Z)(t.prototype),"getDefault",this).call(this,r)),{},{position:fc.BOTTOMRIGHT,name:"zoom",zoomInText:ld("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:ld("l7-icon-narrow"),zoomOutTitle:"Zoom out"})}},{key:"setOptions",value:function(r){Fo((0,it.Z)(t.prototype),"setOptions",this).call(this,r),this.checkUpdateOption(r,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var r=I("div","l7-control-zoom");return this.resetButtonGroup(r),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),r}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(r){ln(r),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",r,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",r,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(r,o,u,l,p){var v=I("button",u,l);return typeof r=="string"?v.innerHTML=r:v.append(r),v.title=o,v.addEventListener("click",p),v}}]),t}(Zv);function xC(e){var i=bC();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function bC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ry=function(e){(0,Fr.Z)(t,e);var i=xC(t);function t(n){var r;(0,Ht.Z)(this,t),r=i.call(this),(0,J.Z)((0,Ke.Z)(r),"isShow",!0),(0,J.Z)((0,Ke.Z)(r),"onMouseMove",function(u){var l,p=r.mapsService.getMapContainer(),v=(l=p==null?void 0:p.getBoundingClientRect())!==null&&l!==void 0?l:{},E=v.left,w=E===void 0?0:E,M=v.top,k=M===void 0?0:M;r.setPopupPosition(u.clientX-w,u.clientY-k)}),(0,J.Z)((0,Ke.Z)(r),"updateLngLatPosition",function(){if(!(!r.mapsService||r.popupOption.followCursor)){var u=r.lngLat,l=u.lng,p=u.lat,v=r.mapsService.lngLatToContainer([l,p]),E=v.x,w=v.y;r.setPopupPosition(E,w)}}),(0,J.Z)((0,Ke.Z)(r),"onKeyDown",function(u){u.keyCode===27&&r.remove()}),(0,J.Z)((0,Ke.Z)(r),"onCloseButtonClick",function(u){u.stopPropagation&&u.stopPropagation(),r.hide()}),(0,J.Z)((0,Ke.Z)(r),"update",function(){var u=!!r.lngLat,l=r.popupOption,p=l.className,v=l.style,E=l.maxWidth,w=l.anchor,M=l.stopPropagation;if(!(!r.mapsService||!u||!r.content)){var k=r.mapsService.getMarkerContainer();if(!r.container&&k&&(r.container=I("div","l7-popup ".concat(p!=null?p:""," ").concat(r.isShow?"":"l7-popup-hide"),k),v&&r.container.setAttribute("style",v),r.tip=I("div","l7-popup-tip",r.container),r.container.appendChild(r.content),M&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(V){r.container.addEventListener(V,function(q){q.stopPropagation()})}),r.container.style.whiteSpace="nowrap"),r.updateLngLatPosition(),Ye(r.container,"".concat(Qs[w])),Sc(r.container,w,"popup"),E){var D=r.container.getBoundingClientRect(),N=D.width;N>parseFloat(E)&&(r.container.style.width=E)}else r.container.style.removeProperty("width")}}),r.popupOption=(0,U.Z)((0,U.Z)({},r.getDefault(n!=null?n:{})),n);var o=r.popupOption.lngLat;return o&&(r.lngLat=o),r}return(0,tr.Z)(t,[{key:"lngLat",get:function(){var r;return(r=this.popupOption.lngLat)!==null&&r!==void 0?r:{lng:0,lat:0}},set:function(r){this.popupOption.lngLat=r}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(r){this.mapsService=r.get(fr.IMapService),this.sceneService=r.get(fr.ISceneService),this.layerService=r.get(fr.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=r,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var o=this.popupOption,u=o.html,l=o.text,p=o.title;return u?this.setHTML(u):l&&this.setText(l),p&&this.setTitle(p),this.emit("open"),this}},{key:"remove",value:function(){if(!!(this!==null&&this!==void 0&&this.isOpen()))return this.content&&L(this.content),this.container&&(L(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(r){return this.show(),this.popupOption=(0,U.Z)((0,U.Z)({},this.popupOption),r),this.checkUpdateOption(r,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(L(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(r,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(r,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(r,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(r,["html"])&&r.html?this.setHTML(r.html):this.checkUpdateOption(r,["text"])&&r.text&&this.setText(r.text),this.checkUpdateOption(r,["lngLat"])&&r.lngLat&&this.setLnglat(r.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&Y(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(!!this.isShow)return this.container&&B(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(r){return this.popupOption.html=r,this.setDOMContent(r)}},{key:"setText",value:function(r){return this.popupOption.text=r,this.setDOMContent(window.document.createTextNode(r))}},{key:"setTitle",value:function(r){this.show(),this.popupOption.title=r,r?(this.contentTitle||(this.contentTitle=I("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),ln(this.contentTitle),ei(this.contentTitle,r)):this.contentTitle&&(L(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var r=this.lngLat,o=r.lng,u=r.lat;return this.popupOption.autoPan&&this.mapsService.panTo([o,u]),this}},{key:"setLngLat",value:function(r){return this.setLnglat(r)}},{key:"setLnglat",value:function(r){var o=this;return this.show(),this.lngLat=r,Array.isArray(r)&&(this.lngLat={lng:r[0],lat:r[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){o.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(r){return this.popupOption.maxWidth=r,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(r){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:Ie.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(r){return this.show(),this.createContent(),ei(this.contentPanel,r),this.update(),this}},{key:"updateCloseOnClick",value:function(r){var o=this,u=this.mapsService;u&&(u==null||u.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!r&&requestAnimationFrame(function(){u==null||u.on("click",o.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(r){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!r&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(r){var o,u=(o=this.mapsService)===null||o===void 0?void 0:o.getContainer();u&&(u==null||u.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!r&&(u==null||u.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var r=this;if(this.content&&L(this.content),this.contentTitle=void 0,this.content=I("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var o=ld("l7-icon-guanbi");B(o,"l7-popup-close-button"),this.content.appendChild(o),this.popupOption.closeButtonOffsets&&(o.style.right=this.popupOption.closeButtonOffsets[0]+"px",o.style.top=this.popupOption.closeButtonOffsets[1]+"px"),o.setAttribute("aria-label","Close popup"),o.addEventListener("click",function(){r.hide()}),this.closeButton=o}else this.closeButton=void 0;this.contentPanel=I("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(r,o){if(this.container){var u=this.popupOption.offsets;this.container.style.left=r+u[0]+"px",this.container.style.top=o-u[1]+"px"}}},{key:"checkUpdateOption",value:function(r,o){return o.some(function(u){return u in r})}}]),t}(fs.EventEmitter);function EC(e){var i=SC();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function SC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ER=function(e){(0,Fr.Z)(t,e);var i=EC(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"layerConfigMap",new WeakMap),n}return(0,tr.Z)(t,[{key:"layerConfigItems",get:function(){var r,o=this.popupOption,u=o.config,l=o.items;return(r=u!=null?u:l)!==null&&r!==void 0?r:[]}},{key:"addTo",value:function(r){return Fo((0,it.Z)(t.prototype),"addTo",this).call(this,r),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return Fo((0,it.Z)(t.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(r){return this.unbindLayerEvent(),Fo((0,it.Z)(t.prototype),"setOptions",this).call(this,r),this.bindLayerEvent(),this}},{key:"getDefault",value:function(r){var o=r.trigger==="click";return(0,U.Z)((0,U.Z)({},Fo((0,it.Z)(t.prototype),"getDefault",this).call(this,r)),{},{trigger:"hover",followCursor:!o,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!1,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var r=this,o=this.popupOption.trigger;this.layerConfigItems.forEach(function(u){var l,p=r.getLayerByConfig(u);if(!!p){var v=(0,U.Z)({},u);if(o==="hover"){var E=r.onLayerMouseMove.bind(r,p),w=r.onLayerMouseOut.bind(r,p);v.onMouseMove=E,v.onMouseOut=w,p==null||p.on("mousemove",E),p==null||p.on("mouseout",w)}else{var M=r.onLayerClick.bind(r,p);v.onClick=M,p==null||p.on("click",M)}var k=p==null||(l=p.getSource)===null||l===void 0?void 0:l.call(p),D=r.onSourceUpdate.bind(r,p);k==null||k.on("update",D),v.onSourceUpdate=D,r.layerConfigMap.set(p,v)}})}},{key:"unbindLayerEvent",value:function(){var r=this;this.layerConfigItems.forEach(function(o){var u=r.getLayerByConfig(o),l=u&&r.layerConfigMap.get(u);if(!!l){var p=l.onMouseMove,v=l.onMouseOut,E=l.onClick,w=l.onSourceUpdate;if(p&&u.off("mousemove",p),v&&u.off("mouseout",v),E&&u.off("click",E),w){var M;u==null||(M=u.getSource())===null||M===void 0||M.off("update",w)}}})}},{key:"onLayerMouseMove",value:function(r,o){if(!this.isSameFeature(r,o.featureId)){var u=this.getLayerInfoFrag(r,o),l=u.title,p=u.content;this.setDOMContent(p),this.setTitle(l),this.displayFeatureInfo={layer:r,featureId:o.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(r,o){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onLayerClick",value:function(r,o){if(this.isShow&&this.isSameFeature(r,o.featureId))this.hide();else{var u=this.getLayerInfoFrag(r,o),l=u.title,p=u.content;this.setDOMContent(p),this.setLnglat(o.lngLat),this.setTitle(l),this.displayFeatureInfo={layer:r,featureId:o.featureId},this.show()}}},{key:"onSourceUpdate",value:function(r){var o;((o=this.displayFeatureInfo)===null||o===void 0?void 0:o.layer)===r&&(this.hide(),this.displayFeatureInfo=void 0)}},{key:"getLayerInfoFrag",value:function(r,o){var u=this.layerConfigMap.get(r),l,p=document.createDocumentFragment();if(u){var v=o.feature;v.type==="Feature"&&"properties"in v&&"geometry"in v&&(v=v.properties);var E=u.title,w=u.fields,M=u.customContent;if(E){l=document.createDocumentFragment();var k=E instanceof Function?E(v):E;ei(l,k)}if(M){var D=M instanceof Function?M(v):M;ei(p,D)}else w!=null&&w.length&&(w==null||w.forEach(function(N){var V,q,fe=typeof N=="string"?{field:N}:N,he=fe.field,Be=fe.formatField,Ge=fe.formatValue,St=fe.getValue,Ut=I("div","l7-layer-popup__row"),Yt=St?St(o.feature):(0,f.get)(v,he),nr=(V=Be instanceof Function?Be(he,v):Be)!==null&&V!==void 0?V:he,Rr=(q=Ge instanceof Function?Ge(Yt,v):Ge)!==null&&q!==void 0?q:Yt,Tr=I("span","l7-layer-popup__key",Ut);ei(Tr,nr),ei(Tr,document.createTextNode("\uFF1A"));var on=I("span","l7-layer-popup__value",Ut);ei(on,Rr),p.appendChild(Ut)}))}return{title:l,content:p}}},{key:"getLayerByConfig",value:function(r){var o=r.layer;if(o instanceof Object)return o;if(typeof o=="string")return this.layerService.getLayer(o)||this.layerService.getLayerByName(o)}},{key:"isSameFeature",value:function(r,o){var u=this.displayFeatureInfo;return u&&r===u.layer&&o===u.featureId}}]),t}(ry);function wC(e,i){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(i||(i=document),!!i)){var r=i.head||i.getElementsByTagName("head")[0];if(!r){r=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):i.documentElement.appendChild(r)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),r.appendChild(u),u}}wC(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 1000;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 800;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  height: 24px;
  line-height: 24px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 16px;
  font-size: 12px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  height: 14px;
  width: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  padding: 12px 12px 0 12px;
  width: 474px;
  height: 320px;
  overflow: auto;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-select-control--image .l7-select-control-item {
  margin-right: 12px;
  border-radius: 2px;
  overflow: hidden;
  border: 1px solid #fff;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  width: calc((100% - 36px) / 3);
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  margin-bottom: 12px;
  position: relative;
  font-size: 12px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 142px;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  right: 0;
  top: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control--image .l7-select-control-item:nth-child(3n) {
  margin-right: 0;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  border-radius: 2px;
  overflow: hidden;
}
.l7-control-zoom .l7-button-control {
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
  border-radius: 0;
  font-size: 16px;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:first-child {
  border-bottom: 1px solid #f0f0f0;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
`);var Ld,ny=(Ld={},(0,J.Z)(Ld,vp.additive,{enable:!0,func:{srcRGB:ee.ONE,dstRGB:ee.ONE,srcAlpha:1,dstAlpha:1}}),(0,J.Z)(Ld,vp.none,{enable:!1}),(0,J.Z)(Ld,vp.normal,{enable:!0,func:{srcRGB:ee.SRC_ALPHA,dstRGB:ee.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,J.Z)(Ld,vp.subtractive,{enable:!0,func:{srcRGB:ee.ONE,dstRGB:ee.ONE,srcAlpha:ee.ZERO,dstAlpha:ee.ONE_MINUS_SRC_COLOR},equation:{rgb:ee.FUNC_SUBTRACT,alpha:ee.FUNC_SUBTRACT}}),(0,J.Z)(Ld,vp.max,{enable:!0,func:{srcRGB:ee.ONE,dstRGB:ee.ONE},equation:{rgb:ee.MAX_EXT}}),(0,J.Z)(Ld,vp.min,{enable:!0,func:{srcRGB:ee.ONE,dstRGB:ee.ONE},equation:{rgb:ee.MIN_EXT}}),Ld);function _h(e,i,t,n,r){i.updateStyleAttribute(e,t,n,r)}function AC(e,i){i.tileLayer||i.isTileLayer||(e.opacity&&Fm("opacity",i,e.opacity),e.strokeWidth&&Fm("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Fm("strokeOpacity",i,e.strokeOpacity),e.stroke&&CC("stroke",i,e.stroke),e.offsets&&j1("offsets",i,e.offsets),e.textOffset&&j1("textOffset",i,e.textOffset),e.thetaOffset&&Fm("thetaOffset",i,e.thetaOffset))}function Fm(e,i,t){(0,f.isString)(t)?_h(e,i,t,function(n){return n}):(0,f.isNumber)(t)||(Array.isArray(t)&&t.length===2?(0,f.isString)(t[0])&&(0,f.isFunction)(t[1])||(0,f.isString)(t[0])&&Array.isArray(t[1])&&(0,f.isNumber)(t[1][0])&&(0,f.isNumber)(t[1][1])?_h(e,i,t[0],t[1]):_h(e,i,[1],void 0):_h(e,i,[1],void 0))}function j1(e,i,t){(0,f.isString)(t)?_h(e,i,t,function(n){return n}):Array.isArray(t)&&t.length===2&&(0,f.isString)(t[0])&&(0,f.isFunction)(t[1])?_h(e,i,t[0],t[1]):Array.isArray(t)&&t.length===2&&(0,f.isNumber)(t[0])&&(0,f.isNumber)(t[1])?_h(e,i,t,void 0):_h(e,i,[0,0],void 0)}function CC(e,i,t){(0,f.isString)(t)||(Array.isArray(t)&&t.length===2&&((0,f.isString)(t[0])&&(0,f.isFunction)(t[1])||(0,f.isString)(t[0])&&Array.isArray(t[1])&&t[1].length>0)?_h(e,i,t[0],t[1]):_h(e,i,"#fff",void 0))}var Mf;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFUALT="DEFUALTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Mf||(Mf={}));function TC(e,i){var t=[i[0]-e[0],i[1]-e[1]],n=Hu(t),r=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return r}function MC(e,i,t){if(e.length>0&&i.version===Mf["GAODE2.x"]){var n=t.coordCenter;typeof e[0].coordinates[0]=="number"?e.filter(function(r){return!r.originCoordinates}).map(function(r){r.version=Mf["GAODE2.x"],r.originCoordinates=(0,f.cloneDeep)(r.coordinates),r.coordinates=i.lngLatToCoordByLayer(r.coordinates,n)}):e.filter(function(r){return!r.originCoordinates}).map(function(r){r.version=Mf["GAODE2.x"],r.originCoordinates=(0,f.cloneDeep)(r.coordinates),r.coordinates=i.lngLatToCoordsByLayer(r.coordinates,n)})}}function IC(e,i){e.length>0&&i.version===Mf.SIMPLE&&e.map(function(t){t.simpleCoordinate||(t.coordinates=kC(t.coordinates,i),t.simpleCoordinate=!0)})}function kC(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var t=[];return e.map(function(r){var o=[];r.map(function(u){o.push(i.simpleMapCoord.unproject(u))}),t.push(o)}),t}else{var n=[];return e.map(function(r){n.push(i.simpleMapCoord.unproject(r))}),n}}function PC(e,i){var t;if(!e.scale)return[];var n=(e==null||(t=e.scale)===null||t===void 0?void 0:t.scalers)||[],r=[];n.forEach(function(u){var l,p=u.field;(i.hasOwnProperty(p)||((l=e.scale)===null||l===void 0?void 0:l.type)==="variable")&&r.push(i[p])});var o=e.mapping?e.mapping(r):[];return o}function RC(e,i,t,n,r){var o=r==null?void 0:r.getLayerConfig(),u=o.arrow,l=u===void 0?{enable:!1}:u,p=i.map(function(v){var E={id:v._id,coordinates:v.coordinates};if(e.filter(function(k){return k.scale!==void 0}).forEach(function(k){var D=PC(k,v);k.needRemapping=!1,k.name==="color"&&(D=D.map(function(N){return Oa(N)})),E[k.name]=Array.isArray(D)&&D.length===1?D[0]:D,k.name==="shape"&&(E.shape=t.getIconFontKey(E[k.name]))}),E.shape==="line"&&l.enable){var w=E.coordinates,M=TC(w[0],w[1]);E.coordinates.splice(1,0,M,M)}return E});return MC(p,n,r),IC(p,n),p}function LC(e,i,t,n,r,o){var u=new ey(r,o),l=n.getLayerStyleAttributes()||[],p=u.data.dataArray,v=p,E=RC(l,v,i,t,e);return u.destroy(),E}function H1(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function W1(e,i,t,n){var r=e.multiPassRenderer,o=e.getLayerConfig(),u=o.enableTAA;return u?r.add(n("taa")):r.add(n("render")),H1(i).forEach(function(l){var p=(0,Ti.Z)(l,2),v=p[0],E=p[1];r.add(t(v),E)}),r.add(t("copy")),r}var OC=function(){function e(i){(0,Ht.Z)(this,e),this.layer=i}return(0,tr.Z)(e,[{key:"pickRender",value:function(t){var n=this.layer;if(n.tileLayer)return n.tileLayer.pickRender(t);n.hooks.beforePickingEncode.call(),n.masks.length>0&&n.masks.filter(function(r){return r.inited}).forEach(function(){var r=(0,ot.Z)(se().mark(function o(u){return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:u.render();case 1:case"end":return p.stop()}},o)}));return function(o){return r.apply(this,arguments)}}()),n.renderModels(!0),n.hooks.afterPickingEncode.call()}},{key:"pick",value:function(t,n){var r=this.layer.getContainer(),o=r.get(fr.IPickingService);return t.type==="RasterLayer"?this.pickRasterLayer(t,n):(this.pickRender(n),o.pickFromPickingFBO(t,n))}},{key:"pickRasterLayer",value:function(t,n,r){var o=this.layer.getContainer(),u=o.get(fr.IPickingService),l=o.get(fr.IMapService),p=this.layer.getSource().extent,v=ro(n.lngLat,p),E={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},w=r||t;if(v){var M=this.readRasterValue(t,p,l,n.x,n.y);return E.rasterValue=M,u.triggerHoverOnLayer(w,E),!0}else return E.type=n.type==="mousemove"?"mouseout":"un"+n.type,u.triggerHoverOnLayer(w,(0,U.Z)((0,U.Z)({},E),{},{type:"unpick"})),u.triggerHoverOnLayer(w,E),!1}},{key:"readRasterValue",value:function(t,n,r,o,u){var l=t.getSource().data.dataArray[0],p=(0,Ti.Z)(n,4),v=p[0],E=v===void 0?0:v,w=p[1],M=w===void 0?0:w,k=p[2],D=k===void 0?10:k,N=p[3],V=N===void 0?-10:N,q=r.lngLatToContainer([E,M]),fe=r.lngLatToContainer([D,V]),he=fe.x-q.x,Be=q.y-fe.y,Ge=[(o-q.x)/he,(u-fe.y)/Be],St=l.width||1,Ut=l.height||1,Yt=Math.floor(Ge[0]*St),nr=Math.floor(Ge[1]*Ut),Rr=Math.max(0,nr-1)*St+Yt,Tr=l.data[Rr];return Tr}},{key:"selectFeature",value:function(t){var n=this.layer,r=(0,Ti.Z)(t,3),o=r[0],u=r[1],l=r[2];n.hooks.beforeSelect.call([o,u,l])}},{key:"highlightPickedFeature",value:function(t){var n=(0,Ti.Z)(t,3),r=n[0],o=n[1],u=n[2];this.layer.hooks.beforeHighlight.call([r,o,u])}},{key:"getFeatureById",value:function(t){return this.layer.getSource().getFeatureById(t)}}]),e}(),FC=function(){function e(i){(0,Ht.Z)(this,e),this.layer=i;var t=this.layer.getContainer();this.rendererService=t.get(fr.IRendererService)}return(0,tr.Z)(e,[{key:"getColorTexture",value:function(t,n){var r=this.getTextureKey(t,n);return this.key===r?this.colorTexture:(this.createColorTexture(t,n),this.key=r,this.colorTexture)}},{key:"createColorTexture",value:function(t,n){var r=this.rendererService.createTexture2D,o=this.getColorRampBar(t,n),u=r({data:o.data,width:o.width,height:o.height,flipY:!1});return this.colorTexture=u,u}},{key:"setColorTexture",value:function(t,n,r){this.key=this.getTextureKey(n,r),this.colorTexture=t}},{key:"destroy",value:function(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}},{key:"getColorRampBar",value:function(t,n){switch(t.type){case"cat":return Uc(t);case"quantize":return Ih(t);case"custom":return Vc(t,n);case"linear":return Zc(t,n);default:return Gl(t)}}},{key:"getTextureKey",value:function(t,n){var r;return"".concat(t.colors.join("_"),"_").concat(t==null||(r=t.positions)===null||r===void 0?void 0:r.join("_"),"_").concat(t.type,"_").concat(n==null?void 0:n.join("_"))}}]),e}(),DC=["passes"],BC=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber","workerEnabled","workerOptions"],X1,iy,$1;function NC(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=zC(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function zC(e,i){if(!!e){if(typeof e=="string")return Y1(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Y1(e,i)}}function Y1(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function ZC(e){var i=UC();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function UC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q1=0,Od=(X1=Kg(fr.IGlobalConfigService),iy=function(e){(0,Fr.Z)(t,e);var i=ZC(t);function t(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,Ht.Z)(this,t),n=i.call(this),(0,J.Z)((0,Ke.Z)(n),"id","".concat(q1++)),(0,J.Z)((0,Ke.Z)(n),"name","".concat(q1)),(0,J.Z)((0,Ke.Z)(n),"visible",!0),(0,J.Z)((0,Ke.Z)(n),"zIndex",0),(0,J.Z)((0,Ke.Z)(n),"inited",!1),(0,J.Z)((0,Ke.Z)(n),"layerModelNeedUpdate",!1),(0,J.Z)((0,Ke.Z)(n),"pickedFeatureID",null),(0,J.Z)((0,Ke.Z)(n),"selectedFeatureID",null),(0,J.Z)((0,Ke.Z)(n),"styleNeedUpdate",!1),(0,J.Z)((0,Ke.Z)(n),"forceRender",!1),(0,J.Z)((0,Ke.Z)(n),"clusterZoom",0),(0,J.Z)((0,Ke.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,J.Z)((0,Ke.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,J.Z)((0,Ke.Z)(n),"hooks",{init:new XE,afterInit:new Xy,beforeRender:new Xy,beforeRenderData:new $E,afterRender:new Op,beforePickingEncode:new Op,afterPickingEncode:new Op,beforeHighlight:new Op(["pickedColor"]),afterHighlight:new Op,beforeSelect:new Op(["pickedColor"]),afterSelect:new Op,beforeDestroy:new Op,afterDestroy:new Op}),(0,J.Z)((0,Ke.Z)(n),"models",[]),(0,J.Z)((0,Ke.Z)(n),"startInit",!1),(0,J.Z)((0,Ke.Z)(n),"layerChildren",[]),(0,J.Z)((0,Ke.Z)(n),"masks",[]),Ta((0,Ke.Z)(n),"configService",$1,(0,Ke.Z)(n)),(0,J.Z)((0,Ke.Z)(n),"animateOptions",{enable:!1}),(0,J.Z)((0,Ke.Z)(n),"currentPickId",null),(0,J.Z)((0,Ke.Z)(n),"pendingStyleAttributes",[]),(0,J.Z)((0,Ke.Z)(n),"scaleOptions",{}),(0,J.Z)((0,Ke.Z)(n),"animateStatus",!1),(0,J.Z)((0,Ke.Z)(n),"isDestroyed",!1),(0,J.Z)((0,Ke.Z)(n),"encodeDataLength",0),(0,J.Z)((0,Ke.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var o=n.getLayerConfig();o&&o.autoFit&&n.fitBounds(o.fitBoundsOptions);var u=n.layerSource.getSourceCfg().autoRender;u&&n.reRender()}),n.name=r.name||n.id,n.zIndex=r.zIndex||0,n.rawConfig=r,n}return(0,tr.Z)(t,[{key:"addMaskLayer",value:function(r){this.masks.push(r)}},{key:"removeMaskLayer",value:function(r){var o=this.masks.indexOf(r);o>-1&&this.masks.splice(o,1),r.destroy()}},{key:"getAttribute",value:function(r){return this.styleAttributeService.getLayerStyleAttribute(r)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(r){var o=this;if(Object.keys(r).map(function(l){l in o.rawConfig&&(o.rawConfig[l]=r[l])}),!this.startInit)this.needUpdateConfig=(0,U.Z)((0,U.Z)({},this.needUpdateConfig),r);else{var u=this.container.get(fr.SceneID);AC(r,this),this.configService.setLayerConfig(u,this.id,(0,U.Z)((0,U.Z)((0,U.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),r)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(r,o){this.container=r,this.sceneContainer=o}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(r){return this.plugins.push(r),this}},{key:"init",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u=this,l,p,v,E,w,M,k;return se().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:l=this.container.get(fr.SceneID),this.startInit=!0,this.configService.setLayerConfig(l,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(fr.IIconService),this.fontService=this.container.get(fr.IFontService),this.rendererService=this.container.get(fr.IRendererService),this.layerService=this.container.get(fr.ILayerService),this.debugService=this.container.get(fr.IDebugService),this.interactionService=this.container.get(fr.IInteractionService),this.pickingService=this.container.get(fr.IPickingService),this.mapService=this.container.get(fr.IMapService),p=this.getLayerConfig(),v=p.enableMultiPassRenderer,E=p.passes,v&&E!==null&&E!==void 0&&E.length&&E.length>0&&this.mapService.on("mapAfterFrameChange",function(){u.renderLayers()}),this.cameraService=this.container.get(fr.ICameraService),this.coordinateService=this.container.get(fr.ICoordinateSystemService),this.shaderModuleService=this.container.get(fr.IShaderModuleService),this.postProcessingPassFactory=this.container.get(fr.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(fr.IFactoryNormalPass),this.styleAttributeService=this.container.get(fr.IStyleAttributeService),v&&(this.multiPassRenderer=this.container.get(fr.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(V){var q=V.attributeName,fe=V.attributeField,he=V.attributeValues,Be=V.updateOptions;u.styleAttributeService.updateStyleAttribute(q,{scale:(0,U.Z)({field:fe},u.splitValuesAndCallbackInAttribute(he,u.getLayerConfig()[q]))},Be)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(fr.ILayerPlugin),w=NC(this.plugins);try{for(w.s();!(M=w.n()).done;)k=M.value,k.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(V){w.e(V)}finally{w.f()}return this.layerPickService=new OC(this),this.textureService=new FC(this),this.log(Cl.LayerInitStart),N.next=31,this.hooks.init.promise();case 31:this.log(Cl.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return N.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"log",value:function(r){var o,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"init";if(!(this.tileLayer||this.isTileLayer)){var l="".concat(this.id,".").concat(u,".").concat(r),p={id:this.id,type:this.type};(o=this.debugService)===null||o===void 0||o.log(l,p)}}},{key:"updateModelData",value:function(r){r.attributes&&r.elements?this.models.map(function(o){o.updateAttributesAndElements(r.attributes,r.elements)}):console.warn("data error")}},{key:"createModelData",value:function(r,o){var u;if((u=this.layerModel)!==null&&u!==void 0&&u.createModelData)return this.layerModel.createModelData(o);var l=this.calculateEncodeData(r,o),p=this.triangulation;return l&&p?this.styleAttributeService.createAttributesAndIndices(l,p):{attributes:void 0,elements:void 0}}},{key:"setLayerPickService",value:function(r){this.layerPickService=r}},{key:"calculateEncodeData",value:function(r,o){return this.inited?LC(this,this.fontService,this.mapService,this.styleAttributeService,r,o):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.updateLayerConfig((0,U.Z)((0,U.Z)((0,U.Z)({},this.getDefaultConfig()),this.rawConfig),this.needUpdateConfig));var r=this.getLayerConfig(),o=r.animateOption;o!=null&&o.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(r,o,u){return this.updateStyleAttribute("color",r,o,u),this}},{key:"texture",value:function(r,o,u){return this.updateStyleAttribute("texture",r,o,u),this}},{key:"rotate",value:function(r,o,u){return this.updateStyleAttribute("rotate",r,o,u),this}},{key:"size",value:function(r,o,u){return this.updateStyleAttribute("size",r,o,u),this}},{key:"filter",value:function(r,o,u){var l=this.updateStyleAttribute("filter",r,o,u);return this.dataState.dataSourceNeedUpdate=l,this}},{key:"shape",value:function(r,o,u){this.shapeOption={field:r,values:o};var l=this.updateStyleAttribute("shape",r,o,u);return this.dataState.dataSourceNeedUpdate=l,this}},{key:"label",value:function(r,o,u){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:r,attributeValues:o,updateOptions:u}),this}},{key:"animate",value:function(r){var o={};return(0,f.isObject)(r)?(o.enable=!0,o=(0,U.Z)((0,U.Z)({},o),r)):o.enable=r,this.updateLayerConfig({animateOption:o}),this}},{key:"source",value:function(r,o){return(r==null?void 0:r.type)==="source"?(this.setSource(r),this):(this.sourceOption={data:r,options:o},this.clusterZoom=0,this)}},{key:"setData",value:function(r,o){var u=this;return this.inited?(this.log(Cl.SourceInitStart,Tl.UPDATE),this.layerSource.setData(r,o),this.log(Cl.SourceInitEnd,Tl.UPDATE)):this.on("inited",function(){u.log(Cl.SourceInitStart,Tl.UPDATE);var l=u.getSource();l?u.layerSource.setData(r,o):u.source(new ey(r,o)),u.layerSource.once("update",function(){u.log(Cl.SourceInitEnd,Tl.UPDATE)})}),this}},{key:"style",value:function(r){var o=this,u=r.passes,l=(0,Af.Z)(r,DC);return u&&H1(u).forEach(function(p){var v=o.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(p[0]);v&&v.updateOptions(p[1])}),this.rawConfig=(0,U.Z)((0,U.Z)({},this.rawConfig),l),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(r,o){var u=(0,U.Z)({},this.scaleOptions);if((0,f.isObject)(r)?this.scaleOptions=(0,U.Z)((0,U.Z)({},this.scaleOptions),r):this.scaleOptions[r]=o,this.styleAttributeService&&!(0,f.isEqual)(u,this.scaleOptions)){var l=(0,f.isObject)(r)?r:(0,J.Z)({},r,o);this.styleAttributeService.updateScaleAttribute(l)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(),this))}},{key:"renderMultiPass",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){l.next=2;break}return l.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){l.next=7;break}return l.next=5,this.multiPassRenderer.render();case 5:l.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"active",value:function(r){var o={};return o.enableHighlight=(0,f.isObject)(r)?!0:r,(0,f.isObject)(r)?(o.enableHighlight=!0,r.color&&(o.highlightColor=r.color),r.mix&&(o.activeMix=r.mix)):o.enableHighlight=!!r,this.updateLayerConfig(o),this}},{key:"setActive",value:function(r,o){var u=this;if((0,f.isObject)(r)){var l=r.x,p=l===void 0?0:l,v=r.y,E=v===void 0?0:v;this.updateLayerConfig({highlightColor:(0,f.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,f.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.pick({x:p,y:E})}else this.updateLayerConfig({pickedFeatureID:r,highlightColor:(0,f.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,f.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(Zu(r)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"select",value:function(r){var o={};return o.enableSelect=(0,f.isObject)(r)?!0:r,(0,f.isObject)(r)?(o.enableSelect=!0,r.color&&(o.selectColor=r.color),r.mix&&(o.selectMix=r.mix)):o.enableSelect=!!r,this.updateLayerConfig(o),this}},{key:"setSelect",value:function(r,o){var u=this;if((0,f.isObject)(r)){var l=r.x,p=l===void 0?0:l,v=r.y,E=v===void 0?0:v;this.updateLayerConfig({selectColor:(0,f.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,f.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.pick({x:p,y:E})}else this.updateLayerConfig({pickedFeatureID:r,selectColor:(0,f.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,f.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Zu(r)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"setBlend",value:function(r){return this.updateLayerConfig({blend:r}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(r){return this.zIndex=r,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(r){this.currentPickId=r}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(r){this.selectedFeatureID=r}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var r=this.mapService.getZoom(),o=this.getLayerConfig(),u=o.visible,l=o.minZoom,p=l===void 0?-Infinity:l,v=o.maxZoom,E=v===void 0?Infinity:v;return!!u&&r>=p&&r<E}},{key:"setMultiPass",value:function(r,o){if(this.updateLayerConfig({enableMultiPassRenderer:r}),o&&this.updateLayerConfig({passes:o}),r){var u=this.getLayerConfig(),l=u.passes,p=l===void 0?[]:l;this.multiPassRenderer=W1(this,p,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var v=this.rendererService.getViewportSize(),E=v.width,w=v.height;this.multiPassRenderer.resize(E,w)}return this}},{key:"setMinZoom",value:function(r){return this.updateLayerConfig({minZoom:r}),this}},{key:"getMinZoom",value:function(){var r=this.getLayerConfig(),o=r.minZoom;return o}},{key:"getMaxZoom",value:function(){var r=this.getLayerConfig(),o=r.maxZoom;return o}},{key:"get",value:function(r){var o=this.getLayerConfig();return o[r]}},{key:"setMaxZoom",value:function(r){return this.updateLayerConfig({maxZoom:r}),this}},{key:"setAutoFit",value:function(r){return this.updateLayerConfig({autoFit:r}),this}},{key:"fitBounds",value:function(r){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var o=this.getSource(),u=o.extent,l=u.some(function(p){return Math.abs(p)===Infinity});return l?this:(this.mapService.fitBounds([[u[0],u[1]],[u[2],u[3]]],r),this)}},{key:"destroy",value:function(){var r,o,u,l,p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isDestroyed||(this.layerChildren.map(function(v){return v.destroy(!1)}),this.layerChildren=[],this.masks.map(function(v){return v.destroy(!1)}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(r=this.multiPassRenderer)===null||r===void 0||r.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(o=this.layerModel)===null||o===void 0||o.clearModels(p),(u=this.tileLayer)===null||u===void 0||u.destroy(),this.models=[],(l=this.debugService)===null||l===void 0||l.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var r;this.models.forEach(function(o){return o.destroy()}),(r=this.layerModel)===null||r===void 0||r.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(r){return r.needRescale||r.needRemapping||r.needRegenerateVertices}).length}},{key:"setSource",value:function(r){var o=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=r,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(l){var p=l.type;if(o.coordCenter===void 0){var v,E=o.layerSource.center;o.coordCenter=E,(v=o.mapService)!==null&&v!==void 0&&v.setCoordCenter&&o.mapService.setCoordCenter(E)}p==="update"&&o.sourceEvent()})}},{key:"initSource",value:function(r){this.layerSource=r,this.clusterZoom=0,this.addSourceEvent()}},{key:"getSource",value:function(){return this.layerSource}},{key:"addSourceEvent",value:function(){var r=this;this.layerSource.on("update",function(){if(r.coordCenter===void 0){var o,u=r.layerSource.center;r.coordCenter=u,(o=r.mapService)!==null&&o!==void 0&&o.setCoordCenter&&r.mapService.setCoordCenter(u)}r.sourceEvent()})}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(r){this.encodedData=r,this.encodeDataLength=r.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(r){return this.styleAttributeService.getLayerAttributeScale(r)}},{key:"getLegend",value:function(r){var o,u,l,p=this.styleAttributeService.getLayerStyleAttribute(r),v=(p==null||(o=p.scale)===null||o===void 0?void 0:o.scalers)||[];return{type:(u=v[0].option)===null||u===void 0?void 0:u.type,field:p==null||(l=p.scale)===null||l===void 0?void 0:l.field,items:this.getLegendItems(r)}}},{key:"getLegendItems",value:function(r){var o=this.styleAttributeService.getLayerAttributeScale(r);if(!o)return[];if(o.invertExtent){var u=o.range().map(function(v){return(0,J.Z)({value:o.invertExtent(v)},r,v)});return u}else if(o.ticks){var l=o.ticks().map(function(v){return(0,J.Z)({value:v},r,o(v))});return l}else if(o!=null&&o.domain){var p=o.domain().filter(function(v){return!(0,f.isUndefined)(v)}).map(function(v){return(0,J.Z)({value:v},r,o(v))});return p}return[]}},{key:"pick",value:function(r){var o=r.x,u=r.y;this.interactionService.triggerHover({x:o,y:u})}},{key:"boxSelect",value:function(r,o){this.pickingService.boxPickLayer(this,r,o)}},{key:"buildLayerModel",value:function(){var n=(0,ot.Z)(se().mark(function o(u){var l=this,p,v,E,w,M,k,D,N,V,q,fe,he,Be,Ge;return se().wrap(function(Ut){for(;;)switch(Ut.prev=Ut.next){case 0:return p=u.moduleName,v=u.vertexShader,E=u.fragmentShader,w=u.triangulation,M=u.segmentNumber,k=u.workerEnabled,D=k===void 0?!1:k,N=u.workerOptions,V=(0,Af.Z)(u,BC),this.shaderModuleService.registerModule(p,{vs:v,fs:E}),q=this.shaderModuleService.getModule(p),fe=q.vs,he=q.fs,Be=q.uniforms,Ge=this.rendererService.createModel,Ut.abrupt("return",new Promise(function(Yt,nr){if(N&&N.modelType in Aa&&D)l.styleAttributeService.createAttributesAndIndicesAscy(l.encodedData,M,N).then(function(Co){var Ds=Co.attributes,js=Co.elements,vu=Ge((0,U.Z)({attributes:Ds,uniforms:Be,fs:he,vs:fe,elements:js,blend:ny[vp.normal]},V));Yt(vu)}).catch(function(Co){return nr(Co)});else{var Rr=l.styleAttributeService.createAttributesAndIndices(l.encodedData,w,M),Tr=Rr.attributes,on=Rr.elements,Hn=Rr.count,di=(0,U.Z)({attributes:Tr,uniforms:Be,fs:he,vs:fe,elements:on,blend:ny[vp.normal]},V);Hn&&(di.count=Hn);var za=Ge(di);Yt(za)}}));case 5:case"end":return Ut.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"createAttributes",value:function(r){var o=r.triangulation,u=this.styleAttributeService.createAttributes(this.encodedData,o),l=u.attributes;return l}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(r){var o=this.getLayerConfig(),u=o.enableHighlight,l=u===void 0?!0:u,p=o.enableSelect,v=p===void 0?!0:p,E=this.eventNames().indexOf(r)!==-1||this.eventNames().indexOf("un"+r)!==-1;return(r==="click"||r==="dblclick")&&v&&(E=!0),r==="mousemove"&&(l||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(E=!0),this.isVisible()&&E}},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return l.stop()}},o)}));function r(){return n.apply(this,arguments)}return r}()},{key:"rebuildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"renderMulPass",value:function(){var n=(0,ot.Z)(se().mark(function o(u){return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,u.render();case 2:case"end":return p.stop()}},o)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"renderModels",value:function(r){var o=this;return this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(u){u.draw({uniforms:o.layerModel.getUninforms()},r)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(r,o,u,l){var p=this.configService.getAttributeConfig(this.id)||{};return(0,f.isEqual)(p[r],{field:o,values:u})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(r)!==-1&&this.configService.setAttributeConfig(this.id,(0,J.Z)({},r,{field:o,values:u})),this.startInit?this.styleAttributeService.updateStyleAttribute(r,{scale:(0,U.Z)({field:o},this.splitValuesAndCallbackInAttribute(u,this.getLayerConfig()[o]))},l):this.pendingStyleAttributes.push({attributeName:r,attributeField:o,attributeValues:u,updateOptions:l}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(r){console.warn("empty fn")}},{key:"processData",value:function(r){return r}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.models.forEach(function(p){return p.destroy()}),this.models=[],l.next=4,this.layerModel.initModels();case 4:this.models=l.sent;case 5:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(r,o){return{values:(0,f.isFunction)(r)?void 0:r||o,callback:(0,f.isFunction)(r)?r:void 0}}}]),t}(fs.EventEmitter),$1=Ma(iy.prototype,"configService",[X1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iy),K1,ay,Q1;function VC(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=GC(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function GC(e,i){if(!!e){if(typeof e=="string")return J1(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return J1(e,i)}}function J1(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}var os=(K1=Kg(fr.IGlobalConfigService),ay=function(){function e(i){(0,Ht.Z)(this,e),Ta(this,"configService",Q1,this),this.layer=i,this.rendererService=i.getContainer().get(fr.IRendererService),this.pickingService=i.getContainer().get(fr.IPickingService),this.shaderModuleService=i.getContainer().get(fr.IShaderModuleService),this.styleAttributeService=i.getContainer().get(fr.IStyleAttributeService),this.mapService=i.getContainer().get(fr.IMapService),this.iconService=i.getContainer().get(fr.IIconService),this.fontService=i.getContainer().get(fr.IFontService),this.cameraService=i.getContainer().get(fr.ICameraService),this.layerService=i.getContainer().get(fr.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:ee.NEAREST,min:ee.NEAREST,width:1,height:1}))}return(0,tr.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertiesExist.hasOpacity,this.stylePropertiesExist.hasStrokeOpacity,this.stylePropertiesExist.hasStrokeWidth,this.stylePropertiesExist.hasStroke,this.stylePropertiesExist.hasOffsets,this.stylePropertiesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(t){var n=!1;return(0,f.isEqual)(t.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=t.thetaOffset),(0,f.isEqual)(t.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=t.opacity),(0,f.isEqual)(t.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=t.strokeOpacity),(0,f.isEqual)(t.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=t.strokeWidth),(0,f.isEqual)(t.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=t.stroke),(0,f.isEqual)(t.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=t.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(t){this.clearLastCalRes(),t.opacity!==void 0&&!(0,f.isNumber)(t.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertiesExist.hasOpacity=1,this.cellLength+=1),t.strokeOpacity!==void 0&&!(0,f.isNumber)(t.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertiesExist.hasStrokeOpacity=1,this.cellLength+=1),t.strokeWidth!==void 0&&!(0,f.isNumber)(t.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertiesExist.hasStrokeWidth=1,this.cellLength+=1),t.stroke!==void 0&&!this.isStaticColor(t.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertiesExist.hasStroke=1,this.cellLength+=4),t.offsets!==void 0&&!this.isOffsetStatic(t.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertiesExist.hasOffsets=1,this.cellLength+=2),t.thetaOffset!==void 0&&!(0,f.isNumber)(t.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertiesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(t){return(0,f.isString)(t)?!!(0,Js.ZP)(t):!1}},{key:"getStrokeColor",value:function(t){if(this.isStaticColor(t)){var n=Oa(t);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(t){return!!(Array.isArray(t)&&t.length===2&&(0,f.isNumber)(t[0])&&(0,f.isNumber)(t[1]))}},{key:"patchMod",value:function(t,n){for(var r=0;r<n;r++)t.push(-1)}},{key:"patchData",value:function(t,n,r){var o=VC(r),u;try{for(o.s();!(u=o.n()).done;){var l=u.value,p=l.attr,v=l.count,E=n[p];E!==void 0?p==="stroke"?t.push.apply(t,(0,H.Z)(Oa(E))):p==="offsets"?this.isOffsetStatic(E)?t.push(-E[0],E[1]):t.push(0,0):t.push((0,f.isNumber)(E)?E:1):this.patchMod(t,v)}}catch(w){o.e(w)}finally{o.f()}}},{key:"calDataFrame",value:function(t,n,r){for(var o=n.length,u=Math.ceil(o*t/this.DATA_TEXTURE_WIDTH),l=u*this.DATA_TEXTURE_WIDTH,p=[],v=0;v<o;v++){var E=n[v];this.patchData(p,E,r)}for(var w=p.length;w<l;w++)p.push(-1);return{data:p,width:this.DATA_TEXTURE_WIDTH,height:u}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),n=t.blend,r=n===void 0?"normal":n;return ny[vp[r]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var i=(0,ot.Z)(se().mark(function n(){return se().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",!1);case 1:case"end":return o.stop()}},n)}));function t(){return i.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var i=(0,ot.Z)(se().mark(function n(){return se().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function t(){return i.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var i=(0,ot.Z)(se().mark(function n(){return se().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function t(){return i.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),Q1=Ma(ay.prototype,"configService",[K1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ay),oy=100,SR=36,wR=40;function ex(e){return e/180*Math.acos(-1)}function tx(e){var i=ex(e[0])+Math.PI/2,t=ex(e[1]),n=oy+Math.random()*.4,r=n*Math.cos(t)*Math.cos(i),o=n*Math.cos(t)*Math.sin(i),u=n*Math.sin(t);return[o,u,r]}function AR(e,i){var t=mat4.create(),n=mat4.create(),r=vec3.fromValues(0,1,0),o=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var u=typeof i.segments!="undefined"?i.segments:32,l=2+u,p=2*l,v=[],E=[],w=[],M=[],k=[],D=[],N=0;N<=l;N++){for(var V=N/l,q=V*Math.PI,fe=0;fe<=p;fe++){var he=fe/p,Be=he*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-q),mat4.identity(t),mat4.rotateY(t,t,Be),vec3.transformMat4(o,r,n),vec3.transformMat4(o,o,t),vec3.scale(o,o,-e),w.push(o.slice()),M.push.apply(M,_toConsumableArray(o.slice())),vec3.normalize(o,o),k.push.apply(k,_toConsumableArray(o.slice())),D.push([he,1-V]),M.push(he,1-V)}if(N>0)for(var Ge=w.length,St=Ge-2*(p+1);St+p+2<Ge;St++)v.push([St,St+1,St+p+1]),E.push(St,St+1,St+p+1),v.push([St+p+1,St+1,St+p+2]),E.push(St+p+1,St+1,St+p+2)}return{cells:v,positions:w,uvs:D,positionsArr:M,indicesArr:E,normalArr:k}}var Dm=Gr.create(),CR=Gr.create(),Nl=Gr.create(),Fd=Gr.create(),Uv=Gr.create();function sy(e,i,t,n,r){Gr.add(e,t,n),Gr.normalize(e,e),i=Gr.fromValues(-e[1],e[0]);var o=Gr.fromValues(-t[1],t[0]);return[r/Gr.dot(i,o),i]}function Dd(e,i){return Gr.set(e,-i[1],i[0])}function Vv(e,i,t){return Gr.sub(e,i,t),Gr.normalize(e,e),e}function uy(e,i){return e[0]===i[0]&&e[1]===i[1]}function TR(e){for(var i=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(t,1),t++):i.set(n,n)}return e}var jC=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Ht.Z)(this,e),(0,J.Z)(this,"lastFlip",-1),(0,J.Z)(this,"miter",Gr.fromValues(0,0)),(0,J.Z)(this,"started",!1),(0,J.Z)(this,"dash",!1),(0,J.Z)(this,"totalDistance",0),(0,J.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,tr.Z)(e,[{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=n.startIndex,u=1;u<r;u++){var l=t[u-1],p=t[u],v=u<t.length-1?t[u+1]:null,E=this.simpleSegment(n,o,l,p,v);o+=E}if(this.dash)for(var w=0;w<n.positions.length/6;w++)n.positions[w*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,n){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,l=1;l<o;l++){var p,v,E,w=t[l-1];w.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var M=n[l-1],k=t[l];k.push((v=n[l][2])!==null&&v!==void 0?v:0);var D=n[l],N=l<t.length-1?[].concat((0,H.Z)(t[l+1]),[(E=n[l+1][2])!==null&&E!==void 0?E:0]):null,V=l<n.length-1?n[l+1]:null,q=this.simpleSegment(r,u,w,k,N,M,D,V);u+=q}if(this.dash)for(var fe=0;fe<r.positions.length/6;fe++)r.positions[fe*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude_gaode2",value:function(t,n){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,l=1;l<o;l++){var p,v,E,w=t[l-1];w.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var M=n[l-1],k=t[l];k.push((v=n[l][2])!==null&&v!==void 0?v:0);var D=n[l],N=l<t.length-1?[].concat((0,H.Z)(t[l+1]),[(E=n[l+1][2])!==null&&E!==void 0?E:0]):null,V=l<n.length-1?n[l+1]:null,q=this.segment_gaode2(r,u,w,k,N,M,D,V);u+=q}if(this.dash)for(var fe=0;fe<r.positions.length/6;fe++)r.positions[fe*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=n.startIndex,u=1;u<r;u++){var l=t[u-1],p=t[u],v=u<t.length-1?t[u+1]:null,E=this.segment(n,o,l,p,v);o+=E}if(this.dash)for(var w=0;w<n.positions.length/6;w++)n.positions[w*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(t,n,r,o,u){var l=0,p=t.indices,v=t.positions,E=t.normals,w=Es([o[0],o[1]]),M=Es([r[0],r[1]]);Vv(Nl,w,M);var k=0;if(this.dash&&(k=this.lineSegmentDistance(w,M),this.totalDistance+=k),this.normal||(this.normal=Gr.create(),Dd(this.normal,Nl)),this.started||(this.started=!0,this.extrusions(v,E,r,this.normal,this.thickness,this.totalDistance-k)),p.push(n+0,n+1,n+2),!u)Dd(this.normal,Nl),this.extrusions(v,E,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,H.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var D=Es([u[0],u[1]]);uy(w,D)&&Gr.add(D,w,Gr.normalize(D,Gr.subtract(D,w,M))),Vv(Fd,D,w);var N=sy(Uv,Gr.create(),Nl,Fd,this.thickness),V=(0,Ti.Z)(N,2),q=V[0],fe=V[1],he=Gr.dot(Uv,this.normal)<0?-1:1;this.extrusions(v,E,o,fe,q,this.totalDistance),p.push.apply(p,(0,H.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),he=-1,Gr.copy(this.normal,fe),l+=2,this.lastFlip=he}return l}},{key:"segment_gaode2",value:function(t,n,r,o,u,l,p,v){var E=0,w=t.indices,M=t.positions,k=t.normals,D=this.cap==="square",N=this.join==="bevel",V=Es([p[0],p[1]]),q=Es([l[0],l[1]]);Vv(Nl,o,r);var fe=0;if(this.dash&&(fe=this.lineSegmentDistance(V,q),this.totalDistance+=fe),this.normal||(this.normal=Gr.create(),Dd(this.normal,Nl)),!this.started)if(this.started=!0,D){var he=Gr.create(),Be=Gr.create();Gr.add(he,this.normal,Nl),Gr.add(Be,this.normal,Nl),k.push(Be[0],Be[1],0),k.push(he[0],he[1],0),M.push(r[0],r[1],r[2]|0,this.totalDistance-fe,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),M.push(r[0],r[1],r[2]|0,this.totalDistance-fe,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(M,k,r,this.normal,this.thickness,this.totalDistance-fe);if(w.push(n+0,n+1,n+2),u){uy(o,u)&&Gr.add(u,o,Gr.normalize(u,Gr.subtract(u,o,r))),Vv(Fd,u,o);var Ut=sy(Uv,Gr.create(),Nl,Fd,this.thickness),Yt=(0,Ti.Z)(Ut,2),nr=Yt[0],Rr=Yt[1],Tr=Gr.dot(Uv,this.normal)<0?-1:1,on=N;if(!on&&this.join==="miter"){var Hn=nr;Hn>this.miterLimit&&(on=!0)}on?(k.push(this.normal[0],this.normal[1],0),k.push(Rr[0],Rr[1],0),M.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Tr,o[2]|0),this.complex.indexes.push(this.currentIndex),M.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Tr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,w.push.apply(w,(0,H.Z)(this.lastFlip!==-Tr?[n,n+2,n+3]:[n+2,n+1,n+3])),w.push(n+2,n+3,n+4),Dd(Dm,Fd),Gr.copy(this.normal,Dm),k.push(this.normal[0],this.normal[1],0),M.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Tr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,E+=3):(this.extrusions(M,k,o,Rr,nr,this.totalDistance),w.push.apply(w,(0,H.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Tr=-1,Gr.copy(this.normal,Rr),E+=2),this.lastFlip=Tr}else{if(Dd(this.normal,Nl),D){var Ge=Gr.create(),St=Gr.create();Gr.sub(St,Nl,this.normal),Gr.add(Ge,Nl,this.normal),k.push(St[0],St[1],0),k.push(Ge[0],Ge[1],0),M.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),M.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(M,k,o,this.normal,this.thickness,this.totalDistance);w.push.apply(w,(0,H.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),E+=2}return E}},{key:"segment",value:function(t,n,r,o,u){var l=0,p=t.indices,v=t.positions,E=t.normals,w=this.cap==="square",M=this.join==="bevel",k=Es([o[0],o[1]]),D=Es([r[0],r[1]]);Vv(Nl,k,D);var N=0;if(this.dash&&(N=this.lineSegmentDistance(k,D),this.totalDistance+=N),this.normal||(this.normal=Gr.create(),Dd(this.normal,Nl)),!this.started)if(this.started=!0,w){var V=Gr.create(),q=Gr.create();Gr.add(V,this.normal,Nl),Gr.add(q,this.normal,Nl),E.push(q[0],q[1],0),E.push(V[0],V[1],0),v.push(r[0],r[1],r[2]|0,this.totalDistance-N,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),v.push(r[0],r[1],r[2]|0,this.totalDistance-N,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,E,r,this.normal,this.thickness,this.totalDistance-N);if(p.push(n+0,n+1,n+2),u){var Be=Es([u[0],u[1]]);uy(k,Be)&&Gr.add(Be,k,Gr.normalize(Be,Gr.subtract(Be,k,D))),Vv(Fd,Be,k);var Ge=sy(Uv,Gr.create(),Nl,Fd,this.thickness),St=(0,Ti.Z)(Ge,2),Ut=St[0],Yt=St[1],nr=Gr.dot(Uv,this.normal)<0?-1:1,Rr=M;if(!Rr&&this.join==="miter"){var Tr=Ut;Tr>this.miterLimit&&(Rr=!0)}Rr?(E.push(this.normal[0],this.normal[1],0),E.push(Yt[0],Yt[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*nr,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*nr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,H.Z)(this.lastFlip!==-nr?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),Dd(Dm,Fd),Gr.copy(this.normal,Dm),E.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*nr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(v,E,o,Yt,Ut,this.totalDistance),p.push.apply(p,(0,H.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),nr=-1,Gr.copy(this.normal,Yt),l+=2),this.lastFlip=nr}else{if(Dd(this.normal,Nl),w){var fe=Gr.create(),he=Gr.create();Gr.sub(he,Nl,this.normal),Gr.add(fe,Nl,this.normal),E.push(he[0],he[1],0),E.push(fe[0],fe[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,E,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,H.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,r,o,u,l){n.push(o[0],o[1],0),n.push(o[0],o[1],0),t.push(r[0],r[1],r[2]|0,l,-u,r[2]|0),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],r[2]|0,l,u,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var r=n[0]-t[0],o=n[1]-t[1];return Math.sqrt(r*r+o*o)}}]),e}(),ss=ie(77160);function HC(e){var i=e[0][0],t=e[0][e[0].length-1];i[0]===t[0]&&i[1]===t[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,r=qi().flatten(e),o=r.vertices,u=r.dimensions,l=[],p=[],v=0;v<o.length/u;v++)u===2?l.push(o[v*2],o[v*2+1],1):l.push(o[v*3],o[v*3+1],1);var E=qi()(r.vertices,r.holes,r.dimensions);p.push.apply(p,(0,H.Z)(E));for(var w=function(D){var N=r.vertices.slice(D*u,(D+1)*u),V=r.vertices.slice((D+1)*u,(D+2)*u);V.length===0&&(V=r.vertices.slice(0,u));var q=l.length/3;l.push(N[0],N[1],1,V[0],V[1],1,N[0],N[1],0,V[0],V[1],0),p.push.apply(p,(0,H.Z)([0,2,1,2,3,1].map(function(fe){return fe+q})))},M=0;M<n;M++)w(M);return{positions:l,index:p}}function WC(e){var i=qi().flatten(e),t=qi()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:t}}function rx(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,o=qi().flatten(e),u=o.vertices,l=o.dimensions,p=[],v=[],E=[],w=0;w<u.length/l;w++)l===2?p.push(u[w*2],u[w*2+1],1,-1,-1):p.push(u[w*3],u[w*3+1],1,-1,-1),E.push(0,0,1);var M=qi()(o.vertices,o.holes,o.dimensions);v.push.apply(v,(0,H.Z)(M));for(var k=function(V){var q=o.vertices.slice(V*l,(V+1)*l),fe=o.vertices.slice((V+1)*l,(V+2)*l);fe.length===0&&(fe=o.vertices.slice(0,l));var he=p.length/5;p.push(q[0],q[1],1,0,0,fe[0],fe[1],1,.1,0,q[0],q[1],0,0,.8,fe[0],fe[1],0,.1,.8);var Be=XC([fe[0],fe[1],1],[q[0],q[1],0],[q[0],q[1],1],i);E.push.apply(E,(0,H.Z)(Be).concat((0,H.Z)(Be),(0,H.Z)(Be),(0,H.Z)(Be))),v.push.apply(v,(0,H.Z)([1,2,0,3,2,1].map(function(Ge){return Ge+he})))},D=0;D<r;D++)k(D);return{positions:p,index:v,normals:E}}function XC(e,i,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=ss.create(),o=ss.create(),u=ss.create();n&&(e=Rs(e),i=Rs(i),t=Rs(t));var l=ss.fromValues.apply(ss,(0,H.Z)(e)),p=ss.fromValues.apply(ss,(0,H.Z)(i)),v=ss.fromValues.apply(ss,(0,H.Z)(t));ss.sub(r,v,p),ss.sub(o,l,p),ss.cross(u,r,o);var E=ss.create();return ss.normalize(E,u),E}var Vh,rv;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(rv||(rv={}));var nv;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(nv||(nv={}));function A0(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,n=[],r=0;r<e;r++)n.push(t*r+i*Math.PI/12);var o=n.map(function(u){var l=Math.sin(u+Math.PI/4),p=Math.cos(u+Math.PI/4);return[l,p,0]});return o}function nx(){return A0(30)}function ix(){return A0(4)}function ax(){return A0(3)}function ox(){return A0(6,1)}function sx(){return A0(5)}var Gv=(Vh={},(0,J.Z)(Vh,nv.CIRCLE,nx),(0,J.Z)(Vh,nv.HEXAGON,ox),(0,J.Z)(Vh,nv.TRIANGLE,ax),(0,J.Z)(Vh,nv.SQUARE,ix),(0,J.Z)(Vh,nv.PENTAGON,sx),(0,J.Z)(Vh,rv.CYLINDER,nx),(0,J.Z)(Vh,rv.HEXAGONCOLUMN,ox),(0,J.Z)(Vh,rv.TRIANGLECOLUMN,ax),(0,J.Z)(Vh,rv.SQUARECOLUMN,ix),(0,J.Z)(Vh,rv.PENTAGONCOLUMN,sx),Vh),Bm={};function Nm(e){var i=gl(e.coordinates);return{vertices:[].concat((0,H.Z)(i),(0,H.Z)(i),(0,H.Z)(i),(0,H.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function ux(e){var i=gl(e.coordinates),t=tx(i);return{vertices:[].concat((0,H.Z)(t),(0,H.Z)(t),(0,H.Z)(t),(0,H.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function ly(e){var i=e.shape,t=e3(i,!1),n=t.positions,r=t.index,o=t.normals;return{vertices:n,indices:r,normals:o,size:5}}function $C(e){var i=gl(e.coordinates);return{vertices:(0,H.Z)(i),indices:[0],size:i.length}}function C0(e){var i=e.coordinates,t=e.originCoordinates,n=e.version,r=new jC({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=t;Array.isArray(u[0][0])||(u=[t]);for(var l=0;l<o.length;l++){var p=o[l],v=u[l];r.extrude_gaode2(p,v)}}else{var E=i;E[0]&&!Array.isArray(E[0][0])&&(E=[i]),E.forEach(function(M){r.extrude(M)})}var w=r.complex;return{vertices:w.positions,indices:w.indices,normals:w.normals,indexes:w.indexes,size:6}}function YC(e){var i=e.coordinates,t=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var n=qC(i),r=n.results,o=n.totalDistance;return r.map(function(u){t.push(u[0],u[1],u[2],u[3],0,o)}),{vertices:t,indices:[],normals:[],size:6,count:r.length}}function MR(e){var i=e.coordinates,t=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],size:4,count:0};var n=KC(i),r=n.results;return r.map(function(o){t.push(o[0],o[1],o[2],o[3])}),{vertices:t,indices:[],size:4,count:r.length}}function lx(e,i){var t=i[0]-e[0],n=i[1]-e[1];return Math.sqrt(t*t+n*n)}function jv(e,i){return e.length<3&&e.push(0),i!==void 0&&e.push(i),e}function qC(e){var i=e;Array.isArray(i)&&Array.isArray(i[0])&&Array.isArray(i[0][0])&&(i=e.flat());var t=0;if(i.length<2)return{results:i,totalDistance:0};var n=[],r=jv(i[0],t);n.push(r);for(var o=1;o<i.length-1;o++){var u=lx(i[o-1],i[o]);t+=u;var l=jv(i[o],t);n.push(l),n.push(l)}var p=lx(i[i.length-2],i[i.length-1]);return t+=p,n.push(jv(i[i.length-1],t)),{results:n,totalDistance:t}}function KC(e){if(e.length<2)return{results:e};var i=[],t=jv(e[0]);i.push(t);for(var n=1;n<e.length-1;n++){var r=jv(e[n]);i.push(r),i.push(r)}return i.push(jv(e[e.length-1])),{results:i}}function cy(e){var i=e.coordinates,t=qi().flatten(i),n=t.vertices,r=t.dimensions,o=t.holes;return{indices:qi()(n,o,r),vertices:n,size:r}}function QC(e){var i=e.coordinates,t=qi().flatten(i),n=t.vertices,r=t.dimensions,o=t.holes;return{indices:qi()(n,o,r),vertices:JC(n),size:r+4}}function JC(e){for(var i=[],t=Df(e),n=t.center,r=t.radius,o=0;o<e.length;o+=2){var u=e[o],l=e[o+1];i.push.apply(i,[u,l,0].concat((0,H.Z)(n),[r]))}return i}function cx(e){var i=e.coordinates,t=rx(i,!0),n=t.positions,r=t.index,o=t.normals;return{vertices:n,indices:r,normals:o,size:5}}function fx(e){var i=e.shape,t=r3(i),n=t.positions,r=t.index;return{vertices:n,indices:r,size:3}}function zm(e){var i=e.coordinates,t=[].concat((0,H.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,H.Z)(i[1]),[0,1,0],(0,H.Z)(i[0]),[0,0,1],(0,H.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:t,indices:n,size:5}}function Zm(e,i){for(var t=i||30,n=e.coordinates,r=[],o=[],u=function(v){r.push(v,1,v,n[0][0],n[0][1],n[1][0],n[1][1],v,-1,v,n[0][0],n[0][1],n[1][0],n[1][1]),v!==t-1&&o.push.apply(o,(0,H.Z)([0,1,2,1,3,2].map(function(E){return v*2+E})))},l=0;l<t;l++)u(l);return{vertices:r,indices:o,size:7}}function hx(e){var i=e.coordinates;i.length===2&&i.push(0);var t=Um(-1,1),n=Um(1,1),r=Um(-1,-1),o=Um(1,-1),u=[].concat((0,H.Z)(i),(0,H.Z)(t),(0,H.Z)(i),(0,H.Z)(r),(0,H.Z)(i),(0,H.Z)(o),(0,H.Z)(i),(0,H.Z)(n)),l=[0,1,2,3,0,2];return{vertices:u,indices:l,size:5}}function e3(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Bm&&Bm[e])return Bm[e];var t=Gv[e]?Gv[e]():Gv.cylinder(),n=rx([t],i);return Bm[e]=n,n}function IR(e,i){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=new Float32Array(e.length/t*3),o,u,l,p=vec3.create(),v=vec3.create(),E=vec3.create(),w=0,M=i.length;w<M;w+=3){o=i[w+0]*3,u=i[w+1]*3,l=i[w+2]*3;var k=[e[o],e[o+1]],D=[e[u],e[u+1]],N=[e[l],e[l+1]];n&&(k=lngLatToMeters(k),D=lngLatToMeters(D),N=lngLatToMeters(N));var V=k,q=_slicedToArray(V,2),fe=q[0],he=q[1],Be=vec3.fromValues(fe,he,e[o+2]),Ge=D,St=_slicedToArray(Ge,2),Ut=St[0],Yt=St[1],nr=vec3.fromValues(Ut,Yt,e[u+2]),Rr=N,Tr=_slicedToArray(Rr,2),on=Tr[0],Hn=Tr[1],di=vec3.fromValues(on,Hn,e[l+2]);vec3.sub(p,di,nr),vec3.sub(v,Be,nr),vec3.cross(E,p,v),r[o]+=p[0],r[o+1]+=p[1],r[o+2]+=p[2],r[u]+=p[0],r[u+1]+=p[1],r[u+2]+=p[2],r[l]+=p[0],r[l+1]+=p[1],r[l+2]+=p[2]}return t3(r),r}function t3(e){for(var i=0,t=e.length;i<t;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),r=vec3.create();vec3.normalize(r,n),e.set(r,i)}}function kR(e){var i=e[0][0],t=e[0][e[0].length-1];return i[0]===t[0]&&i[1]===t[1]}function r3(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=Gv[e]?Gv[e]():Gv.circle(),n=i.indexOf(e)===-1?WC([t]):HC([t]);return n}function Um(e,i){var t=(e+1)/2,n=(i+1)/2;return[t,n]}function PR(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:i,indices:t,size:5,normals:n}}function RR(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:i,indices:t,size:5,normals:n}}function n3(e){var i=i3();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function i3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var a3=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,o3=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,s3=function(e){(0,Fr.Z)(t,e);var i=n3(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.baseColor,p=l===void 0?"rgb(16,16,16)":l,v=r.brightColor,E=v===void 0?"rgb(255,176,38)":v,w=r.windowColor,M=w===void 0?"rgb(30,60,89)":w,k=r.time,D=k===void 0?0:k,N=r.sweep,V=N===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:N;return{u_cityCenter:V.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*V.sweepRadius,u_circleSweep:V.enable?1:0,u_circleSweepColor:Oa(V.sweepColor).slice(0,3),u_circleSweepSpeed:V.sweepSpeed,u_opacity:u,u_baseColor:Oa(p),u_brightColor:Oa(E),u_windowColor:Oa(M),u_time:this.layer.getLayerAnimateTime()||D}}},{key:"calCityGeo",value:function(){var r=(0,Ti.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],l=r[2],p=r[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(l+o)/2,(p+u)/2]);var v=this.mapService.lngLatToCoord([l,p]),E=this.mapService.lngLatToCoord([o,u]);this.cityMinSize=Math.sqrt(Math.pow(v[0]-E[0],2)+Math.pow(v[1]-E[1],2))/4}else{var w=l-o,M=p-u;this.cityCenter=[(l+o)/2,(p+u)/2],this.cityMinSize=Math.sqrt(Math.pow(w,2)+Math.pow(M,2))/4}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.calCityGeo(),this.startModelAnimate(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:o3,fragmentShader:a3,triangulation:cx,depth:{enable:!0},cull:{enable:!0,face:ee.BACK}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:ri.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?10:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ri.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),t}(os);function u3(e){var i=l3();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function l3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var c3=function(e){(0,Fr.Z)(t,e);var i=u3(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"type","CityBuildingLayer"),n}return(0,tr.Z)(t,[{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.layerModel=new s3(this),l.next=3,this.initLayerModels();case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"setLight",value:function(r){this.updateLayerConfig({time:r})}},{key:"getModelType",value:function(){return"citybuilding"}}]),t}(Od);function f3(e){var i=h3();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function h3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p3=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,v3=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,m3=function(e){(0,Fr.Z)(t,e);var i=f3(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,l=r.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w;return se().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,k.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:p3,fragmentShader:v3,triangulation:fx,primitive:ee.TRIANGLES,depth:{enable:!1},stencil:Uo(p,E)});case 3:return w=k.sent,k.abrupt("return",[w]);case 5:case"end":return k.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:ri.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),t}(os);function g3(e){var i=y3();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function y3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _3=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,x3=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,b3=function(e){(0,Fr.Z)(t,e);var i=g3(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,l=r.angle;return{u_opacity:o||1,u_coverage:u||1,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w;return se().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,k.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:_3,fragmentShader:x3,triangulation:ly,primitive:ee.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:Uo(p,E)});case 3:return w=k.sent,k.abrupt("return",[w]);case 5:case"end":return k.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(o){var u=o.size;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ri.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:ri.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),t}(os);function E3(e,i){for(var t=[],n=[],r=[],o=e+1,u=i+1,l=e/2,p=i/2,v=0;v<u;v++)for(var E=v-p,w=0;w<o;w++){var M=w-l;n.push(M/l,-E/p,0),r.push(w/e),r.push(1-v/i)}for(var k=0;k<i;k++)for(var D=0;D<e;D++){var N=D+o*k,V=D+o*(k+1),q=D+1+o*(k+1),fe=D+1+o*k;t.push(N,V,fe),t.push(V,q,fe)}return{vertices:n,indices:t,uvs:r}}var px,dx;function S3(e){var i=w3();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function w3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A3=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,C3=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,T3=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,M3=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,I3=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,k3=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,vx=(px=(0,kn.b2)(),px(dx=function(e){(0,Fr.Z)(t,e);var i=S3(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"render",value:function(){var r=this,o=this.rendererService,u=o.clear,l=o.useFramebuffer;l(this.heatmapFramerBuffer,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:r.heatmapFramerBuffer}),r.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w,M,k,D,N;return se().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return l=this.rendererService,p=l.createFramebuffer,v=l.getViewportSize,E=l.createTexture2D,w=this.styleAttributeService.getLayerStyleAttribute("shape"),M=(w==null||(u=w.scale)===null||u===void 0?void 0:u.field)||"heatmap",this.shapeType=M,q.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=q.sent,this.colorModel=M==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),k=v(),D=k.width,N=k.height,this.heatmapFramerBuffer=p({color:E({width:Math.floor(D/4),height:Math.floor(N/4),wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE,min:ee.LINEAR,mag:ee.LINEAR}),depth:!1}),this.updateColorTexture(),q.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return q.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:ri.Attribute,descriptor:{name:"a_Dir",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return[l]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=hx,p.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:k3,fragmentShader:I3,triangulation:hx,depth:{enable:!1},cull:{enable:!0,face:Lf(this.mapService.version)},blend:{enable:!0,func:{srcRGB:ee.ONE,srcAlpha:1,dstRGB:ee.ONE,dstAlpha:1}}});case 3:return u=p.sent,p.abrupt("return",u);case 5:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildHeatmapColor",value:function(){var r=this.layer.getLayerConfig(),o=r.mask,u=o===void 0?!1:o,l=r.maskInside,p=l===void 0?!0:l;this.shaderModuleService.registerModule("heatmapColor",{vs:M3,fs:T3});var v=this.shaderModuleService.getModule("heatmapColor"),E=v.vs,w=v.fs,M=v.uniforms,k=this.rendererService,D=k.createAttribute,N=k.createElements,V=k.createBuffer,q=k.createModel;return q({vs:E,fs:w,attributes:{a_Position:D({buffer:V({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:ee.FLOAT}),size:3}),a_Uv:D({buffer:V({data:[0,1,1,1,0,0,1,0],type:ee.FLOAT}),size:2})},uniforms:(0,U.Z)({},M),depth:{enable:!1},blend:this.getBlend(),elements:N({data:[0,2,1,2,3,1],type:ee.UNSIGNED_INT,count:6}),stencil:Uo(u,p)})}},{key:"drawIntensityMode",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity,l=o.intensity,p=l===void 0?10:l,v=o.radius,E=v===void 0?5:v;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(r=this.intensityModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_radius:E,u_intensity:p}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity;(r=this.colorModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity,l=_o();Au(l,this.cameraService.getViewProjectionMatrixUncentered()),(r=this.colorModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,H.Z)(l)}})}},{key:"build3dHeatMap",value:function(){var r=this.layer.getLayerConfig(),o=r.mask,u=o===void 0?!1:o,l=r.maskInside,p=l===void 0?!0:l,v=this.rendererService.getViewportSize,E=v(),w=E.width,M=E.height,k=E3(w/4,M/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:C3,fs:A3});var D=this.shaderModuleService.getModule("heatmap3dColor"),N=D.vs,V=D.fs,q=D.uniforms,fe=this.rendererService,he=fe.createAttribute,Be=fe.createElements,Ge=fe.createBuffer,St=fe.createModel;return St({vs:N,fs:V,attributes:{a_Position:he({buffer:Ge({data:k.vertices,type:ee.FLOAT}),size:3}),a_Uv:he({buffer:Ge({data:k.uvs,type:ee.FLOAT}),size:2})},primitive:ee.TRIANGLES,uniforms:(0,U.Z)({},q),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:ee.SRC_ALPHA,srcAlpha:1,dstRGB:ee.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Be({data:k.indices,type:ee.UNSIGNED_INT,count:k.indices.length}),stencil:Uo(u,p)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var r=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var o=this.layer.getLayerConfig(),u=o.rampColors,l=Gl(u);this.colorTexture=r({data:new Uint8Array(l.data),width:l.width,height:l.height,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE,min:ee.NEAREST,mag:ee.NEAREST,flipY:!1})}}]),t}(os))||dx);function P3(e){var i=R3();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function R3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var L3=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,O3=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,F3=function(e){(0,Fr.Z)(t,e);var i=P3(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,l=r.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w;return se().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,k.next=3,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:O3,fragmentShader:L3,triangulation:fx,depth:{enable:!1},primitive:ee.TRIANGLES,blend:this.getBlend(),stencil:Uo(p,E)});case 3:return w=k.sent,k.abrupt("return",[w]);case 5:case"end":return k.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:ri.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),t}(os),D3={heatmap:vx,heatmap3d:vx,grid:m3,grid3d:b3,hexagon:F3},B3=D3;function N3(e){var i=z3();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function z3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z3=function(e){(0,Fr.Z)(t,e);var i=N3(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"type","HeatMapLayer"),n}return(0,tr.Z)(t,[{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new B3[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"renderModels",value:function(){var r=this,o=this.getModelType();return o==="heatmap"?(this.layerModel&&this.layerModel.render(),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(u){return u.draw({uniforms:r.layerModel.getUninforms()})}),this.hooks.afterRender.call(),this)}},{key:"updateModelData",value:function(r){r.attributes&&r.elements?this.models[0].updateAttributesAndElements(r.attributes,r.elements):console.warn("data error")}},{key:"getModelType",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=this.getLayerConfig(),l=u.shape3d,p=this.getSource(),v=p.data.type,E=(o==null||(r=o.scale)===null||r===void 0?void 0:r.field)||"heatmap";return E==="heatmap"||E==="heatmap3d"?"heatmap":v==="hexagon"?(l==null?void 0:l.indexOf(E))===-1?"hexagon":"grid3d":v==="grid"?(l==null?void 0:l.indexOf(E))===-1?"grid":"grid3d":"heatmap"}}]),t}(Od);function U3(e){var i=V3();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function V3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var G3=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,j3=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,H3=function(e){(0,Fr.Z)(t,e);var i=U3(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity;return{u_opacity:o||1,u_texture:this.texture}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u=this,l,p,v,E,w,M,k,D,N,V,q;return se().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:if(l=this.layer.getLayerConfig(),p=l.mask,v=p===void 0?!1:p,E=l.maskInside,w=E===void 0?!0:E,M=this.layer.getSource(),k=this.rendererService.createTexture2D,this.texture=k({height:0,width:0}),!Yo){he.next=12;break}D=this.layerService.sceneService.getSceneConfig().canvas,N=D.createImage(),N.crossOrigin="anonymous",N.src=M.data.originData,N.onload=function(){u.texture=k({data:N,width:N.width,height:N.height}),u.layerService.reRender()},he.next=16;break;case 12:return he.next=14,M.data.images;case 14:V=he.sent,this.texture=k({data:V[0],width:V[0].width,height:V[0].height,mag:ee.LINEAR,min:ee.LINEAR});case 16:return he.next=18,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:j3,fragmentShader:G3,triangulation:zm,primitive:ee.TRIANGLES,blend:{enable:!0},depth:{enable:!1},stencil:Uo(v,w)});case 18:return q=he.sent,he.abrupt("return",[q]);case 20:case"end":return he.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.texture)===null||r===void 0||r.destroy()}},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:ri.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),t}(os),W3={image:H3},X3=W3;function $3(e){var i=Y3();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function Y3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mx=function(e){(0,Fr.Z)(t,e);var i=$3(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"type","ImageLayer"),n}return(0,tr.Z)(t,[{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new X3[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={image:{}};return o[r]}},{key:"getModelType",value:function(){return"image"}}]),t}(Od);function q3(e){var i=K3();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function K3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Q3=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,J3=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,eT=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,tT=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  float arcThetaOffset = styleMappingMat[0][1];
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, arcThetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, arcThetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,rT=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,nT=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,iT={solid:0,dash:1},aT=function(e){(0,Fr.Z)(t,e);var i=q3(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:ee.NEAREST,min:ee.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.sourceColor,p=r.targetColor,v=r.textureBlend,E=v===void 0?"normal":v,w=r.lineType,M=w===void 0?"solid":w,k=r.dashArray,D=k===void 0?[10,5]:k,N=r.forward,V=N===void 0?!0:N,q=r.lineTexture,fe=q===void 0?!1:q,he=r.iconStep,Be=he===void 0?100:he,Ge=r.segmentNumber,St=Ge===void 0?30:Ge,Ut=r.thetaOffset,Yt=Ut===void 0?.314:Ut;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,thetaOffset:Yt})){this.judgeStyleAttributes({opacity:u,thetaOffset:Yt});var nr=this.layer.getEncodedData(),Rr=this.calDataFrame(this.cellLength,nr,this.cellProperties),Tr=Rr.data,on=Rr.width,Hn=Rr.height;this.rowCount=Hn,this.dataTexture=this.cellLength>0&&Tr.length>0?this.createTexture2D({flipY:!0,data:Tr,format:ee.LUMINANCE,type:ee.FLOAT,width:on,height:Hn}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}D.length===2&&D.push(0,0);var di=0,za=[0,0,0,0],Co=[0,0,0,0];return l&&p&&(za=Oa(l),Co=Oa(p),di=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:(0,f.isNumber)(Yt)?Yt:0,u_opacity:(0,f.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:St,u_line_type:iT[M||"solid"],u_dash_array:D,u_blur:.9,u_lineDir:V?1:-1,u_texture:this.texture,u_line_texture:fe?1:0,u_icon_step:Be,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:di,u_sourceColor:za,u_targetColor:Co}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor,l=r.lineType;return l==="dash"?{frag:Q3,vert:J3,type:"Dash"}:o&&u?{frag:rT,vert:nT,type:"Linear"}:{frag:eT,vert:tT,type:""}}},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w,M,k,D,N,V,q;return se().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=u.mask,E=v===void 0?!1:v,w=u.maskInside,M=w===void 0?!0:w,k=this.getShaders(),D=k.frag,N=k.vert,V=k.type,he.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+V,vertexShader:N,fragmentShader:D,triangulation:Zm,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p,stencil:Uo(E,M)});case 4:return q=he.sent,he.abrupt("return",[q]);case 6:case"end":return he.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:ri.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ri.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(u){var l=r.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},E=v.x,w=v.y;return[E,w]}}})}}]),t}(os);function oT(e){var i=sT();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function sT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,lT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,cT=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,fT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,hT={solid:0,dash:1},pT=function(e){(0,Fr.Z)(t,e);var i=oT(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:ee.NEAREST,min:ee.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.sourceColor,p=r.targetColor,v=r.textureBlend,E=v===void 0?"normal":v,w=r.lineType,M=w===void 0?"solid":w,k=r.dashArray,D=k===void 0?[10,5]:k,N=r.lineTexture,V=N===void 0?!1:N,q=r.iconStep,fe=q===void 0?100:q,he=r.segmentNumber,Be=he===void 0?30:he,Ge=r.globalArcHeight,St=Ge===void 0?10:Ge;D.length===2&&D.push(0,0);var Ut=0,Yt=[0,0,0,0],nr=[0,0,0,0];if(l&&p&&(Yt=Oa(l),nr=Oa(p),Ut=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Rr=this.layer.getEncodedData(),Tr=this.calDataFrame(this.cellLength,Rr,this.cellProperties),on=Tr.data,Hn=Tr.width,di=Tr.height;this.rowCount=di,this.dataTexture=this.cellLength>0&&on.length>0?this.createTexture2D({flipY:!0,data:on,format:ee.LUMINANCE,type:ee.FLOAT,width:Hn,height:di}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:oy,u_global_height:St,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,f.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:Be,u_line_type:hT[M]||0,u_dash_array:D,u_texture:this.texture,u_line_texture:V?1:0,u_icon_step:fe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ut,u_sourceColor:Yt,u_targetColor:nr}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:cT,vert:fT,type:"Linear"}:{frag:uT,vert:lT,type:""}}},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w,M,k,D,N,V,q;return se().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=u.mask,E=v===void 0?!1:v,w=u.maskInside,M=w===void 0?!0:w,k=this.getShaders(),D=k.frag,N=k.vert,V=k.type,he.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+V,vertexShader:N,fragmentShader:D,triangulation:Zm,blend:this.getBlend(),segmentNumber:p,stencil:Uo(E,M)});case 4:return q=he.sent,he.abrupt("return",[q]);case 6:case"end":return he.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:ri.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ri.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(u){var l=r.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},E=v.x,w=v.y;return[E,w]}}})}}]),t}(os);function dT(e){var i=vT();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function vT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,gT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,yT=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,_T=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,xT={solid:0,dash:1},bT=function(e){(0,Fr.Z)(t,e);var i=dT(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:ee.NEAREST,min:ee.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.sourceColor,p=r.targetColor,v=r.textureBlend,E=v===void 0?"normal":v,w=r.lineType,M=w===void 0?"solid":w,k=r.dashArray,D=k===void 0?[10,5]:k,N=r.lineTexture,V=N===void 0?!1:N,q=r.iconStep,fe=q===void 0?100:q,he=r.segmentNumber,Be=he===void 0?30:he,Ge=r.globalArcHeight,St=Ge===void 0?10:Ge;D.length===2&&D.push(0,0);var Ut=0,Yt=[0,0,0,0],nr=[0,0,0,0];if(l&&p&&(Yt=Oa(l),nr=Oa(p),Ut=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Rr=this.layer.getEncodedData(),Tr=this.calDataFrame(this.cellLength,Rr,this.cellProperties),on=Tr.data,Hn=Tr.width,di=Tr.height;this.rowCount=di,this.dataTexture=this.cellLength>0&&on.length>0?this.createTexture2D({flipY:!0,data:on,format:ee.LUMINANCE,type:ee.FLOAT,width:Hn,height:di}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_globel:1,u_globel_radius:oy,u_global_height:St,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,f.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:Be,u_line_type:xT[M]||0,u_dash_array:D,u_texture:this.texture,u_line_texture:V?1:0,u_icon_step:fe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ut,u_sourceColor:Yt,u_targetColor:nr}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:yT,vert:_T,type:"Linear"}:{frag:mT,vert:gT,type:""}}},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w,M,k,D,N,V,q;return se().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=u.mask,E=v===void 0?!1:v,w=u.maskInside,M=w===void 0?!0:w,k=this.getShaders(),D=k.frag,N=k.vert,V=k.type,he.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+V,vertexShader:N,fragmentShader:D,triangulation:Zm,depth:{enable:!0},blend:this.getBlend(),segmentNumber:p,stencil:Uo(E,M)});case 4:return q=he.sent,he.abrupt("return",[q]);case 6:case"end":return he.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:ri.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ri.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(u){var l=r.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},E=v.x,w=v.y;return[E,w]}}})}}]),t}(os);function ET(e){var i=ST();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function ST(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,AT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,CT={solid:0,dash:1},TT=function(e){(0,Fr.Z)(t,e);var i=ET(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:ee.NEAREST,min:ee.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.sourceColor,p=r.targetColor,v=r.textureBlend,E=v===void 0?"normal":v,w=r.lineType,M=w===void 0?"solid":w,k=r.dashArray,D=k===void 0?[10,5]:k,N=r.lineTexture,V=N===void 0?!1:N,q=r.iconStep,fe=q===void 0?100:q,he=r.segmentNumber,Be=he===void 0?30:he;D.length===2&&D.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Ge=0,St=[0,0,0,0],Ut=[0,0,0,0];if(l&&p&&(St=Oa(l),Ut=Oa(p),Ge=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Yt=this.layer.getEncodedData(),nr=this.calDataFrame(this.cellLength,Yt,this.cellProperties),Rr=nr.data,Tr=nr.width,on=nr.height;this.rowCount=on,this.dataTexture=this.cellLength>0&&Rr.length>0?this.createTexture2D({flipY:!0,data:Rr,format:ee.LUMINANCE,type:ee.FLOAT,width:Tr,height:on}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,f.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:Be,u_line_type:CT[M]||0,u_dash_array:D,u_texture:this.texture,u_line_texture:V?1:0,u_icon_step:fe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ge,u_sourceColor:St,u_targetColor:Ut}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w;return se().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,k.next=3,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:AT,fragmentShader:wT,triangulation:Zm,depth:{enable:!1},blend:this.getBlend(),stencil:Uo(p,E)});case 3:return w=k.sent,k.abrupt("return",[w]);case 5:case"end":return k.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:ri.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ri.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(u){var l=r.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},E=v.x,w=v.y;return[E,w]}}})}}]),t}(os);function MT(e){var i=IT();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function IT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kT=`#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
uniform float u_CoordinateSystem;
varying vec4 v_color;
uniform float u_arrow: 0.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

varying mat4 styleMappingMat;
void main() {
  float distanceAndIndex = styleMappingMat[0][3];
  float miter = styleMappingMat[0][2];

  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B


  if(u_arrow > 0.0 && distanceAndIndex < 2.0) { // arrow
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { 
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) { // amap
        discard;
      }
    } else { // amap2 mapbox map
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { 
        discard;
      }
    }
  } else { // line body
    if(miter < 0.0) {
      discard;
    }
  }


  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,PT=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute vec4 a_dirPoints;
attribute vec3 a_DistanceAndIndex;

uniform vec4 u_lineDir;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - a_Miter - a_DistanceAndIndex
    0.0, 0.0, 0.0, 0.0, // originX - originY - vectorX - vectorY
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );
  styleMappingMat[0][3] = a_DistanceAndIndex.y;
  styleMappingMat[0][2] = a_Miter;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  // styleMappingMat[1].rg = a_Position.xy + offset;

  vec2 copyOffset = vec2(offset.x, offset.y);

  float lineDistance = a_DistanceAndIndex.x;
  float total_Distance = a_DistanceAndIndex.z;
  float currentLinePointRatio = lineDistance / total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z); // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }
  
  if(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {
    vec2 startPoint = a_dirPoints.rg;
    vec2 endPoint = a_dirPoints.ba;
    vec4 t1 = project_position(vec4(startPoint, 0, 1.0));
    vec4 t2 = project_position(vec4(endPoint, 0, 1.0));
    // TODO\uFF1A \u540E\u7EED\u4F18\u5316\u53EF\u4EE5\u628A\u4F4D\u7F6E\u8BA1\u7B97\u653E\u5728 cpu \u4E2D\u5B8C\u6210
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      vec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    } else {
      vec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    }
  }

  setPickingColor(a_PickingColor);
}
`,RT=function(e){(0,Fr.Z)(t,e);var i=MT(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.sourceColor,p=r.targetColor,v=r.arrow,E=v===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:v,w=0,M=[0,0,0,0],k=[0,0,0,0];if(l&&p&&(M=Oa(l),k=Oa(p),w=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var D=this.layer.getEncodedData(),N=this.calDataFrame(this.cellLength,D,this.cellProperties),V=N.data,q=N.width,fe=N.height;this.rowCount=fe,this.dataTexture=this.cellLength>0&&V.length>0?this.createTexture2D({flipY:!0,data:V,format:ee.LUMINANCE,type:ee.FLOAT,width:q,height:fe}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,f.isNumber)(u)?u:1,u_linearColor:w,u_sourceColor:M,u_targetColor:k,u_arrow:Number(E.enable),u_arrowHeight:E.arrowHeight||3,u_arrowWidth:E.arrowWidth||2,u_tailWidth:E.tailWidth===void 0?1:E.tailWidth}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w,M,k,D,N,V;return se().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,w=u.depth,M=w===void 0?!1:w,k=this.getShaders(),D=k.frag,N=k.vert,this.layer.triangulation=C0,fe.next=5,this.layer.buildLayerModel({moduleName:"lineHalf",vertexShader:N,fragmentShader:D,triangulation:C0,depth:{enable:M},blend:this.getBlend(),stencil:Uo(p,E)});case 5:return V=fe.sent,fe.abrupt("return",[V]);case 7:case"end":return fe.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getShaders",value:function(){return{frag:kT,vert:PT,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:ri.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(o,u,l,p,v,E){return E===void 0?[l[3],10,l[5]]:[l[3],E,l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:ri.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:4,update:function(o){var u=o.coordinates[0]||[0,0],l=o.coordinates[3]||[0,0];return[u[0],u[1],l[0],l[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ri.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:ri.Attribute,descriptor:{name:"a_Miter",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(o,u,l){return[l[4]]}}})}}]),t}(os),gx;(function(e){e[e.solid=0]="solid",e[e.dash=1]="dash"})(gx||(gx={}));var Hv;(function(e){e.VERTICAL="vertical",e.HORIZONTAL="horizontal"})(Hv||(Hv={}));var fy;(function(e){e.NORMAL="normal",e.REPLACE="replace"})(fy||(fy={}));var T0;(function(e){e[e.pixel=0]="pixel",e[e.meter=1]="meter"})(T0||(T0={}));var yx;(function(e){e.ALWAYS="always",e.DRAGEND="dragend"})(yx||(yx={}));function LT(e){var i=OT();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function OT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FT=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,DT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,BT=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = styleMappingMat[3][3];
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,_x=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,NT=`varying vec4 v_color;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3][0]; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,zT={solid:0,dash:1},xx=function(e){(0,Fr.Z)(t,e);var i=LT(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"textureEventFlag",!1),(0,J.Z)((0,Ke.Z)(n),"texture",n.createTexture2D({data:[0,0,0,0],mag:ee.NEAREST,min:ee.NEAREST,premultiplyAlpha:!1,width:1,height:1})),(0,J.Z)((0,Ke.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:ee.NEAREST,min:ee.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.sourceColor,p=r.targetColor,v=r.textureBlend,E=v===void 0?"normal":v,w=r.lineType,M=w===void 0?"solid":w,k=r.dashArray,D=k===void 0?[10,5,0,0]:k,N=r.lineTexture,V=N===void 0?!1:N,q=r.iconStep,fe=q===void 0?100:q,he=r.vertexHeightScale,Be=he===void 0?20:he,Ge=r.borderWidth,St=Ge===void 0?0:Ge,Ut=r.borderColor,Yt=Ut===void 0?"#ccc":Ut,nr=r.raisingHeight,Rr=nr===void 0?0:nr,Tr=r.heightfixed,on=Tr===void 0?!1:Tr,Hn=r.linearDir,di=Hn===void 0?Hv.VERTICAL:Hn,za=r.blur,Co=za===void 0?[1,1,1]:za,Ds=r.arrow,js=Ds===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Ds;D.length===2&&D.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var vu=0,jf=[0,0,0,0],J0=[0,0,0,0];if(l&&p&&(jf=Oa(l),J0=Oa(p),vu=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var r0=this.layer.getEncodedData(),em=this.calDataFrame(this.cellLength,r0,this.cellProperties),mg=em.data,Hy=em.width,gg=em.height;this.rowCount=gg,this.dataTexture=this.cellLength>0&&mg.length>0?this.createTexture2D({flipY:!0,data:mg,format:ee.LUMINANCE,type:ee.FLOAT,width:Hy,height:gg}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,f.isNumber)(u)?u:1,u_textureBlend:E===fy.NORMAL?0:1,u_line_type:zT[M],u_dash_array:D,u_blur:Co,u_texture:this.texture,u_line_texture:V?1:0,u_icon_step:fe,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:St,u_borderColor:Oa(Yt),u_linearDir:di===Hv.VERTICAL?1:0,u_linearColor:vu,u_sourceColor:jf,u_targetColor:J0,u_heightfixed:Number(on),u_vertexScale:Be,u_raisingHeight:Number(Rr),u_arrow:Number(js.enable),u_arrowHeight:js.arrowHeight||3,u_arrowWidth:js.arrowWidth||2,u_tailWidth:js.tailWidth===void 0?1:js.tailWidth}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w,M,k,D,N,V,q,fe,he,Be;return se().wrap(function(St){for(;;)switch(St.prev=St.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,w=u.depth,M=w===void 0?!1:w,k=u.workerEnabled,D=k===void 0?!1:k,N=u.enablePicking,V=this.getShaders(),q=V.frag,fe=V.vert,he=V.type,this.layer.triangulation=va,St.next=5,this.layer.buildLayerModel({moduleName:"line"+he,vertexShader:fe,fragmentShader:q,triangulation:va,depth:{enable:M},blend:this.getBlend(),stencil:Uo(p,E),workerEnabled:D,workerOptions:{modelType:"line"+he,enablePicking:N,iconMap:this.iconService.getIconMap()}});case 5:return Be=St.sent,St.abrupt("return",[Be]);case 7:case"end":return St.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor,l=r.lineType;return l==="dash"?{frag:FT,vert:DT,type:"Dash"}:o&&u?{frag:NT,vert:_x,type:"Linear"}:{frag:BT,vert:_x,type:""}}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:ri.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(u,l,p,v,E,w){return w===void 0?[p[3],10]:[p[3],w]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:ri.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(u,l,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ri.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(u,l,p,v,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:ri.Attribute,descriptor:{name:"a_Miter",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(u,l,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ri.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(u){var l=r.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},E=v.x,w=v.y;return[E,w]}}})}}]),t}(os);function ZT(e){var i=UT();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function UT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VT=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  gl_FragColor = texture2D(u_texture, vec2(linearRadio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,GT=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,jT=function(e){(0,Fr.Z)(t,e);var i=ZT(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var p=n.layer.getLayerConfig(),v=p.rampColors,E=Gl(v);n.colorTexture=l({data:new Uint8Array(E.data),width:E.width,height:E.height,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE,min:ee.NEAREST,mag:ee.NEAREST,flipY:!1})}),n}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.vertexHeightScale,p=l===void 0?20:l,v=r.raisingHeight,E=v===void 0?0:v,w=r.heightfixed,M=w===void 0?!1:w,k=r.linearDir,D=k===void 0?Hv.VERTICAL:k;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var N=this.layer.getEncodedData(),V=this.calDataFrame(this.cellLength,N,this.cellProperties),q=V.data,fe=V.width,he=V.height;this.rowCount=he,this.dataTexture=this.cellLength>0&&q.length>0?this.createTexture2D({flipY:!0,data:q,format:ee.LUMINANCE,type:ee.FLOAT,width:fe,height:he}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_linearDir:D===Hv.VERTICAL?1:0,u_opacity:(0,f.isNumber)(u)?u:1,u_texture:this.colorTexture,u_heightfixed:Number(M),u_vertexScale:p,u_raisingHeight:Number(E)}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.colorTexture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w,M,k;return se().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,w=u.depth,M=w===void 0?!1:w,this.layer.triangulation=C0,N.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:GT,fragmentShader:VT,triangulation:C0,depth:{enable:M},blend:this.getBlend(),stencil:Uo(p,E)});case 4:return k=N.sent,N.abrupt("return",[k]);case 6:case"end":return N.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:ri.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(o,u,l,p,v,E){return E===void 0?[l[3],10]:[l[3],E]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:ri.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(o,u,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ri.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:ri.Attribute,descriptor:{name:"a_Miter",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(o,u,l){return[l[4]]}}})}}]),t}(os);function HT(e){var i=WT();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function WT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XT=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,$T=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];

  // styleMappingMat[3][0] \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = mix(u_sourceColor, u_targetColor, styleMappingMat[3][0]);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,bx=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  v_color = a_Color; 
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,YT=function(e){(0,Fr.Z)(t,e);var i=HT(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.sourceColor,p=r.targetColor,v=r.vertexHeightScale,E=v===void 0?20:v,w=0,M=[0,0,0,0],k=[0,0,0,0];if(l&&p&&(M=Oa(l),k=Oa(p),w=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var D=this.layer.getEncodedData(),N=this.calDataFrame(this.cellLength,D,this.cellProperties),V=N.data,q=N.width,fe=N.height;this.rowCount=fe,this.dataTexture=this.cellLength>0&&V.length>0?this.createTexture2D({flipY:!0,data:V,format:ee.LUMINANCE,type:ee.FLOAT,width:q,height:fe}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,f.isNumber)(u)?u:1,u_linearColor:w,u_sourceColor:M,u_targetColor:k,u_vertexScale:E}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:$T,vert:bx,type:"lineSimpleLinear"}:{frag:XT,vert:bx,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w,M,k,D,N;return se().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,w=this.getShaders(),M=w.frag,k=w.vert,D=w.type,q.next=4,this.layer.buildLayerModel({moduleName:D,vertexShader:k,fragmentShader:M,triangulation:YC,primitive:ee.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:Uo(p,E),pick:!1});case 4:return N=q.sent,q.abrupt("return",[N]);case 6:case"end":return q.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:ri.Attribute,descriptor:{name:"a_Distance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(o,u,l){return[l[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:ri.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(o,u,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}})}}]),t}(os);function qT(e){var i=KT();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function KT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QT=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,JT=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,e5=function(e){(0,Fr.Z)(t,e);var i=qT(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:ee.NEAREST,min:ee.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.sourceColor,p=r.targetColor,v=r.textureBlend,E=v===void 0?"normal":v,w=r.heightfixed,M=w===void 0?!1:w,k=r.lineTexture,D=k===void 0?!1:k,N=r.iconStep,V=N===void 0?100:N,q=r.iconStepCount,fe=q===void 0?1:q;this.rendererService.getDirty()&&this.texture.bind();var he=0,Be=[0,0,0,0],Ge=[0,0,0,0];return l&&p&&(Be=Oa(l),Ge=Oa(p),he=1),{u_heightfixed:Number(M),u_opacity:(0,f.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,u_texture:this.texture,u_line_texture:D?1:0,u_iconStepCount:fe,u_icon_step:V,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:he,u_sourceColor:Be,u_targetColor:Ge}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.texture)===null||r===void 0||r.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:JT,fragmentShader:QT,triangulation:C0,depth:{enable:!1},blend:this.getBlend()});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:ri.Attribute,descriptor:{name:"a_Distance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(u,l,p){return[p[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:ri.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(u,l,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ri.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(u,l,p,v,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:ri.Attribute,descriptor:{name:"a_Miter",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(u,l,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ri.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(u){var l=r.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},E=v.x,w=v.y;return[E,w]}}})}}]),t}(os),t5={arc:aT,arc3d:pT,greatcircle:TT,wall:e5,line:xx,halfLine:RT,simple:YT,linearline:jT,earthArc3d:bT},r5=t5;function n5(e){var i=i5();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function i5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hy=function(e){(0,Fr.Z)(t,e);var i=n5(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"type","LineLayer"),(0,J.Z)((0,Ke.Z)(n),"arrowInsertCount",0),(0,J.Z)((0,Ke.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,tr.Z)(t,[{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new r5[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},halfLine:{},earthArc3d:{}};return o[r]}},{key:"getModelType",value:function(){var r;if(this.layerType)return this.layerType;var o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(r=o.scale)===null||r===void 0?void 0:r.field;return u||"line"}},{key:"processData",value:function(r){if(this.getModelType()!=="simple")return r;var o=[];return r.map(function(u){if(Array.isArray(u.coordinates)&&Array.isArray(u.coordinates[0])&&Array.isArray(u.coordinates[0][0])){var l=(0,U.Z)({},u);u.coordinates.map(function(p){o.push((0,U.Z)((0,U.Z)({},l),{},{coordinates:p}))})}else o.push(u)}),o}}]),t}(Od);function a5(e){var i=o5();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function o5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var s5=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,u5=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,l5=function(e){(0,Fr.Z)(t,e);var i=a5(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"raiseCount",0),(0,J.Z)((0,Ke.Z)(n),"raiseRepeat",0),n}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,l=r.opacity,p=l===void 0?1:l,v=r.sourceColor,E=r.targetColor,w=r.pickLight,M=w===void 0?!1:w,k=r.heightfixed,D=k===void 0?!1:k,N=r.opacityLinear,V=N===void 0?{enable:!1,dir:"up"}:N,q=r.lightEnable,fe=q===void 0?!0:q;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var he=this.layer.getEncodedData(),Be=this.calDataFrame(this.cellLength,he,this.cellProperties),Ge=Be.data,St=Be.width,Ut=Be.height;this.rowCount=Ut,this.dataTexture=this.cellLength>0&&Ge.length>0?this.createTexture2D({flipY:!0,data:Ge,format:ee.LUMINANCE,type:ee.FLOAT,width:St,height:Ut}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}var Yt=0,nr=[0,0,0,0],Rr=[0,0,0,0];if(v&&E&&(nr=Oa(v),Rr=Oa(E),Yt=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var Tr=u.speed,on=Tr===void 0?.01:Tr;this.raiseCount+=on,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(M),u_heightfixed:Number(D),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,f.isNumber)(p)?p:1,u_linearColor:Yt,u_sourceColor:nr,u_targetColor:Rr,u_opacitylinear:Number(V.enable),u_opacitylinear_dir:V.dir==="up"?1:0,u_lightEnable:Number(fe)}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v;return se().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return u=this.layer.getLayerConfig(),l=u.animateOption.repeat,p=l===void 0?1:l,this.raiseRepeat=p,w.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:u5,fragmentShader:s5,triangulation:ly,depth:{enable:!0},cull:{enable:!0,face:Lf(this.mapService.version)},blend:this.getBlend()});case 4:return v=w.sent,w.abrupt("return",[v]);case 6:case"end":return w.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(o){var u=o.size;if(u){var l=[];return Array.isArray(u)&&(l=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(l=[u,u,u]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ri.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:ri.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(o){var u=gl(o.coordinates);return tx([u[0],u[1]])}}})}}]),t}(os);function c5(e){var i=f5();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function f5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h5=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,p5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);

  setPickingColor(a_PickingColor);
}
`,d5=function(e){(0,Fr.Z)(t,e);var i=c5(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.strokeOpacity,p=l===void 0?1:l,v=r.strokeWidth,E=v===void 0?0:v,w=r.stroke,M=w===void 0?"rgba(0,0,0,0)":w,k=r.offsets,D=k===void 0?[0,0]:k,N=r.blend,V=r.blur,q=V===void 0?0:V;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:p,strokeWidth:E,stroke:M,offsets:D})){this.judgeStyleAttributes({opacity:u,strokeOpacity:p,strokeWidth:E,stroke:M,offsets:D});var fe=this.layer.getEncodedData(),he=this.calDataFrame(this.cellLength,fe,this.cellProperties),Be=he.data,Ge=he.width,St=he.height;this.rowCount=St,this.dataTexture=this.cellLength>0&&Be.length>0?this.createTexture2D({flipY:!0,data:Be,format:ee.LUMINANCE,type:ee.FLOAT,width:Ge,height:St}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_blur:q,u_additive:N==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,f.isNumber)(u)?u:1,u_stroke_opacity:(0,f.isNumber)(p)?p:1,u_stroke_width:(0,f.isNumber)(E)?E:1,u_stroke_color:this.getStrokeColor(M),u_offsets:this.isOffsetStatic(D)?D:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=ux,p.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:p5,fragmentShader:h5,triangulation:ux,depth:{enable:!0},blend:this.getBlend()});case 3:return u=p.sent,p.abrupt("return",[u]);case 5:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:ri.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(u,l,p,v){var E=(0,Ti.Z)(p,3),w=E[0],M=E[1],k=E[2],D=ss.fromValues(0,0,1),N=ss.fromValues(w,0,k),V=w>=0?ss.angle(D,N):Math.PI*2-ss.angle(D,N),q=Math.PI*2-Math.asin(M/100),fe=_o();ja(fe,fe,V),po(fe,fe,q);var he=ss.fromValues(1,1,0);ss.transformMat4(he,he,fe),ss.normalize(he,he);var Be=ss.fromValues(-1,1,0);ss.transformMat4(Be,Be,fe),ss.normalize(Be,Be);var Ge=ss.fromValues(-1,-1,0);ss.transformMat4(Ge,Ge,fe),ss.normalize(Ge,Ge);var St=ss.fromValues(1,-1,0);ss.transformMat4(St,St,fe),ss.normalize(St,St);var Ut=[].concat((0,H.Z)(he),(0,H.Z)(Be),(0,H.Z)(Ge),(0,H.Z)(St)),Yt=v%4*3;return[Ut[Yt],Ut[Yt+1],Ut[Yt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:ri.Attribute,descriptor:{name:"a_Shape",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(u){var l=u.shape,p=l===void 0?2:l,v=r.layer.getLayerConfig().shape2d,E=v.indexOf(p);return[E]}}})}}]),t}(os);function v5(e){var i=m5();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function m5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var g5=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,y5=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }

  setPickingColor(a_PickingColor);
}
`,Ex=function(e){(0,Fr.Z)(t,e);var i=v5(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"raiseCount",0),(0,J.Z)((0,Ke.Z)(n),"raiseRepeat",0),n}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,l=r.opacity,p=l===void 0?1:l,v=r.sourceColor,E=r.targetColor,w=r.pickLight,M=w===void 0?!1:w,k=r.heightfixed,D=k===void 0?!1:k,N=r.opacityLinear,V=N===void 0?{enable:!1,dir:"up"}:N,q=r.lightEnable,fe=q===void 0?!0:q;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var he=this.layer.getEncodedData(),Be=this.calDataFrame(this.cellLength,he,this.cellProperties),Ge=Be.data,St=Be.width,Ut=Be.height;this.rowCount=Ut,this.dataTexture=this.cellLength>0&&Ge.length>0?this.createTexture2D({flipY:!0,data:Ge,format:ee.LUMINANCE,type:ee.FLOAT,width:St,height:Ut}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}var Yt=0,nr=[0,0,0,0],Rr=[0,0,0,0];if(v&&E&&(nr=Oa(v),Rr=Oa(E),Yt=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var Tr=u.speed,on=Tr===void 0?.01:Tr;this.raiseCount+=on,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(M),u_heightfixed:Number(D),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,f.isNumber)(p)?p:1,u_linearColor:Yt,u_sourceColor:nr,u_targetColor:Rr,u_opacitylinear:Number(V.enable),u_opacitylinear_dir:V.dir==="up"?1:0,u_lightEnable:Number(fe)}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w;return se().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=this.layer.getLayerConfig(),l=u.depth,p=l===void 0?!0:l,v=u.animateOption.repeat,E=v===void 0?1:v,this.raiseRepeat=E,k.next=4,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:y5,fragmentShader:g5,triangulation:ly,blend:this.getBlend(),cull:{enable:!0,face:Lf(this.mapService.version)},depth:{enable:p}});case 4:return w=k.sent,k.abrupt("return",[w]);case 6:case"end":return k.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(o){var u=o.size;if(u){var l=[];return Array.isArray(u)&&(l=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(l=[u,u,u]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ri.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:ri.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(o){var u=gl(o.coordinates);return[u[0],u[1],0]}}})}}]),t}(os);function _5(e){var i=x5();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function x5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sx=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,b5=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,py=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform int u_Size_Unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;
if(u_Size_Unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_raisingHeight;

  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }
 

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position =  u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Ax=function(e){(0,Fr.Z)(t,e);var i=_5(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.strokeOpacity,p=l===void 0?1:l,v=r.strokeWidth,E=v===void 0?0:v,w=r.stroke,M=w===void 0?"rgba(0,0,0,0)":w,k=r.offsets,D=k===void 0?[0,0]:k,N=r.blend,V=r.blur,q=V===void 0?0:V,fe=r.raisingHeight,he=fe===void 0?0:fe,Be=r.heightfixed,Ge=Be===void 0?!1:Be,St=r.unit,Ut=St===void 0?"pixel":St;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:p,strokeWidth:E,stroke:M,offsets:D})){this.judgeStyleAttributes({opacity:u,strokeOpacity:p,strokeWidth:E,stroke:M,offsets:D});var Yt=this.layer.getEncodedData(),nr=this.calDataFrame(this.cellLength,Yt,this.cellProperties),Rr=nr.data,Tr=nr.width,on=nr.height;this.rowCount=on,this.dataTexture=this.cellLength>0&&Rr.length>0?this.createTexture2D({flipY:!0,data:Rr,format:ee.LUMINANCE,type:ee.FLOAT,width:Tr,height:on}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(he),u_heightfixed:Number(Ge),u_blur:q,u_additive:N==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,f.isNumber)(u)?u:1,u_stroke_opacity:(0,f.isNumber)(p)?p:1,u_stroke_width:(0,f.isNumber)(E)?E:1,u_stroke_color:this.getStrokeColor(M),u_Size_Unit:T0[Ut],u_offsets:this.isOffsetStatic(D)?D:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ga)}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w,M,k,D,N,V,q,fe,he,Be,Ge;return se().wrap(function(Ut){for(;;)switch(Ut.prev=Ut.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,w=u.animateOption,M=w===void 0?{enable:!1}:w,k=u.workerEnabled,D=k===void 0?!1:k,N=u.enablePicking,V=u.shape2d,q=this.getShaders(M),fe=q.frag,he=q.vert,Be=q.type,this.layer.triangulation=Ga,Ut.next=5,this.layer.buildLayerModel({moduleName:Be,vertexShader:he,fragmentShader:fe,triangulation:Ga,depth:{enable:!1},blend:this.getBlend(),stencil:Uo(p,E),workerEnabled:D,workerOptions:{modelType:Be,enablePicking:N,shape2d:V}});case 5:return Ge=Ut.sent,Ut.abrupt("return",[Ge]);case 7:case"end":return Ut.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getShaders",value:function(r){if(r.enable)switch(r.type){case"wave":return{frag:Sx,vert:py,type:"pointWave"};default:return{frag:Sx,vert:py,type:"pointWave"}}else return{frag:b5,vert:py,type:"pointFill"}}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:ri.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(u,l,p,v){var E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],w=v%4*3;return[E[w],E[w+1],E[w+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:ri.Attribute,descriptor:{name:"a_Shape",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(u){var l=u.shape,p=l===void 0?2:l,v=r.indexOf(p);return[v]}}})}}]),t}(os);function E5(e){var i=S5();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function S5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w5=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,A5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform int u_Size_Unit;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float newSize = a_Size;
  if(u_Size_Unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (newSize) + textrueOffsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp *vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,C5=function(e){(0,Fr.Z)(t,e);var i=E5(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"meter2coord",1),(0,J.Z)((0,Ke.Z)(n),"isMeter",!1),(0,J.Z)((0,Ke.Z)(n),"radian",0),(0,J.Z)((0,Ke.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:ee.LINEAR,min:ee.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.offsets,p=l===void 0?[0,0]:l,v=r.rotation,E=r.raisingHeight,w=E===void 0?0:E,M=r.heightfixed,k=M===void 0?!1:M,D=r.unit,N=D===void 0?"pixel":D;this.rendererService.getDirty()&&this.texture.bind();var V=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(V=-1),this.radian=v!==void 0?V*Math.PI*v/180:V*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var q=this.layer.getEncodedData(),fe=this.calDataFrame(this.cellLength,q,this.cellProperties),he=fe.data,Be=fe.width,Ge=fe.height;this.rowCount=Ge,this.dataTexture=this.cellLength>0&&he.length>0?this.createTexture2D({flipY:!0,data:he,format:ee.LUMINANCE,type:ee.FLOAT,width:Be,height:Ge}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(w),u_heightfixed:Number(k),u_Size_Unit:T0[N],u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,f.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Nm)}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w;return se().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,k.next=3,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:A5,fragmentShader:w5,triangulation:Nm,depth:{enable:!1},blend:this.getBlend(),stencil:Uo(p,E),cull:{enable:!0,face:Lf(this.mapService.version)}});case 3:return w=k.sent,k.abrupt("return",[w]);case 5:case"end":return k.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;this.iconService.off("imageUpdate",this.updateTexture),(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:ri.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(u){var l=u.rotate,p=l===void 0?0:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ri.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(u){var l=r.iconService.getIconMap(),p=u.shape,v=l[p]||{x:-64,y:-64},E=v.x,w=v.y;return[E,w]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:ri.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(u,l,p,v){var E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],w=v%4*3;return[E[w],E[w+1],E[w+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}})}}]),t}(os);function T5(e){var i=M5();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function M5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var I5=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,k5=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(textrueOffsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,Cx=function(e){(0,Fr.Z)(t,e);var i=T5(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=l({data:n.iconService.getCanvas(),mag:ee.LINEAR,min:ee.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.offsets,p=l===void 0?[0,0]:l,v=r.raisingHeight,E=v===void 0?0:v,w=r.heightfixed,M=w===void 0?!1:w;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var k=this.layer.getEncodedData(),D=this.calDataFrame(this.cellLength,k,this.cellProperties),N=D.data,V=D.width,q=D.height;this.rowCount=q,this.dataTexture=this.cellLength>0&&N.length>0?this.createTexture2D({flipY:!0,data:N,format:ee.LUMINANCE,type:ee.FLOAT,width:V,height:q}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(E),u_heightfixed:Number(M),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,f.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0]}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w;return se().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,k.next=3,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:k5,fragmentShader:I5,triangulation:$C,depth:{enable:!1},primitive:ee.POINTS,blend:this.getBlend(),stencil:Uo(p,E)});case 3:return w=k.sent,k.abrupt("return",[w]);case 5:case"end":return k.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ri.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(u){var l=r.iconService.getIconMap(),p=u.shape,v=l[p]||{x:-64,y:-64},E=v.x,w=v.y;return[E,w]}}})}}]),t}(os);function P5(e){var i=R5();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function R5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var L5=`uniform float u_opacity : 1;
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
}
`,O5=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;

varying vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
}
`;function Tx(e){var i=e.coordinates;return{vertices:(0,H.Z)(i),indices:[0],size:i.length}}var Mx=function(e){(0,Fr.Z)(t,e);var i=P5(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o;return{u_opacity:(0,f.isNumber)(u)?u:1}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w;return se().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,this.layer.triangulation=Tx,k.next=4,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:O5,fragmentShader:L5,triangulation:Tx,depth:{enable:!1},primitive:ee.POINTS,blend:this.getBlend(),stencil:Uo(p,E),pick:!1});case 4:return w=k.sent,k.abrupt("return",[w]);case 6:case"end":return k.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(os);function F5(e){var i=D5();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function D5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var B5=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,N5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform int u_Size_Unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;



  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_Size_Unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  // radius(16-bit)
  v_radius = newSize;

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
  offset = project_pixel(offset);
  
  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp *vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,z5=function(e){(0,Fr.Z)(t,e);var i=F5(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.blend,p=r.speed,v=p===void 0?1:p,E=r.unit,w=E===void 0?"pixel":E;return{u_Size_Unit:T0[w],u_speed:v,u_additive:l==="additive"?1:0,u_opacity:(0,f.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Nm)}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w;return se().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,k.next=3,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:N5,fragmentShader:B5,triangulation:Nm,depth:{enable:!1},blend:this.getBlend(),stencil:Uo(p,E)});case 3:return w=k.sent,k.abrupt("return",[w]);case 5:case"end":return k.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:ri.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(o,u,l,p){var v=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],E=p%4*3;return[v[E],v[E+1],v[E+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?5:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(os);function Z5(e){var i=U5();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function U5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V5=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,G5=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Ix(e){var i=e.coordinates;return{vertices:(0,H.Z)(i),indices:[0],size:i.length}}var j5=function(e){(0,Fr.Z)(t,e);var i=Z5(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.offsets,p=l===void 0?[0,0]:l,v=r.blend,E=r.strokeOpacity,w=E===void 0?1:E,M=r.strokeWidth,k=M===void 0?0:M,D=r.stroke,N=D===void 0?"#fff":D;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var V=this.layer.getEncodedData(),q=this.calDataFrame(this.cellLength,V,this.cellProperties),fe=q.data,he=q.width,Be=q.height;this.rowCount=Be,this.dataTexture=this.cellLength>0&&fe.length>0?this.createTexture2D({flipY:!0,data:fe,format:ee.LUMINANCE,type:ee.FLOAT,width:he,height:Be}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_additive:v==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,f.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0],u_stroke_opacity:(0,f.isNumber)(w)?w:1,u_stroke_width:(0,f.isNumber)(k)?k:1,u_stroke_color:this.getStrokeColor(N)}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w;return se().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,this.layer.triangulation=Ix,k.next=4,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:G5,fragmentShader:V5,triangulation:Ix,depth:{enable:!1},primitive:ee.POINTS,blend:this.getBlend(),stencil:Uo(p,E)});case 4:return w=k.sent,k.abrupt("return",[w]);case 6:case"end":return k.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(os);function H5(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=W5(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function W5(e,i){if(!!e){if(typeof e=="string")return kx(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return kx(e,i)}}function kx(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}var X5=function(){function e(i,t,n){(0,Ht.Z)(this,e),(0,J.Z)(this,"boxCells",[]);var r=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(t/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=t,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/t,this.boxUid=0}return(0,tr.Z)(e,[{key:"insert",value:function(t,n,r,o,u){this.forEachCell(n,r,o,u,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(u)}},{key:"query",value:function(t,n,r,o,u){return this.queryHitTest(t,n,r,o,!1,u)}},{key:"hitTest",value:function(t,n,r,o,u){return this.queryHitTest(t,n,r,o,!0,u)}},{key:"insertBoxCell",value:function(t,n,r,o,u,l){this.boxCells[u].push(l)}},{key:"queryHitTest",value:function(t,n,r,o,u,l){if(r<0||t>this.width||o<0||n>this.height)return u?!1:[];var p=[];if(t<=0&&n<=0&&this.width<=r&&this.height<=o){if(u)return!0;for(var v=0;v<this.boxKeys.length;v++)p.push({key:this.boxKeys[v],x1:this.bboxes[v*4],y1:this.bboxes[v*4+1],x2:this.bboxes[v*4+2],y2:this.bboxes[v*4+3]});return l?p.filter(l):p}var E={hitTest:u,seenUids:{box:{},circle:{}}};return this.forEachCell(t,n,r,o,this.queryCell,p,E,l),u?p.length>0:p}},{key:"queryCell",value:function(t,n,r,o,u,l,p,v){var E=p.seenUids,w=this.boxCells[u];if(w!==null){var M=this.bboxes,k=H5(w),D;try{for(k.s();!(D=k.n()).done;){var N=D.value;if(!E.box[N]){E.box[N]=!0;var V=N*4;if(t<=M[V+2]&&n<=M[V+3]&&r>=M[V+0]&&o>=M[V+1]&&(!v||v(this.boxKeys[N]))){if(p.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[N],x1:M[V],y1:M[V+1],x2:M[V+2],y2:M[V+3]})}}}}catch(q){k.e(q)}finally{k.f()}}return!1}},{key:"forEachCell",value:function(t,n,r,o,u,l,p,v){for(var E=this.convertToXCellCoord(t),w=this.convertToYCellCoord(n),M=this.convertToXCellCoord(r),k=this.convertToYCellCoord(o),D=E;D<=M;D++)for(var N=w;N<=k;N++){var V=this.xCellCount*N+D;if(u.call(this,t,n,r,o,V,l,p,v))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}(),$5=X5,Y5=function(){function e(i,t){(0,Ht.Z)(this,e),(0,J.Z)(this,"viewportPadding",100),this.width=i,this.height=t,this.viewportPadding=Math.max(i,t),this.grid=new $5(i+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return(0,tr.Z)(e,[{key:"placeCollisionBox",value:function(t){var n=t.x1+t.anchorPointX+this.viewportPadding,r=t.y1+t.anchorPointY+this.viewportPadding,o=t.x2+t.anchorPointX+this.viewportPadding,u=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,r,o,u)||this.grid.hitTest(n,r,o,u)?{box:[]}:{box:[n,r,o,u]}}},{key:"insertCollisionBox",value:function(t,n){var r={featureIndex:n};this.grid.insert(r,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,n,r){var o=gv(n,r,0,1),u=rd(),l=Qo.apply(Oe,(0,H.Z)(t));return kd(u,o,l),{x:(u[0]/u[3]+1)/2*this.width+this.viewportPadding,y:(-u[1]/u[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,n,r,o){return r>=0&&t<this.gridRightBoundary&&o>=0&&n<this.gridBottomBoundary}}]),e}();function Px(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=q5(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function q5(e,i){if(!!e){if(typeof e=="string")return Rx(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Rx(e,i)}}function Rx(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function Lx(e){var i=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:i,verticalAlign:t}}function Ox(e,i,t,n,r){if(!!r){var o=e[n],u=o.glyph;if(u)for(var l=i[u].advance*o.scale,p=(e[n].x+l)*r,v=t;v<=n;v++)e[v].x-=p}}function Fx(e,i,t,n,r,o,u){var l=(i-t)*r,p=(-n*u+.5)*o,v=Px(e),E;try{for(v.s();!(E=v.n()).done;){var w=E.value;w.x+=l,w.y+=p}}catch(M){v.e(M)}finally{v.f()}}function K5(e,i,t,n,r,o,u){var l=-8,p=0,v=l,E=0,w=e.positionedGlyphs,M=o==="right"?1:o==="left"?0:.5,k=w.length;t.forEach(function(fe){if(fe.split("").forEach(function(Be){var Ge=i[Be],St=0;Ge&&(w.push({glyph:Be,x:p,y:v+St,vertical:!1,scale:1,metrics:Ge}),p+=Ge.advance+u)}),w.length!==k){var he=p-u;E=Math.max(he,E),Ox(w,i,k,w.length-1,M)}p=0,v-=n+5});var D=Lx(r),N=D.horizontalAlign,V=D.verticalAlign;Fx(w,M,N,V,E,n,t.length);var q=v-l;e.top+=-V*q,e.bottom=e.top-q,e.left+=-N*E,e.right=e.left+E}function Q5(e,i,t,n,r,o,u){var l=-8,p=0,v=l,E=0,w=e.positionedGlyphs,M=o==="right"?1:o==="left"?0:.5,k=w.length;t.forEach(function(fe){var he=i[fe],Be=0;if(he&&(w.push({glyph:fe,x:he.advance/2,y:v+Be,vertical:!1,scale:1,metrics:he}),p+=he.advance+u),w.length!==k){var Ge=p-u;E=Math.max(Ge,E),Ox(w,i,k,w.length-1,M)}p=0,v-=n+5});var D=Lx(r),N=D.horizontalAlign,V=D.verticalAlign;Fx(w,M,N,V,E,n,t.length);var q=v-l;e.top+=-V*q,e.bottom=e.top-q,e.left+=-N*E,e.right=e.left+E}function J5(e,i,t,n,r,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],l=arguments.length>7?arguments[7]:void 0,p=e.split(`
`),v=[],E={positionedGlyphs:v,top:u[1],bottom:u[1],left:u[0],right:u[0],lineCount:p.length,text:e};return l?Q5(E,i,p,t,n,r,o):K5(E,i,p,t,n,r,o),v.length?E:!1}function eM(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,r=n===void 0?[]:n,o=[],u=Px(r),l;try{for(u.s();!(l=u.n()).done;){var p=l.value,v=p.metrics,E=4,w=v.advance*p.scale/2,M=t?[p.x+w,p.y]:[0,0],k=t?[0,0]:[p.x+w+i[0],p.y+i[1]],D=(0-E)*p.scale-w+k[0],N=(0-E)*p.scale+k[1],V=D+v.width*p.scale,q=N+v.height*p.scale,fe={x:D,y:N},he={x:V,y:N},Be={x:D,y:q},Ge={x:V,y:q};o.push({tl:fe,tr:he,bl:Be,br:Ge,tex:v,glyphOffset:M})}}catch(St){u.e(St)}finally{u.f()}return o}function tM(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=rM(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function rM(e,i){if(!!e){if(typeof e=="string")return Dx(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Dx(e,i)}}function Dx(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function nM(e){var i=iM();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function iM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bx=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Nx=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp *(vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function zx(e){var i=this,t=e.id,n=[],r=[];if(!i.glyphInfoMap||!i.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var o=i.glyphInfoMap[t].centroid,u=o.length===2?[o[0],o[1],0]:o;return i.glyphInfoMap[t].glyphQuads.forEach(function(l,p){n.push.apply(n,(0,H.Z)(u).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],(0,H.Z)(u),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],(0,H.Z)(u),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],(0,H.Z)(u),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),r.push(0+p*4,1+p*4,2+p*4,2+p*4,3+p*4,0+p*4)}),{vertices:n,indices:r,size:7}}var Zx=function(e){(0,Fr.Z)(t,e);var i=nM(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"glyphInfoMap",{}),(0,J.Z)((0,Ke.Z)(n),"currentZoom",-1),(0,J.Z)((0,Ke.Z)(n),"textureHeight",0),(0,J.Z)((0,Ke.Z)(n),"textCount",0),(0,J.Z)((0,Ke.Z)(n),"preTextStyle",{}),(0,J.Z)((0,Ke.Z)(n),"mapping",(0,ot.Z)(se().mark(function l(){return se().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n.initGlyph(),n.updateTexture(),v.next=4,n.reBuildModel();case 4:case"end":return v.stop()}},l)}))),n}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.stroke,p=l===void 0?"#fff":l,v=r.strokeWidth,E=v===void 0?0:v,w=r.halo,M=w===void 0?.5:w,k=r.gamma,D=k===void 0?2:k,N=r.raisingHeight,V=N===void 0?0:N,q=this.fontService,fe=q.canvas,he=q.mapping;if(he&&Object.keys(he).length!==this.textCount&&fe&&(this.updateTexture(),this.textCount=Object.keys(he).length),this.preTextStyle=this.getTextStyle(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeWidth:E,stroke:p})){this.judgeStyleAttributes({opacity:u,strokeWidth:E,stroke:p});var Be=this.layer.getEncodedData(),Ge=this.calDataFrame(this.cellLength,Be,this.cellProperties),St=Ge.data,Ut=Ge.width,Yt=Ge.height;this.rowCount=Yt,this.dataTexture=this.cellLength>0&&St.length>0?this.createTexture2D({flipY:!0,data:St,format:ee.LUMINANCE,type:ee.FLOAT,width:Ut,height:Yt}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(V),u_opacity:(0,f.isNumber)(u)?u:1,u_stroke_width:(0,f.isNumber)(E)?E:1,u_stroke_color:this.getStrokeColor(p),u_sdf_map:this.texture,u_halo_blur:M,u_gamma_scale:D,u_sdf_map_size:[(fe==null?void 0:fe.width)||1,(fe==null?void 0:fe.height)||1]}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.preTextStyle=this.getTextStyle(),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w,M,k;return se().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,w=u.textAllowOverlap,M=w===void 0?!1:w,this.initGlyph(),this.updateTexture(),M||this.filterGlyphs(),N.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Nx,fragmentShader:Bx,triangulation:zx.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Uo(p,E)});case 6:return k=N.sent,N.abrupt("return",[k]);case 8:case"end":return N.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"needUpdate",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w,M,k,D,N,V,q;return se().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:if(u=this.getTextStyle(),l=u.textAllowOverlap,p=l===void 0?!1:l,v=u.textAnchor,E=v===void 0?"center":v,w=u.textOffset,M=u.padding,k=u.fontFamily,D=u.fontWeight,!(!(0,f.isEqual)(M,this.preTextStyle.padding)||!(0,f.isEqual)(w,this.preTextStyle.textOffset)||!(0,f.isEqual)(E,this.preTextStyle.textAnchor)||!(0,f.isEqual)(k,this.preTextStyle.fontFamily)||!(0,f.isEqual)(D,this.preTextStyle.fontWeight))){he.next=5;break}return he.next=4,this.mapping();case 4:return he.abrupt("return",!0);case 5:if(!p){he.next=7;break}return he.abrupt("return",!1);case 7:if(N=this.mapService.getZoom(),V=this.mapService.getBounds(),q=ml(this.extent,V),!(Math.abs(this.currentZoom-N)>.5||!q||p!==this.preTextStyle.textAllowOverlap)){he.next=14;break}return he.next=13,this.reBuildModel();case 13:return he.abrupt("return",!0);case 14:return he.abrupt("return",!1);case 15:case"end":return he.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:ri.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(o){var u=o.rotate,l=u===void 0?0:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:ri.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(o,u,l){return[l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?12:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:ri.Attribute,descriptor:{name:"a_tex",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var r=this.mapService.getBounds();return Ol(r,.5)}},{key:"initTextFont",value:function(){var r=this.getTextStyle(),o=r.fontWeight,u=r.fontFamily,l=this.layer.getEncodedData(),p=[];l.forEach(function(v){var E=v.shape,w=E===void 0?"":E;w=w.toString();var M=tM(w),k;try{for(M.s();!(k=M.n()).done;){var D=k.value;p.indexOf(D)===-1&&p.push(D)}}catch(N){M.e(N)}finally{M.f()}}),this.fontService.setFontOptions({characterSet:p,fontWeight:o,fontFamily:u,iconfont:!1})}},{key:"initIconFontTex",value:function(){var r=this.getTextStyle(),o=r.fontWeight,u=r.fontFamily,l=this.layer.getEncodedData(),p=[];l.forEach(function(v){var E=v.shape,w=E===void 0?"":E;w="".concat(w),p.indexOf(w)===-1&&p.push(w)}),this.fontService.setFontOptions({characterSet:p,fontWeight:o,fontFamily:u,iconfont:!0})}},{key:"getTextStyle",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,l=r.fontFamily,p=l===void 0?"sans-serif":l,v=r.textAllowOverlap,E=v===void 0?!1:v,w=r.padding,M=w===void 0?[0,0]:w,k=r.textAnchor,D=k===void 0?"center":k,N=r.textOffset,V=N===void 0?[0,0]:N,q=r.opacity,fe=q===void 0?1:q,he=r.strokeOpacity,Be=he===void 0?1:he,Ge=r.strokeWidth,St=Ge===void 0?0:Ge,Ut=r.stroke,Yt=Ut===void 0?"#000":Ut;return{fontWeight:u,fontFamily:p,textAllowOverlap:E,padding:M,textAnchor:D,textOffset:V,opacity:fe,strokeOpacity:Be,strokeWidth:St,stroke:Yt}}},{key:"generateGlyphLayout",value:function(r){var o=this,u=this.fontService.mapping,l=this.layer.getLayerConfig(),p=l.spacing,v=p===void 0?2:p,E=l.textAnchor,w=E===void 0?"center":E,M=l.textOffset,k=this.layer.getEncodedData();this.glyphInfo=k.map(function(D){var N=D.shape,V=N===void 0?"":N,q=D.id,fe=D.size,he=fe===void 0?1:fe,Be=J5(V.toString(),u,he,w,"left",v,M||D.textOffset||[0,0],r),Ge=eM(Be,M,!1);return D.shaping=Be,D.glyphQuads=Ge,D.centroid=gl(D.coordinates),D.originCentroid=D.version==="GAODE2.x"?gl(D.originCoordinates):D.originCentroid=D.centroid,o.glyphInfoMap[q]={shaping:Be,glyphQuads:Ge,centroid:gl(D.coordinates)},D})}},{key:"filterGlyphs",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.padding,l=u===void 0?[0,0]:u,p=o.textAllowOverlap,v=p===void 0?!1:p;if(!v){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var E=this.rendererService.getViewportSize(),w=E.width,M=E.height,k=new Y5(w,M),D=this.glyphInfo.filter(function(N){var V=N.shaping,q=N.id,fe=q===void 0?0:q,he=N.version==="GAODE2.x"?N.originCentroid:N.centroid,Be=N.size,Ge=Be/16,St=r.mapService.lngLatToContainer(he),Ut=k.placeCollisionBox({x1:V.left*Ge-l[0],x2:V.right*Ge+l[0],y1:V.top*Ge-l[1],y2:V.bottom*Ge+l[1],anchorPointX:St.x,anchorPointY:St.y}),Yt=Ut.box;return Yt&&Yt.length?(k.insertCollisionBox(Yt,fe),!0):!1});D.forEach(function(N){r.glyphInfoMap[N.id]=N})}}},{key:"initGlyph",value:function(){var r=this.layer.getLayerConfig(),o=r.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var r=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=r({data:o,mag:ee.LINEAR,min:ee.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w;return se().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,this.filterGlyphs(),k.next=4,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Nx,fragmentShader:Bx,triangulation:zx.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Uo(p,E)});case 4:w=k.sent,this.layer.models=[w];case 6:case"end":return k.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()}]),t}(os),aM={fillImage:C5,fill:Ax,radar:z5,image:Cx,normal:Mx,simplePoint:j5,extrude:Ex,text:Zx,earthFill:d5,earthExtrude:l5},oM=aM;function sM(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=uM(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function uM(e,i){if(!!e){if(typeof e=="string")return Ux(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ux(e,i)}}function Ux(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function lM(e){var i=cM();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function cM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vm=function(e){(0,Fr.Z)(t,e);var i=lM(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"type","PointLayer"),(0,J.Z)((0,Ke.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,tr.Z)(t,[{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new oM[u](this),p.next=5,this.initLayerModels();case 5:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"rebuildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var r=this.shapeOption,o=r.field,u=r.values,l=this.getLayerConfig(),p=l.shape2d,v=this.iconService.getIconMap();if(o&&(p==null?void 0:p.indexOf(o))!==-1)return"fill";if(u==="text")return"text";if(u&&u instanceof Array){var E=sM(u),w;try{for(E.s();!(w=E.n()).done;){var M=w.value;if(typeof M=="string"&&v.hasOwnProperty(M))return"image"}}catch(k){E.e(k)}finally{E.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return o[r]}},{key:"getModelType",value:function(){var r=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,l=o.shape3d,p=this.iconService.getIconMap(),v=r.find(function(w){return w.hasOwnProperty("shape")});if(v){var E=v.shape;return E==="dot"?"normal":E==="simple"?"simplePoint":E==="radar"?"radar":this.layerType==="fillImage"?"fillImage":(u==null?void 0:u.indexOf(E))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(l==null?void 0:l.indexOf(E))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":p.hasOwnProperty(E)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(Od);function fM(e){var i=hM();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function hM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pM=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,dM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,vM=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,mM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,gM=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,yM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,_M=function(e){(0,Fr.Z)(t,e);var i=fM(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.heightfixed,p=l===void 0?!1:l,v=r.raisingHeight,E=v===void 0?0:v,w=r.topsurface,M=w===void 0?!0:w,k=r.sidesurface,D=k===void 0?!0:k,N=r.sourceColor,V=r.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var q=this.layer.getEncodedData(),fe=this.calDataFrame(this.cellLength,q,this.cellProperties),he=fe.data,Be=fe.width,Ge=fe.height;this.rowCount=Ge,this.dataTexture=this.cellLength>0&&he.length>0?this.createTexture2D({flipY:!0,data:he,format:ee.LUMINANCE,type:ee.FLOAT,width:Be,height:Ge}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}var St=0,Ut=[1,1,1,1],Yt=[1,1,1,1];return N&&V&&(Ut=Oa(N),Yt=Oa(V),St=1),{u_topsurface:Number(M),u_sidesurface:Number(D),u_heightfixed:Number(p),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(E),u_opacity:(0,f.isNumber)(u)?u:1,u_linearColor:St,u_sourceColor:Ut,u_targetColor:Yt,u_texture:this.texture}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w,M,k,D,N;return se().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,w=this.getShaders(),M=w.frag,k=w.vert,D=w.type,q.next=4,this.layer.buildLayerModel({moduleName:D,vertexShader:k,fragmentShader:M,triangulation:cx,stencil:Uo(p,E)});case 4:return N=q.sent,q.abrupt("return",[N]);case 6:case"end":return q.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.pickLight,u=r.mapTexture;return u?{frag:vM,vert:mM,type:"polygonExtrudeTexture"}:o?{frag:gM,vert:yM,type:"polygonExtrudePickLight"}:{frag:pM,vert:dM,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var r,o;(r=this.dataTexture)===null||r===void 0||r.destroy(),(o=this.texture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,Ti.Z)(r,4),u=o[0],l=o[1],p=o[2],v=o[3],E=p-u,w=v-l;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:ri.Attribute,descriptor:{name:"a_uvs",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(k,D,N){var V=N[0],q=N[1];return[(V-u)/E,(q-l)/w,N[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ri.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(k,D,N,V,q){return q}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ri.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(k){var D=k.size,N=D===void 0?10:D;return Array.isArray(N)?[N[0]]:[N]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.mapTexture,l=this.rendererService.createTexture2D;if(this.texture=l({height:0,width:0}),u){var p=new Image;p.crossOrigin="",p.src=u,p.onload=function(){r.texture=l({data:p,width:p.width,height:p.height,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE,min:ee.LINEAR,mag:ee.LINEAR}),r.layerService.reRender()}}}}]),t}(os);function xM(e){var i=bM();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function bM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EM=`uniform float u_opacity: 1.0;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,SM=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,wM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,AM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,CM=function(e){(0,Fr.Z)(t,e);var i=xM(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.raisingHeight,u=o===void 0?0:o,l=r.opacity,p=l===void 0?1:l,v=r.opacityLinear,E=v===void 0?{enable:!1,dir:"in"}:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var w=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,w,this.cellProperties),k=M.data,D=M.width,N=M.height;this.rowCount=N,this.dataTexture=this.cellLength>0&&k.length>0?this.createTexture2D({flipY:!0,data:k,format:ee.LUMINANCE,type:ee.FLOAT,width:D,height:N}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(u),u_opacity:(0,f.isNumber)(p)?p:1,u_opacitylinear:Number(E.enable),u_dir:E.dir==="in"?1:0}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w,M,k,D,N,V,q,fe,he;return se().wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:return u=this.getModelParams(),l=u.frag,p=u.vert,v=u.triangulation,E=u.type,w=this.layer.getLayerConfig(),M=w.mask,k=M===void 0?!1:M,D=w.maskInside,N=D===void 0?!0:D,V=w.workerEnabled,q=V===void 0?!1:V,fe=w.enablePicking,this.layer.triangulation=v,Ge.next=5,this.layer.buildLayerModel({moduleName:E,vertexShader:p,fragmentShader:l,triangulation:v,primitive:ee.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Uo(k,N),workerEnabled:q,workerOptions:{modelType:E,enablePicking:fe}});case 5:return he=Ge.sent,Ge.abrupt("return",[he]);case 7:case"end":return Ge.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getLayerConfig(),o=r.opacityLinear,u=o===void 0?{enable:!1,dir:"in"}:o;u.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:ri.Attribute,descriptor:{name:"a_linear",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(p,v,E){return[E[3],E[4],E[5]]}}})}},{key:"getModelParams",value:function(){var r=this.layer.getLayerConfig(),o=r.opacityLinear,u=o===void 0?{enable:!1}:o;return u.enable?{frag:SM,vert:wM,type:"polygonLinear",triangulation:QC}:{frag:EM,vert:AM,type:"polygonFill",triangulation:ws}}}]),t}(os);function TM(e){var i=MM();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function MM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IM=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = u_opacity;
  gl_FragColor = vec4(col, opacity);  
}
`,kM=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,PM=function(e){(0,Fr.Z)(t,e);var i=TM(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.watercolor,p=l===void 0?"#6D99A8":l,v=r.watercolor2,E=v===void 0?"#0F121C":v;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:Oa(p),u_watercolor2:Oa(E),u_opacity:(0,f.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w;return se().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,k.next=3,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:kM,fragmentShader:IM,triangulation:cy,primitive:ee.TRIANGLES,depth:{enable:!1},stencil:Uo(p,E)});case 3:return w=k.sent,k.abrupt("return",[w]);case 5:case"end":return k.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o,u;(r=this.texture1)===null||r===void 0||r.destroy(),(o=this.texture2)===null||o===void 0||o.destroy(),(u=this.texture3)===null||u===void 0||u.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,Ti.Z)(r,4),u=o[0],l=o[1],p=o[2],v=o[3],E=p-u,w=v-l;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:ri.Attribute,descriptor:{name:"a_uv",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(k,D,N,V){var q=k.version===Mf["GAODE2.x"]?k.originCoordinates[0][V]:N,fe=(0,Ti.Z)(q,2),he=fe[0],Be=fe[1];return[(he-u)/E,(Be-l)/w]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.rendererService.createTexture2D,u={height:0,width:0};this.texture1=o(u),this.texture2=o(u),this.texture3=o(u),l(function(v){r.texture1=p(v[0]),r.texture2=p(v[1]),r.texture3=p(v[2]),r.layerService.reRender()});function l(v){var E=0,w=[],M=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];M.map(function(k){var D=new Image;D.crossOrigin="",D.src=k,w.push(D),D.onload=function(){E++,E===3&&v(w)}})}function p(v){return o({data:v,width:v.width,height:v.height,wrapS:ee.MIRRORED_REPEAT,wrapT:ee.MIRRORED_REPEAT,min:ee.LINEAR,mag:ee.LINEAR})}}}]),t}(os);function RM(e){var i=LM();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function LM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OM=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = u_opacity;
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,FM=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;


#pragma include "projection"

void main() {
  v_uv = a_uv;

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,DM=function(e){(0,Fr.Z)(t,e);var i=RM(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.speed,p=l===void 0?.5:l;return{u_texture:this.texture,u_speed:p,u_opacity:(0,f.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w;return se().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,k.next=3,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:FM,fragmentShader:OM,triangulation:cy,primitive:ee.TRIANGLES,depth:{enable:!1},stencil:Uo(p,E)});case 3:return w=k.sent,k.abrupt("return",[w]);case 5:case"end":return k.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.texture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,Ti.Z)(r,4),u=o[0],l=o[1],p=o[2],v=o[3],E=p-u,w=v-l;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:ri.Attribute,descriptor:{name:"a_uv",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(k,D,N,V){var q=k.version===Mf["GAODE2.x"]?k.originCoordinates[0][V]:N,fe=(0,Ti.Z)(q,2),he=fe[0],Be=fe[1];return[(he-u)/E,(Be-l)/w]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.waterTexture,l=this.rendererService.createTexture2D;this.texture=l({height:0,width:0});var p=new Image;p.crossOrigin="",u?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),p.src=u):p.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",p.onload=function(){r.texture=l({data:p,width:p.width,height:p.height,wrapS:ee.MIRRORED_REPEAT,wrapT:ee.MIRRORED_REPEAT,min:ee.LINEAR,mag:ee.LINEAR}),r.layerService.reRender()}}}]),t}(os),BM={fill:CM,line:xx,extrude:_M,text:Zx,point_fill:Ax,point_image:Cx,point_normal:Mx,point_extrude:Ex,water:DM,ocean:PM},NM=BM;function zM(e){var i=ZM();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function ZM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dy=function(e){(0,Fr.Z)(t,e);var i=zM(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"type","PolygonLayer"),n}return(0,tr.Z)(t,[{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new NM[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getModelType",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(r=o.scale)===null||r===void 0?void 0:r.field;return u==="fill"?"fill":u==="extrude"?"extrude":u==="water"?"water":u==="ocean"?"ocean":u==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var r=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,l=o.shape3d,p=this.iconService.getIconMap(),v=r.find(function(w){return w.hasOwnProperty("shape")});if(v){var E=v.shape;return E==="dot"?"point_normal":(u==null?void 0:u.indexOf(E))!==-1?"point_fill":(l==null?void 0:l.indexOf(E))!==-1?"point_extrude":p.hasOwnProperty(E)?"point_image":"text"}else return"fill"}}]),t}(Od);function UM(e){var i=VM();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function VM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GM=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;
bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }


void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value))
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
   
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,jM=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Vx=function(e){(0,Fr.Z)(t,e);var i=UM(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.clampLow,p=l===void 0?!0:l,v=r.clampHigh,E=v===void 0?!0:v,w=r.noDataValue,M=w===void 0?-9999999:w,k=r.domain,D=r.rampColors,N=k||ul(D);return this.colorTexture=this.layer.textureService.getColorTexture(D,N),{u_opacity:u||1,u_texture:this.texture,u_domain:N,u_clampLow:p,u_clampHigh:typeof E!="undefined"?E:p,u_noDataValue:M,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var n=(0,ot.Z)(se().mark(function o(u){var l,p,v,E;return se().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(!Array.isArray(u.data)){M.next=4;break}return M.abrupt("return",{data:u.data,width:u.width,height:u.height});case 4:return M.next=6,u.data;case 6:return l=M.sent,p=l.rasterData,v=l.width,E=l.height,M.abrupt("return",{data:Array.from(p),width:v,height:E});case 11:case"end":return M.stop()}},o)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w,M,k,D,N,V,q,fe;return se().wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,w=this.layer.getSource(),M=this.rendererService.createTexture2D,k=w.data.dataArray[0],Be.next=6,this.getRasterData(k);case 6:return D=Be.sent,N=D.data,V=D.width,q=D.height,this.texture=M({data:N,width:V,height:q,format:ee.LUMINANCE,type:ee.FLOAT}),Be.next=13,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:jM,fragmentShader:GM,triangulation:zm,primitive:ee.TRIANGLES,depth:{enable:!1},stencil:Uo(p,E)});case 13:return fe=Be.sent,Be.abrupt("return",[fe]);case 15:case"end":return Be.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:ri.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),t}(os),HM=["data"],WM=["rasterData"];function XM(e){var i=$M();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function $M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YM=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,qM=`precision mediump float;
uniform vec2 u_rminmax: vec2(0,255); 
uniform vec2 u_gminmax: vec2(0,255);
uniform vec2 u_bminmax: vec2(0,255);
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform float u_noDataValue : 0.0;
varying vec2 v_texCoord;

void main() {
  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;
  if(rgb == vec3(u_noDataValue)) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }
 
}`,KM=function(e){(0,Fr.Z)(t,e);var i=XM(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"dataOption",{}),n}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.noDataValue,p=l===void 0?0:l,v=this.dataOption,E=v.rMinMax,w=v.gMinMax,M=v.bMinMax;return{u_opacity:u||1,u_texture:this.texture,u_noDataValue:p,u_rminmax:E,u_gminmax:w,u_bminmax:M}}},{key:"getRasterData",value:function(){var n=(0,ot.Z)(se().mark(function o(u){var l,p,v,E,w;return se().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(!Array.isArray(u.data)){k.next=4;break}return l=u.data,p=(0,Af.Z)(u,HM),this.dataOption=p,k.abrupt("return",(0,U.Z)({data:l},p));case 4:return k.next=6,u.data;case 6:if(v=k.sent,E=v.rasterData,w=(0,Af.Z)(v,WM),this.dataOption=w,!Array.isArray(E)){k.next=14;break}return k.abrupt("return",(0,U.Z)({data:E},w));case 14:return k.abrupt("return",(0,U.Z)({data:Array.from(E)},w));case 15:case"end":return k.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w,M,k,D,N,V,q,fe;return se().wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,w=this.layer.getSource(),M=this.rendererService.createTexture2D,k=w.data.dataArray[0],Be.next=6,this.getRasterData(k);case 6:return D=Be.sent,N=D.data,V=D.width,q=D.height,this.texture=M({data:N,width:V,height:q,format:ee.RGB,type:ee.FLOAT}),Be.next=13,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:YM,fragmentShader:qM,triangulation:zm,primitive:ee.TRIANGLES,depth:{enable:!1},stencil:Uo(p,E)});case 13:return fe=Be.sent,Be.abrupt("return",[fe]);case 15:case"end":return Be.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.texture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:ri.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),t}(os);function QM(e){var i=JM();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function JM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e4=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y)) * 256.0;
  float r = baseColor.r * 256.0 * 256.0;
  float g = baseColor.g * 256.0;
  float b = baseColor.b;
  float value =  (r + g + b) * 0.1 - 10000.0;
  
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
     gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,t4=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,r4=function(e){(0,Fr.Z)(t,e);var i=QM(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.clampLow,l=u===void 0?!0:u,p=r.clampHigh,v=p===void 0?!0:p,E=r.noDataValue,w=E===void 0?-9999999:E,M=r.domain,k=r.rampColors,D=r.colorTexture,N=M||ul(k),V=D;return D?this.layer.textureService.setColorTexture(D,k,N):V=this.layer.textureService.getColorTexture(k,N),{u_opacity:o||1,u_texture:this.texture,u_domain:N,u_clampLow:l,u_clampHigh:typeof v!="undefined"?v:l,u_noDataValue:w,u_colorTexture:V}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w,M,k,D;return se().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,E=v===void 0?!0:v,w=this.layer.getSource(),M=this.rendererService.createTexture2D,V.next=5,w.data.images;case 5:return k=V.sent,this.texture=M({data:k[0],width:k[0].width,height:k[0].height}),V.next=9,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:t4,fragmentShader:e4,triangulation:zm,primitive:ee.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Uo(p,E)});case 9:return D=V.sent,V.abrupt("return",[D]);case 11:case"end":return V.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.texture)===null||r===void 0||r.destroy()}},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:ri.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),t}(os),n4={raster:Vx,rasterRgb:KM,raster3d:Vx,rasterTerrainRgb:r4},i4=n4;function a4(e){var i=o4();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function o4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gm=function(e){(0,Fr.Z)(t,e);var i=a4(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"type","RasterLayer"),n}return(0,tr.Z)(t,[{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new i4[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return o[r]}},{key:"getModelType",value:function(){var r=this.layerSource.getParserType();switch(r){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),t}(Od);function s4(e){var i=u4();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function u4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l4=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,c4=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,f4=function(e){(0,Fr.Z)(t,e);var i=s4(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?0:o,l=r.color,p=l===void 0?"#000":l;return{u_opacity:(0,f.isNumber)(u)?u:0,u_color:Oa(p)}}},{key:"initModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:c4,fragmentShader:l4,triangulation:cy,depth:{enable:!1},blend:this.getBlend(),stencil:{enable:!0,mask:255,func:{cmp:ee.ALWAYS,ref:1,mask:255},opFront:{fail:ee.REPLACE,zfail:ee.REPLACE,zpass:ee.REPLACE}},pick:!1});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;r&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}(os),h4={fill:f4},p4=h4;function d4(e){var i=v4();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function v4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vy=function(e){(0,Fr.Z)(t,e);var i=d4(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"type","MaskLayer"),n}return(0,tr.Z)(t,[{key:"buildModels",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new p4[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getModelType",value:function(){return"fill"}}]),t}(Od),Gx,jx,Hx,Wx,jm,Xx,$x,m4=(Gx=(0,kn.b2)(),jx=(0,kn.f3)(fr.IMapService),Hx=(0,kn.f3)(fr.IFontService),Gx(Wx=(jm=function(){function e(){(0,Ht.Z)(this,e),Ta(this,"mapService",Xx,this),Ta(this,"fontService",$x,this)}return(0,tr.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.styleAttributeService;t.hooks.init.tapPromise("DataMappingPlugin",(0,ot.Z)(se().mark(function u(){return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:t.log(Cl.MappingStart,Tl.INIT),r.generateMaping(t,{styleAttributeService:o}),t.log(Cl.MappingEnd,Tl.INIT);case 3:case"end":return p.stop()}},u)}))),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var u=(0,ot.Z)(se().mark(function l(p){var v;return se().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(p){w.next=2;break}return w.abrupt("return",p);case 2:return t.dataState.dataMappingNeedUpdate=!1,t.log(Cl.MappingStart,Tl.UPDATE),v=r.generateMaping(t,{styleAttributeService:o}),t.log(Cl.MappingEnd,Tl.UPDATE),w.abrupt("return",v);case 7:case"end":return w.stop()}},l)}));return function(l){return u.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var u=t.getSource();if(!(t.layerModelNeedUpdate||!u||!u.inited)){var l=o.getLayerStyleAttributes()||[],p=o.getLayerStyleAttribute("filter"),v=u.data.dataArray;if(!(Array.isArray(v)&&v.length===0)){var E=l.filter(function(k){return k.needRemapping}),w=v;if(p!=null&&p.needRemapping&&p!==null&&p!==void 0&&p.scale&&(w=v.filter(function(k){return r.applyAttributeMapping(p,k)[0]})),E.length){var M=r.mapping(t,E,w,t.getEncodedData());t.setEncodedData(M)}}}})}},{key:"generateMaping",value:function(t,n){var r=this,o=n.styleAttributeService,u=o.getLayerStyleAttributes()||[],l=o.getLayerStyleAttribute("filter"),p=t.getSource().data.dataArray,v=p;l!=null&&l.scale&&(v=p.filter(function(w){return r.applyAttributeMapping(l,w)[0]})),v=t.processData(v);var E=this.mapping(t,u,v,void 0);return t.setEncodedData(E),p.length===0&&t.encodeDataLength===0?!1:(t.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(t,n,r,o){var u=this,l=t.getLayerConfig(),p=l.arrow,v=p===void 0?{enable:!1}:p,E=n.filter(function(M){return M.scale!==void 0}).filter(function(M){return M.name!=="filter"}),w=r.map(function(M,k){var D=o?o[k]:{},N=(0,U.Z)({id:M._id,coordinates:M.coordinates},D);if(E.forEach(function(fe){var he=u.applyAttributeMapping(fe,M);fe.name==="color"&&(he=he.map(function(Be){return Oa(Be)})),N[fe.name]=Array.isArray(he)&&he.length===1?he[0]:he,fe.name==="shape"&&(N.shape=u.fontService.getIconFontKey(N[fe.name]))}),v.enable&&(N.shape==="line"||N.shape==="halfLine")){var V=N.coordinates;if(t.arrowInsertCount<t.encodeDataLength){var q=u.getArrowPoints(V[0],V[1]);N.coordinates.splice(1,0,q,q),t.arrowInsertCount++}}return N});return n.forEach(function(M){M.needRemapping=!1}),this.adjustData2Amap2Coordinates(w,t),this.adjustData2SimpleCoordinates(w),w}},{key:"adjustData2Amap2Coordinates",value:function(t,n){var r=this;if(t.length>0&&this.mapService.version===Mf["GAODE2.x"]){var o=n.coordCenter||n.getSource().center;typeof t[0].coordinates[0]=="number"?t.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=Mf["GAODE2.x"],u.originCoordinates=(0,f.cloneDeep)(u.coordinates),u.coordinates=r.mapService.lngLatToCoordByLayer(u.coordinates,o)}):t.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=Mf["GAODE2.x"],u.originCoordinates=(0,f.cloneDeep)(u.coordinates),u.coordinates=r.mapService.lngLatToCoordsByLayer(u.coordinates,o)})}}},{key:"adjustData2SimpleCoordinates",value:function(t){var n=this;t.length>0&&this.mapService.version===Mf.SIMPLE&&t.map(function(r){r.simpleCoordinate||(r.coordinates=n.unProjectCoordinates(r.coordinates),r.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var n=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var r=[];return t.map(function(u){var l=[];u.map(function(p){l.push(n.mapService.simpleMapCoord.unproject(p))}),r.push(l)}),r}else{var o=[];return t.map(function(u){o.push(n.mapService.simpleMapCoord.unproject(u))}),o}}},{key:"applyAttributeMapping",value:function(t,n){var r;if(!t.scale)return[];var o=(t==null||(r=t.scale)===null||r===void 0?void 0:r.scalers)||[],u=[];o.forEach(function(p){var v,E=p.field;(n.hasOwnProperty(E)||((v=t.scale)===null||v===void 0?void 0:v.type)==="variable")&&u.push(n[E])});var l=t.mapping?t.mapping(u):[];return l}},{key:"getArrowPoints",value:function(t,n){var r=[n[0]-t[0],n[1]-t[1]],o=Hu(r),u=[t[0]+o[0]*1e-4,t[1]+o[1]*1e-4];return u}}]),e}(),Xx=Ma(jm.prototype,"mapService",[jx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$x=Ma(jm.prototype,"fontService",[Hx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jm))||Wx),Yx,qx,g4=(Yx=(0,kn.b2)(),Yx(qx=function(){function e(){(0,Ht.Z)(this,e)}return(0,tr.Z)(e,[{key:"apply",value:function(t){var n=this;this.mapService=t.getContainer().get(fr.IMapService),t.hooks.init.tapPromise("DataSourcePlugin",(0,ot.Z)(se().mark(function r(){var o,u,l,p;return se().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(t.log(Cl.SourceInitStart,Tl.INIT),o=t.getSource(),o||(u=t.sourceOption||t.defaultSourceConfig,l=u.data,p=u.options,o=new ey(l,p),t.setSource(o)),!o.inited){E.next=8;break}n.updateClusterData(t),t.log(Cl.SourceInitEnd,Tl.INIT),E.next=10;break;case 8:return E.next=10,new Promise(function(w){o.on("update",function(M){M.type==="inited"&&(n.updateClusterData(t),t.log(Cl.SourceInitEnd,Tl.INIT)),w(null)})});case 10:case"end":return E.stop()}},r)}))),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,ot.Z)(se().mark(function r(){var o,u,l;return se().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return o=n.updateClusterData(t),u=t.dataState.dataSourceNeedUpdate,t.dataState.dataSourceNeedUpdate=!1,l=o||u,v.abrupt("return",l);case 5:case"end":return v.stop()}},r)})))}},{key:"updateClusterData",value:function(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;var n=t.getSource(),r=n.cluster,o=n.clusterOptions.zoom,u=o===void 0?0:o,l=this.mapService.getZoom()-1,p=t.dataState.dataSourceNeedUpdate;return r&&p&&n.updateClusterData(Math.floor(l)),r&&Math.abs(t.clusterZoom-l)>=1?(u!==Math.floor(l)&&n.updateClusterData(Math.floor(l)),t.clusterZoom=l,!0):!1}}]),e}())||qx);function gy(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function Kx(e){return e.length===1&&(e=y4(e)),{left:function(i,t,n,r){for(n==null&&(n=0),r==null&&(r=i.length);n<r;){var o=n+r>>>1;e(i[o],t)<0?n=o+1:r=o}return n},right:function(i,t,n,r){for(n==null&&(n=0),r==null&&(r=i.length);n<r;){var o=n+r>>>1;e(i[o],t)>0?r=o:n=o+1}return n}}}function y4(e){return function(i,t){return gy(e(i),t)}}var Qx=Kx(gy),_4=Qx.right,LR=Qx.left,Hm=_4;function Jx(e,i){var t=e.length,n=-1,r,o,u;if(i==null){for(;++n<t;)if((r=e[n])!=null&&r>=r)for(o=u=r;++n<t;)(r=e[n])!=null&&(o>r&&(o=r),u<r&&(u=r))}else for(;++n<t;)if((r=i(e[n],n,e))!=null&&r>=r)for(o=u=r;++n<t;)(r=i(e[n],n,e))!=null&&(o>r&&(o=r),u<r&&(u=r));return[o,u]}var eb=Array.prototype,OR=eb.slice,FR=eb.map,yy=Math.sqrt(50),_y=Math.sqrt(10),xy=Math.sqrt(2);function tb(e,i,t){var n,r=-1,o,u,l;if(i=+i,e=+e,t=+t,e===i&&t>0)return[e];if((n=i<e)&&(o=e,e=i,i=o),(l=Wm(e,i,t))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),i=Math.floor(i/l),u=new Array(o=Math.ceil(i-e+1));++r<o;)u[r]=(e+r)*l;else for(e=Math.floor(e*l),i=Math.ceil(i*l),u=new Array(o=Math.ceil(e-i+1));++r<o;)u[r]=(e-r)/l;return n&&u.reverse(),u}function Wm(e,i,t){var n=(i-e)/Math.max(0,t),r=Math.floor(Math.log(n)/Math.LN10),o=n/Math.pow(10,r);return r>=0?(o>=yy?10:o>=_y?5:o>=xy?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(o>=yy?10:o>=_y?5:o>=xy?2:1)}function by(e,i,t){var n=Math.abs(i-e)/Math.max(0,t),r=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/r;return o>=yy?r*=10:o>=_y?r*=5:o>=xy&&(r*=2),i<e?-r:r}function DR(){var e=identity,i=extent,t=sturges;function n(r){var o,u=r.length,l,p=new Array(u);for(o=0;o<u;++o)p[o]=e(r[o],o,r);var v=i(p),E=v[0],w=v[1],M=t(p,E,w);Array.isArray(M)||(M=tickStep(E,w,M),M=range(Math.ceil(E/M)*M,w,M));for(var k=M.length;M[0]<=E;)M.shift(),--k;for(;M[k-1]>w;)M.pop(),--k;var D=new Array(k+1),N;for(o=0;o<=k;++o)N=D[o]=[],N.x0=o>0?M[o-1]:E,N.x1=o<k?M[o]:w;for(o=0;o<u;++o)l=p[o],E<=l&&l<=w&&D[bisect(M,l,0,k)].push(r[o]);return D}return n.value=function(r){return arguments.length?(e=typeof r=="function"?r:constant(r),n):e},n.domain=function(r){return arguments.length?(i=typeof r=="function"?r:constant([r[0],r[1]]),n):i},n.thresholds=function(r){return arguments.length?(t=typeof r=="function"?r:Array.isArray(r)?constant(slice.call(r)):constant(r),n):t},n}function BR(e,i,t){return e=map.call(e,number).sort(ascending),Math.ceil((t-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function x4(e){return e===null?NaN:+e}function b4(e,i,t){if(t==null&&(t=x4),!!(n=e.length)){if((i=+i)<=0||n<2)return+t(e[0],0,e);if(i>=1)return+t(e[n-1],n-1,e);var n,r=(n-1)*i,o=Math.floor(r),u=+t(e[o],o,e),l=+t(e[o+1],o+1,e);return u+(l-u)*(r-o)}}var E4=ie(87765),Gh="$";function Xm(){}Xm.prototype=rb.prototype={constructor:Xm,has:function(e){return Gh+e in this},get:function(e){return this[Gh+e]},set:function(e,i){return this[Gh+e]=i,this},remove:function(e){var i=Gh+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Gh&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Gh&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Gh&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Gh&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Gh&&++e;return e},empty:function(){for(var e in this)if(e[0]===Gh)return!1;return!0},each:function(e){for(var i in this)i[0]===Gh&&e(this[i],i.slice(1),this)}};function rb(e,i){var t=new Xm;if(e instanceof Xm)e.each(function(l,p){t.set(p,l)});else if(Array.isArray(e)){var n=-1,r=e.length,o;if(i==null)for(;++n<r;)t.set(n,e[n]);else for(;++n<r;)t.set(i(o=e[n],n,e),o)}else if(e)for(var u in e)t.set(u,e[u]);return t}var Ey=rb;function NR(){var e=[],i=[],t,n,r;function o(l,p,v,E){if(p>=e.length)return t!=null&&l.sort(t),n!=null?n(l):l;for(var w=-1,M=l.length,k=e[p++],D,N,V=map(),q,fe=v();++w<M;)(q=V.get(D=k(N=l[w])+""))?q.push(N):V.set(D,[N]);return V.each(function(he,Be){E(fe,Be,o(he,p,v,E))}),fe}function u(l,p){if(++p>e.length)return l;var v,E=i[p-1];return n!=null&&p>=e.length?v=l.entries():(v=[],l.each(function(w,M){v.push({key:M,values:u(w,p)})})),E!=null?v.sort(function(w,M){return E(w.key,M.key)}):v}return r={object:function(l){return o(l,0,S4,w4)},map:function(l){return o(l,0,nb,ib)},entries:function(l){return u(o(l,0,nb,ib),0)},key:function(l){return e.push(l),r},sortKeys:function(l){return i[e.length-1]=l,r},sortValues:function(l){return t=l,r},rollup:function(l){return n=l,r}}}function S4(){return{}}function w4(e,i,t){e[i]=t}function nb(){return map()}function ib(e,i,t){e.set(i,t)}function $m(){}var iv=Ey.prototype;$m.prototype=A4.prototype={constructor:$m,has:iv.has,add:function(e){return e+="",this[Gh+e]=e,this},remove:iv.remove,clear:iv.clear,values:iv.keys,size:iv.size,empty:iv.empty,each:iv.each};function A4(e,i){var t=new $m;if(e instanceof $m)e.each(function(o){t.add(o)});else if(e){var n=-1,r=e.length;if(i==null)for(;++n<r;)t.add(e[n]);else for(;++n<r;)t.add(i(e[n],n,e))}return t}var zR=null,ab=Array.prototype,ob=ab.map,av=ab.slice;function Bd(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function sb(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var ub={name:"implicit"};function Ym(){var e=Ey(),i=[],t=[],n=ub;function r(o){var u=o+"",l=e.get(u);if(!l){if(n!==ub)return n;e.set(u,l=i.push(o))}return t[(l-1)%t.length]}return r.domain=function(o){if(!arguments.length)return i.slice();i=[],e=Ey();for(var u=-1,l=o.length,p,v;++u<l;)e.has(v=(p=o[u])+"")||e.set(v,i.push(p));return r},r.range=function(o){return arguments.length?(t=av.call(o),r):t.slice()},r.unknown=function(o){return arguments.length?(n=o,r):n},r.copy=function(){return Ym(i,t).unknown(n)},Bd.apply(r,arguments),r}function lb(){var e=ordinal().unknown(void 0),i=e.domain,t=e.range,n=[0,1],r,o,u=!1,l=0,p=0,v=.5;delete e.unknown;function E(){var w=i().length,M=n[1]<n[0],k=n[M-0],D=n[1-M];r=(D-k)/Math.max(1,w-l+p*2),u&&(r=Math.floor(r)),k+=(D-k-r*(w-l))*v,o=r*(1-l),u&&(k=Math.round(k),o=Math.round(o));var N=sequence(w).map(function(V){return k+r*V});return t(M?N.reverse():N)}return e.domain=function(w){return arguments.length?(i(w),E()):i()},e.range=function(w){return arguments.length?(n=[+w[0],+w[1]],E()):n.slice()},e.rangeRound=function(w){return n=[+w[0],+w[1]],u=!0,E()},e.bandwidth=function(){return o},e.step=function(){return r},e.round=function(w){return arguments.length?(u=!!w,E()):u},e.padding=function(w){return arguments.length?(l=Math.min(1,p=+w),E()):l},e.paddingInner=function(w){return arguments.length?(l=Math.min(1,w),E()):l},e.paddingOuter=function(w){return arguments.length?(p=+w,E()):p},e.align=function(w){return arguments.length?(v=Math.max(0,Math.min(1,w)),E()):v},e.copy=function(){return lb(i(),n).round(u).paddingInner(l).paddingOuter(p).align(v)},initRange.apply(E(),arguments)}function cb(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return cb(i())},e}function ZR(){return cb(lb.apply(null,arguments).paddingInner(1))}var C4=ie(21775),T4=ie(73626);function M4(e,i){return e=+e,i=+i,function(t){return Math.round(e*(1-t)+i*t)}}function I4(e){return function(){return e}}function k4(e){return+e}var fb=[0,1];function Qc(e){return e}function Sy(e,i){return(i-=e=+e)?function(t){return(t-e)/i}:I4(isNaN(i)?NaN:.5)}function hb(e){var i=e[0],t=e[e.length-1],n;return i>t&&(n=i,i=t,t=n),function(r){return Math.max(i,Math.min(t,r))}}function P4(e,i,t){var n=e[0],r=e[1],o=i[0],u=i[1];return r<n?(n=Sy(r,n),o=t(u,o)):(n=Sy(n,r),o=t(o,u)),function(l){return o(n(l))}}function R4(e,i,t){var n=Math.min(e.length,i.length)-1,r=new Array(n),o=new Array(n),u=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++u<n;)r[u]=Sy(e[u],e[u+1]),o[u]=t(i[u],i[u+1]);return function(l){var p=Hm(e,l,1,n)-1;return o[p](r[p](l))}}function qm(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function wy(){var e=fb,i=fb,t=C4.Z,n,r,o,u=Qc,l,p,v;function E(){return l=Math.min(e.length,i.length)>2?R4:P4,p=v=null,w}function w(M){return isNaN(M=+M)?o:(p||(p=l(e.map(n),i,t)))(n(u(M)))}return w.invert=function(M){return u(r((v||(v=l(i,e.map(n),T4.Z)))(M)))},w.domain=function(M){return arguments.length?(e=ob.call(M,k4),u===Qc||(u=hb(e)),E()):e.slice()},w.range=function(M){return arguments.length?(i=av.call(M),E()):i.slice()},w.rangeRound=function(M){return i=av.call(M),t=M4,E()},w.clamp=function(M){return arguments.length?(u=M?hb(e):Qc,w):u!==Qc},w.interpolate=function(M){return arguments.length?(t=M,E()):t},w.unknown=function(M){return arguments.length?(o=M,w):o},function(M,k){return n=M,r=k,E()}}function pb(e,i){return wy()(e,i)}var L4=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Km(e){if(!(i=L4.exec(e)))throw new Error("invalid format: "+e);var i;return new Ay({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}Km.prototype=Ay.prototype;function Ay(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Ay.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function O4(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Qm(e,i){if((t=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var t,n=e.slice(0,t);return[n.length>1?n[0]+n.slice(2):n,+e.slice(t+1)]}function Wv(e){return e=Qm(Math.abs(e)),e?e[1]:NaN}function F4(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Wv(i)/3)))*3-Wv(Math.abs(e)))}function D4(e,i){return function(t,n){for(var r=t.length,o=[],u=0,l=e[0],p=0;r>0&&l>0&&(p+l+1>n&&(l=Math.max(1,n-p)),o.push(t.substring(r-=l,r+l)),!((p+=l+1)>n));)l=e[u=(u+1)%e.length];return o.reverse().join(i)}}function B4(e){return function(i){return i.replace(/[0-9]/g,function(t){return e[+t]})}}function N4(e){e:for(var i=e.length,t=1,n=-1,r;t<i;++t)switch(e[t]){case".":n=r=t;break;case"0":n===0&&(n=t),r=t;break;default:if(!+e[t])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(r+1):e}var db;function z4(e,i){var t=Qm(e,i);if(!t)return e+"";var n=t[0],r=t[1],o=r-(db=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,u=n.length;return o===u?n:o>u?n+new Array(o-u+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+Qm(e,Math.max(0,i+o-1))[0]}function vb(e,i){var t=Qm(e,i);if(!t)return e+"";var n=t[0],r=t[1];return r<0?"0."+new Array(-r).join("0")+n:n.length>r+1?n.slice(0,r+1)+"."+n.slice(r+1):n+new Array(r-n.length+2).join("0")}var mb={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:O4,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return vb(e*100,i)},r:vb,s:z4,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function gb(e){return e}var yb=Array.prototype.map,_b=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Z4(e){var i=e.grouping===void 0||e.thousands===void 0?gb:D4(yb.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?gb:B4(yb.call(e.numerals,String)),u=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"-":e.minus+"",p=e.nan===void 0?"NaN":e.nan+"";function v(w){w=Km(w);var M=w.fill,k=w.align,D=w.sign,N=w.symbol,V=w.zero,q=w.width,fe=w.comma,he=w.precision,Be=w.trim,Ge=w.type;Ge==="n"?(fe=!0,Ge="g"):mb[Ge]||(he===void 0&&(he=12),Be=!0,Ge="g"),(V||M==="0"&&k==="=")&&(V=!0,M="0",k="=");var St=N==="$"?t:N==="#"&&/[boxX]/.test(Ge)?"0"+Ge.toLowerCase():"",Ut=N==="$"?n:/[%p]/.test(Ge)?u:"",Yt=mb[Ge],nr=/[defgprs%]/.test(Ge);he=he===void 0?6:/[gprs]/.test(Ge)?Math.max(1,Math.min(21,he)):Math.max(0,Math.min(20,he));function Rr(Tr){var on=St,Hn=Ut,di,za,Co;if(Ge==="c")Hn=Yt(Tr)+Hn,Tr="";else{Tr=+Tr;var Ds=Tr<0||1/Tr<0;if(Tr=isNaN(Tr)?p:Yt(Math.abs(Tr),he),Be&&(Tr=N4(Tr)),Ds&&+Tr==0&&D!=="+"&&(Ds=!1),on=(Ds?D==="("?D:l:D==="-"||D==="("?"":D)+on,Hn=(Ge==="s"?_b[8+db/3]:"")+Hn+(Ds&&D==="("?")":""),nr){for(di=-1,za=Tr.length;++di<za;)if(Co=Tr.charCodeAt(di),48>Co||Co>57){Hn=(Co===46?r+Tr.slice(di+1):Tr.slice(di))+Hn,Tr=Tr.slice(0,di);break}}}fe&&!V&&(Tr=i(Tr,Infinity));var js=on.length+Tr.length+Hn.length,vu=js<q?new Array(q-js+1).join(M):"";switch(fe&&V&&(Tr=i(vu+Tr,vu.length?q-Hn.length:Infinity),vu=""),k){case"<":Tr=on+Tr+Hn+vu;break;case"=":Tr=on+vu+Tr+Hn;break;case"^":Tr=vu.slice(0,js=vu.length>>1)+on+Tr+Hn+vu.slice(js);break;default:Tr=vu+on+Tr+Hn;break}return o(Tr)}return Rr.toString=function(){return w+""},Rr}function E(w,M){var k=v((w=Km(w),w.type="f",w)),D=Math.max(-8,Math.min(8,Math.floor(Wv(M)/3)))*3,N=Math.pow(10,-D),V=_b[8+D/3];return function(q){return k(N*q)+V}}return{format:v,formatPrefix:E}}var Jm,Cy,xb;U4({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function U4(e){return Jm=Z4(e),Cy=Jm.format,xb=Jm.formatPrefix,Jm}function V4(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,Wv(i)-Wv(e))+1}function G4(e){return Math.max(0,-Wv(Math.abs(e)))}function j4(e,i,t,n){var r=by(e,i,t),o;switch(n=Km(n==null?",f":n),n.type){case"s":{var u=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(o=F4(r,u))&&(n.precision=o),xb(n,u)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=V4(r,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=G4(r))&&(n.precision=o-(n.type==="%")*2);break}}return Cy(n)}function M0(e){var i=e.domain;return e.ticks=function(t){var n=i();return tb(n[0],n[n.length-1],t==null?10:t)},e.tickFormat=function(t,n){var r=i();return j4(r[0],r[r.length-1],t==null?10:t,n)},e.nice=function(t){t==null&&(t=10);var n=i(),r=0,o=n.length-1,u=n[r],l=n[o],p;return l<u&&(p=u,u=l,l=p,p=r,r=o,o=p),p=Wm(u,l,t),p>0?(u=Math.floor(u/p)*p,l=Math.ceil(l/p)*p,p=Wm(u,l,t)):p<0&&(u=Math.ceil(u*p)/p,l=Math.floor(l*p)/p,p=Wm(u,l,t)),p>0?(n[r]=Math.floor(u/p)*p,n[o]=Math.ceil(l/p)*p,i(n)):p<0&&(n[r]=Math.ceil(u*p)/p,n[o]=Math.floor(l*p)/p,i(n)),e},e}function bb(){var e=pb(Qc,Qc);return e.copy=function(){return qm(e,bb())},Bd.apply(e,arguments),M0(e)}function H4(e){var i;function t(n){return isNaN(n=+n)?i:n}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=map.call(n,number),t):e.slice()},t.unknown=function(n){return arguments.length?(i=n,t):i},t.copy=function(){return H4(e).unknown(i)},e=arguments.length?map.call(e,number):[0,1],linearish(t)}function Eb(e,i){e=e.slice();var t=0,n=e.length-1,r=e[t],o=e[n],u;return o<r&&(u=t,t=n,n=u,u=r,r=o,o=u),e[t]=i.floor(r),e[n]=i.ceil(o),e}function Sb(e){return Math.log(e)}function wb(e){return Math.exp(e)}function W4(e){return-Math.log(-e)}function X4(e){return-Math.exp(-e)}function $4(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Y4(e){return e===10?$4:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function q4(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function Ab(e){return function(i){return-e(-i)}}function K4(e){var i=e(Sb,wb),t=i.domain,n=10,r,o;function u(){return r=q4(n),o=Y4(n),t()[0]<0?(r=Ab(r),o=Ab(o),e(W4,X4)):e(Sb,wb),i}return i.base=function(l){return arguments.length?(n=+l,u()):n},i.domain=function(l){return arguments.length?(t(l),u()):t()},i.ticks=function(l){var p=t(),v=p[0],E=p[p.length-1],w;(w=E<v)&&(M=v,v=E,E=M);var M=r(v),k=r(E),D,N,V,q=l==null?10:+l,fe=[];if(!(n%1)&&k-M<q){if(M=Math.round(M)-1,k=Math.round(k)+1,v>0){for(;M<k;++M)for(N=1,D=o(M);N<n;++N)if(V=D*N,!(V<v)){if(V>E)break;fe.push(V)}}else for(;M<k;++M)for(N=n-1,D=o(M);N>=1;--N)if(V=D*N,!(V<v)){if(V>E)break;fe.push(V)}}else fe=tb(M,k,Math.min(k-M,q)).map(o);return w?fe.reverse():fe},i.tickFormat=function(l,p){if(p==null&&(p=n===10?".0e":","),typeof p!="function"&&(p=Cy(p)),l===Infinity)return p;l==null&&(l=10);var v=Math.max(1,n*l/i.ticks().length);return function(E){var w=E/o(Math.round(r(E)));return w*n<n-.5&&(w*=n),w<=v?p(E):""}},i.nice=function(){return t(Eb(t(),{floor:function(l){return o(Math.floor(r(l)))},ceil:function(l){return o(Math.ceil(r(l)))}}))},i}function Cb(){var e=K4(wy()).domain([1,10]);return e.copy=function(){return qm(e,Cb()).base(e.base())},Bd.apply(e,arguments),e}function Tb(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function Mb(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function Q4(e){var i=1,t=e(Tb(i),Mb(i));return t.constant=function(n){return arguments.length?e(Tb(i=+n),Mb(i)):i},linearish(t)}function J4(){var e=Q4(transformer());return e.copy=function(){return copy(e,J4()).constant(e.constant())},initRange.apply(e,arguments)}function Ib(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function eI(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function tI(e){return e<0?-e*e:e*e}function rI(e){var i=e(Qc,Qc),t=1;function n(){return t===1?e(Qc,Qc):t===.5?e(eI,tI):e(Ib(t),Ib(1/t))}return i.exponent=function(r){return arguments.length?(t=+r,n()):t},M0(i)}function Ty(){var e=rI(wy());return e.copy=function(){return qm(e,Ty()).exponent(e.exponent())},Bd.apply(e,arguments),e}function UR(){return Ty.apply(null,arguments).exponent(.5)}function kb(){var e=[],i=[],t=[],n;function r(){var u=0,l=Math.max(1,i.length);for(t=new Array(l-1);++u<l;)t[u-1]=b4(e,u/l);return o}function o(u){return isNaN(u=+u)?n:i[Hm(t,u)]}return o.invertExtent=function(u){var l=i.indexOf(u);return l<0?[NaN,NaN]:[l>0?t[l-1]:e[0],l<t.length?t[l]:e[e.length-1]]},o.domain=function(u){if(!arguments.length)return e.slice();e=[];for(var l=0,p=u.length,v;l<p;++l)v=u[l],v!=null&&!isNaN(v=+v)&&e.push(v);return e.sort(gy),r()},o.range=function(u){return arguments.length?(i=av.call(u),r()):i.slice()},o.unknown=function(u){return arguments.length?(n=u,o):n},o.quantiles=function(){return t.slice()},o.copy=function(){return kb().domain(e).range(i).unknown(n)},Bd.apply(o,arguments)}function Pb(){var e=0,i=1,t=1,n=[.5],r=[0,1],o;function u(p){return p<=p?r[Hm(n,p,0,t)]:o}function l(){var p=-1;for(n=new Array(t);++p<t;)n[p]=((p+1)*i-(p-t)*e)/(t+1);return u}return u.domain=function(p){return arguments.length?(e=+p[0],i=+p[1],l()):[e,i]},u.range=function(p){return arguments.length?(t=(r=av.call(p)).length-1,l()):r.slice()},u.invertExtent=function(p){var v=r.indexOf(p);return v<0?[NaN,NaN]:v<1?[e,n[0]]:v>=t?[n[t-1],i]:[n[v-1],n[v]]},u.unknown=function(p){return arguments.length&&(o=p),u},u.thresholds=function(){return n.slice()},u.copy=function(){return Pb().domain([e,i]).range(r).unknown(o)},Bd.apply(M0(u),arguments)}function Rb(){var e=[.5],i=[0,1],t,n=1;function r(o){return o<=o?i[Hm(e,o,0,n)]:t}return r.domain=function(o){return arguments.length?(e=av.call(o),n=Math.min(e.length,i.length-1),r):e.slice()},r.range=function(o){return arguments.length?(i=av.call(o),n=Math.min(e.length,i.length-1),r):i.slice()},r.invertExtent=function(o){var u=i.indexOf(o);return[e[u-1],e[u]]},r.unknown=function(o){return arguments.length?(t=o,r):t},r.copy=function(){return Rb().domain(e).range(i).unknown(t)},Bd.apply(r,arguments)}var My=new Date,Iy=new Date;function If(e,i,t,n){function r(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return r.floor=function(o){return e(o=new Date(+o)),o},r.ceil=function(o){return e(o=new Date(o-1)),i(o,1),e(o),o},r.round=function(o){var u=r(o),l=r.ceil(o);return o-u<l-o?u:l},r.offset=function(o,u){return i(o=new Date(+o),u==null?1:Math.floor(u)),o},r.range=function(o,u,l){var p=[],v;if(o=r.ceil(o),l=l==null?1:Math.floor(l),!(o<u)||!(l>0))return p;do p.push(v=new Date(+o)),i(o,l),e(o);while(v<o&&o<u);return p},r.filter=function(o){return If(function(u){if(u>=u)for(;e(u),!o(u);)u.setTime(u-1)},function(u,l){if(u>=u)if(l<0)for(;++l<=0;)for(;i(u,-1),!o(u););else for(;--l>=0;)for(;i(u,1),!o(u););})},t&&(r.count=function(o,u){return My.setTime(+o),Iy.setTime(+u),e(My),e(Iy),Math.floor(t(My,Iy))},r.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?r.filter(n?function(u){return n(u)%o==0}:function(u){return r.count(0,u)%o==0}):r}),r}var ky=If(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});ky.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:If(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,t){i.setFullYear(i.getFullYear()+t*e)})};var Xv=ky,VR=ky.range,Lb=If(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),nI=Lb,GR=Lb.range,eg=1e3,I0=6e4,Ob=36e5,Fb=864e5,Db=6048e5;function ov(e){return If(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,t){i.setDate(i.getDate()+t*7)},function(i,t){return(t-i-(t.getTimezoneOffset()-i.getTimezoneOffset())*I0)/Db})}var Py=ov(0),tg=ov(1),iI=ov(2),aI=ov(3),$v=ov(4),oI=ov(5),sI=ov(6),jR=Py.range,HR=tg.range,WR=iI.range,XR=aI.range,$R=$v.range,YR=oI.range,qR=sI.range,Bb=If(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*I0)/Fb},function(e){return e.getDate()-1}),Ry=Bb,KR=Bb.range,Nb=If(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*eg-e.getMinutes()*I0)},function(e,i){e.setTime(+e+i*Ob)},function(e,i){return(i-e)/Ob},function(e){return e.getHours()}),uI=Nb,QR=Nb.range,zb=If(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*eg)},function(e,i){e.setTime(+e+i*I0)},function(e,i){return(i-e)/I0},function(e){return e.getMinutes()}),lI=zb,JR=zb.range,Zb=If(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*eg)},function(e,i){return(i-e)/eg},function(e){return e.getUTCSeconds()}),cI=Zb,eL=Zb.range,rg=If(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});rg.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?If(function(i){i.setTime(Math.floor(i/e)*e)},function(i,t){i.setTime(+i+t*e)},function(i,t){return(t-i)/e}):rg};var fI=rg,tL=rg.range;function sv(e){return If(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,t){i.setUTCDate(i.getUTCDate()+t*7)},function(i,t){return(t-i)/Db})}var Ub=sv(0),ng=sv(1),hI=sv(2),pI=sv(3),Yv=sv(4),dI=sv(5),vI=sv(6),rL=Ub.range,nL=ng.range,iL=hI.range,aL=pI.range,oL=Yv.range,sL=dI.range,uL=vI.range,Vb=If(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/Fb},function(e){return e.getUTCDate()-1}),Gb=Vb,lL=Vb.range,Ly=If(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Ly.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:If(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,t){i.setUTCFullYear(i.getUTCFullYear()+t*e)})};var k0=Ly,cL=Ly.range;function Oy(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Fy(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function P0(e,i,t){return{y:e,m:i,d:t,H:0,M:0,S:0,L:0}}function mI(e){var i=e.dateTime,t=e.date,n=e.time,r=e.periods,o=e.days,u=e.shortDays,l=e.months,p=e.shortMonths,v=R0(r),E=L0(r),w=R0(o),M=L0(o),k=R0(u),D=L0(u),N=R0(l),V=L0(l),q=R0(p),fe=L0(p),he={a:Ds,A:js,b:vu,B:jf,c:null,d:Yb,e:Yb,f:zI,g:YI,G:KI,H:DI,I:BI,j:NI,L:qb,m:ZI,M:UI,p:J0,q:r0,Q:r2,s:n2,S:VI,u:GI,U:jI,V:HI,w:WI,W:XI,x:null,X:null,y:$I,Y:qI,Z:QI,"%":t2},Be={a:em,A:mg,b:Hy,B:gg,c:null,d:Qb,e:Qb,f:r6,g:h6,G:d6,H:JI,I:e6,j:t6,L:Jb,m:n6,M:i6,p:nR,q:iR,Q:r2,s:n2,S:a6,u:o6,U:s6,V:u6,w:l6,W:c6,x:null,X:null,y:f6,Y:p6,Z:v6,"%":t2},Ge={a:Rr,A:Tr,b:on,B:Hn,c:di,d:Xb,e:Xb,f:RI,g:Wb,G:Hb,H:$b,I:$b,j:MI,L:PI,m:TI,M:II,p:nr,q:CI,Q:OI,s:FI,S:kI,u:bI,U:EI,V:SI,w:xI,W:wI,x:za,X:Co,y:Wb,Y:Hb,Z:AI,"%":LI};he.x=St(t,he),he.X=St(n,he),he.c=St(i,he),Be.x=St(t,Be),Be.X=St(n,Be),Be.c=St(i,Be);function St(ea,Go){return function(ds){var ni=[],Hf=-1,mu=0,bh=ea.length,Eh,fv,jE;for(ds instanceof Date||(ds=new Date(+ds));++Hf<bh;)ea.charCodeAt(Hf)===37&&(ni.push(ea.slice(mu,Hf)),(fv=jb[Eh=ea.charAt(++Hf)])!=null?Eh=ea.charAt(++Hf):fv=Eh==="e"?" ":"0",(jE=Go[Eh])&&(Eh=jE(ds,fv)),ni.push(Eh),mu=Hf+1);return ni.push(ea.slice(mu,Hf)),ni.join("")}}function Ut(ea,Go){return function(ds){var ni=P0(1900,void 0,1),Hf=Yt(ni,ea,ds+="",0),mu,bh;if(Hf!=ds.length)return null;if("Q"in ni)return new Date(ni.Q);if("s"in ni)return new Date(ni.s*1e3+("L"in ni?ni.L:0));if(Go&&!("Z"in ni)&&(ni.Z=0),"p"in ni&&(ni.H=ni.H%12+ni.p*12),ni.m===void 0&&(ni.m="q"in ni?ni.q:0),"V"in ni){if(ni.V<1||ni.V>53)return null;"w"in ni||(ni.w=1),"Z"in ni?(mu=Fy(P0(ni.y,0,1)),bh=mu.getUTCDay(),mu=bh>4||bh===0?ng.ceil(mu):ng(mu),mu=Gb.offset(mu,(ni.V-1)*7),ni.y=mu.getUTCFullYear(),ni.m=mu.getUTCMonth(),ni.d=mu.getUTCDate()+(ni.w+6)%7):(mu=Oy(P0(ni.y,0,1)),bh=mu.getDay(),mu=bh>4||bh===0?tg.ceil(mu):tg(mu),mu=Ry.offset(mu,(ni.V-1)*7),ni.y=mu.getFullYear(),ni.m=mu.getMonth(),ni.d=mu.getDate()+(ni.w+6)%7)}else("W"in ni||"U"in ni)&&("w"in ni||(ni.w="u"in ni?ni.u%7:"W"in ni?1:0),bh="Z"in ni?Fy(P0(ni.y,0,1)).getUTCDay():Oy(P0(ni.y,0,1)).getDay(),ni.m=0,ni.d="W"in ni?(ni.w+6)%7+ni.W*7-(bh+5)%7:ni.w+ni.U*7-(bh+6)%7);return"Z"in ni?(ni.H+=ni.Z/100|0,ni.M+=ni.Z%100,Fy(ni)):Oy(ni)}}function Yt(ea,Go,ds,ni){for(var Hf=0,mu=Go.length,bh=ds.length,Eh,fv;Hf<mu;){if(ni>=bh)return-1;if(Eh=Go.charCodeAt(Hf++),Eh===37){if(Eh=Go.charAt(Hf++),fv=Ge[Eh in jb?Go.charAt(Hf++):Eh],!fv||(ni=fv(ea,ds,ni))<0)return-1}else if(Eh!=ds.charCodeAt(ni++))return-1}return ni}function nr(ea,Go,ds){var ni=v.exec(Go.slice(ds));return ni?(ea.p=E[ni[0].toLowerCase()],ds+ni[0].length):-1}function Rr(ea,Go,ds){var ni=k.exec(Go.slice(ds));return ni?(ea.w=D[ni[0].toLowerCase()],ds+ni[0].length):-1}function Tr(ea,Go,ds){var ni=w.exec(Go.slice(ds));return ni?(ea.w=M[ni[0].toLowerCase()],ds+ni[0].length):-1}function on(ea,Go,ds){var ni=q.exec(Go.slice(ds));return ni?(ea.m=fe[ni[0].toLowerCase()],ds+ni[0].length):-1}function Hn(ea,Go,ds){var ni=N.exec(Go.slice(ds));return ni?(ea.m=V[ni[0].toLowerCase()],ds+ni[0].length):-1}function di(ea,Go,ds){return Yt(ea,i,Go,ds)}function za(ea,Go,ds){return Yt(ea,t,Go,ds)}function Co(ea,Go,ds){return Yt(ea,n,Go,ds)}function Ds(ea){return u[ea.getDay()]}function js(ea){return o[ea.getDay()]}function vu(ea){return p[ea.getMonth()]}function jf(ea){return l[ea.getMonth()]}function J0(ea){return r[+(ea.getHours()>=12)]}function r0(ea){return 1+~~(ea.getMonth()/3)}function em(ea){return u[ea.getUTCDay()]}function mg(ea){return o[ea.getUTCDay()]}function Hy(ea){return p[ea.getUTCMonth()]}function gg(ea){return l[ea.getUTCMonth()]}function nR(ea){return r[+(ea.getUTCHours()>=12)]}function iR(ea){return 1+~~(ea.getUTCMonth()/3)}return{format:function(ea){var Go=St(ea+="",he);return Go.toString=function(){return ea},Go},parse:function(ea){var Go=Ut(ea+="",!1);return Go.toString=function(){return ea},Go},utcFormat:function(ea){var Go=St(ea+="",Be);return Go.toString=function(){return ea},Go},utcParse:function(ea){var Go=Ut(ea+="",!0);return Go.toString=function(){return ea},Go}}}var jb={"-":"",_:" ","0":"0"},dc=/^\s*\d+/,gI=/^%/,yI=/[\\^$*+?|[\]().{}]/g;function ps(e,i,t){var n=e<0?"-":"",r=(n?-e:e)+"",o=r.length;return n+(o<t?new Array(t-o+1).join(i)+r:r)}function _I(e){return e.replace(yI,"\\$&")}function R0(e){return new RegExp("^(?:"+e.map(_I).join("|")+")","i")}function L0(e){for(var i={},t=-1,n=e.length;++t<n;)i[e[t].toLowerCase()]=t;return i}function xI(e,i,t){var n=dc.exec(i.slice(t,t+1));return n?(e.w=+n[0],t+n[0].length):-1}function bI(e,i,t){var n=dc.exec(i.slice(t,t+1));return n?(e.u=+n[0],t+n[0].length):-1}function EI(e,i,t){var n=dc.exec(i.slice(t,t+2));return n?(e.U=+n[0],t+n[0].length):-1}function SI(e,i,t){var n=dc.exec(i.slice(t,t+2));return n?(e.V=+n[0],t+n[0].length):-1}function wI(e,i,t){var n=dc.exec(i.slice(t,t+2));return n?(e.W=+n[0],t+n[0].length):-1}function Hb(e,i,t){var n=dc.exec(i.slice(t,t+4));return n?(e.y=+n[0],t+n[0].length):-1}function Wb(e,i,t){var n=dc.exec(i.slice(t,t+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),t+n[0].length):-1}function AI(e,i,t){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(t,t+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),t+n[0].length):-1}function CI(e,i,t){var n=dc.exec(i.slice(t,t+1));return n?(e.q=n[0]*3-3,t+n[0].length):-1}function TI(e,i,t){var n=dc.exec(i.slice(t,t+2));return n?(e.m=n[0]-1,t+n[0].length):-1}function Xb(e,i,t){var n=dc.exec(i.slice(t,t+2));return n?(e.d=+n[0],t+n[0].length):-1}function MI(e,i,t){var n=dc.exec(i.slice(t,t+3));return n?(e.m=0,e.d=+n[0],t+n[0].length):-1}function $b(e,i,t){var n=dc.exec(i.slice(t,t+2));return n?(e.H=+n[0],t+n[0].length):-1}function II(e,i,t){var n=dc.exec(i.slice(t,t+2));return n?(e.M=+n[0],t+n[0].length):-1}function kI(e,i,t){var n=dc.exec(i.slice(t,t+2));return n?(e.S=+n[0],t+n[0].length):-1}function PI(e,i,t){var n=dc.exec(i.slice(t,t+3));return n?(e.L=+n[0],t+n[0].length):-1}function RI(e,i,t){var n=dc.exec(i.slice(t,t+6));return n?(e.L=Math.floor(n[0]/1e3),t+n[0].length):-1}function LI(e,i,t){var n=gI.exec(i.slice(t,t+1));return n?t+n[0].length:-1}function OI(e,i,t){var n=dc.exec(i.slice(t));return n?(e.Q=+n[0],t+n[0].length):-1}function FI(e,i,t){var n=dc.exec(i.slice(t));return n?(e.s=+n[0],t+n[0].length):-1}function Yb(e,i){return ps(e.getDate(),i,2)}function DI(e,i){return ps(e.getHours(),i,2)}function BI(e,i){return ps(e.getHours()%12||12,i,2)}function NI(e,i){return ps(1+Ry.count(Xv(e),e),i,3)}function qb(e,i){return ps(e.getMilliseconds(),i,3)}function zI(e,i){return qb(e,i)+"000"}function ZI(e,i){return ps(e.getMonth()+1,i,2)}function UI(e,i){return ps(e.getMinutes(),i,2)}function VI(e,i){return ps(e.getSeconds(),i,2)}function GI(e){var i=e.getDay();return i===0?7:i}function jI(e,i){return ps(Py.count(Xv(e)-1,e),i,2)}function Kb(e){var i=e.getDay();return i>=4||i===0?$v(e):$v.ceil(e)}function HI(e,i){return e=Kb(e),ps($v.count(Xv(e),e)+(Xv(e).getDay()===4),i,2)}function WI(e){return e.getDay()}function XI(e,i){return ps(tg.count(Xv(e)-1,e),i,2)}function $I(e,i){return ps(e.getFullYear()%100,i,2)}function YI(e,i){return e=Kb(e),ps(e.getFullYear()%100,i,2)}function qI(e,i){return ps(e.getFullYear()%1e4,i,4)}function KI(e,i){var t=e.getDay();return e=t>=4||t===0?$v(e):$v.ceil(e),ps(e.getFullYear()%1e4,i,4)}function QI(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+ps(i/60|0,"0",2)+ps(i%60,"0",2)}function Qb(e,i){return ps(e.getUTCDate(),i,2)}function JI(e,i){return ps(e.getUTCHours(),i,2)}function e6(e,i){return ps(e.getUTCHours()%12||12,i,2)}function t6(e,i){return ps(1+Gb.count(k0(e),e),i,3)}function Jb(e,i){return ps(e.getUTCMilliseconds(),i,3)}function r6(e,i){return Jb(e,i)+"000"}function n6(e,i){return ps(e.getUTCMonth()+1,i,2)}function i6(e,i){return ps(e.getUTCMinutes(),i,2)}function a6(e,i){return ps(e.getUTCSeconds(),i,2)}function o6(e){var i=e.getUTCDay();return i===0?7:i}function s6(e,i){return ps(Ub.count(k0(e)-1,e),i,2)}function e2(e){var i=e.getUTCDay();return i>=4||i===0?Yv(e):Yv.ceil(e)}function u6(e,i){return e=e2(e),ps(Yv.count(k0(e),e)+(k0(e).getUTCDay()===4),i,2)}function l6(e){return e.getUTCDay()}function c6(e,i){return ps(ng.count(k0(e)-1,e),i,2)}function f6(e,i){return ps(e.getUTCFullYear()%100,i,2)}function h6(e,i){return e=e2(e),ps(e.getUTCFullYear()%100,i,2)}function p6(e,i){return ps(e.getUTCFullYear()%1e4,i,4)}function d6(e,i){var t=e.getUTCDay();return e=t>=4||t===0?Yv(e):Yv.ceil(e),ps(e.getUTCFullYear()%1e4,i,4)}function v6(){return"+0000"}function t2(){return"%"}function r2(e){return+e}function n2(e){return Math.floor(+e/1e3)}var qv,i2,m6,g6,y6;_6({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function _6(e){return qv=mI(e),i2=qv.format,m6=qv.parse,g6=qv.utcFormat,y6=qv.utcParse,qv}var O0=1e3,F0=O0*60,D0=F0*60,B0=D0*24,x6=B0*7,a2=B0*30,Dy=B0*365;function b6(e){return new Date(e)}function E6(e){return e instanceof Date?+e:+new Date(+e)}function o2(e,i,t,n,r,o,u,l,p){var v=pb(Qc,Qc),E=v.invert,w=v.domain,M=p(".%L"),k=p(":%S"),D=p("%I:%M"),N=p("%I %p"),V=p("%a %d"),q=p("%b %d"),fe=p("%B"),he=p("%Y"),Be=[[u,1,O0],[u,5,5*O0],[u,15,15*O0],[u,30,30*O0],[o,1,F0],[o,5,5*F0],[o,15,15*F0],[o,30,30*F0],[r,1,D0],[r,3,3*D0],[r,6,6*D0],[r,12,12*D0],[n,1,B0],[n,2,2*B0],[t,1,x6],[i,1,a2],[i,3,3*a2],[e,1,Dy]];function Ge(Ut){return(u(Ut)<Ut?M:o(Ut)<Ut?k:r(Ut)<Ut?D:n(Ut)<Ut?N:i(Ut)<Ut?t(Ut)<Ut?V:q:e(Ut)<Ut?fe:he)(Ut)}function St(Ut,Yt,nr,Rr){if(Ut==null&&(Ut=10),typeof Ut=="number"){var Tr=Math.abs(nr-Yt)/Ut,on=Kx(function(Hn){return Hn[2]}).right(Be,Tr);on===Be.length?(Rr=by(Yt/Dy,nr/Dy,Ut),Ut=e):on?(on=Be[Tr/Be[on-1][2]<Be[on][2]/Tr?on-1:on],Rr=on[1],Ut=on[0]):(Rr=Math.max(by(Yt,nr,Ut),1),Ut=l)}return Rr==null?Ut:Ut.every(Rr)}return v.invert=function(Ut){return new Date(E(Ut))},v.domain=function(Ut){return arguments.length?w(ob.call(Ut,E6)):w().map(b6)},v.ticks=function(Ut,Yt){var nr=w(),Rr=nr[0],Tr=nr[nr.length-1],on=Tr<Rr,Hn;return on&&(Hn=Rr,Rr=Tr,Tr=Hn),Hn=St(Ut,Rr,Tr,Yt),Hn=Hn?Hn.range(Rr,Tr+1):[],on?Hn.reverse():Hn},v.tickFormat=function(Ut,Yt){return Yt==null?Ge:p(Yt)},v.nice=function(Ut,Yt){var nr=w();return(Ut=St(Ut,nr[0],nr[nr.length-1],Yt))?w(Eb(nr,Ut)):v},v.copy=function(){return qm(v,o2(e,i,t,n,r,o,u,l,p))},v}function S6(){return Bd.apply(o2(Xv,nI,Py,Ry,uI,lI,cI,fI,i2).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function fL(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function ig(){var e=0,i=1,t,n,r,o,u=Qc,l=!1,p;function v(E){return isNaN(E=+E)?p:u(r===0?.5:(E=(o(E)-t)*r,l?Math.max(0,Math.min(1,E)):E))}return v.domain=function(E){return arguments.length?(t=o(e=+E[0]),n=o(i=+E[1]),r=t===n?0:1/(n-t),v):[e,i]},v.clamp=function(E){return arguments.length?(l=!!E,v):l},v.interpolator=function(E){return arguments.length?(u=E,v):u},v.unknown=function(E){return arguments.length?(p=E,v):p},function(E){return o=E,t=E(e),n=E(i),r=t===n?0:1/(n-t),v}}function N0(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function s2(){var e=M0(ig()(Qc));return e.copy=function(){return N0(e,s2())},sb.apply(e,arguments)}function w6(){var e=loggish(ig()).domain([1,10]);return e.copy=function(){return N0(e,w6()).base(e.base())},initInterpolator.apply(e,arguments)}function A6(){var e=symlogish(ig());return e.copy=function(){return N0(e,A6()).constant(e.constant())},initInterpolator.apply(e,arguments)}function u2(){var e=powish(ig());return e.copy=function(){return N0(e,u2()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function hL(){return u2.apply(null,arguments).exponent(.5)}function C6(){var e=[],i=identity;function t(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return t.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var r=0,o=n.length,u;r<o;++r)u=n[r],u!=null&&!isNaN(u=+u)&&e.push(u);return e.sort(ascending),t},t.interpolator=function(n){return arguments.length?(i=n,t):i},t.copy=function(){return C6(i).domain(e)},initInterpolator.apply(t,arguments)}function ag(){var e=0,i=.5,t=1,n,r,o,u,l,p=Qc,v,E=!1,w;function M(k){return isNaN(k=+k)?w:(k=.5+((k=+v(k))-r)*(k<r?u:l),p(E?Math.max(0,Math.min(1,k)):k))}return M.domain=function(k){return arguments.length?(n=v(e=+k[0]),r=v(i=+k[1]),o=v(t=+k[2]),u=n===r?0:.5/(r-n),l=r===o?0:.5/(o-r),M):[e,i,t]},M.clamp=function(k){return arguments.length?(E=!!k,M):E},M.interpolator=function(k){return arguments.length?(p=k,M):p},M.unknown=function(k){return arguments.length?(w=k,M):w},function(k){return v=k,n=k(e),r=k(i),o=k(t),u=n===r?0:.5/(r-n),l=r===o?0:.5/(o-r),M}}function l2(){var e=M0(ag()(Qc));return e.copy=function(){return N0(e,l2())},sb.apply(e,arguments)}function T6(){var e=loggish(ag()).domain([.1,1,10]);return e.copy=function(){return copy(e,T6()).base(e.base())},initInterpolator.apply(e,arguments)}function M6(){var e=symlogish(ag());return e.copy=function(){return copy(e,M6()).constant(e.constant())},initInterpolator.apply(e,arguments)}function c2(){var e=powish(ag());return e.copy=function(){return copy(e,c2()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function pL(){return c2.apply(null,arguments).exponent(.5)}function f2(e){var i,t=[];function n(r){return r==null?i:r}return n.invert=n,n.domain=n.range=function(r){return r?(t=r,r):t},n.unknown=function(r){return r?(i=r,r):i},n.copy=function(){return f2(e).unknown(i)},n}var xh,h2,p2,I6=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,k6=(xh={},(0,J.Z)(xh,Ts.LINEAR,bb),(0,J.Z)(xh,Ts.POWER,Ty),(0,J.Z)(xh,Ts.LOG,Cb),(0,J.Z)(xh,Ts.IDENTITY,f2),(0,J.Z)(xh,Ts.SEQUENTIAL,s2),(0,J.Z)(xh,Ts.TIME,S6),(0,J.Z)(xh,Ts.QUANTILE,kb),(0,J.Z)(xh,Ts.QUANTIZE,Pb),(0,J.Z)(xh,Ts.THRESHOLD,Rb),(0,J.Z)(xh,Ts.CAT,Ym),(0,J.Z)(xh,Ts.DIVERGING,l2),xh),P6=(h2=(0,kn.b2)(),h2(p2=function(){function e(){(0,Ht.Z)(this,e),(0,J.Z)(this,"scaleOptions",{})}return(0,tr.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.styleAttributeService;t.hooks.init.tapPromise("FeatureScalePlugin",(0,ot.Z)(se().mark(function u(){var l,p,v;return se().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(t.log(Cl.ScaleInitStart,Tl.INIT),r.scaleOptions=t.getScaleOptions(),p=o.getLayerStyleAttributes(),v=(l=t.getSource())===null||l===void 0?void 0:l.data.dataArray,!(Array.isArray(v)&&v.length===0)){w.next=8;break}return w.abrupt("return");case 8:r.caculateScalesForAttributes(p||[],v);case 9:t.log(Cl.ScaleInitEnd,Tl.INIT);case 10:case"end":return w.stop()}},u)}))),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var u=(0,ot.Z)(se().mark(function l(p){var v,E;return se().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(p){M.next=2;break}return M.abrupt("return",p);case 2:if(t.log(Cl.ScaleInitStart,Tl.UPDATE),r.scaleOptions=t.getScaleOptions(),v=o.getLayerStyleAttributes(),E=t.getSource().data.dataArray,!(Array.isArray(E)&&E.length===0)){M.next=8;break}return M.abrupt("return",!0);case 8:return r.caculateScalesForAttributes(v||[],E),t.log(Cl.ScaleInitEnd,Tl.UPDATE),t.layerModelNeedUpdate=!0,M.abrupt("return",!0);case 12:case"end":return M.stop()}},l)}));return function(l){return u.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){r.scaleOptions=t.getScaleOptions();var u=o.getLayerStyleAttributes(),l=t.getSource().data.dataArray;if(!(Array.isArray(l)&&l.length===0)&&u){var p=u.filter(function(v){return v.needRescale});p.length&&r.caculateScalesForAttributes(p,l)}}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,n){var r=this;t.forEach(function(o){if(o.scale){var u=o.scale;u.names=r.parseFields(o.scale.field||[]);var l=[];u.names.forEach(function(p){var v;l.push(r.createScale(p,o.name,(v=o.scale)===null||v===void 0?void 0:v.values,n))}),l.some(function(p){return p.type===Rd.VARIABLE})?(u.type=Rd.VARIABLE,l.forEach(function(p){var v;if(!u.callback&&u.values!=="text")switch((v=p.option)===null||v===void 0?void 0:v.type){case Ts.LOG:case Ts.LINEAR:case Ts.POWER:if(u.values&&u.values.length>2){var E=p.scale.ticks(u.values.length);p.scale.domain(E)}u.values?p.scale.range(u.values):p.scale.range(p.option.domain);break;case Ts.QUANTILE:case Ts.QUANTIZE:case Ts.THRESHOLD:p.scale.range(u.values);break;case Ts.IDENTITY:break;case Ts.CAT:u.values?p.scale.range(u.values):p.scale.range(p.option.domain);break;case Ts.DIVERGING:case Ts.SEQUENTIAL:p.scale.interpolator(E4.hD(u.values));break}if(u.values==="text"){var w;p.scale.range((w=p.option)===null||w===void 0?void 0:w.domain)}})):(u.type=Rd.CONSTANT,u.defaultValues=l.map(function(p,v){return p.scale(u.names[v])})),u.scalers=l.map(function(p){return{field:p.field,func:p.scale,option:p.option}}),o.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:(0,f.isString)(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,n,r,o){var u,l,p=this.scaleOptions[n]&&((u=this.scaleOptions[n])===null||u===void 0?void 0:u.field)===t?this.scaleOptions[n]:this.scaleOptions[t],v={field:t,scale:void 0,type:Rd.VARIABLE,option:p};if(!o||!o.length)return p&&p.type?v.scale=this.createDefaultScale(p):(v.scale=Ym([t]),v.type=Rd.CONSTANT),v;var E=(l=o.find(function(k){return!(0,f.isNil)(k[t])}))===null||l===void 0?void 0:l[t];if(this.isNumber(t)||(0,f.isNil)(E)&&!p)v.scale=Ym([t]),v.type=Rd.CONSTANT;else{var w=p&&p.type||this.getDefaultType(E);r==="text"&&(w=Ts.CAT);var M=this.createScaleConfig(w,t,p,o);v.scale=this.createDefaultScale(M),v.option=M}return v}},{key:"getDefaultType",value:function(t){var n=Ts.LINEAR;return typeof t=="string"&&(n=I6.test(t)?Ts.TIME:Ts.CAT),n}},{key:"createScaleConfig",value:function(t,n,r,o){var u={type:t},l=(o==null?void 0:o.map(function(E){return E[n]}))||[];if(r!=null&&r.domain)u.domain=r==null?void 0:r.domain;else if(t===Ts.CAT||t===Ts.IDENTITY)u.domain=(0,f.uniq)(l);else if(t===Ts.QUANTILE)u.domain=l;else if(t===Ts.DIVERGING){var p=Jx(l),v=(r==null?void 0:r.neutral)!==void 0?r==null?void 0:r.neutral:(p[0]+p[1])/2;u.domain=[p[0],v,p[1]]}else u.domain=Jx(l);return(0,U.Z)((0,U.Z)({},u),r)}},{key:"createDefaultScale",value:function(t){var n=t.type,r=t.domain,o=t.unknown,u=t.clamp,l=t.nice,p=k6[n]();return r&&p.domain&&p.domain(r),o&&p.unknown(o),u!==void 0&&p.clamp&&p.clamp(u),l!==void 0&&p.nice&&p.nice(l),p}}]),e}())||p2),d2,v2,R6=(d2=(0,kn.b2)(),d2(v2=function(){function e(){(0,Ht.Z)(this,e)}return(0,tr.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=t.animateStatus;n&&t.models.forEach(function(r){r.addUniforms((0,U.Z)({},t.layerModel.getAnimateUniforms()))})})}}]),e}())||v2),L6=function(){function e(i){var t=i.rendererService,n=i.layerService,r=i.parent;(0,Ht.Z)(this,e),(0,J.Z)(this,"tileResource",new Map),(0,J.Z)(this,"layerTiles",[]),this.rendererService=t,this.layerService=n,this.parent=r}return(0,tr.Z)(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(t){return this.layerTiles.some(function(n){return n.key===t})}},{key:"addTile",value:function(t){this.layerTiles.push(t)}},{key:"getTile",value:function(t){return this.layerTiles.find(function(n){return n.key===t})}},{key:"getVisibleTileBylngLat",value:function(t){return this.layerTiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(t)})}},{key:"removeTile",value:function(t){var n=this.layerTiles.findIndex(function(o){return o.key===t}),r=this.layerTiles.splice(n,1);r[0]&&r[0].destroy()}},{key:"updateTileVisible",value:function(t){var n=this.getTile(t.key);n==null||n.updateVisible(t.isVisible)}},{key:"isParentLoaded",value:function(t){var n=t.parent;if(!n)return!0;var r=this.getTile(n==null?void 0:n.key);return!!(r!=null&&r.isLoaded)}},{key:"isChildrenLoaded",value:function(t){var n=this,r=t==null?void 0:t.children;return r.length===0?!0:r.some(function(o){var u=n.getTile(o==null?void 0:o.key);return(u==null?void 0:u.isLoaded)===!1})}},{key:"render",value:function(){var i=(0,ot.Z)(se().mark(function n(){var r=this,o;return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:o=this.getRenderLayers(),o.map(function(){var p=(0,ot.Z)(se().mark(function v(E){return se().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,r.layerService.renderLayer(E);case 2:case"end":return M.stop()}},v)}));return function(v){return p.apply(this,arguments)}}());case 2:case"end":return l.stop()}},n,this)}));function t(){return i.apply(this,arguments)}return t}()},{key:"getRenderLayers",value:function(){var t=this.layerTiles.filter(function(r){return r.visible&&r.isLoaded}),n=[];return t.map(function(r){return n.push.apply(n,(0,H.Z)(r.getLayers()))}),n}},{key:"getLayers",value:function(){var t=this.layerTiles.filter(function(r){return r.isLoaded}),n=[];return t.map(function(r){return n.push.apply(n,(0,H.Z)(r.getLayers()))}),n}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach(function(t){return t.destroy()}),this.tileResource.clear()}}]),e}(),O6=ie(32676);function F6(e,i,t){t===void 0&&(t={});var n=mn(e),r=mn(i),o=O6.union(n.coordinates,r.coordinates);return o.length===0?null:o.length===1?ii(o[0],t.properties):Yn(o,t.properties)}var D6=F6,B6=function(){function e(){(0,Ht.Z)(this,e)}return(0,tr.Z)(e,[{key:"getCombineFeature",value:function(t){var n=null,r=t[0];return t.map(function(o){var u=ii(o.coordinates);n===null?n=u:n=D6(n,u)}),r&&(n.properties=(0,U.Z)({},r)),n}}]),e}(),z0="select",Z0="active",N6=function(){function e(i){var t=i.layerService,n=i.tileLayerService,r=i.parent;(0,Ht.Z)(this,e),(0,J.Z)(this,"tilePickID",new Map),this.layerService=t,this.tileLayerService=n,this.parent=r,this.tileSourceService=new B6}return(0,tr.Z)(e,[{key:"pickRender",value:function(t){var n=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(n){var r=n.getMainLayer();r==null||r.layerPickService.pickRender(t)}}},{key:"pick",value:function(t,n){var r=this.parent.getContainer(),o=r.get(fr.IPickingService);if(t.type==="RasterLayer"){var u=this.tileLayerService.getVisibleTileBylngLat(n.lngLat);if(u&&u.getMainLayer()!==void 0){var l=u.getMainLayer();return l.layerPickService.pickRasterLayer(l,n,this.parent)}return!1}return this.pickRender(n),o.pickFromPickingFBO(t,n)}},{key:"selectFeature",value:function(t){var n=(0,Ti.Z)(t,3),r=n[0],o=n[1],u=n[2],l=this.color2PickId(r,o,u);this.tilePickID.set(z0,l),this.updateHighLight(r,o,u,z0)}},{key:"highlightPickedFeature",value:function(t){var n=(0,Ti.Z)(t,3),r=n[0],o=n[1],u=n[2],l=this.color2PickId(r,o,u);this.tilePickID.set(Z0,l),this.updateHighLight(r,o,u,Z0)}},{key:"updateHighLight",value:function(t,n,r,o){this.tileLayerService.tiles.map(function(u){var l=u.getMainLayer();switch(o){case z0:l==null||l.hooks.beforeSelect.call([t,n,r]);break;case Z0:l==null||l.hooks.beforeHighlight.call([t,n,r]);break}})}},{key:"setPickState",value:function(){var t=this.tilePickID.get(z0),n=this.tilePickID.get(Z0);if(t){var r=this.pickId2Color(t),o=(0,Ti.Z)(r,3),u=o[0],l=o[1],p=o[2];this.updateHighLight(u,l,p,z0);return}if(n){var v=this.pickId2Color(n),E=(0,Ti.Z)(v,3),w=E[0],M=E[1],k=E[2];this.updateHighLight(w,M,k,Z0);return}}},{key:"color2PickId",value:function(t,n,r){return Ll(new Uint8Array([t,n,r]))}},{key:"pickId2Color",value:function(t){return Zu(t)}},{key:"getFeatureById",value:function(t){var n=this.tileLayerService.getTiles().filter(function(o){return o.visible}),r=[];return n.forEach(function(o){r.push.apply(r,(0,H.Z)(o.getFeatureById(t)))}),r}},{key:"pickRasterLayer",value:function(t,n,r){return!1}}]),e}(),z6=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive"];function Z6(e){return e==="PolygonLayer"?dy:e==="LineLayer"?hy:Vm}function U6(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}var uv=function(){function e(i,t){(0,Ht.Z)(this,e),(0,J.Z)(this,"visible",!0),(0,J.Z)(this,"layers",[]),(0,J.Z)(this,"isLoaded",!1),this.parent=t,this.sourceTile=i,this.x=i.x,this.y=i.y,this.z=i.z,this.key="".concat(this.x,"_").concat(this.y,"_").concat(this.z)}return(0,tr.Z)(e,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(t){var n=(0,Ti.Z)(this.sourceTile.bounds,4),r=n[0],o=n[1],u=n[2],l=n[3],p=t.lng,v=t.lat;return p>=r&&p<=u&&v>=o&&v<=l}},{key:"getLayerOptions",value:function(){var t=this.parent.getLayerConfig();return(0,U.Z)((0,U.Z)({},t),{},{autoFit:!1,mask:U6(this.parent.type)||t.mask})}},{key:"addMask",value:function(){var i=(0,ot.Z)(se().mark(function n(r,o){var u;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=Pm(this.parent.sceneContainer),o.setContainer(u,this.parent.sceneContainer),p.next=4,o.init();case 4:r.addMaskLayer(o);case 5:case"end":return p.stop()}},n,this)}));function t(n,r){return i.apply(this,arguments)}return t}()},{key:"addLayer",value:function(){var i=(0,ot.Z)(se().mark(function n(r){var o;return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return r.isTileLayer=!0,o=Pm(this.parent.sceneContainer),r.setContainer(o,this.parent.sceneContainer),this.layers.push(r),l.next=6,r.init();case 6:case"end":return l.stop()}},n,this)}));function t(n){return i.apply(this,arguments)}return t}()},{key:"updateVisible",value:function(t){this.visible=t,this.updateOptions("visible",t)}},{key:"updateOptions",value:function(t,n){this.layers.forEach(function(r){r.updateLayerConfig((0,J.Z)({},t,n))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(t){return[]}},{key:"getFeatureById",value:function(t){return[]}},{key:"destroy",value:function(){this.layers.forEach(function(t){return t.destroy()})}}]),e}();function V6(e){var i=G6();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function G6(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j6=function(e){(0,Fr.Z)(t,e);var i=V6(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v;return se().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return u=this.getSourceOption(),l=u.data.features[0].properties,p=new hy().source(u.data,u.options).size(1).shape("line").color("red"),v=new Vm({minZoom:this.z-1,maxZoom:this.z+1}).source([l],{parser:{type:"json",x:"textLng",y:"textLat"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),w.next=6,this.addLayer(p);case 6:return w.next=8,this.addLayer(v);case 8:this.isLoaded=!0;case 9:case"end":return w.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getSourceOption",value:function(){var r=this.parent.getSource(),o=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:o},options:{parser:{type:"geojson"},transforms:r.transforms}}}}]),t}(uv);function H6(e){var i=W6();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function W6(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X6=function(e){(0,Fr.Z)(t,e);var i=H6(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v;return se().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new mx((0,U.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(M){var k,D,N=M;v[N]((k=u[N])===null||k===void 0?void 0:k.field,(D=u[N])===null||D===void 0?void 0:D.values)}),w.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return w.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getSourceOption",value:function(){var r=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:r.transforms}}}}]),t}(uv);function $6(e){var i=Y6();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function Y6(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q6=function(e){(0,Fr.Z)(t,e);var i=$6(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v;return se().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new vy((0,U.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(M){var k,D,N=M;v[N]((k=u[N])===null||k===void 0?void 0:k.field,(D=u[N])===null||D===void 0?void 0:D.values)}),w.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return w.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getFeatures",value:function(r){if(!r)return[];var o=this.sourceTile.data;return o.getTileData(r)}},{key:"getSourceOption",value:function(){var r=this.parent.getSource(),o=this.parent.getLayerConfig(),u=o.sourceLayer,l=o.featureId,p=this.getFeatures(u);return{data:{type:"FeatureCollection",features:p},options:{parser:{type:"geojson",featureId:l},transforms:r.transforms}}}}]),t}(uv),K6=["rasterData"];function Q6(e){var i=J6();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function J6(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ek=function(e){(0,Fr.Z)(t,e);var i=Q6(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v;return se().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new Gm((0,U.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(M){var k,D,N=M;v[N]((k=u[N])===null||k===void 0?void 0:k.field,(D=u[N])===null||D===void 0?void 0:D.values)}),w.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return w.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getSourceOption",value:function(){var r=this.parent.getSource(),o=this.sourceTile.data.data,u=o.rasterData,l=(0,Af.Z)(o,K6);return{data:u,options:{parser:(0,U.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},l),transforms:r.transforms}}}}]),t}(uv);function tk(e){var i=rk();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function rk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nk=function(e){(0,Fr.Z)(t,e);var i=tk(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v;return se().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new Gm((0,U.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(M){var k,D,N=M;v[N]((k=u[N])===null||k===void 0?void 0:k.field,(D=u[N])===null||D===void 0?void 0:D.values)}),w.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return w.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getSourceOption",value:function(){var r=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:r.transforms}}}}]),t}(uv),ik=["rasterData"];function ak(e){var i=ok();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function ok(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sk={positions:[0,1],colors:["#000","#fff"]},uk=function(e){(0,Fr.Z)(t,e);var i=ak(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E,w,M;return se().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=this.getLayerOptions(),E=v.rampColors,w=v.domain,this.colorTexture=this.parent.textureService.getColorTexture(E,w),M=new Gm((0,U.Z)((0,U.Z)({},l),{},{colorTexture:this.colorTexture})).source(p.data,p.options),u&&Object.keys(u).forEach(function(N){var V,q,fe=N;M[fe]((V=u[fe])===null||V===void 0?void 0:V.field,(q=u[fe])===null||q===void 0?void 0:q.values)}),D.next=9,this.addLayer(M);case 9:this.isLoaded=!0;case 10:case"end":return D.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getSourceOption",value:function(){var r=this.parent.getSource(),o=this.sourceTile.data.data,u=o.rasterData,l=(0,Af.Z)(o,ik);return{data:u,options:{parser:(0,U.Z)({type:"raster",extent:this.sourceTile.bounds},l),transforms:r.transforms}}}},{key:"styleUpdate",value:function(){for(var r=this,o=arguments.length,u=new Array(o),l=0;l<o;l++)u[l]=arguments[l];var p=u,v=p.rampColors,E=v===void 0?sk:v,w=p.domain;this.colorTexture=this.parent.textureService.getColorTexture(E,w||ul(E)),this.layers.forEach(function(M){return M.style({colorTexture:r.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(r){return r.destroy()})}}]),t}(uv);function lk(e){var i=ck();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function ck(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var og=function(e){(0,Fr.Z)(t,e);var i=lk(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u,l,p,v,E;return se().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=Z6(this.parent.type),v=this.getSourceOption(),v){M.next=7;break}return this.isLoaded=!0,M.abrupt("return");case 7:if(E=new p((0,U.Z)({},l)).source(v.data,v.options),Object.keys(u).forEach(function(k){var D,N,V=k;E[V]((D=u[V])===null||D===void 0?void 0:D.field,(N=u[V])===null||N===void 0?void 0:N.values)}),!l.mask){M.next=12;break}return M.next=12,this.addTileMask(E);case 12:return M.next=14,this.addLayer(E);case 14:this.setLayerMinMaxZoom(E),this.isLoaded=!0;case 16:case"end":return M.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"addTileMask",value:function(){var n=(0,ot.Z)(se().mark(function o(u){var l;return se().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l=new vy({layerType:"MaskLayer"}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}),v.next=3,this.addMask(u,l);case 3:case"end":return v.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"getSourceOption",value:function(){var r=this.parent.getSource(),o=this.parent.getLayerConfig(),u=o.sourceLayer,l=u===void 0?"defaultLayer":u,p=o.featureId,v=p===void 0?"id":p,E=this.getFeatures(l);return{data:{type:"FeatureCollection",features:E},options:{parser:{type:"geojson",featureId:v},transforms:r.transforms}}}},{key:"setLayerMinMaxZoom",value:function(r){r.getModelType()==="text"&&r.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(r){var o=this.sourceTile.data;return o.getTileData(r)}},{key:"getFeatureById",value:function(r){var o=this.getMainLayer();if(!o)return[];var u=o.getSource().data.dataArray.filter(function(l){return l._id===r});return u}}]),t}(uv);function fk(e){var i=e.type;switch(i){case"PolygonLayer":return og;case"LineLayer":return og;case"PointLayer":return og;case"TileDebugLayer":return j6;case"MaskLayer":return q6;case"RasterLayer":var t=e.getSource().parser.dataType;switch(t){case"rgb":case"customRGB":return ek;case"arraybuffer":case"customArrayBuffer":return uk;case"terrainRGB":return nk;default:return X6}default:return og}}var m2=function(){function e(i){(0,Ht.Z)(this,e),(0,J.Z)(this,"initedTileset",!1),(0,J.Z)(this,"viewchange",(0,f.debounce)(this.mapchange,24)),this.parent=i;var t=this.parent.getContainer();this.rendererService=t.get(fr.IRendererService),this.layerService=t.get(fr.ILayerService),this.mapService=t.get(fr.IMapService),this.pickingService=t.get(fr.IPickingService),this.tileLayerService=new L6({rendererService:this.rendererService,layerService:this.layerService,parent:i}),this.tilePickService=new N6({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:i}),this.parent.setLayerPickService(this.tilePickService),this.proxy(i),this.initTileSetManager()}return(0,tr.Z)(e,[{key:"initTileSetManager",value:function(){var t,n=this.parent.getSource();this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var r=this.getCurrentView(),o=r.latLonBounds,u=r.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(u,o)}},{key:"mapchange",value:function(){var t,n=this.getCurrentView(),r=n.latLonBounds,o=n.zoom;if(this.mapService.version==="GAODE1.x"){var u=this.parent.getLayerConfig(),l=u.visible;o<2&&l?(this.parent.updateLayerConfig({visible:!1}),this.layerService.reRender()):o>=2&&!l&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.reRender())}this.lastViewStates&&this.lastViewStates.zoom===o&&this.lastViewStates.latLonBounds.toString()===r.toString()||(this.lastViewStates={zoom:o,latLonBounds:r},(t=this.tilesetManager)===null||t===void 0||t.throttleUpdate(o,r))}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),n=[t[0][0],t[0][1],t[1][0],t[1][1]],r=this.mapService.getZoom();return{latLonBounds:n,zoom:r}}},{key:"bindTilesetEvent",value:function(){var t=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){t.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,r){t.tileError(n)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",function(){return t.mapchange()}),this.mapService.on("moveend",function(){return t.viewchange()})}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"destroy",value:function(){var t;(t=this.tilesetManager)===null||t===void 0||t.destroy(),this.tileLayerService.destroy()}},{key:"tileUnLoad",value:function(t){this.tileLayerService.removeTile(t.key)}},{key:"tileUpdate",value:function(){var i=(0,ot.Z)(se().mark(function n(){var r=this,o,u;return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.tilesetManager){p.next=2;break}return p.abrupt("return");case 2:return o=this.parent.getMinZoom(),u=this.parent.getMaxZoom(),p.next=6,Promise.all(this.tilesetManager.tiles.filter(function(v){return v.isLoaded}).filter(function(v){return v.isVisibleChange}).filter(function(v){return v.data}).filter(function(v){return v.z>=o&&v.z<u}).map(function(){var v=(0,ot.Z)(se().mark(function E(w){var M,k;return se().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(r.tileLayerService.hasTile(w.key)){N.next=9;break}return M=fk(r.parent),k=new M(w,r.parent),N.next=5,k.initTileLayer();case 5:r.tilePickService.setPickState(),k.getLayers().length!==0&&(r.tileLayerService.addTile(k),r.tileLayerService.updateTileVisible(w),r.layerService.reRender()),N.next=12;break;case 9:r.tileLayerService.updateTileVisible(w),r.tilePickService.setPickState(),r.layerService.reRender();case 12:case"end":return N.stop()}},E)}));return function(E){return v.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return p.stop()}},n,this)}));function t(){return i.apply(this,arguments)}return t}()},{key:"setPickState",value:function(t){}},{key:"pickRender",value:function(t){this.tilePickService.pickRender(t)}},{key:"selectFeature",value:function(t){this.tilePickService.selectFeature(t)}},{key:"highlightPickedFeature",value:function(t){this.tilePickService.highlightPickedFeature(t)}},{key:"proxy",value:function(t){var n=this;z6.forEach(function(r){var o=t[r].bind(t);t[r]=function(){for(var u=arguments.length,l=new Array(u),p=0;p<u;p++)l[p]=arguments[p];return o.apply(void 0,l),n.getLayers().map(function(v){v[r].apply(v,l)}),r==="style"&&n.getTiles().forEach(function(v){return v.styleUpdate.apply(v,l)}),t}})}}]),e}(),g2,y2,hk=(g2=(0,kn.b2)(),g2(y2=function(){function e(){(0,Ht.Z)(this,e)}return(0,tr.Z)(e,[{key:"build",value:function(){var i=(0,ot.Z)(se().mark(function n(r){return se().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return r.prepareBuildModel(),u.next=3,r.buildModels();case 3:case"end":return u.stop()}},n)}));function t(n){return i.apply(this,arguments)}return t}()},{key:"initLayerModel",value:function(){var i=(0,ot.Z)(se().mark(function n(r){return se().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.build(r);case 2:r.styleNeedUpdate=!1;case 3:case"end":return u.stop()}},n,this)}));function t(n){return i.apply(this,arguments)}return t}()},{key:"prepareLayerModel",value:function(){var i=(0,ot.Z)(se().mark(function n(r){return se().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.build(r);case 2:case"end":return u.stop()}},n,this)}));function t(n){return i.apply(this,arguments)}return t}()},{key:"apply",value:function(t){var n=this;t.hooks.init.tapPromise("LayerModelPlugin",(0,ot.Z)(se().mark(function r(){return se().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!t.getSource().isTile){u.next=4;break}return t.prepareBuildModel(),t.tileLayer=new m2(t),u.abrupt("return");case 4:return t.log(Cl.BuildModelStart,Tl.INIT),u.next=7,n.initLayerModel(t);case 7:t.log(Cl.BuildModelEnd,Tl.INIT);case 8:case"end":return u.stop()}},r)}))),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var r=(0,ot.Z)(se().mark(function o(u){return se().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(u){p.next=2;break}return p.abrupt("return",!1);case 2:if(!t.getSource().isTile){p.next=5;break}return t.tileLayer=new m2(t),p.abrupt("return",!1);case 5:return t.log(Cl.BuildModelStart,Tl.UPDATE),p.next=8,n.prepareLayerModel(t);case 8:return t.log(Cl.BuildModelEnd,Tl.UPDATE),p.abrupt("return",!0);case 10:case"end":return p.stop()}},o)}));return function(o){return r.apply(this,arguments)}}())}}]),e}())||y2),_2,x2,pk=(_2=(0,kn.b2)(),_2(x2=function(){function e(){(0,Ht.Z)(this,e)}return(0,tr.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){var n=t.getLayerConfig(),r=n.autoFit,o=n.fitBoundsOptions;r&&t.fitBounds(o)})}}]),e}())||x2),b2,E2,dk=["type"],S2={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},vk={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},mk={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},gk={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function yk(e){var i={u_DirectionalLights:new Array(3).fill((0,U.Z)({},mk)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,U.Z)({},gk)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[vk]),e.forEach(function(t){var n=t.type,r=n===void 0?"directional":n,o=(0,Af.Z)(t,dk),u=S2[r].lights,l=S2[r].num,p=i[l];i[u][p]=(0,U.Z)((0,U.Z)({},i[u][p]),o),i[l]++}),i}var _k=(b2=(0,kn.b2)(),b2(E2=function(){function e(){(0,Ht.Z)(this,e)}return(0,tr.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var n=t.getLayerConfig(),r=n.enableLighting;r&&t.models.forEach(function(o){return o.addUniforms((0,U.Z)({},yk()))})})}}]),e}())||E2),w2,A2,xk=(w2=(0,kn.b2)(),w2(A2=function(){function e(){(0,Ht.Z)(this,e)}return(0,tr.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.rendererService,u=n.postProcessingPassFactory,l=n.normalPassFactory;t.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var p=t.getLayerConfig(),v=p.enableMultiPassRenderer,E=p.passes,w=E===void 0?[]:E;r.enabled=!!v&&t.getLayerConfig().enableMultiPassRenderer!==!1,r.enabled&&(t.multiPassRenderer=W1(t,w,u,l),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(r.enabled){var p=o.getViewportSize(),v=p.width,E=p.height;t.multiPassRenderer.resize(v,E)}})}}]),e}())||A2),C2,T2,sg={NONE:0,ENCODE:1,HIGHLIGHT:2},bk=(C2=(0,kn.b2)(),C2(T2=function(){function e(){(0,Ht.Z)(this,e)}return(0,tr.Z)(e,[{key:"apply",value:function(t,n){var r=n.styleAttributeService;t.hooks.init.tapPromise("PixelPickingPlugin",function(){var o=t.getLayerConfig(),u=o.enablePicking;r.registerStyleAttribute({name:"pickingColor",type:ri.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:ee.FLOAT},size:3,update:function(p){var v=p.id;return u?Zu(v):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var o=t.getLayerConfig(),u=o.enablePicking;u&&t.isVisible()&&t.models.forEach(function(l){return l.addUniforms({u_PickingStage:sg.ENCODE})})}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var o=t.getLayerConfig(),u=o.enablePicking;u&&t.isVisible()&&t.models.forEach(function(l){return l.addUniforms({u_PickingStage:sg.HIGHLIGHT})})}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(o){var u=t.getLayerConfig(),l=u.highlightColor,p=u.activeMix,v=p===void 0?0:p,E=typeof l=="string"?Oa(l):l||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Ll(new Uint8Array(o))}),t.models.forEach(function(w){return w.addUniforms({u_PickingStage:sg.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:E.map(function(M){return M*255}),u_activeMix:v})})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(o){var u=t.getLayerConfig(),l=u.selectColor,p=u.selectMix,v=p===void 0?0:p,E=typeof l=="string"?Oa(l):l||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Ll(new Uint8Array(o))}),t.models.forEach(function(w){return w.addUniforms({u_PickingStage:sg.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:E.map(function(M){return M*255}),u_activeMix:v,u_CurrentSelectedId:o,u_SelectColor:E.map(function(M){return M*255}),u_EnableSelect:1})})})}}]),e}())||T2),Ek=["mvt","geojsonvt","testTile"];function Sk(e){var i=e.getSource();return Ek.includes(i.parser.type)}function dL(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}var M2,I2,wk=(M2=(0,kn.b2)(),M2(I2=function(){function e(){(0,Ht.Z)(this,e)}return(0,tr.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.styleAttributeService;t.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){Sk(t)||r.registerBuiltinAttributes(o,t)})}},{key:"registerBuiltinAttributes",value:function(t,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(t);return}this.registerPositionAttribute(t),this.registerColorAttribute(t),this.registerVertexIdAttribute(t)}},{key:"registerPositionAttribute",value:function(t){t.registerStyleAttribute({name:"position",type:ri.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:ee.FLOAT},size:3,update:function(r,o,u){return u.length===2?[u[0],u[1],0]:[u[0],u[1],u[2]]}}})}},{key:"registerFilterAttribute",value:function(t){t.registerStyleAttribute({name:"filter",type:ri.Attribute,descriptor:{name:"filter",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(r){var o=r.filter;return o?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(t){t.registerStyleAttribute({name:"color",type:ri.Attribute,descriptor:{name:"a_Color",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:4,update:function(r){var o=r.color;return!o||!o.length?[1,1,1,1]:o}}})}},{key:"registerVertexIdAttribute",value:function(t){t.registerStyleAttribute({name:"vertexId",type:ri.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(r,o){return[o]}}})}}]),e}())||I2),k2,P2,R2,L2,O2,F2,Kv,D2,B2,N2,z2,Ak=(k2=(0,kn.b2)(),P2=(0,kn.f3)(fr.ICameraService),R2=(0,kn.f3)(fr.ICoordinateSystemService),L2=(0,kn.f3)(fr.IRendererService),O2=(0,kn.f3)(fr.IMapService),k2(F2=(Kv=function(){function e(){(0,Ht.Z)(this,e),Ta(this,"cameraService",D2,this),Ta(this,"coordinateSystemService",B2,this),Ta(this,"rendererService",N2,this),Ta(this,"mapService",z2,this)}return(0,tr.Z)(e,[{key:"apply",value:function(t){var n=this,r=this.mapService.version,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var l=t.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(l),r==="GAODE2.x"&&(n.setLayerCenter(t),o=n.mapService.map.customCoords.getMVPMatrix(),u=n.mapService.getCustomCoordCenter());var p=n.rendererService.getViewportSize(),v=p.width,E=p.height;t.models.forEach(function(w){var M;w.addUniforms((M={},(0,J.Z)(M,tv.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,J.Z)(M,tv.ViewMatrix,n.cameraService.getViewMatrix()),(0,J.Z)(M,tv.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,J.Z)(M,tv.Zoom,n.cameraService.getZoom()),(0,J.Z)(M,tv.ZoomScale,n.cameraService.getZoomScale()),(0,J.Z)(M,tv.FocalDistance,n.cameraService.getFocalDistance()),(0,J.Z)(M,tv.CameraPosition,n.cameraService.getCameraPosition()),(0,J.Z)(M,pp.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,J.Z)(M,pp.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,J.Z)(M,pp.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,J.Z)(M,pp.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,J.Z)(M,pp.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,J.Z)(M,pp.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,J.Z)(M,pp.Mvp,o),(0,J.Z)(M,"u_SceneCenterMKT",u),(0,J.Z)(M,"u_ViewportSize",[v,E]),(0,J.Z)(M,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,J.Z)(M,"u_DevicePixelRatio",wa.devicePixelRatio),(0,J.Z)(M,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),(0,J.Z)(M,"u_shaderPick",Number(t.getShaderPickStat())),M))})})}},{key:"setLayerCenter",value:function(t){t.coordCenter===void 0&&(t.coordCenter=t.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(t.coordCenter)}}]),e}(),D2=Ma(Kv.prototype,"cameraService",[P2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B2=Ma(Kv.prototype,"coordinateSystemService",[R2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N2=Ma(Kv.prototype,"rendererService",[L2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z2=Ma(Kv.prototype,"mapService",[O2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kv))||F2),Z2,U2,Ck=(Z2=(0,kn.b2)(),Z2(U2=function(){function e(){(0,Ht.Z)(this,e)}return(0,tr.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate().then(function(n){n&&t.renderLayers()})}),t.hooks.afterRender.tap("UpdateModelPlugin",function(){t.layerModelNeedUpdate=!1})}}]),e}())||U2),V2,G2,Tk=(V2=(0,kn.b2)(),V2(G2=function(){function e(){(0,Ht.Z)(this,e)}return(0,tr.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.styleAttributeService;t.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){r.initStyleAttribute(t,{styleAttributeService:o})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||t.inited&&r.updateStyleAttribute(t,{styleAttributeService:o})})}},{key:"updateStyleAttribute",value:function(t,n){var r=n.styleAttributeService,o=r.getLayerStyleAttributes()||[],u=r.getLayerStyleAttribute("filter");if(u&&u.needRegenerateVertices){t.layerModelNeedUpdate=!0,o.forEach(function(l){return l.needRegenerateVertices=!1});return}o.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){r.updateAttributeByFeatureRange(l.name,t.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex,t),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,n){var r=n.styleAttributeService,o=r.getLayerStyleAttributes()||[];o.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){r.updateAttributeByFeatureRange(u.name,t.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex),u.needRegenerateVertices=!1})}}]),e}())||G2);gh.bind(fr.ILayerPlugin).to(g4).inRequestScope(),gh.bind(fr.ILayerPlugin).to(wk).inRequestScope(),gh.bind(fr.ILayerPlugin).to(P6).inRequestScope(),gh.bind(fr.ILayerPlugin).to(m4).inRequestScope(),gh.bind(fr.ILayerPlugin).to(pk).inRequestScope(),gh.bind(fr.ILayerPlugin).to(Tk).inRequestScope(),gh.bind(fr.ILayerPlugin).to(Ck).inRequestScope(),gh.bind(fr.ILayerPlugin).to(xk).inRequestScope(),gh.bind(fr.ILayerPlugin).to(Ak).inRequestScope(),gh.bind(fr.ILayerPlugin).to(R6).inRequestScope(),gh.bind(fr.ILayerPlugin).to(_k).inRequestScope(),gh.bind(fr.ILayerPlugin).to(bk).inRequestScope(),gh.bind(fr.ILayerPlugin).to(hk).inRequestScope();var Mk=ie(88307),Ik=ie.n(Mk),kk=function(){function e(i,t){(0,Ht.Z)(this,e);var n=t.buffer,r=t.offset,o=t.stride,u=t.normalized,l=t.size,p=t.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:r||0,stride:o||0,normalized:u||!1,divisor:p||0},l&&(this.attribute.size=l)}return(0,tr.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),fd,U0,hd,jh,V0,Nd,G0,ug,Fp,lv,Pc,Dp,Bp,lg,Pk=(fd={},(0,J.Z)(fd,ee.POINTS,"points"),(0,J.Z)(fd,ee.LINES,"lines"),(0,J.Z)(fd,ee.LINE_LOOP,"line loop"),(0,J.Z)(fd,ee.LINE_STRIP,"line strip"),(0,J.Z)(fd,ee.TRIANGLES,"triangles"),(0,J.Z)(fd,ee.TRIANGLE_FAN,"triangle fan"),(0,J.Z)(fd,ee.TRIANGLE_STRIP,"triangle strip"),fd),j2=(U0={},(0,J.Z)(U0,ee.STATIC_DRAW,"static"),(0,J.Z)(U0,ee.DYNAMIC_DRAW,"dynamic"),(0,J.Z)(U0,ee.STREAM_DRAW,"stream"),U0),By=(hd={},(0,J.Z)(hd,ee.BYTE,"int8"),(0,J.Z)(hd,ee.UNSIGNED_INT,"int16"),(0,J.Z)(hd,ee.INT,"int32"),(0,J.Z)(hd,ee.UNSIGNED_BYTE,"uint8"),(0,J.Z)(hd,ee.UNSIGNED_SHORT,"uint16"),(0,J.Z)(hd,ee.UNSIGNED_INT,"uint32"),(0,J.Z)(hd,ee.FLOAT,"float"),hd),Rk=(jh={},(0,J.Z)(jh,ee.ALPHA,"alpha"),(0,J.Z)(jh,ee.LUMINANCE,"luminance"),(0,J.Z)(jh,ee.LUMINANCE_ALPHA,"luminance alpha"),(0,J.Z)(jh,ee.RGB,"rgb"),(0,J.Z)(jh,ee.RGBA,"rgba"),(0,J.Z)(jh,ee.RGBA4,"rgba4"),(0,J.Z)(jh,ee.RGB5_A1,"rgb5 a1"),(0,J.Z)(jh,ee.RGB565,"rgb565"),(0,J.Z)(jh,ee.DEPTH_COMPONENT,"depth"),(0,J.Z)(jh,ee.DEPTH_STENCIL,"depth stencil"),jh),Lk=(V0={},(0,J.Z)(V0,ee.DONT_CARE,"dont care"),(0,J.Z)(V0,ee.NICEST,"nice"),(0,J.Z)(V0,ee.FASTEST,"fast"),V0),H2=(Nd={},(0,J.Z)(Nd,ee.NEAREST,"nearest"),(0,J.Z)(Nd,ee.LINEAR,"linear"),(0,J.Z)(Nd,ee.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,J.Z)(Nd,ee.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,J.Z)(Nd,ee.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,J.Z)(Nd,ee.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Nd),W2=(G0={},(0,J.Z)(G0,ee.REPEAT,"repeat"),(0,J.Z)(G0,ee.CLAMP_TO_EDGE,"clamp"),(0,J.Z)(G0,ee.MIRRORED_REPEAT,"mirror"),G0),Ok=(ug={},(0,J.Z)(ug,ee.NONE,"none"),(0,J.Z)(ug,ee.BROWSER_DEFAULT_WEBGL,"browser"),ug),Fk=(Fp={},(0,J.Z)(Fp,ee.NEVER,"never"),(0,J.Z)(Fp,ee.ALWAYS,"always"),(0,J.Z)(Fp,ee.LESS,"less"),(0,J.Z)(Fp,ee.LEQUAL,"lequal"),(0,J.Z)(Fp,ee.GREATER,"greater"),(0,J.Z)(Fp,ee.GEQUAL,"gequal"),(0,J.Z)(Fp,ee.EQUAL,"equal"),(0,J.Z)(Fp,ee.NOTEQUAL,"notequal"),Fp),X2=(lv={},(0,J.Z)(lv,ee.FUNC_ADD,"add"),(0,J.Z)(lv,ee.MIN_EXT,"min"),(0,J.Z)(lv,ee.MAX_EXT,"max"),(0,J.Z)(lv,ee.FUNC_SUBTRACT,"subtract"),(0,J.Z)(lv,ee.FUNC_REVERSE_SUBTRACT,"reverse subtract"),lv),cg=(Pc={},(0,J.Z)(Pc,ee.ZERO,"zero"),(0,J.Z)(Pc,ee.ONE,"one"),(0,J.Z)(Pc,ee.SRC_COLOR,"src color"),(0,J.Z)(Pc,ee.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,J.Z)(Pc,ee.SRC_ALPHA,"src alpha"),(0,J.Z)(Pc,ee.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,J.Z)(Pc,ee.DST_COLOR,"dst color"),(0,J.Z)(Pc,ee.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,J.Z)(Pc,ee.DST_ALPHA,"dst alpha"),(0,J.Z)(Pc,ee.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,J.Z)(Pc,ee.CONSTANT_COLOR,"constant color"),(0,J.Z)(Pc,ee.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,J.Z)(Pc,ee.CONSTANT_ALPHA,"constant alpha"),(0,J.Z)(Pc,ee.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,J.Z)(Pc,ee.SRC_ALPHA_SATURATE,"src alpha saturate"),Pc),Dk=(Dp={},(0,J.Z)(Dp,ee.NEVER,"never"),(0,J.Z)(Dp,ee.ALWAYS,"always"),(0,J.Z)(Dp,ee.LESS,"less"),(0,J.Z)(Dp,ee.LEQUAL,"lequal"),(0,J.Z)(Dp,ee.GREATER,"greater"),(0,J.Z)(Dp,ee.GEQUAL,"gequal"),(0,J.Z)(Dp,ee.EQUAL,"equal"),(0,J.Z)(Dp,ee.NOTEQUAL,"notequal"),Dp),Qv=(Bp={},(0,J.Z)(Bp,ee.ZERO,"zero"),(0,J.Z)(Bp,ee.KEEP,"keep"),(0,J.Z)(Bp,ee.REPLACE,"replace"),(0,J.Z)(Bp,ee.INVERT,"invert"),(0,J.Z)(Bp,ee.INCR,"increment"),(0,J.Z)(Bp,ee.DECR,"decrement"),(0,J.Z)(Bp,ee.INCR_WRAP,"increment wrap"),(0,J.Z)(Bp,ee.DECR_WRAP,"decrement wrap"),Bp),Bk=(lg={},(0,J.Z)(lg,ee.FRONT,"front"),(0,J.Z)(lg,ee.BACK,"back"),lg),Nk=function(){function e(i,t){(0,Ht.Z)(this,e);var n=t.data,r=t.usage,o=t.type;this.buffer=i.buffer({data:n,usage:j2[r||ee.STATIC_DRAW],type:By[o||ee.UNSIGNED_BYTE]})}return(0,tr.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var n=t.data,r=t.offset;this.buffer.subdata(n,r)}}]),e}(),zk=function(){function e(i,t){(0,Ht.Z)(this,e);var n=t.data,r=t.usage,o=t.type,u=t.count;this.elements=i.elements({data:n,usage:j2[r||ee.STATIC_DRAW],type:By[o||ee.UNSIGNED_BYTE],count:u})}return(0,tr.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var n=t.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),Zk=function(){function e(i,t){(0,Ht.Z)(this,e);var n=t.width,r=t.height,o=t.color,u=t.colors,l={width:n,height:r};Array.isArray(u)&&(l.colors=u.map(function(p){return p.get()})),o&&typeof o!="boolean"&&(l.color=o.get()),this.framebuffer=i.framebuffer(l)}return(0,tr.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var n=t.width,r=t.height;this.framebuffer.resize(n,r)}}]),e}(),Uk=function(){function e(i,t){(0,Ht.Z)(this,e),(0,J.Z)(this,"destroyed",!1),(0,J.Z)(this,"uniforms",{}),this.reGl=i;var n=t.pick,r=n===void 0?!0:n,o=t.vs,u=t.fs,l=t.attributes,p=t.uniforms,v=t.primitive,E=t.count,w=t.elements,M=t.depth,k=t.blend,D=t.stencil,N=t.cull,V=t.instances,q={};this.options=t,p&&(this.uniforms=this.extractUniforms(p),Object.keys(p).forEach(function(Ge){q[Ge]=i.prop(Ge)}));var fe={};Object.keys(l).forEach(function(Ge){fe[Ge]=l[Ge].get()});var he={attributes:fe,frag:u,uniforms:q,vert:o,blend:{},primitive:Pk[v===void 0?ee.TRIANGLES:v]};if(V&&(he.instances=V),E?he.count=E:w&&(he.elements=w.get()),this.initDepthDrawParams({depth:M},he),this.initBlendDrawParams({blend:k},he),this.initStencilDrawParams({stencil:D},he),this.initCullDrawParams({cull:N},he),this.drawCommand=i(he),r){var Be=(0,f.cloneDeep)(he);Be.blend=(0,U.Z)((0,U.Z)({},Be.blend),{},{enable:!1}),this.drawPickCommand=i(Be)}this.drawParams=he}return(0,tr.Z)(e,[{key:"updateAttributesAndElements",value:function(t,n){var r={};if(Object.keys(t).forEach(function(u){r[u]=t[u].get()}),this.drawParams.attributes=r,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams),this.options.pick){var o=(0,f.cloneDeep)(this.drawParams);o.blend=(0,U.Z)((0,U.Z)({},o.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(o)}}},{key:"updateAttributes",value:function(t){var n={};if(Object.keys(t).forEach(function(o){n[o]=t[o].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams),this.options.pick){var r=(0,f.cloneDeep)(this.drawParams);r.blend=(0,U.Z)((0,U.Z)({},r.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(r)}}},{key:"addUniforms",value:function(t){this.uniforms=(0,U.Z)((0,U.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var r=(0,U.Z)((0,U.Z)({},this.uniforms),this.extractUniforms(t.uniforms||{})),o={};Object.keys(r).forEach(function(u){var l=(0,jr.Z)(r[u]);l==="boolean"||l==="number"||Array.isArray(r[u])||r[u].BYTES_PER_ELEMENT?o[u]=r[u]:o[u]=r[u].get()}),n?this.drawPickCommand&&this.drawPickCommand(o):this.drawCommand(o)}}},{key:"destroy",value:function(){var t,n;(t=this.drawParams)===null||t===void 0||(n=t.elements)===null||n===void 0||n.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r==null||r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var r=t.depth;r&&(n.depth={enable:r.enable===void 0?!0:!!r.enable,mask:r.mask===void 0?!0:!!r.mask,func:Fk[r.func||ee.LESS],range:r.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,n){var r=t.blend;if(r){var o=r.enable,u=r.func,l=r.equation,p=r.color,v=p===void 0?[0,0,0,0]:p;n.blend={enable:!!o,func:{srcRGB:cg[u&&u.srcRGB||ee.SRC_ALPHA],srcAlpha:cg[u&&u.srcAlpha||ee.SRC_ALPHA],dstRGB:cg[u&&u.dstRGB||ee.ONE_MINUS_SRC_ALPHA],dstAlpha:cg[u&&u.dstAlpha||ee.ONE_MINUS_SRC_ALPHA]},equation:{rgb:X2[l&&l.rgb||ee.FUNC_ADD],alpha:X2[l&&l.alpha||ee.FUNC_ADD]},color:v}}}},{key:"initStencilDrawParams",value:function(t,n){var r=t.stencil;if(r){var o=r.enable,u=r.mask,l=u===void 0?-1:u,p=r.func,v=p===void 0?{cmp:ee.ALWAYS,ref:0,mask:-1}:p,E=r.opFront,w=E===void 0?{fail:ee.KEEP,zfail:ee.KEEP,zpass:ee.KEEP}:E,M=r.opBack,k=M===void 0?{fail:ee.KEEP,zfail:ee.KEEP,zpass:ee.KEEP}:M;n.stencil={enable:!!o,mask:l,func:(0,U.Z)((0,U.Z)({},v),{},{cmp:Dk[v.cmp]}),opFront:{fail:Qv[w.fail],zfail:Qv[w.zfail],zpass:Qv[w.zpass]},opBack:{fail:Qv[k.fail],zfail:Qv[k.zfail],zpass:Qv[k.zpass]}}}}},{key:"initCullDrawParams",value:function(t,n){var r=t.cull;if(r){var o=r.enable,u=r.face,l=u===void 0?ee.BACK:u;n.cull={enable:!!o,face:Bk[l]}}}},{key:"extractUniforms",value:function(t){var n=this,r={};return Object.keys(t).forEach(function(o){n.extractUniformsRecursively(o,t[o],r,"")}),r}},{key:"extractUniformsRecursively",value:function(t,n,r,o){var u=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||(0,f.isTypedArray)(n)||n===""||"resize"in n){r["".concat(o&&o+".").concat(t)]=n;return}(0,f.isPlainObject)(n)&&Object.keys(n).forEach(function(l){u.extractUniformsRecursively(l,n[l],r,"".concat(o&&o+".").concat(t))}),Array.isArray(n)&&n.forEach(function(l,p){Object.keys(l).forEach(function(v){u.extractUniformsRecursively(v,l[v],r,"".concat(o&&o+".").concat(t,"[").concat(p,"]"))})})}}]),e}(),Vk=function(){function e(i,t){(0,Ht.Z)(this,e),(0,J.Z)(this,"isDestroy",!1);var n=t.data,r=t.type,o=r===void 0?ee.UNSIGNED_BYTE:r,u=t.width,l=t.height,p=t.flipY,v=p===void 0?!1:p,E=t.format,w=E===void 0?ee.RGBA:E,M=t.mipmap,k=M===void 0?!1:M,D=t.wrapS,N=D===void 0?ee.CLAMP_TO_EDGE:D,V=t.wrapT,q=V===void 0?ee.CLAMP_TO_EDGE:V,fe=t.aniso,he=fe===void 0?0:fe,Be=t.alignment,Ge=Be===void 0?1:Be,St=t.premultiplyAlpha,Ut=St===void 0?!1:St,Yt=t.mag,nr=Yt===void 0?ee.NEAREST:Yt,Rr=t.min,Tr=Rr===void 0?ee.NEAREST:Rr,on=t.colorSpace,Hn=on===void 0?ee.BROWSER_DEFAULT_WEBGL:on,di=t.x,za=di===void 0?0:di,Co=t.y,Ds=Co===void 0?0:Co,js=t.copy,vu=js===void 0?!1:js;this.width=u,this.height=l;var jf={width:u,height:l,type:By[o],format:Rk[w],wrapS:W2[N],wrapT:W2[q],mag:H2[nr],min:H2[Tr],alignment:Ge,flipY:v,colorSpace:Ok[Hn],premultiplyAlpha:Ut,aniso:he,x:za,y:Ds,copy:vu};n&&(jf.data=n),typeof k=="number"?jf.mipmap=Lk[k]:typeof k=="boolean"&&(jf.mipmap=k),this.texture=i.texture(jf)}return(0,tr.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var n=t.width,r=t.height;this.texture.resize(n,r),this.width=n,this.height=r}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDestroy=!0}}]),e}(),$2,Y2,Gk=($2=(0,kn.b2)(),$2(Y2=function(){function e(){var i=this;(0,Ht.Z)(this,e),(0,J.Z)(this,"createModel",function(t){return new Uk(i.gl,t)}),(0,J.Z)(this,"createAttribute",function(t){return new kk(i.gl,t)}),(0,J.Z)(this,"createBuffer",function(t){return new Nk(i.gl,t)}),(0,J.Z)(this,"createElements",function(t){return new zk(i.gl,t)}),(0,J.Z)(this,"createTexture2D",function(t){return new Vk(i.gl,t)}),(0,J.Z)(this,"createFramebuffer",function(t){return new Zk(i.gl,t)}),(0,J.Z)(this,"useFramebuffer",function(t,n){i.gl({framebuffer:t?t.get():null})(n)}),(0,J.Z)(this,"clear",function(t){var n,r=t.color,o=t.depth,u=t.stencil,l=t.framebuffer,p=l===void 0?null:l,v={color:r,depth:o,stencil:u};v.framebuffer=p===null?p:p.get(),(n=i.gl)===null||n===void 0||n.clear(v)}),(0,J.Z)(this,"viewport",function(t){var n=t.x,r=t.y,o=t.width,u=t.height;i.gl._gl.viewport(n,r,o,u),i.width=o,i.height=u,i.gl._refresh()}),(0,J.Z)(this,"readPixels",function(t){var n=t.framebuffer,r=t.x,o=t.y,u=t.width,l=t.height,p={x:r,y:o,width:u,height:l};return n&&(p.framebuffer=n.get()),i.gl.read(p)}),(0,J.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,J.Z)(this,"getContainer",function(){if(Yo)return i.canvas;var t;return(t=i.canvas)===null||t===void 0?void 0:t.parentElement}),(0,J.Z)(this,"getCanvas",function(){return i.canvas}),(0,J.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,J.Z)(this,"destroy",function(){var t,n,r;i.canvas=null,(t=i.gl)===null||t===void 0||(n=t._gl)===null||n===void 0||(r=n.getExtension("WEBGL_lose_context"))===null||r===void 0||r.loseContext(),i.gl.destroy(),i.gl=null})}return(0,tr.Z)(e,[{key:"init",value:function(){var i=(0,ot.Z)(se().mark(function n(r,o,u){var l=this;return se().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.canvas=r,!u){v.next=5;break}this.gl=u,v.next=8;break;case 5:return v.next=7,new Promise(function(E,w){Ik()({canvas:l.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(k,D){(k||!D)&&w(k),E(D)}})});case 7:this.gl=v.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return v.stop()}},n,this)}));function t(n,r,o){return i.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Y2);function jk(e){var i=Hk();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function Hk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ny=["selectstart","selecting","selectend"],Wk=function(e){(0,Fr.Z)(t,e);var i=jk(t);function t(n){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,Ht.Z)(this,t),r=i.call(this),(0,J.Z)((0,Ke.Z)(r),"isEnable",!1),(0,J.Z)((0,Ke.Z)(r),"onDragStart",function(u){r.box.style.display="block",r.startEvent=r.endEvent=u,r.syncBoxBound(),r.emit("selectstart",r.getLngLatBox(),r.startEvent,r.endEvent)}),(0,J.Z)((0,Ke.Z)(r),"onDragging",function(u){r.endEvent=u,r.syncBoxBound(),r.emit("selecting",r.getLngLatBox(),r.startEvent,r.endEvent)}),(0,J.Z)((0,Ke.Z)(r),"onDragEnd",function(u){r.endEvent=u,r.box.style.display="none",r.emit("selectend",r.getLngLatBox(),r.startEvent,r.endEvent)}),r.scene=n,r.options=o,r}return(0,tr.Z)(t,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var r=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var o=I("div",void 0,this.container);o.classList.add("l7-select-box"),r&&o.classList.add(r),o.style.display="none",this.box=o}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){!this.isEnable||(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var r=this.startEvent,o=r.x,u=r.y,l=this.endEvent,p=l.x,v=l.y,E=Math.min(o,p),w=Math.min(u,v),M=Math.abs(o-p),k=Math.abs(u-v);this.box.style.top="".concat(w,"px"),this.box.style.left="".concat(E,"px"),this.box.style.width="".concat(M,"px"),this.box.style.height="".concat(k,"px")}},{key:"getLngLatBox",value:function(){var r=this.startEvent.lngLat,o=r.lng,u=r.lat,l=this.endEvent.lngLat,p=l.lng,v=l.lat;return Bf([[o,u],[p,v]])}}]),t}(fs.EventEmitter),Xk=function(){function e(i){(0,Ht.Z)(this,e);var t=i.id,n=i.map,r=i.canvas,o=i.hasBaseMap,u=Pw();this.container=u,n.setContainer(u,t,r,o),u.bind(fr.IRendererService).to(Gk).inSingletonScope(),this.sceneService=u.get(fr.ISceneService),this.mapService=u.get(fr.IMapService),this.iconService=u.get(fr.IIconService),this.fontService=u.get(fr.IFontService),this.controlService=u.get(fr.IControlService),this.layerService=u.get(fr.ILayerService),this.debugService=u.get(fr.IDebugService),this.debugService.setEnable(i.debug),this.markerService=u.get(fr.IMarkerService),this.interactionService=u.get(fr.IInteractionService),this.popupService=u.get(fr.IPopupService),this.boxSelect=new Wk(this,{}),Ya((i==null?void 0:i.isMini)||!1),Yo?this.sceneService.initMiniScene(i):(this.initComponent(t),this.sceneService.init(i),this.initControl())}return(0,tr.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var i=(0,ot.Z)(se().mark(function n(r){return se().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.sceneService.exportPng(r));case 1:case"end":return u.stop()}},n,this)}));function t(n){return i.apply(this,arguments)}return t}()},{key:"exportMap",value:function(){var i=(0,ot.Z)(se().mark(function n(r){return se().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.sceneService.exportPng(r));case 1:case"end":return u.stop()}},n,this)}));function t(n){return i.apply(this,arguments)}return t}()},{key:"registerRenderService",value:function(t){var n=this;if(this.sceneService.loaded){var r=new t(this);r.init()}else this.on("loaded",function(){var o=new t(n);o.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var n=this,r=Pm(this.container);if(t.setContainer(r,this.container),this.sceneService.addLayer(t),t.inited){var o=this.initMask(t);this.addMask(o,t.id)}else t.on("inited",function(){var u=n.initMask(t);n.addMask(u,t.id)})}},{key:"initMask",value:function(t){var n=t.getLayerConfig(),r=n.mask,o=n.maskfence,u=n.maskColor,l=u===void 0?"#000":u,p=n.maskOpacity,v=p===void 0?0:p;if(!(!r||!o)){var E=new vy().source(o).shape("fill").style({color:l,opacity:v});return E}}},{key:"addMask",value:function(t,n){if(!!t){var r=this.getLayer(n);if(r){var o=Pm(this.container);t.setContainer(o,this.container),r.addMaskLayer(t),this.sceneService.addMask(t)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(){var i=(0,ot.Z)(se().mark(function n(r,o){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.layerService.remove(r,o);case 2:case"end":return l.stop()}},n,this)}));function t(n,r){return i.apply(this,arguments)}return t}()},{key:"removeAllLayer",value:function(){var i=(0,ot.Z)(se().mark(function n(){return se().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.layerService.removeAllLayers();case 2:case"end":return o.stop()}},n,this)}));function t(){return i.apply(this,arguments)}return t}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,n){this.fontService.addIconFont(t,n)}},{key:"addIconFonts",value:function(t){var n=this;t.forEach(function(r){var o=(0,Ti.Z)(r,2),u=o[0],l=o[1];n.fontService.addIconFont(u,l)})}},{key:"addFontFace",value:function(t,n){var r=this;this.fontService.once("fontloaded",function(o){r.emit("fontloaded",o)}),this.fontService.addFontFace(t,n)}},{key:"addImage",value:function(){var i=(0,ot.Z)(se().mark(function n(r,o){return se().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(Yo){l.next=5;break}return l.next=3,this.iconService.addImage(r,o);case 3:l.next=6;break;case 5:this.iconService.addImageMini(r,o,this.sceneService);case 6:case"end":return l.stop()}},n,this)}));function t(n,r){return i.apply(this,arguments)}return t}()},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"removePopup",value:function(t){this.popupService.removePopup(t)}},{key:"on",value:function(t,n){if(Ny.includes(t)){var r;(r=this.boxSelect)===null||r===void 0||r.on(t,n)}else Lm.includes(t)?this.sceneService.on(t,n):this.mapService.on(t,n)}},{key:"once",value:function(t,n){if(Ny.includes(t)){var r;(r=this.boxSelect)===null||r===void 0||r.once(t,n)}else Lm.includes(t)?this.sceneService.once(t,n):this.mapService.once(t,n)}},{key:"emit",value:function(t,n){Lm.indexOf(t)===-1?this.mapService.on(t,n):this.sceneService.emit(t,n)}},{key:"off",value:function(t,n){if(Ny.includes(t)){var r;(r=this.boxSelect)===null||r===void 0||r.off(t,n)}else Lm.includes(t)?this.sceneService.off(t,n):this.mapService.off(t,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,n){return this.mapService.setCenter(t,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,n){this.mapService.panBy(t,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,n){var r=this.sceneService.getSceneConfig(),o=r.fitBoundsOptions,u=r.animate;this.mapService.fitBounds(t,n||(0,U.Z)((0,U.Z)({},o),{},{animate:u}))}},{key:"setZoomAndCenter",value:function(t,n){this.mapService.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,n){this.container.bind(fr.IPostProcessingPass).to(t).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){t.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:d(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),n=t.logoVisible,r=t.logoPosition;n&&this.addControl(new G1({position:r}))}}]),e}(),vL="2.13.9";function j0(e){return j0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},j0(e)}function q2(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function mL(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?q2(Object(t),!0).forEach(function(n){$k(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):q2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function $k(e,i,t){return i=Yk(i),i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function Yk(e){var i=qk(e,"string");return j0(i)==="symbol"?i:String(i)}function qk(e,i){if(j0(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,i||"default");if(j0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function gL(e,i){return e7(e)||Jk(e,i)||Qk(e,i)||Kk()}function Kk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Qk(e,i){if(!!e){if(typeof e=="string")return K2(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return K2(e,i)}}function K2(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function Jk(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,r,o,u,l=[],p=!0,v=!1;try{if(o=(t=t.call(e)).next,i===0){if(Object(t)!==t)return;p=!1}else for(;!(p=(n=o.call(t)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(E){v=!0,r=E}finally{try{if(!p&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(v)throw r}}return l}}function e7(e){if(Array.isArray(e))return e}var yL=null,_L=null,Q2,zy,J2,t7=(Q2=Kg(fr.IGlobalConfigService),zy=function(){function e(i){(0,Ht.Z)(this,e),Ta(this,"configService",J2,this),this.config=i}return(0,tr.Z)(e,[{key:"setContainer",value:function(t,n,r,o){t.bind(fr.MapConfig).toConstantValue((0,U.Z)((0,U.Z)({},this.config),{},{id:n,canvas:r,hasBaseMap:o})),t.bind(fr.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),J2=Ma(zy.prototype,"configService",[Q2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zy),r7=ie(6158),H0=ie.n(r7),n7=function(){function e(i){(0,Ht.Z)(this,e),(0,J.Z)(this,"size",1e4),this.size=i||1e4}return(0,tr.Z)(e,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var n=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(t){var n=this.mercatorXfromLng(t[0]),r=this.mercatorYfromLat(t[1]);return[n,r]}},{key:"unproject",value:function(t){var n=this.lngFromMercatorX(t[0]),r=this.latFromMercatorY(t[1]);return[n,r]}}]),e}(),i7={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},eE,tE,rE,nE,iE,aE,Jv,oE,sE,uE,lE,cE={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},a7=12,o7=(eE=(0,kn.b2)(),tE=(0,kn.f3)(fr.MapConfig),rE=(0,kn.f3)(fr.IGlobalConfigService),nE=(0,kn.f3)(fr.ICoordinateSystemService),iE=(0,kn.f3)(fr.IEventEmitter),eE(aE=(Jv=function(){function e(){var i=this;(0,Ht.Z)(this,e),(0,J.Z)(this,"version",Mf.DEFUALT),(0,J.Z)(this,"simpleMapCoord",new n7),(0,J.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Ta(this,"config",oE,this),Ta(this,"configService",sE,this),Ta(this,"coordinateSystemService",uE,this),Ta(this,"eventEmitter",lE,this),(0,J.Z)(this,"handleCameraChanged",function(t){var n=i.map.getCenter(),r=n.lat,o=n.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[o,r],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0}),i.updateCoordinateSystemService(),i.cameraChangedCallback(i.viewport)})}return(0,tr.Z)(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=I("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(t,n){Gw.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(cE[t]||t,n)}},{key:"off",value:function(t,n){this.map.off(cE[t]||t,n),this.eventEmitter.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===Mf.SIMPLE)return this.simpleMapCoord.getSize();var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,n){this.map.zoomIn(t,n)}},{key:"zoomOut",value:function(t,n){this.map.zoomOut(t,n)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.panTo([t,n])}},{key:"fitBounds",value:function(t,n){this.map.fitBounds(t,n)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.dragEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,n){this.map.flyTo({zoom:t,center:n})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyleValue(t))}},{key:"meterToCoord",value:function(t,n){return 1}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"getMapStyle",value:function(){try{var t,n=(t=this.map.getStyle().sprite)!==null&&t!==void 0?t:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch(r){return""}}},{key:"getMapStyleConfig",value:function(){return i7}},{key:"getMapStyleValue",value:function(t){var n;return(n=this.getMapStyleConfig()[t])!==null&&n!==void 0?n:t}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var n,r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];(n=this.eventEmitter).emit.apply(n,[t].concat(o))}},{key:"once",value:function(t){for(var n,r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];(n=this.eventEmitter).once.apply(n,[t].concat(o))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var n=this.map.getCanvas(),r=t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return r}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatMapContainer",value:function(t){var n=t;return typeof t=="string"&&(n=document.getElementById(t)),n}},{key:"updateView",value:function(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var t=this.config.offsetCoordinate,n=t===void 0?!0:t;this.viewport.getZoom()>a7&&n?this.coordinateSystemService.setCoordinateSystem(Uh.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Uh.LNGLAT)}}]),e}(),oE=Ma(Jv.prototype,"config",[tE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sE=Ma(Jv.prototype,"configService",[rE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uE=Ma(Jv.prototype,"coordinateSystemService",[nE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lE=Ma(Jv.prototype,"eventEmitter",[iE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jv))||aE);function W0(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function fg(e,i){var t=kd([],i,e);return _v(t,t,1/t[3]),t}function xL(e,i){var t=e%i;return t<0?i+t:t}function bL(e,i,t){return t*i+(1-t)*e}function cv(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var gp=Math.PI,fE=gp/4,pd=gp/180,hE=180/gp,Zy=512,Uy=4003e4,s7=1.5;function pE(e){return Math.pow(2,e)}function u7(e){return Math.log2(e)}function hg(e,i){var t=(0,Ti.Z)(e,2),n=t[0],r=t[1];cv(Number.isFinite(n)&&Number.isFinite(i)),cv(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude"),i*=Zy;var o=n*pd,u=r*pd,l=i*(o+gp)/(2*gp),p=i*(gp-Math.log(Math.tan(fE+u*.5)))/(2*gp);return[l,p]}function Vy(e,i){var t=(0,Ti.Z)(e,2),n=t[0],r=t[1];i*=Zy;var o=n/i*(2*gp)-gp,u=2*(Math.atan(Math.exp(gp-r/i*(2*gp)))-fE);return[o*hE,u*hE]}function EL(e){var i=e.latitude;assert(Number.isFinite(i));var t=Math.cos(i*pd);return u7(Uy*t)-9}function dE(e){var i=e.latitude,t=e.longitude,n=e.zoom,r=e.scale,o=e.highPrecision,u=o===void 0?!1:o;r=r!==void 0?r:pE(n),cv(Number.isFinite(i)&&Number.isFinite(t)&&Number.isFinite(r));var l={},p=Zy*r,v=Math.cos(i*pd),E=p/360,w=E/v,M=p/Uy/v;if(l.pixelsPerMeter=[M,-M,M],l.metersPerPixel=[1/M,-1/M,1/M],l.pixelsPerDegree=[E,-w,M],l.degreesPerPixel=[1/E,-1/w,1/M],u){var k=pd*Math.tan(i*pd)/v,D=E*k/2,N=p/Uy*k,V=N/w*M;l.pixelsPerDegree2=[0,-D,N],l.pixelsPerMeter2=[V,0,V]}return l}function SL(e,i){var t=_slicedToArray(e,3),n=t[0],r=t[1],o=t[2],u=_slicedToArray(i,3),l=u[0],p=u[1],v=u[2],E=1,w=dE({longitude:n,latitude:r,scale:E,highPrecision:!0}),M=w.pixelsPerMeter,k=w.pixelsPerMeter2,D=hg(e,E);D[0]+=l*(M[0]+k[0]*p),D[1]+=p*(M[1]+k[1]*p);var N=Vy(D,E),V=(o||0)+(v||0);return Number.isFinite(o)||Number.isFinite(v)?[N[0],N[1],V]:N}function l7(e){var i=e.height,t=e.pitch,n=e.bearing,r=e.altitude,o=e.center,u=o===void 0?null:o,l=e.flipY,p=l===void 0?!1:l,v=W0();return Vs(v,v,[0,0,-r]),ba(v,v,[1,1,1/i]),po(v,v,-t*pd),qu(v,v,n*pd),p&&ba(v,v,[1,-1,1]),u&&Vs(v,v,ss.negate([],u)),v}function c7(e){var i=e.width,t=e.height,n=e.altitude,r=n===void 0?s7:n,o=e.pitch,u=o===void 0?0:o,l=e.nearZMultiplier,p=l===void 0?1:l,v=e.farZMultiplier,E=v===void 0?1:v,w=u*pd,M=Math.atan(.5/r),k=Math.sin(M)*r/Math.sin(Math.PI/2-w-M),D=Math.cos(Math.PI/2-w)*k+r;return{fov:2*Math.atan(t/2/r),aspect:i/t,focalDistance:r,near:p,far:D*E}}function f7(e){var i=e.width,t=e.height,n=e.pitch,r=e.altitude,o=e.nearZMultiplier,u=e.farZMultiplier,l=c7({width:i,height:t,altitude:r,pitch:n,nearZMultiplier:o,farZMultiplier:u}),p=l.fov,v=l.aspect,E=l.near,w=l.far,M=Yp([],p,v,E,w);return M}function h7(e,i){var t=(0,Ti.Z)(e,3),n=t[0],r=t[1],o=t[2],u=o===void 0?0:o;return cv(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(u)),fg(i,[n,r,u,1])}function vE(e,i){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,Ti.Z)(e,3),r=n[0],o=n[1],u=n[2];if(cv(Number.isFinite(r)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u)){var l=fg(i,[r,o,u,1]);return l}var p=fg(i,[r,o,0,1]),v=fg(i,[r,o,1,1]),E=p[2],w=v[2],M=E===w?0:((t||0)-E)/(w-E);return Gr.lerp([],p,v,M)}var mE=W0(),p7=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=i.width,n=i.height,r=i.viewMatrix,o=r===void 0?mE:r,u=i.projectionMatrix,l=u===void 0?mE:u;(0,Ht.Z)(this,e),this.width=t||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=l;var p=W0();Oo(p,p,this.projectionMatrix),Oo(p,p,this.viewMatrix),this.viewProjectionMatrix=p;var v=W0();ba(v,v,[this.width/2,-this.height/2,1]),Vs(v,v,[1,-1,0]),Oo(v,v,this.viewProjectionMatrix);var E=Au(W0(),v);if(!E)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=E,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,tr.Z)(e,[{key:"equals",value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&cp(t.projectionMatrix,this.projectionMatrix)&&cp(t.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=n.topLeft,o=r===void 0?!0:r,u=this.projectPosition(t),l=h7(u,this.pixelProjectionMatrix),p=(0,Ti.Z)(l,2),v=p[0],E=p[1],w=o?E:this.height-E;return t.length===2?[v,w]:[v,w,l[2]]}},{key:"unproject",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=n.topLeft,o=r===void 0?!0:r,u=n.targetZ,l=(0,Ti.Z)(t,3),p=l[0],v=l[1],E=l[2],w=o?v:this.height-v,M=u&&u*this.pixelsPerMeter,k=vE([p,w,E],this.pixelUnprojectionMatrix,M),D=this.unprojectPosition(k),N=(0,Ti.Z)(D,3),V=N[0],q=N[1],fe=N[2];return Number.isFinite(E)?[V,q,fe]:Number.isFinite(u)?[V,q,u]:[V,q]}},{key:"projectPosition",value:function(t){var n=this.projectFlat(t),r=(0,Ti.Z)(n,2),o=r[0],u=r[1],l=(t[2]||0)*this.pixelsPerMeter;return[o,u,l]}},{key:"unprojectPosition",value:function(t){var n=this.unprojectFlat(t),r=(0,Ti.Z)(n,2),o=r[0],u=r[1],l=(t[2]||0)/this.pixelsPerMeter;return[o,u,l]}},{key:"projectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}}]),e}();function d7(e){var i=e.width,t=e.height,n=e.bounds,r=e.minExtent,o=r===void 0?0:r,u=e.maxZoom,l=u===void 0?24:u,p=e.padding,v=p===void 0?0:p,E=e.offset,w=E===void 0?[0,0]:E,M=(0,Ti.Z)(n,2),k=(0,Ti.Z)(M[0],2),D=k[0],N=k[1],V=(0,Ti.Z)(M[1],2),q=V[0],fe=V[1];if(Number.isFinite(v)){var he=v;v={top:he,bottom:he,left:he,right:he}}else cv(Number.isFinite(v.top)&&Number.isFinite(v.bottom)&&Number.isFinite(v.left)&&Number.isFinite(v.right));var Be=new gE({width:i,height:t,longitude:0,latitude:0,zoom:0}),Ge=Be.project([D,fe]),St=Be.project([q,N]),Ut=[Math.max(Math.abs(St[0]-Ge[0]),o),Math.max(Math.abs(St[1]-Ge[1]),o)],Yt=[i-v.left-v.right-Math.abs(w[0])*2,t-v.top-v.bottom-Math.abs(w[1])*2];cv(Yt[0]>0&&Yt[1]>0);var nr=Yt[0]/Ut[0],Rr=Yt[1]/Ut[1],Tr=(v.right-v.left)/2/nr,on=(v.bottom-v.top)/2/Rr,Hn=[(St[0]+Ge[0])/2+Tr,(St[1]+Ge[1])/2+on],di=Be.unproject(Hn),za=Be.zoom+Math.log2(Math.abs(Math.min(nr,Rr)));return{longitude:di[0],latitude:di[1],zoom:Math.min(za,l)}}var gE=function(e){(0,Fr.Z)(i,e);function i(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.width,o=n.height,u=n.latitude,l=u===void 0?0:u,p=n.longitude,v=p===void 0?0:p,E=n.zoom,w=E===void 0?0:E,M=n.pitch,k=M===void 0?0:M,D=n.bearing,N=D===void 0?0:D,V=n.altitude,q=V===void 0?1.5:V,fe=n.nearZMultiplier,he=n.farZMultiplier;(0,Ht.Z)(this,i),r=r||1,o=o||1;var Be=pE(w);q=Math.max(.75,q);var Ge=hg([v,l],Be);Ge[2]=0;var St=f7({width:r,height:o,pitch:k,bearing:N,altitude:q,nearZMultiplier:fe||1/o,farZMultiplier:he||1.01}),Ut=l7({height:o,center:Ge,pitch:k,bearing:N,altitude:q,flipY:!0});return t=(0,Nr.Z)(this,(0,it.Z)(i).call(this,{width:r,height:o,viewMatrix:Ut,projectionMatrix:St})),t.latitude=l,t.longitude=v,t.zoom=w,t.pitch=k,t.bearing=N,t.altitude=q,t.scale=Be,t.center=Ge,t.pixelsPerMeter=dE((0,Ke.Z)((0,Ke.Z)(t))).pixelsPerMeter[2],Object.freeze((0,Ke.Z)((0,Ke.Z)(t))),t}return(0,tr.Z)(i,[{key:"projectFlat",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return hg(n,r)}},{key:"unprojectFlat",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Vy(n,r)}},{key:"getMapCenterByLngLatPosition",value:function(n){var r=n.lngLat,o=n.pos,u=vE(o,this.pixelUnprojectionMatrix),l=hg(r,this.scale),p=Gr.add([],l,Gr.negate([],u)),v=Gr.add([],this.center,p);return Vy(v,this.scale)}},{key:"getLocationAtPoint",value:function(n){var r=n.lngLat,o=n.pos;return this.getMapCenterByLngLatPosition({lngLat:r,pos:o})}},{key:"fitBounds",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,u=this.height,l=d7(Object.assign({width:o,height:u,bounds:n},r)),p=l.longitude,v=l.latitude,E=l.zoom;return new i({width:o,height:u,longitude:p,latitude:v,zoom:E})}}]),i}(p7),v7=function(){function e(){(0,Ht.Z)(this,e)}return(0,tr.Z)(e,[{key:"syncWithMapCamera",value:function(t){var n=t.center,r=t.zoom,o=t.pitch,u=t.bearing,l=t.viewportHeight,p=t.viewportWidth;this.viewport=new gE({width:p,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:r,pitch:o,bearing:u})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),e}(),m7=["id","attributionControl","style","token","rotation","mapInstance"],yE,_E;function g7(e){var i=y7();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function y7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _7(e,i){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(i||(i=document),!!i)){var r=i.head||i.getElementsByTagName("head")[0];if(!r){r=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):i.documentElement.appendChild(r)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),r.appendChild(u),u}}_7(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=H0();var x7=0,xE="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",b7=(yE=(0,kn.b2)(),yE(_E=function(e){(0,Fr.Z)(t,e);var i=g7(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,J.Z)((0,Ke.Z)(n),"version",Mf.MAPBOX),n}return(0,tr.Z)(t,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},u=this.lngLatToMercator(r,0),l=u.x,p=u.y;return[l-o.x,p-o.y]}},{key:"lngLatToMercator",value:function(r,o){var u=window.mapboxgl.MercatorCoordinate.fromLngLat(r,o),l=u.x,p=l===void 0?0:l,v=u.y,E=v===void 0?0:v,w=u.z,M=w===void 0?0:w;return{x:p,y:E,z:M}}},{key:"getModelMatrix",value:function(r,o,u){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(r,o),E=v.meterInMercatorCoordinateUnits(),w=_o();return Vs(w,w,ss.fromValues(v.x-p.x,v.y-p.y,v.z||0-p.z)),ba(w,w,ss.fromValues(E*l[0],-E*l[1],E*l[2])),po(w,w,u[0]),ja(w,w,u[1]),qu(w,w,u[2]),w}},{key:"init",value:function(){var n=(0,ot.Z)(se().mark(function o(){var u=this,l,p,v,E,w,M,k,D,N,V,q,fe,he;return se().wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:l=this.config,p=l.id,v=p===void 0?"map":p,E=l.attributionControl,w=E===void 0?!1:E,M=l.style,k=M===void 0?"light":M,D=l.token,N=D===void 0?xE:D,V=l.rotation,q=V===void 0?0:V,fe=l.mapInstance,he=(0,Af.Z)(l,m7),this.viewport=new v7,!fe&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),N===xE&&k!=="blank"&&!window.mapboxgl.accessToken&&!fe&&console.warn(this.configService.getSceneWarninfo("MapToken")),!fe&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=N),fe?(this.map=fe,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(v),this.map=new window.mapboxgl.Map((0,U.Z)({container:this.$mapContainer,style:this.getMapStyleValue(k),attributionControl:w,bearing:q},he))),this.map.on("load",function(){u.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Ge.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,o;(r=this.$mapContainer)===null||r===void 0||(o=r.parentNode)===null||o===void 0||o.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var o,u=arguments.length,l=new Array(u>1?u-1:0),p=1;p<u;p++)l[p-1]=arguments[p];(o=this.eventEmitter).emit.apply(o,[r].concat(l))}},{key:"once",value:function(r){for(var o,u=arguments.length,l=new Array(u>1?u-1:0),p=1;p<u;p++)l[p-1]=arguments[p];(o=this.eventEmitter).once.apply(o,[r].concat(l))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,o){var u=new(H0()).LngLat(r[0],r[1]),l=new(H0()).LngLat(o[0],o[1]),p=u.distanceTo(l),v=H0().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),E=H0().MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]}),w=v.x,M=v.y,k=E.x,D=E.y,N=Math.sqrt(Math.pow(w-k,2)+Math.pow(M-D,2))*4194304*2;return N/p}},{key:"exportMap",value:function(r){var o=this.map.getCanvas(),u=r==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return u}},{key:"creatMapContainer",value:function(r){var o=r;typeof r=="string"&&(o=document.getElementById(r));var u=document.createElement("div");return u.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,u.id="l7_mapbox_div"+x7++,o.appendChild(u),u}}]),t}(o7))||_E);function E7(e){var i=S7();return function(){var n=(0,it.Z)(e),r;if(i){var o=(0,it.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Nr.Z)(this,r)}}function S7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function w7(e,i){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(i||(i=document),!!i)){var r=i.head||i.getElementsByTagName("head")[0];if(!r){r=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):i.documentElement.appendChild(r)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),r.appendChild(u),u}}w7(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var A7=function(e){(0,Fr.Z)(t,e);var i=E7(t);function t(){return(0,Ht.Z)(this,t),i.apply(this,arguments)}return(0,tr.Z)(t,[{key:"getServiceConstructor",value:function(){return b7}}]),t}(t7);function X0(e){return X0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},X0(e)}function bE(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function EE(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?bE(Object(t),!0).forEach(function(n){C7(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):bE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function C7(e,i,t){return i=T7(i),i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function T7(e){var i=M7(e,"string");return X0(i)==="symbol"?i:String(i)}function M7(e,i){if(X0(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,i||"default");if(X0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function I7(e,i){return L7(e)||R7(e,i)||P7(e,i)||k7()}function k7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function P7(e,i){if(!!e){if(typeof e=="string")return SE(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return SE(e,i)}}function SE(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function R7(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,r,o,u,l=[],p=!0,v=!1;try{if(o=(t=t.call(e)).next,i===0){if(Object(t)!==t)return;p=!1}else for(;!(p=(n=o.call(t)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(E){v=!0,r=E}finally{try{if(!p&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(v)throw r}}return l}}function L7(e){if(Array.isArray(e))return e}var O7=Z.memo(function(e){var i=e.style,t=e.className,n=e.map,r=e.option,o=e.onSceneLoaded,u=(0,Z.createRef)(),l=(0,Z.useState)(),p=I7(l,2),v=p[0],E=p[1];return(0,Z.useEffect)(function(){var w=new Xk(EE(EE({id:u.current},r),{},{map:new A7(n)}));return w.on("loaded",function(){E(w),o&&o(w)}),function(){w.destroy()}},[]),(0,Z.useEffect)(function(){v&&n.style&&v.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,Z.useEffect)(function(){v&&n.zoom&&v.setZoom(n.zoom)},[n.zoom]),(0,Z.useEffect)(function(){v&&n.center&&v.setCenter(n.center)},[JSON.stringify(n.center)]),(0,Z.useEffect)(function(){v&&n.pitch!==void 0&&v.setPitch(n.pitch||0)},[n.pitch]),(0,Z.useEffect)(function(){v&&n.rotation&&v.setRotation(n.rotation)},[n.rotation]),Z.createElement(_.Provider,{value:v},(0,Z.createElement)("div",{ref:u,style:i,className:t},v&&e.children))}),F7=O7;function $0(e){return $0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},$0(e)}function wE(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function wL(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?wE(Object(t),!0).forEach(function(n){D7(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):wE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function D7(e,i,t){return i=B7(i),i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function B7(e){var i=N7(e,"string");return $0(i)==="symbol"?i:String(i)}function N7(e,i){if($0(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,i||"default");if($0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function AL(e,i){return V7(e)||U7(e,i)||Z7(e,i)||z7()}function z7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Z7(e,i){if(!!e){if(typeof e=="string")return AE(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return AE(e,i)}}function AE(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function U7(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,r,o,u,l=[],p=!0,v=!1;try{if(o=(t=t.call(e)).next,i===0){if(Object(t)!==t)return;p=!1}else for(;!(p=(n=o.call(t)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(E){v=!0,r=E}finally{try{if(!p&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(v)throw r}}return l}}function V7(e){if(Array.isArray(e))return e}var CL=null,TL=null;function Y0(e){return Y0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Y0(e)}function CE(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function ML(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?CE(Object(t),!0).forEach(function(n){G7(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):CE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function G7(e,i,t){return i=j7(i),i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function j7(e){var i=H7(e,"string");return Y0(i)==="symbol"?i:String(i)}function H7(e,i){if(Y0(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,i||"default");if(Y0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function IL(e,i){return Y7(e)||$7(e,i)||X7(e,i)||W7()}function W7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function X7(e,i){if(!!e){if(typeof e=="string")return TE(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return TE(e,i)}}function TE(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function $7(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,r,o,u,l=[],p=!0,v=!1;try{if(o=(t=t.call(e)).next,i===0){if(Object(t)!==t)return;p=!1}else for(;!(p=(n=o.call(t)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(E){v=!0,r=E}finally{try{if(!p&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(v)throw r}}return l}}function Y7(e){if(Array.isArray(e))return e}var kL=null,PL=null;function q0(e){return q0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},q0(e)}function ME(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function RL(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?ME(Object(t),!0).forEach(function(n){q7(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ME(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function q7(e,i,t){return i=K7(i),i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function K7(e){var i=Q7(e,"string");return q0(i)==="symbol"?i:String(i)}function Q7(e,i){if(q0(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,i||"default");if(q0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function LL(e,i){return rP(e)||tP(e,i)||eP(e,i)||J7()}function J7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eP(e,i){if(!!e){if(typeof e=="string")return IE(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return IE(e,i)}}function IE(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function tP(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,r,o,u,l=[],p=!0,v=!1;try{if(o=(t=t.call(e)).next,i===0){if(Object(t)!==t)return;p=!1}else for(;!(p=(n=o.call(t)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(E){v=!0,r=E}finally{try{if(!p&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(v)throw r}}return l}}function rP(e){if(Array.isArray(e))return e}var OL=null,FL=null;function DL(e,i){return oP(e)||aP(e,i)||iP(e,i)||nP()}function nP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iP(e,i){if(!!e){if(typeof e=="string")return kE(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return kE(e,i)}}function kE(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function aP(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,r,o,u,l=[],p=!0,v=!1;try{if(o=(t=t.call(e)).next,i===0){if(Object(t)!==t)return;p=!1}else for(;!(p=(n=o.call(t)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(E){v=!0,r=E}finally{try{if(!p&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(v)throw r}}return l}}function oP(e){if(Array.isArray(e))return e}var BL=null;function K0(e){return K0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},K0(e)}var NL=null;function PE(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function zL(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?PE(Object(t),!0).forEach(function(n){sP(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):PE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function sP(e,i,t){return i=uP(i),i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function uP(e){var i=lP(e,"string");return K0(i)==="symbol"?i:String(i)}function lP(e,i){if(K0(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,i||"default");if(K0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function ZL(e,i){if(e==null)return{};var t=cP(e,i),n,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function cP(e,i){if(e==null)return{};var t={},n=Object.keys(e),r,o;for(o=0;o<n.length;o++)r=n[o],!(i.indexOf(r)>=0)&&(t[r]=e[r]);return t}var UL={exportImage:$A,fullscreen:QA,geoLocate:tC,layer:V1,layerSwitch:V1,logo:G1,mapTheme:cC,mouseLocation:pC,zoom:_C,scale:mC},VL=null,RE=ie(73935);function LE(e,i){return dP(e)||pP(e,i)||hP(e,i)||fP()}function fP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hP(e,i){if(!!e){if(typeof e=="string")return OE(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return OE(e,i)}}function OE(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function pP(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,r,o,u,l=[],p=!0,v=!1;try{if(o=(t=t.call(e)).next,i===0){if(Object(t)!==t)return;p=!1}else for(;!(p=(n=o.call(t)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(E){v=!0,r=E}finally{try{if(!p&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(v)throw r}}return l}}function dP(e){if(Array.isArray(e))return e}var FE=Z.useEffect,DE=Z.useState,vP=/\B([A-Z])/g,mP=function(i){return i.replace(vP,"-$1").toLowerCase()};function GL(e){var i=e.className,t=e.style,n=e.children,r=e.position,o=DE(),u=LE(o,2),l=u[0],p=u[1],v=useSceneValue(),E=DE(function(){return document.createElement("div")}),w=LE(E,1),M=w[0];return FE(function(){var k=new Control({position:r});return k.onAdd=function(){if(i&&(M.className=i),t){var D=Object.keys(t).map(function(N){return"".concat(mP(N),":").concat(t[N])}).join(";");M.style.cssText=D}return M},k.onRemove=function(){},p(k),v.addControl(k),function(){v.removeControl(k)}},[]),FE(function(){l&&l.setPosition(r||"bottomleft")},[r]),createPortal(n,M)}var BE=(0,Z.createContext)({});function jL(){return useContext(BE)}var gP=ie(60442),Np=ie.n(gP),yP=Z.memo(function(i){var t=i.layer,n=i.active;return t.active(n.option),null},Np()),_P=Z.memo(function(i){var t=i.layer,n=i.animate;return t.animate(n),null},Np()),xP=Z.memo(function(i){var t=i.layer,n=i.color;return n.field?t.color(n.field,n.values):t.color(n.values),null},Np()),bP=Z.memo(function(i){var t=i.layer,n=i.filter;return n.field&&t.filter(n.field,n.values),null},Np()),EP=Z.memo(function(i){var t=i.layer,n=i.scale;return t.scale(n.values),null},Np()),SP=Z.memo(function(i){var t=i.layer,n=i.select;return t.select(n.option),null},Np()),wP=Z.memo(function(i){var t=i.layer,n=i.shape;return n.field?t.shape(n.field,n.values):t.shape(n.values),null},Np()),AP=Z.memo(function(i){var t=i.layer,n=i.size;return n.field?t.size(n.field,n.values):t.size(n.values),null},Np()),CP=["data"];function TP(e,i){if(e==null)return{};var t=MP(e,i),n,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function MP(e,i){if(e==null)return{};var t={},n=Object.keys(e),r,o;for(o=0;o<n.length;o++)r=n[o],!(i.indexOf(r)>=0)&&(t[r]=e[r]);return t}var IP=Z.memo(function(i){var t=i.layer,n=i.source,r=n.data,o=TP(n,CP);return t.inited?t.setData(r,o):t.source(r,o),o.autoFit&&t.fitBounds(o&&o.fitBoundsOptions),null},Np()),HL=Z.useEffect,kP=Z.memo(function(i){var t=i.layer,n=i.style;return t.style(n),null},Np());function PP(e,i){return FP(e)||OP(e,i)||LP(e,i)||RP()}function RP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LP(e,i){if(!!e){if(typeof e=="string")return NE(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return NE(e,i)}}function NE(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function OP(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,r,o,u,l=[],p=!0,v=!1;try{if(o=(t=t.call(e)).next,i===0){if(Object(t)!==t)return;p=!1}else for(;!(p=(n=o.call(t)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(E){v=!0,r=E}finally{try{if(!p&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(v)throw r}}return l}}function FP(e){if(Array.isArray(e))return e}var Q0=Z.useEffect,DP=Z.useState;function zE(e,i){var t=i.source,n=i.color,r=i.shape,o=i.style,u=i.size,l=i.scale,p=i.active,v=i.select,E=i.filter,w=i.animate,M=i.options,k=i.onLayerLoaded,D=Pe(),N=DP(function(){var fe;switch(e){case"polygonLayer":fe=new dy(M);break;case"lineLayer":fe=new hy(M);break;case"pointLayer":fe=new Vm(M);break;case"heatmapLayer":fe=new Z3(M);break;case"rasterLayer":fe=new Gm(M);break;case"imageLayer":fe=new mx(M);break;case"citybuildingLayer":fe=new c3(M);break;default:fe=new dy(M)}return fe.on("inited",function(){k&&k(fe,D)}),fe}),V=PP(N,1),q=V[0];return Q0(function(){return D.addLayer(q),function(){D.removeLayer(q)}},[]),Q0(function(){q.inited&&M&&q.updateLayerConfig(M)},[M==null?void 0:M.minZoom,M==null?void 0:M.maxZoom,M==null?void 0:M.visible]),Q0(function(){q.inited&&(M==null?void 0:M.zIndex)&&q.setIndex(M.zIndex)},[M==null?void 0:M.zIndex]),Q0(function(){q.inited&&(M==null?void 0:M.blend)&&q.setBlend(M.blend)},[M==null?void 0:M.blend]),Q0(function(){D.render()}),Z.createElement(BE.Provider,{value:q},Z.createElement(IP,{layer:q,source:t}),l&&Z.createElement(EP,{layer:q,scale:l}),n&&Z.createElement(xP,{layer:q,color:n}),u&&Z.createElement(AP,{layer:q,size:u}),r&&Z.createElement(wP,{layer:q,shape:r}),o&&Z.createElement(kP,{layer:q,style:o}),p&&Z.createElement(yP,{layer:q,active:p}),v&&Z.createElement(SP,{layer:q,select:v}),E&&Z.createElement(bP,{layer:q,filter:E}),w&&Z.createElement(_P,{layer:q,animate:w}),i.children)}var WL=null,XL=null,BP=Z.memo(function(i){return zE("pointLayer",i)}),NP=Z.memo(function(i){return zE("heatmapLayer",i)}),$L=null,YL=null,qL=null,KL=Z.useEffect,QL=null,JL=null;function e0(e){return e0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},e0(e)}function ZE(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function pg(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?ZE(Object(t),!0).forEach(function(n){zP(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ZE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function zP(e,i,t){return i=VE(i),i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function ZP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function UE(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,VE(n.key),n)}}function UP(e,i,t){return i&&UE(e.prototype,i),t&&UE(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function VE(e){var i=VP(e,"string");return e0(i)==="symbol"?i:String(i)}function VP(e,i){if(e0(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,i||"default");if(e0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function GP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Gy(e,i)}function Gy(e,i){return Gy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},Gy(e,i)}function jP(e){var i=XP();return function(){var n=dg(e),r;if(i){var o=dg(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return HP(this,r)}}function HP(e,i){if(i&&(e0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return WP(e)}function WP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function XP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function dg(e){return dg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},dg(e)}var e8=function(e){GP(t,e);var i=jP(t);function t(n){var r;return ZP(this,t),r=i.call(this,n),r.el=void 0,r.scene=void 0,r.popup=void 0,r.el=document.createElement("div"),r}return UP(t,[{key:"componentDidMount",value:function(){var r,o=this.props,u=o.lnglat,l=o.children,p=o.option,v=o.lngLat,E=new ry(pg(pg({},p),{},{stopPropagation:(r=this.props.option)===null||r===void 0?void 0:r.stopPropagation}));u&&E.setLnglat(u),v&&E.setLnglat(v),l&&E.setHTML(this.el),this.popup=E,this.scene.addPopup(E)}},{key:"componentDidUpdate",value:function(r){var o,u,l,p,v,E,w=Array.isArray(r.lnglat)?r.lnglat:[r==null||(o=r.lnglat)===null||o===void 0?void 0:o.lng,r==null||(u=r.lnglat)===null||u===void 0?void 0:u.lat],M=Array.isArray(this.props.lnglat)?this.props.lnglat:[(l=this.props)===null||l===void 0||(p=l.lnglat)===null||p===void 0?void 0:p.lng,(v=this.props)===null||v===void 0||(E=v.lnglat)===null||E===void 0?void 0:E.lat],k=w.toString()!==M.toString();if(k){var D;this.popup.remove(),this.popup=new ry(pg(pg({},this.props.option),{},{stopPropagation:(D=this.props.option)===null||D===void 0?void 0:D.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setHTML(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var r=this;return Z.createElement(_.Consumer,{},function(o){return o&&(r.scene=o),(0,RE.createPortal)(r.props.children,r.el)})}}]),t}(Z.PureComponent);function t0(e){return t0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},t0(e)}function $P(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function GE(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,qP(n.key),n)}}function YP(e,i,t){return i&&GE(e.prototype,i),t&&GE(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function qP(e){var i=KP(e,"string");return t0(i)==="symbol"?i:String(i)}function KP(e,i){if(t0(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,i||"default");if(t0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function QP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&jy(e,i)}function jy(e,i){return jy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},jy(e,i)}function JP(e){var i=rR();return function(){var n=vg(e),r;if(i){var o=vg(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return eR(this,r)}}function eR(e,i){if(i&&(t0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return tR(e)}function tR(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function vg(e){return vg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vg(e)}var t8=function(e){QP(t,e);var i=JP(t);function t(n){var r;return $P(this,t),r=i.call(this,n),r.el=void 0,r.scene=void 0,r.marker=void 0,r.el=document.createElement("div"),r}return YP(t,[{key:"componentDidMount",value:function(){var r=this.props,o=r.lnglat,u=r.children,l=r.option,p=r.onMarkerLoaded,v=new F1(l);o&&v.setLnglat(o),u&&v.setElement(this.el),this.marker=v,p&&p(v),this.scene.addMarker(v)}},{key:"componentDidUpdate",value:function(r){var o,u=JSON.stringify(r==null?void 0:r.lnglat)!==JSON.stringify((o=this.props)===null||o===void 0?void 0:o.lnglat);u&&this.props.lnglat&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var r=this;return Z.createElement(_.Consumer,{},function(o){return o&&(r.scene=o),(0,RE.createPortal)(r.props.children,r.el)})}}]),t}(Z.PureComponent),r8=Z.useEffect,n8=null,i8=null,a8=Z.useEffect,o8=null},59591:function(Yr,ge,ie){var Oe=ie(50008).default;function Z(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Yr.exports=Z=function(){return _},Yr.exports.__esModule=!0,Yr.exports.default=Yr.exports;var _={},Pe=Object.prototype,K=Pe.hasOwnProperty,xe=Object.defineProperty||function(H,U,de){H[U]=de.value},ve=typeof Symbol=="function"?Symbol:{},tt=ve.iterator||"@@iterator",Ae=ve.asyncIterator||"@@asyncIterator",at=ve.toStringTag||"@@toStringTag";function gt(H,U,de){return Object.defineProperty(H,U,{value:de,enumerable:!0,configurable:!0,writable:!0}),H[U]}try{gt({},"")}catch(H){gt=function(de,Xe,lt){return de[Xe]=lt}}function Mt(H,U,de,Xe){var lt=U&&U.prototype instanceof jt?U:jt,yt=Object.create(lt.prototype),Vt=new $r(Xe||[]);return xe(yt,"_invoke",{value:xt(H,de,Vt)}),yt}function Ft(H,U,de){try{return{type:"normal",arg:H.call(U,de)}}catch(Xe){return{type:"throw",arg:Xe}}}_.wrap=Mt;var mr={};function jt(){}function hr(){}function qt(){}var Dt={};gt(Dt,tt,function(){return this});var Pt=Object.getPrototypeOf,Cr=Pt&&Pt(Pt(oe([])));Cr&&Cr!==Pe&&K.call(Cr,tt)&&(Dt=Cr);var ne=qt.prototype=jt.prototype=Object.create(Dt);function gr(H){["next","throw","return"].forEach(function(U){gt(H,U,function(de){return this._invoke(U,de)})})}function It(H,U){function de(lt,yt,Vt,pr){var tn=Ft(H[lt],H,yt);if(tn.type!=="throw"){var Kr=tn.arg,si=Kr.value;return si&&Oe(si)=="object"&&K.call(si,"__await")?U.resolve(si.__await).then(function(xn){de("next",xn,Vt,pr)},function(xn){de("throw",xn,Vt,pr)}):U.resolve(si).then(function(xn){Kr.value=xn,Vt(Kr)},function(xn){return de("throw",xn,Vt,pr)})}pr(tn.arg)}var Xe;xe(this,"_invoke",{value:function(yt,Vt){function pr(){return new U(function(tn,Kr){de(yt,Vt,tn,Kr)})}return Xe=Xe?Xe.then(pr,pr):pr()}})}function xt(H,U,de){var Xe="suspendedStart";return function(lt,yt){if(Xe==="executing")throw new Error("Generator is already running");if(Xe==="completed"){if(lt==="throw")throw yt;return Ue()}for(de.method=lt,de.arg=yt;;){var Vt=de.delegate;if(Vt){var pr=Jt(Vt,de);if(pr){if(pr===mr)continue;return pr}}if(de.method==="next")de.sent=de._sent=de.arg;else if(de.method==="throw"){if(Xe==="suspendedStart")throw Xe="completed",de.arg;de.dispatchException(de.arg)}else de.method==="return"&&de.abrupt("return",de.arg);Xe="executing";var tn=Ft(H,U,de);if(tn.type==="normal"){if(Xe=de.done?"completed":"suspendedYield",tn.arg===mr)continue;return{value:tn.arg,done:de.done}}tn.type==="throw"&&(Xe="completed",de.method="throw",de.arg=tn.arg)}}}function Jt(H,U){var de=U.method,Xe=H.iterator[de];if(Xe===void 0)return U.delegate=null,de==="throw"&&H.iterator.return&&(U.method="return",U.arg=void 0,Jt(H,U),U.method==="throw")||de!=="return"&&(U.method="throw",U.arg=new TypeError("The iterator does not provide a '"+de+"' method")),mr;var lt=Ft(Xe,H.iterator,U.arg);if(lt.type==="throw")return U.method="throw",U.arg=lt.arg,U.delegate=null,mr;var yt=lt.arg;return yt?yt.done?(U[H.resultName]=yt.value,U.next=H.nextLoc,U.method!=="return"&&(U.method="next",U.arg=void 0),U.delegate=null,mr):yt:(U.method="throw",U.arg=new TypeError("iterator result is not an object"),U.delegate=null,mr)}function Ct(H){var U={tryLoc:H[0]};1 in H&&(U.catchLoc=H[1]),2 in H&&(U.finallyLoc=H[2],U.afterLoc=H[3]),this.tryEntries.push(U)}function br(H){var U=H.completion||{};U.type="normal",delete U.arg,H.completion=U}function $r(H){this.tryEntries=[{tryLoc:"root"}],H.forEach(Ct,this),this.reset(!0)}function oe(H){if(H){var U=H[tt];if(U)return U.call(H);if(typeof H.next=="function")return H;if(!isNaN(H.length)){var de=-1,Xe=function lt(){for(;++de<H.length;)if(K.call(H,de))return lt.value=H[de],lt.done=!1,lt;return lt.value=void 0,lt.done=!0,lt};return Xe.next=Xe}}return{next:Ue}}function Ue(){return{value:void 0,done:!0}}return hr.prototype=qt,xe(ne,"constructor",{value:qt,configurable:!0}),xe(qt,"constructor",{value:hr,configurable:!0}),hr.displayName=gt(qt,at,"GeneratorFunction"),_.isGeneratorFunction=function(H){var U=typeof H=="function"&&H.constructor;return!!U&&(U===hr||(U.displayName||U.name)==="GeneratorFunction")},_.mark=function(H){return Object.setPrototypeOf?Object.setPrototypeOf(H,qt):(H.__proto__=qt,gt(H,at,"GeneratorFunction")),H.prototype=Object.create(ne),H},_.awrap=function(H){return{__await:H}},gr(It.prototype),gt(It.prototype,Ae,function(){return this}),_.AsyncIterator=It,_.async=function(H,U,de,Xe,lt){lt===void 0&&(lt=Promise);var yt=new It(Mt(H,U,de,Xe),lt);return _.isGeneratorFunction(U)?yt:yt.next().then(function(Vt){return Vt.done?Vt.value:yt.next()})},gr(ne),gt(ne,at,"Generator"),gt(ne,tt,function(){return this}),gt(ne,"toString",function(){return"[object Generator]"}),_.keys=function(H){var U=Object(H),de=[];for(var Xe in U)de.push(Xe);return de.reverse(),function lt(){for(;de.length;){var yt=de.pop();if(yt in U)return lt.value=yt,lt.done=!1,lt}return lt.done=!0,lt}},_.values=oe,$r.prototype={constructor:$r,reset:function(U){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(br),!U)for(var de in this)de.charAt(0)==="t"&&K.call(this,de)&&!isNaN(+de.slice(1))&&(this[de]=void 0)},stop:function(){this.done=!0;var U=this.tryEntries[0].completion;if(U.type==="throw")throw U.arg;return this.rval},dispatchException:function(U){if(this.done)throw U;var de=this;function Xe(Kr,si){return Vt.type="throw",Vt.arg=U,de.next=Kr,si&&(de.method="next",de.arg=void 0),!!si}for(var lt=this.tryEntries.length-1;lt>=0;--lt){var yt=this.tryEntries[lt],Vt=yt.completion;if(yt.tryLoc==="root")return Xe("end");if(yt.tryLoc<=this.prev){var pr=K.call(yt,"catchLoc"),tn=K.call(yt,"finallyLoc");if(pr&&tn){if(this.prev<yt.catchLoc)return Xe(yt.catchLoc,!0);if(this.prev<yt.finallyLoc)return Xe(yt.finallyLoc)}else if(pr){if(this.prev<yt.catchLoc)return Xe(yt.catchLoc,!0)}else{if(!tn)throw new Error("try statement without catch or finally");if(this.prev<yt.finallyLoc)return Xe(yt.finallyLoc)}}}},abrupt:function(U,de){for(var Xe=this.tryEntries.length-1;Xe>=0;--Xe){var lt=this.tryEntries[Xe];if(lt.tryLoc<=this.prev&&K.call(lt,"finallyLoc")&&this.prev<lt.finallyLoc){var yt=lt;break}}yt&&(U==="break"||U==="continue")&&yt.tryLoc<=de&&de<=yt.finallyLoc&&(yt=null);var Vt=yt?yt.completion:{};return Vt.type=U,Vt.arg=de,yt?(this.method="next",this.next=yt.finallyLoc,mr):this.complete(Vt)},complete:function(U,de){if(U.type==="throw")throw U.arg;return U.type==="break"||U.type==="continue"?this.next=U.arg:U.type==="return"?(this.rval=this.arg=U.arg,this.method="return",this.next="end"):U.type==="normal"&&de&&(this.next=de),mr},finish:function(U){for(var de=this.tryEntries.length-1;de>=0;--de){var Xe=this.tryEntries[de];if(Xe.finallyLoc===U)return this.complete(Xe.completion,Xe.afterLoc),br(Xe),mr}},catch:function(U){for(var de=this.tryEntries.length-1;de>=0;--de){var Xe=this.tryEntries[de];if(Xe.tryLoc===U){var lt=Xe.completion;if(lt.type==="throw"){var yt=lt.arg;br(Xe)}return yt}}throw new Error("illegal catch attempt")},delegateYield:function(U,de,Xe){return this.delegate={iterator:oe(U),resultName:de,nextLoc:Xe},this.method==="next"&&(this.arg=void 0),mr}},_}Yr.exports=Z,Yr.exports.__esModule=!0,Yr.exports.default=Yr.exports},87757:function(Yr,ge,ie){var Oe=ie(59591)();Yr.exports=Oe;try{regeneratorRuntime=Oe}catch(Z){typeof globalThis=="object"?globalThis.regeneratorRuntime=Oe:Function("r","regeneratorRuntime = r")(Oe)}},38163:function(Yr){Yr.exports=ge;function ge(Z,_){var Pe=Z&&Z.type,K;if(Pe==="FeatureCollection")for(K=0;K<Z.features.length;K++)ge(Z.features[K],_);else if(Pe==="GeometryCollection")for(K=0;K<Z.geometries.length;K++)ge(Z.geometries[K],_);else if(Pe==="Feature")ge(Z.geometry,_);else if(Pe==="Polygon")ie(Z.coordinates,_);else if(Pe==="MultiPolygon")for(K=0;K<Z.coordinates.length;K++)ie(Z.coordinates[K],_);return Z}function ie(Z,_){if(Z.length!==0){Oe(Z[0],_);for(var Pe=1;Pe<Z.length;Pe++)Oe(Z[Pe],!_)}}function Oe(Z,_){for(var Pe=0,K=0,xe=0,ve=Z.length,tt=ve-1;xe<ve;tt=xe++){var Ae=(Z[xe][0]-Z[tt][0])*(Z[tt][1]+Z[xe][1]),at=Pe+Ae;K+=Math.abs(Pe)>=Math.abs(Ae)?Pe-at+Ae:Ae-at+Pe,Pe=at}Pe+K>=0!=!!_&&Z.reverse()}},75550:function(Yr){"use strict";Yr.exports=ge;function ge(ie,Oe){this.x=ie,this.y=Oe}ge.prototype={clone:function(){return new ge(this.x,this.y)},add:function(ie){return this.clone()._add(ie)},sub:function(ie){return this.clone()._sub(ie)},multByPoint:function(ie){return this.clone()._multByPoint(ie)},divByPoint:function(ie){return this.clone()._divByPoint(ie)},mult:function(ie){return this.clone()._mult(ie)},div:function(ie){return this.clone()._div(ie)},rotate:function(ie){return this.clone()._rotate(ie)},rotateAround:function(ie,Oe){return this.clone()._rotateAround(ie,Oe)},matMult:function(ie){return this.clone()._matMult(ie)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(ie){return this.x===ie.x&&this.y===ie.y},dist:function(ie){return Math.sqrt(this.distSqr(ie))},distSqr:function(ie){var Oe=ie.x-this.x,Z=ie.y-this.y;return Oe*Oe+Z*Z},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(ie){return Math.atan2(this.y-ie.y,this.x-ie.x)},angleWith:function(ie){return this.angleWithSep(ie.x,ie.y)},angleWithSep:function(ie,Oe){return Math.atan2(this.x*Oe-this.y*ie,this.x*ie+this.y*Oe)},_matMult:function(ie){var Oe=ie[0]*this.x+ie[1]*this.y,Z=ie[2]*this.x+ie[3]*this.y;return this.x=Oe,this.y=Z,this},_add:function(ie){return this.x+=ie.x,this.y+=ie.y,this},_sub:function(ie){return this.x-=ie.x,this.y-=ie.y,this},_mult:function(ie){return this.x*=ie,this.y*=ie,this},_div:function(ie){return this.x/=ie,this.y/=ie,this},_multByPoint:function(ie){return this.x*=ie.x,this.y*=ie.y,this},_divByPoint:function(ie){return this.x/=ie.x,this.y/=ie.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var ie=this.y;return this.y=this.x,this.x=-ie,this},_rotate:function(ie){var Oe=Math.cos(ie),Z=Math.sin(ie),_=Oe*this.x-Z*this.y,Pe=Z*this.x+Oe*this.y;return this.x=_,this.y=Pe,this},_rotateAround:function(ie,Oe){var Z=Math.cos(ie),_=Math.sin(ie),Pe=Oe.x+Z*(this.x-Oe.x)-_*(this.y-Oe.y),K=Oe.y+_*(this.x-Oe.x)+Z*(this.y-Oe.y);return this.x=Pe,this.y=K,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ge.convert=function(ie){return ie instanceof ge?ie:Array.isArray(ie)?new ge(ie[0],ie[1]):ie}},38929:function(Yr,ge,ie){Yr.exports.VectorTile=ie(22779),ie(66024),ie(59701)},22779:function(Yr,ge,ie){"use strict";var Oe=ie(59701);Yr.exports=Z;function Z(Pe,K){this.layers=Pe.readFields(_,{},K)}function _(Pe,K,xe){if(Pe===3){var ve=new Oe(xe,xe.readVarint()+xe.pos);ve.length&&(K[ve.name]=ve)}}},66024:function(Yr,ge,ie){"use strict";var Oe=ie(75550);Yr.exports=Z;function Z(ve,tt,Ae,at,gt){this.properties={},this.extent=Ae,this.type=0,this._pbf=ve,this._geometry=-1,this._keys=at,this._values=gt,ve.readFields(_,this,tt)}function _(ve,tt,Ae){ve==1?tt.id=Ae.readVarint():ve==2?Pe(Ae,tt):ve==3?tt.type=Ae.readVarint():ve==4&&(tt._geometry=Ae.pos)}function Pe(ve,tt){for(var Ae=ve.readVarint()+ve.pos;ve.pos<Ae;){var at=tt._keys[ve.readVarint()],gt=tt._values[ve.readVarint()];tt.properties[at]=gt}}Z.types=["Unknown","Point","LineString","Polygon"],Z.prototype.loadGeometry=function(){var ve=this._pbf;ve.pos=this._geometry;for(var tt=ve.readVarint()+ve.pos,Ae=1,at=0,gt=0,Mt=0,Ft=[],mr;ve.pos<tt;){if(at<=0){var jt=ve.readVarint();Ae=jt&7,at=jt>>3}if(at--,Ae===1||Ae===2)gt+=ve.readSVarint(),Mt+=ve.readSVarint(),Ae===1&&(mr&&Ft.push(mr),mr=[]),mr.push(new Oe(gt,Mt));else if(Ae===7)mr&&mr.push(mr[0].clone());else throw new Error("unknown command "+Ae)}return mr&&Ft.push(mr),Ft},Z.prototype.bbox=function(){var ve=this._pbf;ve.pos=this._geometry;for(var tt=ve.readVarint()+ve.pos,Ae=1,at=0,gt=0,Mt=0,Ft=Infinity,mr=-Infinity,jt=Infinity,hr=-Infinity;ve.pos<tt;){if(at<=0){var qt=ve.readVarint();Ae=qt&7,at=qt>>3}if(at--,Ae===1||Ae===2)gt+=ve.readSVarint(),Mt+=ve.readSVarint(),gt<Ft&&(Ft=gt),gt>mr&&(mr=gt),Mt<jt&&(jt=Mt),Mt>hr&&(hr=Mt);else if(Ae!==7)throw new Error("unknown command "+Ae)}return[Ft,jt,mr,hr]},Z.prototype.toGeoJSON=function(ve,tt,Ae){var at=this.extent*Math.pow(2,Ae),gt=this.extent*ve,Mt=this.extent*tt,Ft=this.loadGeometry(),mr=Z.types[this.type],jt,hr;function qt(Cr){for(var ne=0;ne<Cr.length;ne++){var gr=Cr[ne],It=180-(gr.y+Mt)*360/at;Cr[ne]=[(gr.x+gt)*360/at-180,360/Math.PI*Math.atan(Math.exp(It*Math.PI/180))-90]}}switch(this.type){case 1:var Dt=[];for(jt=0;jt<Ft.length;jt++)Dt[jt]=Ft[jt][0];Ft=Dt,qt(Ft);break;case 2:for(jt=0;jt<Ft.length;jt++)qt(Ft[jt]);break;case 3:for(Ft=K(Ft),jt=0;jt<Ft.length;jt++)for(hr=0;hr<Ft[jt].length;hr++)qt(Ft[jt][hr]);break}Ft.length===1?Ft=Ft[0]:mr="Multi"+mr;var Pt={type:"Feature",geometry:{type:mr,coordinates:Ft},properties:this.properties};return"id"in this&&(Pt.id=this.id),Pt};function K(ve){var tt=ve.length;if(tt<=1)return[ve];for(var Ae=[],at,gt,Mt=0;Mt<tt;Mt++){var Ft=xe(ve[Mt]);Ft!==0&&(gt===void 0&&(gt=Ft<0),gt===Ft<0?(at&&Ae.push(at),at=[ve[Mt]]):at.push(ve[Mt]))}return at&&Ae.push(at),Ae}function xe(ve){for(var tt=0,Ae=0,at=ve.length,gt=at-1,Mt,Ft;Ae<at;gt=Ae++)Mt=ve[Ae],Ft=ve[gt],tt+=(Ft.x-Mt.x)*(Mt.y+Ft.y);return tt}},59701:function(Yr,ge,ie){"use strict";var Oe=ie(66024);Yr.exports=Z;function Z(K,xe){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=K,this._keys=[],this._values=[],this._features=[],K.readFields(_,this,xe),this.length=this._features.length}function _(K,xe,ve){K===15?xe.version=ve.readVarint():K===1?xe.name=ve.readString():K===5?xe.extent=ve.readVarint():K===2?xe._features.push(ve.pos):K===3?xe._keys.push(ve.readString()):K===4&&xe._values.push(Pe(ve))}function Pe(K){for(var xe=null,ve=K.readVarint()+K.pos;K.pos<ve;){var tt=K.readVarint()>>3;xe=tt===1?K.readString():tt===2?K.readFloat():tt===3?K.readDouble():tt===4?K.readVarint64():tt===5?K.readVarint():tt===6?K.readSVarint():tt===7?K.readBoolean():null}return xe}Z.prototype.feature=function(K){if(K<0||K>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[K];var xe=this._pbf.readVarint()+this._pbf.pos;return new Oe(this._pbf,xe,this.extent,this._keys,this._values)}},86582:function(Yr,ge,ie){"use strict";ie.d(ge,{Z:function(){return xe}});var Oe=ie(72560);function Z(ve){if(Array.isArray(ve))return(0,Oe.Z)(ve)}function _(ve){if(typeof Symbol!="undefined"&&ve[Symbol.iterator]!=null||ve["@@iterator"]!=null)return Array.from(ve)}var Pe=ie(64254);function K(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xe(ve){return Z(ve)||_(ve)||(0,Pe.Z)(ve)||K()}},81903:function(){},7277:function(Yr,ge,ie){"use strict";ie.d(ge,{Z:function(){return br}});var Oe=ie(22122),Z=ie(67294),_=ie(57838),Pe=ie(96159),K=ie(96156),xe=ie(94184),ve=ie.n(xe),tt=ie(53124),Ae=ie(90860),at=ie(11726),gt=ie.n(at),Mt=function(oe){var Ue=oe.value,H=oe.formatter,U=oe.precision,de=oe.decimalSeparator,Xe=oe.groupSeparator,lt=Xe===void 0?"":Xe,yt=oe.prefixCls,Vt;if(typeof H=="function")Vt=H(Ue);else{var pr=String(Ue),tn=pr.match(/^(-?)(\d*)(\.(\d+))?$/);if(!tn||pr==="-")Vt=pr;else{var Kr=tn[1],si=tn[2]||"0",xn=tn[4]||"";si=si.replace(/\B(?=(\d{3})+(?!\d))/g,lt),typeof U=="number"&&(xn=gt()(xn,U,"0").slice(0,U>0?U:0)),xn&&(xn="".concat(de).concat(xn)),Vt=[Z.createElement("span",{key:"int",className:"".concat(yt,"-content-value-int")},Kr,si),xn&&Z.createElement("span",{key:"decimal",className:"".concat(yt,"-content-value-decimal")},xn)]}}return Z.createElement("span",{className:"".concat(yt,"-content-value")},Vt)},Ft=Mt,mr=function(oe){var Ue=oe.prefixCls,H=oe.className,U=oe.style,de=oe.valueStyle,Xe=oe.value,lt=Xe===void 0?0:Xe,yt=oe.title,Vt=oe.valueRender,pr=oe.prefix,tn=oe.suffix,Kr=oe.loading,si=Kr===void 0?!1:Kr,xn=oe.direction,ii=oe.onMouseEnter,Ra=oe.onMouseLeave,Di=oe.decimalSeparator,Pi=Di===void 0?".":Di,ua=oe.groupSeparator,sa=ua===void 0?",":ua,Bi=Z.createElement(Ft,(0,Oe.Z)({decimalSeparator:Pi,groupSeparator:sa},oe,{value:lt})),Yn=ve()(Ue,(0,K.Z)({},"".concat(Ue,"-rtl"),xn==="rtl"),H);return Z.createElement("div",{className:Yn,style:U,onMouseEnter:ii,onMouseLeave:Ra},yt&&Z.createElement("div",{className:"".concat(Ue,"-title")},yt),Z.createElement(Ae.Z,{paragraph:!1,loading:si,className:"".concat(Ue,"-skeleton")},Z.createElement("div",{style:de,className:"".concat(Ue,"-content")},pr&&Z.createElement("span",{className:"".concat(Ue,"-content-prefix")},pr),Vt?Vt(Bi):Bi,tn&&Z.createElement("span",{className:"".concat(Ue,"-content-suffix")},tn))))},jt=(0,tt.PG)({prefixCls:"statistic"})(mr),hr=jt,qt=ie(28481),Dt=ie(32475),Pt=ie.n(Dt),Cr=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function ne($r,oe){var Ue=$r,H=/\[[^\]]*]/g,U=(oe.match(H)||[]).map(function(yt){return yt.slice(1,-1)}),de=oe.replace(H,"[]"),Xe=Cr.reduce(function(yt,Vt){var pr=(0,qt.Z)(Vt,2),tn=pr[0],Kr=pr[1];if(yt.includes(tn)){var si=Math.floor(Ue/Kr);return Ue-=si*Kr,yt.replace(new RegExp("".concat(tn,"+"),"g"),function(xn){var ii=xn.length;return Pt()(si.toString(),ii,"0")})}return yt},de),lt=0;return Xe.replace(H,function(){var yt=U[lt];return lt+=1,yt})}function gr($r,oe){var Ue=oe.format,H=Ue===void 0?"":Ue,U=new Date($r).getTime(),de=Date.now(),Xe=Math.max(U-de,0);return ne(Xe,H)}var It=1e3/30;function xt($r){return new Date($r).getTime()}var Jt=function(oe){var Ue=oe.value,H=oe.format,U=H===void 0?"HH:mm:ss":H,de=oe.onChange,Xe=oe.onFinish,lt=(0,_.Z)(),yt=Z.useRef(null),Vt=function(){Xe==null||Xe(),yt.current&&(clearInterval(yt.current),yt.current=null)},pr=function(){var xn=xt(Ue);xn>=Date.now()&&(yt.current=setInterval(function(){lt(),de==null||de(xn-Date.now()),xn<Date.now()&&Vt()},It))};Z.useEffect(function(){return pr(),function(){yt.current&&(clearInterval(yt.current),yt.current=null)}},[Ue]);var tn=function(xn,ii){return gr(xn,(0,Oe.Z)((0,Oe.Z)({},ii),{format:U}))},Kr=function(xn){return(0,Pe.Tm)(xn,{title:void 0})};return Z.createElement(hr,(0,Oe.Z)({},oe,{valueRender:Kr,formatter:tn}))},Ct=Z.memo(Jt);hr.Countdown=Ct;var br=hr},95300:function(Yr,ge,ie){"use strict";var Oe=ie(38663),Z=ie.n(Oe),_=ie(81903),Pe=ie.n(_),K=ie(18446)},9187:function(Yr){"use strict";Yr.exports=ge,Yr.exports.default=ge;function ge(H,U,de){de=de||2;var Xe=U&&U.length,lt=Xe?U[0]*de:H.length,yt=ie(H,0,lt,de,!0),Vt=[];if(!yt||yt.next===yt.prev)return Vt;var pr,tn,Kr,si,xn,ii,Ra;if(Xe&&(yt=ve(H,U,yt,de)),H.length>80*de){pr=Kr=H[0],tn=si=H[1];for(var Di=de;Di<lt;Di+=de)xn=H[Di],ii=H[Di+1],xn<pr&&(pr=xn),ii<tn&&(tn=ii),xn>Kr&&(Kr=xn),ii>si&&(si=ii);Ra=Math.max(Kr-pr,si-tn),Ra=Ra!==0?32767/Ra:0}return Z(yt,Vt,de,pr,tn,Ra,0),Vt}function ie(H,U,de,Xe,lt){var yt,Vt;if(lt===Ue(H,U,de,Xe)>0)for(yt=U;yt<de;yt+=Xe)Vt=br(yt,H[yt],H[yt+1],Vt);else for(yt=de-Xe;yt>=U;yt-=Xe)Vt=br(yt,H[yt],H[yt+1],Vt);return Vt&&Pt(Vt,Vt.next)&&($r(Vt),Vt=Vt.next),Vt}function Oe(H,U){if(!H)return H;U||(U=H);var de=H,Xe;do if(Xe=!1,!de.steiner&&(Pt(de,de.next)||Dt(de.prev,de,de.next)===0)){if($r(de),de=U=de.prev,de===de.next)break;Xe=!0}else de=de.next;while(Xe||de!==U);return U}function Z(H,U,de,Xe,lt,yt,Vt){if(!!H){!Vt&&yt&&Mt(H,Xe,lt,yt);for(var pr=H,tn,Kr;H.prev!==H.next;){if(tn=H.prev,Kr=H.next,yt?Pe(H,Xe,lt,yt):_(H)){U.push(tn.i/de|0),U.push(H.i/de|0),U.push(Kr.i/de|0),$r(H),H=Kr.next,pr=Kr.next;continue}if(H=Kr,H===pr){Vt?Vt===1?(H=K(Oe(H),U,de),Z(H,U,de,Xe,lt,yt,2)):Vt===2&&xe(H,U,de,Xe,lt,yt):Z(Oe(H),U,de,Xe,lt,yt,1);break}}}}function _(H){var U=H.prev,de=H,Xe=H.next;if(Dt(U,de,Xe)>=0)return!1;for(var lt=U.x,yt=de.x,Vt=Xe.x,pr=U.y,tn=de.y,Kr=Xe.y,si=lt<yt?lt<Vt?lt:Vt:yt<Vt?yt:Vt,xn=pr<tn?pr<Kr?pr:Kr:tn<Kr?tn:Kr,ii=lt>yt?lt>Vt?lt:Vt:yt>Vt?yt:Vt,Ra=pr>tn?pr>Kr?pr:Kr:tn>Kr?tn:Kr,Di=Xe.next;Di!==U;){if(Di.x>=si&&Di.x<=ii&&Di.y>=xn&&Di.y<=Ra&&hr(lt,pr,yt,tn,Vt,Kr,Di.x,Di.y)&&Dt(Di.prev,Di,Di.next)>=0)return!1;Di=Di.next}return!0}function Pe(H,U,de,Xe){var lt=H.prev,yt=H,Vt=H.next;if(Dt(lt,yt,Vt)>=0)return!1;for(var pr=lt.x,tn=yt.x,Kr=Vt.x,si=lt.y,xn=yt.y,ii=Vt.y,Ra=pr<tn?pr<Kr?pr:Kr:tn<Kr?tn:Kr,Di=si<xn?si<ii?si:ii:xn<ii?xn:ii,Pi=pr>tn?pr>Kr?pr:Kr:tn>Kr?tn:Kr,ua=si>xn?si>ii?si:ii:xn>ii?xn:ii,sa=mr(Ra,Di,U,de,Xe),Bi=mr(Pi,ua,U,de,Xe),Yn=H.prevZ,bi=H.nextZ;Yn&&Yn.z>=sa&&bi&&bi.z<=Bi;){if(Yn.x>=Ra&&Yn.x<=Pi&&Yn.y>=Di&&Yn.y<=ua&&Yn!==lt&&Yn!==Vt&&hr(pr,si,tn,xn,Kr,ii,Yn.x,Yn.y)&&Dt(Yn.prev,Yn,Yn.next)>=0||(Yn=Yn.prevZ,bi.x>=Ra&&bi.x<=Pi&&bi.y>=Di&&bi.y<=ua&&bi!==lt&&bi!==Vt&&hr(pr,si,tn,xn,Kr,ii,bi.x,bi.y)&&Dt(bi.prev,bi,bi.next)>=0))return!1;bi=bi.nextZ}for(;Yn&&Yn.z>=sa;){if(Yn.x>=Ra&&Yn.x<=Pi&&Yn.y>=Di&&Yn.y<=ua&&Yn!==lt&&Yn!==Vt&&hr(pr,si,tn,xn,Kr,ii,Yn.x,Yn.y)&&Dt(Yn.prev,Yn,Yn.next)>=0)return!1;Yn=Yn.prevZ}for(;bi&&bi.z<=Bi;){if(bi.x>=Ra&&bi.x<=Pi&&bi.y>=Di&&bi.y<=ua&&bi!==lt&&bi!==Vt&&hr(pr,si,tn,xn,Kr,ii,bi.x,bi.y)&&Dt(bi.prev,bi,bi.next)>=0)return!1;bi=bi.nextZ}return!0}function K(H,U,de){var Xe=H;do{var lt=Xe.prev,yt=Xe.next.next;!Pt(lt,yt)&&Cr(lt,Xe,Xe.next,yt)&&xt(lt,yt)&&xt(yt,lt)&&(U.push(lt.i/de|0),U.push(Xe.i/de|0),U.push(yt.i/de|0),$r(Xe),$r(Xe.next),Xe=H=yt),Xe=Xe.next}while(Xe!==H);return Oe(Xe)}function xe(H,U,de,Xe,lt,yt){var Vt=H;do{for(var pr=Vt.next.next;pr!==Vt.prev;){if(Vt.i!==pr.i&&qt(Vt,pr)){var tn=Ct(Vt,pr);Vt=Oe(Vt,Vt.next),tn=Oe(tn,tn.next),Z(Vt,U,de,Xe,lt,yt,0),Z(tn,U,de,Xe,lt,yt,0);return}pr=pr.next}Vt=Vt.next}while(Vt!==H)}function ve(H,U,de,Xe){var lt=[],yt,Vt,pr,tn,Kr;for(yt=0,Vt=U.length;yt<Vt;yt++)pr=U[yt]*Xe,tn=yt<Vt-1?U[yt+1]*Xe:H.length,Kr=ie(H,pr,tn,Xe,!1),Kr===Kr.next&&(Kr.steiner=!0),lt.push(jt(Kr));for(lt.sort(tt),yt=0;yt<lt.length;yt++)de=Ae(lt[yt],de);return de}function tt(H,U){return H.x-U.x}function Ae(H,U){var de=at(H,U);if(!de)return U;var Xe=Ct(de,H);return Oe(Xe,Xe.next),Oe(de,de.next)}function at(H,U){var de=U,Xe=H.x,lt=H.y,yt=-Infinity,Vt;do{if(lt<=de.y&&lt>=de.next.y&&de.next.y!==de.y){var pr=de.x+(lt-de.y)*(de.next.x-de.x)/(de.next.y-de.y);if(pr<=Xe&&pr>yt&&(yt=pr,Vt=de.x<de.next.x?de:de.next,pr===Xe))return Vt}de=de.next}while(de!==U);if(!Vt)return null;var tn=Vt,Kr=Vt.x,si=Vt.y,xn=Infinity,ii;de=Vt;do Xe>=de.x&&de.x>=Kr&&Xe!==de.x&&hr(lt<si?Xe:yt,lt,Kr,si,lt<si?yt:Xe,lt,de.x,de.y)&&(ii=Math.abs(lt-de.y)/(Xe-de.x),xt(de,H)&&(ii<xn||ii===xn&&(de.x>Vt.x||de.x===Vt.x&&gt(Vt,de)))&&(Vt=de,xn=ii)),de=de.next;while(de!==tn);return Vt}function gt(H,U){return Dt(H.prev,H,U.prev)<0&&Dt(U.next,H,H.next)<0}function Mt(H,U,de,Xe){var lt=H;do lt.z===0&&(lt.z=mr(lt.x,lt.y,U,de,Xe)),lt.prevZ=lt.prev,lt.nextZ=lt.next,lt=lt.next;while(lt!==H);lt.prevZ.nextZ=null,lt.prevZ=null,Ft(lt)}function Ft(H){var U,de,Xe,lt,yt,Vt,pr,tn,Kr=1;do{for(de=H,H=null,yt=null,Vt=0;de;){for(Vt++,Xe=de,pr=0,U=0;U<Kr&&(pr++,Xe=Xe.nextZ,!!Xe);U++);for(tn=Kr;pr>0||tn>0&&Xe;)pr!==0&&(tn===0||!Xe||de.z<=Xe.z)?(lt=de,de=de.nextZ,pr--):(lt=Xe,Xe=Xe.nextZ,tn--),yt?yt.nextZ=lt:H=lt,lt.prevZ=yt,yt=lt;de=Xe}yt.nextZ=null,Kr*=2}while(Vt>1);return H}function mr(H,U,de,Xe,lt){return H=(H-de)*lt|0,U=(U-Xe)*lt|0,H=(H|H<<8)&16711935,H=(H|H<<4)&252645135,H=(H|H<<2)&858993459,H=(H|H<<1)&1431655765,U=(U|U<<8)&16711935,U=(U|U<<4)&252645135,U=(U|U<<2)&858993459,U=(U|U<<1)&1431655765,H|U<<1}function jt(H){var U=H,de=H;do(U.x<de.x||U.x===de.x&&U.y<de.y)&&(de=U),U=U.next;while(U!==H);return de}function hr(H,U,de,Xe,lt,yt,Vt,pr){return(lt-Vt)*(U-pr)>=(H-Vt)*(yt-pr)&&(H-Vt)*(Xe-pr)>=(de-Vt)*(U-pr)&&(de-Vt)*(yt-pr)>=(lt-Vt)*(Xe-pr)}function qt(H,U){return H.next.i!==U.i&&H.prev.i!==U.i&&!It(H,U)&&(xt(H,U)&&xt(U,H)&&Jt(H,U)&&(Dt(H.prev,H,U.prev)||Dt(H,U.prev,U))||Pt(H,U)&&Dt(H.prev,H,H.next)>0&&Dt(U.prev,U,U.next)>0)}function Dt(H,U,de){return(U.y-H.y)*(de.x-U.x)-(U.x-H.x)*(de.y-U.y)}function Pt(H,U){return H.x===U.x&&H.y===U.y}function Cr(H,U,de,Xe){var lt=gr(Dt(H,U,de)),yt=gr(Dt(H,U,Xe)),Vt=gr(Dt(de,Xe,H)),pr=gr(Dt(de,Xe,U));return!!(lt!==yt&&Vt!==pr||lt===0&&ne(H,de,U)||yt===0&&ne(H,Xe,U)||Vt===0&&ne(de,H,Xe)||pr===0&&ne(de,U,Xe))}function ne(H,U,de){return U.x<=Math.max(H.x,de.x)&&U.x>=Math.min(H.x,de.x)&&U.y<=Math.max(H.y,de.y)&&U.y>=Math.min(H.y,de.y)}function gr(H){return H>0?1:H<0?-1:0}function It(H,U){var de=H;do{if(de.i!==H.i&&de.next.i!==H.i&&de.i!==U.i&&de.next.i!==U.i&&Cr(de,de.next,H,U))return!0;de=de.next}while(de!==H);return!1}function xt(H,U){return Dt(H.prev,H,H.next)<0?Dt(H,U,H.next)>=0&&Dt(H,H.prev,U)>=0:Dt(H,U,H.prev)<0||Dt(H,H.next,U)<0}function Jt(H,U){var de=H,Xe=!1,lt=(H.x+U.x)/2,yt=(H.y+U.y)/2;do de.y>yt!=de.next.y>yt&&de.next.y!==de.y&&lt<(de.next.x-de.x)*(yt-de.y)/(de.next.y-de.y)+de.x&&(Xe=!Xe),de=de.next;while(de!==H);return Xe}function Ct(H,U){var de=new oe(H.i,H.x,H.y),Xe=new oe(U.i,U.x,U.y),lt=H.next,yt=U.prev;return H.next=U,U.prev=H,de.next=lt,lt.prev=de,Xe.next=de,de.prev=Xe,yt.next=Xe,Xe.prev=yt,Xe}function br(H,U,de,Xe){var lt=new oe(H,U,de);return Xe?(lt.next=Xe.next,lt.prev=Xe,Xe.next.prev=lt,Xe.next=lt):(lt.prev=lt,lt.next=lt),lt}function $r(H){H.next.prev=H.prev,H.prev.next=H.next,H.prevZ&&(H.prevZ.nextZ=H.nextZ),H.nextZ&&(H.nextZ.prevZ=H.prevZ)}function oe(H,U,de){this.i=H,this.x=U,this.y=de,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ge.deviation=function(H,U,de,Xe){var lt=U&&U.length,yt=lt?U[0]*de:H.length,Vt=Math.abs(Ue(H,0,yt,de));if(lt)for(var pr=0,tn=U.length;pr<tn;pr++){var Kr=U[pr]*de,si=pr<tn-1?U[pr+1]*de:H.length;Vt-=Math.abs(Ue(H,Kr,si,de))}var xn=0;for(pr=0;pr<Xe.length;pr+=3){var ii=Xe[pr]*de,Ra=Xe[pr+1]*de,Di=Xe[pr+2]*de;xn+=Math.abs((H[ii]-H[Di])*(H[Ra+1]-H[ii+1])-(H[ii]-H[Ra])*(H[Di+1]-H[ii+1]))}return Vt===0&&xn===0?0:Math.abs((xn-Vt)/Vt)};function Ue(H,U,de,Xe){for(var lt=0,yt=U,Vt=de-Xe;yt<de;yt+=Xe)lt+=(H[Vt]-H[yt])*(H[yt+1]+H[Vt+1]),Vt=yt;return lt}ge.flatten=function(H){for(var U=H[0][0].length,de={vertices:[],holes:[],dimensions:U},Xe=0,lt=0;lt<H.length;lt++){for(var yt=0;yt<H[lt].length;yt++)for(var Vt=0;Vt<U;Vt++)de.vertices.push(H[lt][yt][Vt]);lt>0&&(Xe+=H[lt-1].length,de.holes.push(Xe))}return de}},67709:function(Yr){function ge(Oe){var Z=Oe.target||Oe.srcElement;Z.__resizeRAF__&&cancelAnimationFrame(Z.__resizeRAF__),Z.__resizeRAF__=requestAnimationFrame(function(){var _=Z.__resizeTrigger__,Pe=_&&_.__resizeListeners__;Pe&&Pe.forEach(function(K){K.call(_,Oe)})})}var ie=function(Z,_){var Pe=this,K=Pe.document,xe,ve=K.attachEvent;typeof navigator!="undefined"&&(xe=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function tt(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",ge)}if(!Z.__resizeListeners__)if(Z.__resizeListeners__=[],ve)Z.__resizeTrigger__=Z,Z.attachEvent("onresize",ge);else{getComputedStyle(Z).position==="static"&&(Z.style.position="relative");var Ae=Z.__resizeTrigger__=K.createElement("object");Ae.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),Ae.setAttribute("class","resize-sensor"),Ae.setAttribute("tabindex","-1"),Ae.setAttribute("title",""),Ae.__resizeElement__=Z,Ae.onload=tt,Ae.type="text/html",xe&&Z.appendChild(Ae),Ae.data="about:blank",xe||Z.appendChild(Ae)}Z.__resizeListeners__.push(_)};Yr.exports=typeof window=="undefined"?ie:ie.bind(window),Yr.exports.unbind=function(Oe,Z){var _=document.attachEvent,Pe=Oe.__resizeListeners__||[];if(Z){var K=Pe.indexOf(Z);K!==-1&&Pe.splice(K,1)}else Pe=Oe.__resizeListeners__=[];if(!Pe.length){if(_)Oe.detachEvent("onresize",ge);else if(Oe.__resizeTrigger__){var xe=Oe.__resizeTrigger__.contentDocument,ve=xe&&xe.defaultView;ve&&(ve.removeEventListener("resize",ge),delete ve.__resizeTrigger__),Oe.__resizeTrigger__=!Oe.removeChild(Oe.__resizeTrigger__)}delete Oe.__resizeListeners__}}},26729:function(Yr){"use strict";var ge=Object.prototype.hasOwnProperty,ie="~";function Oe(){}Object.create&&(Oe.prototype=Object.create(null),new Oe().__proto__||(ie=!1));function Z(xe,ve,tt){this.fn=xe,this.context=ve,this.once=tt||!1}function _(xe,ve,tt,Ae,at){if(typeof tt!="function")throw new TypeError("The listener must be a function");var gt=new Z(tt,Ae||xe,at),Mt=ie?ie+ve:ve;return xe._events[Mt]?xe._events[Mt].fn?xe._events[Mt]=[xe._events[Mt],gt]:xe._events[Mt].push(gt):(xe._events[Mt]=gt,xe._eventsCount++),xe}function Pe(xe,ve){--xe._eventsCount==0?xe._events=new Oe:delete xe._events[ve]}function K(){this._events=new Oe,this._eventsCount=0}K.prototype.eventNames=function(){var ve=[],tt,Ae;if(this._eventsCount===0)return ve;for(Ae in tt=this._events)ge.call(tt,Ae)&&ve.push(ie?Ae.slice(1):Ae);return Object.getOwnPropertySymbols?ve.concat(Object.getOwnPropertySymbols(tt)):ve},K.prototype.listeners=function(ve){var tt=ie?ie+ve:ve,Ae=this._events[tt];if(!Ae)return[];if(Ae.fn)return[Ae.fn];for(var at=0,gt=Ae.length,Mt=new Array(gt);at<gt;at++)Mt[at]=Ae[at].fn;return Mt},K.prototype.listenerCount=function(ve){var tt=ie?ie+ve:ve,Ae=this._events[tt];return Ae?Ae.fn?1:Ae.length:0},K.prototype.emit=function(ve,tt,Ae,at,gt,Mt){var Ft=ie?ie+ve:ve;if(!this._events[Ft])return!1;var mr=this._events[Ft],jt=arguments.length,hr,qt;if(mr.fn){switch(mr.once&&this.removeListener(ve,mr.fn,void 0,!0),jt){case 1:return mr.fn.call(mr.context),!0;case 2:return mr.fn.call(mr.context,tt),!0;case 3:return mr.fn.call(mr.context,tt,Ae),!0;case 4:return mr.fn.call(mr.context,tt,Ae,at),!0;case 5:return mr.fn.call(mr.context,tt,Ae,at,gt),!0;case 6:return mr.fn.call(mr.context,tt,Ae,at,gt,Mt),!0}for(qt=1,hr=new Array(jt-1);qt<jt;qt++)hr[qt-1]=arguments[qt];mr.fn.apply(mr.context,hr)}else{var Dt=mr.length,Pt;for(qt=0;qt<Dt;qt++)switch(mr[qt].once&&this.removeListener(ve,mr[qt].fn,void 0,!0),jt){case 1:mr[qt].fn.call(mr[qt].context);break;case 2:mr[qt].fn.call(mr[qt].context,tt);break;case 3:mr[qt].fn.call(mr[qt].context,tt,Ae);break;case 4:mr[qt].fn.call(mr[qt].context,tt,Ae,at);break;default:if(!hr)for(Pt=1,hr=new Array(jt-1);Pt<jt;Pt++)hr[Pt-1]=arguments[Pt];mr[qt].fn.apply(mr[qt].context,hr)}}return!0},K.prototype.on=function(ve,tt,Ae){return _(this,ve,tt,Ae,!1)},K.prototype.once=function(ve,tt,Ae){return _(this,ve,tt,Ae,!0)},K.prototype.removeListener=function(ve,tt,Ae,at){var gt=ie?ie+ve:ve;if(!this._events[gt])return this;if(!tt)return Pe(this,gt),this;var Mt=this._events[gt];if(Mt.fn)Mt.fn===tt&&(!at||Mt.once)&&(!Ae||Mt.context===Ae)&&Pe(this,gt);else{for(var Ft=0,mr=[],jt=Mt.length;Ft<jt;Ft++)(Mt[Ft].fn!==tt||at&&!Mt[Ft].once||Ae&&Mt[Ft].context!==Ae)&&mr.push(Mt[Ft]);mr.length?this._events[gt]=mr.length===1?mr[0]:mr:Pe(this,gt)}return this},K.prototype.removeAllListeners=function(ve){var tt;return ve?(tt=ie?ie+ve:ve,this._events[tt]&&Pe(this,tt)):(this._events=new Oe,this._eventsCount=0),this},K.prototype.off=K.prototype.removeListener,K.prototype.addListener=K.prototype.on,K.prefixed=ie,K.EventEmitter=K,Yr.exports=K},80645:function(Yr,ge){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ge.read=function(ie,Oe,Z,_,Pe){var K,xe,ve=Pe*8-_-1,tt=(1<<ve)-1,Ae=tt>>1,at=-7,gt=Z?Pe-1:0,Mt=Z?-1:1,Ft=ie[Oe+gt];for(gt+=Mt,K=Ft&(1<<-at)-1,Ft>>=-at,at+=ve;at>0;K=K*256+ie[Oe+gt],gt+=Mt,at-=8);for(xe=K&(1<<-at)-1,K>>=-at,at+=_;at>0;xe=xe*256+ie[Oe+gt],gt+=Mt,at-=8);if(K===0)K=1-Ae;else{if(K===tt)return xe?NaN:(Ft?-1:1)*Infinity;xe=xe+Math.pow(2,_),K=K-Ae}return(Ft?-1:1)*xe*Math.pow(2,K-_)},ge.write=function(ie,Oe,Z,_,Pe,K){var xe,ve,tt,Ae=K*8-Pe-1,at=(1<<Ae)-1,gt=at>>1,Mt=Pe===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ft=_?0:K-1,mr=_?1:-1,jt=Oe<0||Oe===0&&1/Oe<0?1:0;for(Oe=Math.abs(Oe),isNaN(Oe)||Oe===Infinity?(ve=isNaN(Oe)?1:0,xe=at):(xe=Math.floor(Math.log(Oe)/Math.LN2),Oe*(tt=Math.pow(2,-xe))<1&&(xe--,tt*=2),xe+gt>=1?Oe+=Mt/tt:Oe+=Mt*Math.pow(2,1-gt),Oe*tt>=2&&(xe++,tt/=2),xe+gt>=at?(ve=0,xe=at):xe+gt>=1?(ve=(Oe*tt-1)*Math.pow(2,Pe),xe=xe+gt):(ve=Oe*Math.pow(2,gt-1)*Math.pow(2,Pe),xe=0));Pe>=8;ie[Z+Ft]=ve&255,Ft+=mr,ve/=256,Pe-=8);for(xe=xe<<Pe|ve,Ae+=Pe;Ae>0;ie[Z+Ft]=xe&255,Ft+=mr,xe/=256,Ae-=8);ie[Z+Ft-mr]|=jt*128}},7375:function(Yr,ge){"use strict";Object.defineProperty(ge,"__esModule",{value:!0});var ie=Symbol.for("INJECTION");function Oe(xe,ve,tt,Ae){function at(){return Ae&&!Reflect.hasMetadata(ie,this,ve)&&Reflect.defineMetadata(ie,tt(),this,ve),Reflect.hasMetadata(ie,this,ve)?Reflect.getMetadata(ie,this,ve):tt()}function gt(Mt){Reflect.defineMetadata(ie,Mt,this,ve)}Object.defineProperty(xe,ve,{configurable:!0,enumerable:!0,get:at,set:gt})}function Z(xe,ve){return function(tt){return function(Ae,at){var gt=function(){return xe.get(tt)};Oe(Ae,at,gt,ve)}}}ge.makePropertyInjectDecorator=Z;function _(xe,ve){return function(tt,Ae){return function(at,gt){var Mt=function(){return xe.getNamed(tt,Ae)};Oe(at,gt,Mt,ve)}}}ge.makePropertyInjectNamedDecorator=_;function Pe(xe,ve){return function(tt,Ae,at){return function(gt,Mt){var Ft=function(){return xe.getTagged(tt,Ae,at)};Oe(gt,Mt,Ft,ve)}}}ge.makePropertyInjectTaggedDecorator=Pe;function K(xe,ve){return function(tt){return function(Ae,at){var gt=function(){return xe.getAll(tt)};Oe(Ae,at,gt,ve)}}}ge.makePropertyMultiInjectDecorator=K},84879:function(Yr,ge,ie){"use strict";var Oe;Oe={value:!0};var Z=ie(7375);function _(Pe,K){K===void 0&&(K=!0);var xe=Z.makePropertyInjectDecorator(Pe,K),ve=Z.makePropertyInjectNamedDecorator(Pe,K),tt=Z.makePropertyInjectTaggedDecorator(Pe,K),Ae=Z.makePropertyMultiInjectDecorator(Pe,K);return{lazyInject:xe,lazyInjectNamed:ve,lazyInjectTagged:tt,lazyMultiInject:Ae}}ge.Z=_},99934:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.tagProperty=ge.tagParameter=ge.decorate=void 0;var Oe=ie(16674),Z=ie(6867);function _(Ae,at,gt,Mt){var Ft=Z.TAGGED;K(Ft,Ae,at,Mt,gt)}ge.tagParameter=_;function Pe(Ae,at,gt){var Mt=Z.TAGGED_PROP;K(Mt,Ae.constructor,at,gt)}ge.tagProperty=Pe;function K(Ae,at,gt,Mt,Ft){var mr={},jt=typeof Ft=="number",hr=Ft!==void 0&&jt?Ft.toString():gt;if(jt&&gt!==void 0)throw new Error(Oe.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(Ae,at)&&(mr=Reflect.getMetadata(Ae,at));var qt=mr[hr];if(!Array.isArray(qt))qt=[];else for(var Dt=0,Pt=qt;Dt<Pt.length;Dt++){var Cr=Pt[Dt];if(Cr.key===Mt.key)throw new Error(Oe.DUPLICATED_METADATA+" "+Cr.key.toString())}qt.push(Mt),mr[hr]=qt,Reflect.defineMetadata(Ae,mr,at)}function xe(Ae,at){Reflect.decorate(Ae,at)}function ve(Ae,at){return function(gt,Mt){at(gt,Mt,Ae)}}function tt(Ae,at,gt){typeof gt=="number"?xe([ve(gt,Ae)],at):typeof gt=="string"?Reflect.decorate([Ae],at,gt):xe([Ae],at)}ge.decorate=tt},5744:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.inject=ge.LazyServiceIdentifer=void 0;var Oe=ie(16674),Z=ie(6867),_=ie(47738),Pe=ie(99934),K=function(){function ve(tt){this._cb=tt}return ve.prototype.unwrap=function(){return this._cb()},ve}();ge.LazyServiceIdentifer=K;function xe(ve){return function(tt,Ae,at){if(ve===void 0)throw new Error(Oe.UNDEFINED_INJECT_ANNOTATION(tt.name));var gt=new _.Metadata(Z.INJECT_TAG,ve);typeof at=="number"?Pe.tagParameter(tt,Ae,at,gt):Pe.tagProperty(tt,Ae,gt)}}ge.inject=xe},64315:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.injectable=void 0;var Oe=ie(16674),Z=ie(6867);function _(){return function(Pe){if(Reflect.hasOwnMetadata(Z.PARAM_TYPES,Pe))throw new Error(Oe.DUPLICATED_INJECTABLE_DECORATOR);var K=Reflect.getMetadata(Z.DESIGN_PARAM_TYPES,Pe)||[];return Reflect.defineMetadata(Z.PARAM_TYPES,K,Pe),Pe}}ge.injectable=_},71693:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.multiInject=void 0;var Oe=ie(6867),Z=ie(47738),_=ie(99934);function Pe(K){return function(xe,ve,tt){var Ae=new Z.Metadata(Oe.MULTI_INJECT_TAG,K);typeof tt=="number"?_.tagParameter(xe,ve,tt,Ae):_.tagProperty(xe,ve,Ae)}}ge.multiInject=Pe},38085:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.named=void 0;var Oe=ie(6867),Z=ie(47738),_=ie(99934);function Pe(K){return function(xe,ve,tt){var Ae=new Z.Metadata(Oe.NAMED_TAG,K);typeof tt=="number"?_.tagParameter(xe,ve,tt,Ae):_.tagProperty(xe,ve,Ae)}}ge.named=Pe},6515:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.optional=void 0;var Oe=ie(6867),Z=ie(47738),_=ie(99934);function Pe(){return function(K,xe,ve){var tt=new Z.Metadata(Oe.OPTIONAL_TAG,!0);typeof ve=="number"?_.tagParameter(K,xe,ve,tt):_.tagProperty(K,xe,tt)}}ge.optional=Pe},7014:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.postConstruct=void 0;var Oe=ie(16674),Z=ie(6867),_=ie(47738);function Pe(){return function(K,xe,ve){var tt=new _.Metadata(Z.POST_CONSTRUCT,xe);if(Reflect.hasOwnMetadata(Z.POST_CONSTRUCT,K.constructor))throw new Error(Oe.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(Z.POST_CONSTRUCT,tt,K.constructor)}}ge.postConstruct=Pe},32052:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.tagged=void 0;var Oe=ie(47738),Z=ie(99934);function _(Pe,K){return function(xe,ve,tt){var Ae=new Oe.Metadata(Pe,K);typeof tt=="number"?Z.tagParameter(xe,ve,tt,Ae):Z.tagProperty(xe,ve,Ae)}}ge.tagged=_},55638:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.targetName=void 0;var Oe=ie(6867),Z=ie(47738),_=ie(99934);function Pe(K){return function(xe,ve,tt){var Ae=new Z.Metadata(Oe.NAME_TAG,K);_.tagParameter(xe,ve,tt,Ae)}}ge.targetName=Pe},86757:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.unmanaged=void 0;var Oe=ie(6867),Z=ie(47738),_=ie(99934);function Pe(){return function(K,xe,ve){var tt=new Z.Metadata(Oe.UNMANAGED_TAG,!0);_.tagParameter(K,xe,ve,tt)}}ge.unmanaged=Pe},44290:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.Binding=void 0;var Oe=ie(28421),Z=ie(37791),_=function(){function Pe(K,xe){this.id=Z.id(),this.activated=!1,this.serviceIdentifier=K,this.scope=xe,this.type=Oe.BindingTypeEnum.Invalid,this.constraint=function(ve){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Pe.prototype.clone=function(){var K=new Pe(this.serviceIdentifier,this.scope);return K.activated=K.scope===Oe.BindingScopeEnum.Singleton?this.activated:!1,K.implementationType=this.implementationType,K.dynamicValue=this.dynamicValue,K.scope=this.scope,K.type=this.type,K.factory=this.factory,K.provider=this.provider,K.constraint=this.constraint,K.onActivation=this.onActivation,K.cache=this.cache,K},Pe}();ge.Binding=_},23184:function(Yr,ge){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.BindingCount=void 0;var ie={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};ge.BindingCount=ie},16674:function(Yr,ge){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.STACK_OVERFLOW=ge.CIRCULAR_DEPENDENCY_IN_FACTORY=ge.POST_CONSTRUCT_ERROR=ge.MULTIPLE_POST_CONSTRUCT_METHODS=ge.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=ge.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=ge.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=ge.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=ge.ARGUMENTS_LENGTH_MISMATCH=ge.INVALID_DECORATOR_OPERATION=ge.INVALID_TO_SELF_VALUE=ge.INVALID_FUNCTION_BINDING=ge.INVALID_MIDDLEWARE_RETURN=ge.NO_MORE_SNAPSHOTS_AVAILABLE=ge.INVALID_BINDING_TYPE=ge.NOT_IMPLEMENTED=ge.CIRCULAR_DEPENDENCY=ge.UNDEFINED_INJECT_ANNOTATION=ge.MISSING_INJECT_ANNOTATION=ge.MISSING_INJECTABLE_ANNOTATION=ge.NOT_REGISTERED=ge.CANNOT_UNBIND=ge.AMBIGUOUS_MATCH=ge.KEY_NOT_FOUND=ge.NULL_ARGUMENT=ge.DUPLICATED_METADATA=ge.DUPLICATED_INJECTABLE_DECORATOR=void 0,ge.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",ge.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",ge.NULL_ARGUMENT="NULL argument",ge.KEY_NOT_FOUND="Key Not Found",ge.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",ge.CANNOT_UNBIND="Could not unbind serviceIdentifier:",ge.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",ge.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",ge.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var ie=function(Pe){return"@inject called with undefined this could mean that the class "+Pe+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};ge.UNDEFINED_INJECT_ANNOTATION=ie,ge.CIRCULAR_DEPENDENCY="Circular dependency found:",ge.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",ge.INVALID_BINDING_TYPE="Invalid binding type:",ge.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",ge.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",ge.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",ge.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",ge.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Oe=function(){for(var Pe=[],K=0;K<arguments.length;K++)Pe[K]=arguments[K];return"The number of constructor arguments in the derived class "+(Pe[0]+" must be >= than the number of constructor arguments of its base class.")};ge.ARGUMENTS_LENGTH_MISMATCH=Oe,ge.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",ge.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",ge.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",ge.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",ge.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var Z=function(){for(var Pe=[],K=0;K<arguments.length;K++)Pe[K]=arguments[K];return"@postConstruct error in class "+Pe[0]+": "+Pe[1]};ge.POST_CONSTRUCT_ERROR=Z;var _=function(){for(var Pe=[],K=0;K<arguments.length;K++)Pe[K]=arguments[K];return"It looks like there is a circular dependency "+("in one of the '"+Pe[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Pe[1]+"'.")};ge.CIRCULAR_DEPENDENCY_IN_FACTORY=_,ge.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Yr,ge){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.TargetTypeEnum=ge.BindingTypeEnum=ge.BindingScopeEnum=void 0;var ie={Request:"Request",Singleton:"Singleton",Transient:"Transient"};ge.BindingScopeEnum=ie;var Oe={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};ge.BindingTypeEnum=Oe;var Z={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};ge.TargetTypeEnum=Z},6867:function(Yr,ge){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.NON_CUSTOM_TAG_KEYS=ge.POST_CONSTRUCT=ge.DESIGN_PARAM_TYPES=ge.PARAM_TYPES=ge.TAGGED_PROP=ge.TAGGED=ge.MULTI_INJECT_TAG=ge.INJECT_TAG=ge.OPTIONAL_TAG=ge.UNMANAGED_TAG=ge.NAME_TAG=ge.NAMED_TAG=void 0,ge.NAMED_TAG="named",ge.NAME_TAG="name",ge.UNMANAGED_TAG="unmanaged",ge.OPTIONAL_TAG="optional",ge.INJECT_TAG="inject",ge.MULTI_INJECT_TAG="multi_inject",ge.TAGGED="inversify:tagged",ge.TAGGED_PROP="inversify:tagged_props",ge.PARAM_TYPES="inversify:paramtypes",ge.DESIGN_PARAM_TYPES="design:paramtypes",ge.POST_CONSTRUCT="post_construct";function ie(){return[ge.INJECT_TAG,ge.MULTI_INJECT_TAG,ge.NAME_TAG,ge.UNMANAGED_TAG,ge.NAMED_TAG,ge.OPTIONAL_TAG]}ge.NON_CUSTOM_TAG_KEYS=ie()},51389:function(Yr,ge,ie){"use strict";var Oe=this&&this.__awaiter||function(qt,Dt,Pt,Cr){function ne(gr){return gr instanceof Pt?gr:new Pt(function(It){It(gr)})}return new(Pt||(Pt=Promise))(function(gr,It){function xt(br){try{Ct(Cr.next(br))}catch($r){It($r)}}function Jt(br){try{Ct(Cr.throw(br))}catch($r){It($r)}}function Ct(br){br.done?gr(br.value):ne(br.value).then(xt,Jt)}Ct((Cr=Cr.apply(qt,Dt||[])).next())})},Z=this&&this.__generator||function(qt,Dt){var Pt={label:0,sent:function(){if(gr[0]&1)throw gr[1];return gr[1]},trys:[],ops:[]},Cr,ne,gr,It;return It={next:xt(0),throw:xt(1),return:xt(2)},typeof Symbol=="function"&&(It[Symbol.iterator]=function(){return this}),It;function xt(Ct){return function(br){return Jt([Ct,br])}}function Jt(Ct){if(Cr)throw new TypeError("Generator is already executing.");for(;Pt;)try{if(Cr=1,ne&&(gr=Ct[0]&2?ne.return:Ct[0]?ne.throw||((gr=ne.return)&&gr.call(ne),0):ne.next)&&!(gr=gr.call(ne,Ct[1])).done)return gr;switch(ne=0,gr&&(Ct=[Ct[0]&2,gr.value]),Ct[0]){case 0:case 1:gr=Ct;break;case 4:return Pt.label++,{value:Ct[1],done:!1};case 5:Pt.label++,ne=Ct[1],Ct=[0];continue;case 7:Ct=Pt.ops.pop(),Pt.trys.pop();continue;default:if(gr=Pt.trys,!(gr=gr.length>0&&gr[gr.length-1])&&(Ct[0]===6||Ct[0]===2)){Pt=0;continue}if(Ct[0]===3&&(!gr||Ct[1]>gr[0]&&Ct[1]<gr[3])){Pt.label=Ct[1];break}if(Ct[0]===6&&Pt.label<gr[1]){Pt.label=gr[1],gr=Ct;break}if(gr&&Pt.label<gr[2]){Pt.label=gr[2],Pt.ops.push(Ct);break}gr[2]&&Pt.ops.pop(),Pt.trys.pop();continue}Ct=Dt.call(qt,Pt)}catch(br){Ct=[6,br],ne=0}finally{Cr=gr=0}if(Ct[0]&5)throw Ct[1];return{value:Ct[0]?Ct[1]:void 0,done:!0}}},_=this&&this.__spreadArray||function(qt,Dt){for(var Pt=0,Cr=Dt.length,ne=qt.length;Pt<Cr;Pt++,ne++)qt[ne]=Dt[Pt];return qt};Object.defineProperty(ge,"__esModule",{value:!0}),ge.Container=void 0;var Pe=ie(44290),K=ie(16674),xe=ie(28421),ve=ie(6867),tt=ie(51377),Ae=ie(86311),at=ie(31927),gt=ie(51860),Mt=ie(37791),Ft=ie(55800),mr=ie(85700),jt=ie(80175),hr=function(){function qt(Dt){this._appliedMiddleware=[];var Pt=Dt||{};if(typeof Pt!="object")throw new Error(""+K.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(Pt.defaultScope===void 0)Pt.defaultScope=xe.BindingScopeEnum.Transient;else if(Pt.defaultScope!==xe.BindingScopeEnum.Singleton&&Pt.defaultScope!==xe.BindingScopeEnum.Transient&&Pt.defaultScope!==xe.BindingScopeEnum.Request)throw new Error(""+K.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(Pt.autoBindInjectable===void 0)Pt.autoBindInjectable=!1;else if(typeof Pt.autoBindInjectable!="boolean")throw new Error(""+K.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(Pt.skipBaseClassChecks===void 0)Pt.skipBaseClassChecks=!1;else if(typeof Pt.skipBaseClassChecks!="boolean")throw new Error(""+K.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:Pt.autoBindInjectable,defaultScope:Pt.defaultScope,skipBaseClassChecks:Pt.skipBaseClassChecks},this.id=Mt.id(),this._bindingDictionary=new jt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new tt.MetadataReader}return qt.merge=function(Dt,Pt){for(var Cr=[],ne=2;ne<arguments.length;ne++)Cr[ne-2]=arguments[ne];var gr=new qt,It=_([Dt,Pt],Cr).map(function(Ct){return Ae.getBindingDictionary(Ct)}),xt=Ae.getBindingDictionary(gr);function Jt(Ct,br){Ct.traverse(function($r,oe){oe.forEach(function(Ue){br.add(Ue.serviceIdentifier,Ue.clone())})})}return It.forEach(function(Ct){Jt(Ct,xt)}),gr},qt.prototype.load=function(){for(var Dt=[],Pt=0;Pt<arguments.length;Pt++)Dt[Pt]=arguments[Pt];for(var Cr=this._getContainerModuleHelpersFactory(),ne=0,gr=Dt;ne<gr.length;ne++){var It=gr[ne],xt=Cr(It.id);It.registry(xt.bindFunction,xt.unbindFunction,xt.isboundFunction,xt.rebindFunction)}},qt.prototype.loadAsync=function(){for(var Dt=[],Pt=0;Pt<arguments.length;Pt++)Dt[Pt]=arguments[Pt];return Oe(this,void 0,void 0,function(){var Cr,ne,gr,It,xt;return Z(this,function(Jt){switch(Jt.label){case 0:Cr=this._getContainerModuleHelpersFactory(),ne=0,gr=Dt,Jt.label=1;case 1:return ne<gr.length?(It=gr[ne],xt=Cr(It.id),[4,It.registry(xt.bindFunction,xt.unbindFunction,xt.isboundFunction,xt.rebindFunction)]):[3,4];case 2:Jt.sent(),Jt.label=3;case 3:return ne++,[3,1];case 4:return[2]}})})},qt.prototype.unload=function(){for(var Dt=this,Pt=[],Cr=0;Cr<arguments.length;Cr++)Pt[Cr]=arguments[Cr];var ne=function(gr){return function(It){return It.moduleId===gr}};Pt.forEach(function(gr){var It=ne(gr.id);Dt._bindingDictionary.removeByCondition(It)})},qt.prototype.bind=function(Dt){var Pt=this.options.defaultScope||xe.BindingScopeEnum.Transient,Cr=new Pe.Binding(Dt,Pt);return this._bindingDictionary.add(Dt,Cr),new gt.BindingToSyntax(Cr)},qt.prototype.rebind=function(Dt){return this.unbind(Dt),this.bind(Dt)},qt.prototype.unbind=function(Dt){try{this._bindingDictionary.remove(Dt)}catch(Pt){throw new Error(K.CANNOT_UNBIND+" "+Ft.getServiceIdentifierAsString(Dt))}},qt.prototype.unbindAll=function(){this._bindingDictionary=new jt.Lookup},qt.prototype.isBound=function(Dt){var Pt=this._bindingDictionary.hasKey(Dt);return!Pt&&this.parent&&(Pt=this.parent.isBound(Dt)),Pt},qt.prototype.isBoundNamed=function(Dt,Pt){return this.isBoundTagged(Dt,ve.NAMED_TAG,Pt)},qt.prototype.isBoundTagged=function(Dt,Pt,Cr){var ne=!1;if(this._bindingDictionary.hasKey(Dt)){var gr=this._bindingDictionary.get(Dt),It=Ae.createMockRequest(this,Dt,Pt,Cr);ne=gr.some(function(xt){return xt.constraint(It)})}return!ne&&this.parent&&(ne=this.parent.isBoundTagged(Dt,Pt,Cr)),ne},qt.prototype.snapshot=function(){this._snapshots.push(mr.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},qt.prototype.restore=function(){var Dt=this._snapshots.pop();if(Dt===void 0)throw new Error(K.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=Dt.bindings,this._middleware=Dt.middleware},qt.prototype.createChild=function(Dt){var Pt=new qt(Dt||this.options);return Pt.parent=this,Pt},qt.prototype.applyMiddleware=function(){for(var Dt=[],Pt=0;Pt<arguments.length;Pt++)Dt[Pt]=arguments[Pt];this._appliedMiddleware=this._appliedMiddleware.concat(Dt);var Cr=this._middleware?this._middleware:this._planAndResolve();this._middleware=Dt.reduce(function(ne,gr){return gr(ne)},Cr)},qt.prototype.applyCustomMetadataReader=function(Dt){this._metadataReader=Dt},qt.prototype.get=function(Dt){return this._get(!1,!1,xe.TargetTypeEnum.Variable,Dt)},qt.prototype.getTagged=function(Dt,Pt,Cr){return this._get(!1,!1,xe.TargetTypeEnum.Variable,Dt,Pt,Cr)},qt.prototype.getNamed=function(Dt,Pt){return this.getTagged(Dt,ve.NAMED_TAG,Pt)},qt.prototype.getAll=function(Dt){return this._get(!0,!0,xe.TargetTypeEnum.Variable,Dt)},qt.prototype.getAllTagged=function(Dt,Pt,Cr){return this._get(!1,!0,xe.TargetTypeEnum.Variable,Dt,Pt,Cr)},qt.prototype.getAllNamed=function(Dt,Pt){return this.getAllTagged(Dt,ve.NAMED_TAG,Pt)},qt.prototype.resolve=function(Dt){var Pt=this.createChild();return Pt.bind(Dt).toSelf(),this._appliedMiddleware.forEach(function(Cr){Pt.applyMiddleware(Cr)}),Pt.get(Dt)},qt.prototype._getContainerModuleHelpersFactory=function(){var Dt=this,Pt=function(xt,Jt){xt._binding.moduleId=Jt},Cr=function(xt){return function(Jt){var Ct=Dt.bind.bind(Dt),br=Ct(Jt);return Pt(br,xt),br}},ne=function(xt){return function(Jt){var Ct=Dt.unbind.bind(Dt);Ct(Jt)}},gr=function(xt){return function(Jt){var Ct=Dt.isBound.bind(Dt);return Ct(Jt)}},It=function(xt){return function(Jt){var Ct=Dt.rebind.bind(Dt),br=Ct(Jt);return Pt(br,xt),br}};return function(xt){return{bindFunction:Cr(xt),isboundFunction:gr(xt),rebindFunction:It(xt),unbindFunction:ne(xt)}}},qt.prototype._get=function(Dt,Pt,Cr,ne,gr,It){var xt=null,Jt={avoidConstraints:Dt,contextInterceptor:function(Ct){return Ct},isMultiInject:Pt,key:gr,serviceIdentifier:ne,targetType:Cr,value:It};if(this._middleware){if(xt=this._middleware(Jt),xt==null)throw new Error(K.INVALID_MIDDLEWARE_RETURN)}else xt=this._planAndResolve()(Jt);return xt},qt.prototype._planAndResolve=function(){var Dt=this;return function(Pt){var Cr=Ae.plan(Dt._metadataReader,Dt,Pt.isMultiInject,Pt.targetType,Pt.serviceIdentifier,Pt.key,Pt.value,Pt.avoidConstraints);Cr=Pt.contextInterceptor(Cr);var ne=at.resolve(Cr);return ne}},qt}();ge.Container=hr},33244:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.AsyncContainerModule=ge.ContainerModule=void 0;var Oe=ie(37791),Z=function(){function Pe(K){this.id=Oe.id(),this.registry=K}return Pe}();ge.ContainerModule=Z;var _=function(){function Pe(K){this.id=Oe.id(),this.registry=K}return Pe}();ge.AsyncContainerModule=_},85700:function(Yr,ge){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.ContainerSnapshot=void 0;var ie=function(){function Oe(){}return Oe.of=function(Z,_){var Pe=new Oe;return Pe.bindings=Z,Pe.middleware=_,Pe},Oe}();ge.ContainerSnapshot=ie},80175:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.Lookup=void 0;var Oe=ie(16674),Z=function(){function _(){this._map=new Map}return _.prototype.getMap=function(){return this._map},_.prototype.add=function(Pe,K){if(Pe==null)throw new Error(Oe.NULL_ARGUMENT);if(K==null)throw new Error(Oe.NULL_ARGUMENT);var xe=this._map.get(Pe);xe!==void 0?(xe.push(K),this._map.set(Pe,xe)):this._map.set(Pe,[K])},_.prototype.get=function(Pe){if(Pe==null)throw new Error(Oe.NULL_ARGUMENT);var K=this._map.get(Pe);if(K!==void 0)return K;throw new Error(Oe.KEY_NOT_FOUND)},_.prototype.remove=function(Pe){if(Pe==null)throw new Error(Oe.NULL_ARGUMENT);if(!this._map.delete(Pe))throw new Error(Oe.KEY_NOT_FOUND)},_.prototype.removeByCondition=function(Pe){var K=this;this._map.forEach(function(xe,ve){var tt=xe.filter(function(Ae){return!Pe(Ae)});tt.length>0?K._map.set(ve,tt):K._map.delete(ve)})},_.prototype.hasKey=function(Pe){if(Pe==null)throw new Error(Oe.NULL_ARGUMENT);return this._map.has(Pe)},_.prototype.clone=function(){var Pe=new _;return this._map.forEach(function(K,xe){K.forEach(function(ve){return Pe.add(xe,ve.clone())})}),Pe},_.prototype.traverse=function(Pe){this._map.forEach(function(K,xe){Pe(xe,K)})},_}();ge.Lookup=Z},86700:function(Yr,ge,ie){"use strict";var Oe;Oe={value:!0},Oe=Oe=Oe=Oe=Oe=Oe=ge.GW=Oe=Oe=ge.zY=Oe=Oe=Oe=Oe=Oe=ge.f3=Oe=Oe=ge.b2=Oe=Oe=Oe=Oe=Oe=ge.W2=Oe=void 0;var Z=ie(6867);Oe=Z;var _=ie(51389);Object.defineProperty(ge,"W2",{enumerable:!0,get:function(){return _.Container}});var Pe=ie(28421);Oe={enumerable:!0,get:function(){return Pe.BindingScopeEnum}},Oe={enumerable:!0,get:function(){return Pe.BindingTypeEnum}},Oe={enumerable:!0,get:function(){return Pe.TargetTypeEnum}};var K=ie(33244);Oe={enumerable:!0,get:function(){return K.AsyncContainerModule}},Oe={enumerable:!0,get:function(){return K.ContainerModule}};var xe=ie(64315);Object.defineProperty(ge,"b2",{enumerable:!0,get:function(){return xe.injectable}});var ve=ie(32052);Oe={enumerable:!0,get:function(){return ve.tagged}};var tt=ie(38085);Oe={enumerable:!0,get:function(){return tt.named}};var Ae=ie(5744);Object.defineProperty(ge,"f3",{enumerable:!0,get:function(){return Ae.inject}}),Oe={enumerable:!0,get:function(){return Ae.LazyServiceIdentifer}};var at=ie(6515);Oe={enumerable:!0,get:function(){return at.optional}};var gt=ie(86757);Oe={enumerable:!0,get:function(){return gt.unmanaged}};var Mt=ie(71693);Oe={enumerable:!0,get:function(){return Mt.multiInject}};var Ft=ie(55638);Oe={enumerable:!0,get:function(){return Ft.targetName}};var mr=ie(7014);Object.defineProperty(ge,"zY",{enumerable:!0,get:function(){return mr.postConstruct}});var jt=ie(51377);Oe={enumerable:!0,get:function(){return jt.MetadataReader}};var hr=ie(37791);Oe={enumerable:!0,get:function(){return hr.id}};var qt=ie(99934);Object.defineProperty(ge,"GW",{enumerable:!0,get:function(){return qt.decorate}});var Dt=ie(80758);Oe={enumerable:!0,get:function(){return Dt.traverseAncerstors}},Oe={enumerable:!0,get:function(){return Dt.taggedConstraint}},Oe={enumerable:!0,get:function(){return Dt.namedConstraint}},Oe={enumerable:!0,get:function(){return Dt.typeConstraint}};var Pt=ie(55800);Oe={enumerable:!0,get:function(){return Pt.getServiceIdentifierAsString}};var Cr=ie(70600);Oe={enumerable:!0,get:function(){return Cr.multiBindToService}}},95228:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.Context=void 0;var Oe=ie(37791),Z=function(){function _(Pe){this.id=Oe.id(),this.container=Pe}return _.prototype.addPlan=function(Pe){this.plan=Pe},_.prototype.setCurrentRequest=function(Pe){this.currentRequest=Pe},_}();ge.Context=Z},47738:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.Metadata=void 0;var Oe=ie(6867),Z=function(){function _(Pe,K){this.key=Pe,this.value=K}return _.prototype.toString=function(){return this.key===Oe.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},_}();ge.Metadata=Z},51377:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.MetadataReader=void 0;var Oe=ie(6867),Z=function(){function _(){}return _.prototype.getConstructorMetadata=function(Pe){var K=Reflect.getMetadata(Oe.PARAM_TYPES,Pe),xe=Reflect.getMetadata(Oe.TAGGED,Pe);return{compilerGeneratedMetadata:K,userGeneratedMetadata:xe||{}}},_.prototype.getPropertiesMetadata=function(Pe){var K=Reflect.getMetadata(Oe.TAGGED_PROP,Pe)||[];return K},_}();ge.MetadataReader=Z},55314:function(Yr,ge){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.Plan=void 0;var ie=function(){function Oe(Z,_){this.parentContext=Z,this.rootRequest=_}return Oe}();ge.Plan=ie},86311:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.getBindingDictionary=ge.createMockRequest=ge.plan=void 0;var Oe=ie(23184),Z=ie(16674),_=ie(28421),Pe=ie(6867),K=ie(85265),xe=ie(55800),ve=ie(95228),tt=ie(47738),Ae=ie(55314),at=ie(6e3),gt=ie(6748),Mt=ie(18924);function Ft(ne){return ne._bindingDictionary}ge.getBindingDictionary=Ft;function mr(ne,gr,It,xt,Jt,Ct){var br=ne?Pe.MULTI_INJECT_TAG:Pe.INJECT_TAG,$r=new tt.Metadata(br,It),oe=new Mt.Target(gr,xt,It,$r);if(Jt!==void 0){var Ue=new tt.Metadata(Jt,Ct);oe.metadata.push(Ue)}return oe}function jt(ne,gr,It,xt,Jt){var Ct=Dt(It.container,Jt.serviceIdentifier),br=[];return Ct.length===Oe.BindingCount.NoBindingsAvailable&&It.container.options.autoBindInjectable&&typeof Jt.serviceIdentifier=="function"&&ne.getConstructorMetadata(Jt.serviceIdentifier).compilerGeneratedMetadata&&(It.container.bind(Jt.serviceIdentifier).toSelf(),Ct=Dt(It.container,Jt.serviceIdentifier)),gr?br=Ct:br=Ct.filter(function($r){var oe=new gt.Request($r.serviceIdentifier,It,xt,$r,Jt);return $r.constraint(oe)}),hr(Jt.serviceIdentifier,br,Jt,It.container),br}function hr(ne,gr,It,xt){switch(gr.length){case Oe.BindingCount.NoBindingsAvailable:if(It.isOptional())return gr;var Jt=xe.getServiceIdentifierAsString(ne),Ct=Z.NOT_REGISTERED;throw Ct+=xe.listMetadataForTarget(Jt,It),Ct+=xe.listRegisteredBindingsForServiceIdentifier(xt,Jt,Dt),new Error(Ct);case Oe.BindingCount.OnlyOneBindingAvailable:if(!It.isArray())return gr;case Oe.BindingCount.MultipleBindingsAvailable:default:if(It.isArray())return gr;var Jt=xe.getServiceIdentifierAsString(ne),Ct=Z.AMBIGUOUS_MATCH+" "+Jt;throw Ct+=xe.listRegisteredBindingsForServiceIdentifier(xt,Jt,Dt),new Error(Ct)}}function qt(ne,gr,It,xt,Jt,Ct){var br,$r;if(Jt===null){br=jt(ne,gr,xt,null,Ct),$r=new gt.Request(It,xt,null,br,Ct);var oe=new Ae.Plan(xt,$r);xt.addPlan(oe)}else br=jt(ne,gr,xt,Jt,Ct),$r=Jt.addChildRequest(Ct.serviceIdentifier,br,Ct);br.forEach(function(Ue){var H=null;if(Ct.isArray())H=$r.addChildRequest(Ue.serviceIdentifier,Ue,Ct);else{if(Ue.cache)return;H=$r}if(Ue.type===_.BindingTypeEnum.Instance&&Ue.implementationType!==null){var U=at.getDependencies(ne,Ue.implementationType);if(!xt.container.options.skipBaseClassChecks){var de=at.getBaseClassDependencyCount(ne,Ue.implementationType);if(U.length<de){var Xe=Z.ARGUMENTS_LENGTH_MISMATCH(at.getFunctionName(Ue.implementationType));throw new Error(Xe)}}U.forEach(function(lt){qt(ne,!1,lt.serviceIdentifier,xt,H,lt)})}})}function Dt(ne,gr){var It=[],xt=Ft(ne);return xt.hasKey(gr)?It=xt.get(gr):ne.parent!==null&&(It=Dt(ne.parent,gr)),It}function Pt(ne,gr,It,xt,Jt,Ct,br,$r){$r===void 0&&($r=!1);var oe=new ve.Context(gr),Ue=mr(It,xt,Jt,"",Ct,br);try{return qt(ne,$r,Jt,oe,null,Ue),oe}catch(H){throw K.isStackOverflowExeption(H)&&oe.plan&&xe.circularDependencyToException(oe.plan.rootRequest),H}}ge.plan=Pt;function Cr(ne,gr,It,xt){var Jt=new Mt.Target(_.TargetTypeEnum.Variable,"",gr,new tt.Metadata(It,xt)),Ct=new ve.Context(ne),br=new gt.Request(gr,Ct,null,[],Jt);return br}ge.createMockRequest=Cr},88460:function(Yr,ge){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.QueryableString=void 0;var ie=function(){function Oe(Z){this.str=Z}return Oe.prototype.startsWith=function(Z){return this.str.indexOf(Z)===0},Oe.prototype.endsWith=function(Z){var _="",Pe=Z.split("").reverse().join("");return _=this.str.split("").reverse().join(""),this.startsWith.call({str:_},Pe)},Oe.prototype.contains=function(Z){return this.str.indexOf(Z)!==-1},Oe.prototype.equals=function(Z){return this.str===Z},Oe.prototype.value=function(){return this.str},Oe}();ge.QueryableString=ie},6e3:function(Yr,ge,ie){"use strict";var Oe=this&&this.__spreadArray||function(jt,hr){for(var qt=0,Dt=hr.length,Pt=jt.length;qt<Dt;qt++,Pt++)jt[Pt]=hr[qt];return jt};Object.defineProperty(ge,"__esModule",{value:!0}),ge.getFunctionName=ge.getBaseClassDependencyCount=ge.getDependencies=void 0;var Z=ie(5744),_=ie(16674),Pe=ie(28421),K=ie(6867),xe=ie(55800);Object.defineProperty(ge,"getFunctionName",{enumerable:!0,get:function(){return xe.getFunctionName}});var ve=ie(18924);function tt(jt,hr){var qt=xe.getFunctionName(hr),Dt=Ae(jt,qt,hr,!1);return Dt}ge.getDependencies=tt;function Ae(jt,hr,qt,Dt){var Pt=jt.getConstructorMetadata(qt),Cr=Pt.compilerGeneratedMetadata;if(Cr===void 0){var ne=_.MISSING_INJECTABLE_ANNOTATION+" "+hr+".";throw new Error(ne)}var gr=Pt.userGeneratedMetadata,It=Object.keys(gr),xt=qt.length===0&&It.length>0,Jt=It.length>qt.length,Ct=xt||Jt?It.length:qt.length,br=gt(Dt,hr,Cr,gr,Ct),$r=Mt(jt,qt),oe=Oe(Oe([],br),$r);return oe}function at(jt,hr,qt,Dt,Pt){var Cr=Pt[jt.toString()]||[],ne=mr(Cr),gr=ne.unmanaged!==!0,It=Dt[jt],xt=ne.inject||ne.multiInject;if(It=xt||It,It instanceof Z.LazyServiceIdentifer&&(It=It.unwrap()),gr){var Jt=It===Object,Ct=It===Function,br=It===void 0,$r=Jt||Ct||br;if(!hr&&$r){var oe=_.MISSING_INJECT_ANNOTATION+" argument "+jt+" in class "+qt+".";throw new Error(oe)}var Ue=new ve.Target(Pe.TargetTypeEnum.ConstructorArgument,ne.targetName,It);return Ue.metadata=Cr,Ue}return null}function gt(jt,hr,qt,Dt,Pt){for(var Cr=[],ne=0;ne<Pt;ne++){var gr=ne,It=at(gr,jt,hr,qt,Dt);It!==null&&Cr.push(It)}return Cr}function Mt(jt,hr){for(var qt=jt.getPropertiesMetadata(hr),Dt=[],Pt=Object.keys(qt),Cr=0,ne=Pt;Cr<ne.length;Cr++){var gr=ne[Cr],It=qt[gr],xt=mr(qt[gr]),Jt=xt.targetName||gr,Ct=xt.inject||xt.multiInject,br=new ve.Target(Pe.TargetTypeEnum.ClassProperty,Jt,Ct);br.metadata=It,Dt.push(br)}var $r=Object.getPrototypeOf(hr.prototype).constructor;if($r!==Object){var oe=Mt(jt,$r);Dt=Oe(Oe([],Dt),oe)}return Dt}function Ft(jt,hr){var qt=Object.getPrototypeOf(hr.prototype).constructor;if(qt!==Object){var Dt=xe.getFunctionName(qt),Pt=Ae(jt,Dt,qt,!0),Cr=Pt.map(function(It){return It.metadata.filter(function(xt){return xt.key===K.UNMANAGED_TAG})}),ne=[].concat.apply([],Cr).length,gr=Pt.length-ne;return gr>0?gr:Ft(jt,qt)}else return 0}ge.getBaseClassDependencyCount=Ft;function mr(jt){var hr={};return jt.forEach(function(qt){hr[qt.key.toString()]=qt.value}),{inject:hr[K.INJECT_TAG],multiInject:hr[K.MULTI_INJECT_TAG],targetName:hr[K.NAME_TAG],unmanaged:hr[K.UNMANAGED_TAG]}}},6748:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.Request=void 0;var Oe=ie(37791),Z=function(){function _(Pe,K,xe,ve,tt){this.id=Oe.id(),this.serviceIdentifier=Pe,this.parentContext=K,this.parentRequest=xe,this.target=tt,this.childRequests=[],this.bindings=Array.isArray(ve)?ve:[ve],this.requestScope=xe===null?new Map:null}return _.prototype.addChildRequest=function(Pe,K,xe){var ve=new _(Pe,this.parentContext,this,K,xe);return this.childRequests.push(ve),ve},_}();ge.Request=Z},18924:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.Target=void 0;var Oe=ie(6867),Z=ie(37791),_=ie(47738),Pe=ie(88460),K=function(){function xe(ve,tt,Ae,at){this.id=Z.id(),this.type=ve,this.serviceIdentifier=Ae,this.name=new Pe.QueryableString(tt||""),this.metadata=new Array;var gt=null;typeof at=="string"?gt=new _.Metadata(Oe.NAMED_TAG,at):at instanceof _.Metadata&&(gt=at),gt!==null&&this.metadata.push(gt)}return xe.prototype.hasTag=function(ve){for(var tt=0,Ae=this.metadata;tt<Ae.length;tt++){var at=Ae[tt];if(at.key===ve)return!0}return!1},xe.prototype.isArray=function(){return this.hasTag(Oe.MULTI_INJECT_TAG)},xe.prototype.matchesArray=function(ve){return this.matchesTag(Oe.MULTI_INJECT_TAG)(ve)},xe.prototype.isNamed=function(){return this.hasTag(Oe.NAMED_TAG)},xe.prototype.isTagged=function(){return this.metadata.some(function(ve){return Oe.NON_CUSTOM_TAG_KEYS.every(function(tt){return ve.key!==tt})})},xe.prototype.isOptional=function(){return this.matchesTag(Oe.OPTIONAL_TAG)(!0)},xe.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ve){return ve.key===Oe.NAMED_TAG})[0]:null},xe.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ve){return Oe.NON_CUSTOM_TAG_KEYS.every(function(tt){return ve.key!==tt})}):null},xe.prototype.matchesNamedTag=function(ve){return this.matchesTag(Oe.NAMED_TAG)(ve)},xe.prototype.matchesTag=function(ve){var tt=this;return function(Ae){for(var at=0,gt=tt.metadata;at<gt.length;at++){var Mt=gt[at];if(Mt.key===ve&&Mt.value===Ae)return!0}return!1}},xe}();ge.Target=K},52279:function(Yr,ge,ie){"use strict";var Oe=this&&this.__spreadArray||function(Ae,at){for(var gt=0,Mt=at.length,Ft=Ae.length;gt<Mt;gt++,Ft++)Ae[Ft]=at[gt];return Ae};Object.defineProperty(ge,"__esModule",{value:!0}),ge.resolveInstance=void 0;var Z=ie(16674),_=ie(28421),Pe=ie(6867);function K(Ae,at,gt){var Mt=at.filter(function(mr){return mr.target!==null&&mr.target.type===_.TargetTypeEnum.ClassProperty}),Ft=Mt.map(gt);return Mt.forEach(function(mr,jt){var hr="";hr=mr.target.name.value();var qt=Ft[jt];Ae[hr]=qt}),Ae}function xe(Ae,at){return new(Ae.bind.apply(Ae,Oe([void 0],at)))}function ve(Ae,at){if(Reflect.hasMetadata(Pe.POST_CONSTRUCT,Ae)){var gt=Reflect.getMetadata(Pe.POST_CONSTRUCT,Ae);try{at[gt.value]()}catch(Mt){throw new Error(Z.POST_CONSTRUCT_ERROR(Ae.name,Mt.message))}}}function tt(Ae,at,gt){var Mt=null;if(at.length>0){var Ft=at.filter(function(jt){return jt.target!==null&&jt.target.type===_.TargetTypeEnum.ConstructorArgument}),mr=Ft.map(gt);Mt=xe(Ae,mr),Mt=K(Mt,at,gt)}else Mt=new Ae;return ve(Ae,Mt),Mt}ge.resolveInstance=tt},31927:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.resolve=void 0;var Oe=ie(16674),Z=ie(28421),_=ie(85265),Pe=ie(55800),K=ie(52279),xe=function(Ae,at,gt){try{return gt()}catch(Mt){throw _.isStackOverflowExeption(Mt)?new Error(Oe.CIRCULAR_DEPENDENCY_IN_FACTORY(Ae,at.toString())):Mt}},ve=function(Ae){return function(at){at.parentContext.setCurrentRequest(at);var gt=at.bindings,Mt=at.childRequests,Ft=at.target&&at.target.isArray(),mr=!at.parentRequest||!at.parentRequest.target||!at.target||!at.parentRequest.target.matchesArray(at.target.serviceIdentifier);if(Ft&&mr)return Mt.map(function(Cr){var ne=ve(Ae);return ne(Cr)});var jt=null;if(at.target.isOptional()&&gt.length===0)return;var hr=gt[0],qt=hr.scope===Z.BindingScopeEnum.Singleton,Dt=hr.scope===Z.BindingScopeEnum.Request;if(qt&&hr.activated)return hr.cache;if(Dt&&Ae!==null&&Ae.has(hr.id))return Ae.get(hr.id);if(hr.type===Z.BindingTypeEnum.ConstantValue)jt=hr.cache,hr.activated=!0;else if(hr.type===Z.BindingTypeEnum.Function)jt=hr.cache,hr.activated=!0;else if(hr.type===Z.BindingTypeEnum.Constructor)jt=hr.implementationType;else if(hr.type===Z.BindingTypeEnum.DynamicValue&&hr.dynamicValue!==null)jt=xe("toDynamicValue",hr.serviceIdentifier,function(){return hr.dynamicValue(at.parentContext)});else if(hr.type===Z.BindingTypeEnum.Factory&&hr.factory!==null)jt=xe("toFactory",hr.serviceIdentifier,function(){return hr.factory(at.parentContext)});else if(hr.type===Z.BindingTypeEnum.Provider&&hr.provider!==null)jt=xe("toProvider",hr.serviceIdentifier,function(){return hr.provider(at.parentContext)});else if(hr.type===Z.BindingTypeEnum.Instance&&hr.implementationType!==null)jt=K.resolveInstance(hr.implementationType,Mt,ve(Ae));else{var Pt=Pe.getServiceIdentifierAsString(at.serviceIdentifier);throw new Error(Oe.INVALID_BINDING_TYPE+" "+Pt)}return typeof hr.onActivation=="function"&&(jt=hr.onActivation(at.parentContext,jt)),qt&&(hr.cache=jt,hr.activated=!0),Dt&&Ae!==null&&!Ae.has(hr.id)&&Ae.set(hr.id,jt),jt}};function tt(Ae){var at=ve(Ae.plan.rootRequest.requestScope);return at(Ae.plan.rootRequest)}ge.resolve=tt},83366:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.BindingInSyntax=void 0;var Oe=ie(28421),Z=ie(71325),_=function(){function Pe(K){this._binding=K}return Pe.prototype.inRequestScope=function(){return this._binding.scope=Oe.BindingScopeEnum.Request,new Z.BindingWhenOnSyntax(this._binding)},Pe.prototype.inSingletonScope=function(){return this._binding.scope=Oe.BindingScopeEnum.Singleton,new Z.BindingWhenOnSyntax(this._binding)},Pe.prototype.inTransientScope=function(){return this._binding.scope=Oe.BindingScopeEnum.Transient,new Z.BindingWhenOnSyntax(this._binding)},Pe}();ge.BindingInSyntax=_},99812:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.BindingInWhenOnSyntax=void 0;var Oe=ie(83366),Z=ie(51811),_=ie(98370),Pe=function(){function K(xe){this._binding=xe,this._bindingWhenSyntax=new _.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Z.BindingOnSyntax(this._binding),this._bindingInSyntax=new Oe.BindingInSyntax(xe)}return K.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},K.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},K.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},K.prototype.when=function(xe){return this._bindingWhenSyntax.when(xe)},K.prototype.whenTargetNamed=function(xe){return this._bindingWhenSyntax.whenTargetNamed(xe)},K.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},K.prototype.whenTargetTagged=function(xe,ve){return this._bindingWhenSyntax.whenTargetTagged(xe,ve)},K.prototype.whenInjectedInto=function(xe){return this._bindingWhenSyntax.whenInjectedInto(xe)},K.prototype.whenParentNamed=function(xe){return this._bindingWhenSyntax.whenParentNamed(xe)},K.prototype.whenParentTagged=function(xe,ve){return this._bindingWhenSyntax.whenParentTagged(xe,ve)},K.prototype.whenAnyAncestorIs=function(xe){return this._bindingWhenSyntax.whenAnyAncestorIs(xe)},K.prototype.whenNoAncestorIs=function(xe){return this._bindingWhenSyntax.whenNoAncestorIs(xe)},K.prototype.whenAnyAncestorNamed=function(xe){return this._bindingWhenSyntax.whenAnyAncestorNamed(xe)},K.prototype.whenAnyAncestorTagged=function(xe,ve){return this._bindingWhenSyntax.whenAnyAncestorTagged(xe,ve)},K.prototype.whenNoAncestorNamed=function(xe){return this._bindingWhenSyntax.whenNoAncestorNamed(xe)},K.prototype.whenNoAncestorTagged=function(xe,ve){return this._bindingWhenSyntax.whenNoAncestorTagged(xe,ve)},K.prototype.whenAnyAncestorMatches=function(xe){return this._bindingWhenSyntax.whenAnyAncestorMatches(xe)},K.prototype.whenNoAncestorMatches=function(xe){return this._bindingWhenSyntax.whenNoAncestorMatches(xe)},K.prototype.onActivation=function(xe){return this._bindingOnSyntax.onActivation(xe)},K}();ge.BindingInWhenOnSyntax=Pe},51811:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.BindingOnSyntax=void 0;var Oe=ie(98370),Z=function(){function _(Pe){this._binding=Pe}return _.prototype.onActivation=function(Pe){return this._binding.onActivation=Pe,new Oe.BindingWhenSyntax(this._binding)},_}();ge.BindingOnSyntax=Z},51860:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.BindingToSyntax=void 0;var Oe=ie(16674),Z=ie(28421),_=ie(99812),Pe=ie(71325),K=function(){function xe(ve){this._binding=ve}return xe.prototype.to=function(ve){return this._binding.type=Z.BindingTypeEnum.Instance,this._binding.implementationType=ve,new _.BindingInWhenOnSyntax(this._binding)},xe.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Oe.INVALID_TO_SELF_VALUE);var ve=this._binding.serviceIdentifier;return this.to(ve)},xe.prototype.toConstantValue=function(ve){return this._binding.type=Z.BindingTypeEnum.ConstantValue,this._binding.cache=ve,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Z.BindingScopeEnum.Singleton,new Pe.BindingWhenOnSyntax(this._binding)},xe.prototype.toDynamicValue=function(ve){return this._binding.type=Z.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ve,this._binding.implementationType=null,new _.BindingInWhenOnSyntax(this._binding)},xe.prototype.toConstructor=function(ve){return this._binding.type=Z.BindingTypeEnum.Constructor,this._binding.implementationType=ve,this._binding.scope=Z.BindingScopeEnum.Singleton,new Pe.BindingWhenOnSyntax(this._binding)},xe.prototype.toFactory=function(ve){return this._binding.type=Z.BindingTypeEnum.Factory,this._binding.factory=ve,this._binding.scope=Z.BindingScopeEnum.Singleton,new Pe.BindingWhenOnSyntax(this._binding)},xe.prototype.toFunction=function(ve){if(typeof ve!="function")throw new Error(Oe.INVALID_FUNCTION_BINDING);var tt=this.toConstantValue(ve);return this._binding.type=Z.BindingTypeEnum.Function,this._binding.scope=Z.BindingScopeEnum.Singleton,tt},xe.prototype.toAutoFactory=function(ve){return this._binding.type=Z.BindingTypeEnum.Factory,this._binding.factory=function(tt){var Ae=function(){return tt.container.get(ve)};return Ae},this._binding.scope=Z.BindingScopeEnum.Singleton,new Pe.BindingWhenOnSyntax(this._binding)},xe.prototype.toProvider=function(ve){return this._binding.type=Z.BindingTypeEnum.Provider,this._binding.provider=ve,this._binding.scope=Z.BindingScopeEnum.Singleton,new Pe.BindingWhenOnSyntax(this._binding)},xe.prototype.toService=function(ve){this.toDynamicValue(function(tt){return tt.container.get(ve)})},xe}();ge.BindingToSyntax=K},71325:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.BindingWhenOnSyntax=void 0;var Oe=ie(51811),Z=ie(98370),_=function(){function Pe(K){this._binding=K,this._bindingWhenSyntax=new Z.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Oe.BindingOnSyntax(this._binding)}return Pe.prototype.when=function(K){return this._bindingWhenSyntax.when(K)},Pe.prototype.whenTargetNamed=function(K){return this._bindingWhenSyntax.whenTargetNamed(K)},Pe.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Pe.prototype.whenTargetTagged=function(K,xe){return this._bindingWhenSyntax.whenTargetTagged(K,xe)},Pe.prototype.whenInjectedInto=function(K){return this._bindingWhenSyntax.whenInjectedInto(K)},Pe.prototype.whenParentNamed=function(K){return this._bindingWhenSyntax.whenParentNamed(K)},Pe.prototype.whenParentTagged=function(K,xe){return this._bindingWhenSyntax.whenParentTagged(K,xe)},Pe.prototype.whenAnyAncestorIs=function(K){return this._bindingWhenSyntax.whenAnyAncestorIs(K)},Pe.prototype.whenNoAncestorIs=function(K){return this._bindingWhenSyntax.whenNoAncestorIs(K)},Pe.prototype.whenAnyAncestorNamed=function(K){return this._bindingWhenSyntax.whenAnyAncestorNamed(K)},Pe.prototype.whenAnyAncestorTagged=function(K,xe){return this._bindingWhenSyntax.whenAnyAncestorTagged(K,xe)},Pe.prototype.whenNoAncestorNamed=function(K){return this._bindingWhenSyntax.whenNoAncestorNamed(K)},Pe.prototype.whenNoAncestorTagged=function(K,xe){return this._bindingWhenSyntax.whenNoAncestorTagged(K,xe)},Pe.prototype.whenAnyAncestorMatches=function(K){return this._bindingWhenSyntax.whenAnyAncestorMatches(K)},Pe.prototype.whenNoAncestorMatches=function(K){return this._bindingWhenSyntax.whenNoAncestorMatches(K)},Pe.prototype.onActivation=function(K){return this._bindingOnSyntax.onActivation(K)},Pe}();ge.BindingWhenOnSyntax=_},98370:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.BindingWhenSyntax=void 0;var Oe=ie(51811),Z=ie(80758),_=function(){function Pe(K){this._binding=K}return Pe.prototype.when=function(K){return this._binding.constraint=K,new Oe.BindingOnSyntax(this._binding)},Pe.prototype.whenTargetNamed=function(K){return this._binding.constraint=Z.namedConstraint(K),new Oe.BindingOnSyntax(this._binding)},Pe.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(K){var xe=K.target!==null&&!K.target.isNamed()&&!K.target.isTagged();return xe},new Oe.BindingOnSyntax(this._binding)},Pe.prototype.whenTargetTagged=function(K,xe){return this._binding.constraint=Z.taggedConstraint(K)(xe),new Oe.BindingOnSyntax(this._binding)},Pe.prototype.whenInjectedInto=function(K){return this._binding.constraint=function(xe){return Z.typeConstraint(K)(xe.parentRequest)},new Oe.BindingOnSyntax(this._binding)},Pe.prototype.whenParentNamed=function(K){return this._binding.constraint=function(xe){return Z.namedConstraint(K)(xe.parentRequest)},new Oe.BindingOnSyntax(this._binding)},Pe.prototype.whenParentTagged=function(K,xe){return this._binding.constraint=function(ve){return Z.taggedConstraint(K)(xe)(ve.parentRequest)},new Oe.BindingOnSyntax(this._binding)},Pe.prototype.whenAnyAncestorIs=function(K){return this._binding.constraint=function(xe){return Z.traverseAncerstors(xe,Z.typeConstraint(K))},new Oe.BindingOnSyntax(this._binding)},Pe.prototype.whenNoAncestorIs=function(K){return this._binding.constraint=function(xe){return!Z.traverseAncerstors(xe,Z.typeConstraint(K))},new Oe.BindingOnSyntax(this._binding)},Pe.prototype.whenAnyAncestorNamed=function(K){return this._binding.constraint=function(xe){return Z.traverseAncerstors(xe,Z.namedConstraint(K))},new Oe.BindingOnSyntax(this._binding)},Pe.prototype.whenNoAncestorNamed=function(K){return this._binding.constraint=function(xe){return!Z.traverseAncerstors(xe,Z.namedConstraint(K))},new Oe.BindingOnSyntax(this._binding)},Pe.prototype.whenAnyAncestorTagged=function(K,xe){return this._binding.constraint=function(ve){return Z.traverseAncerstors(ve,Z.taggedConstraint(K)(xe))},new Oe.BindingOnSyntax(this._binding)},Pe.prototype.whenNoAncestorTagged=function(K,xe){return this._binding.constraint=function(ve){return!Z.traverseAncerstors(ve,Z.taggedConstraint(K)(xe))},new Oe.BindingOnSyntax(this._binding)},Pe.prototype.whenAnyAncestorMatches=function(K){return this._binding.constraint=function(xe){return Z.traverseAncerstors(xe,K)},new Oe.BindingOnSyntax(this._binding)},Pe.prototype.whenNoAncestorMatches=function(K){return this._binding.constraint=function(xe){return!Z.traverseAncerstors(xe,K)},new Oe.BindingOnSyntax(this._binding)},Pe}();ge.BindingWhenSyntax=_},80758:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.typeConstraint=ge.namedConstraint=ge.taggedConstraint=ge.traverseAncerstors=void 0;var Oe=ie(6867),Z=ie(47738),_=function(ve,tt){var Ae=ve.parentRequest;return Ae!==null?tt(Ae)?!0:_(Ae,tt):!1};ge.traverseAncerstors=_;var Pe=function(ve){return function(tt){var Ae=function(at){return at!==null&&at.target!==null&&at.target.matchesTag(ve)(tt)};return Ae.metaData=new Z.Metadata(ve,tt),Ae}};ge.taggedConstraint=Pe;var K=Pe(Oe.NAMED_TAG);ge.namedConstraint=K;var xe=function(ve){return function(tt){var Ae=null;if(tt!==null)if(Ae=tt.bindings[0],typeof ve=="string"){var at=Ae.serviceIdentifier;return at===ve}else{var gt=tt.bindings[0].implementationType;return ve===gt}return!1}};ge.typeConstraint=xe},70600:function(Yr,ge){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.multiBindToService=void 0;var ie=function(Oe){return function(Z){return function(){for(var _=[],Pe=0;Pe<arguments.length;Pe++)_[Pe]=arguments[Pe];return _.forEach(function(K){return Oe.bind(K).toService(Z)})}}};ge.multiBindToService=ie},85265:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.isStackOverflowExeption=void 0;var Oe=ie(16674);function Z(_){return _ instanceof RangeError||_.message===Oe.STACK_OVERFLOW}ge.isStackOverflowExeption=Z},37791:function(Yr,ge){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.id=void 0;var ie=0;function Oe(){return ie++}ge.id=Oe},55800:function(Yr,ge,ie){"use strict";Object.defineProperty(ge,"__esModule",{value:!0}),ge.circularDependencyToException=ge.listMetadataForTarget=ge.listRegisteredBindingsForServiceIdentifier=ge.getServiceIdentifierAsString=ge.getFunctionName=void 0;var Oe=ie(16674);function Z(Ae){if(typeof Ae=="function"){var at=Ae;return at.name}else{if(typeof Ae=="symbol")return Ae.toString();var at=Ae;return at}}ge.getServiceIdentifierAsString=Z;function _(Ae,at,gt){var Mt="",Ft=gt(Ae,at);return Ft.length!==0&&(Mt=`
Registered bindings:`,Ft.forEach(function(mr){var jt="Object";mr.implementationType!==null&&(jt=tt(mr.implementationType)),Mt=Mt+`
 `+jt,mr.constraint.metaData&&(Mt=Mt+" - "+mr.constraint.metaData)})),Mt}ge.listRegisteredBindingsForServiceIdentifier=_;function Pe(Ae,at){return Ae.parentRequest===null?!1:Ae.parentRequest.serviceIdentifier===at?!0:Pe(Ae.parentRequest,at)}function K(Ae){function at(Mt,Ft){Ft===void 0&&(Ft=[]);var mr=Z(Mt.serviceIdentifier);return Ft.push(mr),Mt.parentRequest!==null?at(Mt.parentRequest,Ft):Ft}var gt=at(Ae);return gt.reverse().join(" --> ")}function xe(Ae){Ae.childRequests.forEach(function(at){if(Pe(at,at.serviceIdentifier)){var gt=K(at);throw new Error(Oe.CIRCULAR_DEPENDENCY+" "+gt)}else xe(at)})}ge.circularDependencyToException=xe;function ve(Ae,at){if(at.isTagged()||at.isNamed()){var gt="",Mt=at.getNamedTag(),Ft=at.getCustomTags();return Mt!==null&&(gt+=Mt.toString()+`
`),Ft!==null&&Ft.forEach(function(mr){gt+=mr.toString()+`
`})," "+Ae+`
 `+Ae+" - "+gt}else return" "+Ae}ge.listMetadataForTarget=ve;function tt(Ae){if(Ae.name)return Ae.name;var at=Ae.toString(),gt=at.match(/^function\s*([^\s(]+)/);return gt?gt[1]:"Anonymous function: "+at}ge.getFunctionName=tt},31745:function(Yr){"use strict";Yr.exports=ie,Yr.exports.default=ie;var ge=1e20;function ie(K,xe,ve,tt,Ae,at){this.fontSize=K||24,this.buffer=xe===void 0?3:xe,this.cutoff=tt||.25,this.fontFamily=Ae||"sans-serif",this.fontWeight=at||"normal",this.radius=ve||8;var gt=this.size=this.fontSize+this.buffer*2,Mt=gt+this.buffer*2,Ft=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;Ft?this.canvas=my.createOffscreenCanvas(gt,gt,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=gt),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Mt*Mt),this.gridInner=new Float64Array(Mt*Mt),this.f=new Float64Array(Mt),this.z=new Float64Array(Mt+1),this.v=new Uint16Array(Mt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Ft?this.middle=Math.round(gt/2*1):this.middle=Math.round(gt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Oe(K,xe,ve,tt,Ae,at,gt){at.fill(ge,0,xe*ve),gt.fill(0,0,xe*ve);for(var Mt=(xe-tt)/2,Ft=0;Ft<Ae;Ft++)for(var mr=0;mr<tt;mr++){var jt=(Ft+Mt)*xe+mr+Mt,hr=K.data[4*(Ft*tt+mr)+3]/255;if(hr===1)at[jt]=0,gt[jt]=ge;else if(hr===0)at[jt]=ge,gt[jt]=0;else{var qt=Math.max(0,.5-hr),Dt=Math.max(0,hr-.5);at[jt]=qt*qt,gt[jt]=Dt*Dt}}}function Z(K,xe,ve,tt,Ae,at,gt){for(var Mt=0;Mt<xe*ve;Mt++){var Ft=Math.sqrt(tt[Mt])-Math.sqrt(Ae[Mt]);K[Mt]=Math.round(255-255*(Ft/at+gt))}}ie.prototype._draw=function(K,xe){var ve=this.ctx.measureText(K),tt=ve.width,Ae=2*this.buffer,at,gt,Mt,Ft,mr,jt,hr,qt;xe&&this.useMetrics?(mr=Math.floor(ve.actualBoundingBoxAscent),qt=this.buffer+Math.ceil(ve.actualBoundingBoxAscent),jt=this.buffer,hr=this.buffer,gt=Math.min(this.size,Math.ceil(ve.actualBoundingBoxRight-ve.actualBoundingBoxLeft)),Ft=Math.min(this.size-jt,Math.ceil(ve.actualBoundingBoxAscent+ve.actualBoundingBoxDescent)),at=gt+Ae,Mt=Ft+Ae,this.ctx.textBaseline="alphabetic"):(at=gt=this.size,Mt=Ft=this.size,mr=19*this.fontSize/24,jt=hr=0,qt=this.middle,this.ctx.textBaseline="middle");var Dt;gt&&Ft&&(this.ctx.clearRect(hr,jt,gt,Ft),this.ctx.fillText(K,this.buffer,qt),Dt=this.ctx.getImageData(hr,jt,gt,Ft));var Pt=new Uint8ClampedArray(at*Mt);return Oe(Dt,at,Mt,gt,Ft,this.gridOuter,this.gridInner),_(this.gridOuter,at,Mt,this.f,this.v,this.z),_(this.gridInner,at,Mt,this.f,this.v,this.z),Z(Pt,at,Mt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:Pt,metrics:{width:gt,height:Ft,sdfWidth:at,sdfHeight:Mt,top:mr,left:0,advance:tt}}},ie.prototype.draw=function(K){return this._draw(K,!1).data},ie.prototype.drawWithMetrics=function(K){return this._draw(K,!0)};function _(K,xe,ve,tt,Ae,at){for(var gt=0;gt<xe;gt++)Pe(K,gt,xe,ve,tt,Ae,at);for(var Mt=0;Mt<ve;Mt++)Pe(K,Mt*xe,1,xe,tt,Ae,at)}function Pe(K,xe,ve,tt,Ae,at,gt){var Mt,Ft,mr,jt;for(at[0]=0,gt[0]=-ge,gt[1]=ge,Mt=0;Mt<tt;Mt++)Ae[Mt]=K[xe+Mt*ve];for(Mt=1,Ft=0,mr=0;Mt<tt;Mt++){do jt=at[Ft],mr=(Ae[Mt]-Ae[jt]+Mt*Mt-jt*jt)/(Mt-jt)/2;while(mr<=gt[Ft]&&--Ft>-1);Ft++,at[Ft]=Mt,gt[Ft]=mr,gt[Ft+1]=ge}for(Mt=0,Ft=0;Mt<tt;Mt++){for(;gt[Ft+1]<Mt;)Ft++;jt=at[Ft],K[xe+Mt*ve]=Ae[jt]+(Mt-jt)*(Mt-jt)}}},18857:function(Yr,ge,ie){"use strict";ie.r(ge),ie.d(ge,{Function:function(){return Ke},Interpreter:function(){return xa},default:function(){return Rc},evaluate:function(){return Il},vm:function(){return Oe}});var Oe={};ie.r(Oe),ie.d(Oe,{Script:function(){return Jc},compileFunction:function(){return Wf},createContext:function(){return mo},runInContext:function(){return Ks},runInNewContext:function(){return Xf}});var Z={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},_="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Pe={5:_,"5module":_+" export import",6:_+" const class extends export import super"},K=/^in(stanceof)?$/,xe="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",ve="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",tt=new RegExp("["+xe+"]"),Ae=new RegExp("["+xe+ve+"]");xe=ve=null;var at=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],gt=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Mt(S,R){for(var W=65536,F=0;F<R.length;F+=2){if(W+=R[F],W>S)return!1;if(W+=R[F+1],W>=S)return!0}}function Ft(S,R){return S<65?S===36:S<91?!0:S<97?S===95:S<123?!0:S<=65535?S>=170&&tt.test(String.fromCharCode(S)):R===!1?!1:Mt(S,at)}function mr(S,R){return S<48?S===36:S<58?!0:S<65?!1:S<91?!0:S<97?S===95:S<123?!0:S<=65535?S>=170&&Ae.test(String.fromCharCode(S)):R===!1?!1:Mt(S,at)||Mt(S,gt)}var jt=function(R,W){W===void 0&&(W={}),this.label=R,this.keyword=W.keyword,this.beforeExpr=!!W.beforeExpr,this.startsExpr=!!W.startsExpr,this.isLoop=!!W.isLoop,this.isAssign=!!W.isAssign,this.prefix=!!W.prefix,this.postfix=!!W.postfix,this.binop=W.binop||null,this.updateContext=null};function hr(S,R){return new jt(S,{beforeExpr:!0,binop:R})}var qt={beforeExpr:!0},Dt={startsExpr:!0},Pt={};function Cr(S,R){return R===void 0&&(R={}),R.keyword=S,Pt[S]=new jt(S,R)}var ne={num:new jt("num",Dt),regexp:new jt("regexp",Dt),string:new jt("string",Dt),name:new jt("name",Dt),eof:new jt("eof"),bracketL:new jt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new jt("]"),braceL:new jt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new jt("}"),parenL:new jt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new jt(")"),comma:new jt(",",qt),semi:new jt(";",qt),colon:new jt(":",qt),dot:new jt("."),question:new jt("?",qt),questionDot:new jt("?."),arrow:new jt("=>",qt),template:new jt("template"),invalidTemplate:new jt("invalidTemplate"),ellipsis:new jt("...",qt),backQuote:new jt("`",Dt),dollarBraceL:new jt("${",{beforeExpr:!0,startsExpr:!0}),eq:new jt("=",{beforeExpr:!0,isAssign:!0}),assign:new jt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new jt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new jt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:hr("||",1),logicalAND:hr("&&",2),bitwiseOR:hr("|",3),bitwiseXOR:hr("^",4),bitwiseAND:hr("&",5),equality:hr("==/!=/===/!==",6),relational:hr("</>/<=/>=",7),bitShift:hr("<</>>/>>>",8),plusMin:new jt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:hr("%",10),star:hr("*",10),slash:hr("/",10),starstar:new jt("**",{beforeExpr:!0}),coalesce:hr("??",1),_break:Cr("break"),_case:Cr("case",qt),_catch:Cr("catch"),_continue:Cr("continue"),_debugger:Cr("debugger"),_default:Cr("default",qt),_do:Cr("do",{isLoop:!0,beforeExpr:!0}),_else:Cr("else",qt),_finally:Cr("finally"),_for:Cr("for",{isLoop:!0}),_function:Cr("function",Dt),_if:Cr("if"),_return:Cr("return",qt),_switch:Cr("switch"),_throw:Cr("throw",qt),_try:Cr("try"),_var:Cr("var"),_const:Cr("const"),_while:Cr("while",{isLoop:!0}),_with:Cr("with"),_new:Cr("new",{beforeExpr:!0,startsExpr:!0}),_this:Cr("this",Dt),_super:Cr("super",Dt),_class:Cr("class",Dt),_extends:Cr("extends",qt),_export:Cr("export"),_import:Cr("import",Dt),_null:Cr("null",Dt),_true:Cr("true",Dt),_false:Cr("false",Dt),_in:Cr("in",{beforeExpr:!0,binop:7}),_instanceof:Cr("instanceof",{beforeExpr:!0,binop:7}),_typeof:Cr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Cr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Cr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},gr=/\r\n?|\n|\u2028|\u2029/,It=new RegExp(gr.source,"g");function xt(S,R){return S===10||S===13||!R&&(S===8232||S===8233)}var Jt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Ct=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,br=Object.prototype,$r=br.hasOwnProperty,oe=br.toString;function Ue(S,R){return $r.call(S,R)}var H=Array.isArray||function(S){return oe.call(S)==="[object Array]"};function U(S){return new RegExp("^(?:"+S.replace(/ /g,"|")+")$")}var de=function(R,W){this.line=R,this.column=W};de.prototype.offset=function(R){return new de(this.line,this.column+R)};var Xe=function(R,W,F){this.start=W,this.end=F,R.sourceFile!==null&&(this.source=R.sourceFile)};function lt(S,R){for(var W=1,F=0;;){It.lastIndex=F;var ue=It.exec(S);if(ue&&ue.index<R)++W,F=ue.index+ue[0].length;else return new de(W,R-F)}}var yt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Vt(S){var R={};for(var W in yt)R[W]=S&&Ue(S,W)?S[W]:yt[W];if(R.ecmaVersion>=2015&&(R.ecmaVersion-=2009),R.allowReserved==null&&(R.allowReserved=R.ecmaVersion<5),H(R.onToken)){var F=R.onToken;R.onToken=function(ue){return F.push(ue)}}return H(R.onComment)&&(R.onComment=pr(R,R.onComment)),R}function pr(S,R){return function(W,F,ue,De,ft,Gt){var Wt={type:W?"Block":"Line",value:F,start:ue,end:De};S.locations&&(Wt.loc=new Xe(this,ft,Gt)),S.ranges&&(Wt.range=[ue,De]),R.push(Wt)}}var tn=1,Kr=2,si=tn|Kr,xn=4,ii=8,Ra=16,Di=32,Pi=64,ua=128;function sa(S,R){return Kr|(S?xn:0)|(R?ii:0)}var Bi=0,Yn=1,bi=2,Ms=3,Ha=4,eo=5,Rt=function(R,W,F){this.options=R=Vt(R),this.sourceFile=R.sourceFile,this.keywords=U(Pe[R.ecmaVersion>=6?6:R.sourceType==="module"?"5module":5]);var ue="";if(R.allowReserved!==!0){for(var De=R.ecmaVersion;!(ue=Z[De]);De--);R.sourceType==="module"&&(ue+=" await")}this.reservedWords=U(ue);var ft=(ue?ue+" ":"")+Z.strict;this.reservedWordsStrict=U(ft),this.reservedWordsStrictBind=U(ft+" "+Z.strictBind),this.input=String(W),this.containsEsc=!1,F?(this.pos=F,this.lineStart=this.input.lastIndexOf(`
`,F-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(gr).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=ne.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=R.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&R.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(tn),this.regexpState=null},be={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Rt.prototype.parse=function(){var R=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(R)},be.inFunction.get=function(){return(this.currentVarScope().flags&Kr)>0},be.inGenerator.get=function(){return(this.currentVarScope().flags&ii)>0},be.inAsync.get=function(){return(this.currentVarScope().flags&xn)>0},be.allowSuper.get=function(){return(this.currentThisScope().flags&Pi)>0},be.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ua)>0},be.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Rt.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&Kr)>0},Rt.extend=function(){for(var R=[],W=arguments.length;W--;)R[W]=arguments[W];for(var F=this,ue=0;ue<R.length;ue++)F=R[ue](F);return F},Rt.parse=function(R,W){return new this(W,R).parse()},Rt.parseExpressionAt=function(R,W,F){var ue=new this(F,R,W);return ue.nextToken(),ue.parseExpression()},Rt.tokenizer=function(R,W){return new this(W,R)},Object.defineProperties(Rt.prototype,be);var ce=Rt.prototype,Me=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;ce.strictDirective=function(S){for(;;){Ct.lastIndex=S,S+=Ct.exec(this.input)[0].length;var R=Me.exec(this.input.slice(S));if(!R)return!1;if((R[1]||R[2])==="use strict"){Ct.lastIndex=S+R[0].length;var W=Ct.exec(this.input),F=W.index+W[0].length,ue=this.input.charAt(F);return ue===";"||ue==="}"||gr.test(W[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(ue)||ue==="!"&&this.input.charAt(F+1)==="=")}S+=R[0].length,Ct.lastIndex=S,S+=Ct.exec(this.input)[0].length,this.input[S]===";"&&S++}},ce.eat=function(S){return this.type===S?(this.next(),!0):!1},ce.isContextual=function(S){return this.type===ne.name&&this.value===S&&!this.containsEsc},ce.eatContextual=function(S){return this.isContextual(S)?(this.next(),!0):!1},ce.expectContextual=function(S){this.eatContextual(S)||this.unexpected()},ce.canInsertSemicolon=function(){return this.type===ne.eof||this.type===ne.braceR||gr.test(this.input.slice(this.lastTokEnd,this.start))},ce.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},ce.semicolon=function(){!this.eat(ne.semi)&&!this.insertSemicolon()&&this.unexpected()},ce.afterTrailingComma=function(S,R){if(this.type===S)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),R||this.next(),!0},ce.expect=function(S){this.eat(S)||this.unexpected()},ce.unexpected=function(S){this.raise(S!=null?S:this.start,"Unexpected token")};function j(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}ce.checkPatternErrors=function(S,R){if(!!S){S.trailingComma>-1&&this.raiseRecoverable(S.trailingComma,"Comma is not permitted after the rest element");var W=R?S.parenthesizedAssign:S.parenthesizedBind;W>-1&&this.raiseRecoverable(W,"Parenthesized pattern")}},ce.checkExpressionErrors=function(S,R){if(!S)return!1;var W=S.shorthandAssign,F=S.doubleProto;if(!R)return W>=0||F>=0;W>=0&&this.raise(W,"Shorthand property assignments are valid only in destructuring patterns"),F>=0&&this.raiseRecoverable(F,"Redefinition of __proto__ property")},ce.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},ce.isSimpleAssignTarget=function(S){return S.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(S.expression):S.type==="Identifier"||S.type==="MemberExpression"};var ut=Rt.prototype;ut.parseTopLevel=function(S){var R={};for(S.body||(S.body=[]);this.type!==ne.eof;){var W=this.parseStatement(null,!0,R);S.body.push(W)}if(this.inModule)for(var F=0,ue=Object.keys(this.undefinedExports);F<ue.length;F+=1){var De=ue[F];this.raiseRecoverable(this.undefinedExports[De].start,"Export '"+De+"' is not defined")}return this.adaptDirectivePrologue(S.body),this.next(),S.sourceType=this.options.sourceType,this.finishNode(S,"Program")};var ir={kind:"loop"},Jr={kind:"switch"};ut.isLet=function(S){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Ct.lastIndex=this.pos;var R=Ct.exec(this.input),W=this.pos+R[0].length,F=this.input.charCodeAt(W);if(F===91)return!0;if(S)return!1;if(F===123)return!0;if(Ft(F,!0)){for(var ue=W+1;mr(this.input.charCodeAt(ue),!0);)++ue;var De=this.input.slice(W,ue);if(!K.test(De))return!0}return!1},ut.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Ct.lastIndex=this.pos;var S=Ct.exec(this.input),R=this.pos+S[0].length;return!gr.test(this.input.slice(this.pos,R))&&this.input.slice(R,R+8)==="function"&&(R+8===this.input.length||!mr(this.input.charAt(R+8)))},ut.parseStatement=function(S,R,W){var F=this.type,ue=this.startNode(),De;switch(this.isLet(S)&&(F=ne._var,De="let"),F){case ne._break:case ne._continue:return this.parseBreakContinueStatement(ue,F.keyword);case ne._debugger:return this.parseDebuggerStatement(ue);case ne._do:return this.parseDoStatement(ue);case ne._for:return this.parseForStatement(ue);case ne._function:return S&&(this.strict||S!=="if"&&S!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(ue,!1,!S);case ne._class:return S&&this.unexpected(),this.parseClass(ue,!0);case ne._if:return this.parseIfStatement(ue);case ne._return:return this.parseReturnStatement(ue);case ne._switch:return this.parseSwitchStatement(ue);case ne._throw:return this.parseThrowStatement(ue);case ne._try:return this.parseTryStatement(ue);case ne._const:case ne._var:return De=De||this.value,S&&De!=="var"&&this.unexpected(),this.parseVarStatement(ue,De);case ne._while:return this.parseWhileStatement(ue);case ne._with:return this.parseWithStatement(ue);case ne.braceL:return this.parseBlock(!0,ue);case ne.semi:return this.parseEmptyStatement(ue);case ne._export:case ne._import:if(this.options.ecmaVersion>10&&F===ne._import){Ct.lastIndex=this.pos;var ft=Ct.exec(this.input),Gt=this.pos+ft[0].length,Wt=this.input.charCodeAt(Gt);if(Wt===40||Wt===46)return this.parseExpressionStatement(ue,this.parseExpression())}return this.options.allowImportExportEverywhere||(R||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),F===ne._import?this.parseImport(ue):this.parseExport(ue,W);default:if(this.isAsyncFunction())return S&&this.unexpected(),this.next(),this.parseFunctionStatement(ue,!0,!S);var Or=this.value,en=this.parseExpression();return F===ne.name&&en.type==="Identifier"&&this.eat(ne.colon)?this.parseLabeledStatement(ue,Or,en,S):this.parseExpressionStatement(ue,en)}},ut.parseBreakContinueStatement=function(S,R){var W=R==="break";this.next(),this.eat(ne.semi)||this.insertSemicolon()?S.label=null:this.type!==ne.name?this.unexpected():(S.label=this.parseIdent(),this.semicolon());for(var F=0;F<this.labels.length;++F){var ue=this.labels[F];if((S.label==null||ue.name===S.label.name)&&(ue.kind!=null&&(W||ue.kind==="loop")||S.label&&W))break}return F===this.labels.length&&this.raise(S.start,"Unsyntactic "+R),this.finishNode(S,W?"BreakStatement":"ContinueStatement")},ut.parseDebuggerStatement=function(S){return this.next(),this.semicolon(),this.finishNode(S,"DebuggerStatement")},ut.parseDoStatement=function(S){return this.next(),this.labels.push(ir),S.body=this.parseStatement("do"),this.labels.pop(),this.expect(ne._while),S.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(ne.semi):this.semicolon(),this.finishNode(S,"DoWhileStatement")},ut.parseForStatement=function(S){this.next();var R=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(ir),this.enterScope(0),this.expect(ne.parenL),this.type===ne.semi)return R>-1&&this.unexpected(R),this.parseFor(S,null);var W=this.isLet();if(this.type===ne._var||this.type===ne._const||W){var F=this.startNode(),ue=W?"let":this.value;return this.next(),this.parseVar(F,!0,ue),this.finishNode(F,"VariableDeclaration"),(this.type===ne._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&F.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===ne._in?R>-1&&this.unexpected(R):S.await=R>-1),this.parseForIn(S,F)):(R>-1&&this.unexpected(R),this.parseFor(S,F))}var De=new j,ft=this.parseExpression(!0,De);return this.type===ne._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===ne._in?R>-1&&this.unexpected(R):S.await=R>-1),this.toAssignable(ft,!1,De),this.checkLVal(ft),this.parseForIn(S,ft)):(this.checkExpressionErrors(De,!0),R>-1&&this.unexpected(R),this.parseFor(S,ft))},ut.parseFunctionStatement=function(S,R,W){return this.next(),this.parseFunction(S,Bt|(W?0:Ar),!1,R)},ut.parseIfStatement=function(S){return this.next(),S.test=this.parseParenExpression(),S.consequent=this.parseStatement("if"),S.alternate=this.eat(ne._else)?this.parseStatement("if"):null,this.finishNode(S,"IfStatement")},ut.parseReturnStatement=function(S){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(ne.semi)||this.insertSemicolon()?S.argument=null:(S.argument=this.parseExpression(),this.semicolon()),this.finishNode(S,"ReturnStatement")},ut.parseSwitchStatement=function(S){this.next(),S.discriminant=this.parseParenExpression(),S.cases=[],this.expect(ne.braceL),this.labels.push(Jr),this.enterScope(0);for(var R,W=!1;this.type!==ne.braceR;)if(this.type===ne._case||this.type===ne._default){var F=this.type===ne._case;R&&this.finishNode(R,"SwitchCase"),S.cases.push(R=this.startNode()),R.consequent=[],this.next(),F?R.test=this.parseExpression():(W&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),W=!0,R.test=null),this.expect(ne.colon)}else R||this.unexpected(),R.consequent.push(this.parseStatement(null));return this.exitScope(),R&&this.finishNode(R,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(S,"SwitchStatement")},ut.parseThrowStatement=function(S){return this.next(),gr.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),S.argument=this.parseExpression(),this.semicolon(),this.finishNode(S,"ThrowStatement")};var nt=[];ut.parseTryStatement=function(S){if(this.next(),S.block=this.parseBlock(),S.handler=null,this.type===ne._catch){var R=this.startNode();if(this.next(),this.eat(ne.parenL)){R.param=this.parseBindingAtom();var W=R.param.type==="Identifier";this.enterScope(W?Di:0),this.checkLVal(R.param,W?Ha:bi),this.expect(ne.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),R.param=null,this.enterScope(0);R.body=this.parseBlock(!1),this.exitScope(),S.handler=this.finishNode(R,"CatchClause")}return S.finalizer=this.eat(ne._finally)?this.parseBlock():null,!S.handler&&!S.finalizer&&this.raise(S.start,"Missing catch or finally clause"),this.finishNode(S,"TryStatement")},ut.parseVarStatement=function(S,R){return this.next(),this.parseVar(S,!1,R),this.semicolon(),this.finishNode(S,"VariableDeclaration")},ut.parseWhileStatement=function(S){return this.next(),S.test=this.parseParenExpression(),this.labels.push(ir),S.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(S,"WhileStatement")},ut.parseWithStatement=function(S){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),S.object=this.parseParenExpression(),S.body=this.parseStatement("with"),this.finishNode(S,"WithStatement")},ut.parseEmptyStatement=function(S){return this.next(),this.finishNode(S,"EmptyStatement")},ut.parseLabeledStatement=function(S,R,W,F){for(var ue=0,De=this.labels;ue<De.length;ue+=1){var ft=De[ue];ft.name===R&&this.raise(W.start,"Label '"+R+"' is already declared")}for(var Gt=this.type.isLoop?"loop":this.type===ne._switch?"switch":null,Wt=this.labels.length-1;Wt>=0;Wt--){var Or=this.labels[Wt];if(Or.statementStart===S.start)Or.statementStart=this.start,Or.kind=Gt;else break}return this.labels.push({name:R,kind:Gt,statementStart:this.start}),S.body=this.parseStatement(F?F.indexOf("label")===-1?F+"label":F:"label"),this.labels.pop(),S.label=W,this.finishNode(S,"LabeledStatement")},ut.parseExpressionStatement=function(S,R){return S.expression=R,this.semicolon(),this.finishNode(S,"ExpressionStatement")},ut.parseBlock=function(S,R,W){for(S===void 0&&(S=!0),R===void 0&&(R=this.startNode()),R.body=[],this.expect(ne.braceL),S&&this.enterScope(0);this.type!==ne.braceR;){var F=this.parseStatement(null);R.body.push(F)}return W&&(this.strict=!1),this.next(),S&&this.exitScope(),this.finishNode(R,"BlockStatement")},ut.parseFor=function(S,R){return S.init=R,this.expect(ne.semi),S.test=this.type===ne.semi?null:this.parseExpression(),this.expect(ne.semi),S.update=this.type===ne.parenR?null:this.parseExpression(),this.expect(ne.parenR),S.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(S,"ForStatement")},ut.parseForIn=function(S,R){var W=this.type===ne._in;return this.next(),R.type==="VariableDeclaration"&&R.declarations[0].init!=null&&(!W||this.options.ecmaVersion<8||this.strict||R.kind!=="var"||R.declarations[0].id.type!=="Identifier")?this.raise(R.start,(W?"for-in":"for-of")+" loop variable declaration may not have an initializer"):R.type==="AssignmentPattern"&&this.raise(R.start,"Invalid left-hand side in for-loop"),S.left=R,S.right=W?this.parseExpression():this.parseMaybeAssign(),this.expect(ne.parenR),S.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(S,W?"ForInStatement":"ForOfStatement")},ut.parseVar=function(S,R,W){for(S.declarations=[],S.kind=W;;){var F=this.startNode();if(this.parseVarId(F,W),this.eat(ne.eq)?F.init=this.parseMaybeAssign(R):W==="const"&&!(this.type===ne._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():F.id.type!=="Identifier"&&!(R&&(this.type===ne._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):F.init=null,S.declarations.push(this.finishNode(F,"VariableDeclarator")),!this.eat(ne.comma))break}return S},ut.parseVarId=function(S,R){S.id=this.parseBindingAtom(),this.checkLVal(S.id,R==="var"?Yn:bi,!1)};var Bt=1,Ar=2,zr=4;ut.parseFunction=function(S,R,W,F){this.initFunction(S),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!F)&&(this.type===ne.star&&R&Ar&&this.unexpected(),S.generator=this.eat(ne.star)),this.options.ecmaVersion>=8&&(S.async=!!F),R&Bt&&(S.id=R&zr&&this.type!==ne.name?null:this.parseIdent(),S.id&&!(R&Ar)&&this.checkLVal(S.id,this.strict||S.generator||S.async?this.treatFunctionsAsVar?Yn:bi:Ms));var ue=this.yieldPos,De=this.awaitPos,ft=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(sa(S.async,S.generator)),R&Bt||(S.id=this.type===ne.name?this.parseIdent():null),this.parseFunctionParams(S),this.parseFunctionBody(S,W,!1),this.yieldPos=ue,this.awaitPos=De,this.awaitIdentPos=ft,this.finishNode(S,R&Bt?"FunctionDeclaration":"FunctionExpression")},ut.parseFunctionParams=function(S){this.expect(ne.parenL),S.params=this.parseBindingList(ne.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},ut.parseClass=function(S,R){this.next();var W=this.strict;this.strict=!0,this.parseClassId(S,R),this.parseClassSuper(S);var F=this.startNode(),ue=!1;for(F.body=[],this.expect(ne.braceL);this.type!==ne.braceR;){var De=this.parseClassElement(S.superClass!==null);De&&(F.body.push(De),De.type==="MethodDefinition"&&De.kind==="constructor"&&(ue&&this.raise(De.start,"Duplicate constructor in the same class"),ue=!0))}return this.strict=W,this.next(),S.body=this.finishNode(F,"ClassBody"),this.finishNode(S,R?"ClassDeclaration":"ClassExpression")},ut.parseClassElement=function(S){var R=this;if(this.eat(ne.semi))return null;var W=this.startNode(),F=function(Wt,Or){Or===void 0&&(Or=!1);var en=R.start,ci=R.startLoc;return R.eatContextual(Wt)?R.type!==ne.parenL&&(!Or||!R.canInsertSemicolon())?!0:(W.key&&R.unexpected(),W.computed=!1,W.key=R.startNodeAt(en,ci),W.key.name=Wt,R.finishNode(W.key,"Identifier"),!1):!1};W.kind="method",W.static=F("static");var ue=this.eat(ne.star),De=!1;ue||(this.options.ecmaVersion>=8&&F("async",!0)?(De=!0,ue=this.options.ecmaVersion>=9&&this.eat(ne.star)):F("get")?W.kind="get":F("set")&&(W.kind="set")),W.key||this.parsePropertyName(W);var ft=W.key,Gt=!1;return!W.computed&&!W.static&&(ft.type==="Identifier"&&ft.name==="constructor"||ft.type==="Literal"&&ft.value==="constructor")?(W.kind!=="method"&&this.raise(ft.start,"Constructor can't have get/set modifier"),ue&&this.raise(ft.start,"Constructor can't be a generator"),De&&this.raise(ft.start,"Constructor can't be an async method"),W.kind="constructor",Gt=S):W.static&&ft.type==="Identifier"&&ft.name==="prototype"&&this.raise(ft.start,"Classes may not have a static property named prototype"),this.parseClassMethod(W,ue,De,Gt),W.kind==="get"&&W.value.params.length!==0&&this.raiseRecoverable(W.value.start,"getter should have no params"),W.kind==="set"&&W.value.params.length!==1&&this.raiseRecoverable(W.value.start,"setter should have exactly one param"),W.kind==="set"&&W.value.params[0].type==="RestElement"&&this.raiseRecoverable(W.value.params[0].start,"Setter cannot use rest params"),W},ut.parseClassMethod=function(S,R,W,F){return S.value=this.parseMethod(R,W,F),this.finishNode(S,"MethodDefinition")},ut.parseClassId=function(S,R){this.type===ne.name?(S.id=this.parseIdent(),R&&this.checkLVal(S.id,bi,!1)):(R===!0&&this.unexpected(),S.id=null)},ut.parseClassSuper=function(S){S.superClass=this.eat(ne._extends)?this.parseExprSubscripts():null},ut.parseExport=function(S,R){if(this.next(),this.eat(ne.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(S.exported=this.parseIdent(!0),this.checkExport(R,S.exported.name,this.lastTokStart)):S.exported=null),this.expectContextual("from"),this.type!==ne.string&&this.unexpected(),S.source=this.parseExprAtom(),this.semicolon(),this.finishNode(S,"ExportAllDeclaration");if(this.eat(ne._default)){this.checkExport(R,"default",this.lastTokStart);var W;if(this.type===ne._function||(W=this.isAsyncFunction())){var F=this.startNode();this.next(),W&&this.next(),S.declaration=this.parseFunction(F,Bt|zr,!1,W)}else if(this.type===ne._class){var ue=this.startNode();S.declaration=this.parseClass(ue,"nullableID")}else S.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(S,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())S.declaration=this.parseStatement(null),S.declaration.type==="VariableDeclaration"?this.checkVariableExport(R,S.declaration.declarations):this.checkExport(R,S.declaration.id.name,S.declaration.id.start),S.specifiers=[],S.source=null;else{if(S.declaration=null,S.specifiers=this.parseExportSpecifiers(R),this.eatContextual("from"))this.type!==ne.string&&this.unexpected(),S.source=this.parseExprAtom();else{for(var De=0,ft=S.specifiers;De<ft.length;De+=1){var Gt=ft[De];this.checkUnreserved(Gt.local),this.checkLocalExport(Gt.local)}S.source=null}this.semicolon()}return this.finishNode(S,"ExportNamedDeclaration")},ut.checkExport=function(S,R,W){!S||(Ue(S,R)&&this.raiseRecoverable(W,"Duplicate export '"+R+"'"),S[R]=!0)},ut.checkPatternExport=function(S,R){var W=R.type;if(W==="Identifier")this.checkExport(S,R.name,R.start);else if(W==="ObjectPattern")for(var F=0,ue=R.properties;F<ue.length;F+=1){var De=ue[F];this.checkPatternExport(S,De)}else if(W==="ArrayPattern")for(var ft=0,Gt=R.elements;ft<Gt.length;ft+=1){var Wt=Gt[ft];Wt&&this.checkPatternExport(S,Wt)}else W==="Property"?this.checkPatternExport(S,R.value):W==="AssignmentPattern"?this.checkPatternExport(S,R.left):W==="RestElement"?this.checkPatternExport(S,R.argument):W==="ParenthesizedExpression"&&this.checkPatternExport(S,R.expression)},ut.checkVariableExport=function(S,R){if(!!S)for(var W=0,F=R;W<F.length;W+=1){var ue=F[W];this.checkPatternExport(S,ue.id)}},ut.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},ut.parseExportSpecifiers=function(S){var R=[],W=!0;for(this.expect(ne.braceL);!this.eat(ne.braceR);){if(W)W=!1;else if(this.expect(ne.comma),this.afterTrailingComma(ne.braceR))break;var F=this.startNode();F.local=this.parseIdent(!0),F.exported=this.eatContextual("as")?this.parseIdent(!0):F.local,this.checkExport(S,F.exported.name,F.exported.start),R.push(this.finishNode(F,"ExportSpecifier"))}return R},ut.parseImport=function(S){return this.next(),this.type===ne.string?(S.specifiers=nt,S.source=this.parseExprAtom()):(S.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),S.source=this.type===ne.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(S,"ImportDeclaration")},ut.parseImportSpecifiers=function(){var S=[],R=!0;if(this.type===ne.name){var W=this.startNode();if(W.local=this.parseIdent(),this.checkLVal(W.local,bi),S.push(this.finishNode(W,"ImportDefaultSpecifier")),!this.eat(ne.comma))return S}if(this.type===ne.star){var F=this.startNode();return this.next(),this.expectContextual("as"),F.local=this.parseIdent(),this.checkLVal(F.local,bi),S.push(this.finishNode(F,"ImportNamespaceSpecifier")),S}for(this.expect(ne.braceL);!this.eat(ne.braceR);){if(R)R=!1;else if(this.expect(ne.comma),this.afterTrailingComma(ne.braceR))break;var ue=this.startNode();ue.imported=this.parseIdent(!0),this.eatContextual("as")?ue.local=this.parseIdent():(this.checkUnreserved(ue.imported),ue.local=ue.imported),this.checkLVal(ue.local,bi),S.push(this.finishNode(ue,"ImportSpecifier"))}return S},ut.adaptDirectivePrologue=function(S){for(var R=0;R<S.length&&this.isDirectiveCandidate(S[R]);++R)S[R].directive=S[R].expression.raw.slice(1,-1)},ut.isDirectiveCandidate=function(S){return S.type==="ExpressionStatement"&&S.expression.type==="Literal"&&typeof S.expression.value=="string"&&(this.input[S.start]==='"'||this.input[S.start]==="'")};var un=Rt.prototype;un.toAssignable=function(S,R,W){if(this.options.ecmaVersion>=6&&S)switch(S.type){case"Identifier":this.inAsync&&S.name==="await"&&this.raise(S.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":S.type="ObjectPattern",W&&this.checkPatternErrors(W,!0);for(var F=0,ue=S.properties;F<ue.length;F+=1){var De=ue[F];this.toAssignable(De,R),De.type==="RestElement"&&(De.argument.type==="ArrayPattern"||De.argument.type==="ObjectPattern")&&this.raise(De.argument.start,"Unexpected token")}break;case"Property":S.kind!=="init"&&this.raise(S.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(S.value,R);break;case"ArrayExpression":S.type="ArrayPattern",W&&this.checkPatternErrors(W,!0),this.toAssignableList(S.elements,R);break;case"SpreadElement":S.type="RestElement",this.toAssignable(S.argument,R),S.argument.type==="AssignmentPattern"&&this.raise(S.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":S.operator!=="="&&this.raise(S.left.end,"Only '=' operator can be used for specifying default value."),S.type="AssignmentPattern",delete S.operator,this.toAssignable(S.left,R);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(S.expression,R,W);break;case"ChainExpression":this.raiseRecoverable(S.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!R)break;default:this.raise(S.start,"Assigning to rvalue")}else W&&this.checkPatternErrors(W,!0);return S},un.toAssignableList=function(S,R){for(var W=S.length,F=0;F<W;F++){var ue=S[F];ue&&this.toAssignable(ue,R)}if(W){var De=S[W-1];this.options.ecmaVersion===6&&R&&De&&De.type==="RestElement"&&De.argument.type!=="Identifier"&&this.unexpected(De.argument.start)}return S},un.parseSpread=function(S){var R=this.startNode();return this.next(),R.argument=this.parseMaybeAssign(!1,S),this.finishNode(R,"SpreadElement")},un.parseRestBinding=function(){var S=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==ne.name&&this.unexpected(),S.argument=this.parseBindingAtom(),this.finishNode(S,"RestElement")},un.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case ne.bracketL:var S=this.startNode();return this.next(),S.elements=this.parseBindingList(ne.bracketR,!0,!0),this.finishNode(S,"ArrayPattern");case ne.braceL:return this.parseObj(!0)}return this.parseIdent()},un.parseBindingList=function(S,R,W){for(var F=[],ue=!0;!this.eat(S);)if(ue?ue=!1:this.expect(ne.comma),R&&this.type===ne.comma)F.push(null);else{if(W&&this.afterTrailingComma(S))break;if(this.type===ne.ellipsis){var De=this.parseRestBinding();this.parseBindingListItem(De),F.push(De),this.type===ne.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(S);break}else{var ft=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(ft),F.push(ft)}}return F},un.parseBindingListItem=function(S){return S},un.parseMaybeDefault=function(S,R,W){if(W=W||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(ne.eq))return W;var F=this.startNodeAt(S,R);return F.left=W,F.right=this.parseMaybeAssign(),this.finishNode(F,"AssignmentPattern")},un.checkLVal=function(S,R,W){switch(R===void 0&&(R=Bi),S.type){case"Identifier":R===bi&&S.name==="let"&&this.raiseRecoverable(S.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(S.name)&&this.raiseRecoverable(S.start,(R?"Binding ":"Assigning to ")+S.name+" in strict mode"),W&&(Ue(W,S.name)&&this.raiseRecoverable(S.start,"Argument name clash"),W[S.name]=!0),R!==Bi&&R!==eo&&this.declareName(S.name,R,S.start);break;case"ChainExpression":this.raiseRecoverable(S.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":R&&this.raiseRecoverable(S.start,"Binding member expression");break;case"ObjectPattern":for(var F=0,ue=S.properties;F<ue.length;F+=1){var De=ue[F];this.checkLVal(De,R,W)}break;case"Property":this.checkLVal(S.value,R,W);break;case"ArrayPattern":for(var ft=0,Gt=S.elements;ft<Gt.length;ft+=1){var Wt=Gt[ft];Wt&&this.checkLVal(Wt,R,W)}break;case"AssignmentPattern":this.checkLVal(S.left,R,W);break;case"RestElement":this.checkLVal(S.argument,R,W);break;case"ParenthesizedExpression":this.checkLVal(S.expression,R,W);break;default:this.raise(S.start,(R?"Binding":"Assigning to")+" rvalue")}};var vn=Rt.prototype;vn.checkPropClash=function(S,R,W){if(!(this.options.ecmaVersion>=9&&S.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(S.computed||S.method||S.shorthand))){var F=S.key,ue;switch(F.type){case"Identifier":ue=F.name;break;case"Literal":ue=String(F.value);break;default:return}var De=S.kind;if(this.options.ecmaVersion>=6){ue==="__proto__"&&De==="init"&&(R.proto&&(W?W.doubleProto<0&&(W.doubleProto=F.start):this.raiseRecoverable(F.start,"Redefinition of __proto__ property")),R.proto=!0);return}ue="$"+ue;var ft=R[ue];if(ft){var Gt;De==="init"?Gt=this.strict&&ft.init||ft.get||ft.set:Gt=ft.init||ft[De],Gt&&this.raiseRecoverable(F.start,"Redefinition of property")}else ft=R[ue]={init:!1,get:!1,set:!1};ft[De]=!0}},vn.parseExpression=function(S,R){var W=this.start,F=this.startLoc,ue=this.parseMaybeAssign(S,R);if(this.type===ne.comma){var De=this.startNodeAt(W,F);for(De.expressions=[ue];this.eat(ne.comma);)De.expressions.push(this.parseMaybeAssign(S,R));return this.finishNode(De,"SequenceExpression")}return ue},vn.parseMaybeAssign=function(S,R,W){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(S);this.exprAllowed=!1}var F=!1,ue=-1,De=-1;R?(ue=R.parenthesizedAssign,De=R.trailingComma,R.parenthesizedAssign=R.trailingComma=-1):(R=new j,F=!0);var ft=this.start,Gt=this.startLoc;(this.type===ne.parenL||this.type===ne.name)&&(this.potentialArrowAt=this.start);var Wt=this.parseMaybeConditional(S,R);if(W&&(Wt=W.call(this,Wt,ft,Gt)),this.type.isAssign){var Or=this.startNodeAt(ft,Gt);return Or.operator=this.value,Or.left=this.type===ne.eq?this.toAssignable(Wt,!1,R):Wt,F||(R.parenthesizedAssign=R.trailingComma=R.doubleProto=-1),R.shorthandAssign>=Or.left.start&&(R.shorthandAssign=-1),this.checkLVal(Wt),this.next(),Or.right=this.parseMaybeAssign(S),this.finishNode(Or,"AssignmentExpression")}else F&&this.checkExpressionErrors(R,!0);return ue>-1&&(R.parenthesizedAssign=ue),De>-1&&(R.trailingComma=De),Wt},vn.parseMaybeConditional=function(S,R){var W=this.start,F=this.startLoc,ue=this.parseExprOps(S,R);if(this.checkExpressionErrors(R))return ue;if(this.eat(ne.question)){var De=this.startNodeAt(W,F);return De.test=ue,De.consequent=this.parseMaybeAssign(),this.expect(ne.colon),De.alternate=this.parseMaybeAssign(S),this.finishNode(De,"ConditionalExpression")}return ue},vn.parseExprOps=function(S,R){var W=this.start,F=this.startLoc,ue=this.parseMaybeUnary(R,!1);return this.checkExpressionErrors(R)||ue.start===W&&ue.type==="ArrowFunctionExpression"?ue:this.parseExprOp(ue,W,F,-1,S)},vn.parseExprOp=function(S,R,W,F,ue){var De=this.type.binop;if(De!=null&&(!ue||this.type!==ne._in)&&De>F){var ft=this.type===ne.logicalOR||this.type===ne.logicalAND,Gt=this.type===ne.coalesce;Gt&&(De=ne.logicalAND.binop);var Wt=this.value;this.next();var Or=this.start,en=this.startLoc,ci=this.parseExprOp(this.parseMaybeUnary(null,!1),Or,en,De,ue),Gi=this.buildBinary(R,W,S,ci,Wt,ft||Gt);return(ft&&this.type===ne.coalesce||Gt&&(this.type===ne.logicalOR||this.type===ne.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Gi,R,W,F,ue)}return S},vn.buildBinary=function(S,R,W,F,ue,De){var ft=this.startNodeAt(S,R);return ft.left=W,ft.operator=ue,ft.right=F,this.finishNode(ft,De?"LogicalExpression":"BinaryExpression")},vn.parseMaybeUnary=function(S,R){var W=this.start,F=this.startLoc,ue;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))ue=this.parseAwait(),R=!0;else if(this.type.prefix){var De=this.startNode(),ft=this.type===ne.incDec;De.operator=this.value,De.prefix=!0,this.next(),De.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(S,!0),ft?this.checkLVal(De.argument):this.strict&&De.operator==="delete"&&De.argument.type==="Identifier"?this.raiseRecoverable(De.start,"Deleting local variable in strict mode"):R=!0,ue=this.finishNode(De,ft?"UpdateExpression":"UnaryExpression")}else{if(ue=this.parseExprSubscripts(S),this.checkExpressionErrors(S))return ue;for(;this.type.postfix&&!this.canInsertSemicolon();){var Gt=this.startNodeAt(W,F);Gt.operator=this.value,Gt.prefix=!1,Gt.argument=ue,this.checkLVal(ue),this.next(),ue=this.finishNode(Gt,"UpdateExpression")}}return!R&&this.eat(ne.starstar)?this.buildBinary(W,F,ue,this.parseMaybeUnary(null,!1),"**",!1):ue},vn.parseExprSubscripts=function(S){var R=this.start,W=this.startLoc,F=this.parseExprAtom(S);if(F.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return F;var ue=this.parseSubscripts(F,R,W);return S&&ue.type==="MemberExpression"&&(S.parenthesizedAssign>=ue.start&&(S.parenthesizedAssign=-1),S.parenthesizedBind>=ue.start&&(S.parenthesizedBind=-1)),ue},vn.parseSubscripts=function(S,R,W,F){for(var ue=this.options.ecmaVersion>=8&&S.type==="Identifier"&&S.name==="async"&&this.lastTokEnd===S.end&&!this.canInsertSemicolon()&&S.end-S.start==5&&this.potentialArrowAt===S.start,De=!1;;){var ft=this.parseSubscript(S,R,W,F,ue,De);if(ft.optional&&(De=!0),ft===S||ft.type==="ArrowFunctionExpression"){if(De){var Gt=this.startNodeAt(R,W);Gt.expression=ft,ft=this.finishNode(Gt,"ChainExpression")}return ft}S=ft}},vn.parseSubscript=function(S,R,W,F,ue,De){var ft=this.options.ecmaVersion>=11,Gt=ft&&this.eat(ne.questionDot);F&&Gt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Wt=this.eat(ne.bracketL);if(Wt||Gt&&this.type!==ne.parenL&&this.type!==ne.backQuote||this.eat(ne.dot)){var Or=this.startNodeAt(R,W);Or.object=S,Or.property=Wt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Or.computed=!!Wt,Wt&&this.expect(ne.bracketR),ft&&(Or.optional=Gt),S=this.finishNode(Or,"MemberExpression")}else if(!F&&this.eat(ne.parenL)){var en=new j,ci=this.yieldPos,Gi=this.awaitPos,vi=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var ka=this.parseExprList(ne.parenR,this.options.ecmaVersion>=8,!1,en);if(ue&&!Gt&&!this.canInsertSemicolon()&&this.eat(ne.arrow))return this.checkPatternErrors(en,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=ci,this.awaitPos=Gi,this.awaitIdentPos=vi,this.parseArrowExpression(this.startNodeAt(R,W),ka,!0);this.checkExpressionErrors(en,!0),this.yieldPos=ci||this.yieldPos,this.awaitPos=Gi||this.awaitPos,this.awaitIdentPos=vi||this.awaitIdentPos;var ha=this.startNodeAt(R,W);ha.callee=S,ha.arguments=ka,ft&&(ha.optional=Gt),S=this.finishNode(ha,"CallExpression")}else if(this.type===ne.backQuote){(Gt||De)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var So=this.startNodeAt(R,W);So.tag=S,So.quasi=this.parseTemplate({isTagged:!0}),S=this.finishNode(So,"TaggedTemplateExpression")}return S},vn.parseExprAtom=function(S){this.type===ne.slash&&this.readRegexp();var R,W=this.potentialArrowAt===this.start;switch(this.type){case ne._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),R=this.startNode(),this.next(),this.type===ne.parenL&&!this.allowDirectSuper&&this.raise(R.start,"super() call outside constructor of a subclass"),this.type!==ne.dot&&this.type!==ne.bracketL&&this.type!==ne.parenL&&this.unexpected(),this.finishNode(R,"Super");case ne._this:return R=this.startNode(),this.next(),this.finishNode(R,"ThisExpression");case ne.name:var F=this.start,ue=this.startLoc,De=this.containsEsc,ft=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!De&&ft.name==="async"&&!this.canInsertSemicolon()&&this.eat(ne._function))return this.parseFunction(this.startNodeAt(F,ue),0,!1,!0);if(W&&!this.canInsertSemicolon()){if(this.eat(ne.arrow))return this.parseArrowExpression(this.startNodeAt(F,ue),[ft],!1);if(this.options.ecmaVersion>=8&&ft.name==="async"&&this.type===ne.name&&!De)return ft=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(ne.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(F,ue),[ft],!0)}return ft;case ne.regexp:var Gt=this.value;return R=this.parseLiteral(Gt.value),R.regex={pattern:Gt.pattern,flags:Gt.flags},R;case ne.num:case ne.string:return this.parseLiteral(this.value);case ne._null:case ne._true:case ne._false:return R=this.startNode(),R.value=this.type===ne._null?null:this.type===ne._true,R.raw=this.type.keyword,this.next(),this.finishNode(R,"Literal");case ne.parenL:var Wt=this.start,Or=this.parseParenAndDistinguishExpression(W);return S&&(S.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Or)&&(S.parenthesizedAssign=Wt),S.parenthesizedBind<0&&(S.parenthesizedBind=Wt)),Or;case ne.bracketL:return R=this.startNode(),this.next(),R.elements=this.parseExprList(ne.bracketR,!0,!0,S),this.finishNode(R,"ArrayExpression");case ne.braceL:return this.parseObj(!1,S);case ne._function:return R=this.startNode(),this.next(),this.parseFunction(R,0);case ne._class:return this.parseClass(this.startNode(),!1);case ne._new:return this.parseNew();case ne.backQuote:return this.parseTemplate();case ne._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},vn.parseExprImport=function(){var S=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var R=this.parseIdent(!0);switch(this.type){case ne.parenL:return this.parseDynamicImport(S);case ne.dot:return S.meta=R,this.parseImportMeta(S);default:this.unexpected()}},vn.parseDynamicImport=function(S){if(this.next(),S.source=this.parseMaybeAssign(),!this.eat(ne.parenR)){var R=this.start;this.eat(ne.comma)&&this.eat(ne.parenR)?this.raiseRecoverable(R,"Trailing comma is not allowed in import()"):this.unexpected(R)}return this.finishNode(S,"ImportExpression")},vn.parseImportMeta=function(S){this.next();var R=this.containsEsc;return S.property=this.parseIdent(!0),S.property.name!=="meta"&&this.raiseRecoverable(S.property.start,"The only valid meta property for import is 'import.meta'"),R&&this.raiseRecoverable(S.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(S.start,"Cannot use 'import.meta' outside a module"),this.finishNode(S,"MetaProperty")},vn.parseLiteral=function(S){var R=this.startNode();return R.value=S,R.raw=this.input.slice(this.start,this.end),R.raw.charCodeAt(R.raw.length-1)===110&&(R.bigint=R.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(R,"Literal")},vn.parseParenExpression=function(){this.expect(ne.parenL);var S=this.parseExpression();return this.expect(ne.parenR),S},vn.parseParenAndDistinguishExpression=function(S){var R=this.start,W=this.startLoc,F,ue=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var De=this.start,ft=this.startLoc,Gt=[],Wt=!0,Or=!1,en=new j,ci=this.yieldPos,Gi=this.awaitPos,vi;for(this.yieldPos=0,this.awaitPos=0;this.type!==ne.parenR;)if(Wt?Wt=!1:this.expect(ne.comma),ue&&this.afterTrailingComma(ne.parenR,!0)){Or=!0;break}else if(this.type===ne.ellipsis){vi=this.start,Gt.push(this.parseParenItem(this.parseRestBinding())),this.type===ne.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Gt.push(this.parseMaybeAssign(!1,en,this.parseParenItem));var ka=this.start,ha=this.startLoc;if(this.expect(ne.parenR),S&&!this.canInsertSemicolon()&&this.eat(ne.arrow))return this.checkPatternErrors(en,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=ci,this.awaitPos=Gi,this.parseParenArrowList(R,W,Gt);(!Gt.length||Or)&&this.unexpected(this.lastTokStart),vi&&this.unexpected(vi),this.checkExpressionErrors(en,!0),this.yieldPos=ci||this.yieldPos,this.awaitPos=Gi||this.awaitPos,Gt.length>1?(F=this.startNodeAt(De,ft),F.expressions=Gt,this.finishNodeAt(F,"SequenceExpression",ka,ha)):F=Gt[0]}else F=this.parseParenExpression();if(this.options.preserveParens){var So=this.startNodeAt(R,W);return So.expression=F,this.finishNode(So,"ParenthesizedExpression")}else return F},vn.parseParenItem=function(S){return S},vn.parseParenArrowList=function(S,R,W){return this.parseArrowExpression(this.startNodeAt(S,R),W)};var ui=[];vn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var S=this.startNode(),R=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(ne.dot)){S.meta=R;var W=this.containsEsc;return S.property=this.parseIdent(!0),S.property.name!=="target"&&this.raiseRecoverable(S.property.start,"The only valid meta property for new is 'new.target'"),W&&this.raiseRecoverable(S.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(S.start,"'new.target' can only be used in functions"),this.finishNode(S,"MetaProperty")}var F=this.start,ue=this.startLoc,De=this.type===ne._import;return S.callee=this.parseSubscripts(this.parseExprAtom(),F,ue,!0),De&&S.callee.type==="ImportExpression"&&this.raise(F,"Cannot use new with import()"),this.eat(ne.parenL)?S.arguments=this.parseExprList(ne.parenR,this.options.ecmaVersion>=8,!1):S.arguments=ui,this.finishNode(S,"NewExpression")},vn.parseTemplateElement=function(S){var R=S.isTagged,W=this.startNode();return this.type===ne.invalidTemplate?(R||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),W.value={raw:this.value,cooked:null}):W.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),W.tail=this.type===ne.backQuote,this.finishNode(W,"TemplateElement")},vn.parseTemplate=function(S){S===void 0&&(S={});var R=S.isTagged;R===void 0&&(R=!1);var W=this.startNode();this.next(),W.expressions=[];var F=this.parseTemplateElement({isTagged:R});for(W.quasis=[F];!F.tail;)this.type===ne.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(ne.dollarBraceL),W.expressions.push(this.parseExpression()),this.expect(ne.braceR),W.quasis.push(F=this.parseTemplateElement({isTagged:R}));return this.next(),this.finishNode(W,"TemplateLiteral")},vn.isAsyncProp=function(S){return!S.computed&&S.key.type==="Identifier"&&S.key.name==="async"&&(this.type===ne.name||this.type===ne.num||this.type===ne.string||this.type===ne.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===ne.star)&&!gr.test(this.input.slice(this.lastTokEnd,this.start))},vn.parseObj=function(S,R){var W=this.startNode(),F=!0,ue={};for(W.properties=[],this.next();!this.eat(ne.braceR);){if(F)F=!1;else if(this.expect(ne.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(ne.braceR))break;var De=this.parseProperty(S,R);S||this.checkPropClash(De,ue,R),W.properties.push(De)}return this.finishNode(W,S?"ObjectPattern":"ObjectExpression")},vn.parseProperty=function(S,R){var W=this.startNode(),F,ue,De,ft;if(this.options.ecmaVersion>=9&&this.eat(ne.ellipsis))return S?(W.argument=this.parseIdent(!1),this.type===ne.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(W,"RestElement")):(this.type===ne.parenL&&R&&(R.parenthesizedAssign<0&&(R.parenthesizedAssign=this.start),R.parenthesizedBind<0&&(R.parenthesizedBind=this.start)),W.argument=this.parseMaybeAssign(!1,R),this.type===ne.comma&&R&&R.trailingComma<0&&(R.trailingComma=this.start),this.finishNode(W,"SpreadElement"));this.options.ecmaVersion>=6&&(W.method=!1,W.shorthand=!1,(S||R)&&(De=this.start,ft=this.startLoc),S||(F=this.eat(ne.star)));var Gt=this.containsEsc;return this.parsePropertyName(W),!S&&!Gt&&this.options.ecmaVersion>=8&&!F&&this.isAsyncProp(W)?(ue=!0,F=this.options.ecmaVersion>=9&&this.eat(ne.star),this.parsePropertyName(W,R)):ue=!1,this.parsePropertyValue(W,S,F,ue,De,ft,R,Gt),this.finishNode(W,"Property")},vn.parsePropertyValue=function(S,R,W,F,ue,De,ft,Gt){if((W||F)&&this.type===ne.colon&&this.unexpected(),this.eat(ne.colon))S.value=R?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,ft),S.kind="init";else if(this.options.ecmaVersion>=6&&this.type===ne.parenL)R&&this.unexpected(),S.kind="init",S.method=!0,S.value=this.parseMethod(W,F);else if(!R&&!Gt&&this.options.ecmaVersion>=5&&!S.computed&&S.key.type==="Identifier"&&(S.key.name==="get"||S.key.name==="set")&&this.type!==ne.comma&&this.type!==ne.braceR&&this.type!==ne.eq){(W||F)&&this.unexpected(),S.kind=S.key.name,this.parsePropertyName(S),S.value=this.parseMethod(!1);var Wt=S.kind==="get"?0:1;if(S.value.params.length!==Wt){var Or=S.value.start;S.kind==="get"?this.raiseRecoverable(Or,"getter should have no params"):this.raiseRecoverable(Or,"setter should have exactly one param")}else S.kind==="set"&&S.value.params[0].type==="RestElement"&&this.raiseRecoverable(S.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!S.computed&&S.key.type==="Identifier"?((W||F)&&this.unexpected(),this.checkUnreserved(S.key),S.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=ue),S.kind="init",R?S.value=this.parseMaybeDefault(ue,De,S.key):this.type===ne.eq&&ft?(ft.shorthandAssign<0&&(ft.shorthandAssign=this.start),S.value=this.parseMaybeDefault(ue,De,S.key)):S.value=S.key,S.shorthand=!0):this.unexpected()},vn.parsePropertyName=function(S){if(this.options.ecmaVersion>=6){if(this.eat(ne.bracketL))return S.computed=!0,S.key=this.parseMaybeAssign(),this.expect(ne.bracketR),S.key;S.computed=!1}return S.key=this.type===ne.num||this.type===ne.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},vn.initFunction=function(S){S.id=null,this.options.ecmaVersion>=6&&(S.generator=S.expression=!1),this.options.ecmaVersion>=8&&(S.async=!1)},vn.parseMethod=function(S,R,W){var F=this.startNode(),ue=this.yieldPos,De=this.awaitPos,ft=this.awaitIdentPos;return this.initFunction(F),this.options.ecmaVersion>=6&&(F.generator=S),this.options.ecmaVersion>=8&&(F.async=!!R),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(sa(R,F.generator)|Pi|(W?ua:0)),this.expect(ne.parenL),F.params=this.parseBindingList(ne.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(F,!1,!0),this.yieldPos=ue,this.awaitPos=De,this.awaitIdentPos=ft,this.finishNode(F,"FunctionExpression")},vn.parseArrowExpression=function(S,R,W){var F=this.yieldPos,ue=this.awaitPos,De=this.awaitIdentPos;return this.enterScope(sa(W,!1)|Ra),this.initFunction(S),this.options.ecmaVersion>=8&&(S.async=!!W),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,S.params=this.toAssignableList(R,!0),this.parseFunctionBody(S,!0,!1),this.yieldPos=F,this.awaitPos=ue,this.awaitIdentPos=De,this.finishNode(S,"ArrowFunctionExpression")},vn.parseFunctionBody=function(S,R,W){var F=R&&this.type!==ne.braceL,ue=this.strict,De=!1;if(F)S.body=this.parseMaybeAssign(),S.expression=!0,this.checkParams(S,!1);else{var ft=this.options.ecmaVersion>=7&&!this.isSimpleParamList(S.params);(!ue||ft)&&(De=this.strictDirective(this.end),De&&ft&&this.raiseRecoverable(S.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Gt=this.labels;this.labels=[],De&&(this.strict=!0),this.checkParams(S,!ue&&!De&&!R&&!W&&this.isSimpleParamList(S.params)),this.strict&&S.id&&this.checkLVal(S.id,eo),S.body=this.parseBlock(!1,void 0,De&&!ue),S.expression=!1,this.adaptDirectivePrologue(S.body.body),this.labels=Gt}this.exitScope()},vn.isSimpleParamList=function(S){for(var R=0,W=S;R<W.length;R+=1){var F=W[R];if(F.type!=="Identifier")return!1}return!0},vn.checkParams=function(S,R){for(var W={},F=0,ue=S.params;F<ue.length;F+=1){var De=ue[F];this.checkLVal(De,Yn,R?null:W)}},vn.parseExprList=function(S,R,W,F){for(var ue=[],De=!0;!this.eat(S);){if(De)De=!1;else if(this.expect(ne.comma),R&&this.afterTrailingComma(S))break;var ft=void 0;W&&this.type===ne.comma?ft=null:this.type===ne.ellipsis?(ft=this.parseSpread(F),F&&this.type===ne.comma&&F.trailingComma<0&&(F.trailingComma=this.start)):ft=this.parseMaybeAssign(!1,F),ue.push(ft)}return ue},vn.checkUnreserved=function(S){var R=S.start,W=S.end,F=S.name;if(this.inGenerator&&F==="yield"&&this.raiseRecoverable(R,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&F==="await"&&this.raiseRecoverable(R,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(F)&&this.raise(R,"Unexpected keyword '"+F+"'"),!(this.options.ecmaVersion<6&&this.input.slice(R,W).indexOf("\\")!==-1)){var ue=this.strict?this.reservedWordsStrict:this.reservedWords;ue.test(F)&&(!this.inAsync&&F==="await"&&this.raiseRecoverable(R,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(R,"The keyword '"+F+"' is reserved"))}},vn.parseIdent=function(S,R){var W=this.startNode();return this.type===ne.name?W.name=this.value:this.type.keyword?(W.name=this.type.keyword,(W.name==="class"||W.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!S),this.finishNode(W,"Identifier"),S||(this.checkUnreserved(W),W.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=W.start)),W},vn.parseYield=function(S){this.yieldPos||(this.yieldPos=this.start);var R=this.startNode();return this.next(),this.type===ne.semi||this.canInsertSemicolon()||this.type!==ne.star&&!this.type.startsExpr?(R.delegate=!1,R.argument=null):(R.delegate=this.eat(ne.star),R.argument=this.parseMaybeAssign(S)),this.finishNode(R,"YieldExpression")},vn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var S=this.startNode();return this.next(),S.argument=this.parseMaybeUnary(null,!1),this.finishNode(S,"AwaitExpression")};var Jn=Rt.prototype;Jn.raise=function(S,R){var W=lt(this.input,S);R+=" ("+W.line+":"+W.column+")";var F=new SyntaxError(R);throw F.pos=S,F.loc=W,F.raisedAt=this.pos,F},Jn.raiseRecoverable=Jn.raise,Jn.curPosition=function(){if(this.options.locations)return new de(this.curLine,this.pos-this.lineStart)};var mn=Rt.prototype,Ri=function(R){this.flags=R,this.var=[],this.lexical=[],this.functions=[]};mn.enterScope=function(S){this.scopeStack.push(new Ri(S))},mn.exitScope=function(){this.scopeStack.pop()},mn.treatFunctionsAsVarInScope=function(S){return S.flags&Kr||!this.inModule&&S.flags&tn},mn.declareName=function(S,R,W){var F=!1;if(R===bi){var ue=this.currentScope();F=ue.lexical.indexOf(S)>-1||ue.functions.indexOf(S)>-1||ue.var.indexOf(S)>-1,ue.lexical.push(S),this.inModule&&ue.flags&tn&&delete this.undefinedExports[S]}else if(R===Ha){var De=this.currentScope();De.lexical.push(S)}else if(R===Ms){var ft=this.currentScope();this.treatFunctionsAsVar?F=ft.lexical.indexOf(S)>-1:F=ft.lexical.indexOf(S)>-1||ft.var.indexOf(S)>-1,ft.functions.push(S)}else for(var Gt=this.scopeStack.length-1;Gt>=0;--Gt){var Wt=this.scopeStack[Gt];if(Wt.lexical.indexOf(S)>-1&&!(Wt.flags&Di&&Wt.lexical[0]===S)||!this.treatFunctionsAsVarInScope(Wt)&&Wt.functions.indexOf(S)>-1){F=!0;break}if(Wt.var.push(S),this.inModule&&Wt.flags&tn&&delete this.undefinedExports[S],Wt.flags&si)break}F&&this.raiseRecoverable(W,"Identifier '"+S+"' has already been declared")},mn.checkLocalExport=function(S){this.scopeStack[0].lexical.indexOf(S.name)===-1&&this.scopeStack[0].var.indexOf(S.name)===-1&&(this.undefinedExports[S.name]=S)},mn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},mn.currentVarScope=function(){for(var S=this.scopeStack.length-1;;S--){var R=this.scopeStack[S];if(R.flags&si)return R}},mn.currentThisScope=function(){for(var S=this.scopeStack.length-1;;S--){var R=this.scopeStack[S];if(R.flags&si&&!(R.flags&Ra))return R}};var Si=function(R,W,F){this.type="",this.start=W,this.end=0,R.options.locations&&(this.loc=new Xe(R,F)),R.options.directSourceFile&&(this.sourceFile=R.options.directSourceFile),R.options.ranges&&(this.range=[W,0])},Wa=Rt.prototype;Wa.startNode=function(){return new Si(this,this.start,this.startLoc)},Wa.startNodeAt=function(S,R){return new Si(this,S,R)};function uo(S,R,W,F){return S.type=R,S.end=W,this.options.locations&&(S.loc.end=F),this.options.ranges&&(S.range[1]=W),S}Wa.finishNode=function(S,R){return uo.call(this,S,R,this.lastTokEnd,this.lastTokEndLoc)},Wa.finishNodeAt=function(S,R,W,F){return uo.call(this,S,R,W,F)};var Io=function(R,W,F,ue,De){this.token=R,this.isExpr=!!W,this.preserveSpace=!!F,this.override=ue,this.generator=!!De},to={b_stat:new Io("{",!1),b_expr:new Io("{",!0),b_tmpl:new Io("${",!1),p_stat:new Io("(",!1),p_expr:new Io("(",!0),q_tmpl:new Io("`",!0,!0,function(S){return S.tryReadTemplateToken()}),f_stat:new Io("function",!1),f_expr:new Io("function",!0),f_expr_gen:new Io("function",!0,!1,null,!0),f_gen:new Io("function",!1,!1,null,!0)},La=Rt.prototype;La.initialContext=function(){return[to.b_stat]},La.braceIsBlock=function(S){var R=this.curContext();return R===to.f_expr||R===to.f_stat?!0:S===ne.colon&&(R===to.b_stat||R===to.b_expr)?!R.isExpr:S===ne._return||S===ne.name&&this.exprAllowed?gr.test(this.input.slice(this.lastTokEnd,this.start)):S===ne._else||S===ne.semi||S===ne.eof||S===ne.parenR||S===ne.arrow?!0:S===ne.braceL?R===to.b_stat:S===ne._var||S===ne._const||S===ne.name?!1:!this.exprAllowed},La.inGeneratorContext=function(){for(var S=this.context.length-1;S>=1;S--){var R=this.context[S];if(R.token==="function")return R.generator}return!1},La.updateContext=function(S){var R,W=this.type;W.keyword&&S===ne.dot?this.exprAllowed=!1:(R=W.updateContext)?R.call(this,S):this.exprAllowed=W.beforeExpr},ne.parenR.updateContext=ne.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var S=this.context.pop();S===to.b_stat&&this.curContext().token==="function"&&(S=this.context.pop()),this.exprAllowed=!S.isExpr},ne.braceL.updateContext=function(S){this.context.push(this.braceIsBlock(S)?to.b_stat:to.b_expr),this.exprAllowed=!0},ne.dollarBraceL.updateContext=function(){this.context.push(to.b_tmpl),this.exprAllowed=!0},ne.parenL.updateContext=function(S){var R=S===ne._if||S===ne._for||S===ne._with||S===ne._while;this.context.push(R?to.p_stat:to.p_expr),this.exprAllowed=!0},ne.incDec.updateContext=function(){},ne._function.updateContext=ne._class.updateContext=function(S){S.beforeExpr&&S!==ne.semi&&S!==ne._else&&!(S===ne._return&&gr.test(this.input.slice(this.lastTokEnd,this.start)))&&!((S===ne.colon||S===ne.braceL)&&this.curContext()===to.b_stat)?this.context.push(to.f_expr):this.context.push(to.f_stat),this.exprAllowed=!1},ne.backQuote.updateContext=function(){this.curContext()===to.q_tmpl?this.context.pop():this.context.push(to.q_tmpl),this.exprAllowed=!1},ne.star.updateContext=function(S){if(S===ne._function){var R=this.context.length-1;this.context[R]===to.f_expr?this.context[R]=to.f_expr_gen:this.context[R]=to.f_gen}this.exprAllowed=!0},ne.name.updateContext=function(S){var R=!1;this.options.ecmaVersion>=6&&S!==ne.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(R=!0),this.exprAllowed=R};var te="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",le=te+" Extended_Pictographic",ye=le,Re={9:te,10:le,11:ye},He="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",ht="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",At=ht+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Te=At+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Je={9:ht,10:At,11:Te},Xt={};function Wr(S){var R=Xt[S]={binary:U(Re[S]+" "+He),nonBinary:{General_Category:U(He),Script:U(Je[S])}};R.nonBinary.Script_Extensions=R.nonBinary.Script,R.nonBinary.gc=R.nonBinary.General_Category,R.nonBinary.sc=R.nonBinary.Script,R.nonBinary.scx=R.nonBinary.Script_Extensions}Wr(9),Wr(10),Wr(11);var cr=Rt.prototype,dr=function(R){this.parser=R,this.validFlags="gim"+(R.options.ecmaVersion>=6?"uy":"")+(R.options.ecmaVersion>=9?"s":""),this.unicodeProperties=Xt[R.options.ecmaVersion>=11?11:R.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};dr.prototype.reset=function(R,W,F){var ue=F.indexOf("u")!==-1;this.start=R|0,this.source=W+"",this.flags=F,this.switchU=ue&&this.parser.options.ecmaVersion>=6,this.switchN=ue&&this.parser.options.ecmaVersion>=9},dr.prototype.raise=function(R){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+R)},dr.prototype.at=function(R,W){W===void 0&&(W=!1);var F=this.source,ue=F.length;if(R>=ue)return-1;var De=F.charCodeAt(R);if(!(W||this.switchU)||De<=55295||De>=57344||R+1>=ue)return De;var ft=F.charCodeAt(R+1);return ft>=56320&&ft<=57343?(De<<10)+ft-56613888:De},dr.prototype.nextIndex=function(R,W){W===void 0&&(W=!1);var F=this.source,ue=F.length;if(R>=ue)return ue;var De=F.charCodeAt(R),ft;return!(W||this.switchU)||De<=55295||De>=57344||R+1>=ue||(ft=F.charCodeAt(R+1))<56320||ft>57343?R+1:R+2},dr.prototype.current=function(R){return R===void 0&&(R=!1),this.at(this.pos,R)},dr.prototype.lookahead=function(R){return R===void 0&&(R=!1),this.at(this.nextIndex(this.pos,R),R)},dr.prototype.advance=function(R){R===void 0&&(R=!1),this.pos=this.nextIndex(this.pos,R)},dr.prototype.eat=function(R,W){return W===void 0&&(W=!1),this.current(W)===R?(this.advance(W),!0):!1};function jr(S){return S<=65535?String.fromCharCode(S):(S-=65536,String.fromCharCode((S>>10)+55296,(S&1023)+56320))}cr.validateRegExpFlags=function(S){for(var R=S.validFlags,W=S.flags,F=0;F<W.length;F++){var ue=W.charAt(F);R.indexOf(ue)===-1&&this.raise(S.start,"Invalid regular expression flag"),W.indexOf(ue,F+1)>-1&&this.raise(S.start,"Duplicate regular expression flag")}},cr.validateRegExpPattern=function(S){this.regexp_pattern(S),!S.switchN&&this.options.ecmaVersion>=9&&S.groupNames.length>0&&(S.switchN=!0,this.regexp_pattern(S))},cr.regexp_pattern=function(S){S.pos=0,S.lastIntValue=0,S.lastStringValue="",S.lastAssertionIsQuantifiable=!1,S.numCapturingParens=0,S.maxBackReference=0,S.groupNames.length=0,S.backReferenceNames.length=0,this.regexp_disjunction(S),S.pos!==S.source.length&&(S.eat(41)&&S.raise("Unmatched ')'"),(S.eat(93)||S.eat(125))&&S.raise("Lone quantifier brackets")),S.maxBackReference>S.numCapturingParens&&S.raise("Invalid escape");for(var R=0,W=S.backReferenceNames;R<W.length;R+=1){var F=W[R];S.groupNames.indexOf(F)===-1&&S.raise("Invalid named capture referenced")}},cr.regexp_disjunction=function(S){for(this.regexp_alternative(S);S.eat(124);)this.regexp_alternative(S);this.regexp_eatQuantifier(S,!0)&&S.raise("Nothing to repeat"),S.eat(123)&&S.raise("Lone quantifier brackets")},cr.regexp_alternative=function(S){for(;S.pos<S.source.length&&this.regexp_eatTerm(S););},cr.regexp_eatTerm=function(S){return this.regexp_eatAssertion(S)?(S.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(S)&&S.switchU&&S.raise("Invalid quantifier"),!0):(S.switchU?this.regexp_eatAtom(S):this.regexp_eatExtendedAtom(S))?(this.regexp_eatQuantifier(S),!0):!1},cr.regexp_eatAssertion=function(S){var R=S.pos;if(S.lastAssertionIsQuantifiable=!1,S.eat(94)||S.eat(36))return!0;if(S.eat(92)){if(S.eat(66)||S.eat(98))return!0;S.pos=R}if(S.eat(40)&&S.eat(63)){var W=!1;if(this.options.ecmaVersion>=9&&(W=S.eat(60)),S.eat(61)||S.eat(33))return this.regexp_disjunction(S),S.eat(41)||S.raise("Unterminated group"),S.lastAssertionIsQuantifiable=!W,!0}return S.pos=R,!1},cr.regexp_eatQuantifier=function(S,R){return R===void 0&&(R=!1),this.regexp_eatQuantifierPrefix(S,R)?(S.eat(63),!0):!1},cr.regexp_eatQuantifierPrefix=function(S,R){return S.eat(42)||S.eat(43)||S.eat(63)||this.regexp_eatBracedQuantifier(S,R)},cr.regexp_eatBracedQuantifier=function(S,R){var W=S.pos;if(S.eat(123)){var F=0,ue=-1;if(this.regexp_eatDecimalDigits(S)&&(F=S.lastIntValue,S.eat(44)&&this.regexp_eatDecimalDigits(S)&&(ue=S.lastIntValue),S.eat(125)))return ue!==-1&&ue<F&&!R&&S.raise("numbers out of order in {} quantifier"),!0;S.switchU&&!R&&S.raise("Incomplete quantifier"),S.pos=W}return!1},cr.regexp_eatAtom=function(S){return this.regexp_eatPatternCharacters(S)||S.eat(46)||this.regexp_eatReverseSolidusAtomEscape(S)||this.regexp_eatCharacterClass(S)||this.regexp_eatUncapturingGroup(S)||this.regexp_eatCapturingGroup(S)},cr.regexp_eatReverseSolidusAtomEscape=function(S){var R=S.pos;if(S.eat(92)){if(this.regexp_eatAtomEscape(S))return!0;S.pos=R}return!1},cr.regexp_eatUncapturingGroup=function(S){var R=S.pos;if(S.eat(40)){if(S.eat(63)&&S.eat(58)){if(this.regexp_disjunction(S),S.eat(41))return!0;S.raise("Unterminated group")}S.pos=R}return!1},cr.regexp_eatCapturingGroup=function(S){if(S.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(S):S.current()===63&&S.raise("Invalid group"),this.regexp_disjunction(S),S.eat(41))return S.numCapturingParens+=1,!0;S.raise("Unterminated group")}return!1},cr.regexp_eatExtendedAtom=function(S){return S.eat(46)||this.regexp_eatReverseSolidusAtomEscape(S)||this.regexp_eatCharacterClass(S)||this.regexp_eatUncapturingGroup(S)||this.regexp_eatCapturingGroup(S)||this.regexp_eatInvalidBracedQuantifier(S)||this.regexp_eatExtendedPatternCharacter(S)},cr.regexp_eatInvalidBracedQuantifier=function(S){return this.regexp_eatBracedQuantifier(S,!0)&&S.raise("Nothing to repeat"),!1},cr.regexp_eatSyntaxCharacter=function(S){var R=S.current();return qn(R)?(S.lastIntValue=R,S.advance(),!0):!1};function qn(S){return S===36||S>=40&&S<=43||S===46||S===63||S>=91&&S<=94||S>=123&&S<=125}cr.regexp_eatPatternCharacters=function(S){for(var R=S.pos,W=0;(W=S.current())!==-1&&!qn(W);)S.advance();return S.pos!==R},cr.regexp_eatExtendedPatternCharacter=function(S){var R=S.current();return R!==-1&&R!==36&&!(R>=40&&R<=43)&&R!==46&&R!==63&&R!==91&&R!==94&&R!==124?(S.advance(),!0):!1},cr.regexp_groupSpecifier=function(S){if(S.eat(63)){if(this.regexp_eatGroupName(S)){S.groupNames.indexOf(S.lastStringValue)!==-1&&S.raise("Duplicate capture group name"),S.groupNames.push(S.lastStringValue);return}S.raise("Invalid group")}},cr.regexp_eatGroupName=function(S){if(S.lastStringValue="",S.eat(60)){if(this.regexp_eatRegExpIdentifierName(S)&&S.eat(62))return!0;S.raise("Invalid capture group name")}return!1},cr.regexp_eatRegExpIdentifierName=function(S){if(S.lastStringValue="",this.regexp_eatRegExpIdentifierStart(S)){for(S.lastStringValue+=jr(S.lastIntValue);this.regexp_eatRegExpIdentifierPart(S);)S.lastStringValue+=jr(S.lastIntValue);return!0}return!1},cr.regexp_eatRegExpIdentifierStart=function(S){var R=S.pos,W=this.options.ecmaVersion>=11,F=S.current(W);return S.advance(W),F===92&&this.regexp_eatRegExpUnicodeEscapeSequence(S,W)&&(F=S.lastIntValue),Un(F)?(S.lastIntValue=F,!0):(S.pos=R,!1)};function Un(S){return Ft(S,!0)||S===36||S===95}cr.regexp_eatRegExpIdentifierPart=function(S){var R=S.pos,W=this.options.ecmaVersion>=11,F=S.current(W);return S.advance(W),F===92&&this.regexp_eatRegExpUnicodeEscapeSequence(S,W)&&(F=S.lastIntValue),ar(F)?(S.lastIntValue=F,!0):(S.pos=R,!1)};function ar(S){return mr(S,!0)||S===36||S===95||S===8204||S===8205}cr.regexp_eatAtomEscape=function(S){return this.regexp_eatBackReference(S)||this.regexp_eatCharacterClassEscape(S)||this.regexp_eatCharacterEscape(S)||S.switchN&&this.regexp_eatKGroupName(S)?!0:(S.switchU&&(S.current()===99&&S.raise("Invalid unicode escape"),S.raise("Invalid escape")),!1)},cr.regexp_eatBackReference=function(S){var R=S.pos;if(this.regexp_eatDecimalEscape(S)){var W=S.lastIntValue;if(S.switchU)return W>S.maxBackReference&&(S.maxBackReference=W),!0;if(W<=S.numCapturingParens)return!0;S.pos=R}return!1},cr.regexp_eatKGroupName=function(S){if(S.eat(107)){if(this.regexp_eatGroupName(S))return S.backReferenceNames.push(S.lastStringValue),!0;S.raise("Invalid named reference")}return!1},cr.regexp_eatCharacterEscape=function(S){return this.regexp_eatControlEscape(S)||this.regexp_eatCControlLetter(S)||this.regexp_eatZero(S)||this.regexp_eatHexEscapeSequence(S)||this.regexp_eatRegExpUnicodeEscapeSequence(S,!1)||!S.switchU&&this.regexp_eatLegacyOctalEscapeSequence(S)||this.regexp_eatIdentityEscape(S)},cr.regexp_eatCControlLetter=function(S){var R=S.pos;if(S.eat(99)){if(this.regexp_eatControlLetter(S))return!0;S.pos=R}return!1},cr.regexp_eatZero=function(S){return S.current()===48&&!ta(S.lookahead())?(S.lastIntValue=0,S.advance(),!0):!1},cr.regexp_eatControlEscape=function(S){var R=S.current();return R===116?(S.lastIntValue=9,S.advance(),!0):R===110?(S.lastIntValue=10,S.advance(),!0):R===118?(S.lastIntValue=11,S.advance(),!0):R===102?(S.lastIntValue=12,S.advance(),!0):R===114?(S.lastIntValue=13,S.advance(),!0):!1},cr.regexp_eatControlLetter=function(S){var R=S.current();return ot(R)?(S.lastIntValue=R%32,S.advance(),!0):!1};function ot(S){return S>=65&&S<=90||S>=97&&S<=122}cr.regexp_eatRegExpUnicodeEscapeSequence=function(S,R){R===void 0&&(R=!1);var W=S.pos,F=R||S.switchU;if(S.eat(117)){if(this.regexp_eatFixedHexDigits(S,4)){var ue=S.lastIntValue;if(F&&ue>=55296&&ue<=56319){var De=S.pos;if(S.eat(92)&&S.eat(117)&&this.regexp_eatFixedHexDigits(S,4)){var ft=S.lastIntValue;if(ft>=56320&&ft<=57343)return S.lastIntValue=(ue-55296)*1024+(ft-56320)+65536,!0}S.pos=De,S.lastIntValue=ue}return!0}if(F&&S.eat(123)&&this.regexp_eatHexDigits(S)&&S.eat(125)&&Cn(S.lastIntValue))return!0;F&&S.raise("Invalid unicode escape"),S.pos=W}return!1};function Cn(S){return S>=0&&S<=1114111}cr.regexp_eatIdentityEscape=function(S){if(S.switchU)return this.regexp_eatSyntaxCharacter(S)?!0:S.eat(47)?(S.lastIntValue=47,!0):!1;var R=S.current();return R!==99&&(!S.switchN||R!==107)?(S.lastIntValue=R,S.advance(),!0):!1},cr.regexp_eatDecimalEscape=function(S){S.lastIntValue=0;var R=S.current();if(R>=49&&R<=57){do S.lastIntValue=10*S.lastIntValue+(R-48),S.advance();while((R=S.current())>=48&&R<=57);return!0}return!1},cr.regexp_eatCharacterClassEscape=function(S){var R=S.current();if(se(R))return S.lastIntValue=-1,S.advance(),!0;if(S.switchU&&this.options.ecmaVersion>=9&&(R===80||R===112)){if(S.lastIntValue=-1,S.advance(),S.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(S)&&S.eat(125))return!0;S.raise("Invalid property name")}return!1};function se(S){return S===100||S===68||S===115||S===83||S===119||S===87}cr.regexp_eatUnicodePropertyValueExpression=function(S){var R=S.pos;if(this.regexp_eatUnicodePropertyName(S)&&S.eat(61)){var W=S.lastStringValue;if(this.regexp_eatUnicodePropertyValue(S)){var F=S.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(S,W,F),!0}}if(S.pos=R,this.regexp_eatLoneUnicodePropertyNameOrValue(S)){var ue=S.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(S,ue),!0}return!1},cr.regexp_validateUnicodePropertyNameAndValue=function(S,R,W){Ue(S.unicodeProperties.nonBinary,R)||S.raise("Invalid property name"),S.unicodeProperties.nonBinary[R].test(W)||S.raise("Invalid property value")},cr.regexp_validateUnicodePropertyNameOrValue=function(S,R){S.unicodeProperties.binary.test(R)||S.raise("Invalid property name")},cr.regexp_eatUnicodePropertyName=function(S){var R=0;for(S.lastStringValue="";Yi(R=S.current());)S.lastStringValue+=jr(R),S.advance();return S.lastStringValue!==""};function Yi(S){return ot(S)||S===95}cr.regexp_eatUnicodePropertyValue=function(S){var R=0;for(S.lastStringValue="";Fn(R=S.current());)S.lastStringValue+=jr(R),S.advance();return S.lastStringValue!==""};function Fn(S){return Yi(S)||ta(S)}cr.regexp_eatLoneUnicodePropertyNameOrValue=function(S){return this.regexp_eatUnicodePropertyValue(S)},cr.regexp_eatCharacterClass=function(S){if(S.eat(91)){if(S.eat(94),this.regexp_classRanges(S),S.eat(93))return!0;S.raise("Unterminated character class")}return!1},cr.regexp_classRanges=function(S){for(;this.regexp_eatClassAtom(S);){var R=S.lastIntValue;if(S.eat(45)&&this.regexp_eatClassAtom(S)){var W=S.lastIntValue;S.switchU&&(R===-1||W===-1)&&S.raise("Invalid character class"),R!==-1&&W!==-1&&R>W&&S.raise("Range out of order in character class")}}},cr.regexp_eatClassAtom=function(S){var R=S.pos;if(S.eat(92)){if(this.regexp_eatClassEscape(S))return!0;if(S.switchU){var W=S.current();(W===99||pa(W))&&S.raise("Invalid class escape"),S.raise("Invalid escape")}S.pos=R}var F=S.current();return F!==93?(S.lastIntValue=F,S.advance(),!0):!1},cr.regexp_eatClassEscape=function(S){var R=S.pos;if(S.eat(98))return S.lastIntValue=8,!0;if(S.switchU&&S.eat(45))return S.lastIntValue=45,!0;if(!S.switchU&&S.eat(99)){if(this.regexp_eatClassControlLetter(S))return!0;S.pos=R}return this.regexp_eatCharacterClassEscape(S)||this.regexp_eatCharacterEscape(S)},cr.regexp_eatClassControlLetter=function(S){var R=S.current();return ta(R)||R===95?(S.lastIntValue=R%32,S.advance(),!0):!1},cr.regexp_eatHexEscapeSequence=function(S){var R=S.pos;if(S.eat(120)){if(this.regexp_eatFixedHexDigits(S,2))return!0;S.switchU&&S.raise("Invalid escape"),S.pos=R}return!1},cr.regexp_eatDecimalDigits=function(S){var R=S.pos,W=0;for(S.lastIntValue=0;ta(W=S.current());)S.lastIntValue=10*S.lastIntValue+(W-48),S.advance();return S.pos!==R};function ta(S){return S>=48&&S<=57}cr.regexp_eatHexDigits=function(S){var R=S.pos,W=0;for(S.lastIntValue=0;$a(W=S.current());)S.lastIntValue=16*S.lastIntValue+ra(W),S.advance();return S.pos!==R};function $a(S){return S>=48&&S<=57||S>=65&&S<=70||S>=97&&S<=102}function ra(S){return S>=65&&S<=70?10+(S-65):S>=97&&S<=102?10+(S-97):S-48}cr.regexp_eatLegacyOctalEscapeSequence=function(S){if(this.regexp_eatOctalDigit(S)){var R=S.lastIntValue;if(this.regexp_eatOctalDigit(S)){var W=S.lastIntValue;R<=3&&this.regexp_eatOctalDigit(S)?S.lastIntValue=R*64+W*8+S.lastIntValue:S.lastIntValue=R*8+W}else S.lastIntValue=R;return!0}return!1},cr.regexp_eatOctalDigit=function(S){var R=S.current();return pa(R)?(S.lastIntValue=R-48,S.advance(),!0):(S.lastIntValue=0,!1)};function pa(S){return S>=48&&S<=55}cr.regexp_eatFixedHexDigits=function(S,R){var W=S.pos;S.lastIntValue=0;for(var F=0;F<R;++F){var ue=S.current();if(!$a(ue))return S.pos=W,!1;S.lastIntValue=16*S.lastIntValue+ra(ue),S.advance()}return!0};var Xi=function(R){this.type=R.type,this.value=R.value,this.start=R.start,this.end=R.end,R.options.locations&&(this.loc=new Xe(R,R.startLoc,R.endLoc)),R.options.ranges&&(this.range=[R.start,R.end])},Ui=Rt.prototype;Ui.next=function(S){!S&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Xi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Ui.getToken=function(){return this.next(),new Xi(this)},typeof Symbol!="undefined"&&(Ui[Symbol.iterator]=function(){var S=this;return{next:function(){var R=S.getToken();return{done:R.type===ne.eof,value:R}}}}),Ui.curContext=function(){return this.context[this.context.length-1]},Ui.nextToken=function(){var S=this.curContext();if((!S||!S.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(ne.eof);if(S.override)return S.override(this);this.readToken(this.fullCharCodeAtPos())},Ui.readToken=function(S){return Ft(S,this.options.ecmaVersion>=6)||S===92?this.readWord():this.getTokenFromCode(S)},Ui.fullCharCodeAtPos=function(){var S=this.input.charCodeAt(this.pos);if(S<=55295||S>=57344)return S;var R=this.input.charCodeAt(this.pos+1);return(S<<10)+R-56613888},Ui.skipBlockComment=function(){var S=this.options.onComment&&this.curPosition(),R=this.pos,W=this.input.indexOf("*/",this.pos+=2);if(W===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=W+2,this.options.locations){It.lastIndex=R;for(var F;(F=It.exec(this.input))&&F.index<this.pos;)++this.curLine,this.lineStart=F.index+F[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(R+2,W),R,this.pos,S,this.curPosition())},Ui.skipLineComment=function(S){for(var R=this.pos,W=this.options.onComment&&this.curPosition(),F=this.input.charCodeAt(this.pos+=S);this.pos<this.input.length&&!xt(F);)F=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(R+S,this.pos),R,this.pos,W,this.curPosition())},Ui.skipSpace=function(){e:for(;this.pos<this.input.length;){var S=this.input.charCodeAt(this.pos);switch(S){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(S>8&&S<14||S>=5760&&Jt.test(String.fromCharCode(S)))++this.pos;else break e}}},Ui.finishToken=function(S,R){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var W=this.type;this.type=S,this.value=R,this.updateContext(W)},Ui.readToken_dot=function(){var S=this.input.charCodeAt(this.pos+1);if(S>=48&&S<=57)return this.readNumber(!0);var R=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&S===46&&R===46?(this.pos+=3,this.finishToken(ne.ellipsis)):(++this.pos,this.finishToken(ne.dot))},Ui.readToken_slash=function(){var S=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):S===61?this.finishOp(ne.assign,2):this.finishOp(ne.slash,1)},Ui.readToken_mult_modulo_exp=function(S){var R=this.input.charCodeAt(this.pos+1),W=1,F=S===42?ne.star:ne.modulo;return this.options.ecmaVersion>=7&&S===42&&R===42&&(++W,F=ne.starstar,R=this.input.charCodeAt(this.pos+2)),R===61?this.finishOp(ne.assign,W+1):this.finishOp(F,W)},Ui.readToken_pipe_amp=function(S){var R=this.input.charCodeAt(this.pos+1);if(R===S){if(this.options.ecmaVersion>=12){var W=this.input.charCodeAt(this.pos+2);if(W===61)return this.finishOp(ne.assign,3)}return this.finishOp(S===124?ne.logicalOR:ne.logicalAND,2)}return R===61?this.finishOp(ne.assign,2):this.finishOp(S===124?ne.bitwiseOR:ne.bitwiseAND,1)},Ui.readToken_caret=function(){var S=this.input.charCodeAt(this.pos+1);return S===61?this.finishOp(ne.assign,2):this.finishOp(ne.bitwiseXOR,1)},Ui.readToken_plus_min=function(S){var R=this.input.charCodeAt(this.pos+1);return R===S?R===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||gr.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(ne.incDec,2):R===61?this.finishOp(ne.assign,2):this.finishOp(ne.plusMin,1)},Ui.readToken_lt_gt=function(S){var R=this.input.charCodeAt(this.pos+1),W=1;return R===S?(W=S===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+W)===61?this.finishOp(ne.assign,W+1):this.finishOp(ne.bitShift,W)):R===33&&S===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(R===61&&(W=2),this.finishOp(ne.relational,W))},Ui.readToken_eq_excl=function(S){var R=this.input.charCodeAt(this.pos+1);return R===61?this.finishOp(ne.equality,this.input.charCodeAt(this.pos+2)===61?3:2):S===61&&R===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(ne.arrow)):this.finishOp(S===61?ne.eq:ne.prefix,1)},Ui.readToken_question=function(){var S=this.options.ecmaVersion;if(S>=11){var R=this.input.charCodeAt(this.pos+1);if(R===46){var W=this.input.charCodeAt(this.pos+2);if(W<48||W>57)return this.finishOp(ne.questionDot,2)}if(R===63){if(S>=12){var F=this.input.charCodeAt(this.pos+2);if(F===61)return this.finishOp(ne.assign,3)}return this.finishOp(ne.coalesce,2)}}return this.finishOp(ne.question,1)},Ui.getTokenFromCode=function(S){switch(S){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(ne.parenL);case 41:return++this.pos,this.finishToken(ne.parenR);case 59:return++this.pos,this.finishToken(ne.semi);case 44:return++this.pos,this.finishToken(ne.comma);case 91:return++this.pos,this.finishToken(ne.bracketL);case 93:return++this.pos,this.finishToken(ne.bracketR);case 123:return++this.pos,this.finishToken(ne.braceL);case 125:return++this.pos,this.finishToken(ne.braceR);case 58:return++this.pos,this.finishToken(ne.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(ne.backQuote);case 48:var R=this.input.charCodeAt(this.pos+1);if(R===120||R===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(R===111||R===79)return this.readRadixNumber(8);if(R===98||R===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(S);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(S);case 124:case 38:return this.readToken_pipe_amp(S);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(S);case 60:case 62:return this.readToken_lt_gt(S);case 61:case 33:return this.readToken_eq_excl(S);case 63:return this.readToken_question();case 126:return this.finishOp(ne.prefix,1)}this.raise(this.pos,"Unexpected character '"+Za(S)+"'")},Ui.finishOp=function(S,R){var W=this.input.slice(this.pos,this.pos+R);return this.pos+=R,this.finishToken(S,W)},Ui.readRegexp=function(){for(var S,R,W=this.pos;;){this.pos>=this.input.length&&this.raise(W,"Unterminated regular expression");var F=this.input.charAt(this.pos);if(gr.test(F)&&this.raise(W,"Unterminated regular expression"),S)S=!1;else{if(F==="[")R=!0;else if(F==="]"&&R)R=!1;else if(F==="/"&&!R)break;S=F==="\\"}++this.pos}var ue=this.input.slice(W,this.pos);++this.pos;var De=this.pos,ft=this.readWord1();this.containsEsc&&this.unexpected(De);var Gt=this.regexpState||(this.regexpState=new dr(this));Gt.reset(W,ue,ft),this.validateRegExpFlags(Gt),this.validateRegExpPattern(Gt);var Wt=null;try{Wt=new RegExp(ue,ft)}catch(Or){}return this.finishToken(ne.regexp,{pattern:ue,flags:ft,value:Wt})},Ui.readInt=function(S,R,W){for(var F=this.options.ecmaVersion>=12&&R===void 0,ue=W&&this.input.charCodeAt(this.pos)===48,De=this.pos,ft=0,Gt=0,Wt=0,Or=R==null?Infinity:R;Wt<Or;++Wt,++this.pos){var en=this.input.charCodeAt(this.pos),ci=void 0;if(F&&en===95){ue&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Gt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Wt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Gt=en;continue}if(en>=97?ci=en-97+10:en>=65?ci=en-65+10:en>=48&&en<=57?ci=en-48:ci=Infinity,ci>=S)break;Gt=en,ft=ft*S+ci}return F&&Gt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===De||R!=null&&this.pos-De!==R?null:ft};function ma(S,R){return R?parseInt(S,8):parseFloat(S.replace(/_/g,""))}function bo(S){return typeof BigInt!="function"?null:BigInt(S.replace(/_/g,""))}Ui.readRadixNumber=function(S){var R=this.pos;this.pos+=2;var W=this.readInt(S);return W==null&&this.raise(this.start+2,"Expected number in radix "+S),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(W=bo(this.input.slice(R,this.pos)),++this.pos):Ft(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ne.num,W)},Ui.readNumber=function(S){var R=this.pos;!S&&this.readInt(10,void 0,!0)===null&&this.raise(R,"Invalid number");var W=this.pos-R>=2&&this.input.charCodeAt(R)===48;W&&this.strict&&this.raise(R,"Invalid number");var F=this.input.charCodeAt(this.pos);if(!W&&!S&&this.options.ecmaVersion>=11&&F===110){var ue=bo(this.input.slice(R,this.pos));return++this.pos,Ft(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ne.num,ue)}W&&/[89]/.test(this.input.slice(R,this.pos))&&(W=!1),F===46&&!W&&(++this.pos,this.readInt(10),F=this.input.charCodeAt(this.pos)),(F===69||F===101)&&!W&&(F=this.input.charCodeAt(++this.pos),(F===43||F===45)&&++this.pos,this.readInt(10)===null&&this.raise(R,"Invalid number")),Ft(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var De=ma(this.input.slice(R,this.pos),W);return this.finishToken(ne.num,De)},Ui.readCodePoint=function(){var S=this.input.charCodeAt(this.pos),R;if(S===123){this.options.ecmaVersion<6&&this.unexpected();var W=++this.pos;R=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,R>1114111&&this.invalidStringToken(W,"Code point out of bounds")}else R=this.readHexChar(4);return R};function Za(S){return S<=65535?String.fromCharCode(S):(S-=65536,String.fromCharCode((S>>10)+55296,(S&1023)+56320))}Ui.readString=function(S){for(var R="",W=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var F=this.input.charCodeAt(this.pos);if(F===S)break;F===92?(R+=this.input.slice(W,this.pos),R+=this.readEscapedChar(!1),W=this.pos):(xt(F,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return R+=this.input.slice(W,this.pos++),this.finishToken(ne.string,R)};var fa={};Ui.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(S){if(S===fa)this.readInvalidTemplateToken();else throw S}this.inTemplateElement=!1},Ui.invalidStringToken=function(S,R){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw fa;this.raise(S,R)},Ui.readTmplToken=function(){for(var S="",R=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var W=this.input.charCodeAt(this.pos);if(W===96||W===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===ne.template||this.type===ne.invalidTemplate)?W===36?(this.pos+=2,this.finishToken(ne.dollarBraceL)):(++this.pos,this.finishToken(ne.backQuote)):(S+=this.input.slice(R,this.pos),this.finishToken(ne.template,S));if(W===92)S+=this.input.slice(R,this.pos),S+=this.readEscapedChar(!0),R=this.pos;else if(xt(W)){switch(S+=this.input.slice(R,this.pos),++this.pos,W){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:S+=`
`;break;default:S+=String.fromCharCode(W);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),R=this.pos}else++this.pos}},Ui.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(ne.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Ui.readEscapedChar=function(S){var R=this.input.charCodeAt(++this.pos);switch(++this.pos,R){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Za(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(S){var W=this.pos-1;return this.invalidStringToken(W,"Invalid escape sequence in template string"),null}default:if(R>=48&&R<=55){var F=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],ue=parseInt(F,8);return ue>255&&(F=F.slice(0,-1),ue=parseInt(F,8)),this.pos+=F.length-1,R=this.input.charCodeAt(this.pos),(F!=="0"||R===56||R===57)&&(this.strict||S)&&this.invalidStringToken(this.pos-1-F.length,S?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(ue)}return xt(R)?"":String.fromCharCode(R)}},Ui.readHexChar=function(S){var R=this.pos,W=this.readInt(16,S);return W===null&&this.invalidStringToken(R,"Bad character escape sequence"),W},Ui.readWord1=function(){this.containsEsc=!1;for(var S="",R=!0,W=this.pos,F=this.options.ecmaVersion>=6;this.pos<this.input.length;){var ue=this.fullCharCodeAtPos();if(mr(ue,F))this.pos+=ue<=65535?1:2;else if(ue===92){this.containsEsc=!0,S+=this.input.slice(W,this.pos);var De=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var ft=this.readCodePoint();(R?Ft:mr)(ft,F)||this.invalidStringToken(De,"Invalid Unicode escape"),S+=Za(ft),W=this.pos}else break;R=!1}return S+this.input.slice(W,this.pos)},Ui.readWord=function(){var S=this.readWord1(),R=ne.name;return this.keywords.test(S)&&(R=Pt[S]),this.finishToken(R,S)};var na="7.4.1";Rt.acorn={Parser:Rt,version:na,defaultOptions:yt,Position:de,SourceLocation:Xe,getLineInfo:lt,Node:Si,TokenType:jt,tokTypes:ne,keywordTypes:Pt,TokContext:Io,tokContexts:to,isIdentifierChar:mr,isIdentifierStart:Ft,Token:Xi,isNewLine:xt,lineBreak:gr,lineBreakG:It,nonASCIIwhitespace:Jt};function To(S,R){return Rt.parse(S,R)}function Ou(S,R,W){return Rt.parseExpressionAt(S,R,W)}function ko(S,R){return Rt.tokenizer(S,R)}function ao(S,R){S.prototype=Object.create(R.prototype),S.prototype.constructor=S,S.__proto__=R}function iu(S){var R=typeof Map=="function"?new Map:void 0;return iu=function(F){if(F===null||!zl(F))return F;if(typeof F!="function")throw new TypeError("Super expression must either be null or a function");if(typeof R!="undefined"){if(R.has(F))return R.get(F);R.set(F,ue)}function ue(){return Ua(F,arguments,Eo(this).constructor)}return ue.prototype=Object.create(F.prototype,{constructor:{value:ue,enumerable:!1,writable:!0,configurable:!0}}),Xo(ue,F)},iu(S)}function au(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(S){return!1}}function Ua(S,R,W){return au()?Ua=Reflect.construct:Ua=function(ue,De,ft){var Gt=[null];Gt.push.apply(Gt,De);var Wt=Function.bind.apply(ue,Gt),Or=new Wt;return ft&&Xo(Or,ft.prototype),Or},Ua.apply(null,arguments)}function zl(S){return Function.toString.call(S).indexOf("[native code]")!==-1}function Xo(S,R){return Xo=Object.setPrototypeOf||function(F,ue){return F.__proto__=ue,F},Xo(S,R)}function Eo(S){return Eo=Object.setPrototypeOf?Object.getPrototypeOf:function(W){return W.__proto__||Object.getPrototypeOf(W)},Eo(S)}var jo=function(S){ao(R,S);function R(){return S.apply(this,arguments)||this}return R}(iu(Error)),Va=function(S){ao(R,S);function R(){return S.apply(this,arguments)||this}return R}(iu(SyntaxError)),vs=function(S){ao(R,S);function R(){return S.apply(this,arguments)||this}return R}(iu(ReferenceError)),Hs=function(S){ao(R,S);function R(){return S.apply(this,arguments)||this}return R}(iu(TypeError)),Ml=function(S){ao(R,S);function R(){return S.apply(this,arguments)||this}return R}(jo),ms=function(S){ao(R,S);function R(){return S.apply(this,arguments)||this}return R}(Va),Bs=function(S){ao(R,S);function R(){return S.apply(this,arguments)||this}return R}(vs),Da={UnknownError:[3001,"%0",Ml],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Ml],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Bs],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Bs],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Bs],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Bs],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Bs],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Bs],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Bs],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Bs],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Bs],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Bs],FunctionUndefinedReferenceError:[2001,"%0 is not a function",vs],VariableUndefinedReferenceError:[2002,"%0 is not defined",vs],IsNotConstructor:[2003,"%0 is not a constructor",Hs]};function $o(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(S){return!1}}function Ys(S,R,W){return $o()?Ys=Reflect.construct:Ys=function(ue,De,ft){var Gt=[null];Gt.push.apply(Gt,De);var Wt=Function.bind.apply(ue,Gt),Or=new Wt;return ft&&Ht(Or,ft.prototype),Or},Ys.apply(null,arguments)}function Ht(S,R){return Ht=Object.setPrototypeOf||function(F,ue){return F.__proto__=ue,F},Ht(S,R)}var tr="0.0.3";function J(S,R){Object.defineProperty(S,"name",{value:R,writable:!1,enumerable:!1,configurable:!0})}var Cu=Object.prototype.hasOwnProperty,_e=Symbol("Break"),Ne=Symbol("Continue"),wt=Symbol("DefaultCase"),ur=Symbol("EmptyStatementReturn"),gn=Symbol("WithScopeName"),li=Symbol("SuperScopeName"),da=Symbol("RootScopeName"),es=Symbol("GlobalScopeName");function Fr(S){return typeof S=="function"}var Nr=function(){function S(W){this.interpreter=W}var R=S.prototype;return R.generator=function(){var F=this.interpreter;function ue(){return this.getCurrentScope()}function De(){return this.getGlobalScope()}function ft(){return this.getCurrentContext()}return{getOptions:F.getOptions.bind(F),getCurrentScope:ue.bind(F),getGlobalScope:De.bind(F),getCurrentContext:ft.bind(F),getExecStartTime:F.getExecStartTime.bind(F)}},S}();function it(S,R,W){if(W===void 0&&(W=!0),!(S instanceof Nr))throw new Error("Illegal call");if(typeof R!="string")return R;if(!!R){var F=S.generator(),ue=F.getOptions(),De={timeout:ue.timeout,_initEnv:function(){W||this.setCurrentContext(F.getCurrentContext()),this.execStartTime=F.getExecStartTime(),this.execEndTime=this.execStartTime}},ft=W?F.getGlobalScope():F.getCurrentScope(),Gt=new xa(ft,De);return Gt.evaluate(R)}}Object.defineProperty(it,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function gu(S){if(!(S instanceof Nr))throw new Error("Illegal call");for(var R=S.generator(),W=arguments.length,F=new Array(W>1?W-1:0),ue=1;ue<W;ue++)F[ue-1]=arguments[ue];var De=F.pop(),ft=new xa(R.getGlobalScope(),R.getOptions()),Gt=`
		    (function anonymous(`+F.join(",")+`){
		        `+De+`
		    });
		    `;return ft.evaluate(Gt)}Object.defineProperty(gu,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var qs=function(R){this.value=R},Tu=function(R){this.value=R},Ns=function(R){this.value=R},yu=function(R,W,F){W===void 0&&(W=null),this.name=F,this.parent=W,this.data=R,this.labelStack=[]};function _u(){}function Ju(S,R){return S===void 0&&(S=null),new yu(Object.create(null),S,R)}function Mu(S){return Object.create(S)}var lo={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:it,Function:gu};typeof JSON!="undefined"&&(lo.JSON=JSON),typeof Promise!="undefined"&&(lo.Promise=Promise),typeof Set!="undefined"&&(lo.Set=Set),typeof Map!="undefined"&&(lo.Map=Map),typeof Symbol!="undefined"&&(lo.Symbol=Symbol),typeof Proxy!="undefined"&&(lo.Proxy=Proxy),typeof WeakMap!="undefined"&&(lo.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(lo.WeakSet=WeakSet),typeof Reflect!="undefined"&&(lo.Reflect=Reflect);var xa=function(){function S(W,F){W===void 0&&(W=S.global),F===void 0&&(F={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:F.ecmaVersion||S.ecmaVersion,timeout:F.timeout||0,rootContext:F.rootContext,globalContextInFunction:F.globalContextInFunction===void 0?S.globalContextInFunction:F.globalContextInFunction,_initEnv:F._initEnv},this.context=W||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var R=S.prototype;return R.initEnvironment=function(F){var ue;if(F instanceof yu)ue=F;else{var De=null,ft=this.createSuperScope(F);this.options.rootContext&&(De=new yu(Mu(this.options.rootContext),ft,da)),ue=new yu(F,De||ft,es)}this.globalScope=ue,this.currentScope=this.globalScope,this.globalContext=ue.data,this.currentContext=ue.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Gt=this.options._initEnv;Gt&&Gt.call(this)},R.getExecStartTime=function(){return this.execStartTime},R.getExecutionTime=function(){return this.execEndTime-this.execStartTime},R.setExecTimeout=function(F){F===void 0&&(F=0),this.options.timeout=F},R.getOptions=function(){return this.options},R.getGlobalScope=function(){return this.globalScope},R.getCurrentScope=function(){return this.currentScope},R.getCurrentContext=function(){return this.currentContext},R.isInterruptThrow=function(F){return F instanceof Ml||F instanceof Bs||F instanceof ms},R.createSuperScope=function(F){var ue=Object.assign({},lo),De=Object.keys(ue);return De.forEach(function(ft){ft in F&&delete ue[ft]}),new yu(ue,null,li)},R.setCurrentContext=function(F){this.currentContext=F},R.setCurrentScope=function(F){this.currentScope=F},R.evaluate=function(F){F===void 0&&(F="");var ue;if(!!F)return ue=To(F,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||S.ecmaVersion}),this.evaluateNode(ue,F)},R.appendCode=function(F){return this.evaluate(F)},R.evaluateNode=function(F,ue){var De=this;ue===void 0&&(ue=""),this.value=void 0,this.source=ue,this.sourceList.push(ue),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var ft=this.getCurrentScope(),Gt=this.getCurrentContext(),Wt=ft.labelStack.concat([]),Or=this.callStack.concat([]),en=function(){De.setCurrentScope(ft),De.setCurrentContext(Gt),ft.labelStack=Wt,De.callStack=Or};try{var ci=this.createClosure(F);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),ci()}catch(Gi){throw Gi}finally{en(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},R.createErrorMessage=function(F,ue,De){var ft=F[1].replace("%0",String(ue));return De!==null&&(ft+=this.getNodePosition(De||this.lastExecNode)),ft},R.createError=function(F,ue){return new ue(F)},R.createThrowError=function(F,ue){return this.createError(F,ue)},R.createInternalThrowError=function(F,ue,De){return this.createError(this.createErrorMessage(F,ue,De),F[2])},R.checkTimeout=function(){if(!this.isRunning)return!1;var F=this.options.timeout||0,ue=Date.now();return ue-this.execStartTime>F},R.getNodePosition=function(F){if(F){var ue="";return F.loc?" ["+F.loc.start.line+":"+F.loc.start.column+"]"+ue:""}return""},R.createClosure=function(F){var ue=this,De;switch(F.type){case"BinaryExpression":De=this.binaryExpressionHandler(F);break;case"LogicalExpression":De=this.logicalExpressionHandler(F);break;case"UnaryExpression":De=this.unaryExpressionHandler(F);break;case"UpdateExpression":De=this.updateExpressionHandler(F);break;case"ObjectExpression":De=this.objectExpressionHandler(F);break;case"ArrayExpression":De=this.arrayExpressionHandler(F);break;case"CallExpression":De=this.callExpressionHandler(F);break;case"NewExpression":De=this.newExpressionHandler(F);break;case"MemberExpression":De=this.memberExpressionHandler(F);break;case"ThisExpression":De=this.thisExpressionHandler(F);break;case"SequenceExpression":De=this.sequenceExpressionHandler(F);break;case"Literal":De=this.literalHandler(F);break;case"Identifier":De=this.identifierHandler(F);break;case"AssignmentExpression":De=this.assignmentExpressionHandler(F);break;case"FunctionDeclaration":De=this.functionDeclarationHandler(F);break;case"VariableDeclaration":De=this.variableDeclarationHandler(F);break;case"BlockStatement":case"Program":De=this.programHandler(F);break;case"ExpressionStatement":De=this.expressionStatementHandler(F);break;case"EmptyStatement":De=this.emptyStatementHandler(F);break;case"ReturnStatement":De=this.returnStatementHandler(F);break;case"FunctionExpression":De=this.functionExpressionHandler(F);break;case"IfStatement":De=this.ifStatementHandler(F);break;case"ConditionalExpression":De=this.conditionalExpressionHandler(F);break;case"ForStatement":De=this.forStatementHandler(F);break;case"WhileStatement":De=this.whileStatementHandler(F);break;case"DoWhileStatement":De=this.doWhileStatementHandler(F);break;case"ForInStatement":De=this.forInStatementHandler(F);break;case"WithStatement":De=this.withStatementHandler(F);break;case"ThrowStatement":De=this.throwStatementHandler(F);break;case"TryStatement":De=this.tryStatementHandler(F);break;case"ContinueStatement":De=this.continueStatementHandler(F);break;case"BreakStatement":De=this.breakStatementHandler(F);break;case"SwitchStatement":De=this.switchStatementHandler(F);break;case"LabeledStatement":De=this.labeledStatementHandler(F);break;case"DebuggerStatement":De=this.debuggerStatementHandler(F);break;default:throw this.createInternalThrowError(Da.NodeTypeSyntaxError,F.type,F)}return function(){var ft=ue.options.timeout;if(ft&&ft>0&&ue.checkTimeout())throw ue.createInternalThrowError(Da.ExecutionTimeOutError,ft,null);return ue.lastExecNode=F,De.apply(void 0,arguments)}},R.binaryExpressionHandler=function(F){var ue=this,De=this.createClosure(F.left),ft=this.createClosure(F.right);return function(){var Gt=De(),Wt=ft();switch(F.operator){case"==":return Gt==Wt;case"!=":return Gt!=Wt;case"===":return Gt===Wt;case"!==":return Gt!==Wt;case"<":return Gt<Wt;case"<=":return Gt<=Wt;case">":return Gt>Wt;case">=":return Gt>=Wt;case"<<":return Gt<<Wt;case">>":return Gt>>Wt;case">>>":return Gt>>>Wt;case"+":return Gt+Wt;case"-":return Gt-Wt;case"*":return Gt*Wt;case"**":return Math.pow(Gt,Wt);case"/":return Gt/Wt;case"%":return Gt%Wt;case"|":return Gt|Wt;case"^":return Gt^Wt;case"&":return Gt&Wt;case"in":return Gt in Wt;case"instanceof":return Gt instanceof Wt;default:throw ue.createInternalThrowError(Da.BinaryOperatorSyntaxError,F.operator,F)}}},R.logicalExpressionHandler=function(F){var ue=this,De=this.createClosure(F.left),ft=this.createClosure(F.right);return function(){switch(F.operator){case"||":return De()||ft();case"&&":return De()&&ft();default:throw ue.createInternalThrowError(Da.LogicalOperatorSyntaxError,F.operator,F)}}},R.unaryExpressionHandler=function(F){var ue=this;switch(F.operator){case"delete":var De=this.createObjectGetter(F.argument),ft=this.createNameGetter(F.argument);return function(){var en=De(),ci=ft();return delete en[ci]};default:var Gt;if(F.operator==="typeof"&&F.argument.type==="Identifier"){var Wt=this.createObjectGetter(F.argument),Or=this.createNameGetter(F.argument);Gt=function(){return Wt()[Or()]}}else Gt=this.createClosure(F.argument);return function(){var en=Gt();switch(F.operator){case"-":return-en;case"+":return+en;case"!":return!en;case"~":return~en;case"void":return;case"typeof":return typeof en;default:throw ue.createInternalThrowError(Da.UnaryOperatorSyntaxError,F.operator,F)}}}},R.updateExpressionHandler=function(F){var ue=this,De=this.createObjectGetter(F.argument),ft=this.createNameGetter(F.argument);return function(){var Gt=De(),Wt=ft();switch(ue.assertVariable(Gt,Wt,F),F.operator){case"++":return F.prefix?++Gt[Wt]:Gt[Wt]++;case"--":return F.prefix?--Gt[Wt]:Gt[Wt]--;default:throw ue.createInternalThrowError(Da.UpdateOperatorSyntaxError,F.operator,F)}}},R.objectExpressionHandler=function(F){var ue=this,De=[];function ft(Wt){return Wt.type==="Identifier"?Wt.name:Wt.type==="Literal"?Wt.value:this.throwError(Da.ObjectStructureSyntaxError,Wt.type,Wt)}var Gt=Object.create(null);return F.properties.forEach(function(Wt){var Or=Wt.kind,en=ft(Wt.key);(!Gt[en]||Or==="init")&&(Gt[en]={}),Gt[en][Or]=ue.createClosure(Wt.value),De.push({key:en,property:Wt})}),function(){for(var Wt={},Or=De.length,en=0;en<Or;en++){var ci=De[en],Gi=ci.key,vi=Gt[Gi],ka=vi.init?vi.init():void 0,ha=vi.get?vi.get():function(){},So=vi.set?vi.set():function(hl){};if("set"in vi||"get"in vi){var Sa={configurable:!0,enumerable:!0,get:ha,set:So};Object.defineProperty(Wt,Gi,Sa)}else{var Ho=ci.property,xu=Ho.kind;Ho.key.type==="Identifier"&&Ho.value.type==="FunctionExpression"&&xu==="init"&&!Ho.value.id&&J(ka,Ho.key.name),Wt[Gi]=ka}}return Wt}},R.arrayExpressionHandler=function(F){var ue=this,De=F.elements.map(function(ft){return ft&&ue.createClosure(ft)});return function(){for(var ft=De.length,Gt=Array(ft),Wt=0;Wt<ft;Wt++){var Or=De[Wt];Or&&(Gt[Wt]=Or())}return Gt}},R.safeObjectGet=function(F,ue,De){return F[ue]},R.createCallFunctionGetter=function(F){var ue=this;switch(F.type){case"MemberExpression":var De=this.createClosure(F.object),ft=this.createMemberKeyGetter(F),Gt=this.source;return function(){var Or=De(),en=ft(),ci=ue.safeObjectGet(Or,en,F);if(!ci||!Fr(ci)){var Gi=Gt.slice(F.start,F.end);throw ue.createInternalThrowError(Da.FunctionUndefinedReferenceError,Gi,F)}return ci.__IS_EVAL_FUNC?function(vi){return ci(new Nr(ue),vi,!0)}:ci.__IS_FUNCTION_FUNC?function(){for(var vi=arguments.length,ka=new Array(vi),ha=0;ha<vi;ha++)ka[ha]=arguments[ha];return ci.apply(void 0,[new Nr(ue)].concat(ka))}:ci.bind(Or)};default:var Wt=this.createClosure(F);return function(){var Or="";F.type==="Identifier"&&(Or=F.name);var en=Wt();if(!en||!Fr(en))throw ue.createInternalThrowError(Da.FunctionUndefinedReferenceError,Or,F);if(F.type==="Identifier"&&en.__IS_EVAL_FUNC&&Or==="eval")return function(vi){var ka=ue.getScopeFromName(Or,ue.getCurrentScope()),ha=ka.name===li||ka.name===es||ka.name===da;return en(new Nr(ue),vi,!ha)};if(en.__IS_EVAL_FUNC)return function(vi){return en(new Nr(ue),vi,!0)};if(en.__IS_FUNCTION_FUNC)return function(){for(var vi=arguments.length,ka=new Array(vi),ha=0;ha<vi;ha++)ka[ha]=arguments[ha];return en.apply(void 0,[new Nr(ue)].concat(ka))};var ci=ue.options.globalContextInFunction;if(F.type==="Identifier"){var Gi=ue.getIdentifierScope(F);Gi.name===gn&&(ci=Gi.data)}return en.bind(ci)}}},R.callExpressionHandler=function(F){var ue=this,De=this.createCallFunctionGetter(F.callee),ft=F.arguments.map(function(Gt){return ue.createClosure(Gt)});return function(){return De().apply(void 0,ft.map(function(Gt){return Gt()}))}},R.functionExpressionHandler=function(F){var ue=this,De=this,ft=this.source,Gt=this.collectDeclVars,Wt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Or=F.id?F.id.name:"",en=F.params.length,ci=F.params.map(function(ha){return ue.createParamNameGetter(ha)}),Gi=this.createClosure(F.body),vi=this.collectDeclVars,ka=this.collectDeclFuncs;return this.collectDeclVars=Gt,this.collectDeclFuncs=Wt,function(){var ha=De.getCurrentScope(),So=function Sa(){for(var Ho=arguments.length,xu=new Array(Ho),hl=0;hl<Ho;hl++)xu[hl]=arguments[hl];De.callStack.push(""+Or);var No=De.getCurrentScope(),Iu=Ju(ha,"FunctionScope("+Or+")");De.setCurrentScope(Iu),De.addDeclarationsToScope(vi,ka,Iu),Or&&(Iu.data[Or]=Sa),Iu.data.arguments=arguments,ci.forEach(function(kl,Kl){Iu.data[kl()]=xu[Kl]});var ef=De.getCurrentContext();De.setCurrentContext(this);var ql=Gi();if(De.setCurrentContext(ef),De.setCurrentScope(No),De.callStack.pop(),ql instanceof qs)return ql.value};return J(So,Or),Object.defineProperty(So,"length",{value:en,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(So,"toString",{value:function(){return ft.slice(F.start,F.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(So,"valueOf",{value:function(){return ft.slice(F.start,F.end)},writable:!0,configurable:!0,enumerable:!1}),So}},R.newExpressionHandler=function(F){var ue=this,De=this.source,ft=this.createClosure(F.callee),Gt=F.arguments.map(function(Wt){return ue.createClosure(Wt)});return function(){var Wt=ft();if(!Fr(Wt)||Wt.__IS_EVAL_FUNC){var Or=F.callee,en=De.slice(Or.start,Or.end);throw ue.createInternalThrowError(Da.IsNotConstructor,en,F)}return Wt.__IS_FUNCTION_FUNC?Wt.apply(void 0,[new Nr(ue)].concat(Gt.map(function(ci){return ci()}))):Ys(Wt,Gt.map(function(ci){return ci()}))}},R.memberExpressionHandler=function(F){var ue=this.createClosure(F.object),De=this.createMemberKeyGetter(F);return function(){var ft=ue(),Gt=De();return ft[Gt]}},R.thisExpressionHandler=function(F){var ue=this;return function(){return ue.getCurrentContext()}},R.sequenceExpressionHandler=function(F){var ue=this,De=F.expressions.map(function(ft){return ue.createClosure(ft)});return function(){for(var ft,Gt=De.length,Wt=0;Wt<Gt;Wt++){var Or=De[Wt];ft=Or()}return ft}},R.literalHandler=function(F){return function(){return F.regex?new RegExp(F.regex.pattern,F.regex.flags):F.value}},R.identifierHandler=function(F){var ue=this;return function(){var De=ue.getCurrentScope(),ft=ue.getScopeDataFromName(F.name,De);return ue.assertVariable(ft,F.name,F),ft[F.name]}},R.getIdentifierScope=function(F){var ue=this.getCurrentScope(),De=this.getScopeFromName(F.name,ue);return De},R.assignmentExpressionHandler=function(F){var ue=this;F.left.type==="Identifier"&&F.right.type==="FunctionExpression"&&!F.right.id&&(F.right.id={type:"Identifier",name:F.left.name});var De=this.createObjectGetter(F.left),ft=this.createNameGetter(F.left),Gt=this.createClosure(F.right);return function(){var Wt=De(),Or=ft(),en=Gt();switch(F.operator!=="="&&ue.assertVariable(Wt,Or,F),F.operator){case"=":return Wt[Or]=en;case"+=":return Wt[Or]+=en;case"-=":return Wt[Or]-=en;case"*=":return Wt[Or]*=en;case"**=":return Wt[Or]=Math.pow(Wt[Or],en);case"/=":return Wt[Or]/=en;case"%=":return Wt[Or]%=en;case"<<=":return Wt[Or]<<=en;case">>=":return Wt[Or]>>=en;case">>>=":return Wt[Or]>>>=en;case"&=":return Wt[Or]&=en;case"^=":return Wt[Or]^=en;case"|=":return Wt[Or]|=en;default:throw ue.createInternalThrowError(Da.AssignmentExpressionSyntaxError,F.type,F)}}},R.functionDeclarationHandler=function(F){if(F.id){var ue=this.functionExpressionHandler(F);Object.defineProperty(ue,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(F.id.name,ue)}return function(){return ur}},R.getVariableName=function(F){if(F.type==="Identifier")return F.name;throw this.createInternalThrowError(Da.VariableTypeSyntaxError,F.type,F)},R.variableDeclarationHandler=function(F){for(var ue=this,De,ft=[],Gt=0;Gt<F.declarations.length;Gt++){var Wt=F.declarations[Gt];this.varDeclaration(this.getVariableName(Wt.id)),Wt.init&&ft.push({type:"AssignmentExpression",operator:"=",left:Wt.id,right:Wt.init})}return ft.length&&(De=this.createClosure({type:"BlockStatement",body:ft})),function(){if(De){var Or=ue.isVarDeclMode;ue.isVarDeclMode=!0,De(),ue.isVarDeclMode=Or}return ur}},R.assertVariable=function(F,ue,De){if(F===this.globalScope.data&&!(ue in F))throw this.createInternalThrowError(Da.VariableUndefinedReferenceError,ue,De)},R.programHandler=function(F){var ue=this,De=F.body.map(function(ft){return ue.createClosure(ft)});return function(){for(var ft=ur,Gt=0;Gt<De.length;Gt++){var Wt=De[Gt],Or=ue.setValue(Wt());if(Or!==ur&&(ft=Or,ft instanceof qs||ft instanceof Tu||ft instanceof Ns||ft===_e||ft===Ne))break}return ft}},R.expressionStatementHandler=function(F){return this.createClosure(F.expression)},R.emptyStatementHandler=function(F){return function(){return ur}},R.returnStatementHandler=function(F){var ue=F.argument?this.createClosure(F.argument):_u;return function(){return new qs(ue())}},R.ifStatementHandler=function(F){var ue=this.createClosure(F.test),De=this.createClosure(F.consequent),ft=F.alternate?this.createClosure(F.alternate):function(){return ur};return function(){return ue()?De():ft()}},R.conditionalExpressionHandler=function(F){return this.ifStatementHandler(F)},R.forStatementHandler=function(F){var ue=this,De=_u,ft=F.test?this.createClosure(F.test):function(){return!0},Gt=_u,Wt=this.createClosure(F.body);return F.type==="ForStatement"&&(De=F.init?this.createClosure(F.init):De,Gt=F.update?this.createClosure(F.update):_u),function(Or){var en,ci=ur,Gi=F.type==="DoWhileStatement";for(Or&&Or.type==="LabeledStatement"&&(en=Or.label.name),De();Gi||ft();Gt()){Gi=!1;var vi=ue.setValue(Wt());if(!(vi===ur||vi===Ne)){if(vi===_e)break;if(ci=vi,ci instanceof Ns&&ci.value===en){ci=ur;continue}if(ci instanceof qs||ci instanceof Tu||ci instanceof Ns)break}}return ci}},R.whileStatementHandler=function(F){return this.forStatementHandler(F)},R.doWhileStatementHandler=function(F){return this.forStatementHandler(F)},R.forInStatementHandler=function(F){var ue=this,De=F.left,ft=this.createClosure(F.right),Gt=this.createClosure(F.body);return F.left.type==="VariableDeclaration"&&(this.createClosure(F.left)(),De=F.left.declarations[0].id),function(Wt){var Or,en=ur,ci;Wt&&Wt.type==="LabeledStatement"&&(Or=Wt.label.name);var Gi=ft();for(ci in Gi){ue.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:De,right:{type:"Literal",value:ci}})();var vi=ue.setValue(Gt());if(!(vi===ur||vi===Ne)){if(vi===_e)break;if(en=vi,en instanceof Ns&&en.value===Or){en=ur;continue}if(en instanceof qs||en instanceof Tu||en instanceof Ns)break}}return en}},R.withStatementHandler=function(F){var ue=this,De=this.createClosure(F.object),ft=this.createClosure(F.body);return function(){var Gt=De(),Wt=ue.getCurrentScope(),Or=new yu(Gt,Wt,gn);ue.setCurrentScope(Or);var en=ue.setValue(ft());return ue.setCurrentScope(Wt),en}},R.throwStatementHandler=function(F){var ue=this,De=this.createClosure(F.argument);return function(){throw ue.setValue(void 0),De()}},R.tryStatementHandler=function(F){var ue=this,De=this.createClosure(F.block),ft=F.handler?this.catchClauseHandler(F.handler):null,Gt=F.finalizer?this.createClosure(F.finalizer):null;return function(){var Wt=ue.getCurrentScope(),Or=ue.getCurrentContext(),en=Wt.labelStack.concat([]),ci=ue.callStack.concat([]),Gi=ur,vi,ka,ha=function(){ue.setCurrentScope(Wt),ue.setCurrentContext(Or),Wt.labelStack=en,ue.callStack=ci};try{Gi=ue.setValue(De()),Gi instanceof qs&&(vi=Gi)}catch(So){if(ha(),ue.isInterruptThrow(So))throw So;if(ft)try{Gi=ue.setValue(ft(So)),Gi instanceof qs&&(vi=Gi)}catch(Sa){if(ha(),ue.isInterruptThrow(Sa))throw Sa;ka=Sa}}if(Gt)try{Gi=Gt(),Gi instanceof qs&&(vi=Gi)}catch(So){if(ha(),ue.isInterruptThrow(So))throw So;ka=So}if(ka)throw ka;return vi||Gi}},R.catchClauseHandler=function(F){var ue=this,De=this.createParamNameGetter(F.param),ft=this.createClosure(F.body);return function(Gt){var Wt,Or=ue.getCurrentScope(),en=Or.data,ci=De(),Gi=Cu.call(en,ci),vi=en[ci];return en[ci]=Gt,Wt=ft(),Gi?en[ci]=vi:delete en[ci],Wt}},R.continueStatementHandler=function(F){return function(){return F.label?new Ns(F.label.name):Ne}},R.breakStatementHandler=function(F){return function(){return F.label?new Tu(F.label.name):_e}},R.switchStatementHandler=function(F){var ue=this,De=this.createClosure(F.discriminant),ft=F.cases.map(function(Gt){return ue.switchCaseHandler(Gt)});return function(){for(var Gt=De(),Wt=!1,Or,en,ci,Gi=0;Gi<ft.length;Gi++){var vi=ft[Gi](),ka=vi.testClosure();if(ka===wt){ci=vi;continue}if(Wt||ka===Gt){if(Wt=!0,en=ue.setValue(vi.bodyClosure()),en===ur)continue;if(en===_e||(Or=en,Or instanceof qs||Or instanceof Tu||Or instanceof Ns||Or===Ne))break}}if(!Wt&&ci){en=ue.setValue(ci.bodyClosure());var ha=en===ur||en===_e||en===Ne;ha||(Or=en)}return Or}},R.switchCaseHandler=function(F){var ue=F.test?this.createClosure(F.test):function(){return wt},De=this.createClosure({type:"BlockStatement",body:F.consequent});return function(){return{testClosure:ue,bodyClosure:De}}},R.labeledStatementHandler=function(F){var ue=this,De=F.label.name,ft=this.createClosure(F.body);return function(){var Gt,Wt=ue.getCurrentScope();return Wt.labelStack.push(De),Gt=ft(F),Gt instanceof Tu&&Gt.value===De&&(Gt=ur),Wt.labelStack.pop(),Gt}},R.debuggerStatementHandler=function(F){return function(){debugger;return ur}},R.createParamNameGetter=function(F){if(F.type==="Identifier")return function(){return F.name};throw this.createInternalThrowError(Da.ParamTypeSyntaxError,F.type,F)},R.createObjectKeyGetter=function(F){var ue;return F.type==="Identifier"?ue=function(){return F.name}:ue=this.createClosure(F),function(){return ue()}},R.createMemberKeyGetter=function(F){return F.computed?this.createClosure(F.property):this.createObjectKeyGetter(F.property)},R.createObjectGetter=function(F){var ue=this;switch(F.type){case"Identifier":return function(){return ue.getScopeDataFromName(F.name,ue.getCurrentScope())};case"MemberExpression":return this.createClosure(F.object);default:throw this.createInternalThrowError(Da.AssignmentTypeSyntaxError,F.type,F)}},R.createNameGetter=function(F){switch(F.type){case"Identifier":return function(){return F.name};case"MemberExpression":return this.createMemberKeyGetter(F);default:throw this.createInternalThrowError(Da.AssignmentTypeSyntaxError,F.type,F)}},R.varDeclaration=function(F){var ue=this.collectDeclVars;ue[F]=void 0},R.funcDeclaration=function(F,ue){var De=this.collectDeclFuncs;De[F]=ue},R.addDeclarationsToScope=function(F,ue,De){var ft=De.data;for(var Gt in ue){var Wt=ue[Gt];ft[Gt]=Wt&&Wt()}for(var Or in F)Or in ft||(ft[Or]=void 0)},R.getScopeValue=function(F,ue){var De=this.getScopeFromName(F,ue);return De.data[F]},R.getScopeDataFromName=function(F,ue){return this.getScopeFromName(F,ue).data},R.getScopeFromName=function(F,ue){var De=ue;do if(F in De.data)return De;while(De=De.parent);return this.globalScope},R.setValue=function(F){var ue=this.callStack.length;return this.isVarDeclMode||ue||F===ur||F===_e||F===Ne||F instanceof Tu||F instanceof Ns||(this.value=F instanceof qs?F.value:F),F},R.getValue=function(){return this.value},S}();xa.version=tr,xa.eval=it,xa.Function=gu,xa.ecmaVersion=5,xa.globalContextInFunction=void 0,xa.global=Object.create(null);function mo(S){return S===void 0&&(S=Object.create(null)),S}function Wf(S,R,W){R===void 0&&(R=[]),W===void 0&&(W={});var F=W.parsingContext,ue=W.timeout===void 0?0:W.timeout,De=`
    (function anonymous(`+R.join(",")+`){
         `+S+`
    });
    `,ft=new xa(F,{ecmaVersion:W.ecmaVersion,timeout:ue,rootContext:W.rootContext,globalContextInFunction:W.globalContextInFunction});return ft.evaluate(De)}function Ks(S,R,W){var F=new xa(R,W);return F.evaluate(S)}var Xf=Ks,Jc=function(){function S(W){this._code=W}var R=S.prototype;return R.runInContext=function(F){return Ks(this._code,F)},R.runInNewContext=function(F){return Ks(this._code,F)},S}(),Il=function(S,R,W){return Ks(S,R,W)};function Ke(){for(var S=arguments.length,R=new Array(S),W=0;W<S;W++)R[W]=arguments[W];var F=R.pop();return Wf(F||"",R)}var Rc=Il},20396:function(Yr,ge,ie){var Oe;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(Z,_,Pe,K){"use strict";var xe=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ve=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),tt=xe||ve,Ae=["","webkit","Moz","MS","ms","o"],at=tt?"":_.createElement("div"),gt="function",Mt=Math.round,Ft=Math.abs,mr=Date.now;function jt(_e,Ne,wt){return setTimeout(It(_e,wt),Ne)}function hr(_e,Ne,wt){return Array.isArray(_e)?(qt(_e,wt[Ne],wt),!0):!1}function qt(_e,Ne,wt){var ur;if(!!_e)if(_e.forEach)_e.forEach(Ne,wt);else if(_e.length!==K)for(ur=0;ur<_e.length;)Ne.call(wt,_e[ur],ur,_e),ur++;else for(ur in _e)_e.hasOwnProperty(ur)&&Ne.call(wt,_e[ur],ur,_e)}function Dt(_e,Ne,wt){var ur="DEPRECATED METHOD: "+Ne+`
`+wt+` AT 
`;return function(){var gn=new Error("get-stack-trace"),li=gn&&gn.stack?gn.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",da=Z.console&&(Z.console.warn||Z.console.log);return da&&da.call(Z.console,ur,li),_e.apply(this,arguments)}}var Pt;typeof Object.assign!="function"?Pt=function(Ne){if(Ne===K||Ne===null)throw new TypeError("Cannot convert undefined or null to object");for(var wt=Object(Ne),ur=1;ur<arguments.length;ur++){var gn=arguments[ur];if(gn!==K&&gn!==null)for(var li in gn)gn.hasOwnProperty(li)&&(wt[li]=gn[li])}return wt}:Pt=Object.assign;var Cr=Dt(function(Ne,wt,ur){for(var gn=Object.keys(wt),li=0;li<gn.length;)(!ur||ur&&Ne[gn[li]]===K)&&(Ne[gn[li]]=wt[gn[li]]),li++;return Ne},"extend","Use `assign`."),ne=Dt(function(Ne,wt){return Cr(Ne,wt,!0)},"merge","Use `assign`.");function gr(_e,Ne,wt){var ur=Ne.prototype,gn;gn=_e.prototype=Object.create(ur),gn.constructor=_e,gn._super=ur,wt&&Pt(gn,wt)}function It(_e,Ne){return function(){return _e.apply(Ne,arguments)}}function xt(_e,Ne){return typeof _e==gt?_e.apply(Ne&&Ne[0]||K,Ne):_e}function Jt(_e,Ne){return _e===K?Ne:_e}function Ct(_e,Ne,wt){qt(Ue(Ne),function(ur){_e.addEventListener(ur,wt,!1)})}function br(_e,Ne,wt){qt(Ue(Ne),function(ur){_e.removeEventListener(ur,wt,!1)})}function $r(_e,Ne){for(;_e;){if(_e==Ne)return!0;_e=_e.parentNode}return!1}function oe(_e,Ne){return _e.indexOf(Ne)>-1}function Ue(_e){return _e.trim().split(/\s+/g)}function H(_e,Ne,wt){if(_e.indexOf&&!wt)return _e.indexOf(Ne);for(var ur=0;ur<_e.length;){if(wt&&_e[ur][wt]==Ne||!wt&&_e[ur]===Ne)return ur;ur++}return-1}function U(_e){return Array.prototype.slice.call(_e,0)}function de(_e,Ne,wt){for(var ur=[],gn=[],li=0;li<_e.length;){var da=Ne?_e[li][Ne]:_e[li];H(gn,da)<0&&ur.push(_e[li]),gn[li]=da,li++}return wt&&(Ne?ur=ur.sort(function(Fr,Nr){return Fr[Ne]>Nr[Ne]}):ur=ur.sort()),ur}function Xe(_e,Ne){for(var wt,ur,gn=Ne[0].toUpperCase()+Ne.slice(1),li=0;li<Ae.length;){if(wt=Ae[li],ur=wt?wt+gn:Ne,ur in _e)return ur;li++}return K}var lt=1;function yt(){return lt++}function Vt(_e){var Ne=_e.ownerDocument||_e;return Ne.defaultView||Ne.parentWindow||Z}var pr=/mobile|tablet|ip(ad|hone|od)|android/i,tn="ontouchstart"in Z,Kr=Xe(Z,"PointerEvent")!==K,si=tn&&pr.test(navigator.userAgent),xn="touch",ii="pen",Ra="mouse",Di="kinect",Pi=25,ua=1,sa=2,Bi=4,Yn=8,bi=1,Ms=2,Ha=4,eo=8,Rt=16,be=Ms|Ha,ce=eo|Rt,Me=be|ce,j=["x","y"],ut=["clientX","clientY"];function ir(_e,Ne){var wt=this;this.manager=_e,this.callback=Ne,this.element=_e.element,this.target=_e.options.inputTarget,this.domHandler=function(ur){xt(_e.options.enable,[_e])&&wt.handler(ur)},this.init()}ir.prototype={handler:function(){},init:function(){this.evEl&&Ct(this.element,this.evEl,this.domHandler),this.evTarget&&Ct(this.target,this.evTarget,this.domHandler),this.evWin&&Ct(Vt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&br(this.element,this.evEl,this.domHandler),this.evTarget&&br(this.target,this.evTarget,this.domHandler),this.evWin&&br(Vt(this.element),this.evWin,this.domHandler)}};function Jr(_e){var Ne,wt=_e.options.inputClass;return wt?Ne=wt:Kr?Ne=He:si?Ne=dr:tn?Ne=ar:Ne=La,new Ne(_e,nt)}function nt(_e,Ne,wt){var ur=wt.pointers.length,gn=wt.changedPointers.length,li=Ne&ua&&ur-gn==0,da=Ne&(Bi|Yn)&&ur-gn==0;wt.isFirst=!!li,wt.isFinal=!!da,li&&(_e.session={}),wt.eventType=Ne,Bt(_e,wt),_e.emit("hammer.input",wt),_e.recognize(wt),_e.session.prevInput=wt}function Bt(_e,Ne){var wt=_e.session,ur=Ne.pointers,gn=ur.length;wt.firstInput||(wt.firstInput=un(Ne)),gn>1&&!wt.firstMultiple?wt.firstMultiple=un(Ne):gn===1&&(wt.firstMultiple=!1);var li=wt.firstInput,da=wt.firstMultiple,es=da?da.center:li.center,Fr=Ne.center=vn(ur);Ne.timeStamp=mr(),Ne.deltaTime=Ne.timeStamp-li.timeStamp,Ne.angle=Ri(es,Fr),Ne.distance=mn(es,Fr),Ar(wt,Ne),Ne.offsetDirection=Jn(Ne.deltaX,Ne.deltaY);var Nr=ui(Ne.deltaTime,Ne.deltaX,Ne.deltaY);Ne.overallVelocityX=Nr.x,Ne.overallVelocityY=Nr.y,Ne.overallVelocity=Ft(Nr.x)>Ft(Nr.y)?Nr.x:Nr.y,Ne.scale=da?Wa(da.pointers,ur):1,Ne.rotation=da?Si(da.pointers,ur):0,Ne.maxPointers=wt.prevInput?Ne.pointers.length>wt.prevInput.maxPointers?Ne.pointers.length:wt.prevInput.maxPointers:Ne.pointers.length,zr(wt,Ne);var it=_e.element;$r(Ne.srcEvent.target,it)&&(it=Ne.srcEvent.target),Ne.target=it}function Ar(_e,Ne){var wt=Ne.center,ur=_e.offsetDelta||{},gn=_e.prevDelta||{},li=_e.prevInput||{};(Ne.eventType===ua||li.eventType===Bi)&&(gn=_e.prevDelta={x:li.deltaX||0,y:li.deltaY||0},ur=_e.offsetDelta={x:wt.x,y:wt.y}),Ne.deltaX=gn.x+(wt.x-ur.x),Ne.deltaY=gn.y+(wt.y-ur.y)}function zr(_e,Ne){var wt=_e.lastInterval||Ne,ur=Ne.timeStamp-wt.timeStamp,gn,li,da,es;if(Ne.eventType!=Yn&&(ur>Pi||wt.velocity===K)){var Fr=Ne.deltaX-wt.deltaX,Nr=Ne.deltaY-wt.deltaY,it=ui(ur,Fr,Nr);li=it.x,da=it.y,gn=Ft(it.x)>Ft(it.y)?it.x:it.y,es=Jn(Fr,Nr),_e.lastInterval=Ne}else gn=wt.velocity,li=wt.velocityX,da=wt.velocityY,es=wt.direction;Ne.velocity=gn,Ne.velocityX=li,Ne.velocityY=da,Ne.direction=es}function un(_e){for(var Ne=[],wt=0;wt<_e.pointers.length;)Ne[wt]={clientX:Mt(_e.pointers[wt].clientX),clientY:Mt(_e.pointers[wt].clientY)},wt++;return{timeStamp:mr(),pointers:Ne,center:vn(Ne),deltaX:_e.deltaX,deltaY:_e.deltaY}}function vn(_e){var Ne=_e.length;if(Ne===1)return{x:Mt(_e[0].clientX),y:Mt(_e[0].clientY)};for(var wt=0,ur=0,gn=0;gn<Ne;)wt+=_e[gn].clientX,ur+=_e[gn].clientY,gn++;return{x:Mt(wt/Ne),y:Mt(ur/Ne)}}function ui(_e,Ne,wt){return{x:Ne/_e||0,y:wt/_e||0}}function Jn(_e,Ne){return _e===Ne?bi:Ft(_e)>=Ft(Ne)?_e<0?Ms:Ha:Ne<0?eo:Rt}function mn(_e,Ne,wt){wt||(wt=j);var ur=Ne[wt[0]]-_e[wt[0]],gn=Ne[wt[1]]-_e[wt[1]];return Math.sqrt(ur*ur+gn*gn)}function Ri(_e,Ne,wt){wt||(wt=j);var ur=Ne[wt[0]]-_e[wt[0]],gn=Ne[wt[1]]-_e[wt[1]];return Math.atan2(gn,ur)*180/Math.PI}function Si(_e,Ne){return Ri(Ne[1],Ne[0],ut)+Ri(_e[1],_e[0],ut)}function Wa(_e,Ne){return mn(Ne[0],Ne[1],ut)/mn(_e[0],_e[1],ut)}var uo={mousedown:ua,mousemove:sa,mouseup:Bi},Io="mousedown",to="mousemove mouseup";function La(){this.evEl=Io,this.evWin=to,this.pressed=!1,ir.apply(this,arguments)}gr(La,ir,{handler:function(Ne){var wt=uo[Ne.type];wt&ua&&Ne.button===0&&(this.pressed=!0),wt&sa&&Ne.which!==1&&(wt=Bi),!!this.pressed&&(wt&Bi&&(this.pressed=!1),this.callback(this.manager,wt,{pointers:[Ne],changedPointers:[Ne],pointerType:Ra,srcEvent:Ne}))}});var te={pointerdown:ua,pointermove:sa,pointerup:Bi,pointercancel:Yn,pointerout:Yn},le={2:xn,3:ii,4:Ra,5:Di},ye="pointerdown",Re="pointermove pointerup pointercancel";!tt&&Z.MSPointerEvent&&!Z.PointerEvent&&(ye="MSPointerDown",Re="MSPointerMove MSPointerUp MSPointerCancel");function He(){this.evEl=ye,this.evWin=Re,ir.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}gr(He,ir,{handler:function(Ne){var wt=this.store,ur=!1,gn=Ne.type.toLowerCase().replace("ms",""),li=te[gn],da=le[Ne.pointerType]||Ne.pointerType,es=da==xn,Fr=H(wt,Ne.pointerId,"pointerId");li&ua&&(Ne.button===0||es)?Fr<0&&(wt.push(Ne),Fr=wt.length-1):li&(Bi|Yn)&&(ur=!0),!(Fr<0)&&(wt[Fr]=Ne,this.callback(this.manager,li,{pointers:wt,changedPointers:[Ne],pointerType:da,srcEvent:Ne}),ur&&wt.splice(Fr,1))}});var ht={touchstart:ua,touchmove:sa,touchend:Bi,touchcancel:Yn},At="touchstart",Te="touchstart touchmove touchend touchcancel";function Je(){this.evTarget=At,this.evWin=Te,this.started=!1,ir.apply(this,arguments)}gr(Je,ir,{handler:function(Ne){var wt=ht[Ne.type];if(wt===ua&&(this.started=!0),!!this.started){var ur=Xt.call(this,Ne,wt);wt&(Bi|Yn)&&ur[0].length-ur[1].length==0&&(this.started=!1),this.callback(this.manager,wt,{pointers:ur[0],changedPointers:ur[1],pointerType:xn,srcEvent:Ne})}}});function Xt(_e,Ne){var wt=U(_e.touches),ur=U(_e.changedTouches);return Ne&(Bi|Yn)&&(wt=de(wt.concat(ur),"identifier",!0)),[wt,ur]}var Wr={touchstart:ua,touchmove:sa,touchend:Bi,touchcancel:Yn},cr="touchstart touchmove touchend touchcancel";function dr(){this.evTarget=cr,this.targetIds={},ir.apply(this,arguments)}gr(dr,ir,{handler:function(Ne){var wt=Wr[Ne.type],ur=jr.call(this,Ne,wt);!ur||this.callback(this.manager,wt,{pointers:ur[0],changedPointers:ur[1],pointerType:xn,srcEvent:Ne})}});function jr(_e,Ne){var wt=U(_e.touches),ur=this.targetIds;if(Ne&(ua|sa)&&wt.length===1)return ur[wt[0].identifier]=!0,[wt,wt];var gn,li,da=U(_e.changedTouches),es=[],Fr=this.target;if(li=wt.filter(function(Nr){return $r(Nr.target,Fr)}),Ne===ua)for(gn=0;gn<li.length;)ur[li[gn].identifier]=!0,gn++;for(gn=0;gn<da.length;)ur[da[gn].identifier]&&es.push(da[gn]),Ne&(Bi|Yn)&&delete ur[da[gn].identifier],gn++;if(!!es.length)return[de(li.concat(es),"identifier",!0),es]}var qn=2500,Un=25;function ar(){ir.apply(this,arguments);var _e=It(this.handler,this);this.touch=new dr(this.manager,_e),this.mouse=new La(this.manager,_e),this.primaryTouch=null,this.lastTouches=[]}gr(ar,ir,{handler:function(Ne,wt,ur){var gn=ur.pointerType==xn,li=ur.pointerType==Ra;if(!(li&&ur.sourceCapabilities&&ur.sourceCapabilities.firesTouchEvents)){if(gn)ot.call(this,wt,ur);else if(li&&se.call(this,ur))return;this.callback(Ne,wt,ur)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ot(_e,Ne){_e&ua?(this.primaryTouch=Ne.changedPointers[0].identifier,Cn.call(this,Ne)):_e&(Bi|Yn)&&Cn.call(this,Ne)}function Cn(_e){var Ne=_e.changedPointers[0];if(Ne.identifier===this.primaryTouch){var wt={x:Ne.clientX,y:Ne.clientY};this.lastTouches.push(wt);var ur=this.lastTouches,gn=function(){var li=ur.indexOf(wt);li>-1&&ur.splice(li,1)};setTimeout(gn,qn)}}function se(_e){for(var Ne=_e.srcEvent.clientX,wt=_e.srcEvent.clientY,ur=0;ur<this.lastTouches.length;ur++){var gn=this.lastTouches[ur],li=Math.abs(Ne-gn.x),da=Math.abs(wt-gn.y);if(li<=Un&&da<=Un)return!0}return!1}var Yi=tt?K:Xe(at.style,"touchAction"),Fn=Yi!==K,ta="compute",$a="auto",ra="manipulation",pa="none",Xi="pan-x",Ui="pan-y",ma=fa();function bo(_e,Ne){this.manager=_e,this.set(Ne)}bo.prototype={set:function(_e){_e==ta&&(_e=this.compute()),Fn&&this.manager.element.style&&ma[_e]&&(this.manager.element.style[Yi]=_e),this.actions=_e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var _e=[];return qt(this.manager.recognizers,function(Ne){xt(Ne.options.enable,[Ne])&&(_e=_e.concat(Ne.getTouchAction()))}),Za(_e.join(" "))},preventDefaults:function(_e){var Ne=_e.srcEvent,wt=_e.offsetDirection;if(this.manager.session.prevented){Ne.preventDefault();return}var ur=this.actions,gn=oe(ur,pa)&&!ma[pa],li=oe(ur,Ui)&&!ma[Ui],da=oe(ur,Xi)&&!ma[Xi];if(gn){var es=_e.pointers.length===1,Fr=_e.distance<2,Nr=_e.deltaTime<250;if(es&&Fr&&Nr)return}if(!(da&&li)&&(gn||li&&wt&be||da&&wt&ce))return this.preventSrc(Ne)},preventSrc:function(_e){this.manager.session.prevented=!0,_e.preventDefault()}};function Za(_e){if(oe(_e,pa))return pa;var Ne=oe(_e,Xi),wt=oe(_e,Ui);return Ne&&wt?pa:Ne||wt?Ne?Xi:Ui:oe(_e,ra)?ra:$a}function fa(){if(!Fn)return!1;var _e={};if(tt)return _e;var Ne=Z.CSS&&Z.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(wt){_e[wt]=Ne?Z.CSS.supports("touch-action",wt):!0}),_e}var na=1,To=2,Ou=4,ko=8,ao=ko,iu=16,au=32;function Ua(_e){this.options=Pt({},this.defaults,_e||{}),this.id=yt(),this.manager=null,this.options.enable=Jt(this.options.enable,!0),this.state=na,this.simultaneous={},this.requireFail=[]}Ua.prototype={defaults:{},set:function(_e){return Pt(this.options,_e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(_e){if(hr(_e,"recognizeWith",this))return this;var Ne=this.simultaneous;return _e=Eo(_e,this),Ne[_e.id]||(Ne[_e.id]=_e,_e.recognizeWith(this)),this},dropRecognizeWith:function(_e){return hr(_e,"dropRecognizeWith",this)?this:(_e=Eo(_e,this),delete this.simultaneous[_e.id],this)},requireFailure:function(_e){if(hr(_e,"requireFailure",this))return this;var Ne=this.requireFail;return _e=Eo(_e,this),H(Ne,_e)===-1&&(Ne.push(_e),_e.requireFailure(this)),this},dropRequireFailure:function(_e){if(hr(_e,"dropRequireFailure",this))return this;_e=Eo(_e,this);var Ne=H(this.requireFail,_e);return Ne>-1&&this.requireFail.splice(Ne,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(_e){return!!this.simultaneous[_e.id]},emit:function(_e){var Ne=this,wt=this.state;function ur(gn){Ne.manager.emit(gn,_e)}wt<ko&&ur(Ne.options.event+zl(wt)),ur(Ne.options.event),_e.additionalEvent&&ur(_e.additionalEvent),wt>=ko&&ur(Ne.options.event+zl(wt))},tryEmit:function(_e){if(this.canEmit())return this.emit(_e);this.state=au},canEmit:function(){for(var _e=0;_e<this.requireFail.length;){if(!(this.requireFail[_e].state&(au|na)))return!1;_e++}return!0},recognize:function(_e){var Ne=Pt({},_e);if(!xt(this.options.enable,[this,Ne])){this.reset(),this.state=au;return}this.state&(ao|iu|au)&&(this.state=na),this.state=this.process(Ne),this.state&(To|Ou|ko|iu)&&this.tryEmit(Ne)},process:function(_e){},getTouchAction:function(){},reset:function(){}};function zl(_e){return _e&iu?"cancel":_e&ko?"end":_e&Ou?"move":_e&To?"start":""}function Xo(_e){return _e==Rt?"down":_e==eo?"up":_e==Ms?"left":_e==Ha?"right":""}function Eo(_e,Ne){var wt=Ne.manager;return wt?wt.get(_e):_e}function jo(){Ua.apply(this,arguments)}gr(jo,Ua,{defaults:{pointers:1},attrTest:function(_e){var Ne=this.options.pointers;return Ne===0||_e.pointers.length===Ne},process:function(_e){var Ne=this.state,wt=_e.eventType,ur=Ne&(To|Ou),gn=this.attrTest(_e);return ur&&(wt&Yn||!gn)?Ne|iu:ur||gn?wt&Bi?Ne|ko:Ne&To?Ne|Ou:To:au}});function Va(){jo.apply(this,arguments),this.pX=null,this.pY=null}gr(Va,jo,{defaults:{event:"pan",threshold:10,pointers:1,direction:Me},getTouchAction:function(){var _e=this.options.direction,Ne=[];return _e&be&&Ne.push(Ui),_e&ce&&Ne.push(Xi),Ne},directionTest:function(_e){var Ne=this.options,wt=!0,ur=_e.distance,gn=_e.direction,li=_e.deltaX,da=_e.deltaY;return gn&Ne.direction||(Ne.direction&be?(gn=li===0?bi:li<0?Ms:Ha,wt=li!=this.pX,ur=Math.abs(_e.deltaX)):(gn=da===0?bi:da<0?eo:Rt,wt=da!=this.pY,ur=Math.abs(_e.deltaY))),_e.direction=gn,wt&&ur>Ne.threshold&&gn&Ne.direction},attrTest:function(_e){return jo.prototype.attrTest.call(this,_e)&&(this.state&To||!(this.state&To)&&this.directionTest(_e))},emit:function(_e){this.pX=_e.deltaX,this.pY=_e.deltaY;var Ne=Xo(_e.direction);Ne&&(_e.additionalEvent=this.options.event+Ne),this._super.emit.call(this,_e)}});function vs(){jo.apply(this,arguments)}gr(vs,jo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[pa]},attrTest:function(_e){return this._super.attrTest.call(this,_e)&&(Math.abs(_e.scale-1)>this.options.threshold||this.state&To)},emit:function(_e){if(_e.scale!==1){var Ne=_e.scale<1?"in":"out";_e.additionalEvent=this.options.event+Ne}this._super.emit.call(this,_e)}});function Hs(){Ua.apply(this,arguments),this._timer=null,this._input=null}gr(Hs,Ua,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[$a]},process:function(_e){var Ne=this.options,wt=_e.pointers.length===Ne.pointers,ur=_e.distance<Ne.threshold,gn=_e.deltaTime>Ne.time;if(this._input=_e,!ur||!wt||_e.eventType&(Bi|Yn)&&!gn)this.reset();else if(_e.eventType&ua)this.reset(),this._timer=jt(function(){this.state=ao,this.tryEmit()},Ne.time,this);else if(_e.eventType&Bi)return ao;return au},reset:function(){clearTimeout(this._timer)},emit:function(_e){this.state===ao&&(_e&&_e.eventType&Bi?this.manager.emit(this.options.event+"up",_e):(this._input.timeStamp=mr(),this.manager.emit(this.options.event,this._input)))}});function Ml(){jo.apply(this,arguments)}gr(Ml,jo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[pa]},attrTest:function(_e){return this._super.attrTest.call(this,_e)&&(Math.abs(_e.rotation)>this.options.threshold||this.state&To)}});function ms(){jo.apply(this,arguments)}gr(ms,jo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:be|ce,pointers:1},getTouchAction:function(){return Va.prototype.getTouchAction.call(this)},attrTest:function(_e){var Ne=this.options.direction,wt;return Ne&(be|ce)?wt=_e.overallVelocity:Ne&be?wt=_e.overallVelocityX:Ne&ce&&(wt=_e.overallVelocityY),this._super.attrTest.call(this,_e)&&Ne&_e.offsetDirection&&_e.distance>this.options.threshold&&_e.maxPointers==this.options.pointers&&Ft(wt)>this.options.velocity&&_e.eventType&Bi},emit:function(_e){var Ne=Xo(_e.offsetDirection);Ne&&this.manager.emit(this.options.event+Ne,_e),this.manager.emit(this.options.event,_e)}});function Bs(){Ua.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}gr(Bs,Ua,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ra]},process:function(_e){var Ne=this.options,wt=_e.pointers.length===Ne.pointers,ur=_e.distance<Ne.threshold,gn=_e.deltaTime<Ne.time;if(this.reset(),_e.eventType&ua&&this.count===0)return this.failTimeout();if(ur&&gn&&wt){if(_e.eventType!=Bi)return this.failTimeout();var li=this.pTime?_e.timeStamp-this.pTime<Ne.interval:!0,da=!this.pCenter||mn(this.pCenter,_e.center)<Ne.posThreshold;this.pTime=_e.timeStamp,this.pCenter=_e.center,!da||!li?this.count=1:this.count+=1,this._input=_e;var es=this.count%Ne.taps;if(es===0)return this.hasRequireFailures()?(this._timer=jt(function(){this.state=ao,this.tryEmit()},Ne.interval,this),To):ao}return au},failTimeout:function(){return this._timer=jt(function(){this.state=au},this.options.interval,this),au},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ao&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Da(_e,Ne){return Ne=Ne||{},Ne.recognizers=Jt(Ne.recognizers,Da.defaults.preset),new Ht(_e,Ne)}Da.VERSION="2.0.7",Da.defaults={domEvents:!1,touchAction:ta,enable:!0,inputTarget:null,inputClass:null,preset:[[Ml,{enable:!1}],[vs,{enable:!1},["rotate"]],[ms,{direction:be}],[Va,{direction:be},["swipe"]],[Bs],[Bs,{event:"doubletap",taps:2},["tap"]],[Hs]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var $o=1,Ys=2;function Ht(_e,Ne){this.options=Pt({},Da.defaults,Ne||{}),this.options.inputTarget=this.options.inputTarget||_e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=_e,this.input=Jr(this),this.touchAction=new bo(this,this.options.touchAction),tr(this,!0),qt(this.options.recognizers,function(wt){var ur=this.add(new wt[0](wt[1]));wt[2]&&ur.recognizeWith(wt[2]),wt[3]&&ur.requireFailure(wt[3])},this)}Ht.prototype={set:function(_e){return Pt(this.options,_e),_e.touchAction&&this.touchAction.update(),_e.inputTarget&&(this.input.destroy(),this.input.target=_e.inputTarget,this.input.init()),this},stop:function(_e){this.session.stopped=_e?Ys:$o},recognize:function(_e){var Ne=this.session;if(!Ne.stopped){this.touchAction.preventDefaults(_e);var wt,ur=this.recognizers,gn=Ne.curRecognizer;(!gn||gn&&gn.state&ao)&&(gn=Ne.curRecognizer=null);for(var li=0;li<ur.length;)wt=ur[li],Ne.stopped!==Ys&&(!gn||wt==gn||wt.canRecognizeWith(gn))?wt.recognize(_e):wt.reset(),!gn&&wt.state&(To|Ou|ko)&&(gn=Ne.curRecognizer=wt),li++}},get:function(_e){if(_e instanceof Ua)return _e;for(var Ne=this.recognizers,wt=0;wt<Ne.length;wt++)if(Ne[wt].options.event==_e)return Ne[wt];return null},add:function(_e){if(hr(_e,"add",this))return this;var Ne=this.get(_e.options.event);return Ne&&this.remove(Ne),this.recognizers.push(_e),_e.manager=this,this.touchAction.update(),_e},remove:function(_e){if(hr(_e,"remove",this))return this;if(_e=this.get(_e),_e){var Ne=this.recognizers,wt=H(Ne,_e);wt!==-1&&(Ne.splice(wt,1),this.touchAction.update())}return this},on:function(_e,Ne){if(_e!==K&&Ne!==K){var wt=this.handlers;return qt(Ue(_e),function(ur){wt[ur]=wt[ur]||[],wt[ur].push(Ne)}),this}},off:function(_e,Ne){if(_e!==K){var wt=this.handlers;return qt(Ue(_e),function(ur){Ne?wt[ur]&&wt[ur].splice(H(wt[ur],Ne),1):delete wt[ur]}),this}},emit:function(_e,Ne){this.options.domEvents&&J(_e,Ne);var wt=this.handlers[_e]&&this.handlers[_e].slice();if(!(!wt||!wt.length)){Ne.type=_e,Ne.preventDefault=function(){Ne.srcEvent.preventDefault()};for(var ur=0;ur<wt.length;)wt[ur](Ne),ur++}},destroy:function(){this.element&&tr(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function tr(_e,Ne){var wt=_e.element;if(!!wt.style){var ur;qt(_e.options.cssProps,function(gn,li){ur=Xe(wt.style,li),Ne?(_e.oldCssProps[ur]=wt.style[ur],wt.style[ur]=gn):wt.style[ur]=_e.oldCssProps[ur]||""}),Ne||(_e.oldCssProps={})}}function J(_e,Ne){if(!tt){var wt=_.createEvent("Event");wt.initEvent(_e,!0,!0),wt.gesture=Ne,Ne.target.dispatchEvent(wt)}}if(!tt){Pt(Da,{INPUT_START:ua,INPUT_MOVE:sa,INPUT_END:Bi,INPUT_CANCEL:Yn,STATE_POSSIBLE:na,STATE_BEGAN:To,STATE_CHANGED:Ou,STATE_ENDED:ko,STATE_RECOGNIZED:ao,STATE_CANCELLED:iu,STATE_FAILED:au,DIRECTION_NONE:bi,DIRECTION_LEFT:Ms,DIRECTION_RIGHT:Ha,DIRECTION_UP:eo,DIRECTION_DOWN:Rt,DIRECTION_HORIZONTAL:be,DIRECTION_VERTICAL:ce,DIRECTION_ALL:Me,Manager:Ht,Input:ir,TouchAction:bo,TouchInput:dr,MouseInput:La,PointerEventInput:He,TouchMouseInput:ar,SingleTouchInput:Je,Recognizer:Ua,AttrRecognizer:jo,Tap:Bs,Pan:Va,Swipe:ms,Pinch:vs,Rotate:Ml,Press:Hs,on:Ct,off:br,each:qt,merge:ne,extend:Cr,assign:Pt,inherit:gr,bindFn:It,prefixed:Xe});var Cu=typeof window!="undefined"?window:typeof self!="undefined"?self:{};Cu.Hammer=Da,Oe=function(){return Da}.call(ge,ie,ge,Yr),Oe!==K&&(Yr.exports=Oe)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Yr,ge,ie){(function(Oe,Z){Yr.exports=Z(ie(18857))})(this,function(Oe){"use strict";var Z=function(X){return X instanceof Uint8Array||X instanceof Uint16Array||X instanceof Uint32Array||X instanceof Int8Array||X instanceof Int16Array||X instanceof Int32Array||X instanceof Float32Array||X instanceof Float64Array||X instanceof Uint8ClampedArray},_=function(X,Le){for(var rt=Object.keys(Le),Kt=0;Kt<rt.length;++Kt)X[rt[Kt]]=Le[rt[Kt]];return X},Pe=`
`;function K(X){return typeof atob!="undefined"?atob(X):"base64:"+X}function xe(X){var Le=new Error("(regl) "+X);throw console.error(Le),Le}function ve(X,Le){X||xe(Le)}function tt(X){return X?": "+X:""}function Ae(X,Le,rt){X in Le||xe("unknown parameter ("+X+")"+tt(rt)+". possible values: "+Object.keys(Le).join())}function at(X,Le){Z(X)||xe("invalid parameter type"+tt(Le)+". must be a typed array")}function gt(X,Le){switch(Le){case"number":return typeof X=="number";case"object":return typeof X=="object";case"string":return typeof X=="string";case"boolean":return typeof X=="boolean";case"function":return typeof X=="function";case"undefined":return typeof X=="undefined";case"symbol":return typeof X=="symbol"}}function Mt(X,Le,rt){gt(X,Le)||xe("invalid parameter type"+tt(rt)+". expected "+Le+", got "+typeof X)}function Ft(X,Le){X>=0&&(X|0)===X||xe("invalid parameter type, ("+X+")"+tt(Le)+". must be a nonnegative integer")}function mr(X,Le,rt){Le.indexOf(X)<0&&xe("invalid value"+tt(rt)+". must be one of: "+Le)}var jt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function hr(X){Object.keys(X).forEach(function(Le){jt.indexOf(Le)<0&&xe('invalid regl constructor argument "'+Le+'". must be one of '+jt)})}function qt(X,Le){for(X=X+"";X.length<Le;)X=" "+X;return X}function Dt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Pt(X,Le){this.number=X,this.line=Le,this.errors=[]}function Cr(X,Le,rt){this.file=X,this.line=Le,this.message=rt}function ne(){var X=new Error,Le=(X.stack||X).toString(),rt=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Le);if(rt)return rt[1];var Kt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Le);return Kt?Kt[1]:"unknown"}function gr(){var X=new Error,Le=(X.stack||X).toString(),rt=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Le);if(rt)return rt[1];var Kt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Le);return Kt?Kt[1]:"unknown"}function It(X,Le){var rt=X.split(`
`),Kt=1,Pr=0,lr={unknown:new Dt,0:new Dt};lr.unknown.name=lr[0].name=Le||ne(),lr.unknown.lines.push(new Pt(0,""));for(var Ir=0;Ir<rt.length;++Ir){var Hr=rt[Ir],Qr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Hr);if(Qr)switch(Qr[1]){case"line":var an=/(\d+)(\s+\d+)?/.exec(Qr[2]);an&&(Kt=an[1]|0,an[2]&&(Pr=an[2]|0,Pr in lr||(lr[Pr]=new Dt)));break;case"define":var cn=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Qr[2]);cn&&(lr[Pr].name=cn[1]?K(cn[2]):cn[2]);break}lr[Pr].lines.push(new Pt(Kt++,Hr))}return Object.keys(lr).forEach(function(hn){var _n=lr[hn];_n.lines.forEach(function(Ur){_n.index[Ur.number]=Ur})}),lr}function xt(X){var Le=[];return X.split(`
`).forEach(function(rt){if(!(rt.length<5)){var Kt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(rt);Kt?Le.push(new Cr(Kt[1]|0,Kt[2]|0,Kt[3].trim())):rt.length>0&&Le.push(new Cr("unknown",0,rt))}}),Le}function Jt(X,Le){Le.forEach(function(rt){var Kt=X[rt.file];if(Kt){var Pr=Kt.index[rt.line];if(Pr){Pr.errors.push(rt),Kt.hasErrors=!0;return}}X.unknown.hasErrors=!0,X.unknown.lines[0].errors.push(rt)})}function Ct(X,Le,rt,Kt,Pr){if(!X.getShaderParameter(Le,X.COMPILE_STATUS)){var lr=X.getShaderInfoLog(Le),Ir=Kt===X.FRAGMENT_SHADER?"fragment":"vertex";de(rt,"string",Ir+" shader source must be a string",Pr);var Hr=It(rt,Pr),Qr=xt(lr);Jt(Hr,Qr),Object.keys(Hr).forEach(function(an){var cn=Hr[an];if(!cn.hasErrors)return;var hn=[""],_n=[""];function Ur(sn,zt){hn.push(sn),_n.push(zt||"")}Ur("file number "+an+": "+cn.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),cn.lines.forEach(function(sn){if(sn.errors.length>0){Ur(qt(sn.number,4)+"|  ","background-color:yellow; font-weight:bold"),Ur(sn.line+Pe,"color:red; background-color:yellow; font-weight:bold");var zt=0;sn.errors.forEach(function(xr){var nn=xr.message,wn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(nn);if(wn){var Dr=wn[1];switch(nn=wn[2],Dr){case"assign":Dr="=";break}zt=Math.max(sn.line.indexOf(Dr,zt),0)}else zt=0;Ur(qt("| ",6)),Ur(qt("^^^",zt+3)+Pe,"font-weight:bold"),Ur(qt("| ",6)),Ur(nn+Pe,"font-weight:bold")}),Ur(qt("| ",6)+Pe)}else Ur(qt(sn.number,4)+"|  "),Ur(sn.line+Pe,"color:red")}),typeof document!="undefined"&&!window.chrome?(_n[0]=hn.join("%c"),console.log.apply(console,_n)):console.log(hn.join(""))}),ve.raise("Error compiling "+Ir+" shader, "+Hr[0].name)}}function br(X,Le,rt,Kt,Pr){if(!X.getProgramParameter(Le,X.LINK_STATUS)){var lr=X.getProgramInfoLog(Le),Ir=It(rt,Pr),Hr=It(Kt,Pr),Qr='Error linking program with vertex shader, "'+Hr[0].name+'", and fragment shader "'+Ir[0].name+'"';typeof document!="undefined"?console.log("%c"+Qr+Pe+"%c"+lr,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Qr+Pe+lr),ve.raise(Qr)}}function $r(X){X._commandRef=ne()}function oe(X,Le,rt,Kt){$r(X);function Pr(Qr){return Qr?Kt.id(Qr):0}X._fragId=Pr(X.static.frag),X._vertId=Pr(X.static.vert);function lr(Qr,an){Object.keys(an).forEach(function(cn){Qr[Kt.id(cn)]=!0})}var Ir=X._uniformSet={};lr(Ir,Le.static),lr(Ir,Le.dynamic);var Hr=X._attributeSet={};lr(Hr,rt.static),lr(Hr,rt.dynamic),X._hasCount="count"in X.static||"count"in X.dynamic||"elements"in X.static||"elements"in X.dynamic}function Ue(X,Le){var rt=gr();xe(X+" in command "+(Le||ne())+(rt==="unknown"?"":" called from "+rt))}function H(X,Le,rt){X||Ue(Le,rt||ne())}function U(X,Le,rt,Kt){X in Le||Ue("unknown parameter ("+X+")"+tt(rt)+". possible values: "+Object.keys(Le).join(),Kt||ne())}function de(X,Le,rt,Kt){gt(X,Le)||Ue("invalid parameter type"+tt(rt)+". expected "+Le+", got "+typeof X,Kt||ne())}function Xe(X){X()}function lt(X,Le,rt){X.texture?mr(X.texture._texture.internalformat,Le,"unsupported texture format for attachment"):mr(X.renderbuffer._renderbuffer.format,rt,"unsupported renderbuffer format for attachment")}var yt=33071,Vt=9728,pr=9984,tn=9985,Kr=9986,si=9987,xn=5120,ii=5121,Ra=5122,Di=5123,Pi=5124,ua=5125,sa=5126,Bi=32819,Yn=32820,bi=33635,Ms=34042,Ha=36193,eo={};eo[xn]=eo[ii]=1,eo[Ra]=eo[Di]=eo[Ha]=eo[bi]=eo[Bi]=eo[Yn]=2,eo[Pi]=eo[ua]=eo[sa]=eo[Ms]=4;function Rt(X,Le){return X===Yn||X===Bi||X===bi?2:X===Ms?4:eo[X]*Le}function be(X){return!(X&X-1)&&!!X}function ce(X,Le,rt){var Kt,Pr=Le.width,lr=Le.height,Ir=Le.channels;ve(Pr>0&&Pr<=rt.maxTextureSize&&lr>0&&lr<=rt.maxTextureSize,"invalid texture shape"),(X.wrapS!==yt||X.wrapT!==yt)&&ve(be(Pr)&&be(lr),"incompatible wrap mode for texture, both width and height must be power of 2"),Le.mipmask===1?Pr!==1&&lr!==1&&ve(X.minFilter!==pr&&X.minFilter!==Kr&&X.minFilter!==tn&&X.minFilter!==si,"min filter requires mipmap"):(ve(be(Pr)&&be(lr),"texture must be a square power of 2 to support mipmapping"),ve(Le.mipmask===(Pr<<1)-1,"missing or incomplete mipmap data")),Le.type===sa&&(rt.extensions.indexOf("oes_texture_float_linear")<0&&ve(X.minFilter===Vt&&X.magFilter===Vt,"filter not supported, must enable oes_texture_float_linear"),ve(!X.genMipmaps,"mipmap generation not supported with float textures"));var Hr=Le.images;for(Kt=0;Kt<16;++Kt)if(Hr[Kt]){var Qr=Pr>>Kt,an=lr>>Kt;ve(Le.mipmask&1<<Kt,"missing mipmap data");var cn=Hr[Kt];if(ve(cn.width===Qr&&cn.height===an,"invalid shape for mip images"),ve(cn.format===Le.format&&cn.internalformat===Le.internalformat&&cn.type===Le.type,"incompatible type for mip image"),!cn.compressed)if(cn.data){var hn=Math.ceil(Rt(cn.type,Ir)*Qr/cn.unpackAlignment)*cn.unpackAlignment;ve(cn.data.byteLength===hn*an,"invalid data for image, buffer size is inconsistent with image format")}else cn.element||cn.copy}else X.genMipmaps||ve((Le.mipmask&1<<Kt)==0,"extra mipmap data");Le.compressed&&ve(!X.genMipmaps,"mipmap generation for compressed images not supported")}function Me(X,Le,rt,Kt){var Pr=X.width,lr=X.height,Ir=X.channels;ve(Pr>0&&Pr<=Kt.maxTextureSize&&lr>0&&lr<=Kt.maxTextureSize,"invalid texture shape"),ve(Pr===lr,"cube map must be square"),ve(Le.wrapS===yt&&Le.wrapT===yt,"wrap mode not supported by cube map");for(var Hr=0;Hr<rt.length;++Hr){var Qr=rt[Hr];ve(Qr.width===Pr&&Qr.height===lr,"inconsistent cube map face shape"),Le.genMipmaps&&(ve(!Qr.compressed,"can not generate mipmap for compressed textures"),ve(Qr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var an=Qr.images,cn=0;cn<16;++cn){var hn=an[cn];if(hn){var _n=Pr>>cn,Ur=lr>>cn;ve(Qr.mipmask&1<<cn,"missing mipmap data"),ve(hn.width===_n&&hn.height===Ur,"invalid shape for mip images"),ve(hn.format===X.format&&hn.internalformat===X.internalformat&&hn.type===X.type,"incompatible type for mip image"),hn.compressed||(hn.data?ve(hn.data.byteLength===_n*Ur*Math.max(Rt(hn.type,Ir),hn.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):hn.element||hn.copy)}}}}var j=_(ve,{optional:Xe,raise:xe,commandRaise:Ue,command:H,parameter:Ae,commandParameter:U,constructor:hr,type:Mt,commandType:de,isTypedArray:at,nni:Ft,oneOf:mr,shaderError:Ct,linkError:br,callSite:gr,saveCommandRef:$r,saveDrawInfo:oe,framebufferFormat:lt,guessCommand:ne,texture2D:ce,textureCube:Me}),ut=0,ir=0,Jr=5,nt=6;function Bt(X,Le){this.id=ut++,this.type=X,this.data=Le}function Ar(X){return X.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function zr(X){if(X.length===0)return[];var Le=X.charAt(0),rt=X.charAt(X.length-1);if(X.length>1&&Le===rt&&(Le==='"'||Le==="'"))return['"'+Ar(X.substr(1,X.length-2))+'"'];var Kt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(X);if(Kt)return zr(X.substr(0,Kt.index)).concat(zr(Kt[1])).concat(zr(X.substr(Kt.index+Kt[0].length)));var Pr=X.split(".");if(Pr.length===1)return['"'+Ar(X)+'"'];for(var lr=[],Ir=0;Ir<Pr.length;++Ir)lr=lr.concat(zr(Pr[Ir]));return lr}function un(X){return"["+zr(X).join("][")+"]"}function vn(X,Le){return new Bt(X,un(Le+""))}function ui(X){return typeof X=="function"&&!X._reglType||X instanceof Bt}function Jn(X,Le){if(typeof X=="function")return new Bt(ir,X);if(typeof X=="number"||typeof X=="boolean")return new Bt(Jr,X);if(Array.isArray(X))return new Bt(nt,X.map(function(rt,Kt){return Jn(rt,Le+"["+Kt+"]")}));if(X instanceof Bt)return X;j(!1,"invalid option type in uniform "+Le)}var mn={DynamicVariable:Bt,define:vn,isDynamic:ui,unbox:Jn,accessor:un},Ri={next:typeof requestAnimationFrame=="function"?function(X){return requestAnimationFrame(X)}:function(X){return setTimeout(X,16)},cancel:typeof cancelAnimationFrame=="function"?function(X){return cancelAnimationFrame(X)}:clearTimeout},Si=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Wa=Si?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function uo(){var X={"":0},Le=[""];return{id:function(rt){var Kt=X[rt];return Kt||(Kt=X[rt]=Le.length,Le.push(rt),Kt)},str:function(rt){return Le[rt]}}}function Io(X,Le,rt){var Kt=document.createElement("canvas");_(Kt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),X.appendChild(Kt),X===document.body&&(Kt.style.position="absolute",_(X.style,{margin:0,padding:0}));function Pr(){var Hr=window.innerWidth,Qr=window.innerHeight;if(X!==document.body){var an=Kt.getBoundingClientRect();Hr=an.right-an.left,Qr=an.bottom-an.top}Kt.width=rt*Hr,Kt.height=rt*Qr}var lr;X!==document.body&&typeof ResizeObserver=="function"?(lr=new ResizeObserver(function(){setTimeout(Pr)}),lr.observe(X)):window.addEventListener("resize",Pr,!1);function Ir(){lr?lr.disconnect():window.removeEventListener("resize",Pr),X.removeChild(Kt)}return Pr(),{canvas:Kt,onDestroy:Ir}}function to(X,Le){function rt(Kt){try{return X.getContext(Kt,Le)}catch(Pr){return null}}return rt("webgl")||rt("experimental-webgl")||rt("webgl-experimental")}function La(X){return typeof X.nodeName=="string"&&typeof X.appendChild=="function"&&typeof X.getBoundingClientRect=="function"}function te(X){return typeof X.drawArrays=="function"||typeof X.drawElements=="function"}function le(X){return typeof X=="string"?X.split():(j(Array.isArray(X),"invalid extension array"),X)}function ye(X){return typeof X=="string"?(j(typeof document!="undefined","not supported outside of DOM"),document.querySelector(X)):X}function Re(X){var Le=X||{},rt,Kt,Pr,lr,Ir={},Hr=[],Qr=[],an=typeof window=="undefined"?1:window.devicePixelRatio,cn=!1,hn=function(sn){sn&&j.raise(sn)},_n=function(){};if(typeof Le=="string"?(j(typeof document!="undefined","selector queries only supported in DOM environments"),rt=document.querySelector(Le),j(rt,"invalid query string for element")):typeof Le=="object"?La(Le)?rt=Le:te(Le)?(lr=Le,Pr=lr.canvas):(j.constructor(Le),"gl"in Le?lr=Le.gl:"canvas"in Le?Pr=ye(Le.canvas):"container"in Le&&(Kt=ye(Le.container)),"attributes"in Le&&(Ir=Le.attributes,j.type(Ir,"object","invalid context attributes")),"extensions"in Le&&(Hr=le(Le.extensions)),"optionalExtensions"in Le&&(Qr=le(Le.optionalExtensions)),"onDone"in Le&&(j.type(Le.onDone,"function","invalid or missing onDone callback"),hn=Le.onDone),"profile"in Le&&(cn=!!Le.profile),"pixelRatio"in Le&&(an=+Le.pixelRatio,j(an>0,"invalid pixel ratio"))):j.raise("invalid arguments to regl"),rt&&(rt.nodeName.toLowerCase()==="canvas"?Pr=rt:Kt=rt),!lr){if(!Pr){j(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Ur=Io(Kt||document.body,hn,an);if(!Ur)return null;Pr=Ur.canvas,_n=Ur.onDestroy}Ir.premultipliedAlpha===void 0&&(Ir.premultipliedAlpha=!0),lr=to(Pr,Ir)}return lr?{gl:lr,canvas:Pr,container:Kt,extensions:Hr,optionalExtensions:Qr,pixelRatio:an,profile:cn,onDone:hn,onDestroy:_n}:(_n(),hn("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function He(X,Le){var rt={};function Kt(Hr){j.type(Hr,"string","extension name must be string");var Qr=Hr.toLowerCase(),an;try{an=rt[Qr]=Pr(Hr)}catch(cn){}return!!an}function Pr(Hr){return X.getExtension(Hr)?X.getExtension(Hr):X.getExtension(Hr.toLowerCase())?X.getExtension(Hr.toLowerCase()):null}for(var lr=0;lr<Le.extensions.length;++lr){var Ir=Le.extensions[lr];if(!Kt(Ir))return Le.onDestroy(),Le.onDone('"'+Ir+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Le.optionalExtensions.forEach(Kt),{extensions:rt,restore:function(){Object.keys(rt).forEach(function(Hr){if(rt[Hr]&&!Kt(Hr))throw new Error("(regl): error restoring extension "+Hr)})}}}function ht(X,Le){for(var rt=Array(X),Kt=0;Kt<X;++Kt)rt[Kt]=Le(Kt);return rt}var At=5120,Te=5121,Je=5122,Xt=5123,Wr=5124,cr=5125,dr=5126;function jr(X){for(var Le=16;Le<=1<<28;Le*=16)if(X<=Le)return Le;return 0}function qn(X){var Le,rt;return Le=(X>65535)<<4,X>>>=Le,rt=(X>255)<<3,X>>>=rt,Le|=rt,rt=(X>15)<<2,X>>>=rt,Le|=rt,rt=(X>3)<<1,X>>>=rt,Le|=rt,Le|X>>1}function Un(){var X=ht(8,function(){return[]});function Le(lr){var Ir=jr(lr),Hr=X[qn(Ir)>>2];return Hr.length>0?Hr.pop():new ArrayBuffer(Ir)}function rt(lr){X[qn(lr.byteLength)>>2].push(lr)}function Kt(lr,Ir){var Hr=null;switch(lr){case At:Hr=new Int8Array(Le(Ir),0,Ir);break;case Te:Hr=new Uint8Array(Le(Ir),0,Ir);break;case Je:Hr=new Int16Array(Le(2*Ir),0,Ir);break;case Xt:Hr=new Uint16Array(Le(2*Ir),0,Ir);break;case Wr:Hr=new Int32Array(Le(4*Ir),0,Ir);break;case cr:Hr=new Uint32Array(Le(4*Ir),0,Ir);break;case dr:Hr=new Float32Array(Le(4*Ir),0,Ir);break;default:return null}return Hr.length!==Ir?Hr.subarray(0,Ir):Hr}function Pr(lr){rt(lr.buffer)}return{alloc:Le,free:rt,allocType:Kt,freeType:Pr}}var ar=Un();ar.zero=Un();var ot=3408,Cn=3410,se=3411,Yi=3412,Fn=3413,ta=3414,$a=3415,ra=33901,pa=33902,Xi=3379,Ui=3386,ma=34921,bo=36347,Za=36348,fa=35661,na=35660,To=34930,Ou=36349,ko=34076,ao=34024,iu=7936,au=7937,Ua=7938,zl=35724,Xo=34047,Eo=36063,jo=34852,Va=3553,vs=34067,Hs=34069,Ml=33984,ms=6408,Bs=5126,Da=5121,$o=36160,Ys=36053,Ht=36064,tr=16384,J=function(X,Le){var rt=1;Le.ext_texture_filter_anisotropic&&(rt=X.getParameter(Xo));var Kt=1,Pr=1;Le.webgl_draw_buffers&&(Kt=X.getParameter(jo),Pr=X.getParameter(Eo));var lr=!!Le.oes_texture_float;if(lr){var Ir=X.createTexture();X.bindTexture(Va,Ir),X.texImage2D(Va,0,ms,1,1,0,ms,Bs,null);var Hr=X.createFramebuffer();if(X.bindFramebuffer($o,Hr),X.framebufferTexture2D($o,Ht,Va,Ir,0),X.bindTexture(Va,null),X.checkFramebufferStatus($o)!==Ys)lr=!1;else{X.viewport(0,0,1,1),X.clearColor(1,0,0,1),X.clear(tr);var Qr=ar.allocType(Bs,4);X.readPixels(0,0,1,1,ms,Bs,Qr),X.getError()?lr=!1:(X.deleteFramebuffer(Hr),X.deleteTexture(Ir),lr=Qr[0]===1),ar.freeType(Qr)}}var an=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),cn=!0;if(!an){var hn=X.createTexture(),_n=ar.allocType(Da,36);X.activeTexture(Ml),X.bindTexture(vs,hn),X.texImage2D(Hs,0,ms,3,3,0,ms,Da,_n),ar.freeType(_n),X.bindTexture(vs,null),X.deleteTexture(hn),cn=!X.getError()}return{colorBits:[X.getParameter(Cn),X.getParameter(se),X.getParameter(Yi),X.getParameter(Fn)],depthBits:X.getParameter(ta),stencilBits:X.getParameter($a),subpixelBits:X.getParameter(ot),extensions:Object.keys(Le).filter(function(Ur){return!!Le[Ur]}),maxAnisotropic:rt,maxDrawbuffers:Kt,maxColorAttachments:Pr,pointSizeDims:X.getParameter(ra),lineWidthDims:X.getParameter(pa),maxViewportDims:X.getParameter(Ui),maxCombinedTextureUnits:X.getParameter(fa),maxCubeMapSize:X.getParameter(ko),maxRenderbufferSize:X.getParameter(ao),maxTextureUnits:X.getParameter(To),maxTextureSize:X.getParameter(Xi),maxAttributes:X.getParameter(ma),maxVertexUniforms:X.getParameter(bo),maxVertexTextureUnits:X.getParameter(na),maxVaryingVectors:X.getParameter(Za),maxFragmentUniforms:X.getParameter(Ou),glsl:X.getParameter(zl),renderer:X.getParameter(au),vendor:X.getParameter(iu),version:X.getParameter(Ua),readFloat:lr,npotTextureCube:cn}};function Cu(X){return!!X&&typeof X=="object"&&Array.isArray(X.shape)&&Array.isArray(X.stride)&&typeof X.offset=="number"&&X.shape.length===X.stride.length&&(Array.isArray(X.data)||Z(X.data))}var _e=function(X){return Object.keys(X).map(function(Le){return X[Le]})},Ne={shape:es,flatten:da};function wt(X,Le,rt){for(var Kt=0;Kt<Le;++Kt)rt[Kt]=X[Kt]}function ur(X,Le,rt,Kt){for(var Pr=0,lr=0;lr<Le;++lr)for(var Ir=X[lr],Hr=0;Hr<rt;++Hr)Kt[Pr++]=Ir[Hr]}function gn(X,Le,rt,Kt,Pr,lr){for(var Ir=lr,Hr=0;Hr<Le;++Hr)for(var Qr=X[Hr],an=0;an<rt;++an)for(var cn=Qr[an],hn=0;hn<Kt;++hn)Pr[Ir++]=cn[hn]}function li(X,Le,rt,Kt,Pr){for(var lr=1,Ir=rt+1;Ir<Le.length;++Ir)lr*=Le[Ir];var Hr=Le[rt];if(Le.length-rt==4){var Qr=Le[rt+1],an=Le[rt+2],cn=Le[rt+3];for(Ir=0;Ir<Hr;++Ir)gn(X[Ir],Qr,an,cn,Kt,Pr),Pr+=lr}else for(Ir=0;Ir<Hr;++Ir)li(X[Ir],Le,rt+1,Kt,Pr),Pr+=lr}function da(X,Le,rt,Kt){var Pr=1;if(Le.length)for(var lr=0;lr<Le.length;++lr)Pr*=Le[lr];else Pr=0;var Ir=Kt||ar.allocType(rt,Pr);switch(Le.length){case 0:break;case 1:wt(X,Le[0],Ir);break;case 2:ur(X,Le[0],Le[1],Ir);break;case 3:gn(X,Le[0],Le[1],Le[2],Ir,0);break;default:li(X,Le,0,Ir,0)}return Ir}function es(X){for(var Le=[],rt=X;rt.length;rt=rt[0])Le.push(rt.length);return Le}var Fr={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Nr=5120,it=5122,gu=5124,qs=5121,Tu=5123,Ns=5125,yu=5126,_u=5126,Ju={int8:Nr,int16:it,int32:gu,uint8:qs,uint16:Tu,uint32:Ns,float:yu,float32:_u},Mu=35048,lo=35040,xa={dynamic:Mu,stream:lo,static:35044},mo=Ne.flatten,Wf=Ne.shape,Ks=35044,Xf=35040,Jc=5121,Il=5126,Ke=[];Ke[5120]=1,Ke[5122]=2,Ke[5124]=4,Ke[5121]=1,Ke[5123]=2,Ke[5125]=4,Ke[5126]=4;function Rc(X){return Fr[Object.prototype.toString.call(X)]|0}function S(X,Le){for(var rt=0;rt<Le.length;++rt)X[rt]=Le[rt]}function R(X,Le,rt,Kt,Pr,lr,Ir){for(var Hr=0,Qr=0;Qr<rt;++Qr)for(var an=0;an<Kt;++an)X[Hr++]=Le[Pr*Qr+lr*an+Ir]}function W(X,Le,rt,Kt){var Pr=0,lr={};function Ir(zt){this.id=Pr++,this.buffer=X.createBuffer(),this.type=zt,this.usage=Ks,this.byteLength=0,this.dimension=1,this.dtype=Jc,this.persistentData=null,rt.profile&&(this.stats={size:0})}Ir.prototype.bind=function(){X.bindBuffer(this.type,this.buffer)},Ir.prototype.destroy=function(){_n(this)};var Hr=[];function Qr(zt,xr){var nn=Hr.pop();return nn||(nn=new Ir(zt)),nn.bind(),hn(nn,xr,Xf,0,1,!1),nn}function an(zt){Hr.push(zt)}function cn(zt,xr,nn){zt.byteLength=xr.byteLength,X.bufferData(zt.type,xr,nn)}function hn(zt,xr,nn,wn,Dr,pn){var Mn;if(zt.usage=nn,Array.isArray(xr)){if(zt.dtype=wn||Il,xr.length>0){var Ei;if(Array.isArray(xr[0])){Mn=Wf(xr);for(var kr=1,Lr=1;Lr<Mn.length;++Lr)kr*=Mn[Lr];zt.dimension=kr,Ei=mo(xr,Mn,zt.dtype),cn(zt,Ei,nn),pn?zt.persistentData=Ei:ar.freeType(Ei)}else if(typeof xr[0]=="number"){zt.dimension=Dr;var Kn=ar.allocType(zt.dtype,xr.length);S(Kn,xr),cn(zt,Kn,nn),pn?zt.persistentData=Kn:ar.freeType(Kn)}else Z(xr[0])?(zt.dimension=xr[0].length,zt.dtype=wn||Rc(xr[0])||Il,Ei=mo(xr,[xr.length,xr[0].length],zt.dtype),cn(zt,Ei,nn),pn?zt.persistentData=Ei:ar.freeType(Ei)):j.raise("invalid buffer data")}}else if(Z(xr))zt.dtype=wn||Rc(xr),zt.dimension=Dr,cn(zt,xr,nn),pn&&(zt.persistentData=new Uint8Array(new Uint8Array(xr.buffer)));else if(Cu(xr)){Mn=xr.shape;var In=xr.stride,rn=xr.offset,On=0,Rn=0,aa=0,zi=0;Mn.length===1?(On=Mn[0],Rn=1,aa=In[0],zi=0):Mn.length===2?(On=Mn[0],Rn=Mn[1],aa=In[0],zi=In[1]):j.raise("invalid shape"),zt.dtype=wn||Rc(xr.data)||Il,zt.dimension=Rn;var Pn=ar.allocType(zt.dtype,On*Rn);R(Pn,xr.data,On,Rn,aa,zi,rn),cn(zt,Pn,nn),pn?zt.persistentData=Pn:ar.freeType(Pn)}else xr instanceof ArrayBuffer?(zt.dtype=Jc,zt.dimension=Dr,cn(zt,xr,nn),pn&&(zt.persistentData=new Uint8Array(new Uint8Array(xr)))):j.raise("invalid buffer data")}function _n(zt){Le.bufferCount--,Kt(zt);var xr=zt.buffer;j(xr,"buffer must not be deleted already"),X.deleteBuffer(xr),zt.buffer=null,delete lr[zt.id]}function Ur(zt,xr,nn,wn){Le.bufferCount++;var Dr=new Ir(xr);lr[Dr.id]=Dr;function pn(kr){var Lr=Ks,Kn=null,In=0,rn=0,On=1;return Array.isArray(kr)||Z(kr)||Cu(kr)||kr instanceof ArrayBuffer?Kn=kr:typeof kr=="number"?In=kr|0:kr&&(j.type(kr,"object","buffer arguments must be an object, a number or an array"),"data"in kr&&(j(Kn===null||Array.isArray(Kn)||Z(Kn)||Cu(Kn),"invalid data for buffer"),Kn=kr.data),"usage"in kr&&(j.parameter(kr.usage,xa,"invalid buffer usage"),Lr=xa[kr.usage]),"type"in kr&&(j.parameter(kr.type,Ju,"invalid buffer type"),rn=Ju[kr.type]),"dimension"in kr&&(j.type(kr.dimension,"number","invalid dimension"),On=kr.dimension|0),"length"in kr&&(j.nni(In,"buffer length must be a nonnegative integer"),In=kr.length|0)),Dr.bind(),Kn?hn(Dr,Kn,Lr,rn,On,wn):(In&&X.bufferData(Dr.type,In,Lr),Dr.dtype=rn||Jc,Dr.usage=Lr,Dr.dimension=On,Dr.byteLength=In),rt.profile&&(Dr.stats.size=Dr.byteLength*Ke[Dr.dtype]),pn}function Mn(kr,Lr){j(Lr+kr.byteLength<=Dr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+kr.byteLength+" starting from offset "+Lr+" to a buffer of size "+Dr.byteLength),X.bufferSubData(Dr.type,Lr,kr)}function Ei(kr,Lr){var Kn=(Lr||0)|0,In;if(Dr.bind(),Z(kr)||kr instanceof ArrayBuffer)Mn(kr,Kn);else if(Array.isArray(kr)){if(kr.length>0)if(typeof kr[0]=="number"){var rn=ar.allocType(Dr.dtype,kr.length);S(rn,kr),Mn(rn,Kn),ar.freeType(rn)}else if(Array.isArray(kr[0])||Z(kr[0])){In=Wf(kr);var On=mo(kr,In,Dr.dtype);Mn(On,Kn),ar.freeType(On)}else j.raise("invalid buffer data")}else if(Cu(kr)){In=kr.shape;var Rn=kr.stride,aa=0,zi=0,Pn=0,zn=0;In.length===1?(aa=In[0],zi=1,Pn=Rn[0],zn=0):In.length===2?(aa=In[0],zi=In[1],Pn=Rn[0],zn=Rn[1]):j.raise("invalid shape");var ki=Array.isArray(kr.data)?Dr.dtype:Rc(kr.data),Vi=ar.allocType(ki,aa*zi);R(Vi,kr.data,aa,zi,Pn,zn,kr.offset),Mn(Vi,Kn),ar.freeType(Vi)}else j.raise("invalid data for buffer subdata");return pn}return nn||pn(zt),pn._reglType="buffer",pn._buffer=Dr,pn.subdata=Ei,rt.profile&&(pn.stats=Dr.stats),pn.destroy=function(){_n(Dr)},pn}function sn(){_e(lr).forEach(function(zt){zt.buffer=X.createBuffer(),X.bindBuffer(zt.type,zt.buffer),X.bufferData(zt.type,zt.persistentData||zt.byteLength,zt.usage)})}return rt.profile&&(Le.getTotalBufferSize=function(){var zt=0;return Object.keys(lr).forEach(function(xr){zt+=lr[xr].stats.size}),zt}),{create:Ur,createStream:Qr,destroyStream:an,clear:function(){_e(lr).forEach(_n),Hr.forEach(_n)},getBuffer:function(zt){return zt&&zt._buffer instanceof Ir?zt._buffer:null},restore:sn,_initBuffer:hn}}var F=0,ue=0,De=1,ft=1,Gt=4,Wt=4,Or={points:F,point:ue,lines:De,line:ft,triangles:Gt,triangle:Wt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},en=0,ci=1,Gi=4,vi=5120,ka=5121,ha=5122,So=5123,Sa=5124,Ho=5125,xu=34963,hl=35040,No=35044;function Iu(X,Le,rt,Kt){var Pr={},lr=0,Ir={uint8:ka,uint16:So};Le.oes_element_index_uint&&(Ir.uint32=Ho);function Hr(sn){this.id=lr++,Pr[this.id]=this,this.buffer=sn,this.primType=Gi,this.vertCount=0,this.type=0}Hr.prototype.bind=function(){this.buffer.bind()};var Qr=[];function an(sn){var zt=Qr.pop();return zt||(zt=new Hr(rt.create(null,xu,!0,!1)._buffer)),hn(zt,sn,hl,-1,-1,0,0),zt}function cn(sn){Qr.push(sn)}function hn(sn,zt,xr,nn,wn,Dr,pn){sn.buffer.bind();var Mn;if(zt){var Ei=pn;!pn&&(!Z(zt)||Cu(zt)&&!Z(zt.data))&&(Ei=Le.oes_element_index_uint?Ho:So),rt._initBuffer(sn.buffer,zt,xr,Ei,3)}else X.bufferData(xu,Dr,xr),sn.buffer.dtype=Mn||ka,sn.buffer.usage=xr,sn.buffer.dimension=3,sn.buffer.byteLength=Dr;if(Mn=pn,!pn){switch(sn.buffer.dtype){case ka:case vi:Mn=ka;break;case So:case ha:Mn=So;break;case Ho:case Sa:Mn=Ho;break;default:j.raise("unsupported type for element array")}sn.buffer.dtype=Mn}sn.type=Mn,j(Mn!==Ho||!!Le.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var kr=wn;kr<0&&(kr=sn.buffer.byteLength,Mn===So?kr>>=1:Mn===Ho&&(kr>>=2)),sn.vertCount=kr;var Lr=nn;if(nn<0){Lr=Gi;var Kn=sn.buffer.dimension;Kn===1&&(Lr=en),Kn===2&&(Lr=ci),Kn===3&&(Lr=Gi)}sn.primType=Lr}function _n(sn){Kt.elementsCount--,j(sn.buffer!==null,"must not double destroy elements"),delete Pr[sn.id],sn.buffer.destroy(),sn.buffer=null}function Ur(sn,zt){var xr=rt.create(null,xu,!0),nn=new Hr(xr._buffer);Kt.elementsCount++;function wn(Dr){if(!Dr)xr(),nn.primType=Gi,nn.vertCount=0,nn.type=ka;else if(typeof Dr=="number")xr(Dr),nn.primType=Gi,nn.vertCount=Dr|0,nn.type=ka;else{var pn=null,Mn=No,Ei=-1,kr=-1,Lr=0,Kn=0;Array.isArray(Dr)||Z(Dr)||Cu(Dr)?pn=Dr:(j.type(Dr,"object","invalid arguments for elements"),"data"in Dr&&(pn=Dr.data,j(Array.isArray(pn)||Z(pn)||Cu(pn),"invalid data for element buffer")),"usage"in Dr&&(j.parameter(Dr.usage,xa,"invalid element buffer usage"),Mn=xa[Dr.usage]),"primitive"in Dr&&(j.parameter(Dr.primitive,Or,"invalid element buffer primitive"),Ei=Or[Dr.primitive]),"count"in Dr&&(j(typeof Dr.count=="number"&&Dr.count>=0,"invalid vertex count for elements"),kr=Dr.count|0),"type"in Dr&&(j.parameter(Dr.type,Ir,"invalid buffer type"),Kn=Ir[Dr.type]),"length"in Dr?Lr=Dr.length|0:(Lr=kr,Kn===So||Kn===ha?Lr*=2:(Kn===Ho||Kn===Sa)&&(Lr*=4))),hn(nn,pn,Mn,Ei,kr,Lr,Kn)}return wn}return wn(sn),wn._reglType="elements",wn._elements=nn,wn.subdata=function(Dr,pn){return xr.subdata(Dr,pn),wn},wn.destroy=function(){_n(nn)},wn}return{create:Ur,createStream:an,destroyStream:cn,getElements:function(sn){return typeof sn=="function"&&sn._elements instanceof Hr?sn._elements:null},clear:function(){_e(Pr).forEach(_n)}}}var ef=new Float32Array(1),ql=new Uint32Array(ef.buffer),kl=5123;function Kl(X){for(var Le=ar.allocType(kl,X.length),rt=0;rt<X.length;++rt)if(isNaN(X[rt]))Le[rt]=65535;else if(X[rt]===Infinity)Le[rt]=31744;else if(X[rt]===-Infinity)Le[rt]=64512;else{ef[0]=X[rt];var Kt=ql[0],Pr=Kt>>>31<<15,lr=(Kt<<1>>>24)-127,Ir=Kt>>13&(1<<10)-1;if(lr<-24)Le[rt]=Pr;else if(lr<-14){var Hr=-14-lr;Le[rt]=Pr+(Ir+(1<<10)>>Hr)}else lr>15?Le[rt]=Pr+31744:Le[rt]=Pr+(lr+15<<10)+Ir}return Le}function ts(X){return Array.isArray(X)||Z(X)}var Hh=function(X){return!(X&X-1)&&!!X},Sh=34467,us=3553,el=34067,Ql=34069,tl=6408,kf=6406,Jl=6407,oo=6409,vc=6410,rl=32854,zs=32855,wh=36194,dd=32819,Zl=32820,Fu=33635,mc=34042,Pl=6402,gc=34041,Lc=35904,Oc=35906,tf=36193,Rl=33776,gs=33777,Ah=33778,yc=33779,Wh=35986,ec=35987,Zs=34798,_c=35840,pl=35841,Ws=35842,yp=35843,Pf=36196,Fc=5121,xc=5123,nl=5125,tc=5126,Ch=10242,Xh=10243,$h=10497,rf=33071,_p=33648,rc=10240,kt=10241,Zr=9728,Mr=9729,fi=9984,Vn=9985,Ni=9986,Xa=9987,co=33170,Ul=4352,Th=4353,ou=4354,Mh=34046,$f=3317,bc=37440,il=37441,ys=37443,go=37444,Yf=33984,_s=[fi,Ni,Vn,Xa],Gn=[0,oo,vc,Jl,tl],rs={};rs[oo]=rs[kf]=rs[Pl]=1,rs[gc]=rs[vc]=2,rs[Jl]=rs[Lc]=3,rs[tl]=rs[Oc]=4;function nc(X){return"[object "+X+"]"}var nf=nc("HTMLCanvasElement"),Du=nc("OffscreenCanvas"),Is=nc("CanvasRenderingContext2D"),af=nc("ImageBitmap"),Sn=nc("HTMLImageElement"),of=nc("HTMLVideoElement"),qf=Object.keys(Fr).concat([nf,Du,Is,af,Sn,of]),Ec=[];Ec[Fc]=1,Ec[tc]=4,Ec[tf]=2,Ec[xc]=2,Ec[nl]=4;var fo=[];fo[rl]=2,fo[zs]=2,fo[wh]=2,fo[gc]=4,fo[Rl]=.5,fo[gs]=.5,fo[Ah]=1,fo[yc]=1,fo[Wh]=.5,fo[ec]=1,fo[Zs]=1,fo[_c]=.5,fo[pl]=.25,fo[Ws]=.5,fo[yp]=.25,fo[Pf]=.5;function Bu(X){return Array.isArray(X)&&(X.length===0||typeof X[0]=="number")}function Dc(X){if(!Array.isArray(X))return!1;var Le=X.length;return!(Le===0||!ts(X[0]))}function Nu(X){return Object.prototype.toString.call(X)}function su(X){return Nu(X)===nf}function ic(X){return Nu(X)===Du}function xp(X){return Nu(X)===Is}function sf(X){return Nu(X)===af}function Bc(X){return Nu(X)===Sn}function Rf(X){return Nu(X)===of}function al(X){var Le=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Le&&X&&X.getContext)}function dl(X){var Le=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Le&&X&&"src"in X&&"crossOrigin"in X)}function ga(X){if(!X)return!1;if(al(X)||dl(X))return!0;var Le=Nu(X);return qf.indexOf(Le)>=0?!0:Bu(X)||Dc(X)||Cu(X)}function ac(X){return Fr[Object.prototype.toString.call(X)]|0}function vl(X,Le){var rt=Le.length;switch(X.type){case Fc:case xc:case nl:case tc:var Kt=ar.allocType(X.type,rt);Kt.set(Le),X.data=Kt;break;case tf:X.data=Kl(Le);break;default:j.raise("unsupported texture type, must specify a typed array")}}function Ya(X,Le){return ar.allocType(X.type===tf?tc:X.type,Le)}function xs(X,Le){X.type===tf?(X.data=Kl(Le),ar.freeType(Le)):X.data=Le}function Nc(X,Le,rt,Kt,Pr,lr){for(var Ir=X.width,Hr=X.height,Qr=X.channels,an=Ir*Hr*Qr,cn=Ya(X,an),hn=0,_n=0;_n<Hr;++_n)for(var Ur=0;Ur<Ir;++Ur)for(var sn=0;sn<Qr;++sn)cn[hn++]=Le[rt*Ur+Kt*_n+Pr*sn+lr];xs(X,cn)}function Yo(X,Le,rt,Kt,Pr,lr){var Ir;if(typeof fo[X]!="undefined"?Ir=fo[X]:Ir=rs[X]*Ec[Le],lr&&(Ir*=6),Pr){for(var Hr=0,Qr=rt;Qr>=1;)Hr+=Ir*Qr*Qr,Qr/=2;return Hr}else return Ir*rt*Kt}function bu(X,Le,rt,Kt,Pr,lr,Ir){var Hr={"don't care":Ul,"dont care":Ul,nice:ou,fast:Th},Qr={repeat:$h,clamp:rf,mirror:_p},an={nearest:Zr,linear:Mr},cn=_({mipmap:Xa,"nearest mipmap nearest":fi,"linear mipmap nearest":Vn,"nearest mipmap linear":Ni,"linear mipmap linear":Xa},an),hn={none:0,browser:go},_n={uint8:Fc,rgba4:dd,rgb565:Fu,"rgb5 a1":Zl},Ur={alpha:kf,luminance:oo,"luminance alpha":vc,rgb:Jl,rgba:tl,rgba4:rl,"rgb5 a1":zs,rgb565:wh},sn={};Le.ext_srgb&&(Ur.srgb=Lc,Ur.srgba=Oc),Le.oes_texture_float&&(_n.float32=_n.float=tc),Le.oes_texture_half_float&&(_n.float16=_n["half float"]=tf),Le.webgl_depth_texture&&(_(Ur,{depth:Pl,"depth stencil":gc}),_(_n,{uint16:xc,uint32:nl,"depth stencil":mc})),Le.webgl_compressed_texture_s3tc&&_(sn,{"rgb s3tc dxt1":Rl,"rgba s3tc dxt1":gs,"rgba s3tc dxt3":Ah,"rgba s3tc dxt5":yc}),Le.webgl_compressed_texture_atc&&_(sn,{"rgb atc":Wh,"rgba atc explicit alpha":ec,"rgba atc interpolated alpha":Zs}),Le.webgl_compressed_texture_pvrtc&&_(sn,{"rgb pvrtc 4bppv1":_c,"rgb pvrtc 2bppv1":pl,"rgba pvrtc 4bppv1":Ws,"rgba pvrtc 2bppv1":yp}),Le.webgl_compressed_texture_etc1&&(sn["rgb etc1"]=Pf);var zt=Array.prototype.slice.call(X.getParameter(Sh)||new Uint32Array(0));Object.keys(sn).forEach(function(We){var vr=sn[We];zt.indexOf(vr)>=0&&(Ur[We]=vr)});var xr=Object.keys(Ur);rt.textureFormats=xr;var nn=[];Object.keys(Ur).forEach(function(We){var vr=Ur[We];nn[vr]=We});var wn=[];Object.keys(_n).forEach(function(We){var vr=_n[We];wn[vr]=We});var Dr=[];Object.keys(an).forEach(function(We){var vr=an[We];Dr[vr]=We});var pn=[];Object.keys(cn).forEach(function(We){var vr=cn[We];pn[vr]=We});var Mn=[];Object.keys(Qr).forEach(function(We){var vr=Qr[We];Mn[vr]=We});var Ei=xr.reduce(function(We,vr){var rr=Ur[vr];return rr===oo||rr===kf||rr===oo||rr===vc||rr===Pl||rr===gc||Le.ext_srgb&&(rr===Lc||rr===Oc)?We[rr]=rr:rr===zs||vr.indexOf("rgba")>=0?We[rr]=tl:We[rr]=Jl,We},{});function kr(){this.internalformat=tl,this.format=tl,this.type=Fc,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=go,this.width=0,this.height=0,this.channels=0}function Lr(We,vr){We.internalformat=vr.internalformat,We.format=vr.format,We.type=vr.type,We.compressed=vr.compressed,We.premultiplyAlpha=vr.premultiplyAlpha,We.flipY=vr.flipY,We.unpackAlignment=vr.unpackAlignment,We.colorSpace=vr.colorSpace,We.width=vr.width,We.height=vr.height,We.channels=vr.channels}function Kn(We,vr){if(!(typeof vr!="object"||!vr)){if("premultiplyAlpha"in vr&&(j.type(vr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),We.premultiplyAlpha=vr.premultiplyAlpha),"flipY"in vr&&(j.type(vr.flipY,"boolean","invalid texture flip"),We.flipY=vr.flipY),"alignment"in vr&&(j.oneOf(vr.alignment,[1,2,4,8],"invalid texture unpack alignment"),We.unpackAlignment=vr.alignment),"colorSpace"in vr&&(j.parameter(vr.colorSpace,hn,"invalid colorSpace"),We.colorSpace=hn[vr.colorSpace]),"type"in vr){var rr=vr.type;j(Le.oes_texture_float||!(rr==="float"||rr==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),j(Le.oes_texture_half_float||!(rr==="half float"||rr==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),j(Le.webgl_depth_texture||!(rr==="uint16"||rr==="uint32"||rr==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),j.parameter(rr,_n,"invalid texture type"),We.type=_n[rr]}var Xn=We.width,Aa=We.height,Ze=We.channels,Se=!1;"shape"in vr?(j(Array.isArray(vr.shape)&&vr.shape.length>=2,"shape must be an array"),Xn=vr.shape[0],Aa=vr.shape[1],vr.shape.length===3&&(Ze=vr.shape[2],j(Ze>0&&Ze<=4,"invalid number of channels"),Se=!0),j(Xn>=0&&Xn<=rt.maxTextureSize,"invalid width"),j(Aa>=0&&Aa<=rt.maxTextureSize,"invalid height")):("radius"in vr&&(Xn=Aa=vr.radius,j(Xn>=0&&Xn<=rt.maxTextureSize,"invalid radius")),"width"in vr&&(Xn=vr.width,j(Xn>=0&&Xn<=rt.maxTextureSize,"invalid width")),"height"in vr&&(Aa=vr.height,j(Aa>=0&&Aa<=rt.maxTextureSize,"invalid height")),"channels"in vr&&(Ze=vr.channels,j(Ze>0&&Ze<=4,"invalid number of channels"),Se=!0)),We.width=Xn|0,We.height=Aa|0,We.channels=Ze|0;var pt=!1;if("format"in vr){var Lt=vr.format;j(Le.webgl_depth_texture||!(Lt==="depth"||Lt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),j.parameter(Lt,Ur,"invalid texture format");var sr=We.internalformat=Ur[Lt];We.format=Ei[sr],Lt in _n&&("type"in vr||(We.type=_n[Lt])),Lt in sn&&(We.compressed=!0),pt=!0}!Se&&pt?We.channels=rs[We.format]:Se&&!pt?We.channels!==Gn[We.format]&&(We.format=We.internalformat=Gn[We.channels]):pt&&Se&&j(We.channels===rs[We.format],"number of channels inconsistent with specified format")}}function In(We){X.pixelStorei(bc,We.flipY),X.pixelStorei(il,We.premultiplyAlpha),X.pixelStorei(ys,We.colorSpace),X.pixelStorei($f,We.unpackAlignment)}function rn(){kr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function On(We,vr){var rr=null;if(ga(vr)?rr=vr:vr&&(j.type(vr,"object","invalid pixel data type"),Kn(We,vr),"x"in vr&&(We.xOffset=vr.x|0),"y"in vr&&(We.yOffset=vr.y|0),ga(vr.data)&&(rr=vr.data)),j(!We.compressed||rr instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),vr.copy){j(!rr,"can not specify copy and data field for the same texture");var Xn=Pr.viewportWidth,Aa=Pr.viewportHeight;We.width=We.width||Xn-We.xOffset,We.height=We.height||Aa-We.yOffset,We.needsCopy=!0,j(We.xOffset>=0&&We.xOffset<Xn&&We.yOffset>=0&&We.yOffset<Aa&&We.width>0&&We.width<=Xn&&We.height>0&&We.height<=Aa,"copy texture read out of bounds")}else if(!rr)We.width=We.width||1,We.height=We.height||1,We.channels=We.channels||4;else if(Z(rr))We.channels=We.channels||4,We.data=rr,!("type"in vr)&&We.type===Fc&&(We.type=ac(rr));else if(Bu(rr))We.channels=We.channels||4,vl(We,rr),We.alignment=1,We.needsFree=!0;else if(Cu(rr)){var Ze=rr.data;!Array.isArray(Ze)&&We.type===Fc&&(We.type=ac(Ze));var Se=rr.shape,pt=rr.stride,Lt,sr,Et,et,Tt,Fe;Se.length===3?(Et=Se[2],Fe=pt[2]):(j(Se.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Et=1,Fe=1),Lt=Se[0],sr=Se[1],et=pt[0],Tt=pt[1],We.alignment=1,We.width=Lt,We.height=sr,We.channels=Et,We.format=We.internalformat=Gn[Et],We.needsFree=!0,Nc(We,Ze,et,Tt,Fe,rr.offset)}else if(al(rr)||su(rr)||ic(rr)||xp(rr))al(rr)||su(rr)||ic(rr)?We.element=rr:We.element=rr.canvas,We.width=We.element.width,We.height=We.element.height,We.channels=4;else if(sf(rr))We.element=rr,We.width=rr.width,We.height=rr.height,We.channels=4;else if(Bc(rr))We.element=rr,We.width=rr.naturalWidth,We.height=rr.naturalHeight,We.channels=4;else if(dl(rr))We.element=rr,We.width=rr.width,We.height=rr.height,We.channels=4;else if(Rf(rr))We.element=rr,We.width=rr.videoWidth,We.height=rr.videoHeight,We.channels=4;else if(Dc(rr)){var ct=We.width||rr[0].length,Ve=We.height||rr.length,Zt=We.channels;ts(rr[0][0])?Zt=Zt||rr[0][0].length:Zt=Zt||1;for(var Qt=Ne.shape(rr),Vr=1,En=0;En<Qt.length;++En)Vr*=Qt[En];var An=Ya(We,Vr);Ne.flatten(rr,Qt,"",An),xs(We,An),We.alignment=1,We.width=ct,We.height=Ve,We.channels=Zt,We.format=We.internalformat=Gn[Zt],We.needsFree=!0}We.type===tc?j(rt.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):We.type===tf&&j(rt.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Rn(We,vr,rr){var Xn=We.element,Aa=We.data,Ze=We.internalformat,Se=We.format,pt=We.type,Lt=We.width,sr=We.height;In(We),Xn?X.texImage2D(vr,rr,Se,Se,pt,Xn):We.compressed?X.compressedTexImage2D(vr,rr,Ze,Lt,sr,0,Aa):We.needsCopy?(Kt(),X.copyTexImage2D(vr,rr,Se,We.xOffset,We.yOffset,Lt,sr,0)):X.texImage2D(vr,rr,Se,Lt,sr,0,Se,pt,Aa||null)}function aa(We,vr,rr,Xn,Aa){var Ze=We.element,Se=We.data,pt=We.internalformat,Lt=We.format,sr=We.type,Et=We.width,et=We.height;In(We),Ze?X.texSubImage2D(vr,Aa,rr,Xn,Lt,sr,Ze):We.compressed?X.compressedTexSubImage2D(vr,Aa,rr,Xn,pt,Et,et,Se):We.needsCopy?(Kt(),X.copyTexSubImage2D(vr,Aa,rr,Xn,We.xOffset,We.yOffset,Et,et)):X.texSubImage2D(vr,Aa,rr,Xn,Et,et,Lt,sr,Se)}var zi=[];function Pn(){return zi.pop()||new rn}function zn(We){We.needsFree&&ar.freeType(We.data),rn.call(We),zi.push(We)}function ki(){kr.call(this),this.genMipmaps=!1,this.mipmapHint=Ul,this.mipmask=0,this.images=Array(16)}function Vi(We,vr,rr){var Xn=We.images[0]=Pn();We.mipmask=1,Xn.width=We.width=vr,Xn.height=We.height=rr,Xn.channels=We.channels=4}function _a(We,vr){var rr=null;if(ga(vr))rr=We.images[0]=Pn(),Lr(rr,We),On(rr,vr),We.mipmask=1;else if(Kn(We,vr),Array.isArray(vr.mipmap))for(var Xn=vr.mipmap,Aa=0;Aa<Xn.length;++Aa)rr=We.images[Aa]=Pn(),Lr(rr,We),rr.width>>=Aa,rr.height>>=Aa,On(rr,Xn[Aa]),We.mipmask|=1<<Aa;else rr=We.images[0]=Pn(),Lr(rr,We),On(rr,vr),We.mipmask=1;Lr(We,We.images[0]),We.compressed&&(We.internalformat===Rl||We.internalformat===gs||We.internalformat===Ah||We.internalformat===yc)&&j(We.width%4==0&&We.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function io(We,vr){for(var rr=We.images,Xn=0;Xn<rr.length;++Xn){if(!rr[Xn])return;Rn(rr[Xn],vr,Xn)}}var Ro=[];function qi(){var We=Ro.pop()||new ki;kr.call(We),We.mipmask=0;for(var vr=0;vr<16;++vr)We.images[vr]=null;return We}function Gr(We){for(var vr=We.images,rr=0;rr<vr.length;++rr)vr[rr]&&zn(vr[rr]),vr[rr]=null;Ro.push(We)}function Lo(){this.minFilter=Zr,this.magFilter=Zr,this.wrapS=rf,this.wrapT=rf,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Ul}function cu(We,vr){if("min"in vr){var rr=vr.min;j.parameter(rr,cn),We.minFilter=cn[rr],_s.indexOf(We.minFilter)>=0&&!("faces"in vr)&&(We.genMipmaps=!0)}if("mag"in vr){var Xn=vr.mag;j.parameter(Xn,an),We.magFilter=an[Xn]}var Aa=We.wrapS,Ze=We.wrapT;if("wrap"in vr){var Se=vr.wrap;typeof Se=="string"?(j.parameter(Se,Qr),Aa=Ze=Qr[Se]):Array.isArray(Se)&&(j.parameter(Se[0],Qr),j.parameter(Se[1],Qr),Aa=Qr[Se[0]],Ze=Qr[Se[1]])}else{if("wrapS"in vr){var pt=vr.wrapS;j.parameter(pt,Qr),Aa=Qr[pt]}if("wrapT"in vr){var Lt=vr.wrapT;j.parameter(Lt,Qr),Ze=Qr[Lt]}}if(We.wrapS=Aa,We.wrapT=Ze,"anisotropic"in vr){var sr=vr.anisotropic;j(typeof sr=="number"&&sr>=1&&sr<=rt.maxAnisotropic,"aniso samples must be between 1 and "),We.anisotropic=vr.anisotropic}if("mipmap"in vr){var Et=!1;switch(typeof vr.mipmap){case"string":j.parameter(vr.mipmap,Hr,"invalid mipmap hint"),We.mipmapHint=Hr[vr.mipmap],We.genMipmaps=!0,Et=!0;break;case"boolean":Et=We.genMipmaps=vr.mipmap;break;case"object":j(Array.isArray(vr.mipmap),"invalid mipmap type"),We.genMipmaps=!1,Et=!0;break;default:j.raise("invalid mipmap type")}Et&&!("min"in vr)&&(We.minFilter=fi)}}function Fa(We,vr){X.texParameteri(vr,kt,We.minFilter),X.texParameteri(vr,rc,We.magFilter),X.texParameteri(vr,Ch,We.wrapS),X.texParameteri(vr,Xh,We.wrapT),Le.ext_texture_filter_anisotropic&&X.texParameteri(vr,Mh,We.anisotropic),We.genMipmaps&&(X.hint(co,We.mipmapHint),X.generateMipmap(vr))}var Ko=0,is={},eu=rt.maxTextureUnits,Mo=Array(eu).map(function(){return null});function $i(We){kr.call(this),this.mipmask=0,this.internalformat=tl,this.id=Ko++,this.refCount=1,this.target=We,this.texture=X.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Lo,Ir.profile&&(this.stats={size:0})}function Ls(We){X.activeTexture(Yf),X.bindTexture(We.target,We.texture)}function Ka(){var We=Mo[0];We?X.bindTexture(We.target,We.texture):X.bindTexture(us,null)}function fu(We){var vr=We.texture;j(vr,"must not double destroy texture");var rr=We.unit,Xn=We.target;rr>=0&&(X.activeTexture(Yf+rr),X.bindTexture(Xn,null),Mo[rr]=null),X.deleteTexture(vr),We.texture=null,We.params=null,We.pixels=null,We.refCount=0,delete is[We.id],lr.textureCount--}_($i.prototype,{bind:function(){var We=this;We.bindCount+=1;var vr=We.unit;if(vr<0){for(var rr=0;rr<eu;++rr){var Xn=Mo[rr];if(Xn){if(Xn.bindCount>0)continue;Xn.unit=-1}Mo[rr]=We,vr=rr;break}vr>=eu&&j.raise("insufficient number of texture units"),Ir.profile&&lr.maxTextureUnits<vr+1&&(lr.maxTextureUnits=vr+1),We.unit=vr,X.activeTexture(Yf+vr),X.bindTexture(We.target,We.texture)}return vr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&fu(this)}});function Oi(We,vr){var rr=new $i(us);is[rr.id]=rr,lr.textureCount++;function Xn(Se,pt){var Lt=rr.texInfo;Lo.call(Lt);var sr=qi();return typeof Se=="number"?typeof pt=="number"?Vi(sr,Se|0,pt|0):Vi(sr,Se|0,Se|0):Se?(j.type(Se,"object","invalid arguments to regl.texture"),cu(Lt,Se),_a(sr,Se)):Vi(sr,1,1),Lt.genMipmaps&&(sr.mipmask=(sr.width<<1)-1),rr.mipmask=sr.mipmask,Lr(rr,sr),j.texture2D(Lt,sr,rt),rr.internalformat=sr.internalformat,Xn.width=sr.width,Xn.height=sr.height,Ls(rr),io(sr,us),Fa(Lt,us),Ka(),Gr(sr),Ir.profile&&(rr.stats.size=Yo(rr.internalformat,rr.type,sr.width,sr.height,Lt.genMipmaps,!1)),Xn.format=nn[rr.internalformat],Xn.type=wn[rr.type],Xn.mag=Dr[Lt.magFilter],Xn.min=pn[Lt.minFilter],Xn.wrapS=Mn[Lt.wrapS],Xn.wrapT=Mn[Lt.wrapT],Xn}function Aa(Se,pt,Lt,sr){j(!!Se,"must specify image data");var Et=pt|0,et=Lt|0,Tt=sr|0,Fe=Pn();return Lr(Fe,rr),Fe.width=0,Fe.height=0,On(Fe,Se),Fe.width=Fe.width||(rr.width>>Tt)-Et,Fe.height=Fe.height||(rr.height>>Tt)-et,j(rr.type===Fe.type&&rr.format===Fe.format&&rr.internalformat===Fe.internalformat,"incompatible format for texture.subimage"),j(Et>=0&&et>=0&&Et+Fe.width<=rr.width&&et+Fe.height<=rr.height,"texture.subimage write out of bounds"),j(rr.mipmask&1<<Tt,"missing mipmap data"),j(Fe.data||Fe.element||Fe.needsCopy,"missing image data"),Ls(rr),aa(Fe,us,Et,et,Tt),Ka(),zn(Fe),Xn}function Ze(Se,pt){var Lt=Se|0,sr=pt|0||Lt;if(Lt===rr.width&&sr===rr.height)return Xn;Xn.width=rr.width=Lt,Xn.height=rr.height=sr,Ls(rr);for(var Et=0;rr.mipmask>>Et;++Et){var et=Lt>>Et,Tt=sr>>Et;if(!et||!Tt)break;X.texImage2D(us,Et,rr.format,et,Tt,0,rr.format,rr.type,null)}return Ka(),Ir.profile&&(rr.stats.size=Yo(rr.internalformat,rr.type,Lt,sr,!1,!1)),Xn}return Xn(We,vr),Xn.subimage=Aa,Xn.resize=Ze,Xn._reglType="texture2d",Xn._texture=rr,Ir.profile&&(Xn.stats=rr.stats),Xn.destroy=function(){rr.decRef()},Xn}function va(We,vr,rr,Xn,Aa,Ze){var Se=new $i(el);is[Se.id]=Se,lr.cubeCount++;var pt=new Array(6);function Lt(et,Tt,Fe,ct,Ve,Zt){var Qt,Vr=Se.texInfo;for(Lo.call(Vr),Qt=0;Qt<6;++Qt)pt[Qt]=qi();if(typeof et=="number"||!et){var En=et|0||1;for(Qt=0;Qt<6;++Qt)Vi(pt[Qt],En,En)}else if(typeof et=="object")if(Tt)_a(pt[0],et),_a(pt[1],Tt),_a(pt[2],Fe),_a(pt[3],ct),_a(pt[4],Ve),_a(pt[5],Zt);else if(cu(Vr,et),Kn(Se,et),"faces"in et){var An=et.faces;for(j(Array.isArray(An)&&An.length===6,"cube faces must be a length 6 array"),Qt=0;Qt<6;++Qt)j(typeof An[Qt]=="object"&&!!An[Qt],"invalid input for cube map face"),Lr(pt[Qt],Se),_a(pt[Qt],An[Qt])}else for(Qt=0;Qt<6;++Qt)_a(pt[Qt],et);else j.raise("invalid arguments to cube map");for(Lr(Se,pt[0]),j.optional(function(){rt.npotTextureCube||j(Hh(Se.width)&&Hh(Se.height),"your browser does not support non power or two texture dimensions")}),Vr.genMipmaps?Se.mipmask=(pt[0].width<<1)-1:Se.mipmask=pt[0].mipmask,j.textureCube(Se,Vr,pt,rt),Se.internalformat=pt[0].internalformat,Lt.width=pt[0].width,Lt.height=pt[0].height,Ls(Se),Qt=0;Qt<6;++Qt)io(pt[Qt],Ql+Qt);for(Fa(Vr,el),Ka(),Ir.profile&&(Se.stats.size=Yo(Se.internalformat,Se.type,Lt.width,Lt.height,Vr.genMipmaps,!0)),Lt.format=nn[Se.internalformat],Lt.type=wn[Se.type],Lt.mag=Dr[Vr.magFilter],Lt.min=pn[Vr.minFilter],Lt.wrapS=Mn[Vr.wrapS],Lt.wrapT=Mn[Vr.wrapT],Qt=0;Qt<6;++Qt)Gr(pt[Qt]);return Lt}function sr(et,Tt,Fe,ct,Ve){j(!!Tt,"must specify image data"),j(typeof et=="number"&&et===(et|0)&&et>=0&&et<6,"invalid face");var Zt=Fe|0,Qt=ct|0,Vr=Ve|0,En=Pn();return Lr(En,Se),En.width=0,En.height=0,On(En,Tt),En.width=En.width||(Se.width>>Vr)-Zt,En.height=En.height||(Se.height>>Vr)-Qt,j(Se.type===En.type&&Se.format===En.format&&Se.internalformat===En.internalformat,"incompatible format for texture.subimage"),j(Zt>=0&&Qt>=0&&Zt+En.width<=Se.width&&Qt+En.height<=Se.height,"texture.subimage write out of bounds"),j(Se.mipmask&1<<Vr,"missing mipmap data"),j(En.data||En.element||En.needsCopy,"missing image data"),Ls(Se),aa(En,Ql+et,Zt,Qt,Vr),Ka(),zn(En),Lt}function Et(et){var Tt=et|0;if(Tt!==Se.width){Lt.width=Se.width=Tt,Lt.height=Se.height=Tt,Ls(Se);for(var Fe=0;Fe<6;++Fe)for(var ct=0;Se.mipmask>>ct;++ct)X.texImage2D(Ql+Fe,ct,Se.format,Tt>>ct,Tt>>ct,0,Se.format,Se.type,null);return Ka(),Ir.profile&&(Se.stats.size=Yo(Se.internalformat,Se.type,Lt.width,Lt.height,!1,!0)),Lt}}return Lt(We,vr,rr,Xn,Aa,Ze),Lt.subimage=sr,Lt.resize=Et,Lt._reglType="textureCube",Lt._texture=Se,Ir.profile&&(Lt.stats=Se.stats),Lt.destroy=function(){Se.decRef()},Lt}function Ga(){for(var We=0;We<eu;++We)X.activeTexture(Yf+We),X.bindTexture(us,null),Mo[We]=null;_e(is).forEach(fu),lr.cubeCount=0,lr.textureCount=0}Ir.profile&&(lr.getTotalTextureSize=function(){var We=0;return Object.keys(is).forEach(function(vr){We+=is[vr].stats.size}),We});function ws(){for(var We=0;We<eu;++We){var vr=Mo[We];vr&&(vr.bindCount=0,vr.unit=-1,Mo[We]=null)}_e(is).forEach(function(rr){rr.texture=X.createTexture(),X.bindTexture(rr.target,rr.texture);for(var Xn=0;Xn<32;++Xn)if((rr.mipmask&1<<Xn)!=0)if(rr.target===us)X.texImage2D(us,Xn,rr.internalformat,rr.width>>Xn,rr.height>>Xn,0,rr.internalformat,rr.type,null);else for(var Aa=0;Aa<6;++Aa)X.texImage2D(Ql+Aa,Xn,rr.internalformat,rr.width>>Xn,rr.height>>Xn,0,rr.internalformat,rr.type,null);Fa(rr.texInfo,rr.target)})}function gf(){for(var We=0;We<eu;++We){var vr=Mo[We];vr&&(vr.bindCount=0,vr.unit=-1,Mo[We]=null),X.activeTexture(Yf+We),X.bindTexture(us,null),X.bindTexture(el,null)}}return{create2D:Oi,createCube:va,clear:Ga,getTexture:function(We){return null},restore:ws,refresh:gf}}var wa=36161,mi=32854,ai=32855,uf=36194,ks=33189,ku=36168,ls=34041,ol=35907,Vl=34836,Kf=34842,qa=34843,zo=[];zo[mi]=2,zo[ai]=2,zo[uf]=2,zo[ks]=2,zo[ku]=1,zo[ls]=4,zo[ol]=4,zo[Vl]=16,zo[Kf]=8,zo[qa]=6;function bp(X,Le,rt){return zo[X]*Le*rt}var zc=function(X,Le,rt,Kt,Pr){var lr={rgba4:mi,rgb565:uf,"rgb5 a1":ai,depth:ks,stencil:ku,"depth stencil":ls};Le.ext_srgb&&(lr.srgba=ol),Le.ext_color_buffer_half_float&&(lr.rgba16f=Kf,lr.rgb16f=qa),Le.webgl_color_buffer_float&&(lr.rgba32f=Vl);var Ir=[];Object.keys(lr).forEach(function(Ur){var sn=lr[Ur];Ir[sn]=Ur});var Hr=0,Qr={};function an(Ur){this.id=Hr++,this.refCount=1,this.renderbuffer=Ur,this.format=mi,this.width=0,this.height=0,Pr.profile&&(this.stats={size:0})}an.prototype.decRef=function(){--this.refCount<=0&&cn(this)};function cn(Ur){var sn=Ur.renderbuffer;j(sn,"must not double destroy renderbuffer"),X.bindRenderbuffer(wa,null),X.deleteRenderbuffer(sn),Ur.renderbuffer=null,Ur.refCount=0,delete Qr[Ur.id],Kt.renderbufferCount--}function hn(Ur,sn){var zt=new an(X.createRenderbuffer());Qr[zt.id]=zt,Kt.renderbufferCount++;function xr(wn,Dr){var pn=0,Mn=0,Ei=mi;if(typeof wn=="object"&&wn){var kr=wn;if("shape"in kr){var Lr=kr.shape;j(Array.isArray(Lr)&&Lr.length>=2,"invalid renderbuffer shape"),pn=Lr[0]|0,Mn=Lr[1]|0}else"radius"in kr&&(pn=Mn=kr.radius|0),"width"in kr&&(pn=kr.width|0),"height"in kr&&(Mn=kr.height|0);"format"in kr&&(j.parameter(kr.format,lr,"invalid renderbuffer format"),Ei=lr[kr.format])}else typeof wn=="number"?(pn=wn|0,typeof Dr=="number"?Mn=Dr|0:Mn=pn):wn?j.raise("invalid arguments to renderbuffer constructor"):pn=Mn=1;if(j(pn>0&&Mn>0&&pn<=rt.maxRenderbufferSize&&Mn<=rt.maxRenderbufferSize,"invalid renderbuffer size"),!(pn===zt.width&&Mn===zt.height&&Ei===zt.format))return xr.width=zt.width=pn,xr.height=zt.height=Mn,zt.format=Ei,X.bindRenderbuffer(wa,zt.renderbuffer),X.renderbufferStorage(wa,Ei,pn,Mn),j(X.getError()===0,"invalid render buffer format"),Pr.profile&&(zt.stats.size=bp(zt.format,zt.width,zt.height)),xr.format=Ir[zt.format],xr}function nn(wn,Dr){var pn=wn|0,Mn=Dr|0||pn;return pn===zt.width&&Mn===zt.height||(j(pn>0&&Mn>0&&pn<=rt.maxRenderbufferSize&&Mn<=rt.maxRenderbufferSize,"invalid renderbuffer size"),xr.width=zt.width=pn,xr.height=zt.height=Mn,X.bindRenderbuffer(wa,zt.renderbuffer),X.renderbufferStorage(wa,zt.format,pn,Mn),j(X.getError()===0,"invalid render buffer format"),Pr.profile&&(zt.stats.size=bp(zt.format,zt.width,zt.height))),xr}return xr(Ur,sn),xr.resize=nn,xr._reglType="renderbuffer",xr._renderbuffer=zt,Pr.profile&&(xr.stats=zt.stats),xr.destroy=function(){zt.decRef()},xr}Pr.profile&&(Kt.getTotalRenderbufferSize=function(){var Ur=0;return Object.keys(Qr).forEach(function(sn){Ur+=Qr[sn].stats.size}),Ur});function _n(){_e(Qr).forEach(function(Ur){Ur.renderbuffer=X.createRenderbuffer(),X.bindRenderbuffer(wa,Ur.renderbuffer),X.renderbufferStorage(wa,Ur.format,Ur.width,Ur.height)}),X.bindRenderbuffer(wa,null)}return{create:hn,clear:function(){_e(Qr).forEach(cn)},restore:_n}},sl=36160,zu=36161,bs=3553,Ie=34069,Qs=36064,Sc=36096,Js=36128,Ba=33306,Oa=36053,Ll=36054,Zu=36055,Gl=36057,Zc=36061,Uc=36193,Ih=5121,Vc=5126,Uu=6407,ul=6408,jl=6402,Lf=[Uu,ul],Ti=[];Ti[ul]=4,Ti[Uu]=3;var f=[];f[Ih]=1,f[Vc]=4,f[Uc]=2;var d=32854,h=32855,y=36194,C=33189,I=36168,L=34041,B=35907,Y=34836,ae=34842,Ce=34843,we=[d,h,y,B,ae,Ce,Y],ke={};ke[Oa]="complete",ke[Ll]="incomplete attachment",ke[Gl]="incomplete dimensions",ke[Zu]="incomplete, missing attachment",ke[Zc]="unsupported";function Qe(X,Le,rt,Kt,Pr,lr){var Ir={cur:null,next:null,dirty:!1,setFBO:null},Hr=["rgba"],Qr=["rgba4","rgb565","rgb5 a1"];Le.ext_srgb&&Qr.push("srgba"),Le.ext_color_buffer_half_float&&Qr.push("rgba16f","rgb16f"),Le.webgl_color_buffer_float&&Qr.push("rgba32f");var an=["uint8"];Le.oes_texture_half_float&&an.push("half float","float16"),Le.oes_texture_float&&an.push("float","float32");function cn(rn,On,Rn){this.target=rn,this.texture=On,this.renderbuffer=Rn;var aa=0,zi=0;On?(aa=On.width,zi=On.height):Rn&&(aa=Rn.width,zi=Rn.height),this.width=aa,this.height=zi}function hn(rn){rn&&(rn.texture&&rn.texture._texture.decRef(),rn.renderbuffer&&rn.renderbuffer._renderbuffer.decRef())}function _n(rn,On,Rn){if(!!rn)if(rn.texture){var aa=rn.texture._texture,zi=Math.max(1,aa.width),Pn=Math.max(1,aa.height);j(zi===On&&Pn===Rn,"inconsistent width/height for supplied texture"),aa.refCount+=1}else{var zn=rn.renderbuffer._renderbuffer;j(zn.width===On&&zn.height===Rn,"inconsistent width/height for renderbuffer"),zn.refCount+=1}}function Ur(rn,On){On&&(On.texture?X.framebufferTexture2D(sl,rn,On.target,On.texture._texture.texture,0):X.framebufferRenderbuffer(sl,rn,zu,On.renderbuffer._renderbuffer.renderbuffer))}function sn(rn){var On=bs,Rn=null,aa=null,zi=rn;typeof rn=="object"&&(zi=rn.data,"target"in rn&&(On=rn.target|0)),j.type(zi,"function","invalid attachment data");var Pn=zi._reglType;return Pn==="texture2d"?(Rn=zi,j(On===bs)):Pn==="textureCube"?(Rn=zi,j(On>=Ie&&On<Ie+6,"invalid cube map target")):Pn==="renderbuffer"?(aa=zi,On=zu):j.raise("invalid regl object for attachment"),new cn(On,Rn,aa)}function zt(rn,On,Rn,aa,zi){if(Rn){var Pn=Kt.create2D({width:rn,height:On,format:aa,type:zi});return Pn._texture.refCount=0,new cn(bs,Pn,null)}else{var zn=Pr.create({width:rn,height:On,format:aa});return zn._renderbuffer.refCount=0,new cn(zu,null,zn)}}function xr(rn){return rn&&(rn.texture||rn.renderbuffer)}function nn(rn,On,Rn){rn&&(rn.texture?rn.texture.resize(On,Rn):rn.renderbuffer&&rn.renderbuffer.resize(On,Rn),rn.width=On,rn.height=Rn)}var wn=0,Dr={};function pn(){this.id=wn++,Dr[this.id]=this,this.framebuffer=X.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Mn(rn){rn.colorAttachments.forEach(hn),hn(rn.depthAttachment),hn(rn.stencilAttachment),hn(rn.depthStencilAttachment)}function Ei(rn){var On=rn.framebuffer;j(On,"must not double destroy framebuffer"),X.deleteFramebuffer(On),rn.framebuffer=null,lr.framebufferCount--,delete Dr[rn.id]}function kr(rn){var On;X.bindFramebuffer(sl,rn.framebuffer);var Rn=rn.colorAttachments;for(On=0;On<Rn.length;++On)Ur(Qs+On,Rn[On]);for(On=Rn.length;On<rt.maxColorAttachments;++On)X.framebufferTexture2D(sl,Qs+On,bs,null,0);X.framebufferTexture2D(sl,Ba,bs,null,0),X.framebufferTexture2D(sl,Sc,bs,null,0),X.framebufferTexture2D(sl,Js,bs,null,0),Ur(Sc,rn.depthAttachment),Ur(Js,rn.stencilAttachment),Ur(Ba,rn.depthStencilAttachment);var aa=X.checkFramebufferStatus(sl);!X.isContextLost()&&aa!==Oa&&j.raise("framebuffer configuration not supported, status = "+ke[aa]),X.bindFramebuffer(sl,Ir.next?Ir.next.framebuffer:null),Ir.cur=Ir.next,X.getError()}function Lr(rn,On){var Rn=new pn;lr.framebufferCount++;function aa(Pn,zn){var ki;j(Ir.next!==Rn,"can not update framebuffer which is currently in use");var Vi=0,_a=0,io=!0,Ro=!0,qi=null,Gr=!0,Lo="rgba",cu="uint8",Fa=1,Ko=null,is=null,eu=null,Mo=!1;if(typeof Pn=="number")Vi=Pn|0,_a=zn|0||Vi;else if(!Pn)Vi=_a=1;else{j.type(Pn,"object","invalid arguments for framebuffer");var $i=Pn;if("shape"in $i){var Ls=$i.shape;j(Array.isArray(Ls)&&Ls.length>=2,"invalid shape for framebuffer"),Vi=Ls[0],_a=Ls[1]}else"radius"in $i&&(Vi=_a=$i.radius),"width"in $i&&(Vi=$i.width),"height"in $i&&(_a=$i.height);("color"in $i||"colors"in $i)&&(qi=$i.color||$i.colors,Array.isArray(qi)&&j(qi.length===1||Le.webgl_draw_buffers,"multiple render targets not supported")),qi||("colorCount"in $i&&(Fa=$i.colorCount|0,j(Fa>0,"invalid color buffer count")),"colorTexture"in $i&&(Gr=!!$i.colorTexture,Lo="rgba4"),"colorType"in $i&&(cu=$i.colorType,Gr?(j(Le.oes_texture_float||!(cu==="float"||cu==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),j(Le.oes_texture_half_float||!(cu==="half float"||cu==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):cu==="half float"||cu==="float16"?(j(Le.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Lo="rgba16f"):(cu==="float"||cu==="float32")&&(j(Le.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Lo="rgba32f"),j.oneOf(cu,an,"invalid color type")),"colorFormat"in $i&&(Lo=$i.colorFormat,Hr.indexOf(Lo)>=0?Gr=!0:Qr.indexOf(Lo)>=0?Gr=!1:j.optional(function(){Gr?j.oneOf($i.colorFormat,Hr,"invalid color format for texture"):j.oneOf($i.colorFormat,Qr,"invalid color format for renderbuffer")}))),("depthTexture"in $i||"depthStencilTexture"in $i)&&(Mo=!!($i.depthTexture||$i.depthStencilTexture),j(!Mo||Le.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in $i&&(typeof $i.depth=="boolean"?io=$i.depth:(Ko=$i.depth,Ro=!1)),"stencil"in $i&&(typeof $i.stencil=="boolean"?Ro=$i.stencil:(is=$i.stencil,io=!1)),"depthStencil"in $i&&(typeof $i.depthStencil=="boolean"?io=Ro=$i.depthStencil:(eu=$i.depthStencil,io=!1,Ro=!1))}var Ka=null,fu=null,Oi=null,va=null;if(Array.isArray(qi))Ka=qi.map(sn);else if(qi)Ka=[sn(qi)];else for(Ka=new Array(Fa),ki=0;ki<Fa;++ki)Ka[ki]=zt(Vi,_a,Gr,Lo,cu);j(Le.webgl_draw_buffers||Ka.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),j(Ka.length<=rt.maxColorAttachments,"too many color attachments, not supported"),Vi=Vi||Ka[0].width,_a=_a||Ka[0].height,Ko?fu=sn(Ko):io&&!Ro&&(fu=zt(Vi,_a,Mo,"depth","uint32")),is?Oi=sn(is):Ro&&!io&&(Oi=zt(Vi,_a,!1,"stencil","uint8")),eu?va=sn(eu):!Ko&&!is&&Ro&&io&&(va=zt(Vi,_a,Mo,"depth stencil","depth stencil")),j(!!Ko+!!is+!!eu<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Ga=null;for(ki=0;ki<Ka.length;++ki)if(_n(Ka[ki],Vi,_a),j(!Ka[ki]||Ka[ki].texture&&Lf.indexOf(Ka[ki].texture._texture.format)>=0||Ka[ki].renderbuffer&&we.indexOf(Ka[ki].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+ki+" is invalid"),Ka[ki]&&Ka[ki].texture){var ws=Ti[Ka[ki].texture._texture.format]*f[Ka[ki].texture._texture.type];Ga===null?Ga=ws:j(Ga===ws,"all color attachments much have the same number of bits per pixel.")}return _n(fu,Vi,_a),j(!fu||fu.texture&&fu.texture._texture.format===jl||fu.renderbuffer&&fu.renderbuffer._renderbuffer.format===C,"invalid depth attachment for framebuffer object"),_n(Oi,Vi,_a),j(!Oi||Oi.renderbuffer&&Oi.renderbuffer._renderbuffer.format===I,"invalid stencil attachment for framebuffer object"),_n(va,Vi,_a),j(!va||va.texture&&va.texture._texture.format===L||va.renderbuffer&&va.renderbuffer._renderbuffer.format===L,"invalid depth-stencil attachment for framebuffer object"),Mn(Rn),Rn.width=Vi,Rn.height=_a,Rn.colorAttachments=Ka,Rn.depthAttachment=fu,Rn.stencilAttachment=Oi,Rn.depthStencilAttachment=va,aa.color=Ka.map(xr),aa.depth=xr(fu),aa.stencil=xr(Oi),aa.depthStencil=xr(va),aa.width=Rn.width,aa.height=Rn.height,kr(Rn),aa}function zi(Pn,zn){j(Ir.next!==Rn,"can not resize a framebuffer which is currently in use");var ki=Math.max(Pn|0,1),Vi=Math.max(zn|0||ki,1);if(ki===Rn.width&&Vi===Rn.height)return aa;for(var _a=Rn.colorAttachments,io=0;io<_a.length;++io)nn(_a[io],ki,Vi);return nn(Rn.depthAttachment,ki,Vi),nn(Rn.stencilAttachment,ki,Vi),nn(Rn.depthStencilAttachment,ki,Vi),Rn.width=aa.width=ki,Rn.height=aa.height=Vi,kr(Rn),aa}return aa(rn,On),_(aa,{resize:zi,_reglType:"framebuffer",_framebuffer:Rn,destroy:function(){Ei(Rn),Mn(Rn)},use:function(Pn){Ir.setFBO({framebuffer:aa},Pn)}})}function Kn(rn){var On=Array(6);function Rn(zi){var Pn;j(On.indexOf(Ir.next)<0,"can not update framebuffer which is currently in use");var zn={color:null},ki=0,Vi=null,_a="rgba",io="uint8",Ro=1;if(typeof zi=="number")ki=zi|0;else if(!zi)ki=1;else{j.type(zi,"object","invalid arguments for framebuffer");var qi=zi;if("shape"in qi){var Gr=qi.shape;j(Array.isArray(Gr)&&Gr.length>=2,"invalid shape for framebuffer"),j(Gr[0]===Gr[1],"cube framebuffer must be square"),ki=Gr[0]}else"radius"in qi&&(ki=qi.radius|0),"width"in qi?(ki=qi.width|0,"height"in qi&&j(qi.height===ki,"must be square")):"height"in qi&&(ki=qi.height|0);("color"in qi||"colors"in qi)&&(Vi=qi.color||qi.colors,Array.isArray(Vi)&&j(Vi.length===1||Le.webgl_draw_buffers,"multiple render targets not supported")),Vi||("colorCount"in qi&&(Ro=qi.colorCount|0,j(Ro>0,"invalid color buffer count")),"colorType"in qi&&(j.oneOf(qi.colorType,an,"invalid color type"),io=qi.colorType),"colorFormat"in qi&&(_a=qi.colorFormat,j.oneOf(qi.colorFormat,Hr,"invalid color format for texture"))),"depth"in qi&&(zn.depth=qi.depth),"stencil"in qi&&(zn.stencil=qi.stencil),"depthStencil"in qi&&(zn.depthStencil=qi.depthStencil)}var Lo;if(Vi)if(Array.isArray(Vi))for(Lo=[],Pn=0;Pn<Vi.length;++Pn)Lo[Pn]=Vi[Pn];else Lo=[Vi];else{Lo=Array(Ro);var cu={radius:ki,format:_a,type:io};for(Pn=0;Pn<Ro;++Pn)Lo[Pn]=Kt.createCube(cu)}for(zn.color=Array(Lo.length),Pn=0;Pn<Lo.length;++Pn){var Fa=Lo[Pn];j(typeof Fa=="function"&&Fa._reglType==="textureCube","invalid cube map"),ki=ki||Fa.width,j(Fa.width===ki&&Fa.height===ki,"invalid cube map shape"),zn.color[Pn]={target:Ie,data:Lo[Pn]}}for(Pn=0;Pn<6;++Pn){for(var Ko=0;Ko<Lo.length;++Ko)zn.color[Ko].target=Ie+Pn;Pn>0&&(zn.depth=On[0].depth,zn.stencil=On[0].stencil,zn.depthStencil=On[0].depthStencil),On[Pn]?On[Pn](zn):On[Pn]=Lr(zn)}return _(Rn,{width:ki,height:ki,color:Lo})}function aa(zi){var Pn,zn=zi|0;if(j(zn>0&&zn<=rt.maxCubeMapSize,"invalid radius for cube fbo"),zn===Rn.width)return Rn;var ki=Rn.color;for(Pn=0;Pn<ki.length;++Pn)ki[Pn].resize(zn);for(Pn=0;Pn<6;++Pn)On[Pn].resize(zn);return Rn.width=Rn.height=zn,Rn}return Rn(rn),_(Rn,{faces:On,resize:aa,_reglType:"framebufferCube",destroy:function(){On.forEach(function(zi){zi.destroy()})}})}function In(){Ir.cur=null,Ir.next=null,Ir.dirty=!0,_e(Dr).forEach(function(rn){rn.framebuffer=X.createFramebuffer(),kr(rn)})}return _(Ir,{getFramebuffer:function(rn){if(typeof rn=="function"&&rn._reglType==="framebuffer"){var On=rn._framebuffer;if(On instanceof pn)return On}return null},create:Lr,createCube:Kn,clear:function(){_e(Dr).forEach(Ei)},restore:In})}var Ye=5126,mt=34962,je=34963,dt=["attributes","elements","offset","count","primitive","instances"];function vt(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ye,this.offset=0,this.stride=0,this.divisor=0}function $t(X,Le,rt,Kt,Pr,lr,Ir){for(var Hr=rt.maxAttributes,Qr=new Array(Hr),an=0;an<Hr;++an)Qr[an]=new vt;var cn=0,hn={},_n={Record:vt,scope:{},state:Qr,currentVAO:null,targetVAO:null,restore:sn()?Mn:function(){},createVAO:Ei,getVAO:xr,destroyBuffer:Ur,setVAO:sn()?nn:wn,clear:sn()?Dr:function(){}};function Ur(kr){for(var Lr=0;Lr<Qr.length;++Lr){var Kn=Qr[Lr];Kn.buffer===kr&&(X.disableVertexAttribArray(Lr),Kn.buffer=null)}}function sn(){return Le.oes_vertex_array_object}function zt(){return Le.angle_instanced_arrays}function xr(kr){return typeof kr=="function"&&kr._vao?kr._vao:null}function nn(kr){if(kr!==_n.currentVAO){var Lr=sn();kr?Lr.bindVertexArrayOES(kr.vao):Lr.bindVertexArrayOES(null),_n.currentVAO=kr}}function wn(kr){if(kr!==_n.currentVAO){if(kr)kr.bindAttrs();else{for(var Lr=zt(),Kn=0;Kn<Qr.length;++Kn){var In=Qr[Kn];In.buffer?(X.enableVertexAttribArray(Kn),In.buffer.bind(),X.vertexAttribPointer(Kn,In.size,In.type,In.normalized,In.stride,In.offfset),Lr&&In.divisor&&Lr.vertexAttribDivisorANGLE(Kn,In.divisor)):(X.disableVertexAttribArray(Kn),X.vertexAttrib4f(Kn,In.x,In.y,In.z,In.w))}Ir.elements?X.bindBuffer(je,Ir.elements.buffer.buffer):X.bindBuffer(je,null)}_n.currentVAO=kr}}function Dr(){_e(hn).forEach(function(kr){kr.destroy()})}function pn(){this.id=++cn,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var kr=sn();kr?this.vao=kr.createVertexArrayOES():this.vao=null,hn[this.id]=this,this.buffers=[]}pn.prototype.bindAttrs=function(){for(var kr=zt(),Lr=this.attributes,Kn=0;Kn<Lr.length;++Kn){var In=Lr[Kn];In.buffer?(X.enableVertexAttribArray(Kn),X.bindBuffer(mt,In.buffer.buffer),X.vertexAttribPointer(Kn,In.size,In.type,In.normalized,In.stride,In.offset),kr&&In.divisor&&kr.vertexAttribDivisorANGLE(Kn,In.divisor)):(X.disableVertexAttribArray(Kn),X.vertexAttrib4f(Kn,In.x,In.y,In.z,In.w))}for(var rn=Lr.length;rn<Hr;++rn)X.disableVertexAttribArray(rn);var On=lr.getElements(this.elements);On?X.bindBuffer(je,On.buffer.buffer):X.bindBuffer(je,null)},pn.prototype.refresh=function(){var kr=sn();kr&&(kr.bindVertexArrayOES(this.vao),this.bindAttrs(),_n.currentVAO=null,kr.bindVertexArrayOES(null))},pn.prototype.destroy=function(){if(this.vao){var kr=sn();this===_n.currentVAO&&(_n.currentVAO=null,kr.bindVertexArrayOES(null)),kr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),hn[this.id]&&(delete hn[this.id],Kt.vaoCount-=1)};function Mn(){var kr=sn();kr&&_e(hn).forEach(function(Lr){Lr.refresh()})}function Ei(kr){var Lr=new pn;Kt.vaoCount+=1;function Kn(In){var rn;if(Array.isArray(In))rn=In,Lr.elements&&Lr.ownsElements&&Lr.elements.destroy(),Lr.elements=null,Lr.ownsElements=!1,Lr.offset=0,Lr.count=0,Lr.instances=-1,Lr.primitive=4;else{if(j(typeof In=="object","invalid arguments for create vao"),j("attributes"in In,"must specify attributes for vao"),In.elements){var On=In.elements;Lr.ownsElements?typeof On=="function"&&On._reglType==="elements"?(Lr.elements.destroy(),Lr.ownsElements=!1):(Lr.elements(On),Lr.ownsElements=!1):lr.getElements(In.elements)?(Lr.elements=In.elements,Lr.ownsElements=!1):(Lr.elements=lr.create(In.elements),Lr.ownsElements=!0)}else Lr.elements=null,Lr.ownsElements=!1;rn=In.attributes,Lr.offset=0,Lr.count=-1,Lr.instances=-1,Lr.primitive=4,Lr.elements&&(Lr.count=Lr.elements._elements.vertCount,Lr.primitive=Lr.elements._elements.primType),"offset"in In&&(Lr.offset=In.offset|0),"count"in In&&(Lr.count=In.count|0),"instances"in In&&(Lr.instances=In.instances|0),"primitive"in In&&(j(In.primitive in Or,"bad primitive type: "+In.primitive),Lr.primitive=Or[In.primitive]),j.optional(function(){for(var io=Object.keys(In),Ro=0;Ro<io.length;++Ro)j(dt.indexOf(io[Ro])>=0,'invalid option for vao: "'+io[Ro]+'" valid options are '+dt)}),j(Array.isArray(rn),"attributes must be an array")}j(rn.length<Hr,"too many attributes"),j(rn.length>0,"must specify at least one attribute");var Rn={},aa=Lr.attributes;aa.length=rn.length;for(var zi=0;zi<rn.length;++zi){var Pn=rn[zi],zn=aa[zi]=new vt,ki=Pn.data||Pn;if(Array.isArray(ki)||Z(ki)||Cu(ki)){var Vi;Lr.buffers[zi]&&(Vi=Lr.buffers[zi],Z(ki)&&Vi._buffer.byteLength>=ki.byteLength?Vi.subdata(ki):(Vi.destroy(),Lr.buffers[zi]=null)),Lr.buffers[zi]||(Vi=Lr.buffers[zi]=Pr.create(Pn,mt,!1,!0)),zn.buffer=Pr.getBuffer(Vi),zn.size=zn.buffer.dimension|0,zn.normalized=!1,zn.type=zn.buffer.dtype,zn.offset=0,zn.stride=0,zn.divisor=0,zn.state=1,Rn[zi]=1}else Pr.getBuffer(Pn)?(zn.buffer=Pr.getBuffer(Pn),zn.size=zn.buffer.dimension|0,zn.normalized=!1,zn.type=zn.buffer.dtype,zn.offset=0,zn.stride=0,zn.divisor=0,zn.state=1):Pr.getBuffer(Pn.buffer)?(zn.buffer=Pr.getBuffer(Pn.buffer),zn.size=(+Pn.size||zn.buffer.dimension)|0,zn.normalized=!!Pn.normalized||!1,"type"in Pn?(j.parameter(Pn.type,Ju,"invalid buffer type"),zn.type=Ju[Pn.type]):zn.type=zn.buffer.dtype,zn.offset=(Pn.offset||0)|0,zn.stride=(Pn.stride||0)|0,zn.divisor=(Pn.divisor||0)|0,zn.state=1,j(zn.size>=1&&zn.size<=4,"size must be between 1 and 4"),j(zn.offset>=0,"invalid offset"),j(zn.stride>=0&&zn.stride<=255,"stride must be between 0 and 255"),j(zn.divisor>=0,"divisor must be positive"),j(!zn.divisor||!!Le.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Pn?(j(zi>0,"first attribute must not be a constant"),zn.x=+Pn.x||0,zn.y=+Pn.y||0,zn.z=+Pn.z||0,zn.w=+Pn.w||0,zn.state=2):j(!1,"invalid attribute spec for location "+zi)}for(var _a=0;_a<Lr.buffers.length;++_a)!Rn[_a]&&Lr.buffers[_a]&&(Lr.buffers[_a].destroy(),Lr.buffers[_a]=null);return Lr.refresh(),Kn}return Kn.destroy=function(){for(var In=0;In<Lr.buffers.length;++In)Lr.buffers[In]&&Lr.buffers[In].destroy();Lr.buffers.length=0,Lr.ownsElements&&(Lr.elements.destroy(),Lr.elements=null,Lr.ownsElements=!1),Lr.destroy()},Kn._vao=Lr,Kn._reglType="vao",Kn(kr)}return _n}var Sr=35632,yr=35633,wr=35718,Xr=35721;function yn(X,Le,rt,Kt){var Pr={},lr={};function Ir(zt,xr,nn,wn){this.name=zt,this.id=xr,this.location=nn,this.info=wn}function Hr(zt,xr){for(var nn=0;nn<zt.length;++nn)if(zt[nn].id===xr.id){zt[nn].location=xr.location;return}zt.push(xr)}function Qr(zt,xr,nn){var wn=zt===Sr?Pr:lr,Dr=wn[xr];if(!Dr){var pn=Le.str(xr);Dr=X.createShader(zt),X.shaderSource(Dr,pn),X.compileShader(Dr),j.shaderError(X,Dr,pn,zt,nn),wn[xr]=Dr}return Dr}var an={},cn=[],hn=0;function _n(zt,xr){this.id=hn++,this.fragId=zt,this.vertId=xr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Kt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Ur(zt,xr,nn){var wn,Dr,pn=Qr(Sr,zt.fragId),Mn=Qr(yr,zt.vertId),Ei=zt.program=X.createProgram();if(X.attachShader(Ei,pn),X.attachShader(Ei,Mn),nn)for(wn=0;wn<nn.length;++wn){var kr=nn[wn];X.bindAttribLocation(Ei,kr[0],kr[1])}X.linkProgram(Ei),j.linkError(X,Ei,Le.str(zt.fragId),Le.str(zt.vertId),xr);var Lr=X.getProgramParameter(Ei,wr);Kt.profile&&(zt.stats.uniformsCount=Lr);var Kn=zt.uniforms;for(wn=0;wn<Lr;++wn)if(Dr=X.getActiveUniform(Ei,wn),Dr)if(Dr.size>1)for(var In=0;In<Dr.size;++In){var rn=Dr.name.replace("[0]","["+In+"]");Hr(Kn,new Ir(rn,Le.id(rn),X.getUniformLocation(Ei,rn),Dr))}else Hr(Kn,new Ir(Dr.name,Le.id(Dr.name),X.getUniformLocation(Ei,Dr.name),Dr));var On=X.getProgramParameter(Ei,Xr);Kt.profile&&(zt.stats.attributesCount=On);var Rn=zt.attributes;for(wn=0;wn<On;++wn)Dr=X.getActiveAttrib(Ei,wn),Dr&&Hr(Rn,new Ir(Dr.name,Le.id(Dr.name),X.getAttribLocation(Ei,Dr.name),Dr))}Kt.profile&&(rt.getMaxUniformsCount=function(){var zt=0;return cn.forEach(function(xr){xr.stats.uniformsCount>zt&&(zt=xr.stats.uniformsCount)}),zt},rt.getMaxAttributesCount=function(){var zt=0;return cn.forEach(function(xr){xr.stats.attributesCount>zt&&(zt=xr.stats.attributesCount)}),zt});function sn(){Pr={},lr={};for(var zt=0;zt<cn.length;++zt)Ur(cn[zt],null,cn[zt].attributes.map(function(xr){return[xr.location,xr.name]}))}return{clear:function(){var zt=X.deleteShader.bind(X);_e(Pr).forEach(zt),Pr={},_e(lr).forEach(zt),lr={},cn.forEach(function(xr){X.deleteProgram(xr.program)}),cn.length=0,an={},rt.shaderCount=0},program:function(zt,xr,nn,wn){j.command(zt>=0,"missing vertex shader",nn),j.command(xr>=0,"missing fragment shader",nn);var Dr=an[xr];Dr||(Dr=an[xr]={});var pn=Dr[zt];if(pn&&(pn.refCount++,!wn))return pn;var Mn=new _n(xr,zt);return rt.shaderCount++,Ur(Mn,nn,wn),pn||(Dr[zt]=Mn),cn.push(Mn),_(Mn,{destroy:function(){if(Mn.refCount--,Mn.refCount<=0){X.deleteProgram(Mn.program);var Ei=cn.indexOf(Mn);cn.splice(Ei,1),rt.shaderCount--}Dr[Mn.vertId].refCount<=0&&(X.deleteShader(lr[Mn.vertId]),delete lr[Mn.vertId],delete an[Mn.fragId][Mn.vertId]),Object.keys(an[Mn.fragId]).length||(X.deleteShader(Pr[Mn.fragId]),delete Pr[Mn.fragId],delete an[Mn.fragId])}})},restore:sn,shader:Qr,frag:-1,vert:-1}}var ln=6408,Bn=5121,ei=3333,_i=5126;function gi(X,Le,rt,Kt,Pr,lr,Ir){function Hr(cn){var hn;Le.next===null?(j(Pr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),hn=Bn):(j(Le.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),hn=Le.next.colorAttachments[0].texture._texture.type,j.optional(function(){lr.oes_texture_float?(j(hn===Bn||hn===_i,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),hn===_i&&j(Ir.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):j(hn===Bn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var _n=0,Ur=0,sn=Kt.framebufferWidth,zt=Kt.framebufferHeight,xr=null;Z(cn)?xr=cn:cn&&(j.type(cn,"object","invalid arguments to regl.read()"),_n=cn.x|0,Ur=cn.y|0,j(_n>=0&&_n<Kt.framebufferWidth,"invalid x offset for regl.read"),j(Ur>=0&&Ur<Kt.framebufferHeight,"invalid y offset for regl.read"),sn=(cn.width||Kt.framebufferWidth-_n)|0,zt=(cn.height||Kt.framebufferHeight-Ur)|0,xr=cn.data||null),xr&&(hn===Bn?j(xr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):hn===_i&&j(xr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),j(sn>0&&sn+_n<=Kt.framebufferWidth,"invalid width for read pixels"),j(zt>0&&zt+Ur<=Kt.framebufferHeight,"invalid height for read pixels"),rt();var nn=sn*zt*4;return xr||(hn===Bn?xr=new Uint8Array(nn):hn===_i&&(xr=xr||new Float32Array(nn))),j.isTypedArray(xr,"data buffer for regl.read() must be a typedarray"),j(xr.byteLength>=nn,"data buffer for regl.read() too small"),X.pixelStorei(ei,4),X.readPixels(_n,Ur,sn,zt,ln,hn,xr),xr}function Qr(cn){var hn;return Le.setFBO({framebuffer:cn.framebuffer},function(){hn=Hr(cn)}),hn}function an(cn){return!cn||!("framebuffer"in cn)?Hr(cn):Qr(cn)}return an}function Ki(X){return Array.prototype.slice.call(X)}function Nn(X){return Ki(X).join("")}function Hi(){var X=0,Le=[],rt=[];function Kt(hn){for(var _n=0;_n<rt.length;++_n)if(rt[_n]===hn)return Le[_n];var Ur="g"+X++;return Le.push(Ur),rt.push(hn),Ur}function Pr(){var hn=[];function _n(){hn.push.apply(hn,Ki(arguments))}var Ur=[];function sn(){var zt="v"+X++;return Ur.push(zt),arguments.length>0&&(hn.push(zt,"="),hn.push.apply(hn,Ki(arguments)),hn.push(";")),zt}return _(_n,{def:sn,toString:function(){return Nn([Ur.length>0?"var "+Ur.join(",")+";":"",Nn(hn)])}})}function lr(){var hn=Pr(),_n=Pr(),Ur=hn.toString,sn=_n.toString;function zt(xr,nn){_n(xr,nn,"=",hn.def(xr,nn),";")}return _(function(){hn.apply(hn,Ki(arguments))},{def:hn.def,entry:hn,exit:_n,save:zt,set:function(xr,nn,wn){zt(xr,nn),hn(xr,nn,"=",wn,";")},toString:function(){return Ur()+sn()}})}function Ir(){var hn=Nn(arguments),_n=lr(),Ur=lr(),sn=_n.toString,zt=Ur.toString;return _(_n,{then:function(){return _n.apply(_n,Ki(arguments)),this},else:function(){return Ur.apply(Ur,Ki(arguments)),this},toString:function(){var xr=zt();return xr&&(xr="else{"+xr+"}"),Nn(["if(",hn,"){",sn(),"}",xr])}})}var Hr=Pr(),Qr={};function an(hn,_n){var Ur=[];function sn(){var Dr="a"+Ur.length;return Ur.push(Dr),Dr}_n=_n||0;for(var zt=0;zt<_n;++zt)sn();var xr=lr(),nn=xr.toString,wn=Qr[hn]=_(xr,{arg:sn,toString:function(){return Nn(["function(",Ur.join(),"){",nn(),"}"])}});return wn}function cn(){var hn=['"use strict";',Hr,"return {"];Object.keys(Qr).forEach(function(zt){hn.push('"',zt,'":',Qr[zt].toString(),",")}),hn.push("}");var _n=Nn(hn).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Ur=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,sn=Ur?Oe.Function.apply(null,Le.concat(_n)):Function.apply(null,Le.concat(_n));return sn.apply(null,rt)}return{global:Hr,link:Kt,block:Pr,proc:an,scope:lr,cond:Ir,compile:cn}}var Qi="xyzw".split(""),Li=5121,yi=1,ia=2,Ii=0,wi=1,cs=2,Po=3,ro=4,Ps=5,Zo=6,wo="dither",uu="blend.enable",Rs="blend.color",Vu="blend.equation",lu="blend.func",qo="depth.enable",Gu="depth.func",Es="depth.range",Of="depth.mask",wc="colorMask",Gc="cull.enable",Ff="cull.face",ju="frontFace",Ol="lineWidth",ml="polygonOffset.enable",ns="polygonOffset.offset",Hu="sample.alpha",oc="sample.enable",Ac="sample.coverage",Na="stencil.enable",ll="stencil.mask",Eu="stencil.func",jc="stencil.opFront",gl="stencil.opBack",Df="scissor.enable",Bf="scissor.box",Fl="viewport",lf="profile",yl="framebuffer",sc="vert",Qf="frag",Su="elements",Xs="primitive",cf="count",Jf="offset",zp="instances",kh="vao",Ep="Width",Yh="Height",ff=yl+Ep,eh=yl+Yh,Sp=Fl+Ep,wp=Fl+Yh,ya="drawingBuffer",qh=ya+Ep,vd=ya+Yh,Kh=[lu,Vu,Eu,jc,gl,Ac,Fl,Bf,ns],th=34962,Zp=34963,md=35632,uc=35633,gd=3553,Nf=34067,Qh=2884,rh=3042,Uo=3024,yo=2960,fs=2929,Ph=3089,Hc=32823,wu=32926,nh=32928,ih=5126,hf=35664,Wc=35665,zf=35666,lc=5124,Jh=35667,Wu=35668,pf=35669,ep=35670,ah=35671,Rh=35672,Lh=35673,_l=35674,Oh=35675,Zf=35676,Fh=35678,oh=35680,tp=4,Us=1028,cl=1029,yd=2304,Ap=2305,rp=32775,Dh=32776,df=519,Dl=7680,Up=0,np=1,Cc=32774,xl=513,zd=36160,_d=36064,bl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},vf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],cc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Xu={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Vp={frag:md,vert:uc},ip={cw:yd,ccw:Ap};function Gp(X){return Array.isArray(X)||Z(X)||Cu(X)}function jp(X){return X.sort(function(Le,rt){return Le===Fl?-1:rt===Fl?1:Le<rt?-1:1})}function no(X,Le,rt,Kt){this.thisDep=X,this.contextDep=Le,this.propDep=rt,this.append=Kt}function mf(X){return X&&!(X.thisDep||X.contextDep||X.propDep)}function Ss(X){return new no(!1,!1,!1,X)}function El(X,Le){var rt=X.type;if(rt===Ii){var Kt=X.data.length;return new no(!0,Kt>=1,Kt>=2,Le)}else if(rt===ro){var Pr=X.data;return new no(Pr.thisDep,Pr.contextDep,Pr.propDep,Le)}else{if(rt===Ps)return new no(!1,!1,!1,Le);if(rt===Zo){for(var lr=!1,Ir=!1,Hr=!1,Qr=0;Qr<X.data.length;++Qr){var an=X.data[Qr];if(an.type===wi)Hr=!0;else if(an.type===cs)Ir=!0;else if(an.type===Po)lr=!0;else if(an.type===Ii){lr=!0;var cn=an.data;cn>=1&&(Ir=!0),cn>=2&&(Hr=!0)}else an.type===ro&&(lr=lr||an.data.thisDep,Ir=Ir||an.data.contextDep,Hr=Hr||an.data.propDep)}return new no(lr,Ir,Hr,Le)}else return new no(rt===Po,rt===cs,rt===wi,Le)}}var ap=new no(!1,!1,!1,function(){});function Xc(X,Le,rt,Kt,Pr,lr,Ir,Hr,Qr,an,cn,hn,_n,Ur,sn){var zt=an.Record,xr={add:32774,subtract:32778,"reverse subtract":32779};rt.ext_blend_minmax&&(xr.min=rp,xr.max=Dh);var nn=rt.angle_instanced_arrays,wn=rt.webgl_draw_buffers,Dr=rt.oes_vertex_array_object,pn={dirty:!0,profile:sn.profile},Mn={},Ei=[],kr={},Lr={};function Kn(Ze){return Ze.replace(".","_")}function In(Ze,Se,pt){var Lt=Kn(Ze);Ei.push(Ze),Mn[Lt]=pn[Lt]=!!pt,kr[Lt]=Se}function rn(Ze,Se,pt){var Lt=Kn(Ze);Ei.push(Ze),Array.isArray(pt)?(pn[Lt]=pt.slice(),Mn[Lt]=pt.slice()):pn[Lt]=Mn[Lt]=pt,Lr[Lt]=Se}In(wo,Uo),In(uu,rh),rn(Rs,"blendColor",[0,0,0,0]),rn(Vu,"blendEquationSeparate",[Cc,Cc]),rn(lu,"blendFuncSeparate",[np,Up,np,Up]),In(qo,fs,!0),rn(Gu,"depthFunc",xl),rn(Es,"depthRange",[0,1]),rn(Of,"depthMask",!0),rn(wc,wc,[!0,!0,!0,!0]),In(Gc,Qh),rn(Ff,"cullFace",cl),rn(ju,ju,Ap),rn(Ol,Ol,1),In(ml,Hc),rn(ns,"polygonOffset",[0,0]),In(Hu,wu),In(oc,nh),rn(Ac,"sampleCoverage",[1,!1]),In(Na,yo),rn(ll,"stencilMask",-1),rn(Eu,"stencilFunc",[df,0,-1]),rn(jc,"stencilOpSeparate",[Us,Dl,Dl,Dl]),rn(gl,"stencilOpSeparate",[cl,Dl,Dl,Dl]),In(Df,Ph),rn(Bf,"scissor",[0,0,X.drawingBufferWidth,X.drawingBufferHeight]),rn(Fl,Fl,[0,0,X.drawingBufferWidth,X.drawingBufferHeight]);var On={gl:X,context:_n,strings:Le,next:Mn,current:pn,draw:hn,elements:lr,buffer:Pr,shader:cn,attributes:an.state,vao:an,uniforms:Qr,framebuffer:Hr,extensions:rt,timer:Ur,isBufferArgs:Gp},Rn={primTypes:Or,compareFuncs:cc,blendFuncs:bl,blendEquations:xr,stencilOps:Xu,glTypes:Ju,orientationType:ip};j.optional(function(){On.isArrayLike=ts}),wn&&(Rn.backBuffer=[cl],Rn.drawBuffer=ht(Kt.maxDrawbuffers,function(Ze){return Ze===0?[0]:ht(Ze,function(Se){return _d+Se})}));var aa=0;function zi(){var Ze=Hi(),Se=Ze.link,pt=Ze.global;Ze.id=aa++,Ze.batchId="0";var Lt=Se(On),sr=Ze.shared={props:"a0"};Object.keys(On).forEach(function(ct){sr[ct]=pt.def(Lt,".",ct)}),j.optional(function(){Ze.CHECK=Se(j),Ze.commandStr=j.guessCommand(),Ze.command=Se(Ze.commandStr),Ze.assert=function(ct,Ve,Zt){ct("if(!(",Ve,"))",this.CHECK,".commandRaise(",Se(Zt),",",this.command,");")},Rn.invalidBlendCombinations=vf});var Et=Ze.next={},et=Ze.current={};Object.keys(Lr).forEach(function(ct){Array.isArray(pn[ct])&&(Et[ct]=pt.def(sr.next,".",ct),et[ct]=pt.def(sr.current,".",ct))});var Tt=Ze.constants={};Object.keys(Rn).forEach(function(ct){Tt[ct]=pt.def(JSON.stringify(Rn[ct]))}),Ze.invoke=function(ct,Ve){switch(Ve.type){case Ii:var Zt=["this",sr.context,sr.props,Ze.batchId];return ct.def(Se(Ve.data),".call(",Zt.slice(0,Math.max(Ve.data.length+1,4)),")");case wi:return ct.def(sr.props,Ve.data);case cs:return ct.def(sr.context,Ve.data);case Po:return ct.def("this",Ve.data);case ro:return Ve.data.append(Ze,ct),Ve.data.ref;case Ps:return Ve.data.toString();case Zo:return Ve.data.map(function(Qt){return Ze.invoke(ct,Qt)})}},Ze.attribCache={};var Fe={};return Ze.scopeAttrib=function(ct){var Ve=Le.id(ct);if(Ve in Fe)return Fe[Ve];var Zt=an.scope[Ve];Zt||(Zt=an.scope[Ve]=new zt);var Qt=Fe[Ve]=Se(Zt);return Qt},Ze}function Pn(Ze){var Se=Ze.static,pt=Ze.dynamic,Lt;if(lf in Se){var sr=!!Se[lf];Lt=Ss(function(et,Tt){return sr}),Lt.enable=sr}else if(lf in pt){var Et=pt[lf];Lt=El(Et,function(et,Tt){return et.invoke(Tt,Et)})}return Lt}function zn(Ze,Se){var pt=Ze.static,Lt=Ze.dynamic;if(yl in pt){var sr=pt[yl];return sr?(sr=Hr.getFramebuffer(sr),j.command(sr,"invalid framebuffer object"),Ss(function(et,Tt){var Fe=et.link(sr),ct=et.shared;Tt.set(ct.framebuffer,".next",Fe);var Ve=ct.context;return Tt.set(Ve,"."+ff,Fe+".width"),Tt.set(Ve,"."+eh,Fe+".height"),Fe})):Ss(function(et,Tt){var Fe=et.shared;Tt.set(Fe.framebuffer,".next","null");var ct=Fe.context;return Tt.set(ct,"."+ff,ct+"."+qh),Tt.set(ct,"."+eh,ct+"."+vd),"null"})}else if(yl in Lt){var Et=Lt[yl];return El(Et,function(et,Tt){var Fe=et.invoke(Tt,Et),ct=et.shared,Ve=ct.framebuffer,Zt=Tt.def(Ve,".getFramebuffer(",Fe,")");j.optional(function(){et.assert(Tt,"!"+Fe+"||"+Zt,"invalid framebuffer object")}),Tt.set(Ve,".next",Zt);var Qt=ct.context;return Tt.set(Qt,"."+ff,Zt+"?"+Zt+".width:"+Qt+"."+qh),Tt.set(Qt,"."+eh,Zt+"?"+Zt+".height:"+Qt+"."+vd),Zt})}else return null}function ki(Ze,Se,pt){var Lt=Ze.static,sr=Ze.dynamic;function Et(Fe){if(Fe in Lt){var ct=Lt[Fe];j.commandType(ct,"object","invalid "+Fe,pt.commandStr);var Ve=!0,Zt=ct.x|0,Qt=ct.y|0,Vr,En;return"width"in ct?(Vr=ct.width|0,j.command(Vr>=0,"invalid "+Fe,pt.commandStr)):Ve=!1,"height"in ct?(En=ct.height|0,j.command(En>=0,"invalid "+Fe,pt.commandStr)):Ve=!1,new no(!Ve&&Se&&Se.thisDep,!Ve&&Se&&Se.contextDep,!Ve&&Se&&Se.propDep,function(bn,oi){var Zn=bn.shared.context,ti=Vr;"width"in ct||(ti=oi.def(Zn,".",ff,"-",Zt));var Qn=En;return"height"in ct||(Qn=oi.def(Zn,".",eh,"-",Qt)),[Zt,Qt,ti,Qn]})}else if(Fe in sr){var An=sr[Fe],Dn=El(An,function(bn,oi){var Zn=bn.invoke(oi,An);j.optional(function(){bn.assert(oi,Zn+"&&typeof "+Zn+'==="object"',"invalid "+Fe)});var ti=bn.shared.context,Qn=oi.def(Zn,".x|0"),$n=oi.def(Zn,".y|0"),Zi=oi.def('"width" in ',Zn,"?",Zn,".width|0:","(",ti,".",ff,"-",Qn,")"),Qa=oi.def('"height" in ',Zn,"?",Zn,".height|0:","(",ti,".",eh,"-",$n,")");return j.optional(function(){bn.assert(oi,Zi+">=0&&"+Qa+">=0","invalid "+Fe)}),[Qn,$n,Zi,Qa]});return Se&&(Dn.thisDep=Dn.thisDep||Se.thisDep,Dn.contextDep=Dn.contextDep||Se.contextDep,Dn.propDep=Dn.propDep||Se.propDep),Dn}else return Se?new no(Se.thisDep,Se.contextDep,Se.propDep,function(bn,oi){var Zn=bn.shared.context;return[0,0,oi.def(Zn,".",ff),oi.def(Zn,".",eh)]}):null}var et=Et(Fl);if(et){var Tt=et;et=new no(et.thisDep,et.contextDep,et.propDep,function(Fe,ct){var Ve=Tt.append(Fe,ct),Zt=Fe.shared.context;return ct.set(Zt,"."+Sp,Ve[2]),ct.set(Zt,"."+wp,Ve[3]),Ve})}return{viewport:et,scissor_box:Et(Bf)}}function Vi(Ze,Se){var pt=Ze.static,Lt=typeof pt[Qf]=="string"&&typeof pt[sc]=="string";if(Lt){if(Object.keys(Se.dynamic).length>0)return null;var sr=Se.static,Et=Object.keys(sr);if(Et.length>0&&typeof sr[Et[0]]=="number"){for(var et=[],Tt=0;Tt<Et.length;++Tt)j(typeof sr[Et[Tt]]=="number","must specify all vertex attribute locations when using vaos"),et.push([sr[Et[Tt]]|0,Et[Tt]]);return et}}return null}function _a(Ze,Se,pt){var Lt=Ze.static,sr=Ze.dynamic;function Et(Ve){if(Ve in Lt){var Zt=Le.id(Lt[Ve]);j.optional(function(){cn.shader(Vp[Ve],Zt,j.guessCommand())});var Qt=Ss(function(){return Zt});return Qt.id=Zt,Qt}else if(Ve in sr){var Vr=sr[Ve];return El(Vr,function(En,An){var Dn=En.invoke(An,Vr),bn=An.def(En.shared.strings,".id(",Dn,")");return j.optional(function(){An(En.shared.shader,".shader(",Vp[Ve],",",bn,",",En.command,");")}),bn})}return null}var et=Et(Qf),Tt=Et(sc),Fe=null,ct;return mf(et)&&mf(Tt)?(Fe=cn.program(Tt.id,et.id,null,pt),ct=Ss(function(Ve,Zt){return Ve.link(Fe)})):ct=new no(et&&et.thisDep||Tt&&Tt.thisDep,et&&et.contextDep||Tt&&Tt.contextDep,et&&et.propDep||Tt&&Tt.propDep,function(Ve,Zt){var Qt=Ve.shared.shader,Vr;et?Vr=et.append(Ve,Zt):Vr=Zt.def(Qt,".",Qf);var En;Tt?En=Tt.append(Ve,Zt):En=Zt.def(Qt,".",sc);var An=Qt+".program("+En+","+Vr;return j.optional(function(){An+=","+Ve.command}),Zt.def(An+")")}),{frag:et,vert:Tt,progVar:ct,program:Fe}}function io(Ze,Se){var pt=Ze.static,Lt=Ze.dynamic,sr={},Et=!1;function et(){if(kh in pt){var oi=pt[kh];return oi!==null&&an.getVAO(oi)===null&&(oi=an.createVAO(oi)),Et=!0,sr.vao=oi,Ss(function(ti){var Qn=an.getVAO(oi);return Qn?ti.link(Qn):"null"})}else if(kh in Lt){Et=!0;var Zn=Lt[kh];return El(Zn,function(ti,Qn){var $n=ti.invoke(Qn,Zn);return Qn.def(ti.shared.vao+".getVAO("+$n+")")})}return null}var Tt=et(),Fe=!1;function ct(){if(Su in pt){var oi=pt[Su];if(sr.elements=oi,Gp(oi)){var Zn=sr.elements=lr.create(oi,!0);oi=lr.getElements(Zn),Fe=!0}else oi&&(oi=lr.getElements(oi),Fe=!0,j.command(oi,"invalid elements",Se.commandStr));var ti=Ss(function($n,Zi){if(oi){var Qa=$n.link(oi);return $n.ELEMENTS=Qa,Qa}return $n.ELEMENTS=null,null});return ti.value=oi,ti}else if(Su in Lt){Fe=!0;var Qn=Lt[Su];return El(Qn,function($n,Zi){var Qa=$n.shared,tu=Qa.isBufferArgs,Do=Qa.elements,Ja=$n.invoke(Zi,Qn),$c=Zi.def("null"),$u=Zi.def(tu,"(",Ja,")"),Xl=$n.cond($u).then($c,"=",Do,".createStream(",Ja,");").else($c,"=",Do,".getElements(",Ja,");");return j.optional(function(){$n.assert(Xl.else,"!"+Ja+"||"+$c,"invalid elements")}),Zi.entry(Xl),Zi.exit($n.cond($u).then(Do,".destroyStream(",$c,");")),$n.ELEMENTS=$c,$c})}else if(Et)return new no(Tt.thisDep,Tt.contextDep,Tt.propDep,function($n,Zi){return Zi.def($n.shared.vao+".currentVAO?"+$n.shared.elements+".getElements("+$n.shared.vao+".currentVAO.elements):null")});return null}var Ve=ct();function Zt(){if(Xs in pt){var oi=pt[Xs];return sr.primitive=oi,j.commandParameter(oi,Or,"invalid primitve",Se.commandStr),Ss(function(ti,Qn){return Or[oi]})}else if(Xs in Lt){var Zn=Lt[Xs];return El(Zn,function(ti,Qn){var $n=ti.constants.primTypes,Zi=ti.invoke(Qn,Zn);return j.optional(function(){ti.assert(Qn,Zi+" in "+$n,"invalid primitive, must be one of "+Object.keys(Or))}),Qn.def($n,"[",Zi,"]")})}else{if(Fe)return mf(Ve)?Ve.value?Ss(function(ti,Qn){return Qn.def(ti.ELEMENTS,".primType")}):Ss(function(){return tp}):new no(Ve.thisDep,Ve.contextDep,Ve.propDep,function(ti,Qn){var $n=ti.ELEMENTS;return Qn.def($n,"?",$n,".primType:",tp)});if(Et)return new no(Tt.thisDep,Tt.contextDep,Tt.propDep,function(ti,Qn){return Qn.def(ti.shared.vao+".currentVAO?"+ti.shared.vao+".currentVAO.primitive:"+tp)})}return null}function Qt(oi,Zn){if(oi in pt){var ti=pt[oi]|0;return Zn?sr.offset=ti:sr.instances=ti,j.command(!Zn||ti>=0,"invalid "+oi,Se.commandStr),Ss(function($n,Zi){return Zn&&($n.OFFSET=ti),ti})}else if(oi in Lt){var Qn=Lt[oi];return El(Qn,function($n,Zi){var Qa=$n.invoke(Zi,Qn);return Zn&&($n.OFFSET=Qa,j.optional(function(){$n.assert(Zi,Qa+">=0","invalid "+oi)})),Qa})}else if(Zn){if(Fe)return Ss(function($n,Zi){return $n.OFFSET=0,0});if(Et)return new no(Tt.thisDep,Tt.contextDep,Tt.propDep,function($n,Zi){return Zi.def($n.shared.vao+".currentVAO?"+$n.shared.vao+".currentVAO.offset:0")})}else if(Et)return new no(Tt.thisDep,Tt.contextDep,Tt.propDep,function($n,Zi){return Zi.def($n.shared.vao+".currentVAO?"+$n.shared.vao+".currentVAO.instances:-1")});return null}var Vr=Qt(Jf,!0);function En(){if(cf in pt){var oi=pt[cf]|0;return sr.count=oi,j.command(typeof oi=="number"&&oi>=0,"invalid vertex count",Se.commandStr),Ss(function(){return oi})}else if(cf in Lt){var Zn=Lt[cf];return El(Zn,function(Zi,Qa){var tu=Zi.invoke(Qa,Zn);return j.optional(function(){Zi.assert(Qa,"typeof "+tu+'==="number"&&'+tu+">=0&&"+tu+"===("+tu+"|0)","invalid vertex count")}),tu})}else if(Fe)if(mf(Ve)){if(Ve)return Vr?new no(Vr.thisDep,Vr.contextDep,Vr.propDep,function(Zi,Qa){var tu=Qa.def(Zi.ELEMENTS,".vertCount-",Zi.OFFSET);return j.optional(function(){Zi.assert(Qa,tu+">=0","invalid vertex offset/element buffer too small")}),tu}):Ss(function(Zi,Qa){return Qa.def(Zi.ELEMENTS,".vertCount")});var ti=Ss(function(){return-1});return j.optional(function(){ti.MISSING=!0}),ti}else{var Qn=new no(Ve.thisDep||Vr.thisDep,Ve.contextDep||Vr.contextDep,Ve.propDep||Vr.propDep,function(Zi,Qa){var tu=Zi.ELEMENTS;return Zi.OFFSET?Qa.def(tu,"?",tu,".vertCount-",Zi.OFFSET,":-1"):Qa.def(tu,"?",tu,".vertCount:-1")});return j.optional(function(){Qn.DYNAMIC=!0}),Qn}else if(Et){var $n=new no(Tt.thisDep,Tt.contextDep,Tt.propDep,function(Zi,Qa){return Qa.def(Zi.shared.vao,".currentVAO?",Zi.shared.vao,".currentVAO.count:-1")});return $n}return null}var An=Zt(),Dn=En(),bn=Qt(zp,!1);return{elements:Ve,primitive:An,count:Dn,instances:bn,offset:Vr,vao:Tt,vaoActive:Et,elementsActive:Fe,static:sr}}function Ro(Ze,Se){var pt=Ze.static,Lt=Ze.dynamic,sr={};return Ei.forEach(function(Et){var et=Kn(Et);function Tt(Fe,ct){if(Et in pt){var Ve=Fe(pt[Et]);sr[et]=Ss(function(){return Ve})}else if(Et in Lt){var Zt=Lt[Et];sr[et]=El(Zt,function(Qt,Vr){return ct(Qt,Vr,Qt.invoke(Vr,Zt))})}}switch(Et){case Gc:case uu:case wo:case Na:case qo:case Df:case ml:case Hu:case oc:case Of:return Tt(function(Fe){return j.commandType(Fe,"boolean",Et,Se.commandStr),Fe},function(Fe,ct,Ve){return j.optional(function(){Fe.assert(ct,"typeof "+Ve+'==="boolean"',"invalid flag "+Et,Fe.commandStr)}),Ve});case Gu:return Tt(function(Fe){return j.commandParameter(Fe,cc,"invalid "+Et,Se.commandStr),cc[Fe]},function(Fe,ct,Ve){var Zt=Fe.constants.compareFuncs;return j.optional(function(){Fe.assert(ct,Ve+" in "+Zt,"invalid "+Et+", must be one of "+Object.keys(cc))}),ct.def(Zt,"[",Ve,"]")});case Es:return Tt(function(Fe){return j.command(ts(Fe)&&Fe.length===2&&typeof Fe[0]=="number"&&typeof Fe[1]=="number"&&Fe[0]<=Fe[1],"depth range is 2d array",Se.commandStr),Fe},function(Fe,ct,Ve){j.optional(function(){Fe.assert(ct,Fe.shared.isArrayLike+"("+Ve+")&&"+Ve+".length===2&&typeof "+Ve+'[0]==="number"&&typeof '+Ve+'[1]==="number"&&'+Ve+"[0]<="+Ve+"[1]","depth range must be a 2d array")});var Zt=ct.def("+",Ve,"[0]"),Qt=ct.def("+",Ve,"[1]");return[Zt,Qt]});case lu:return Tt(function(Fe){j.commandType(Fe,"object","blend.func",Se.commandStr);var ct="srcRGB"in Fe?Fe.srcRGB:Fe.src,Ve="srcAlpha"in Fe?Fe.srcAlpha:Fe.src,Zt="dstRGB"in Fe?Fe.dstRGB:Fe.dst,Qt="dstAlpha"in Fe?Fe.dstAlpha:Fe.dst;return j.commandParameter(ct,bl,et+".srcRGB",Se.commandStr),j.commandParameter(Ve,bl,et+".srcAlpha",Se.commandStr),j.commandParameter(Zt,bl,et+".dstRGB",Se.commandStr),j.commandParameter(Qt,bl,et+".dstAlpha",Se.commandStr),j.command(vf.indexOf(ct+", "+Zt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+ct+", "+Zt+")",Se.commandStr),[bl[ct],bl[Zt],bl[Ve],bl[Qt]]},function(Fe,ct,Ve){var Zt=Fe.constants.blendFuncs;j.optional(function(){Fe.assert(ct,Ve+"&&typeof "+Ve+'==="object"',"invalid blend func, must be an object")});function Qt(Zn,ti){var Qn=ct.def('"',Zn,ti,'" in ',Ve,"?",Ve,".",Zn,ti,":",Ve,".",Zn);return j.optional(function(){Fe.assert(ct,Qn+" in "+Zt,"invalid "+Et+"."+Zn+ti+", must be one of "+Object.keys(bl))}),Qn}var Vr=Qt("src","RGB"),En=Qt("dst","RGB");j.optional(function(){var Zn=Fe.constants.invalidBlendCombinations;Fe.assert(ct,Zn+".indexOf("+Vr+'+", "+'+En+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var An=ct.def(Zt,"[",Vr,"]"),Dn=ct.def(Zt,"[",Qt("src","Alpha"),"]"),bn=ct.def(Zt,"[",En,"]"),oi=ct.def(Zt,"[",Qt("dst","Alpha"),"]");return[An,bn,Dn,oi]});case Vu:return Tt(function(Fe){if(typeof Fe=="string")return j.commandParameter(Fe,xr,"invalid "+Et,Se.commandStr),[xr[Fe],xr[Fe]];if(typeof Fe=="object")return j.commandParameter(Fe.rgb,xr,Et+".rgb",Se.commandStr),j.commandParameter(Fe.alpha,xr,Et+".alpha",Se.commandStr),[xr[Fe.rgb],xr[Fe.alpha]];j.commandRaise("invalid blend.equation",Se.commandStr)},function(Fe,ct,Ve){var Zt=Fe.constants.blendEquations,Qt=ct.def(),Vr=ct.def(),En=Fe.cond("typeof ",Ve,'==="string"');return j.optional(function(){function An(Dn,bn,oi){Fe.assert(Dn,oi+" in "+Zt,"invalid "+bn+", must be one of "+Object.keys(xr))}An(En.then,Et,Ve),Fe.assert(En.else,Ve+"&&typeof "+Ve+'==="object"',"invalid "+Et),An(En.else,Et+".rgb",Ve+".rgb"),An(En.else,Et+".alpha",Ve+".alpha")}),En.then(Qt,"=",Vr,"=",Zt,"[",Ve,"];"),En.else(Qt,"=",Zt,"[",Ve,".rgb];",Vr,"=",Zt,"[",Ve,".alpha];"),ct(En),[Qt,Vr]});case Rs:return Tt(function(Fe){return j.command(ts(Fe)&&Fe.length===4,"blend.color must be a 4d array",Se.commandStr),ht(4,function(ct){return+Fe[ct]})},function(Fe,ct,Ve){return j.optional(function(){Fe.assert(ct,Fe.shared.isArrayLike+"("+Ve+")&&"+Ve+".length===4","blend.color must be a 4d array")}),ht(4,function(Zt){return ct.def("+",Ve,"[",Zt,"]")})});case ll:return Tt(function(Fe){return j.commandType(Fe,"number",et,Se.commandStr),Fe|0},function(Fe,ct,Ve){return j.optional(function(){Fe.assert(ct,"typeof "+Ve+'==="number"',"invalid stencil.mask")}),ct.def(Ve,"|0")});case Eu:return Tt(function(Fe){j.commandType(Fe,"object",et,Se.commandStr);var ct=Fe.cmp||"keep",Ve=Fe.ref||0,Zt="mask"in Fe?Fe.mask:-1;return j.commandParameter(ct,cc,Et+".cmp",Se.commandStr),j.commandType(Ve,"number",Et+".ref",Se.commandStr),j.commandType(Zt,"number",Et+".mask",Se.commandStr),[cc[ct],Ve,Zt]},function(Fe,ct,Ve){var Zt=Fe.constants.compareFuncs;j.optional(function(){function An(){Fe.assert(ct,Array.prototype.join.call(arguments,""),"invalid stencil.func")}An(Ve+"&&typeof ",Ve,'==="object"'),An('!("cmp" in ',Ve,")||(",Ve,".cmp in ",Zt,")")});var Qt=ct.def('"cmp" in ',Ve,"?",Zt,"[",Ve,".cmp]",":",Dl),Vr=ct.def(Ve,".ref|0"),En=ct.def('"mask" in ',Ve,"?",Ve,".mask|0:-1");return[Qt,Vr,En]});case jc:case gl:return Tt(function(Fe){j.commandType(Fe,"object",et,Se.commandStr);var ct=Fe.fail||"keep",Ve=Fe.zfail||"keep",Zt=Fe.zpass||"keep";return j.commandParameter(ct,Xu,Et+".fail",Se.commandStr),j.commandParameter(Ve,Xu,Et+".zfail",Se.commandStr),j.commandParameter(Zt,Xu,Et+".zpass",Se.commandStr),[Et===gl?cl:Us,Xu[ct],Xu[Ve],Xu[Zt]]},function(Fe,ct,Ve){var Zt=Fe.constants.stencilOps;j.optional(function(){Fe.assert(ct,Ve+"&&typeof "+Ve+'==="object"',"invalid "+Et)});function Qt(Vr){return j.optional(function(){Fe.assert(ct,'!("'+Vr+'" in '+Ve+")||("+Ve+"."+Vr+" in "+Zt+")","invalid "+Et+"."+Vr+", must be one of "+Object.keys(Xu))}),ct.def('"',Vr,'" in ',Ve,"?",Zt,"[",Ve,".",Vr,"]:",Dl)}return[Et===gl?cl:Us,Qt("fail"),Qt("zfail"),Qt("zpass")]});case ns:return Tt(function(Fe){j.commandType(Fe,"object",et,Se.commandStr);var ct=Fe.factor|0,Ve=Fe.units|0;return j.commandType(ct,"number",et+".factor",Se.commandStr),j.commandType(Ve,"number",et+".units",Se.commandStr),[ct,Ve]},function(Fe,ct,Ve){j.optional(function(){Fe.assert(ct,Ve+"&&typeof "+Ve+'==="object"',"invalid "+Et)});var Zt=ct.def(Ve,".factor|0"),Qt=ct.def(Ve,".units|0");return[Zt,Qt]});case Ff:return Tt(function(Fe){var ct=0;return Fe==="front"?ct=Us:Fe==="back"&&(ct=cl),j.command(!!ct,et,Se.commandStr),ct},function(Fe,ct,Ve){return j.optional(function(){Fe.assert(ct,Ve+'==="front"||'+Ve+'==="back"',"invalid cull.face")}),ct.def(Ve,'==="front"?',Us,":",cl)});case Ol:return Tt(function(Fe){return j.command(typeof Fe=="number"&&Fe>=Kt.lineWidthDims[0]&&Fe<=Kt.lineWidthDims[1],"invalid line width, must be a positive number between "+Kt.lineWidthDims[0]+" and "+Kt.lineWidthDims[1],Se.commandStr),Fe},function(Fe,ct,Ve){return j.optional(function(){Fe.assert(ct,"typeof "+Ve+'==="number"&&'+Ve+">="+Kt.lineWidthDims[0]+"&&"+Ve+"<="+Kt.lineWidthDims[1],"invalid line width")}),Ve});case ju:return Tt(function(Fe){return j.commandParameter(Fe,ip,et,Se.commandStr),ip[Fe]},function(Fe,ct,Ve){return j.optional(function(){Fe.assert(ct,Ve+'==="cw"||'+Ve+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),ct.def(Ve+'==="cw"?'+yd+":"+Ap)});case wc:return Tt(function(Fe){return j.command(ts(Fe)&&Fe.length===4,"color.mask must be length 4 array",Se.commandStr),Fe.map(function(ct){return!!ct})},function(Fe,ct,Ve){return j.optional(function(){Fe.assert(ct,Fe.shared.isArrayLike+"("+Ve+")&&"+Ve+".length===4","invalid color.mask")}),ht(4,function(Zt){return"!!"+Ve+"["+Zt+"]"})});case Ac:return Tt(function(Fe){j.command(typeof Fe=="object"&&Fe,et,Se.commandStr);var ct="value"in Fe?Fe.value:1,Ve=!!Fe.invert;return j.command(typeof ct=="number"&&ct>=0&&ct<=1,"sample.coverage.value must be a number between 0 and 1",Se.commandStr),[ct,Ve]},function(Fe,ct,Ve){j.optional(function(){Fe.assert(ct,Ve+"&&typeof "+Ve+'==="object"',"invalid sample.coverage")});var Zt=ct.def('"value" in ',Ve,"?+",Ve,".value:1"),Qt=ct.def("!!",Ve,".invert");return[Zt,Qt]})}}),sr}function qi(Ze,Se){var pt=Ze.static,Lt=Ze.dynamic,sr={};return Object.keys(pt).forEach(function(Et){var et=pt[Et],Tt;if(typeof et=="number"||typeof et=="boolean")Tt=Ss(function(){return et});else if(typeof et=="function"){var Fe=et._reglType;Fe==="texture2d"||Fe==="textureCube"?Tt=Ss(function(ct){return ct.link(et)}):Fe==="framebuffer"||Fe==="framebufferCube"?(j.command(et.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Et+'"',Se.commandStr),Tt=Ss(function(ct){return ct.link(et.color[0])})):j.commandRaise('invalid data for uniform "'+Et+'"',Se.commandStr)}else ts(et)?Tt=Ss(function(ct){var Ve=ct.global.def("[",ht(et.length,function(Zt){return j.command(typeof et[Zt]=="number"||typeof et[Zt]=="boolean","invalid uniform "+Et,ct.commandStr),et[Zt]}),"]");return Ve}):j.commandRaise('invalid or missing data for uniform "'+Et+'"',Se.commandStr);Tt.value=et,sr[Et]=Tt}),Object.keys(Lt).forEach(function(Et){var et=Lt[Et];sr[Et]=El(et,function(Tt,Fe){return Tt.invoke(Fe,et)})}),sr}function Gr(Ze,Se){var pt=Ze.static,Lt=Ze.dynamic,sr={};return Object.keys(pt).forEach(function(Et){var et=pt[Et],Tt=Le.id(Et),Fe=new zt;if(Gp(et))Fe.state=yi,Fe.buffer=Pr.getBuffer(Pr.create(et,th,!1,!0)),Fe.type=0;else{var ct=Pr.getBuffer(et);if(ct)Fe.state=yi,Fe.buffer=ct,Fe.type=0;else if(j.command(typeof et=="object"&&et,"invalid data for attribute "+Et,Se.commandStr),"constant"in et){var Ve=et.constant;Fe.buffer="null",Fe.state=ia,typeof Ve=="number"?Fe.x=Ve:(j.command(ts(Ve)&&Ve.length>0&&Ve.length<=4,"invalid constant for attribute "+Et,Se.commandStr),Qi.forEach(function(bn,oi){oi<Ve.length&&(Fe[bn]=Ve[oi])}))}else{Gp(et.buffer)?ct=Pr.getBuffer(Pr.create(et.buffer,th,!1,!0)):ct=Pr.getBuffer(et.buffer),j.command(!!ct,'missing buffer for attribute "'+Et+'"',Se.commandStr);var Zt=et.offset|0;j.command(Zt>=0,'invalid offset for attribute "'+Et+'"',Se.commandStr);var Qt=et.stride|0;j.command(Qt>=0&&Qt<256,'invalid stride for attribute "'+Et+'", must be integer betweeen [0, 255]',Se.commandStr);var Vr=et.size|0;j.command(!("size"in et)||Vr>0&&Vr<=4,'invalid size for attribute "'+Et+'", must be 1,2,3,4',Se.commandStr);var En=!!et.normalized,An=0;"type"in et&&(j.commandParameter(et.type,Ju,"invalid type for attribute "+Et,Se.commandStr),An=Ju[et.type]);var Dn=et.divisor|0;j.optional(function(){"divisor"in et&&(j.command(Dn===0||nn,'cannot specify divisor for attribute "'+Et+'", instancing not supported',Se.commandStr),j.command(Dn>=0,'invalid divisor for attribute "'+Et+'"',Se.commandStr));var bn=Se.commandStr,oi=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(et).forEach(function(Zn){j.command(oi.indexOf(Zn)>=0,'unknown parameter "'+Zn+'" for attribute pointer "'+Et+'" (valid parameters are '+oi+")",bn)})}),Fe.buffer=ct,Fe.state=yi,Fe.size=Vr,Fe.normalized=En,Fe.type=An||ct.dtype,Fe.offset=Zt,Fe.stride=Qt,Fe.divisor=Dn}}sr[Et]=Ss(function(bn,oi){var Zn=bn.attribCache;if(Tt in Zn)return Zn[Tt];var ti={isStream:!1};return Object.keys(Fe).forEach(function(Qn){ti[Qn]=Fe[Qn]}),Fe.buffer&&(ti.buffer=bn.link(Fe.buffer),ti.type=ti.type||ti.buffer+".dtype"),Zn[Tt]=ti,ti})}),Object.keys(Lt).forEach(function(Et){var et=Lt[Et];function Tt(Fe,ct){var Ve=Fe.invoke(ct,et),Zt=Fe.shared,Qt=Fe.constants,Vr=Zt.isBufferArgs,En=Zt.buffer;j.optional(function(){Fe.assert(ct,Ve+"&&(typeof "+Ve+'==="object"||typeof '+Ve+'==="function")&&('+Vr+"("+Ve+")||"+En+".getBuffer("+Ve+")||"+En+".getBuffer("+Ve+".buffer)||"+Vr+"("+Ve+'.buffer)||("constant" in '+Ve+"&&(typeof "+Ve+'.constant==="number"||'+Zt.isArrayLike+"("+Ve+".constant))))",'invalid dynamic attribute "'+Et+'"')});var An={isStream:ct.def(!1)},Dn=new zt;Dn.state=yi,Object.keys(Dn).forEach(function(ti){An[ti]=ct.def(""+Dn[ti])});var bn=An.buffer,oi=An.type;ct("if(",Vr,"(",Ve,")){",An.isStream,"=true;",bn,"=",En,".createStream(",th,",",Ve,");",oi,"=",bn,".dtype;","}else{",bn,"=",En,".getBuffer(",Ve,");","if(",bn,"){",oi,"=",bn,".dtype;",'}else if("constant" in ',Ve,"){",An.state,"=",ia,";","if(typeof "+Ve+'.constant === "number"){',An[Qi[0]],"=",Ve,".constant;",Qi.slice(1).map(function(ti){return An[ti]}).join("="),"=0;","}else{",Qi.map(function(ti,Qn){return An[ti]+"="+Ve+".constant.length>"+Qn+"?"+Ve+".constant["+Qn+"]:0;"}).join(""),"}}else{","if(",Vr,"(",Ve,".buffer)){",bn,"=",En,".createStream(",th,",",Ve,".buffer);","}else{",bn,"=",En,".getBuffer(",Ve,".buffer);","}",oi,'="type" in ',Ve,"?",Qt.glTypes,"[",Ve,".type]:",bn,".dtype;",An.normalized,"=!!",Ve,".normalized;");function Zn(ti){ct(An[ti],"=",Ve,".",ti,"|0;")}return Zn("size"),Zn("offset"),Zn("stride"),Zn("divisor"),ct("}}"),ct.exit("if(",An.isStream,"){",En,".destroyStream(",bn,");","}"),An}sr[Et]=El(et,Tt)}),sr}function Lo(Ze){var Se=Ze.static,pt=Ze.dynamic,Lt={};return Object.keys(Se).forEach(function(sr){var Et=Se[sr];Lt[sr]=Ss(function(et,Tt){return typeof Et=="number"||typeof Et=="boolean"?""+Et:et.link(Et)})}),Object.keys(pt).forEach(function(sr){var Et=pt[sr];Lt[sr]=El(Et,function(et,Tt){return et.invoke(Tt,Et)})}),Lt}function cu(Ze,Se,pt,Lt,sr){var Et=Ze.static,et=Ze.dynamic;j.optional(function(){var Zn=[yl,sc,Qf,Su,Xs,Jf,cf,zp,lf,kh].concat(Ei);function ti(Qn){Object.keys(Qn).forEach(function($n){j.command(Zn.indexOf($n)>=0,'unknown parameter "'+$n+'"',sr.commandStr)})}ti(Et),ti(et)});var Tt=Vi(Ze,Se),Fe=zn(Ze,sr),ct=ki(Ze,Fe,sr),Ve=io(Ze,sr),Zt=Ro(Ze,sr),Qt=_a(Ze,sr,Tt);function Vr(Zn){var ti=ct[Zn];ti&&(Zt[Zn]=ti)}Vr(Fl),Vr(Kn(Bf));var En=Object.keys(Zt).length>0,An={framebuffer:Fe,draw:Ve,shader:Qt,state:Zt,dirty:En,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(An.profile=Pn(Ze,sr),An.uniforms=qi(pt,sr),An.drawVAO=An.scopeVAO=Ve.vao,!An.drawVAO&&Qt.program&&!Tt&&rt.angle_instanced_arrays&&Ve.static.elements){var Dn=!0,bn=Qt.program.attributes.map(function(Zn){var ti=Se.static[Zn];return Dn=Dn&&!!ti,ti});if(Dn&&bn.length>0){var oi=an.getVAO(an.createVAO({attributes:bn,elements:Ve.static.elements}));An.drawVAO=new no(null,null,null,function(Zn,ti){return Zn.link(oi)}),An.useVAO=!0}}return Tt?An.useVAO=!0:An.attributes=Gr(Se,sr),An.context=Lo(Lt,sr),An}function Fa(Ze,Se,pt){var Lt=Ze.shared,sr=Lt.context,Et=Ze.scope();Object.keys(pt).forEach(function(et){Se.save(sr,"."+et);var Tt=pt[et],Fe=Tt.append(Ze,Se);Array.isArray(Fe)?Et(sr,".",et,"=[",Fe.join(),"];"):Et(sr,".",et,"=",Fe,";")}),Se(Et)}function Ko(Ze,Se,pt,Lt){var sr=Ze.shared,Et=sr.gl,et=sr.framebuffer,Tt;wn&&(Tt=Se.def(sr.extensions,".webgl_draw_buffers"));var Fe=Ze.constants,ct=Fe.drawBuffer,Ve=Fe.backBuffer,Zt;pt?Zt=pt.append(Ze,Se):Zt=Se.def(et,".next"),Lt||Se("if(",Zt,"!==",et,".cur){"),Se("if(",Zt,"){",Et,".bindFramebuffer(",zd,",",Zt,".framebuffer);"),wn&&Se(Tt,".drawBuffersWEBGL(",ct,"[",Zt,".colorAttachments.length]);"),Se("}else{",Et,".bindFramebuffer(",zd,",null);"),wn&&Se(Tt,".drawBuffersWEBGL(",Ve,");"),Se("}",et,".cur=",Zt,";"),Lt||Se("}")}function is(Ze,Se,pt){var Lt=Ze.shared,sr=Lt.gl,Et=Ze.current,et=Ze.next,Tt=Lt.current,Fe=Lt.next,ct=Ze.cond(Tt,".dirty");Ei.forEach(function(Ve){var Zt=Kn(Ve);if(!(Zt in pt.state)){var Qt,Vr;if(Zt in et){Qt=et[Zt],Vr=Et[Zt];var En=ht(pn[Zt].length,function(Dn){return ct.def(Qt,"[",Dn,"]")});ct(Ze.cond(En.map(function(Dn,bn){return Dn+"!=="+Vr+"["+bn+"]"}).join("||")).then(sr,".",Lr[Zt],"(",En,");",En.map(function(Dn,bn){return Vr+"["+bn+"]="+Dn}).join(";"),";"))}else{Qt=ct.def(Fe,".",Zt);var An=Ze.cond(Qt,"!==",Tt,".",Zt);ct(An),Zt in kr?An(Ze.cond(Qt).then(sr,".enable(",kr[Zt],");").else(sr,".disable(",kr[Zt],");"),Tt,".",Zt,"=",Qt,";"):An(sr,".",Lr[Zt],"(",Qt,");",Tt,".",Zt,"=",Qt,";")}}}),Object.keys(pt.state).length===0&&ct(Tt,".dirty=false;"),Se(ct)}function eu(Ze,Se,pt,Lt){var sr=Ze.shared,Et=Ze.current,et=sr.current,Tt=sr.gl;jp(Object.keys(pt)).forEach(function(Fe){var ct=pt[Fe];if(!(Lt&&!Lt(ct))){var Ve=ct.append(Ze,Se);if(kr[Fe]){var Zt=kr[Fe];mf(ct)?Ve?Se(Tt,".enable(",Zt,");"):Se(Tt,".disable(",Zt,");"):Se(Ze.cond(Ve).then(Tt,".enable(",Zt,");").else(Tt,".disable(",Zt,");")),Se(et,".",Fe,"=",Ve,";")}else if(ts(Ve)){var Qt=Et[Fe];Se(Tt,".",Lr[Fe],"(",Ve,");",Ve.map(function(Vr,En){return Qt+"["+En+"]="+Vr}).join(";"),";")}else Se(Tt,".",Lr[Fe],"(",Ve,");",et,".",Fe,"=",Ve,";")}})}function Mo(Ze,Se){nn&&(Ze.instancing=Se.def(Ze.shared.extensions,".angle_instanced_arrays"))}function $i(Ze,Se,pt,Lt,sr){var Et=Ze.shared,et=Ze.stats,Tt=Et.current,Fe=Et.timer,ct=pt.profile;function Ve(){var Zn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return Zn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var Zt,Qt;function Vr(Zn){Zt=Se.def(),Zn(Zt,"=",Ve(),";"),typeof sr=="string"?Zn(et,".count+=",sr,";"):Zn(et,".count++;"),Ur&&(Lt?(Qt=Se.def(),Zn(Qt,"=",Fe,".getNumPendingQueries();")):Zn(Fe,".beginQuery(",et,");"))}function En(Zn){Zn(et,".cpuTime+=",Ve(),"-",Zt,";"),Ur&&(Lt?Zn(Fe,".pushScopeStats(",Qt,",",Fe,".getNumPendingQueries(),",et,");"):Zn(Fe,".endQuery();"))}function An(Zn){var ti=Se.def(Tt,".profile");Se(Tt,".profile=",Zn,";"),Se.exit(Tt,".profile=",ti,";")}var Dn;if(ct){if(mf(ct)){ct.enable?(Vr(Se),En(Se.exit),An("true")):An("false");return}Dn=ct.append(Ze,Se),An(Dn)}else Dn=Se.def(Tt,".profile");var bn=Ze.block();Vr(bn),Se("if(",Dn,"){",bn,"}");var oi=Ze.block();En(oi),Se.exit("if(",Dn,"){",oi,"}")}function Ls(Ze,Se,pt,Lt,sr){var Et=Ze.shared;function et(Fe){switch(Fe){case hf:case Jh:case ah:return 2;case Wc:case Wu:case Rh:return 3;case zf:case pf:case Lh:return 4;default:return 1}}function Tt(Fe,ct,Ve){var Zt=Et.gl,Qt=Se.def(Fe,".location"),Vr=Se.def(Et.attributes,"[",Qt,"]"),En=Ve.state,An=Ve.buffer,Dn=[Ve.x,Ve.y,Ve.z,Ve.w],bn=["buffer","normalized","offset","stride"];function oi(){Se("if(!",Vr,".buffer){",Zt,".enableVertexAttribArray(",Qt,");}");var ti=Ve.type,Qn;if(Ve.size?Qn=Se.def(Ve.size,"||",ct):Qn=ct,Se("if(",Vr,".type!==",ti,"||",Vr,".size!==",Qn,"||",bn.map(function(Zi){return Vr+"."+Zi+"!=="+Ve[Zi]}).join("||"),"){",Zt,".bindBuffer(",th,",",An,".buffer);",Zt,".vertexAttribPointer(",[Qt,Qn,ti,Ve.normalized,Ve.stride,Ve.offset],");",Vr,".type=",ti,";",Vr,".size=",Qn,";",bn.map(function(Zi){return Vr+"."+Zi+"="+Ve[Zi]+";"}).join(""),"}"),nn){var $n=Ve.divisor;Se("if(",Vr,".divisor!==",$n,"){",Ze.instancing,".vertexAttribDivisorANGLE(",[Qt,$n],");",Vr,".divisor=",$n,";}")}}function Zn(){Se("if(",Vr,".buffer){",Zt,".disableVertexAttribArray(",Qt,");",Vr,".buffer=null;","}if(",Qi.map(function(ti,Qn){return Vr+"."+ti+"!=="+Dn[Qn]}).join("||"),"){",Zt,".vertexAttrib4f(",Qt,",",Dn,");",Qi.map(function(ti,Qn){return Vr+"."+ti+"="+Dn[Qn]+";"}).join(""),"}")}En===yi?oi():En===ia?Zn():(Se("if(",En,"===",yi,"){"),oi(),Se("}else{"),Zn(),Se("}"))}Lt.forEach(function(Fe){var ct=Fe.name,Ve=pt.attributes[ct],Zt;if(Ve){if(!sr(Ve))return;Zt=Ve.append(Ze,Se)}else{if(!sr(ap))return;var Qt=Ze.scopeAttrib(ct);j.optional(function(){Ze.assert(Se,Qt+".state","missing attribute "+ct)}),Zt={},Object.keys(new zt).forEach(function(Vr){Zt[Vr]=Se.def(Qt,".",Vr)})}Tt(Ze.link(Fe),et(Fe.info.type),Zt)})}function Ka(Ze,Se,pt,Lt,sr,Et){for(var et=Ze.shared,Tt=et.gl,Fe,ct=0;ct<Lt.length;++ct){var Ve=Lt[ct],Zt=Ve.name,Qt=Ve.info.type,Vr=pt.uniforms[Zt],En=Ze.link(Ve),An=En+".location",Dn;if(Vr){if(!sr(Vr))continue;if(mf(Vr)){var bn=Vr.value;if(j.command(bn!==null&&typeof bn!="undefined",'missing uniform "'+Zt+'"',Ze.commandStr),Qt===Fh||Qt===oh){j.command(typeof bn=="function"&&(Qt===Fh&&(bn._reglType==="texture2d"||bn._reglType==="framebuffer")||Qt===oh&&(bn._reglType==="textureCube"||bn._reglType==="framebufferCube")),"invalid texture for uniform "+Zt,Ze.commandStr);var oi=Ze.link(bn._texture||bn.color[0]._texture);Se(Tt,".uniform1i(",An,",",oi+".bind());"),Se.exit(oi,".unbind();")}else if(Qt===_l||Qt===Oh||Qt===Zf){j.optional(function(){j.command(ts(bn),"invalid matrix for uniform "+Zt,Ze.commandStr),j.command(Qt===_l&&bn.length===4||Qt===Oh&&bn.length===9||Qt===Zf&&bn.length===16,"invalid length for matrix uniform "+Zt,Ze.commandStr)});var Zn=Ze.global.def("new Float32Array(["+Array.prototype.slice.call(bn)+"])"),ti=2;Qt===Oh?ti=3:Qt===Zf&&(ti=4),Se(Tt,".uniformMatrix",ti,"fv(",An,",false,",Zn,");")}else{switch(Qt){case ih:j.commandType(bn,"number","uniform "+Zt,Ze.commandStr),Fe="1f";break;case hf:j.command(ts(bn)&&bn.length===2,"uniform "+Zt,Ze.commandStr),Fe="2f";break;case Wc:j.command(ts(bn)&&bn.length===3,"uniform "+Zt,Ze.commandStr),Fe="3f";break;case zf:j.command(ts(bn)&&bn.length===4,"uniform "+Zt,Ze.commandStr),Fe="4f";break;case ep:j.commandType(bn,"boolean","uniform "+Zt,Ze.commandStr),Fe="1i";break;case lc:j.commandType(bn,"number","uniform "+Zt,Ze.commandStr),Fe="1i";break;case ah:j.command(ts(bn)&&bn.length===2,"uniform "+Zt,Ze.commandStr),Fe="2i";break;case Jh:j.command(ts(bn)&&bn.length===2,"uniform "+Zt,Ze.commandStr),Fe="2i";break;case Rh:j.command(ts(bn)&&bn.length===3,"uniform "+Zt,Ze.commandStr),Fe="3i";break;case Wu:j.command(ts(bn)&&bn.length===3,"uniform "+Zt,Ze.commandStr),Fe="3i";break;case Lh:j.command(ts(bn)&&bn.length===4,"uniform "+Zt,Ze.commandStr),Fe="4i";break;case pf:j.command(ts(bn)&&bn.length===4,"uniform "+Zt,Ze.commandStr),Fe="4i";break}Se(Tt,".uniform",Fe,"(",An,",",ts(bn)?Array.prototype.slice.call(bn):bn,");")}continue}else Dn=Vr.append(Ze,Se)}else{if(!sr(ap))continue;Dn=Se.def(et.uniforms,"[",Le.id(Zt),"]")}Qt===Fh?(j(!Array.isArray(Dn),"must specify a scalar prop for textures"),Se("if(",Dn,"&&",Dn,'._reglType==="framebuffer"){',Dn,"=",Dn,".color[0];","}")):Qt===oh&&(j(!Array.isArray(Dn),"must specify a scalar prop for cube maps"),Se("if(",Dn,"&&",Dn,'._reglType==="framebufferCube"){',Dn,"=",Dn,".color[0];","}")),j.optional(function(){function $u(wl,yf){Ze.assert(Se,wl,'bad data or missing for uniform "'+Zt+'".  '+yf)}function Xl(wl){j(!Array.isArray(Dn),"must not specify an array type for uniform"),$u("typeof "+Dn+'==="'+wl+'"',"invalid type, expected "+wl)}function Sl(wl,yf){Array.isArray(Dn)?j(Dn.length===wl,"must have length "+wl):$u(et.isArrayLike+"("+Dn+")&&"+Dn+".length==="+wl,"invalid vector, should have length "+wl,Ze.commandStr)}function sp(wl){j(!Array.isArray(Dn),"must not specify a value type"),$u("typeof "+Dn+'==="function"&&'+Dn+'._reglType==="texture'+(wl===gd?"2d":"Cube")+'"',"invalid texture type",Ze.commandStr)}switch(Qt){case lc:Xl("number");break;case Jh:Sl(2,"number");break;case Wu:Sl(3,"number");break;case pf:Sl(4,"number");break;case ih:Xl("number");break;case hf:Sl(2,"number");break;case Wc:Sl(3,"number");break;case zf:Sl(4,"number");break;case ep:Xl("boolean");break;case ah:Sl(2,"boolean");break;case Rh:Sl(3,"boolean");break;case Lh:Sl(4,"boolean");break;case _l:Sl(4,"number");break;case Oh:Sl(9,"number");break;case Zf:Sl(16,"number");break;case Fh:sp(gd);break;case oh:sp(Nf);break}});var Qn=1;switch(Qt){case Fh:case oh:var $n=Se.def(Dn,"._texture");Se(Tt,".uniform1i(",An,",",$n,".bind());"),Se.exit($n,".unbind();");continue;case lc:case ep:Fe="1i";break;case Jh:case ah:Fe="2i",Qn=2;break;case Wu:case Rh:Fe="3i",Qn=3;break;case pf:case Lh:Fe="4i",Qn=4;break;case ih:Fe="1f";break;case hf:Fe="2f",Qn=2;break;case Wc:Fe="3f",Qn=3;break;case zf:Fe="4f",Qn=4;break;case _l:Fe="Matrix2fv";break;case Oh:Fe="Matrix3fv";break;case Zf:Fe="Matrix4fv";break}if(Fe.charAt(0)==="M"){Se(Tt,".uniform",Fe,"(",An,",");var Zi=Math.pow(Qt-_l+2,2),Qa=Ze.global.def("new Float32Array(",Zi,")");Array.isArray(Dn)?Se("false,(",ht(Zi,function($u){return Qa+"["+$u+"]="+Dn[$u]}),",",Qa,")"):Se("false,(Array.isArray(",Dn,")||",Dn," instanceof Float32Array)?",Dn,":(",ht(Zi,function($u){return Qa+"["+$u+"]="+Dn+"["+$u+"]"}),",",Qa,")"),Se(");")}else if(Qn>1){for(var tu=[],Do=[],Ja=0;Ja<Qn;++Ja)Array.isArray(Dn)?Do.push(Dn[Ja]):Do.push(Se.def(Dn+"["+Ja+"]")),Et&&tu.push(Se.def());Et&&Se("if(!",Ze.batchId,"||",tu.map(function($u,Xl){return $u+"!=="+Do[Xl]}).join("||"),"){",tu.map(function($u,Xl){return $u+"="+Do[Xl]+";"}).join("")),Se(Tt,".uniform",Fe,"(",An,",",Do.join(","),");"),Et&&Se("}")}else{if(j(!Array.isArray(Dn),"uniform value must not be an array"),Et){var $c=Se.def();Se("if(!",Ze.batchId,"||",$c,"!==",Dn,"){",$c,"=",Dn,";")}Se(Tt,".uniform",Fe,"(",An,",",Dn,");"),Et&&Se("}")}}}function fu(Ze,Se,pt,Lt){var sr=Ze.shared,Et=sr.gl,et=sr.draw,Tt=Lt.draw;function Fe(){var Qn=Tt.elements,$n,Zi=Se;return Qn?((Qn.contextDep&&Lt.contextDynamic||Qn.propDep)&&(Zi=pt),$n=Qn.append(Ze,Zi),Tt.elementsActive&&Zi("if("+$n+")"+Et+".bindBuffer("+Zp+","+$n+".buffer.buffer);")):($n=Zi.def(),Zi($n,"=",et,".",Su,";","if(",$n,"){",Et,".bindBuffer(",Zp,",",$n,".buffer.buffer);}","else if(",sr.vao,".currentVAO){",$n,"=",Ze.shared.elements+".getElements("+sr.vao,".currentVAO.elements);",Dr?"":"if("+$n+")"+Et+".bindBuffer("+Zp+","+$n+".buffer.buffer);","}")),$n}function ct(){var Qn=Tt.count,$n,Zi=Se;return Qn?((Qn.contextDep&&Lt.contextDynamic||Qn.propDep)&&(Zi=pt),$n=Qn.append(Ze,Zi),j.optional(function(){Qn.MISSING&&Ze.assert(Se,"false","missing vertex count"),Qn.DYNAMIC&&Ze.assert(Zi,$n+">=0","missing vertex count")})):($n=Zi.def(et,".",cf),j.optional(function(){Ze.assert(Zi,$n+">=0","missing vertex count")})),$n}var Ve=Fe();function Zt(Qn){var $n=Tt[Qn];return $n?$n.contextDep&&Lt.contextDynamic||$n.propDep?$n.append(Ze,pt):$n.append(Ze,Se):Se.def(et,".",Qn)}var Qt=Zt(Xs),Vr=Zt(Jf),En=ct();if(typeof En=="number"){if(En===0)return}else pt("if(",En,"){"),pt.exit("}");var An,Dn;nn&&(An=Zt(zp),Dn=Ze.instancing);var bn=Ve+".type",oi=Tt.elements&&mf(Tt.elements)&&!Tt.vaoActive;function Zn(){function Qn(){pt(Dn,".drawElementsInstancedANGLE(",[Qt,En,bn,Vr+"<<(("+bn+"-"+Li+")>>1)",An],");")}function $n(){pt(Dn,".drawArraysInstancedANGLE(",[Qt,Vr,En,An],");")}Ve&&Ve!=="null"?oi?Qn():(pt("if(",Ve,"){"),Qn(),pt("}else{"),$n(),pt("}")):$n()}function ti(){function Qn(){pt(Et+".drawElements("+[Qt,En,bn,Vr+"<<(("+bn+"-"+Li+")>>1)"]+");")}function $n(){pt(Et+".drawArrays("+[Qt,Vr,En]+");")}Ve&&Ve!=="null"?oi?Qn():(pt("if(",Ve,"){"),Qn(),pt("}else{"),$n(),pt("}")):$n()}nn&&(typeof An!="number"||An>=0)?typeof An=="string"?(pt("if(",An,">0){"),Zn(),pt("}else if(",An,"<0){"),ti(),pt("}")):Zn():ti()}function Oi(Ze,Se,pt,Lt,sr){var Et=zi(),et=Et.proc("body",sr);return j.optional(function(){Et.commandStr=Se.commandStr,Et.command=Et.link(Se.commandStr)}),nn&&(Et.instancing=et.def(Et.shared.extensions,".angle_instanced_arrays")),Ze(Et,et,pt,Lt),Et.compile().body}function va(Ze,Se,pt,Lt){Mo(Ze,Se),pt.useVAO?pt.drawVAO?Se(Ze.shared.vao,".setVAO(",pt.drawVAO.append(Ze,Se),");"):Se(Ze.shared.vao,".setVAO(",Ze.shared.vao,".targetVAO);"):(Se(Ze.shared.vao,".setVAO(null);"),Ls(Ze,Se,pt,Lt.attributes,function(){return!0})),Ka(Ze,Se,pt,Lt.uniforms,function(){return!0},!1),fu(Ze,Se,Se,pt)}function Ga(Ze,Se){var pt=Ze.proc("draw",1);Mo(Ze,pt),Fa(Ze,pt,Se.context),Ko(Ze,pt,Se.framebuffer),is(Ze,pt,Se),eu(Ze,pt,Se.state),$i(Ze,pt,Se,!1,!0);var Lt=Se.shader.progVar.append(Ze,pt);if(pt(Ze.shared.gl,".useProgram(",Lt,".program);"),Se.shader.program)va(Ze,pt,Se,Se.shader.program);else{pt(Ze.shared.vao,".setVAO(null);");var sr=Ze.global.def("{}"),Et=pt.def(Lt,".id"),et=pt.def(sr,"[",Et,"]");pt(Ze.cond(et).then(et,".call(this,a0);").else(et,"=",sr,"[",Et,"]=",Ze.link(function(Tt){return Oi(va,Ze,Se,Tt,1)}),"(",Lt,");",et,".call(this,a0);"))}Object.keys(Se.state).length>0&&pt(Ze.shared.current,".dirty=true;"),Ze.shared.vao&&pt(Ze.shared.vao,".setVAO(null);")}function ws(Ze,Se,pt,Lt){Ze.batchId="a1",Mo(Ze,Se);function sr(){return!0}Ls(Ze,Se,pt,Lt.attributes,sr),Ka(Ze,Se,pt,Lt.uniforms,sr,!1),fu(Ze,Se,Se,pt)}function gf(Ze,Se,pt,Lt){Mo(Ze,Se);var sr=pt.contextDep,Et=Se.def(),et="a0",Tt="a1",Fe=Se.def();Ze.shared.props=Fe,Ze.batchId=Et;var ct=Ze.scope(),Ve=Ze.scope();Se(ct.entry,"for(",Et,"=0;",Et,"<",Tt,";++",Et,"){",Fe,"=",et,"[",Et,"];",Ve,"}",ct.exit);function Zt(bn){return bn.contextDep&&sr||bn.propDep}function Qt(bn){return!Zt(bn)}if(pt.needsContext&&Fa(Ze,Ve,pt.context),pt.needsFramebuffer&&Ko(Ze,Ve,pt.framebuffer),eu(Ze,Ve,pt.state,Zt),pt.profile&&Zt(pt.profile)&&$i(Ze,Ve,pt,!1,!0),Lt)pt.useVAO?pt.drawVAO?Zt(pt.drawVAO)?Ve(Ze.shared.vao,".setVAO(",pt.drawVAO.append(Ze,Ve),");"):ct(Ze.shared.vao,".setVAO(",pt.drawVAO.append(Ze,ct),");"):ct(Ze.shared.vao,".setVAO(",Ze.shared.vao,".targetVAO);"):(ct(Ze.shared.vao,".setVAO(null);"),Ls(Ze,ct,pt,Lt.attributes,Qt),Ls(Ze,Ve,pt,Lt.attributes,Zt)),Ka(Ze,ct,pt,Lt.uniforms,Qt,!1),Ka(Ze,Ve,pt,Lt.uniforms,Zt,!0),fu(Ze,ct,Ve,pt);else{var Vr=Ze.global.def("{}"),En=pt.shader.progVar.append(Ze,Ve),An=Ve.def(En,".id"),Dn=Ve.def(Vr,"[",An,"]");Ve(Ze.shared.gl,".useProgram(",En,".program);","if(!",Dn,"){",Dn,"=",Vr,"[",An,"]=",Ze.link(function(bn){return Oi(ws,Ze,pt,bn,2)}),"(",En,");}",Dn,".call(this,a0[",Et,"],",Et,");")}}function We(Ze,Se){var pt=Ze.proc("batch",2);Ze.batchId="0",Mo(Ze,pt);var Lt=!1,sr=!0;Object.keys(Se.context).forEach(function(Vr){Lt=Lt||Se.context[Vr].propDep}),Lt||(Fa(Ze,pt,Se.context),sr=!1);var Et=Se.framebuffer,et=!1;Et?(Et.propDep?Lt=et=!0:Et.contextDep&&Lt&&(et=!0),et||Ko(Ze,pt,Et)):Ko(Ze,pt,null),Se.state.viewport&&Se.state.viewport.propDep&&(Lt=!0);function Tt(Vr){return Vr.contextDep&&Lt||Vr.propDep}is(Ze,pt,Se),eu(Ze,pt,Se.state,function(Vr){return!Tt(Vr)}),(!Se.profile||!Tt(Se.profile))&&$i(Ze,pt,Se,!1,"a1"),Se.contextDep=Lt,Se.needsContext=sr,Se.needsFramebuffer=et;var Fe=Se.shader.progVar;if(Fe.contextDep&&Lt||Fe.propDep)gf(Ze,pt,Se,null);else{var ct=Fe.append(Ze,pt);if(pt(Ze.shared.gl,".useProgram(",ct,".program);"),Se.shader.program)gf(Ze,pt,Se,Se.shader.program);else{pt(Ze.shared.vao,".setVAO(null);");var Ve=Ze.global.def("{}"),Zt=pt.def(ct,".id"),Qt=pt.def(Ve,"[",Zt,"]");pt(Ze.cond(Qt).then(Qt,".call(this,a0,a1);").else(Qt,"=",Ve,"[",Zt,"]=",Ze.link(function(Vr){return Oi(gf,Ze,Se,Vr,2)}),"(",ct,");",Qt,".call(this,a0,a1);"))}}Object.keys(Se.state).length>0&&pt(Ze.shared.current,".dirty=true;"),Ze.shared.vao&&pt(Ze.shared.vao,".setVAO(null);")}function vr(Ze,Se){var pt=Ze.proc("scope",3);Ze.batchId="a2";var Lt=Ze.shared,sr=Lt.current;Fa(Ze,pt,Se.context),Se.framebuffer&&Se.framebuffer.append(Ze,pt),jp(Object.keys(Se.state)).forEach(function(et){var Tt=Se.state[et],Fe=Tt.append(Ze,pt);ts(Fe)?Fe.forEach(function(ct,Ve){pt.set(Ze.next[et],"["+Ve+"]",ct)}):pt.set(Lt.next,"."+et,Fe)}),$i(Ze,pt,Se,!0,!0),[Su,Jf,cf,zp,Xs].forEach(function(et){var Tt=Se.draw[et];!Tt||pt.set(Lt.draw,"."+et,""+Tt.append(Ze,pt))}),Object.keys(Se.uniforms).forEach(function(et){var Tt=Se.uniforms[et].append(Ze,pt);Array.isArray(Tt)&&(Tt="["+Tt.join()+"]"),pt.set(Lt.uniforms,"["+Le.id(et)+"]",Tt)}),Object.keys(Se.attributes).forEach(function(et){var Tt=Se.attributes[et].append(Ze,pt),Fe=Ze.scopeAttrib(et);Object.keys(new zt).forEach(function(ct){pt.set(Fe,"."+ct,Tt[ct])})}),Se.scopeVAO&&pt.set(Lt.vao,".targetVAO",Se.scopeVAO.append(Ze,pt));function Et(et){var Tt=Se.shader[et];Tt&&pt.set(Lt.shader,"."+et,Tt.append(Ze,pt))}Et(sc),Et(Qf),Object.keys(Se.state).length>0&&(pt(sr,".dirty=true;"),pt.exit(sr,".dirty=true;")),pt("a1(",Ze.shared.context,",a0,",Ze.batchId,");")}function rr(Ze){if(!(typeof Ze!="object"||ts(Ze))){for(var Se=Object.keys(Ze),pt=0;pt<Se.length;++pt)if(mn.isDynamic(Ze[Se[pt]]))return!0;return!1}}function Xn(Ze,Se,pt){var Lt=Se.static[pt];if(!Lt||!rr(Lt))return;var sr=Ze.global,Et=Object.keys(Lt),et=!1,Tt=!1,Fe=!1,ct=Ze.global.def("{}");Et.forEach(function(Zt){var Qt=Lt[Zt];if(mn.isDynamic(Qt)){typeof Qt=="function"&&(Qt=Lt[Zt]=mn.unbox(Qt));var Vr=El(Qt,null);et=et||Vr.thisDep,Fe=Fe||Vr.propDep,Tt=Tt||Vr.contextDep}else{switch(sr(ct,".",Zt,"="),typeof Qt){case"number":sr(Qt);break;case"string":sr('"',Qt,'"');break;case"object":Array.isArray(Qt)&&sr("[",Qt.join(),"]");break;default:sr(Ze.link(Qt));break}sr(";")}});function Ve(Zt,Qt){Et.forEach(function(Vr){var En=Lt[Vr];if(!!mn.isDynamic(En)){var An=Zt.invoke(Qt,En);Qt(ct,".",Vr,"=",An,";")}})}Se.dynamic[pt]=new mn.DynamicVariable(ro,{thisDep:et,contextDep:Tt,propDep:Fe,ref:ct,append:Ve}),delete Se.static[pt]}function Aa(Ze,Se,pt,Lt,sr){var Et=zi();Et.stats=Et.link(sr),Object.keys(Se.static).forEach(function(Tt){Xn(Et,Se,Tt)}),Kh.forEach(function(Tt){Xn(Et,Ze,Tt)});var et=cu(Ze,Se,pt,Lt,Et);return Ga(Et,et),vr(Et,et),We(Et,et),_(Et.compile(),{destroy:function(){et.shader.program.destroy()}})}return{next:Mn,current:pn,procs:function(){var Ze=zi(),Se=Ze.proc("poll"),pt=Ze.proc("refresh"),Lt=Ze.block();Se(Lt),pt(Lt);var sr=Ze.shared,Et=sr.gl,et=sr.next,Tt=sr.current;Lt(Tt,".dirty=false;"),Ko(Ze,Se),Ko(Ze,pt,null,!0);var Fe;nn&&(Fe=Ze.link(nn)),rt.oes_vertex_array_object&&pt(Ze.link(rt.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var ct=0;ct<Kt.maxAttributes;++ct){var Ve=pt.def(sr.attributes,"[",ct,"]"),Zt=Ze.cond(Ve,".buffer");Zt.then(Et,".enableVertexAttribArray(",ct,");",Et,".bindBuffer(",th,",",Ve,".buffer.buffer);",Et,".vertexAttribPointer(",ct,",",Ve,".size,",Ve,".type,",Ve,".normalized,",Ve,".stride,",Ve,".offset);").else(Et,".disableVertexAttribArray(",ct,");",Et,".vertexAttrib4f(",ct,",",Ve,".x,",Ve,".y,",Ve,".z,",Ve,".w);",Ve,".buffer=null;"),pt(Zt),nn&&pt(Fe,".vertexAttribDivisorANGLE(",ct,",",Ve,".divisor);")}return pt(Ze.shared.vao,".currentVAO=null;",Ze.shared.vao,".setVAO(",Ze.shared.vao,".targetVAO);"),Object.keys(kr).forEach(function(Qt){var Vr=kr[Qt],En=Lt.def(et,".",Qt),An=Ze.block();An("if(",En,"){",Et,".enable(",Vr,")}else{",Et,".disable(",Vr,")}",Tt,".",Qt,"=",En,";"),pt(An),Se("if(",En,"!==",Tt,".",Qt,"){",An,"}")}),Object.keys(Lr).forEach(function(Qt){var Vr=Lr[Qt],En=pn[Qt],An,Dn,bn=Ze.block();if(bn(Et,".",Vr,"("),ts(En)){var oi=En.length;An=Ze.global.def(et,".",Qt),Dn=Ze.global.def(Tt,".",Qt),bn(ht(oi,function(Zn){return An+"["+Zn+"]"}),");",ht(oi,function(Zn){return Dn+"["+Zn+"]="+An+"["+Zn+"];"}).join("")),Se("if(",ht(oi,function(Zn){return An+"["+Zn+"]!=="+Dn+"["+Zn+"]"}).join("||"),"){",bn,"}")}else An=Lt.def(et,".",Qt),Dn=Lt.def(Tt,".",Qt),bn(An,");",Tt,".",Qt,"=",An,";"),Se("if(",An,"!==",Dn,"){",bn,"}");pt(bn)}),Ze.compile()}(),compile:Aa}}function xd(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Hp=34918,Zd=34919,Bh=35007,bd=function(X,Le){if(!Le.ext_disjoint_timer_query)return null;var rt=[];function Kt(){return rt.pop()||Le.ext_disjoint_timer_query.createQueryEXT()}function Pr(nn){rt.push(nn)}var lr=[];function Ir(nn){var wn=Kt();Le.ext_disjoint_timer_query.beginQueryEXT(Bh,wn),lr.push(wn),Ur(lr.length-1,lr.length,nn)}function Hr(){Le.ext_disjoint_timer_query.endQueryEXT(Bh)}function Qr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var an=[];function cn(){return an.pop()||new Qr}function hn(nn){an.push(nn)}var _n=[];function Ur(nn,wn,Dr){var pn=cn();pn.startQueryIndex=nn,pn.endQueryIndex=wn,pn.sum=0,pn.stats=Dr,_n.push(pn)}var sn=[],zt=[];function xr(){var nn,wn,Dr=lr.length;if(Dr!==0){zt.length=Math.max(zt.length,Dr+1),sn.length=Math.max(sn.length,Dr+1),sn[0]=0,zt[0]=0;var pn=0;for(nn=0,wn=0;wn<lr.length;++wn){var Mn=lr[wn];Le.ext_disjoint_timer_query.getQueryObjectEXT(Mn,Zd)?(pn+=Le.ext_disjoint_timer_query.getQueryObjectEXT(Mn,Hp),Pr(Mn)):lr[nn++]=Mn,sn[wn+1]=pn,zt[wn+1]=nn}for(lr.length=nn,nn=0,wn=0;wn<_n.length;++wn){var Ei=_n[wn],kr=Ei.startQueryIndex,Lr=Ei.endQueryIndex;Ei.sum+=sn[Lr]-sn[kr];var Kn=zt[kr],In=zt[Lr];In===Kn?(Ei.stats.gpuTime+=Ei.sum/1e6,hn(Ei)):(Ei.startQueryIndex=Kn,Ei.endQueryIndex=In,_n[nn++]=Ei)}_n.length=nn}}return{beginQuery:Ir,endQuery:Hr,pushScopeStats:Ur,update:xr,getNumPendingQueries:function(){return lr.length},clear:function(){rt.push.apply(rt,lr);for(var nn=0;nn<rt.length;nn++)Le.ext_disjoint_timer_query.deleteQueryEXT(rt[nn]);lr.length=0,rt.length=0},restore:function(){lr.length=0,rt.length=0}}},Wp=16384,Hl=256,op=1024,sh=34962,Uf="webglcontextlost",ho="webglcontextrestored",Vf=1,Wi=2,Wl=3;function Nh(X,Le){for(var rt=0;rt<X.length;++rt)if(X[rt]===Le)return rt;return-1}function uh(X){var Le=Re(X);if(!Le)return null;var rt=Le.gl,Kt=rt.getContextAttributes(),Pr=rt.isContextLost(),lr=He(rt,Le);if(!lr)return null;var Ir=uo(),Hr=xd(),Qr=lr.extensions,an=bd(rt,Qr),cn=Wa(),hn=rt.drawingBufferWidth,_n=rt.drawingBufferHeight,Ur={tick:0,time:0,viewportWidth:hn,viewportHeight:_n,framebufferWidth:hn,framebufferHeight:_n,drawingBufferWidth:hn,drawingBufferHeight:_n,pixelRatio:Le.pixelRatio},sn={},zt={elements:null,primitive:4,count:-1,offset:0,instances:-1},xr=J(rt,Qr),nn=W(rt,Hr,Le,pn),wn=Iu(rt,Qr,nn,Hr),Dr=$t(rt,Qr,xr,Hr,nn,wn,zt);function pn(Oi){return Dr.destroyBuffer(Oi)}var Mn=yn(rt,Ir,Hr,Le),Ei=bu(rt,Qr,xr,function(){Kn.procs.poll()},Ur,Hr,Le),kr=zc(rt,Qr,xr,Hr,Le),Lr=Qe(rt,Qr,xr,Ei,kr,Hr),Kn=Xc(rt,Ir,Qr,xr,nn,wn,Ei,Lr,sn,Dr,Mn,zt,Ur,an,Le),In=gi(rt,Lr,Kn.procs.poll,Ur,Kt,Qr,xr),rn=Kn.next,On=rt.canvas,Rn=[],aa=[],zi=[],Pn=[Le.onDestroy],zn=null;function ki(){if(Rn.length===0){an&&an.update(),zn=null;return}zn=Ri.next(ki),Mo();for(var Oi=Rn.length-1;Oi>=0;--Oi){var va=Rn[Oi];va&&va(Ur,null,0)}rt.flush(),an&&an.update()}function Vi(){!zn&&Rn.length>0&&(zn=Ri.next(ki))}function _a(){zn&&(Ri.cancel(ki),zn=null)}function io(Oi){Oi.preventDefault(),Pr=!0,_a(),aa.forEach(function(va){va()})}function Ro(Oi){rt.getError(),Pr=!1,lr.restore(),Mn.restore(),nn.restore(),Ei.restore(),kr.restore(),Lr.restore(),Dr.restore(),an&&an.restore(),Kn.procs.refresh(),Vi(),zi.forEach(function(va){va()})}var qi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!qi&&On&&(On.addEventListener(Uf,io,!1),On.addEventListener(ho,Ro,!1));function Gr(){Rn.length=0,_a(),!qi&&On&&(On.removeEventListener(Uf,io),On.removeEventListener(ho,Ro)),Mn.clear(),Lr.clear(),kr.clear(),Dr.clear(),Ei.clear(),wn.clear(),nn.clear(),an&&an.clear(),Pn.forEach(function(Oi){Oi()})}function Lo(Oi){j(!!Oi,"invalid args to regl({...})"),j.type(Oi,"object","invalid args to regl({...})");function va(Et){var et=_({},Et);delete et.uniforms,delete et.attributes,delete et.context,delete et.vao,"stencil"in et&&et.stencil.op&&(et.stencil.opBack=et.stencil.opFront=et.stencil.op,delete et.stencil.op);function Tt(Fe){if(Fe in et){var ct=et[Fe];delete et[Fe],Object.keys(ct).forEach(function(Ve){et[Fe+"."+Ve]=ct[Ve]})}}return Tt("blend"),Tt("depth"),Tt("cull"),Tt("stencil"),Tt("polygonOffset"),Tt("scissor"),Tt("sample"),"vao"in Et&&(et.vao=Et.vao),et}function Ga(Et,et){var Tt={},Fe={};return Object.keys(Et).forEach(function(ct){var Ve=Et[ct];if(mn.isDynamic(Ve)){Fe[ct]=mn.unbox(Ve,ct);return}else if(et&&Array.isArray(Ve)){for(var Zt=0;Zt<Ve.length;++Zt)if(mn.isDynamic(Ve[Zt])){Fe[ct]=mn.unbox(Ve,ct);return}}Tt[ct]=Ve}),{dynamic:Fe,static:Tt}}var ws=Ga(Oi.context||{},!0),gf=Ga(Oi.uniforms||{},!0),We=Ga(Oi.attributes||{},!1),vr=Ga(va(Oi),!1),rr={gpuTime:0,cpuTime:0,count:0},Xn=Kn.compile(vr,We,gf,ws,rr),Aa=Xn.draw,Ze=Xn.batch,Se=Xn.scope,pt=[];function Lt(Et){for(;pt.length<Et;)pt.push(null);return pt}function sr(Et,et){var Tt;if(Pr&&j.raise("context lost"),typeof Et=="function")return Se.call(this,null,Et,0);if(typeof et=="function")if(typeof Et=="number")for(Tt=0;Tt<Et;++Tt)Se.call(this,null,et,Tt);else if(Array.isArray(Et))for(Tt=0;Tt<Et.length;++Tt)Se.call(this,Et[Tt],et,Tt);else return Se.call(this,Et,et,0);else if(typeof Et=="number"){if(Et>0)return Ze.call(this,Lt(Et|0),Et|0)}else if(Array.isArray(Et)){if(Et.length)return Ze.call(this,Et,Et.length)}else return Aa.call(this,Et)}return _(sr,{stats:rr,destroy:function(){Xn.destroy()}})}var cu=Lr.setFBO=Lo({framebuffer:mn.define.call(null,Vf,"framebuffer")});function Fa(Oi,va){var Ga=0;Kn.procs.poll();var ws=va.color;ws&&(rt.clearColor(+ws[0]||0,+ws[1]||0,+ws[2]||0,+ws[3]||0),Ga|=Wp),"depth"in va&&(rt.clearDepth(+va.depth),Ga|=Hl),"stencil"in va&&(rt.clearStencil(va.stencil|0),Ga|=op),j(!!Ga,"called regl.clear with no buffer specified"),rt.clear(Ga)}function Ko(Oi){if(j(typeof Oi=="object"&&Oi,"regl.clear() takes an object as input"),"framebuffer"in Oi)if(Oi.framebuffer&&Oi.framebuffer_reglType==="framebufferCube")for(var va=0;va<6;++va)cu(_({framebuffer:Oi.framebuffer.faces[va]},Oi),Fa);else cu(Oi,Fa);else Fa(null,Oi)}function is(Oi){j.type(Oi,"function","regl.frame() callback must be a function"),Rn.push(Oi);function va(){var Ga=Nh(Rn,Oi);j(Ga>=0,"cannot cancel a frame twice");function ws(){var gf=Nh(Rn,ws);Rn[gf]=Rn[Rn.length-1],Rn.length-=1,Rn.length<=0&&_a()}Rn[Ga]=ws}return Vi(),{cancel:va}}function eu(){var Oi=rn.viewport,va=rn.scissor_box;Oi[0]=Oi[1]=va[0]=va[1]=0,Ur.viewportWidth=Ur.framebufferWidth=Ur.drawingBufferWidth=Oi[2]=va[2]=rt.drawingBufferWidth,Ur.viewportHeight=Ur.framebufferHeight=Ur.drawingBufferHeight=Oi[3]=va[3]=rt.drawingBufferHeight}function Mo(){Ur.tick+=1,Ur.time=Ls(),eu(),Kn.procs.poll()}function $i(){Ei.refresh(),eu(),Kn.procs.refresh(),an&&an.update()}function Ls(){return(Wa()-cn)/1e3}$i();function Ka(Oi,va){j.type(va,"function","listener callback must be a function");var Ga;switch(Oi){case"frame":return is(va);case"lost":Ga=aa;break;case"restore":Ga=zi;break;case"destroy":Ga=Pn;break;default:j.raise("invalid event, must be one of frame,lost,restore,destroy")}return Ga.push(va),{cancel:function(){for(var ws=0;ws<Ga.length;++ws)if(Ga[ws]===va){Ga[ws]=Ga[Ga.length-1],Ga.pop();return}}}}var fu=_(Lo,{clear:Ko,prop:mn.define.bind(null,Vf),context:mn.define.bind(null,Wi),this:mn.define.bind(null,Wl),draw:Lo({}),buffer:function(Oi){return nn.create(Oi,sh,!1,!1)},elements:function(Oi){return wn.create(Oi,!1)},texture:Ei.create2D,cube:Ei.createCube,renderbuffer:kr.create,framebuffer:Lr.create,framebufferCube:Lr.createCube,vao:Dr.createVAO,attributes:Kt,frame:is,on:Ka,limits:xr,hasExtension:function(Oi){return xr.extensions.indexOf(Oi.toLowerCase())>=0},read:In,destroy:Gr,_gl:rt,_refresh:$i,poll:function(){Mo(),an&&an.update()},now:Ls,stats:Hr});return Le.onDone(null,fu),fu}return uh})},44286:function(Yr){function ge(ie){return ie.split("")}Yr.exports=ge},18190:function(Yr){var ge=9007199254740991,ie=Math.floor;function Oe(Z,_){var Pe="";if(!Z||_<1||_>ge)return Pe;do _%2&&(Pe+=Z),_=ie(_/2),_&&(Z+=Z);while(_);return Pe}Yr.exports=Oe},14259:function(Yr){function ge(ie,Oe,Z){var _=-1,Pe=ie.length;Oe<0&&(Oe=-Oe>Pe?0:Pe+Oe),Z=Z>Pe?Pe:Z,Z<0&&(Z+=Pe),Pe=Oe>Z?0:Z-Oe>>>0,Oe>>>=0;for(var K=Array(Pe);++_<Pe;)K[_]=ie[_+Oe];return K}Yr.exports=ge},40180:function(Yr,ge,ie){var Oe=ie(14259);function Z(_,Pe,K){var xe=_.length;return K=K===void 0?xe:K,!Pe&&K>=xe?_:Oe(_,Pe,K)}Yr.exports=Z},78302:function(Yr,ge,ie){var Oe=ie(18190),Z=ie(80531),_=ie(40180),Pe=ie(62689),K=ie(88016),xe=ie(83140),ve=Math.ceil;function tt(Ae,at){at=at===void 0?" ":Z(at);var gt=at.length;if(gt<2)return gt?Oe(at,Ae):at;var Mt=Oe(at,ve(Ae/K(at)));return Pe(at)?_(xe(Mt),0,Ae).join(""):Mt.slice(0,Ae)}Yr.exports=tt},83140:function(Yr,ge,ie){var Oe=ie(44286),Z=ie(62689),_=ie(676);function Pe(K){return Z(K)?_(K):Oe(K)}Yr.exports=Pe},676:function(Yr){var ge="\\ud800-\\udfff",ie="\\u0300-\\u036f",Oe="\\ufe20-\\ufe2f",Z="\\u20d0-\\u20ff",_=ie+Oe+Z,Pe="\\ufe0e\\ufe0f",K="["+ge+"]",xe="["+_+"]",ve="\\ud83c[\\udffb-\\udfff]",tt="(?:"+xe+"|"+ve+")",Ae="[^"+ge+"]",at="(?:\\ud83c[\\udde6-\\uddff]){2}",gt="[\\ud800-\\udbff][\\udc00-\\udfff]",Mt="\\u200d",Ft=tt+"?",mr="["+Pe+"]?",jt="(?:"+Mt+"(?:"+[Ae,at,gt].join("|")+")"+mr+Ft+")*",hr=mr+Ft+jt,qt="(?:"+[Ae+xe+"?",xe,at,gt,K].join("|")+")",Dt=RegExp(ve+"(?="+ve+")|"+qt+hr,"g");function Pt(Cr){return Cr.match(Dt)||[]}Yr.exports=Pt},60442:function(Yr,ge,ie){var Oe=ie(90939);function Z(_,Pe){return Oe(_,Pe)}Yr.exports=Z},96486:function(Yr,ge,ie){Yr=ie.nmd(Yr);var Oe;/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(){var Z,_="4.17.21",Pe=200,K="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",xe="Expected a function",ve="Invalid `variable` option passed into `_.template`",tt="__lodash_hash_undefined__",Ae=500,at="__lodash_placeholder__",gt=1,Mt=2,Ft=4,mr=1,jt=2,hr=1,qt=2,Dt=4,Pt=8,Cr=16,ne=32,gr=64,It=128,xt=256,Jt=512,Ct=30,br="...",$r=800,oe=16,Ue=1,H=2,U=3,de=1/0,Xe=9007199254740991,lt=17976931348623157e292,yt=0/0,Vt=4294967295,pr=Vt-1,tn=Vt>>>1,Kr=[["ary",It],["bind",hr],["bindKey",qt],["curry",Pt],["curryRight",Cr],["flip",Jt],["partial",ne],["partialRight",gr],["rearg",xt]],si="[object Arguments]",xn="[object Array]",ii="[object AsyncFunction]",Ra="[object Boolean]",Di="[object Date]",Pi="[object DOMException]",ua="[object Error]",sa="[object Function]",Bi="[object GeneratorFunction]",Yn="[object Map]",bi="[object Number]",Ms="[object Null]",Ha="[object Object]",eo="[object Promise]",Rt="[object Proxy]",be="[object RegExp]",ce="[object Set]",Me="[object String]",j="[object Symbol]",ut="[object Undefined]",ir="[object WeakMap]",Jr="[object WeakSet]",nt="[object ArrayBuffer]",Bt="[object DataView]",Ar="[object Float32Array]",zr="[object Float64Array]",un="[object Int8Array]",vn="[object Int16Array]",ui="[object Int32Array]",Jn="[object Uint8Array]",mn="[object Uint8ClampedArray]",Ri="[object Uint16Array]",Si="[object Uint32Array]",Wa=/\b__p \+= '';/g,uo=/\b(__p \+=) '' \+/g,Io=/(__e\(.*?\)|\b__t\)) \+\n'';/g,to=/&(?:amp|lt|gt|quot|#39);/g,La=/[&<>"']/g,te=RegExp(to.source),le=RegExp(La.source),ye=/<%-([\s\S]+?)%>/g,Re=/<%([\s\S]+?)%>/g,He=/<%=([\s\S]+?)%>/g,ht=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,At=/^\w*$/,Te=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Je=/[\\^$.*+?()[\]{}|]/g,Xt=RegExp(Je.source),Wr=/^\s+/,cr=/\s/,dr=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,jr=/\{\n\/\* \[wrapped with (.+)\] \*/,qn=/,? & /,Un=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ar=/[()=,{}\[\]\/\s]/,ot=/\\(\\)?/g,Cn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,se=/\w*$/,Yi=/^[-+]0x[0-9a-f]+$/i,Fn=/^0b[01]+$/i,ta=/^\[object .+?Constructor\]$/,$a=/^0o[0-7]+$/i,ra=/^(?:0|[1-9]\d*)$/,pa=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Xi=/($^)/,Ui=/['\n\r\u2028\u2029\\]/g,ma="\\ud800-\\udfff",bo="\\u0300-\\u036f",Za="\\ufe20-\\ufe2f",fa="\\u20d0-\\u20ff",na=bo+Za+fa,To="\\u2700-\\u27bf",Ou="a-z\\xdf-\\xf6\\xf8-\\xff",ko="\\xac\\xb1\\xd7\\xf7",ao="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",iu="\\u2000-\\u206f",au=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ua="A-Z\\xc0-\\xd6\\xd8-\\xde",zl="\\ufe0e\\ufe0f",Xo=ko+ao+iu+au,Eo="['\u2019]",jo="["+ma+"]",Va="["+Xo+"]",vs="["+na+"]",Hs="\\d+",Ml="["+To+"]",ms="["+Ou+"]",Bs="[^"+ma+Xo+Hs+To+Ou+Ua+"]",Da="\\ud83c[\\udffb-\\udfff]",$o="(?:"+vs+"|"+Da+")",Ys="[^"+ma+"]",Ht="(?:\\ud83c[\\udde6-\\uddff]){2}",tr="[\\ud800-\\udbff][\\udc00-\\udfff]",J="["+Ua+"]",Cu="\\u200d",_e="(?:"+ms+"|"+Bs+")",Ne="(?:"+J+"|"+Bs+")",wt="(?:"+Eo+"(?:d|ll|m|re|s|t|ve))?",ur="(?:"+Eo+"(?:D|LL|M|RE|S|T|VE))?",gn=$o+"?",li="["+zl+"]?",da="(?:"+Cu+"(?:"+[Ys,Ht,tr].join("|")+")"+li+gn+")*",es="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Fr="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Nr=li+gn+da,it="(?:"+[Ml,Ht,tr].join("|")+")"+Nr,gu="(?:"+[Ys+vs+"?",vs,Ht,tr,jo].join("|")+")",qs=RegExp(Eo,"g"),Tu=RegExp(vs,"g"),Ns=RegExp(Da+"(?="+Da+")|"+gu+Nr,"g"),yu=RegExp([J+"?"+ms+"+"+wt+"(?="+[Va,J,"$"].join("|")+")",Ne+"+"+ur+"(?="+[Va,J+_e,"$"].join("|")+")",J+"?"+_e+"+"+wt,J+"+"+ur,Fr,es,Hs,it].join("|"),"g"),_u=RegExp("["+Cu+ma+na+zl+"]"),Ju=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Mu=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],lo=-1,xa={};xa[Ar]=xa[zr]=xa[un]=xa[vn]=xa[ui]=xa[Jn]=xa[mn]=xa[Ri]=xa[Si]=!0,xa[si]=xa[xn]=xa[nt]=xa[Ra]=xa[Bt]=xa[Di]=xa[ua]=xa[sa]=xa[Yn]=xa[bi]=xa[Ha]=xa[be]=xa[ce]=xa[Me]=xa[ir]=!1;var mo={};mo[si]=mo[xn]=mo[nt]=mo[Bt]=mo[Ra]=mo[Di]=mo[Ar]=mo[zr]=mo[un]=mo[vn]=mo[ui]=mo[Yn]=mo[bi]=mo[Ha]=mo[be]=mo[ce]=mo[Me]=mo[j]=mo[Jn]=mo[mn]=mo[Ri]=mo[Si]=!0,mo[ua]=mo[sa]=mo[ir]=!1;var Wf={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},Ks={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Xf={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Jc={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Il=parseFloat,Ke=parseInt,Rc=typeof ie.g=="object"&&ie.g&&ie.g.Object===Object&&ie.g,S=typeof self=="object"&&self&&self.Object===Object&&self,R=Rc||S||Function("return this")(),W=ge&&!ge.nodeType&&ge,F=W&&!0&&Yr&&!Yr.nodeType&&Yr,ue=F&&F.exports===W,De=ue&&Rc.process,ft=function(){try{var kt=F&&F.require&&F.require("util").types;return kt||De&&De.binding&&De.binding("util")}catch(Zr){}}(),Gt=ft&&ft.isArrayBuffer,Wt=ft&&ft.isDate,Or=ft&&ft.isMap,en=ft&&ft.isRegExp,ci=ft&&ft.isSet,Gi=ft&&ft.isTypedArray;function vi(kt,Zr,Mr){switch(Mr.length){case 0:return kt.call(Zr);case 1:return kt.call(Zr,Mr[0]);case 2:return kt.call(Zr,Mr[0],Mr[1]);case 3:return kt.call(Zr,Mr[0],Mr[1],Mr[2])}return kt.apply(Zr,Mr)}function ka(kt,Zr,Mr,fi){for(var Vn=-1,Ni=kt==null?0:kt.length;++Vn<Ni;){var Xa=kt[Vn];Zr(fi,Xa,Mr(Xa),kt)}return fi}function ha(kt,Zr){for(var Mr=-1,fi=kt==null?0:kt.length;++Mr<fi&&Zr(kt[Mr],Mr,kt)!==!1;);return kt}function So(kt,Zr){for(var Mr=kt==null?0:kt.length;Mr--&&Zr(kt[Mr],Mr,kt)!==!1;);return kt}function Sa(kt,Zr){for(var Mr=-1,fi=kt==null?0:kt.length;++Mr<fi;)if(!Zr(kt[Mr],Mr,kt))return!1;return!0}function Ho(kt,Zr){for(var Mr=-1,fi=kt==null?0:kt.length,Vn=0,Ni=[];++Mr<fi;){var Xa=kt[Mr];Zr(Xa,Mr,kt)&&(Ni[Vn++]=Xa)}return Ni}function xu(kt,Zr){var Mr=kt==null?0:kt.length;return!!Mr&&el(kt,Zr,0)>-1}function hl(kt,Zr,Mr){for(var fi=-1,Vn=kt==null?0:kt.length;++fi<Vn;)if(Mr(Zr,kt[fi]))return!0;return!1}function No(kt,Zr){for(var Mr=-1,fi=kt==null?0:kt.length,Vn=Array(fi);++Mr<fi;)Vn[Mr]=Zr(kt[Mr],Mr,kt);return Vn}function Iu(kt,Zr){for(var Mr=-1,fi=Zr.length,Vn=kt.length;++Mr<fi;)kt[Vn+Mr]=Zr[Mr];return kt}function ef(kt,Zr,Mr,fi){var Vn=-1,Ni=kt==null?0:kt.length;for(fi&&Ni&&(Mr=kt[++Vn]);++Vn<Ni;)Mr=Zr(Mr,kt[Vn],Vn,kt);return Mr}function ql(kt,Zr,Mr,fi){var Vn=kt==null?0:kt.length;for(fi&&Vn&&(Mr=kt[--Vn]);Vn--;)Mr=Zr(Mr,kt[Vn],Vn,kt);return Mr}function kl(kt,Zr){for(var Mr=-1,fi=kt==null?0:kt.length;++Mr<fi;)if(Zr(kt[Mr],Mr,kt))return!0;return!1}var Kl=Jl("length");function ts(kt){return kt.split("")}function Hh(kt){return kt.match(Un)||[]}function Sh(kt,Zr,Mr){var fi;return Mr(kt,function(Vn,Ni,Xa){if(Zr(Vn,Ni,Xa))return fi=Ni,!1}),fi}function us(kt,Zr,Mr,fi){for(var Vn=kt.length,Ni=Mr+(fi?1:-1);fi?Ni--:++Ni<Vn;)if(Zr(kt[Ni],Ni,kt))return Ni;return-1}function el(kt,Zr,Mr){return Zr===Zr?Pf(kt,Zr,Mr):us(kt,tl,Mr)}function Ql(kt,Zr,Mr,fi){for(var Vn=Mr-1,Ni=kt.length;++Vn<Ni;)if(fi(kt[Vn],Zr))return Vn;return-1}function tl(kt){return kt!==kt}function kf(kt,Zr){var Mr=kt==null?0:kt.length;return Mr?zs(kt,Zr)/Mr:yt}function Jl(kt){return function(Zr){return Zr==null?Z:Zr[kt]}}function oo(kt){return function(Zr){return kt==null?Z:kt[Zr]}}function vc(kt,Zr,Mr,fi,Vn){return Vn(kt,function(Ni,Xa,co){Mr=fi?(fi=!1,Ni):Zr(Mr,Ni,Xa,co)}),Mr}function rl(kt,Zr){var Mr=kt.length;for(kt.sort(Zr);Mr--;)kt[Mr]=kt[Mr].value;return kt}function zs(kt,Zr){for(var Mr,fi=-1,Vn=kt.length;++fi<Vn;){var Ni=Zr(kt[fi]);Ni!==Z&&(Mr=Mr===Z?Ni:Mr+Ni)}return Mr}function wh(kt,Zr){for(var Mr=-1,fi=Array(kt);++Mr<kt;)fi[Mr]=Zr(Mr);return fi}function dd(kt,Zr){return No(Zr,function(Mr){return[Mr,kt[Mr]]})}function Zl(kt){return kt&&kt.slice(0,tc(kt)+1).replace(Wr,"")}function Fu(kt){return function(Zr){return kt(Zr)}}function mc(kt,Zr){return No(Zr,function(Mr){return kt[Mr]})}function Pl(kt,Zr){return kt.has(Zr)}function gc(kt,Zr){for(var Mr=-1,fi=kt.length;++Mr<fi&&el(Zr,kt[Mr],0)>-1;);return Mr}function Lc(kt,Zr){for(var Mr=kt.length;Mr--&&el(Zr,kt[Mr],0)>-1;);return Mr}function Oc(kt,Zr){for(var Mr=kt.length,fi=0;Mr--;)kt[Mr]===Zr&&++fi;return fi}var tf=oo(Wf),Rl=oo(Ks);function gs(kt){return"\\"+Jc[kt]}function Ah(kt,Zr){return kt==null?Z:kt[Zr]}function yc(kt){return _u.test(kt)}function Wh(kt){return Ju.test(kt)}function ec(kt){for(var Zr,Mr=[];!(Zr=kt.next()).done;)Mr.push(Zr.value);return Mr}function Zs(kt){var Zr=-1,Mr=Array(kt.size);return kt.forEach(function(fi,Vn){Mr[++Zr]=[Vn,fi]}),Mr}function _c(kt,Zr){return function(Mr){return kt(Zr(Mr))}}function pl(kt,Zr){for(var Mr=-1,fi=kt.length,Vn=0,Ni=[];++Mr<fi;){var Xa=kt[Mr];(Xa===Zr||Xa===at)&&(kt[Mr]=at,Ni[Vn++]=Mr)}return Ni}function Ws(kt){var Zr=-1,Mr=Array(kt.size);return kt.forEach(function(fi){Mr[++Zr]=fi}),Mr}function yp(kt){var Zr=-1,Mr=Array(kt.size);return kt.forEach(function(fi){Mr[++Zr]=[fi,fi]}),Mr}function Pf(kt,Zr,Mr){for(var fi=Mr-1,Vn=kt.length;++fi<Vn;)if(kt[fi]===Zr)return fi;return-1}function Fc(kt,Zr,Mr){for(var fi=Mr+1;fi--;)if(kt[fi]===Zr)return fi;return fi}function xc(kt){return yc(kt)?Xh(kt):Kl(kt)}function nl(kt){return yc(kt)?$h(kt):ts(kt)}function tc(kt){for(var Zr=kt.length;Zr--&&cr.test(kt.charAt(Zr)););return Zr}var Ch=oo(Xf);function Xh(kt){for(var Zr=Ns.lastIndex=0;Ns.test(kt);)++Zr;return Zr}function $h(kt){return kt.match(Ns)||[]}function rf(kt){return kt.match(yu)||[]}var _p=function kt(Zr){Zr=Zr==null?R:rc.defaults(R.Object(),Zr,rc.pick(R,Mu));var Mr=Zr.Array,fi=Zr.Date,Vn=Zr.Error,Ni=Zr.Function,Xa=Zr.Math,co=Zr.Object,Ul=Zr.RegExp,Th=Zr.String,ou=Zr.TypeError,Mh=Mr.prototype,$f=Ni.prototype,bc=co.prototype,il=Zr["__core-js_shared__"],ys=$f.toString,go=bc.hasOwnProperty,Yf=0,_s=function(){var m=/[^.]+$/.exec(il&&il.keys&&il.keys.IE_PROTO||"");return m?"Symbol(src)_1."+m:""}(),Gn=bc.toString,rs=ys.call(co),nc=R._,nf=Ul("^"+ys.call(go).replace(Je,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Du=ue?Zr.Buffer:Z,Is=Zr.Symbol,af=Zr.Uint8Array,Sn=Du?Du.allocUnsafe:Z,of=_c(co.getPrototypeOf,co),qf=co.create,Ec=bc.propertyIsEnumerable,fo=Mh.splice,Bu=Is?Is.isConcatSpreadable:Z,Dc=Is?Is.iterator:Z,Nu=Is?Is.toStringTag:Z,su=function(){try{var m=uh(co,"defineProperty");return m({},"",{}),m}catch(x){}}(),ic=Zr.clearTimeout!==R.clearTimeout&&Zr.clearTimeout,xp=fi&&fi.now!==R.Date.now&&fi.now,sf=Zr.setTimeout!==R.setTimeout&&Zr.setTimeout,Bc=Xa.ceil,Rf=Xa.floor,al=co.getOwnPropertySymbols,dl=Du?Du.isBuffer:Z,ga=Zr.isFinite,ac=Mh.join,vl=_c(co.keys,co),Ya=Xa.max,xs=Xa.min,Nc=fi.now,Yo=Zr.parseInt,bu=Xa.random,wa=Mh.reverse,mi=uh(Zr,"DataView"),ai=uh(Zr,"Map"),uf=uh(Zr,"Promise"),ks=uh(Zr,"Set"),ku=uh(Zr,"WeakMap"),ls=uh(co,"create"),ol=ku&&new ku,Vl={},Kf=Ro(mi),qa=Ro(ai),zo=Ro(uf),bp=Ro(ks),zc=Ro(ku),sl=Is?Is.prototype:Z,zu=sl?sl.valueOf:Z,bs=sl?sl.toString:Z;function Ie(m){if(Gs(m)&&!ca(m)&&!(m instanceof Ba)){if(m instanceof Js)return m;if(go.call(m,"__wrapped__"))return Gr(m)}return new Js(m)}var Qs=function(){function m(){}return function(x){if(!hs(x))return{};if(qf)return qf(x);m.prototype=x;var P=new m;return m.prototype=Z,P}}();function Sc(){}function Js(m,x){this.__wrapped__=m,this.__actions__=[],this.__chain__=!!x,this.__index__=0,this.__values__=Z}Ie.templateSettings={escape:ye,evaluate:Re,interpolate:He,variable:"",imports:{_:Ie}},Ie.prototype=Sc.prototype,Ie.prototype.constructor=Ie,Js.prototype=Qs(Sc.prototype),Js.prototype.constructor=Js;function Ba(m){this.__wrapped__=m,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Vt,this.__views__=[]}function Oa(){var m=new Ba(this.__wrapped__);return m.__actions__=Us(this.__actions__),m.__dir__=this.__dir__,m.__filtered__=this.__filtered__,m.__iteratees__=Us(this.__iteratees__),m.__takeCount__=this.__takeCount__,m.__views__=Us(this.__views__),m}function Ll(){if(this.__filtered__){var m=new Ba(this);m.__dir__=-1,m.__filtered__=!0}else m=this.clone(),m.__dir__*=-1;return m}function Zu(){var m=this.__wrapped__.value(),x=this.__dir__,P=ca(m),G=x<0,pe=P?m.length:0,ze=Pr(0,pe,this.__views__),_t=ze.start,Ot=ze.end,or=Ot-_t,qr=G?Ot:_t-1,fn=this.__iteratees__,Tn=fn.length,pi=0,Ji=xs(or,this.__takeCount__);if(!P||!G&&pe==or&&Ji==or)return nh(m,this.__actions__);var Ia=[];e:for(;or--&&pi<Ji;){qr+=x;for(var vo=-1,Ea=m[qr];++vo<Tn;){var Ao=fn[vo],xo=Ao.iteratee,Cf=Ao.type,kc=xo(Ea);if(Cf==H)Ea=kc;else if(!kc){if(Cf==Ue)continue e;break e}}Ia[pi++]=Ea}return Ia}Ba.prototype=Qs(Sc.prototype),Ba.prototype.constructor=Ba;function Gl(m){var x=-1,P=m==null?0:m.length;for(this.clear();++x<P;){var G=m[x];this.set(G[0],G[1])}}function Zc(){this.__data__=ls?ls(null):{},this.size=0}function Uc(m){var x=this.has(m)&&delete this.__data__[m];return this.size-=x?1:0,x}function Ih(m){var x=this.__data__;if(ls){var P=x[m];return P===tt?Z:P}return go.call(x,m)?x[m]:Z}function Vc(m){var x=this.__data__;return ls?x[m]!==Z:go.call(x,m)}function Uu(m,x){var P=this.__data__;return this.size+=this.has(m)?0:1,P[m]=ls&&x===Z?tt:x,this}Gl.prototype.clear=Zc,Gl.prototype.delete=Uc,Gl.prototype.get=Ih,Gl.prototype.has=Vc,Gl.prototype.set=Uu;function ul(m){var x=-1,P=m==null?0:m.length;for(this.clear();++x<P;){var G=m[x];this.set(G[0],G[1])}}function jl(){this.__data__=[],this.size=0}function Lf(m){var x=this.__data__,P=Xr(x,m);if(P<0)return!1;var G=x.length-1;return P==G?x.pop():fo.call(x,P,1),--this.size,!0}function Ti(m){var x=this.__data__,P=Xr(x,m);return P<0?Z:x[P][1]}function f(m){return Xr(this.__data__,m)>-1}function d(m,x){var P=this.__data__,G=Xr(P,m);return G<0?(++this.size,P.push([m,x])):P[G][1]=x,this}ul.prototype.clear=jl,ul.prototype.delete=Lf,ul.prototype.get=Ti,ul.prototype.has=f,ul.prototype.set=d;function h(m){var x=-1,P=m==null?0:m.length;for(this.clear();++x<P;){var G=m[x];this.set(G[0],G[1])}}function y(){this.size=0,this.__data__={hash:new Gl,map:new(ai||ul),string:new Gl}}function C(m){var x=Wl(this,m).delete(m);return this.size-=x?1:0,x}function I(m){return Wl(this,m).get(m)}function L(m){return Wl(this,m).has(m)}function B(m,x){var P=Wl(this,m),G=P.size;return P.set(m,x),this.size+=P.size==G?0:1,this}h.prototype.clear=y,h.prototype.delete=C,h.prototype.get=I,h.prototype.has=L,h.prototype.set=B;function Y(m){var x=-1,P=m==null?0:m.length;for(this.__data__=new h;++x<P;)this.add(m[x])}function ae(m){return this.__data__.set(m,tt),this}function Ce(m){return this.__data__.has(m)}Y.prototype.add=Y.prototype.push=ae,Y.prototype.has=Ce;function we(m){var x=this.__data__=new ul(m);this.size=x.size}function ke(){this.__data__=new ul,this.size=0}function Qe(m){var x=this.__data__,P=x.delete(m);return this.size=x.size,P}function Ye(m){return this.__data__.get(m)}function mt(m){return this.__data__.has(m)}function je(m,x){var P=this.__data__;if(P instanceof ul){var G=P.__data__;if(!ai||G.length<Pe-1)return G.push([m,x]),this.size=++P.size,this;P=this.__data__=new h(G)}return P.set(m,x),this.size=P.size,this}we.prototype.clear=ke,we.prototype.delete=Qe,we.prototype.get=Ye,we.prototype.has=mt,we.prototype.set=je;function dt(m,x){var P=ca(m),G=!P&&Wo(m),pe=!P&&!G&&Bl(m),ze=!P&&!G&&!pe&&Ef(m),_t=P||G||pe||ze,Ot=_t?wh(m.length,Th):[],or=Ot.length;for(var qr in m)(x||go.call(m,qr))&&!(_t&&(qr=="length"||pe&&(qr=="offset"||qr=="parent")||ze&&(qr=="buffer"||qr=="byteLength"||qr=="byteOffset")||_n(qr,or)))&&Ot.push(qr);return Ot}function vt(m){var x=m.length;return x?m[eh(0,x-1)]:Z}function $t(m,x){return Vi(Us(m),gi(x,0,m.length))}function Sr(m){return Vi(Us(m))}function yr(m,x,P){(P!==Z&&!Ru(m[x],P)||P===Z&&!(x in m))&&ei(m,x,P)}function wr(m,x,P){var G=m[x];(!(go.call(m,x)&&Ru(G,P))||P===Z&&!(x in m))&&ei(m,x,P)}function Xr(m,x){for(var P=m.length;P--;)if(Ru(m[P][0],x))return P;return-1}function yn(m,x,P,G){return yi(m,function(pe,ze,_t){x(G,pe,P(pe),_t)}),G}function ln(m,x){return m&&cl(x,du(x),m)}function Bn(m,x){return m&&cl(x,fl(x),m)}function ei(m,x,P){x=="__proto__"&&su?su(m,x,{configurable:!0,enumerable:!0,value:P,writable:!0}):m[x]=P}function _i(m,x){for(var P=-1,G=x.length,pe=Mr(G),ze=m==null;++P<G;)pe[P]=ze?Z:Hd(m,x[P]);return pe}function gi(m,x,P){return m===m&&(P!==Z&&(m=m<=P?m:P),x!==Z&&(m=m>=x?m:x)),m}function Ki(m,x,P,G,pe,ze){var _t,Ot=x&gt,or=x&Mt,qr=x&Ft;if(P&&(_t=pe?P(m,G,pe,ze):P(m)),_t!==Z)return _t;if(!hs(m))return m;var fn=ca(m);if(fn){if(_t=Hr(m),!Ot)return Us(m,_t)}else{var Tn=Kt(m),pi=Tn==sa||Tn==Bi;if(Bl(m))return ep(m,Ot);if(Tn==Ha||Tn==si||pi&&!pe){if(_t=or||pi?{}:Qr(m),!Ot)return or?Ap(m,Bn(_t,m)):yd(m,ln(_t,m))}else{if(!mo[Tn])return pe?m:{};_t=an(m,Tn,Ot)}}ze||(ze=new we);var Ji=ze.get(m);if(Ji)return Ji;ze.set(m,_t),fp(m)?m.forEach(function(Ea){_t.add(Ki(Ea,x,P,Ea,m,ze))}):Ip(m)&&m.forEach(function(Ea,Ao){_t.set(Ao,Ki(Ea,x,P,Ao,m,ze))});var Ia=qr?or?sh:op:or?fl:du,vo=fn?Z:Ia(m);return ha(vo||m,function(Ea,Ao){vo&&(Ao=Ea,Ea=m[Ao]),wr(_t,Ao,Ki(Ea,x,P,Ao,m,ze))}),_t}function Nn(m){var x=du(m);return function(P){return Hi(P,m,x)}}function Hi(m,x,P){var G=P.length;if(m==null)return!G;for(m=co(m);G--;){var pe=P[G],ze=x[pe],_t=m[pe];if(_t===Z&&!(pe in m)||!ze(_t))return!1}return!0}function Qi(m,x,P){if(typeof m!="function")throw new ou(xe);return zi(function(){m.apply(Z,P)},x)}function Li(m,x,P,G){var pe=-1,ze=xu,_t=!0,Ot=m.length,or=[],qr=x.length;if(!Ot)return or;P&&(x=No(x,Fu(P))),G?(ze=hl,_t=!1):x.length>=Pe&&(ze=Pl,_t=!1,x=new Y(x));e:for(;++pe<Ot;){var fn=m[pe],Tn=P==null?fn:P(fn);if(fn=G||fn!==0?fn:0,_t&&Tn===Tn){for(var pi=qr;pi--;)if(x[pi]===Tn)continue e;or.push(fn)}else ze(x,Tn,G)||or.push(fn)}return or}var yi=df(wo),ia=df(uu,!0);function Ii(m,x){var P=!0;return yi(m,function(G,pe,ze){return P=!!x(G,pe,ze),P}),P}function wi(m,x,P){for(var G=-1,pe=m.length;++G<pe;){var ze=m[G],_t=x(ze);if(_t!=null&&(Ot===Z?_t===_t&&!Al(_t):P(_t,Ot)))var Ot=_t,or=ze}return or}function cs(m,x,P,G){var pe=m.length;for(P=Fi(P),P<0&&(P=-P>pe?0:pe+P),G=G===Z||G>pe?pe:Fi(G),G<0&&(G+=pe),G=P>G?0:qc(G);P<G;)m[P++]=x;return m}function Po(m,x){var P=[];return yi(m,function(G,pe,ze){x(G,pe,ze)&&P.push(G)}),P}function ro(m,x,P,G,pe){var ze=-1,_t=m.length;for(P||(P=hn),pe||(pe=[]);++ze<_t;){var Ot=m[ze];x>0&&P(Ot)?x>1?ro(Ot,x-1,P,G,pe):Iu(pe,Ot):G||(pe[pe.length]=Ot)}return pe}var Ps=Dl(),Zo=Dl(!0);function wo(m,x){return m&&Ps(m,x,du)}function uu(m,x){return m&&Zo(m,x,du)}function Rs(m,x){return Ho(x,function(P){return Tc(m[P])})}function Vu(m,x){x=lc(x,m);for(var P=0,G=x.length;m!=null&&P<G;)m=m[io(x[P++])];return P&&P==G?m:Z}function lu(m,x,P){var G=x(m);return ca(m)?G:Iu(G,P(m))}function qo(m){return m==null?m===Z?ut:Ms:Nu&&Nu in co(m)?X(m):Kn(m)}function Gu(m,x){return m>x}function Es(m,x){return m!=null&&go.call(m,x)}function Of(m,x){return m!=null&&x in co(m)}function wc(m,x,P){return m>=xs(x,P)&&m<Ya(x,P)}function Gc(m,x,P){for(var G=P?hl:xu,pe=m[0].length,ze=m.length,_t=ze,Ot=Mr(ze),or=Infinity,qr=[];_t--;){var fn=m[_t];_t&&x&&(fn=No(fn,Fu(x))),or=xs(fn.length,or),Ot[_t]=!P&&(x||pe>=120&&fn.length>=120)?new Y(_t&&fn):Z}fn=m[0];var Tn=-1,pi=Ot[0];e:for(;++Tn<pe&&qr.length<or;){var Ji=fn[Tn],Ia=x?x(Ji):Ji;if(Ji=P||Ji!==0?Ji:0,!(pi?Pl(pi,Ia):G(qr,Ia,P))){for(_t=ze;--_t;){var vo=Ot[_t];if(!(vo?Pl(vo,Ia):G(m[_t],Ia,P)))continue e}pi&&pi.push(Ia),qr.push(Ji)}}return qr}function Ff(m,x,P,G){return wo(m,function(pe,ze,_t){x(G,P(pe),ze,_t)}),G}function ju(m,x,P){x=lc(x,m),m=rn(m,x);var G=m==null?m:m[io(Lt(x))];return G==null?Z:vi(G,m,P)}function Ol(m){return Gs(m)&&qo(m)==si}function ml(m){return Gs(m)&&qo(m)==nt}function ns(m){return Gs(m)&&qo(m)==Di}function Hu(m,x,P,G,pe){return m===x?!0:m==null||x==null||!Gs(m)&&!Gs(x)?m!==m&&x!==x:oc(m,x,P,G,Hu,pe)}function oc(m,x,P,G,pe,ze){var _t=ca(m),Ot=ca(x),or=_t?xn:Kt(m),qr=Ot?xn:Kt(x);or=or==si?Ha:or,qr=qr==si?Ha:qr;var fn=or==Ha,Tn=qr==Ha,pi=or==qr;if(pi&&Bl(m)){if(!Bl(x))return!1;_t=!0,fn=!1}if(pi&&!fn)return ze||(ze=new we),_t||Ef(m)?Bh(m,x,P,G,pe,ze):bd(m,x,or,P,G,pe,ze);if(!(P&mr)){var Ji=fn&&go.call(m,"__wrapped__"),Ia=Tn&&go.call(x,"__wrapped__");if(Ji||Ia){var vo=Ji?m.value():m,Ea=Ia?x.value():x;return ze||(ze=new we),pe(vo,Ea,P,G,ze)}}return pi?(ze||(ze=new we),Wp(m,x,P,G,pe,ze)):!1}function Ac(m){return Gs(m)&&Kt(m)==Yn}function Na(m,x,P,G){var pe=P.length,ze=pe,_t=!G;if(m==null)return!ze;for(m=co(m);pe--;){var Ot=P[pe];if(_t&&Ot[2]?Ot[1]!==m[Ot[0]]:!(Ot[0]in m))return!1}for(;++pe<ze;){Ot=P[pe];var or=Ot[0],qr=m[or],fn=Ot[1];if(_t&&Ot[2]){if(qr===Z&&!(or in m))return!1}else{var Tn=new we;if(G)var pi=G(qr,fn,or,m,x,Tn);if(!(pi===Z?Hu(fn,qr,mr|jt,G,Tn):pi))return!1}}return!0}function ll(m){if(!hs(m)||nn(m))return!1;var x=Tc(m)?nf:ta;return x.test(Ro(m))}function Eu(m){return Gs(m)&&qo(m)==be}function jc(m){return Gs(m)&&Kt(m)==ce}function gl(m){return Gs(m)&&_f(m.length)&&!!xa[qo(m)]}function Df(m){return typeof m=="function"?m:m==null?Ic:typeof m=="object"?ca(m)?Qf(m[0],m[1]):sc(m):_0(m)}function Bf(m){if(!Dr(m))return vl(m);var x=[];for(var P in co(m))go.call(m,P)&&P!="constructor"&&x.push(P);return x}function Fl(m){if(!hs(m))return Lr(m);var x=Dr(m),P=[];for(var G in m)G=="constructor"&&(x||!go.call(m,G))||P.push(G);return P}function lf(m,x){return m<x}function yl(m,x){var P=-1,G=Qu(m)?Mr(m.length):[];return yi(m,function(pe,ze,_t){G[++P]=x(pe,ze,_t)}),G}function sc(m){var x=Nh(m);return x.length==1&&x[0][2]?Mn(x[0][0],x[0][1]):function(P){return P===m||Na(P,m,x)}}function Qf(m,x){return sn(m)&&pn(x)?Mn(io(m),x):function(P){var G=Hd(P,m);return G===Z&&G===x?yv(P,m):Hu(x,G,mr|jt)}}function Su(m,x,P,G,pe){m!==x&&Ps(x,function(ze,_t){if(pe||(pe=new we),hs(ze))Xs(m,x,_t,P,Su,G,pe);else{var Ot=G?G(Rn(m,_t),ze,_t+"",m,x,pe):Z;Ot===Z&&(Ot=ze),yr(m,_t,Ot)}},fl)}function Xs(m,x,P,G,pe,ze,_t){var Ot=Rn(m,P),or=Rn(x,P),qr=_t.get(or);if(qr){yr(m,P,qr);return}var fn=ze?ze(Ot,or,P+"",m,x,_t):Z,Tn=fn===Z;if(Tn){var pi=ca(or),Ji=!pi&&Bl(or),Ia=!pi&&!Ji&&Ef(or);fn=or,pi||Ji||Ia?ca(Ot)?fn=Ot:Cs(Ot)?fn=Us(Ot):Ji?(Tn=!1,fn=ep(or,!0)):Ia?(Tn=!1,fn=Oh(or,!0)):fn=[]:xf(or)||Wo(or)?(fn=Ot,Wo(Ot)?fn=hh(Ot):(!hs(Ot)||Tc(Ot))&&(fn=Qr(or))):Tn=!1}Tn&&(_t.set(or,fn),pe(fn,or,G,ze,_t),_t.delete(or)),yr(m,P,fn)}function cf(m,x){var P=m.length;if(!!P)return x+=x<0?P:0,_n(x,P)?m[x]:Z}function Jf(m,x,P){x.length?x=No(x,function(ze){return ca(ze)?function(_t){return Vu(_t,ze.length===1?ze[0]:ze)}:ze}):x=[Ic];var G=-1;x=No(x,Fu(Wi()));var pe=yl(m,function(ze,_t,Ot){var or=No(x,function(qr){return qr(ze)});return{criteria:or,index:++G,value:ze}});return rl(pe,function(ze,_t){return Fh(ze,_t,P)})}function zp(m,x){return kh(m,x,function(P,G){return yv(m,G)})}function kh(m,x,P){for(var G=-1,pe=x.length,ze={};++G<pe;){var _t=x[G],Ot=Vu(m,_t);P(Ot,_t)&&Kh(ze,lc(_t,m),Ot)}return ze}function Ep(m){return function(x){return Vu(x,m)}}function Yh(m,x,P,G){var pe=G?Ql:el,ze=-1,_t=x.length,Ot=m;for(m===x&&(x=Us(x)),P&&(Ot=No(m,Fu(P)));++ze<_t;)for(var or=0,qr=x[ze],fn=P?P(qr):qr;(or=pe(Ot,fn,or,G))>-1;)Ot!==m&&fo.call(Ot,or,1),fo.call(m,or,1);return m}function ff(m,x){for(var P=m?x.length:0,G=P-1;P--;){var pe=x[P];if(P==G||pe!==ze){var ze=pe;_n(pe)?fo.call(m,pe,1):Ph(m,pe)}}return m}function eh(m,x){return m+Rf(bu()*(x-m+1))}function Sp(m,x,P,G){for(var pe=-1,ze=Ya(Bc((x-m)/(P||1)),0),_t=Mr(ze);ze--;)_t[G?ze:++pe]=m,m+=P;return _t}function wp(m,x){var P="";if(!m||x<1||x>Xe)return P;do x%2&&(P+=m),x=Rf(x/2),x&&(m+=m);while(x);return P}function ya(m,x){return Pn(In(m,x,Ic),m+"")}function qh(m){return vt(vh(m))}function vd(m,x){var P=vh(m);return Vi(P,gi(x,0,P.length))}function Kh(m,x,P,G){if(!hs(m))return m;x=lc(x,m);for(var pe=-1,ze=x.length,_t=ze-1,Ot=m;Ot!=null&&++pe<ze;){var or=io(x[pe]),qr=P;if(or==="__proto__"||or==="constructor"||or==="prototype")return m;if(pe!=_t){var fn=Ot[or];qr=G?G(fn,or,Ot):Z,qr===Z&&(qr=hs(fn)?fn:_n(x[pe+1])?[]:{})}wr(Ot,or,qr),Ot=Ot[or]}return m}var th=ol?function(m,x){return ol.set(m,x),m}:Ic,Zp=su?function(m,x){return su(m,"toString",{configurable:!0,enumerable:!1,value:Rv(x),writable:!0})}:Ic;function md(m){return Vi(vh(m))}function uc(m,x,P){var G=-1,pe=m.length;x<0&&(x=-x>pe?0:pe+x),P=P>pe?pe:P,P<0&&(P+=pe),pe=x>P?0:P-x>>>0,x>>>=0;for(var ze=Mr(pe);++G<pe;)ze[G]=m[G+x];return ze}function gd(m,x){var P;return yi(m,function(G,pe,ze){return P=x(G,pe,ze),!P}),!!P}function Nf(m,x,P){var G=0,pe=m==null?G:m.length;if(typeof x=="number"&&x===x&&pe<=tn){for(;G<pe;){var ze=G+pe>>>1,_t=m[ze];_t!==null&&!Al(_t)&&(P?_t<=x:_t<x)?G=ze+1:pe=ze}return pe}return Qh(m,x,Ic,P)}function Qh(m,x,P,G){var pe=0,ze=m==null?0:m.length;if(ze===0)return 0;x=P(x);for(var _t=x!==x,Ot=x===null,or=Al(x),qr=x===Z;pe<ze;){var fn=Rf((pe+ze)/2),Tn=P(m[fn]),pi=Tn!==Z,Ji=Tn===null,Ia=Tn===Tn,vo=Al(Tn);if(_t)var Ea=G||Ia;else qr?Ea=Ia&&(G||pi):Ot?Ea=Ia&&pi&&(G||!Ji):or?Ea=Ia&&pi&&!Ji&&(G||!vo):Ji||vo?Ea=!1:Ea=G?Tn<=x:Tn<x;Ea?pe=fn+1:ze=fn}return xs(ze,pr)}function rh(m,x){for(var P=-1,G=m.length,pe=0,ze=[];++P<G;){var _t=m[P],Ot=x?x(_t):_t;if(!P||!Ru(Ot,or)){var or=Ot;ze[pe++]=_t===0?0:_t}}return ze}function Uo(m){return typeof m=="number"?m:Al(m)?yt:+m}function yo(m){if(typeof m=="string")return m;if(ca(m))return No(m,yo)+"";if(Al(m))return bs?bs.call(m):"";var x=m+"";return x=="0"&&1/m==-de?"-0":x}function fs(m,x,P){var G=-1,pe=xu,ze=m.length,_t=!0,Ot=[],or=Ot;if(P)_t=!1,pe=hl;else if(ze>=Pe){var qr=x?null:El(m);if(qr)return Ws(qr);_t=!1,pe=Pl,or=new Y}else or=x?[]:Ot;e:for(;++G<ze;){var fn=m[G],Tn=x?x(fn):fn;if(fn=P||fn!==0?fn:0,_t&&Tn===Tn){for(var pi=or.length;pi--;)if(or[pi]===Tn)continue e;x&&or.push(Tn),Ot.push(fn)}else pe(or,Tn,P)||(or!==Ot&&or.push(Tn),Ot.push(fn))}return Ot}function Ph(m,x){return x=lc(x,m),m=rn(m,x),m==null||delete m[io(Lt(x))]}function Hc(m,x,P,G){return Kh(m,x,P(Vu(m,x)),G)}function wu(m,x,P,G){for(var pe=m.length,ze=G?pe:-1;(G?ze--:++ze<pe)&&x(m[ze],ze,m););return P?uc(m,G?0:ze,G?ze+1:pe):uc(m,G?ze+1:0,G?pe:ze)}function nh(m,x){var P=m;return P instanceof Ba&&(P=P.value()),ef(x,function(G,pe){return pe.func.apply(pe.thisArg,Iu([G],pe.args))},P)}function ih(m,x,P){var G=m.length;if(G<2)return G?fs(m[0]):[];for(var pe=-1,ze=Mr(G);++pe<G;)for(var _t=m[pe],Ot=-1;++Ot<G;)Ot!=pe&&(ze[pe]=Li(ze[pe]||_t,m[Ot],x,P));return fs(ro(ze,1),x,P)}function hf(m,x,P){for(var G=-1,pe=m.length,ze=x.length,_t={};++G<pe;){var Ot=G<ze?x[G]:Z;P(_t,m[G],Ot)}return _t}function Wc(m){return Cs(m)?m:[]}function zf(m){return typeof m=="function"?m:Ic}function lc(m,x){return ca(m)?m:sn(m,x)?[m]:_a(Vo(m))}var Jh=ya;function Wu(m,x,P){var G=m.length;return P=P===Z?G:P,!x&&P>=G?m:uc(m,x,P)}var pf=ic||function(m){return R.clearTimeout(m)};function ep(m,x){if(x)return m.slice();var P=m.length,G=Sn?Sn(P):new m.constructor(P);return m.copy(G),G}function ah(m){var x=new m.constructor(m.byteLength);return new af(x).set(new af(m)),x}function Rh(m,x){var P=x?ah(m.buffer):m.buffer;return new m.constructor(P,m.byteOffset,m.byteLength)}function Lh(m){var x=new m.constructor(m.source,se.exec(m));return x.lastIndex=m.lastIndex,x}function _l(m){return zu?co(zu.call(m)):{}}function Oh(m,x){var P=x?ah(m.buffer):m.buffer;return new m.constructor(P,m.byteOffset,m.length)}function Zf(m,x){if(m!==x){var P=m!==Z,G=m===null,pe=m===m,ze=Al(m),_t=x!==Z,Ot=x===null,or=x===x,qr=Al(x);if(!Ot&&!qr&&!ze&&m>x||ze&&_t&&or&&!Ot&&!qr||G&&_t&&or||!P&&or||!pe)return 1;if(!G&&!ze&&!qr&&m<x||qr&&P&&pe&&!G&&!ze||Ot&&P&&pe||!_t&&pe||!or)return-1}return 0}function Fh(m,x,P){for(var G=-1,pe=m.criteria,ze=x.criteria,_t=pe.length,Ot=P.length;++G<_t;){var or=Zf(pe[G],ze[G]);if(or){if(G>=Ot)return or;var qr=P[G];return or*(qr=="desc"?-1:1)}}return m.index-x.index}function oh(m,x,P,G){for(var pe=-1,ze=m.length,_t=P.length,Ot=-1,or=x.length,qr=Ya(ze-_t,0),fn=Mr(or+qr),Tn=!G;++Ot<or;)fn[Ot]=x[Ot];for(;++pe<_t;)(Tn||pe<ze)&&(fn[P[pe]]=m[pe]);for(;qr--;)fn[Ot++]=m[pe++];return fn}function tp(m,x,P,G){for(var pe=-1,ze=m.length,_t=-1,Ot=P.length,or=-1,qr=x.length,fn=Ya(ze-Ot,0),Tn=Mr(fn+qr),pi=!G;++pe<fn;)Tn[pe]=m[pe];for(var Ji=pe;++or<qr;)Tn[Ji+or]=x[or];for(;++_t<Ot;)(pi||pe<ze)&&(Tn[Ji+P[_t]]=m[pe++]);return Tn}function Us(m,x){var P=-1,G=m.length;for(x||(x=Mr(G));++P<G;)x[P]=m[P];return x}function cl(m,x,P,G){var pe=!P;P||(P={});for(var ze=-1,_t=x.length;++ze<_t;){var Ot=x[ze],or=G?G(P[Ot],m[Ot],Ot,P,m):Z;or===Z&&(or=m[Ot]),pe?ei(P,Ot,or):wr(P,Ot,or)}return P}function yd(m,x){return cl(m,Le(m),x)}function Ap(m,x){return cl(m,rt(m),x)}function rp(m,x){return function(P,G){var pe=ca(P)?ka:yn,ze=x?x():{};return pe(P,m,Wi(G,2),ze)}}function Dh(m){return ya(function(x,P){var G=-1,pe=P.length,ze=pe>1?P[pe-1]:Z,_t=pe>2?P[2]:Z;for(ze=m.length>3&&typeof ze=="function"?(pe--,ze):Z,_t&&Ur(P[0],P[1],_t)&&(ze=pe<3?Z:ze,pe=1),x=co(x);++G<pe;){var Ot=P[G];Ot&&m(x,Ot,G,ze)}return x})}function df(m,x){return function(P,G){if(P==null)return P;if(!Qu(P))return m(P,G);for(var pe=P.length,ze=x?pe:-1,_t=co(P);(x?ze--:++ze<pe)&&G(_t[ze],ze,_t)!==!1;);return P}}function Dl(m){return function(x,P,G){for(var pe=-1,ze=co(x),_t=G(x),Ot=_t.length;Ot--;){var or=_t[m?Ot:++pe];if(P(ze[or],or,ze)===!1)break}return x}}function Up(m,x,P){var G=x&hr,pe=xl(m);function ze(){var _t=this&&this!==R&&this instanceof ze?pe:m;return _t.apply(G?P:this,arguments)}return ze}function np(m){return function(x){x=Vo(x);var P=yc(x)?nl(x):Z,G=P?P[0]:x.charAt(0),pe=P?Wu(P,1).join(""):x.slice(1);return G[m]()+pe}}function Cc(m){return function(x){return ef(um(Yd(x).replace(qs,"")),m,"")}}function xl(m){return function(){var x=arguments;switch(x.length){case 0:return new m;case 1:return new m(x[0]);case 2:return new m(x[0],x[1]);case 3:return new m(x[0],x[1],x[2]);case 4:return new m(x[0],x[1],x[2],x[3]);case 5:return new m(x[0],x[1],x[2],x[3],x[4]);case 6:return new m(x[0],x[1],x[2],x[3],x[4],x[5]);case 7:return new m(x[0],x[1],x[2],x[3],x[4],x[5],x[6])}var P=Qs(m.prototype),G=m.apply(P,x);return hs(G)?G:P}}function zd(m,x,P){var G=xl(m);function pe(){for(var ze=arguments.length,_t=Mr(ze),Ot=ze,or=Vf(pe);Ot--;)_t[Ot]=arguments[Ot];var qr=ze<3&&_t[0]!==or&&_t[ze-1]!==or?[]:pl(_t,or);if(ze-=qr.length,ze<P)return mf(m,x,vf,pe.placeholder,Z,_t,qr,Z,Z,P-ze);var fn=this&&this!==R&&this instanceof pe?G:m;return vi(fn,this,_t)}return pe}function _d(m){return function(x,P,G){var pe=co(x);if(!Qu(x)){var ze=Wi(P,3);x=du(x),P=function(Ot){return ze(pe[Ot],Ot,pe)}}var _t=m(x,P,G);return _t>-1?pe[ze?x[_t]:_t]:Z}}function bl(m){return Hl(function(x){var P=x.length,G=P,pe=Js.prototype.thru;for(m&&x.reverse();G--;){var ze=x[G];if(typeof ze!="function")throw new ou(xe);if(pe&&!_t&&ho(ze)=="wrapper")var _t=new Js([],!0)}for(G=_t?G:P;++G<P;){ze=x[G];var Ot=ho(ze),or=Ot=="wrapper"?Uf(ze):Z;or&&xr(or[0])&&or[1]==(It|Pt|ne|xt)&&!or[4].length&&or[9]==1?_t=_t[ho(or[0])].apply(_t,or[3]):_t=ze.length==1&&xr(ze)?_t[Ot]():_t.thru(ze)}return function(){var qr=arguments,fn=qr[0];if(_t&&qr.length==1&&ca(fn))return _t.plant(fn).value();for(var Tn=0,pi=P?x[Tn].apply(this,qr):fn;++Tn<P;)pi=x[Tn].call(this,pi);return pi}})}function vf(m,x,P,G,pe,ze,_t,Ot,or,qr){var fn=x&It,Tn=x&hr,pi=x&qt,Ji=x&(Pt|Cr),Ia=x&Jt,vo=pi?Z:xl(m);function Ea(){for(var Ao=arguments.length,xo=Mr(Ao),Cf=Ao;Cf--;)xo[Cf]=arguments[Cf];if(Ji)var kc=Vf(Ea),Tf=Oc(xo,kc);if(G&&(xo=oh(xo,G,pe,Ji)),ze&&(xo=tp(xo,ze,_t,Ji)),Ao-=Tf,Ji&&Ao<qr){var Lu=pl(xo,kc);return mf(m,x,vf,Ea.placeholder,P,xo,Lu,Ot,or,qr-Ao)}var mh=Tn?P:this,dp=pi?mh[m]:m;return Ao=xo.length,Ot?xo=On(xo,Ot):Ia&&Ao>1&&xo.reverse(),fn&&or<Ao&&(xo.length=or),this&&this!==R&&this instanceof Ea&&(dp=vo||xl(dp)),dp.apply(mh,xo)}return Ea}function cc(m,x){return function(P,G){return Ff(P,m,x(G),{})}}function Xu(m,x){return function(P,G){var pe;if(P===Z&&G===Z)return x;if(P!==Z&&(pe=P),G!==Z){if(pe===Z)return G;typeof P=="string"||typeof G=="string"?(P=yo(P),G=yo(G)):(P=Uo(P),G=Uo(G)),pe=m(P,G)}return pe}}function Vp(m){return Hl(function(x){return x=No(x,Fu(Wi())),ya(function(P){var G=this;return m(x,function(pe){return vi(pe,G,P)})})})}function ip(m,x){x=x===Z?" ":yo(x);var P=x.length;if(P<2)return P?wp(x,m):x;var G=wp(x,Bc(m/xc(x)));return yc(x)?Wu(nl(G),0,m).join(""):G.slice(0,m)}function Gp(m,x,P,G){var pe=x&hr,ze=xl(m);function _t(){for(var Ot=-1,or=arguments.length,qr=-1,fn=G.length,Tn=Mr(fn+or),pi=this&&this!==R&&this instanceof _t?ze:m;++qr<fn;)Tn[qr]=G[qr];for(;or--;)Tn[qr++]=arguments[++Ot];return vi(pi,pe?P:this,Tn)}return _t}function jp(m){return function(x,P,G){return G&&typeof G!="number"&&Ur(x,P,G)&&(P=G=Z),x=hc(x),P===Z?(P=x,x=0):P=hc(P),G=G===Z?x<P?1:-1:hc(G),Sp(x,P,G,m)}}function no(m){return function(x,P){return typeof x=="string"&&typeof P=="string"||(x=Kc(x),P=Kc(P)),m(x,P)}}function mf(m,x,P,G,pe,ze,_t,Ot,or,qr){var fn=x&Pt,Tn=fn?_t:Z,pi=fn?Z:_t,Ji=fn?ze:Z,Ia=fn?Z:ze;x|=fn?ne:gr,x&=~(fn?gr:ne),x&Dt||(x&=~(hr|qt));var vo=[m,x,pe,Ji,Tn,Ia,pi,Ot,or,qr],Ea=P.apply(Z,vo);return xr(m)&&aa(Ea,vo),Ea.placeholder=G,zn(Ea,m,x)}function Ss(m){var x=Xa[m];return function(P,G){if(P=Kc(P),G=G==null?0:xs(Fi(G),292),G&&ga(P)){var pe=(Vo(P)+"e").split("e"),ze=x(pe[0]+"e"+(+pe[1]+G));return pe=(Vo(ze)+"e").split("e"),+(pe[0]+"e"+(+pe[1]-G))}return x(P)}}var El=ks&&1/Ws(new ks([,-0]))[1]==de?function(m){return new ks(m)}:Fv;function ap(m){return function(x){var P=Kt(x);return P==Yn?Zs(x):P==ce?yp(x):dd(x,m(x))}}function Xc(m,x,P,G,pe,ze,_t,Ot){var or=x&qt;if(!or&&typeof m!="function")throw new ou(xe);var qr=G?G.length:0;if(qr||(x&=~(ne|gr),G=pe=Z),_t=_t===Z?_t:Ya(Fi(_t),0),Ot=Ot===Z?Ot:Fi(Ot),qr-=pe?pe.length:0,x&gr){var fn=G,Tn=pe;G=pe=Z}var pi=or?Z:Uf(m),Ji=[m,x,P,G,pe,fn,Tn,ze,_t,Ot];if(pi&&kr(Ji,pi),m=Ji[0],x=Ji[1],P=Ji[2],G=Ji[3],pe=Ji[4],Ot=Ji[9]=Ji[9]===Z?or?0:m.length:Ya(Ji[9]-qr,0),!Ot&&x&(Pt|Cr)&&(x&=~(Pt|Cr)),!x||x==hr)var Ia=Up(m,x,P);else x==Pt||x==Cr?Ia=zd(m,x,Ot):(x==ne||x==(hr|ne))&&!pe.length?Ia=Gp(m,x,P,G):Ia=vf.apply(Z,Ji);var vo=pi?th:aa;return zn(vo(Ia,Ji),m,x)}function xd(m,x,P,G){return m===Z||Ru(m,bc[P])&&!go.call(G,P)?x:m}function Hp(m,x,P,G,pe,ze){return hs(m)&&hs(x)&&(ze.set(x,m),Su(m,x,Z,Hp,ze),ze.delete(x)),m}function Zd(m){return xf(m)?Z:m}function Bh(m,x,P,G,pe,ze){var _t=P&mr,Ot=m.length,or=x.length;if(Ot!=or&&!(_t&&or>Ot))return!1;var qr=ze.get(m),fn=ze.get(x);if(qr&&fn)return qr==x&&fn==m;var Tn=-1,pi=!0,Ji=P&jt?new Y:Z;for(ze.set(m,x),ze.set(x,m);++Tn<Ot;){var Ia=m[Tn],vo=x[Tn];if(G)var Ea=_t?G(vo,Ia,Tn,x,m,ze):G(Ia,vo,Tn,m,x,ze);if(Ea!==Z){if(Ea)continue;pi=!1;break}if(Ji){if(!kl(x,function(Ao,xo){if(!Pl(Ji,xo)&&(Ia===Ao||pe(Ia,Ao,P,G,ze)))return Ji.push(xo)})){pi=!1;break}}else if(!(Ia===vo||pe(Ia,vo,P,G,ze))){pi=!1;break}}return ze.delete(m),ze.delete(x),pi}function bd(m,x,P,G,pe,ze,_t){switch(P){case Bt:if(m.byteLength!=x.byteLength||m.byteOffset!=x.byteOffset)return!1;m=m.buffer,x=x.buffer;case nt:return!(m.byteLength!=x.byteLength||!ze(new af(m),new af(x)));case Ra:case Di:case bi:return Ru(+m,+x);case ua:return m.name==x.name&&m.message==x.message;case be:case Me:return m==x+"";case Yn:var Ot=Zs;case ce:var or=G&mr;if(Ot||(Ot=Ws),m.size!=x.size&&!or)return!1;var qr=_t.get(m);if(qr)return qr==x;G|=jt,_t.set(m,x);var fn=Bh(Ot(m),Ot(x),G,pe,ze,_t);return _t.delete(m),fn;case j:if(zu)return zu.call(m)==zu.call(x)}return!1}function Wp(m,x,P,G,pe,ze){var _t=P&mr,Ot=op(m),or=Ot.length,qr=op(x),fn=qr.length;if(or!=fn&&!_t)return!1;for(var Tn=or;Tn--;){var pi=Ot[Tn];if(!(_t?pi in x:go.call(x,pi)))return!1}var Ji=ze.get(m),Ia=ze.get(x);if(Ji&&Ia)return Ji==x&&Ia==m;var vo=!0;ze.set(m,x),ze.set(x,m);for(var Ea=_t;++Tn<or;){pi=Ot[Tn];var Ao=m[pi],xo=x[pi];if(G)var Cf=_t?G(xo,Ao,pi,x,m,ze):G(Ao,xo,pi,m,x,ze);if(!(Cf===Z?Ao===xo||pe(Ao,xo,P,G,ze):Cf)){vo=!1;break}Ea||(Ea=pi=="constructor")}if(vo&&!Ea){var kc=m.constructor,Tf=x.constructor;kc!=Tf&&"constructor"in m&&"constructor"in x&&!(typeof kc=="function"&&kc instanceof kc&&typeof Tf=="function"&&Tf instanceof Tf)&&(vo=!1)}return ze.delete(m),ze.delete(x),vo}function Hl(m){return Pn(In(m,Z,Ga),m+"")}function op(m){return lu(m,du,Le)}function sh(m){return lu(m,fl,rt)}var Uf=ol?function(m){return ol.get(m)}:Fv;function ho(m){for(var x=m.name+"",P=Vl[x],G=go.call(Vl,x)?P.length:0;G--;){var pe=P[G],ze=pe.func;if(ze==null||ze==m)return pe.name}return x}function Vf(m){var x=go.call(Ie,"placeholder")?Ie:m;return x.placeholder}function Wi(){var m=Ie.iteratee||Lv;return m=m===Lv?Df:m,arguments.length?m(arguments[0],arguments[1]):m}function Wl(m,x){var P=m.__data__;return zt(x)?P[typeof x=="string"?"string":"hash"]:P.map}function Nh(m){for(var x=du(m),P=x.length;P--;){var G=x[P],pe=m[G];x[P]=[G,pe,pn(pe)]}return x}function uh(m,x){var P=Ah(m,x);return ll(P)?P:Z}function X(m){var x=go.call(m,Nu),P=m[Nu];try{m[Nu]=Z;var G=!0}catch(ze){}var pe=Gn.call(m);return G&&(x?m[Nu]=P:delete m[Nu]),pe}var Le=al?function(m){return m==null?[]:(m=co(m),Ho(al(m),function(x){return Ec.call(m,x)}))}:Dv,rt=al?function(m){for(var x=[];m;)Iu(x,Le(m)),m=of(m);return x}:Dv,Kt=qo;(mi&&Kt(new mi(new ArrayBuffer(1)))!=Bt||ai&&Kt(new ai)!=Yn||uf&&Kt(uf.resolve())!=eo||ks&&Kt(new ks)!=ce||ku&&Kt(new ku)!=ir)&&(Kt=function(m){var x=qo(m),P=x==Ha?m.constructor:Z,G=P?Ro(P):"";if(G)switch(G){case Kf:return Bt;case qa:return Yn;case zo:return eo;case bp:return ce;case zc:return ir}return x});function Pr(m,x,P){for(var G=-1,pe=P.length;++G<pe;){var ze=P[G],_t=ze.size;switch(ze.type){case"drop":m+=_t;break;case"dropRight":x-=_t;break;case"take":x=xs(x,m+_t);break;case"takeRight":m=Ya(m,x-_t);break}}return{start:m,end:x}}function lr(m){var x=m.match(jr);return x?x[1].split(qn):[]}function Ir(m,x,P){x=lc(x,m);for(var G=-1,pe=x.length,ze=!1;++G<pe;){var _t=io(x[G]);if(!(ze=m!=null&&P(m,_t)))break;m=m[_t]}return ze||++G!=pe?ze:(pe=m==null?0:m.length,!!pe&&_f(pe)&&_n(_t,pe)&&(ca(m)||Wo(m)))}function Hr(m){var x=m.length,P=new m.constructor(x);return x&&typeof m[0]=="string"&&go.call(m,"index")&&(P.index=m.index,P.input=m.input),P}function Qr(m){return typeof m.constructor=="function"&&!Dr(m)?Qs(of(m)):{}}function an(m,x,P){var G=m.constructor;switch(x){case nt:return ah(m);case Ra:case Di:return new G(+m);case Bt:return Rh(m,P);case Ar:case zr:case un:case vn:case ui:case Jn:case mn:case Ri:case Si:return Oh(m,P);case Yn:return new G;case bi:case Me:return new G(m);case be:return Lh(m);case ce:return new G;case j:return _l(m)}}function cn(m,x){var P=x.length;if(!P)return m;var G=P-1;return x[G]=(P>1?"& ":"")+x[G],x=x.join(P>2?", ":" "),m.replace(dr,`{
/* [wrapped with `+x+`] */
`)}function hn(m){return ca(m)||Wo(m)||!!(Bu&&m&&m[Bu])}function _n(m,x){var P=typeof m;return x=x==null?Xe:x,!!x&&(P=="number"||P!="symbol"&&ra.test(m))&&m>-1&&m%1==0&&m<x}function Ur(m,x,P){if(!hs(P))return!1;var G=typeof x;return(G=="number"?Qu(P)&&_n(x,P.length):G=="string"&&x in P)?Ru(P[x],m):!1}function sn(m,x){if(ca(m))return!1;var P=typeof m;return P=="number"||P=="symbol"||P=="boolean"||m==null||Al(m)?!0:At.test(m)||!ht.test(m)||x!=null&&m in co(x)}function zt(m){var x=typeof m;return x=="string"||x=="number"||x=="symbol"||x=="boolean"?m!=="__proto__":m===null}function xr(m){var x=ho(m),P=Ie[x];if(typeof P!="function"||!(x in Ba.prototype))return!1;if(m===P)return!0;var G=Uf(P);return!!G&&m===G[0]}function nn(m){return!!_s&&_s in m}var wn=il?Tc:Bv;function Dr(m){var x=m&&m.constructor,P=typeof x=="function"&&x.prototype||bc;return m===P}function pn(m){return m===m&&!hs(m)}function Mn(m,x){return function(P){return P==null?!1:P[m]===x&&(x!==Z||m in co(P))}}function Ei(m){var x=as(m,function(G){return P.size===Ae&&P.clear(),G}),P=x.cache;return x}function kr(m,x){var P=m[1],G=x[1],pe=P|G,ze=pe<(hr|qt|It),_t=G==It&&P==Pt||G==It&&P==xt&&m[7].length<=x[8]||G==(It|xt)&&x[7].length<=x[8]&&P==Pt;if(!(ze||_t))return m;G&hr&&(m[2]=x[2],pe|=P&hr?0:Dt);var Ot=x[3];if(Ot){var or=m[3];m[3]=or?oh(or,Ot,x[4]):Ot,m[4]=or?pl(m[3],at):x[4]}return Ot=x[5],Ot&&(or=m[5],m[5]=or?tp(or,Ot,x[6]):Ot,m[6]=or?pl(m[5],at):x[6]),Ot=x[7],Ot&&(m[7]=Ot),G&It&&(m[8]=m[8]==null?x[8]:xs(m[8],x[8])),m[9]==null&&(m[9]=x[9]),m[0]=x[0],m[1]=pe,m}function Lr(m){var x=[];if(m!=null)for(var P in co(m))x.push(P);return x}function Kn(m){return Gn.call(m)}function In(m,x,P){return x=Ya(x===Z?m.length-1:x,0),function(){for(var G=arguments,pe=-1,ze=Ya(G.length-x,0),_t=Mr(ze);++pe<ze;)_t[pe]=G[x+pe];pe=-1;for(var Ot=Mr(x+1);++pe<x;)Ot[pe]=G[pe];return Ot[x]=P(_t),vi(m,this,Ot)}}function rn(m,x){return x.length<2?m:Vu(m,uc(x,0,-1))}function On(m,x){for(var P=m.length,G=xs(x.length,P),pe=Us(m);G--;){var ze=x[G];m[G]=_n(ze,P)?pe[ze]:Z}return m}function Rn(m,x){if(!(x==="constructor"&&typeof m[x]=="function")&&x!="__proto__")return m[x]}var aa=ki(th),zi=sf||function(m,x){return R.setTimeout(m,x)},Pn=ki(Zp);function zn(m,x,P){var G=x+"";return Pn(m,cn(G,qi(lr(G),P)))}function ki(m){var x=0,P=0;return function(){var G=Nc(),pe=oe-(G-P);if(P=G,pe>0){if(++x>=$r)return arguments[0]}else x=0;return m.apply(Z,arguments)}}function Vi(m,x){var P=-1,G=m.length,pe=G-1;for(x=x===Z?G:x;++P<x;){var ze=eh(P,pe),_t=m[ze];m[ze]=m[P],m[P]=_t}return m.length=x,m}var _a=Ei(function(m){var x=[];return m.charCodeAt(0)===46&&x.push(""),m.replace(Te,function(P,G,pe,ze){x.push(pe?ze.replace(ot,"$1"):G||P)}),x});function io(m){if(typeof m=="string"||Al(m))return m;var x=m+"";return x=="0"&&1/m==-de?"-0":x}function Ro(m){if(m!=null){try{return ys.call(m)}catch(x){}try{return m+""}catch(x){}}return""}function qi(m,x){return ha(Kr,function(P){var G="_."+P[0];x&P[1]&&!xu(m,G)&&m.push(G)}),m.sort()}function Gr(m){if(m instanceof Ba)return m.clone();var x=new Js(m.__wrapped__,m.__chain__);return x.__actions__=Us(m.__actions__),x.__index__=m.__index__,x.__values__=m.__values__,x}function Lo(m,x,P){(P?Ur(m,x,P):x===Z)?x=1:x=Ya(Fi(x),0);var G=m==null?0:m.length;if(!G||x<1)return[];for(var pe=0,ze=0,_t=Mr(Bc(G/x));pe<G;)_t[ze++]=uc(m,pe,pe+=x);return _t}function cu(m){for(var x=-1,P=m==null?0:m.length,G=0,pe=[];++x<P;){var ze=m[x];ze&&(pe[G++]=ze)}return pe}function Fa(){var m=arguments.length;if(!m)return[];for(var x=Mr(m-1),P=arguments[0],G=m;G--;)x[G-1]=arguments[G];return Iu(ca(P)?Us(P):[P],ro(x,1))}var Ko=ya(function(m,x){return Cs(m)?Li(m,ro(x,1,Cs,!0)):[]}),is=ya(function(m,x){var P=Lt(x);return Cs(P)&&(P=Z),Cs(m)?Li(m,ro(x,1,Cs,!0),Wi(P,2)):[]}),eu=ya(function(m,x){var P=Lt(x);return Cs(P)&&(P=Z),Cs(m)?Li(m,ro(x,1,Cs,!0),Z,P):[]});function Mo(m,x,P){var G=m==null?0:m.length;return G?(x=P||x===Z?1:Fi(x),uc(m,x<0?0:x,G)):[]}function $i(m,x,P){var G=m==null?0:m.length;return G?(x=P||x===Z?1:Fi(x),x=G-x,uc(m,0,x<0?0:x)):[]}function Ls(m,x){return m&&m.length?wu(m,Wi(x,3),!0,!0):[]}function Ka(m,x){return m&&m.length?wu(m,Wi(x,3),!0):[]}function fu(m,x,P,G){var pe=m==null?0:m.length;return pe?(P&&typeof P!="number"&&Ur(m,x,P)&&(P=0,G=pe),cs(m,x,P,G)):[]}function Oi(m,x,P){var G=m==null?0:m.length;if(!G)return-1;var pe=P==null?0:Fi(P);return pe<0&&(pe=Ya(G+pe,0)),us(m,Wi(x,3),pe)}function va(m,x,P){var G=m==null?0:m.length;if(!G)return-1;var pe=G-1;return P!==Z&&(pe=Fi(P),pe=P<0?Ya(G+pe,0):xs(pe,G-1)),us(m,Wi(x,3),pe,!0)}function Ga(m){var x=m==null?0:m.length;return x?ro(m,1):[]}function ws(m){var x=m==null?0:m.length;return x?ro(m,de):[]}function gf(m,x){var P=m==null?0:m.length;return P?(x=x===Z?1:Fi(x),ro(m,x)):[]}function We(m){for(var x=-1,P=m==null?0:m.length,G={};++x<P;){var pe=m[x];G[pe[0]]=pe[1]}return G}function vr(m){return m&&m.length?m[0]:Z}function rr(m,x,P){var G=m==null?0:m.length;if(!G)return-1;var pe=P==null?0:Fi(P);return pe<0&&(pe=Ya(G+pe,0)),el(m,x,pe)}function Xn(m){var x=m==null?0:m.length;return x?uc(m,0,-1):[]}var Aa=ya(function(m){var x=No(m,Wc);return x.length&&x[0]===m[0]?Gc(x):[]}),Ze=ya(function(m){var x=Lt(m),P=No(m,Wc);return x===Lt(P)?x=Z:P.pop(),P.length&&P[0]===m[0]?Gc(P,Wi(x,2)):[]}),Se=ya(function(m){var x=Lt(m),P=No(m,Wc);return x=typeof x=="function"?x:Z,x&&P.pop(),P.length&&P[0]===m[0]?Gc(P,Z,x):[]});function pt(m,x){return m==null?"":ac.call(m,x)}function Lt(m){var x=m==null?0:m.length;return x?m[x-1]:Z}function sr(m,x,P){var G=m==null?0:m.length;if(!G)return-1;var pe=G;return P!==Z&&(pe=Fi(P),pe=pe<0?Ya(G+pe,0):xs(pe,G-1)),x===x?Fc(m,x,pe):us(m,tl,pe,!0)}function Et(m,x){return m&&m.length?cf(m,Fi(x)):Z}var et=ya(Tt);function Tt(m,x){return m&&m.length&&x&&x.length?Yh(m,x):m}function Fe(m,x,P){return m&&m.length&&x&&x.length?Yh(m,x,Wi(P,2)):m}function ct(m,x,P){return m&&m.length&&x&&x.length?Yh(m,x,Z,P):m}var Ve=Hl(function(m,x){var P=m==null?0:m.length,G=_i(m,x);return ff(m,No(x,function(pe){return _n(pe,P)?+pe:pe}).sort(Zf)),G});function Zt(m,x){var P=[];if(!(m&&m.length))return P;var G=-1,pe=[],ze=m.length;for(x=Wi(x,3);++G<ze;){var _t=m[G];x(_t,G,m)&&(P.push(_t),pe.push(G))}return ff(m,pe),P}function Qt(m){return m==null?m:wa.call(m)}function Vr(m,x,P){var G=m==null?0:m.length;return G?(P&&typeof P!="number"&&Ur(m,x,P)?(x=0,P=G):(x=x==null?0:Fi(x),P=P===Z?G:Fi(P)),uc(m,x,P)):[]}function En(m,x){return Nf(m,x)}function An(m,x,P){return Qh(m,x,Wi(P,2))}function Dn(m,x){var P=m==null?0:m.length;if(P){var G=Nf(m,x);if(G<P&&Ru(m[G],x))return G}return-1}function bn(m,x){return Nf(m,x,!0)}function oi(m,x,P){return Qh(m,x,Wi(P,2),!0)}function Zn(m,x){var P=m==null?0:m.length;if(P){var G=Nf(m,x,!0)-1;if(Ru(m[G],x))return G}return-1}function ti(m){return m&&m.length?rh(m):[]}function Qn(m,x){return m&&m.length?rh(m,Wi(x,2)):[]}function $n(m){var x=m==null?0:m.length;return x?uc(m,1,x):[]}function Zi(m,x,P){return m&&m.length?(x=P||x===Z?1:Fi(x),uc(m,0,x<0?0:x)):[]}function Qa(m,x,P){var G=m==null?0:m.length;return G?(x=P||x===Z?1:Fi(x),x=G-x,uc(m,x<0?0:x,G)):[]}function tu(m,x){return m&&m.length?wu(m,Wi(x,3),!1,!0):[]}function Do(m,x){return m&&m.length?wu(m,Wi(x,3)):[]}var Ja=ya(function(m){return fs(ro(m,1,Cs,!0))}),$c=ya(function(m){var x=Lt(m);return Cs(x)&&(x=Z),fs(ro(m,1,Cs,!0),Wi(x,2))}),$u=ya(function(m){var x=Lt(m);return x=typeof x=="function"?x:Z,fs(ro(m,1,Cs,!0),Z,x)});function Xl(m){return m&&m.length?fs(m):[]}function Sl(m,x){return m&&m.length?fs(m,Wi(x,2)):[]}function sp(m,x){return x=typeof x=="function"?x:Z,m&&m.length?fs(m,Z,x):[]}function wl(m){if(!(m&&m.length))return[];var x=0;return m=Ho(m,function(P){if(Cs(P))return x=Ya(P.length,x),!0}),wh(x,function(P){return No(m,Jl(P))})}function yf(m,x){if(!(m&&m.length))return[];var P=wl(m);return x==null?P:No(P,function(G){return vi(x,Z,G)})}var lh=ya(function(m,x){return Cs(m)?Li(m,x):[]}),Ed=ya(function(m){return ih(Ho(m,Cs))}),ru=ya(function(m){var x=Lt(m);return Cs(x)&&(x=Z),ih(Ho(m,Cs),Wi(x,2))}),Xp=ya(function(m){var x=Lt(m);return x=typeof x=="function"?x:Z,ih(Ho(m,Cs),Z,x)}),zh=ya(wl);function $p(m,x){return hf(m||[],x||[],wr)}function Sd(m,x){return hf(m||[],x||[],Kh)}var hv=ya(function(m){var x=m.length,P=x>1?m[x-1]:Z;return P=typeof P=="function"?(m.pop(),P):Z,yf(m,P)});function kn(m){var x=Ie(m);return x.__chain__=!0,x}function ch(m,x){return x(m),m}function fr(m,x){return x(m)}var pv=Hl(function(m){var x=m.length,P=x?m[0]:0,G=this.__wrapped__,pe=function(ze){return _i(ze,m)};return x>1||this.__actions__.length||!(G instanceof Ba)||!_n(P)?this.thru(pe):(G=G.slice(P,+P+(x?1:0)),G.__actions__.push({func:fr,args:[pe],thisArg:Z}),new Js(G,this.__chain__).thru(function(ze){return x&&!ze.length&&ze.push(Z),ze}))});function n0(){return kn(this)}function hu(){return new Js(this.value(),this.__chain__)}function Zh(){this.__values__===Z&&(this.__values__=vv(this.value()));var m=this.__index__>=this.__values__.length,x=m?Z:this.__values__[this.__index__++];return{done:m,value:x}}function Ud(){return this}function a(m){for(var x,P=this;P instanceof Sc;){var G=Gr(P);G.__index__=0,G.__values__=Z,x?pe.__wrapped__=G:x=G;var pe=G;P=P.__wrapped__}return pe.__wrapped__=m,x}function s(){var m=this.__wrapped__;if(m instanceof Ba){var x=m;return this.__actions__.length&&(x=new Ba(this)),x=x.reverse(),x.__actions__.push({func:fr,args:[Qt],thisArg:Z}),new Js(x,this.__chain__)}return this.thru(Qt)}function c(){return nh(this.__wrapped__,this.__actions__)}var g=rp(function(m,x,P){go.call(m,P)?++m[P]:ei(m,P,1)});function b(m,x,P){var G=ca(m)?Sa:Ii;return P&&Ur(m,x,P)&&(x=Z),G(m,Wi(x,3))}function A(m,x){var P=ca(m)?Ho:Po;return P(m,Wi(x,3))}var T=_d(Oi),O=_d(va);function z(m,x){return ro(st(m,x),1)}function $(m,x){return ro(st(m,x),de)}function Q(m,x,P){return P=P===Z?1:Fi(P),ro(st(m,x),P)}function re(m,x){var P=ca(m)?ha:yi;return P(m,Wi(x,3))}function me(m,x){var P=ca(m)?So:ia;return P(m,Wi(x,3))}var Ee=rp(function(m,x,P){go.call(m,P)?m[P].push(x):ei(m,P,[x])});function $e(m,x,P,G){m=Qu(m)?m:vh(m),P=P&&!G?Fi(P):0;var pe=m.length;return P<0&&(P=Ya(pe+P,0)),bf(m)?P<=pe&&m.indexOf(x,P)>-1:!!pe&&el(m,x,P)>-1}var qe=ya(function(m,x,P){var G=-1,pe=typeof x=="function",ze=Qu(m)?Mr(m.length):[];return yi(m,function(_t){ze[++G]=pe?vi(x,_t,P):ju(_t,x,P)}),ze}),bt=rp(function(m,x,P){ei(m,P,x)});function st(m,x){var P=ca(m)?No:yl;return P(m,Wi(x,3))}function Nt(m,x,P,G){return m==null?[]:(ca(x)||(x=x==null?[]:[x]),P=G?Z:P,ca(P)||(P=P==null?[]:[P]),Jf(m,x,P))}var er=rp(function(m,x,P){m[P?0:1].push(x)},function(){return[[],[]]});function _r(m,x,P){var G=ca(m)?ef:vc,pe=arguments.length<3;return G(m,Wi(x,4),P,pe,yi)}function Er(m,x,P){var G=ca(m)?ql:vc,pe=arguments.length<3;return G(m,Wi(x,4),P,pe,ia)}function Br(m,x){var P=ca(m)?Ho:Po;return P(m,Fs(Wi(x,3)))}function dn(m){var x=ca(m)?vt:qh;return x(m)}function Ln(m,x,P){(P?Ur(m,x,P):x===Z)?x=1:x=Fi(x);var G=ca(m)?$t:vd;return G(m,x)}function xi(m){var x=ca(m)?Sr:md;return x(m)}function jn(m){if(m==null)return 0;if(Qu(m))return bf(m)?xc(m):m.length;var x=Kt(m);return x==Yn||x==ce?m.size:Bf(m).length}function Ai(m,x,P){var G=ca(m)?kl:gd;return P&&Ur(m,x,P)&&(x=Z),G(m,Wi(x,3))}var Wn=ya(function(m,x){if(m==null)return[];var P=x.length;return P>1&&Ur(m,x[0],x[1])?x=[]:P>2&&Ur(x[0],x[1],x[2])&&(x=[x[0]]),Jf(m,ro(x,1),[])}),la=xp||function(){return R.Date.now()};function ji(m,x){if(typeof x!="function")throw new ou(xe);return m=Fi(m),function(){if(--m<1)return x.apply(this,arguments)}}function hi(m,x,P){return x=P?Z:x,x=m&&x==null?m.length:x,Xc(m,It,Z,Z,Z,Z,x)}function Ca(m,x){var P;if(typeof x!="function")throw new ou(xe);return m=Fi(m),function(){return--m>0&&(P=x.apply(this,arguments)),m<=1&&(x=Z),P}}var oa=ya(function(m,x,P){var G=hr;if(P.length){var pe=pl(P,Vf(oa));G|=ne}return Xc(m,G,x,P,pe)}),Pa=ya(function(m,x,P){var G=hr|qt;if(P.length){var pe=pl(P,Vf(Pa));G|=ne}return Xc(x,G,m,P,pe)});function Ci(m,x,P){x=P?Z:x;var G=Xc(m,Pt,Z,Z,Z,Z,Z,x);return G.placeholder=Ci.placeholder,G}function Mi(m,x,P){x=P?Z:x;var G=Xc(m,Cr,Z,Z,Z,Z,Z,x);return G.placeholder=Mi.placeholder,G}function _o(m,x,P){var G,pe,ze,_t,Ot,or,qr=0,fn=!1,Tn=!1,pi=!0;if(typeof m!="function")throw new ou(xe);x=Kc(x)||0,hs(P)&&(fn=!!P.leading,Tn="maxWait"in P,ze=Tn?Ya(Kc(P.maxWait)||0,x):ze,pi="trailing"in P?!!P.trailing:pi);function Ji(Lu){var mh=G,dp=pe;return G=pe=Z,qr=Lu,_t=m.apply(dp,mh),_t}function Ia(Lu){return qr=Lu,Ot=zi(Ao,x),fn?Ji(Lu):_t}function vo(Lu){var mh=Lu-or,dp=Lu-qr,Tm=x-mh;return Tn?xs(Tm,ze-dp):Tm}function Ea(Lu){var mh=Lu-or,dp=Lu-qr;return or===Z||mh>=x||mh<0||Tn&&dp>=ze}function Ao(){var Lu=la();if(Ea(Lu))return xo(Lu);Ot=zi(Ao,vo(Lu))}function xo(Lu){return Ot=Z,pi&&G?Ji(Lu):(G=pe=Z,_t)}function Cf(){Ot!==Z&&pf(Ot),qr=0,G=or=pe=Ot=Z}function kc(){return Ot===Z?_t:xo(la())}function Tf(){var Lu=la(),mh=Ea(Lu);if(G=arguments,pe=this,or=Lu,mh){if(Ot===Z)return Ia(or);if(Tn)return pf(Ot),Ot=zi(Ao,x),Ji(or)}return Ot===Z&&(Ot=zi(Ao,x)),_t}return Tf.cancel=Cf,Tf.flush=kc,Tf}var Os=ya(function(m,x){return Qi(m,1,x)}),As=ya(function(m,x,P){return Qi(m,Kc(x)||0,P)});function Qo(m){return Xc(m,Jt)}function as(m,x){if(typeof m!="function"||x!=null&&typeof x!="function")throw new ou(xe);var P=function(){var G=arguments,pe=x?x.apply(this,G):G[0],ze=P.cache;if(ze.has(pe))return ze.get(pe);var _t=m.apply(this,G);return P.cache=ze.set(pe,_t)||ze,_t};return P.cache=new(as.Cache||h),P}as.Cache=h;function Fs(m){if(typeof m!="function")throw new ou(xe);return function(){var x=arguments;switch(x.length){case 0:return!m.call(this);case 1:return!m.call(this,x[0]);case 2:return!m.call(this,x[0],x[1]);case 3:return!m.call(this,x[0],x[1],x[2])}return!m.apply(this,x)}}function pu(m){return Ca(2,m)}var Au=Jh(function(m,x){x=x.length==1&&ca(x[0])?No(x[0],Fu(Wi())):No(ro(x,1),Fu(Wi()));var P=x.length;return ya(function(G){for(var pe=-1,ze=xs(G.length,P);++pe<ze;)G[pe]=x[pe].call(this,G[pe]);return vi(m,this,G)})}),nu=ya(function(m,x){var P=pl(x,Vf(nu));return Xc(m,ne,Z,x,P)}),Yu=ya(function(m,x){var P=pl(x,Vf(Yu));return Xc(m,gr,Z,x,P)}),Oo=Hl(function(m,x){return Xc(m,xt,Z,Z,Z,x)});function Vs(m,x){if(typeof m!="function")throw new ou(xe);return x=x===Z?x:Fi(x),ya(m,x)}function ba(m,x){if(typeof m!="function")throw new ou(xe);return x=x==null?0:Ya(Fi(x),0),ya(function(P){var G=P[x],pe=Wu(P,0,x);return G&&Iu(pe,G),vi(m,this,pe)})}function Bo(m,x,P){var G=!0,pe=!0;if(typeof m!="function")throw new ou(xe);return hs(P)&&(G="leading"in P?!!P.leading:G,pe="trailing"in P?!!P.trailing:pe),_o(m,x,{leading:G,maxWait:x,trailing:pe})}function po(m){return hi(m,1)}function ja(m,x){return nu(zf(x),m)}function qu(){if(!arguments.length)return[];var m=arguments[0];return ca(m)?m:[m]}function Pu(m){return Ki(m,Ft)}function Jo(m,x){return x=typeof x=="function"?x:Z,Ki(m,Ft,x)}function $s(m){return Ki(m,gt|Ft)}function Ku(m,x){return x=typeof x=="function"?x:Z,Ki(m,gt|Ft,x)}function so(m,x){return x==null||Hi(m,x,du(x))}function Ru(m,x){return m===x||m!==m&&x!==x}var $l=no(Gu),Gf=no(function(m,x){return m>=x}),Wo=Ol(function(){return arguments}())?Ol:function(m){return Gs(m)&&go.call(m,"callee")&&!Ec.call(m,"callee")},ca=Mr.isArray,Yc=Gt?Fu(Gt):ml;function Qu(m){return m!=null&&_f(m.length)&&!Tc(m)}function Cs(m){return Gs(m)&&Qu(m)}function Cp(m){return m===!0||m===!1||Gs(m)&&qo(m)==Ra}var Bl=dl||Bv,up=Wt?Fu(Wt):ns;function Yp(m){return Gs(m)&&m.nodeType===1&&!xf(m)}function Tp(m){if(m==null)return!0;if(Qu(m)&&(ca(m)||typeof m=="string"||typeof m.splice=="function"||Bl(m)||Ef(m)||Wo(m)))return!m.length;var x=Kt(m);if(x==Yn||x==ce)return!m.size;if(Dr(m))return!Bf(m).length;for(var P in m)if(go.call(m,P))return!1;return!0}function qp(m,x){return Hu(m,x)}function Kp(m,x,P){P=typeof P=="function"?P:Z;var G=P?P(m,x):Z;return G===Z?Hu(m,x,Z,P):!!G}function Mp(m){if(!Gs(m))return!1;var x=qo(m);return x==ua||x==Pi||typeof m.message=="string"&&typeof m.name=="string"&&!xf(m)}function fh(m){return typeof m=="number"&&ga(m)}function Tc(m){if(!hs(m))return!1;var x=qo(m);return x==sa||x==Bi||x==ii||x==Rt}function lp(m){return typeof m=="number"&&m==Fi(m)}function _f(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=Xe}function hs(m){var x=typeof m;return m!=null&&(x=="object"||x=="function")}function Gs(m){return m!=null&&typeof m=="object"}var Ip=Or?Fu(Or):Ac;function Qp(m,x){return m===x||Na(m,x,Nh(x))}function Jp(m,x,P){return P=typeof P=="function"?P:Z,Na(m,x,Nh(x),P)}function wd(m){return kp(m)&&m!=+m}function cp(m){if(wn(m))throw new Vn(K);return ll(m)}function ed(m){return m===null}function td(m){return m==null}function kp(m){return typeof m=="number"||Gs(m)&&qo(m)==bi}function xf(m){if(!Gs(m)||qo(m)!=Ha)return!1;var x=of(m);if(x===null)return!0;var P=go.call(x,"constructor")&&x.constructor;return typeof P=="function"&&P instanceof P&&ys.call(P)==rs}var Pp=en?Fu(en):Eu;function fc(m){return lp(m)&&m>=-Xe&&m<=Xe}var fp=ci?Fu(ci):jc;function bf(m){return typeof m=="string"||!ca(m)&&Gs(m)&&qo(m)==Me}function Al(m){return typeof m=="symbol"||Gs(m)&&qo(m)==j}var Ef=Gi?Fu(Gi):gl;function Ad(m){return m===Z}function dv(m){return Gs(m)&&Kt(m)==ir}function Vd(m){return Gs(m)&&qo(m)==Jr}var Gd=no(lf),Cd=no(function(m,x){return m<=x});function vv(m){if(!m)return[];if(Qu(m))return bf(m)?nl(m):Us(m);if(Dc&&m[Dc])return ec(m[Dc]());var x=Kt(m),P=x==Yn?Zs:x==ce?Ws:vh;return P(m)}function hc(m){if(!m)return m===0?m:0;if(m=Kc(m),m===de||m===-de){var x=m<0?-1:1;return x*lt}return m===m?m:0}function Fi(m){var x=hc(m),P=x%1;return x===x?P?x-P:x:0}function qc(m){return m?gi(Fi(m),0,Vt):0}function Kc(m){if(typeof m=="number")return m;if(Al(m))return yt;if(hs(m)){var x=typeof m.valueOf=="function"?m.valueOf():m;m=hs(x)?x+"":x}if(typeof m!="string")return m===0?m:+m;m=Zl(m);var P=Fn.test(m);return P||$a.test(m)?Ke(m.slice(2),P?2:8):Yi.test(m)?yt:+m}function hh(m){return cl(m,fl(m))}function Td(m){return m?gi(Fi(m),-Xe,Xe):m===0?m:0}function Vo(m){return m==null?"":yo(m)}var Md=Dh(function(m,x){if(Dr(x)||Qu(x)){cl(x,du(x),m);return}for(var P in x)go.call(x,P)&&wr(m,P,x[P])}),Sf=Dh(function(m,x){cl(x,fl(x),m)}),hp=Dh(function(m,x,P,G){cl(x,fl(x),m,G)}),Ta=Dh(function(m,x,P,G){cl(x,du(x),m,G)}),Ma=Hl(_i);function rd(m,x){var P=Qs(m);return x==null?P:ln(P,x)}var mv=ya(function(m,x){m=co(m);var P=-1,G=x.length,pe=G>2?x[2]:Z;for(pe&&Ur(x[0],x[1],pe)&&(G=1);++P<G;)for(var ze=x[P],_t=fl(ze),Ot=-1,or=_t.length;++Ot<or;){var qr=_t[Ot],fn=m[qr];(fn===Z||Ru(fn,bc[qr])&&!go.call(m,qr))&&(m[qr]=ze[qr])}return m}),gv=ya(function(m){return m.push(Z,Hp),vi(xv,Z,m)});function Id(m,x){return Sh(m,Wi(x,3),wo)}function i0(m,x){return Sh(m,Wi(x,3),uu)}function a0(m,x){return m==null?m:Ps(m,Wi(x,3),fl)}function o0(m,x){return m==null?m:Zo(m,Wi(x,3),fl)}function s0(m,x){return m&&wo(m,Wi(x,3))}function u0(m,x){return m&&uu(m,Wi(x,3))}function Mc(m){return m==null?[]:Rs(m,du(m))}function jd(m){return m==null?[]:Rs(m,fl(m))}function Hd(m,x,P){var G=m==null?Z:Vu(m,x);return G===Z?P:G}function ph(m,x){return m!=null&&Ir(m,x,Es)}function yv(m,x){return m!=null&&Ir(m,x,Of)}var _v=cc(function(m,x,P){x!=null&&typeof x.toString!="function"&&(x=Gn.call(x)),m[x]=P},Rv(Ic)),Rp=cc(function(m,x,P){x!=null&&typeof x.toString!="function"&&(x=Gn.call(x)),go.call(m,x)?m[x].push(P):m[x]=[P]},Wi),nd=ya(ju);function du(m){return Qu(m)?dt(m):Bf(m)}function fl(m){return Qu(m)?dt(m,!0):Fl(m)}function id(m,x){var P={};return x=Wi(x,3),wo(m,function(G,pe,ze){ei(P,x(G,pe,ze),G)}),P}function l0(m,x){var P={};return x=Wi(x,3),wo(m,function(G,pe,ze){ei(P,pe,x(G,pe,ze))}),P}var c0=Dh(function(m,x,P){Su(m,x,P)}),xv=Dh(function(m,x,P,G){Su(m,x,P,G)}),f0=Hl(function(m,x){var P={};if(m==null)return P;var G=!1;x=No(x,function(ze){return ze=lc(ze,m),G||(G=ze.length>1),ze}),cl(m,sh(m),P),G&&(P=Ki(P,gt|Mt|Ft,Zd));for(var pe=x.length;pe--;)Ph(P,x[pe]);return P});function bv(m,x){return dh(m,Fs(Wi(x)))}var Ev=Hl(function(m,x){return m==null?{}:zp(m,x)});function dh(m,x){if(m==null)return{};var P=No(sh(m),function(G){return[G]});return x=Wi(x),kh(m,P,function(G,pe){return x(G,pe[0])})}function kd(m,x,P){x=lc(x,m);var G=-1,pe=x.length;for(pe||(pe=1,m=Z);++G<pe;){var ze=m==null?Z:m[io(x[G])];ze===Z&&(G=pe,ze=P),m=Tc(ze)?ze.call(m):ze}return m}function Sv(m,x,P){return m==null?m:Kh(m,x,P)}function wv(m,x,P,G){return G=typeof G=="function"?G:Z,m==null?m:Kh(m,x,P,G)}var Av=ap(du),Wd=ap(fl);function h0(m,x,P){var G=ca(m),pe=G||Bl(m)||Ef(m);if(x=Wi(x,4),P==null){var ze=m&&m.constructor;pe?P=G?new ze:[]:hs(m)?P=Tc(ze)?Qs(of(m)):{}:P={}}return(pe?ha:wo)(m,function(_t,Ot,or){return x(P,_t,Ot,or)}),P}function p0(m,x){return m==null?!0:Ph(m,x)}function Cv(m,x,P){return m==null?m:Hc(m,x,zf(P))}function d0(m,x,P,G){return G=typeof G=="function"?G:Z,m==null?m:Hc(m,x,zf(P),G)}function vh(m){return m==null?[]:mc(m,du(m))}function v0(m){return m==null?[]:mc(m,fl(m))}function Xd(m,x,P){return P===Z&&(P=x,x=Z),P!==Z&&(P=Kc(P),P=P===P?P:0),x!==Z&&(x=Kc(x),x=x===x?x:0),gi(Kc(m),x,P)}function tm(m,x,P){return x=hc(x),P===Z?(P=x,x=0):P=hc(P),m=Kc(m),wc(m,x,P)}function m0(m,x,P){if(P&&typeof P!="boolean"&&Ur(m,x,P)&&(x=P=Z),P===Z&&(typeof x=="boolean"?(P=x,x=Z):typeof m=="boolean"&&(P=m,m=Z)),m===Z&&x===Z?(m=0,x=1):(m=hc(m),x===Z?(x=m,m=0):x=hc(x)),m>x){var G=m;m=x,x=G}if(P||m%1||x%1){var pe=bu();return xs(m+pe*(x-m+Il("1e-"+((pe+"").length-1))),x)}return eh(m,x)}var $d=Cc(function(m,x,P){return x=x.toLowerCase(),m+(P?Tv(x):x)});function Tv(m){return y0(Vo(m).toLowerCase())}function Yd(m){return m=Vo(m),m&&m.replace(pa,tf).replace(Tu,"")}function Mv(m,x,P){m=Vo(m),x=yo(x);var G=m.length;P=P===Z?G:gi(Fi(P),0,G);var pe=P;return P-=x.length,P>=0&&m.slice(P,pe)==x}function Uh(m){return m=Vo(m),m&&le.test(m)?m.replace(La,Rl):m}function pp(m){return m=Vo(m),m&&Xt.test(m)?m.replace(Je,"\\$&"):m}var Iv=Cc(function(m,x,P){return m+(P?"-":"")+x.toLowerCase()}),kv=Cc(function(m,x,P){return m+(P?" ":"")+x.toLowerCase()}),wf=np("toLowerCase");function Lp(m,x,P){m=Vo(m),x=Fi(x);var G=x?xc(m):0;if(!x||G>=x)return m;var pe=(x-G)/2;return ip(Rf(pe),P)+m+ip(Bc(pe),P)}function qd(m,x,P){m=Vo(m),x=Fi(x);var G=x?xc(m):0;return x&&G<x?m+ip(x-G,P):m}function ad(m,x,P){m=Vo(m),x=Fi(x);var G=x?xc(m):0;return x&&G<x?ip(x-G,P)+m:m}function Pv(m,x,P){return P||x==null?x=0:x&&(x=+x),Yo(Vo(m).replace(Wr,""),x||0)}function rm(m,x,P){return(P?Ur(m,x,P):x===Z)?x=1:x=Fi(x),wp(Vo(m),x)}function nm(){var m=arguments,x=Vo(m[0]);return m.length<3?x:x.replace(m[1],m[2])}var yg=Cc(function(m,x,P){return m+(P?"_":"")+x.toLowerCase()});function _g(m,x,P){return P&&typeof P!="number"&&Ur(m,x,P)&&(x=P=Z),P=P===Z?Vt:P>>>0,P?(m=Vo(m),m&&(typeof x=="string"||x!=null&&!Pp(x))&&(x=yo(x),!x&&yc(m))?Wu(nl(m),0,P):m.split(x,P)):[]}var xg=Cc(function(m,x,P){return m+(P?" ":"")+y0(x)});function bg(m,x,P){return m=Vo(m),P=P==null?0:gi(Fi(P),0,m.length),x=yo(x),m.slice(P,P+x.length)==x}function Kd(m,x,P){var G=Ie.templateSettings;P&&Ur(m,x,P)&&(x=Z),m=Vo(m),x=hp({},x,G,xd);var pe=hp({},x.imports,G.imports,xd),ze=du(pe),_t=mc(pe,ze),Ot,or,qr=0,fn=x.interpolate||Xi,Tn="__p += '",pi=Ul((x.escape||Xi).source+"|"+fn.source+"|"+(fn===He?Cn:Xi).source+"|"+(x.evaluate||Xi).source+"|$","g"),Ji="//# sourceURL="+(go.call(x,"sourceURL")?(x.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++lo+"]")+`
`;m.replace(pi,function(Ea,Ao,xo,Cf,kc,Tf){return xo||(xo=Cf),Tn+=m.slice(qr,Tf).replace(Ui,gs),Ao&&(Ot=!0,Tn+=`' +
__e(`+Ao+`) +
'`),kc&&(or=!0,Tn+=`';
`+kc+`;
__p += '`),xo&&(Tn+=`' +
((__t = (`+xo+`)) == null ? '' : __t) +
'`),qr=Tf+Ea.length,Ea}),Tn+=`';
`;var Ia=go.call(x,"variable")&&x.variable;if(!Ia)Tn=`with (obj) {
`+Tn+`
}
`;else if(ar.test(Ia))throw new Vn(ve);Tn=(or?Tn.replace(Wa,""):Tn).replace(uo,"$1").replace(Io,"$1;"),Tn="function("+(Ia||"obj")+`) {
`+(Ia?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Ot?", __e = _.escape":"")+(or?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Tn+`return __p
}`;var vo=lm(function(){return Ni(ze,Ji+"return "+Tn).apply(Z,_t)});if(vo.source=Tn,Mp(vo))throw vo;return vo}function Yl(m){return Vo(m).toLowerCase()}function im(m){return Vo(m).toUpperCase()}function am(m,x,P){if(m=Vo(m),m&&(P||x===Z))return Zl(m);if(!m||!(x=yo(x)))return m;var G=nl(m),pe=nl(x),ze=gc(G,pe),_t=Lc(G,pe)+1;return Wu(G,ze,_t).join("")}function om(m,x,P){if(m=Vo(m),m&&(P||x===Z))return m.slice(0,tc(m)+1);if(!m||!(x=yo(x)))return m;var G=nl(m),pe=Lc(G,nl(x))+1;return Wu(G,0,pe).join("")}function g0(m,x,P){if(m=Vo(m),m&&(P||x===Z))return m.replace(Wr,"");if(!m||!(x=yo(x)))return m;var G=nl(m),pe=gc(G,nl(x));return Wu(G,pe).join("")}function sm(m,x){var P=Ct,G=br;if(hs(x)){var pe="separator"in x?x.separator:pe;P="length"in x?Fi(x.length):P,G="omission"in x?yo(x.omission):G}m=Vo(m);var ze=m.length;if(yc(m)){var _t=nl(m);ze=_t.length}if(P>=ze)return m;var Ot=P-xc(G);if(Ot<1)return G;var or=_t?Wu(_t,0,Ot).join(""):m.slice(0,Ot);if(pe===Z)return or+G;if(_t&&(Ot+=or.length-Ot),Pp(pe)){if(m.slice(Ot).search(pe)){var qr,fn=or;for(pe.global||(pe=Ul(pe.source,Vo(se.exec(pe))+"g")),pe.lastIndex=0;qr=pe.exec(fn);)var Tn=qr.index;or=or.slice(0,Tn===Z?Ot:Tn)}}else if(m.indexOf(yo(pe),Ot)!=Ot){var pi=or.lastIndexOf(pe);pi>-1&&(or=or.slice(0,pi))}return or+G}function Eg(m){return m=Vo(m),m&&te.test(m)?m.replace(to,Ch):m}var Sg=Cc(function(m,x,P){return m+(P?" ":"")+x.toUpperCase()}),y0=np("toUpperCase");function um(m,x,P){return m=Vo(m),x=P?Z:x,x===Z?Wh(m)?rf(m):Hh(m):m.match(x)||[]}var lm=ya(function(m,x){try{return vi(m,Z,x)}catch(P){return Mp(P)?P:new Vn(P)}}),wg=Hl(function(m,x){return ha(x,function(P){P=io(P),ei(m,P,oa(m[P],m))}),m});function Ag(m){var x=m==null?0:m.length,P=Wi();return m=x?No(m,function(G){if(typeof G[1]!="function")throw new ou(xe);return[P(G[0]),G[1]]}):[],ya(function(G){for(var pe=-1;++pe<x;){var ze=m[pe];if(vi(ze[0],this,G))return vi(ze[1],this,G)}})}function ee(m){return Nn(Ki(m,gt))}function Rv(m){return function(){return m}}function cm(m,x){return m==null||m!==m?x:m}var fm=bl(),hm=bl(!0);function Ic(m){return m}function Lv(m){return Df(typeof m=="function"?m:Ki(m,gt))}function pm(m){return sc(Ki(m,gt))}function od(m,x){return Qf(m,Ki(x,gt))}var dm=ya(function(m,x){return function(P){return ju(P,m,x)}}),vm=ya(function(m,x){return function(P){return ju(m,P,x)}});function Ov(m,x,P){var G=du(x),pe=Rs(x,G);P==null&&!(hs(x)&&(pe.length||!G.length))&&(P=x,x=m,m=this,pe=Rs(x,du(x)));var ze=!(hs(P)&&"chain"in P)||!!P.chain,_t=Tc(m);return ha(pe,function(Ot){var or=x[Ot];m[Ot]=or,_t&&(m.prototype[Ot]=function(){var qr=this.__chain__;if(ze||qr){var fn=m(this.__wrapped__),Tn=fn.__actions__=Us(this.__actions__);return Tn.push({func:or,args:arguments,thisArg:m}),fn.__chain__=qr,fn}return or.apply(m,Iu([this.value()],arguments))})}),m}function mm(){return R._===this&&(R._=nc),this}function Fv(){}function Cg(m){return m=Fi(m),ya(function(x){return cf(x,m)})}var Tg=Vp(No),gm=Vp(Sa),ym=Vp(kl);function _0(m){return sn(m)?Jl(io(m)):Ep(m)}function _m(m){return function(x){return m==null?Z:Vu(m,x)}}var xm=jp(),Qd=jp(!0);function Dv(){return[]}function Bv(){return!1}function bm(){return{}}function Mg(){return""}function Ig(){return!0}function Em(m,x){if(m=Fi(m),m<1||m>Xe)return[];var P=Vt,G=xs(m,Vt);x=Wi(x),m-=Vt;for(var pe=wh(G,x);++P<m;)x(P);return pe}function kg(m){return ca(m)?No(m,io):Al(m)?[m]:Us(_a(Vo(m)))}function Pg(m){var x=++Yf;return Vo(m)+x}var Rg=Xu(function(m,x){return m+x},0),Af=Ss("ceil"),Lg=Xu(function(m,x){return m/x},1),Og=Ss("floor");function Fg(m){return m&&m.length?wi(m,Ic,Gu):Z}function Dg(m,x){return m&&m.length?wi(m,Wi(x,2),Gu):Z}function Bg(m){return kf(m,Ic)}function Jd(m,x){return kf(m,Wi(x,2))}function Sm(m){return m&&m.length?wi(m,Ic,lf):Z}function wm(m,x){return m&&m.length?wi(m,Wi(x,2),lf):Z}var Am=Xu(function(m,x){return m*x},1),x0=Ss("round"),Cm=Xu(function(m,x){return m-x},0);function Ng(m){return m&&m.length?zs(m,Ic):0}function zg(m,x){return m&&m.length?zs(m,Wi(x,2)):0}return Ie.after=ji,Ie.ary=hi,Ie.assign=Md,Ie.assignIn=Sf,Ie.assignInWith=hp,Ie.assignWith=Ta,Ie.at=Ma,Ie.before=Ca,Ie.bind=oa,Ie.bindAll=wg,Ie.bindKey=Pa,Ie.castArray=qu,Ie.chain=kn,Ie.chunk=Lo,Ie.compact=cu,Ie.concat=Fa,Ie.cond=Ag,Ie.conforms=ee,Ie.constant=Rv,Ie.countBy=g,Ie.create=rd,Ie.curry=Ci,Ie.curryRight=Mi,Ie.debounce=_o,Ie.defaults=mv,Ie.defaultsDeep=gv,Ie.defer=Os,Ie.delay=As,Ie.difference=Ko,Ie.differenceBy=is,Ie.differenceWith=eu,Ie.drop=Mo,Ie.dropRight=$i,Ie.dropRightWhile=Ls,Ie.dropWhile=Ka,Ie.fill=fu,Ie.filter=A,Ie.flatMap=z,Ie.flatMapDeep=$,Ie.flatMapDepth=Q,Ie.flatten=Ga,Ie.flattenDeep=ws,Ie.flattenDepth=gf,Ie.flip=Qo,Ie.flow=fm,Ie.flowRight=hm,Ie.fromPairs=We,Ie.functions=Mc,Ie.functionsIn=jd,Ie.groupBy=Ee,Ie.initial=Xn,Ie.intersection=Aa,Ie.intersectionBy=Ze,Ie.intersectionWith=Se,Ie.invert=_v,Ie.invertBy=Rp,Ie.invokeMap=qe,Ie.iteratee=Lv,Ie.keyBy=bt,Ie.keys=du,Ie.keysIn=fl,Ie.map=st,Ie.mapKeys=id,Ie.mapValues=l0,Ie.matches=pm,Ie.matchesProperty=od,Ie.memoize=as,Ie.merge=c0,Ie.mergeWith=xv,Ie.method=dm,Ie.methodOf=vm,Ie.mixin=Ov,Ie.negate=Fs,Ie.nthArg=Cg,Ie.omit=f0,Ie.omitBy=bv,Ie.once=pu,Ie.orderBy=Nt,Ie.over=Tg,Ie.overArgs=Au,Ie.overEvery=gm,Ie.overSome=ym,Ie.partial=nu,Ie.partialRight=Yu,Ie.partition=er,Ie.pick=Ev,Ie.pickBy=dh,Ie.property=_0,Ie.propertyOf=_m,Ie.pull=et,Ie.pullAll=Tt,Ie.pullAllBy=Fe,Ie.pullAllWith=ct,Ie.pullAt=Ve,Ie.range=xm,Ie.rangeRight=Qd,Ie.rearg=Oo,Ie.reject=Br,Ie.remove=Zt,Ie.rest=Vs,Ie.reverse=Qt,Ie.sampleSize=Ln,Ie.set=Sv,Ie.setWith=wv,Ie.shuffle=xi,Ie.slice=Vr,Ie.sortBy=Wn,Ie.sortedUniq=ti,Ie.sortedUniqBy=Qn,Ie.split=_g,Ie.spread=ba,Ie.tail=$n,Ie.take=Zi,Ie.takeRight=Qa,Ie.takeRightWhile=tu,Ie.takeWhile=Do,Ie.tap=ch,Ie.throttle=Bo,Ie.thru=fr,Ie.toArray=vv,Ie.toPairs=Av,Ie.toPairsIn=Wd,Ie.toPath=kg,Ie.toPlainObject=hh,Ie.transform=h0,Ie.unary=po,Ie.union=Ja,Ie.unionBy=$c,Ie.unionWith=$u,Ie.uniq=Xl,Ie.uniqBy=Sl,Ie.uniqWith=sp,Ie.unset=p0,Ie.unzip=wl,Ie.unzipWith=yf,Ie.update=Cv,Ie.updateWith=d0,Ie.values=vh,Ie.valuesIn=v0,Ie.without=lh,Ie.words=um,Ie.wrap=ja,Ie.xor=Ed,Ie.xorBy=ru,Ie.xorWith=Xp,Ie.zip=zh,Ie.zipObject=$p,Ie.zipObjectDeep=Sd,Ie.zipWith=hv,Ie.entries=Av,Ie.entriesIn=Wd,Ie.extend=Sf,Ie.extendWith=hp,Ov(Ie,Ie),Ie.add=Rg,Ie.attempt=lm,Ie.camelCase=$d,Ie.capitalize=Tv,Ie.ceil=Af,Ie.clamp=Xd,Ie.clone=Pu,Ie.cloneDeep=$s,Ie.cloneDeepWith=Ku,Ie.cloneWith=Jo,Ie.conformsTo=so,Ie.deburr=Yd,Ie.defaultTo=cm,Ie.divide=Lg,Ie.endsWith=Mv,Ie.eq=Ru,Ie.escape=Uh,Ie.escapeRegExp=pp,Ie.every=b,Ie.find=T,Ie.findIndex=Oi,Ie.findKey=Id,Ie.findLast=O,Ie.findLastIndex=va,Ie.findLastKey=i0,Ie.floor=Og,Ie.forEach=re,Ie.forEachRight=me,Ie.forIn=a0,Ie.forInRight=o0,Ie.forOwn=s0,Ie.forOwnRight=u0,Ie.get=Hd,Ie.gt=$l,Ie.gte=Gf,Ie.has=ph,Ie.hasIn=yv,Ie.head=vr,Ie.identity=Ic,Ie.includes=$e,Ie.indexOf=rr,Ie.inRange=tm,Ie.invoke=nd,Ie.isArguments=Wo,Ie.isArray=ca,Ie.isArrayBuffer=Yc,Ie.isArrayLike=Qu,Ie.isArrayLikeObject=Cs,Ie.isBoolean=Cp,Ie.isBuffer=Bl,Ie.isDate=up,Ie.isElement=Yp,Ie.isEmpty=Tp,Ie.isEqual=qp,Ie.isEqualWith=Kp,Ie.isError=Mp,Ie.isFinite=fh,Ie.isFunction=Tc,Ie.isInteger=lp,Ie.isLength=_f,Ie.isMap=Ip,Ie.isMatch=Qp,Ie.isMatchWith=Jp,Ie.isNaN=wd,Ie.isNative=cp,Ie.isNil=td,Ie.isNull=ed,Ie.isNumber=kp,Ie.isObject=hs,Ie.isObjectLike=Gs,Ie.isPlainObject=xf,Ie.isRegExp=Pp,Ie.isSafeInteger=fc,Ie.isSet=fp,Ie.isString=bf,Ie.isSymbol=Al,Ie.isTypedArray=Ef,Ie.isUndefined=Ad,Ie.isWeakMap=dv,Ie.isWeakSet=Vd,Ie.join=pt,Ie.kebabCase=Iv,Ie.last=Lt,Ie.lastIndexOf=sr,Ie.lowerCase=kv,Ie.lowerFirst=wf,Ie.lt=Gd,Ie.lte=Cd,Ie.max=Fg,Ie.maxBy=Dg,Ie.mean=Bg,Ie.meanBy=Jd,Ie.min=Sm,Ie.minBy=wm,Ie.stubArray=Dv,Ie.stubFalse=Bv,Ie.stubObject=bm,Ie.stubString=Mg,Ie.stubTrue=Ig,Ie.multiply=Am,Ie.nth=Et,Ie.noConflict=mm,Ie.noop=Fv,Ie.now=la,Ie.pad=Lp,Ie.padEnd=qd,Ie.padStart=ad,Ie.parseInt=Pv,Ie.random=m0,Ie.reduce=_r,Ie.reduceRight=Er,Ie.repeat=rm,Ie.replace=nm,Ie.result=kd,Ie.round=x0,Ie.runInContext=kt,Ie.sample=dn,Ie.size=jn,Ie.snakeCase=yg,Ie.some=Ai,Ie.sortedIndex=En,Ie.sortedIndexBy=An,Ie.sortedIndexOf=Dn,Ie.sortedLastIndex=bn,Ie.sortedLastIndexBy=oi,Ie.sortedLastIndexOf=Zn,Ie.startCase=xg,Ie.startsWith=bg,Ie.subtract=Cm,Ie.sum=Ng,Ie.sumBy=zg,Ie.template=Kd,Ie.times=Em,Ie.toFinite=hc,Ie.toInteger=Fi,Ie.toLength=qc,Ie.toLower=Yl,Ie.toNumber=Kc,Ie.toSafeInteger=Td,Ie.toString=Vo,Ie.toUpper=im,Ie.trim=am,Ie.trimEnd=om,Ie.trimStart=g0,Ie.truncate=sm,Ie.unescape=Eg,Ie.uniqueId=Pg,Ie.upperCase=Sg,Ie.upperFirst=y0,Ie.each=re,Ie.eachRight=me,Ie.first=vr,Ov(Ie,function(){var m={};return wo(Ie,function(x,P){go.call(Ie.prototype,P)||(m[P]=x)}),m}(),{chain:!1}),Ie.VERSION=_,ha(["bind","bindKey","curry","curryRight","partial","partialRight"],function(m){Ie[m].placeholder=Ie}),ha(["drop","take"],function(m,x){Ba.prototype[m]=function(P){P=P===Z?1:Ya(Fi(P),0);var G=this.__filtered__&&!x?new Ba(this):this.clone();return G.__filtered__?G.__takeCount__=xs(P,G.__takeCount__):G.__views__.push({size:xs(P,Vt),type:m+(G.__dir__<0?"Right":"")}),G},Ba.prototype[m+"Right"]=function(P){return this.reverse()[m](P).reverse()}}),ha(["filter","map","takeWhile"],function(m,x){var P=x+1,G=P==Ue||P==U;Ba.prototype[m]=function(pe){var ze=this.clone();return ze.__iteratees__.push({iteratee:Wi(pe,3),type:P}),ze.__filtered__=ze.__filtered__||G,ze}}),ha(["head","last"],function(m,x){var P="take"+(x?"Right":"");Ba.prototype[m]=function(){return this[P](1).value()[0]}}),ha(["initial","tail"],function(m,x){var P="drop"+(x?"":"Right");Ba.prototype[m]=function(){return this.__filtered__?new Ba(this):this[P](1)}}),Ba.prototype.compact=function(){return this.filter(Ic)},Ba.prototype.find=function(m){return this.filter(m).head()},Ba.prototype.findLast=function(m){return this.reverse().find(m)},Ba.prototype.invokeMap=ya(function(m,x){return typeof m=="function"?new Ba(this):this.map(function(P){return ju(P,m,x)})}),Ba.prototype.reject=function(m){return this.filter(Fs(Wi(m)))},Ba.prototype.slice=function(m,x){m=Fi(m);var P=this;return P.__filtered__&&(m>0||x<0)?new Ba(P):(m<0?P=P.takeRight(-m):m&&(P=P.drop(m)),x!==Z&&(x=Fi(x),P=x<0?P.dropRight(-x):P.take(x-m)),P)},Ba.prototype.takeRightWhile=function(m){return this.reverse().takeWhile(m).reverse()},Ba.prototype.toArray=function(){return this.take(Vt)},wo(Ba.prototype,function(m,x){var P=/^(?:filter|find|map|reject)|While$/.test(x),G=/^(?:head|last)$/.test(x),pe=Ie[G?"take"+(x=="last"?"Right":""):x],ze=G||/^find/.test(x);!pe||(Ie.prototype[x]=function(){var _t=this.__wrapped__,Ot=G?[1]:arguments,or=_t instanceof Ba,qr=Ot[0],fn=or||ca(_t),Tn=function(Ao){var xo=pe.apply(Ie,Iu([Ao],Ot));return G&&pi?xo[0]:xo};fn&&P&&typeof qr=="function"&&qr.length!=1&&(or=fn=!1);var pi=this.__chain__,Ji=!!this.__actions__.length,Ia=ze&&!pi,vo=or&&!Ji;if(!ze&&fn){_t=vo?_t:new Ba(this);var Ea=m.apply(_t,Ot);return Ea.__actions__.push({func:fr,args:[Tn],thisArg:Z}),new Js(Ea,pi)}return Ia&&vo?m.apply(this,Ot):(Ea=this.thru(Tn),Ia?G?Ea.value()[0]:Ea.value():Ea)})}),ha(["pop","push","shift","sort","splice","unshift"],function(m){var x=Mh[m],P=/^(?:push|sort|unshift)$/.test(m)?"tap":"thru",G=/^(?:pop|shift)$/.test(m);Ie.prototype[m]=function(){var pe=arguments;if(G&&!this.__chain__){var ze=this.value();return x.apply(ca(ze)?ze:[],pe)}return this[P](function(_t){return x.apply(ca(_t)?_t:[],pe)})}}),wo(Ba.prototype,function(m,x){var P=Ie[x];if(P){var G=P.name+"";go.call(Vl,G)||(Vl[G]=[]),Vl[G].push({name:x,func:P})}}),Vl[vf(Z,qt).name]=[{name:"wrapper",func:Z}],Ba.prototype.clone=Oa,Ba.prototype.reverse=Ll,Ba.prototype.value=Zu,Ie.prototype.at=pv,Ie.prototype.chain=n0,Ie.prototype.commit=hu,Ie.prototype.next=Zh,Ie.prototype.plant=a,Ie.prototype.reverse=s,Ie.prototype.toJSON=Ie.prototype.valueOf=Ie.prototype.value=c,Ie.prototype.first=Ie.prototype.head,Dc&&(Ie.prototype[Dc]=Ud),Ie},rc=_p();R._=rc,Oe=function(){return rc}.call(ge,ie,ge,Yr),Oe!==Z&&(Yr.exports=Oe)}).call(this)},11726:function(Yr,ge,ie){var Oe=ie(78302),Z=ie(88016),_=ie(40554),Pe=ie(79833);function K(xe,ve,tt){xe=Pe(xe),ve=_(ve);var Ae=ve?Z(xe):0;return ve&&Ae<ve?xe+Oe(ve-Ae,tt):xe}Yr.exports=K},32475:function(Yr,ge,ie){var Oe=ie(78302),Z=ie(88016),_=ie(40554),Pe=ie(79833);function K(xe,ve,tt){xe=Pe(xe),ve=_(ve);var Ae=ve?Z(xe):0;return ve&&Ae<ve?Oe(ve-Ae,tt)+xe:xe}Yr.exports=K},6158:function(Yr){(function(ge,ie){Yr.exports=ie()})(this,function(){"use strict";var ge,ie,Oe;function Z(_,Pe){if(!ge)ge=Pe;else if(!ie)ie=Pe;else{var K="var sharedChunk = {}; ("+ge+")(sharedChunk); ("+ie+")(sharedChunk);",xe={};ge(xe),Oe=Pe(xe),typeof window!="undefined"&&(Oe.workerUrl=window.URL.createObjectURL(new Blob([K],{type:"text/javascript"})))}}return Z(["exports"],function(_){"use strict";function Pe(a,s){return a(s={exports:{}},s.exports),s.exports}var K=xe;function xe(a,s,c,g){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(g-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=g,this.p2x=c,this.p2y=g}xe.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},xe.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},xe.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},xe.prototype.solveCurveX=function(a,s){var c,g,b,A,T;for(s===void 0&&(s=1e-6),b=a,T=0;T<8;T++){if(A=this.sampleCurveX(b)-a,Math.abs(A)<s)return b;var O=this.sampleCurveDerivativeX(b);if(Math.abs(O)<1e-6)break;b-=A/O}if((b=a)<(c=0))return c;if(b>(g=1))return g;for(;c<g;){if(A=this.sampleCurveX(b),Math.abs(A-a)<s)return b;a>A?c=b:g=b,b=.5*(g-c)+c}return b},xe.prototype.solve=function(a,s){return this.sampleCurveY(this.solveCurveX(a,s))};var ve=tt;function tt(a,s){this.x=a,this.y=s}tt.prototype={clone:function(){return new tt(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,s){return this.clone()._rotateAround(a,s)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var s=a.x-this.x,c=a.y-this.y;return s*s+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,s){return Math.atan2(this.x*s-this.y*a,this.x*a+this.y*s)},_matMult:function(a){var s=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=s,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var s=Math.cos(a),c=Math.sin(a),g=c*this.x+s*this.y;return this.x=s*this.x-c*this.y,this.y=g,this},_rotateAround:function(a,s){var c=Math.cos(a),g=Math.sin(a),b=s.y+g*(this.x-s.x)+c*(this.y-s.y);return this.x=s.x+c*(this.x-s.x)-g*(this.y-s.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},tt.convert=function(a){return a instanceof tt?a:Array.isArray(a)?new tt(a[0],a[1]):a};var Ae=typeof self!="undefined"?self:{},at=Math.pow(2,53)-1;function gt(a,s,c,g){var b=new K(a,s,c,g);return function(A){return b.solve(A)}}var Mt=gt(.25,.1,.25,1);function Ft(a,s,c){return Math.min(c,Math.max(s,a))}function mr(a,s,c){var g=c-s,b=((a-s)%g+g)%g+s;return b===s?c:b}function jt(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];for(var g=0,b=s;g<b.length;g+=1){var A=b[g];for(var T in A)a[T]=A[T]}return a}var hr=1;function qt(){return hr++}function Dt(){return function a(s){return s?(s^16*Math.random()>>s/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Pt(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Cr(a,s){a.forEach(function(c){s[c]&&(s[c]=s[c].bind(s))})}function ne(a,s){return a.indexOf(s,a.length-s.length)!==-1}function gr(a,s,c){var g={};for(var b in a)g[b]=s.call(c||this,a[b],b,a);return g}function It(a,s,c){var g={};for(var b in a)s.call(c||this,a[b],b,a)&&(g[b]=a[b]);return g}function xt(a){return Array.isArray(a)?a.map(xt):typeof a=="object"&&a?gr(a,xt):a}var Jt={};function Ct(a){Jt[a]||(typeof console!="undefined"&&console.warn(a),Jt[a]=!0)}function br(a,s,c){return(c.y-a.y)*(s.x-a.x)>(s.y-a.y)*(c.x-a.x)}function $r(a){for(var s=0,c=0,g=a.length,b=g-1,A=void 0,T=void 0;c<g;b=c++)s+=((T=a[b]).x-(A=a[c]).x)*(A.y+T.y);return s}function oe(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Ue(a){var s={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(g,b,A,T){var O=A||T;return s[b]=!O||O.toLowerCase(),""}),s["max-age"]){var c=parseInt(s["max-age"],10);isNaN(c)?delete s["max-age"]:s["max-age"]=c}return s}var H=null;function U(a){if(H==null){var s=a.navigator?a.navigator.userAgent:null;H=!!a.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return H}function de(a){try{var s=Ae[a];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch(c){return!1}}var Xe,lt,yt,Vt,pr=Ae.performance&&Ae.performance.now?Ae.performance.now.bind(Ae.performance):Date.now.bind(Date),tn=Ae.requestAnimationFrame||Ae.mozRequestAnimationFrame||Ae.webkitRequestAnimationFrame||Ae.msRequestAnimationFrame,Kr=Ae.cancelAnimationFrame||Ae.mozCancelAnimationFrame||Ae.webkitCancelAnimationFrame||Ae.msCancelAnimationFrame,si={now:pr,frame:function(a){var s=tn(a);return{cancel:function(){return Kr(s)}}},getImageData:function(a,s){s===void 0&&(s=0);var c=Ae.document.createElement("canvas"),g=c.getContext("2d");if(!g)throw new Error("failed to create canvas 2d context");return c.width=a.width,c.height=a.height,g.drawImage(a,0,0,a.width,a.height),g.getImageData(-s,-s,a.width+2*s,a.height+2*s)},resolveURL:function(a){return Xe||(Xe=Ae.document.createElement("a")),Xe.href=a,Xe.href},hardwareConcurrency:Ae.navigator&&Ae.navigator.hardwareConcurrency||4,get devicePixelRatio(){return Ae.devicePixelRatio},get prefersReducedMotion(){return!!Ae.matchMedia&&(lt==null&&(lt=Ae.matchMedia("(prefers-reduced-motion: reduce)")),lt.matches)}},xn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ii={supported:!1,testSupport:function(a){!Ra&&Vt&&(Di?Pi(a):yt=a)}},Ra=!1,Di=!1;function Pi(a){var s=a.createTexture();a.bindTexture(a.TEXTURE_2D,s);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Vt),a.isContextLost())return;ii.supported=!0}catch(c){}a.deleteTexture(s),Ra=!0}Ae.document&&((Vt=Ae.document.createElement("img")).onload=function(){yt&&Pi(yt),yt=null,Di=!0},Vt.onerror=function(){Ra=!0,yt=null},Vt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var ua="01",sa=function(a,s){this._transformRequestFn=a,this._customAccessToken=s,this._createSkuToken()};function Bi(a){return a.indexOf("mapbox:")===0}sa.prototype._createSkuToken=function(){var a=function(){for(var s="",c=0;c<10;c++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ua,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},sa.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},sa.prototype.transformRequest=function(a,s){return this._transformRequestFn&&this._transformRequestFn(a,s)||{url:a}},sa.prototype.normalizeStyleURL=function(a,s){if(!Bi(a))return a;var c=Ha(a);return c.path="/styles/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||s)},sa.prototype.normalizeGlyphsURL=function(a,s){if(!Bi(a))return a;var c=Ha(a);return c.path="/fonts/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||s)},sa.prototype.normalizeSourceURL=function(a,s){if(!Bi(a))return a;var c=Ha(a);return c.path="/v4/"+c.authority+".json",c.params.push("secure"),this._makeAPIURL(c,this._customAccessToken||s)},sa.prototype.normalizeSpriteURL=function(a,s,c,g){var b=Ha(a);return Bi(a)?(b.path="/styles/v1"+b.path+"/sprite"+s+c,this._makeAPIURL(b,this._customAccessToken||g)):(b.path+=""+s+c,eo(b))},sa.prototype.normalizeTileURL=function(a,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Bi(a))return a;var c=Ha(a);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,(si.devicePixelRatio>=2||s===512?"@2x":"")+(ii.supported?".webp":"$1")),c.path=c.path.replace(/^.+\/v4\//,"/"),c.path="/v4"+c.path;var g=this._customAccessToken||function(b){for(var A=0,T=b;A<T.length;A+=1){var O=T[A].match(/^access_token=(.*)$/);if(O)return O[1]}return null}(c.params)||xn.ACCESS_TOKEN;return xn.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&c.params.push("sku="+this._skuToken),this._makeAPIURL(c,g)},sa.prototype.canonicalizeTileURL=function(a,s){var c=Ha(a);if(!c.path.match(/(^\/v4\/)/)||!c.path.match(/\.[\w]+$/))return a;var g="mapbox://tiles/";g+=c.path.replace("/v4/","");var b=c.params;return s&&(b=b.filter(function(A){return!A.match(/^access_token=/)})),b.length&&(g+="?"+b.join("&")),g},sa.prototype.canonicalizeTileset=function(a,s){for(var c=!!s&&Bi(s),g=[],b=0,A=a.tiles||[];b<A.length;b+=1){var T=A[b];bi(T)?g.push(this.canonicalizeTileURL(T,c)):g.push(T)}return g},sa.prototype._makeAPIURL=function(a,s){var c="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",g=Ha(xn.API_URL);if(a.protocol=g.protocol,a.authority=g.authority,a.protocol==="http"){var b=a.params.indexOf("secure");b>=0&&a.params.splice(b,1)}if(g.path!=="/"&&(a.path=""+g.path+a.path),!xn.REQUIRE_ACCESS_TOKEN)return eo(a);if(!(s=s||xn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+c);if(s[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+c);return a.params=a.params.filter(function(A){return A.indexOf("access_token")===-1}),a.params.push("access_token="+s),eo(a)};var Yn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function bi(a){return Yn.test(a)}var Ms=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ha(a){var s=a.match(Ms);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function eo(a){var s=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+s}function Rt(a){if(!a)return null;var s=a.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(decodeURIComponent(Ae.atob(s[1]).split("").map(function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(c){return null}}var be=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};be.prototype.getStorageKey=function(a){var s,c=Rt(xn.ACCESS_TOKEN);return s=c&&c.u?Ae.btoa(encodeURIComponent(c.u).replace(/%([0-9A-F]{2})/g,function(g,b){return String.fromCharCode(Number("0x"+b))})):xn.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+s:"mapbox.eventData:"+s},be.prototype.fetchEventData=function(){var a=de("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(a)try{var g=Ae.localStorage.getItem(s);g&&(this.eventData=JSON.parse(g));var b=Ae.localStorage.getItem(c);b&&(this.anonId=b)}catch(A){Ct("Unable to read from LocalStorage")}},be.prototype.saveEventData=function(){var a=de("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(a)try{Ae.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&Ae.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(g){Ct("Unable to write to LocalStorage")}},be.prototype.processRequests=function(a){},be.prototype.postEvent=function(a,s,c,g){var b=this;if(xn.EVENTS_URL){var A=Ha(xn.EVENTS_URL);A.params.push("access_token="+(g||xn.ACCESS_TOKEN||""));var T={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:ua,userId:this.anonId},O=s?jt(T,s):T,z={url:eo(A),headers:{"Content-Type":"text/plain"},body:JSON.stringify([O])};this.pendingRequest=La(z,function($){b.pendingRequest=null,c($),b.saveEventData(),b.processRequests(g)})}},be.prototype.queueRequest=function(a,s){this.queue.push(a),this.processRequests(s)};var ce,Me,j=function(a){function s(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postMapLoadEvent=function(c,g,b,A){this.skuToken=b;var T=!(!A&&!xn.ACCESS_TOKEN),O=Array.isArray(c)&&c.some(function(z){return Bi(z)||bi(z)});xn.EVENTS_URL&&T&&O&&this.queueRequest({id:g,timestamp:Date.now()},A)},s.prototype.processRequests=function(c){var g=this;if(!this.pendingRequest&&this.queue.length!==0){var b=this.queue.shift(),A=b.id,T=b.timestamp;A&&this.success[A]||(this.anonId||this.fetchEventData(),Pt(this.anonId)||(this.anonId=Dt()),this.postEvent(T,{skuToken:this.skuToken},function(O){O||A&&(g.success[A]=!0)},c))}},s}(be),ut=new(function(a){function s(c){a.call(this,"appUserTurnstile"),this._customAccessToken=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postTurnstileEvent=function(c,g){xn.EVENTS_URL&&xn.ACCESS_TOKEN&&Array.isArray(c)&&c.some(function(b){return Bi(b)||bi(b)})&&this.queueRequest(Date.now(),g)},s.prototype.processRequests=function(c){var g=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var b=Rt(xn.ACCESS_TOKEN),A=b?b.u:xn.ACCESS_TOKEN,T=A!==this.eventData.tokenU;Pt(this.anonId)||(this.anonId=Dt(),T=!0);var O=this.queue.shift();if(this.eventData.lastSuccess){var z=new Date(this.eventData.lastSuccess),$=new Date(O),Q=(O-this.eventData.lastSuccess)/864e5;T=T||Q>=1||Q<-1||z.getDate()!==$.getDate()}else T=!0;if(!T)return this.processRequests();this.postEvent(O,{"enabled.telemetry":!1},function(re){re||(g.eventData.lastSuccess=O,g.eventData.tokenU=A)},c)}},s}(be)),ir=ut.postTurnstileEvent.bind(ut),Jr=new j,nt=Jr.postMapLoadEvent.bind(Jr),Bt=500,Ar=50;function zr(){Ae.caches&&!ce&&(ce=Ae.caches.open("mapbox-tiles"))}function un(a){var s=a.indexOf("?");return s<0?a:a.slice(0,s)}var vn,ui=1/0;function Jn(){return vn==null&&(vn=Ae.OffscreenCanvas&&new Ae.OffscreenCanvas(1,1).getContext("2d")&&typeof Ae.createImageBitmap=="function"),vn}var mn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(mn);var Ri=function(a){function s(c,g,b){g===401&&bi(b)&&(c+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,c),this.status=g,this.url=b,this.name=this.constructor.name,this.message=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},s}(Error),Si=oe()?function(){return self.worker&&self.worker.referrer}:function(){return(Ae.location.protocol==="blob:"?Ae.parent:Ae).location.href},Wa,uo,Io=function(a,s){if(!(/^file:/.test(c=a.url)||/^file:/.test(Si())&&!/^\w+:/.test(c))){if(Ae.fetch&&Ae.Request&&Ae.AbortController&&Ae.Request.prototype.hasOwnProperty("signal"))return function(g,b){var A,T=new Ae.AbortController,O=new Ae.Request(g.url,{method:g.method||"GET",body:g.body,credentials:g.credentials,headers:g.headers,referrer:Si(),signal:T.signal}),z=!1,$=!1,Q=(A=O.url).indexOf("sku=")>0&&bi(A);g.type==="json"&&O.headers.set("Accept","application/json");var re=function(Ee,$e,qe){if(!$){if(Ee&&Ee.message!=="SecurityError"&&Ct(Ee),$e&&qe)return me($e);var bt=Date.now();Ae.fetch(O).then(function(st){if(st.ok){var Nt=Q?st.clone():null;return me(st,Nt,bt)}return b(new Ri(st.statusText,st.status,g.url))}).catch(function(st){st.code!==20&&b(new Error(st.message))})}},me=function(Ee,$e,qe){(g.type==="arrayBuffer"?Ee.arrayBuffer():g.type==="json"?Ee.json():Ee.text()).then(function(bt){$||($e&&qe&&function(st,Nt,er){if(zr(),ce){var _r={status:Nt.status,statusText:Nt.statusText,headers:new Ae.Headers};Nt.headers.forEach(function(Br,dn){return _r.headers.set(dn,Br)});var Er=Ue(Nt.headers.get("Cache-Control")||"");Er["no-store"]||(Er["max-age"]&&_r.headers.set("Expires",new Date(er+1e3*Er["max-age"]).toUTCString()),new Date(_r.headers.get("Expires")).getTime()-er<42e4||function(Br,dn){if(Me===void 0)try{new Response(new ReadableStream),Me=!0}catch(Ln){Me=!1}Me?dn(Br.body):Br.blob().then(dn)}(Nt,function(Br){var dn=new Ae.Response(Br,_r);zr(),ce&&ce.then(function(Ln){return Ln.put(un(st.url),dn)}).catch(function(Ln){return Ct(Ln.message)})}))}}(O,$e,qe),z=!0,b(null,bt,Ee.headers.get("Cache-Control"),Ee.headers.get("Expires")))}).catch(function(bt){$||b(new Error(bt.message))})};return Q?function(Ee,$e){if(zr(),!ce)return $e(null);var qe=un(Ee.url);ce.then(function(bt){bt.match(qe).then(function(st){var Nt=function(er){if(!er)return!1;var _r=new Date(er.headers.get("Expires")||0),Er=Ue(er.headers.get("Cache-Control")||"");return _r>Date.now()&&!Er["no-cache"]}(st);bt.delete(qe),Nt&&bt.put(qe,st.clone()),$e(null,st,Nt)}).catch($e)}).catch($e)}(O,re):re(null,null),{cancel:function(){$=!0,z||T.abort()}}}(a,s);if(oe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,s,void 0,!0)}var c;return function(g,b){var A=new Ae.XMLHttpRequest;for(var T in A.open(g.method||"GET",g.url,!0),g.type==="arrayBuffer"&&(A.responseType="arraybuffer"),g.headers)A.setRequestHeader(T,g.headers[T]);return g.type==="json"&&(A.responseType="text",A.setRequestHeader("Accept","application/json")),A.withCredentials=g.credentials==="include",A.onerror=function(){b(new Error(A.statusText))},A.onload=function(){if((A.status>=200&&A.status<300||A.status===0)&&A.response!==null){var O=A.response;if(g.type==="json")try{O=JSON.parse(A.response)}catch(z){return b(z)}b(null,O,A.getResponseHeader("Cache-Control"),A.getResponseHeader("Expires"))}else b(new Ri(A.statusText,A.status,g.url))},A.send(g.body),{cancel:function(){return A.abort()}}}(a,s)},to=function(a,s){return Io(jt(a,{type:"arrayBuffer"}),s)},La=function(a,s){return Io(jt(a,{method:"POST"}),s)},te="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Wa=[],uo=0;var le=function(a,s){if(ii.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),uo>=xn.MAX_PARALLEL_IMAGE_REQUESTS){var c={requestParameters:a,callback:s,cancelled:!1,cancel:function(){this.cancelled=!0}};return Wa.push(c),c}uo++;var g=!1,b=function(){if(!g)for(g=!0,uo--;Wa.length&&uo<xn.MAX_PARALLEL_IMAGE_REQUESTS;){var T=Wa.shift();T.cancelled||(T.cancel=le(T.requestParameters,T.callback).cancel)}},A=to(a,function(T,O,z,$){b(),T?s(T):O&&(Jn()?function(Q,re){var me=new Ae.Blob([new Uint8Array(Q)],{type:"image/png"});Ae.createImageBitmap(me).then(function(Ee){re(null,Ee)}).catch(function(Ee){re(new Error("Could not load image because of "+Ee.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(O,s):function(Q,re,me,Ee){var $e=new Ae.Image,qe=Ae.URL;$e.onload=function(){re(null,$e),qe.revokeObjectURL($e.src),$e.onload=null,Ae.requestAnimationFrame(function(){$e.src=te})},$e.onerror=function(){return re(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var bt=new Ae.Blob([new Uint8Array(Q)],{type:"image/png"});$e.cacheControl=me,$e.expires=Ee,$e.src=Q.byteLength?qe.createObjectURL(bt):te}(O,s,z,$))});return{cancel:function(){A.cancel(),b()}}};function ye(a,s,c){c[a]&&c[a].indexOf(s)!==-1||(c[a]=c[a]||[],c[a].push(s))}function Re(a,s,c){if(c&&c[a]){var g=c[a].indexOf(s);g!==-1&&c[a].splice(g,1)}}var He=function(a,s){s===void 0&&(s={}),jt(this,s),this.type=a},ht=function(a){function s(c,g){g===void 0&&(g={}),a.call(this,"error",jt({error:c},g))}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(He),At=function(){};At.prototype.on=function(a,s){return this._listeners=this._listeners||{},ye(a,s,this._listeners),this},At.prototype.off=function(a,s){return Re(a,s,this._listeners),Re(a,s,this._oneTimeListeners),this},At.prototype.once=function(a,s){return this._oneTimeListeners=this._oneTimeListeners||{},ye(a,s,this._oneTimeListeners),this},At.prototype.fire=function(a,s){typeof a=="string"&&(a=new He(a,s||{}));var c=a.type;if(this.listens(c)){a.target=this;for(var g=0,b=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];g<b.length;g+=1)b[g].call(this,a);for(var A=0,T=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];A<T.length;A+=1){var O=T[A];Re(c,O,this._oneTimeListeners),O.call(this,a)}var z=this._eventedParent;z&&(jt(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),z.fire(a))}else a instanceof ht&&console.error(a.error);return this},At.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},At.prototype.setEventedParent=function(a,s){return this._eventedParent=a,this._eventedParentData=s,this};var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Je=function(a,s,c,g){this.message=(a?a+": ":"")+c,g&&(this.identifier=g),s!=null&&s.__line__&&(this.line=s.__line__)};function Xt(a){var s=a.value;return s?[new Je(a.key,s,"constants have been deprecated as of v8")]:[]}function Wr(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];for(var g=0,b=s;g<b.length;g+=1){var A=b[g];for(var T in A)a[T]=A[T]}return a}function cr(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function dr(a){if(Array.isArray(a))return a.map(dr);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var s={};for(var c in a)s[c]=dr(a[c]);return s}return cr(a)}var jr=function(a){function s(c,g){a.call(this,g),this.message=g,this.key=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Error),qn=function(a,s){s===void 0&&(s=[]),this.parent=a,this.bindings={};for(var c=0,g=s;c<g.length;c+=1){var b=g[c];this.bindings[b[0]]=b[1]}};qn.prototype.concat=function(a){return new qn(this,a)},qn.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},qn.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var Un={kind:"null"},ar={kind:"number"},ot={kind:"string"},Cn={kind:"boolean"},se={kind:"color"},Yi={kind:"object"},Fn={kind:"value"},ta={kind:"collator"},$a={kind:"formatted"},ra={kind:"resolvedImage"};function pa(a,s){return{kind:"array",itemType:a,N:s}}function Xi(a){if(a.kind==="array"){var s=Xi(a.itemType);return typeof a.N=="number"?"array<"+s+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+s+">"}return a.kind}var Ui=[Un,ar,ot,Cn,se,$a,Yi,pa(Fn),ra];function ma(a,s){if(s.kind==="error")return null;if(a.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!ma(a.itemType,s.itemType))&&(typeof a.N!="number"||a.N===s.N))return null}else{if(a.kind===s.kind)return null;if(a.kind==="value"){for(var c=0,g=Ui;c<g.length;c+=1)if(!ma(g[c],s))return null}}return"Expected "+Xi(a)+" but found "+Xi(s)+" instead."}function bo(a,s){return s.some(function(c){return c.kind===a.kind})}function Za(a,s){return s.some(function(c){return c==="null"?a===null:c==="array"?Array.isArray(a):c==="object"?a&&!Array.isArray(a)&&typeof a=="object":c===typeof a})}var fa=Pe(function(a,s){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function g(O){return(O=Math.round(O))<0?0:O>255?255:O}function b(O){return g(O[O.length-1]==="%"?parseFloat(O)/100*255:parseInt(O))}function A(O){return(z=O[O.length-1]==="%"?parseFloat(O)/100:parseFloat(O))<0?0:z>1?1:z;var z}function T(O,z,$){return $<0?$+=1:$>1&&($-=1),6*$<1?O+(z-O)*$*6:2*$<1?z:3*$<2?O+(z-O)*(2/3-$)*6:O}try{s.parseCSSColor=function(O){var z,$=O.replace(/ /g,"").toLowerCase();if($ in c)return c[$].slice();if($[0]==="#")return $.length===4?(z=parseInt($.substr(1),16))>=0&&z<=4095?[(3840&z)>>4|(3840&z)>>8,240&z|(240&z)>>4,15&z|(15&z)<<4,1]:null:$.length===7&&(z=parseInt($.substr(1),16))>=0&&z<=16777215?[(16711680&z)>>16,(65280&z)>>8,255&z,1]:null;var Q=$.indexOf("("),re=$.indexOf(")");if(Q!==-1&&re+1===$.length){var me=$.substr(0,Q),Ee=$.substr(Q+1,re-(Q+1)).split(","),$e=1;switch(me){case"rgba":if(Ee.length!==4)return null;$e=A(Ee.pop());case"rgb":return Ee.length!==3?null:[b(Ee[0]),b(Ee[1]),b(Ee[2]),$e];case"hsla":if(Ee.length!==4)return null;$e=A(Ee.pop());case"hsl":if(Ee.length!==3)return null;var qe=(parseFloat(Ee[0])%360+360)%360/360,bt=A(Ee[1]),st=A(Ee[2]),Nt=st<=.5?st*(bt+1):st+bt-st*bt,er=2*st-Nt;return[g(255*T(er,Nt,qe+1/3)),g(255*T(er,Nt,qe)),g(255*T(er,Nt,qe-1/3)),$e];default:return null}}return null}}catch(O){}}).parseCSSColor,na=function(a,s,c,g){g===void 0&&(g=1),this.r=a,this.g=s,this.b=c,this.a=g};na.parse=function(a){if(a){if(a instanceof na)return a;if(typeof a=="string"){var s=fa(a);if(s)return new na(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3])}}},na.prototype.toString=function(){var a=this.toArray(),s=a[1],c=a[2],g=a[3];return"rgba("+Math.round(a[0])+","+Math.round(s)+","+Math.round(c)+","+g+")"},na.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},na.black=new na(0,0,0,1),na.white=new na(1,1,1,1),na.transparent=new na(0,0,0,0),na.red=new na(1,0,0,1);var To=function(a,s,c){this.sensitivity=a?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};To.prototype.compare=function(a,s){return this.collator.compare(a,s)},To.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Ou=function(a,s,c,g,b){this.text=a,this.image=s,this.scale=c,this.fontStack=g,this.textColor=b},ko=function(a){this.sections=a};ko.fromString=function(a){return new ko([new Ou(a,null,null,null,null)])},ko.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},ko.factory=function(a){return a instanceof ko?a:ko.fromString(a)},ko.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},ko.prototype.serialize=function(){for(var a=["format"],s=0,c=this.sections;s<c.length;s+=1){var g=c[s];if(g.image)a.push(["image",g.image.name]);else{a.push(g.text);var b={};g.fontStack&&(b["text-font"]=["literal",g.fontStack.split(",")]),g.scale&&(b["font-scale"]=g.scale),g.textColor&&(b["text-color"]=["rgba"].concat(g.textColor.toArray())),a.push(b)}}return a};var ao=function(a){this.name=a.name,this.available=a.available};function iu(a,s,c,g){return typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof c=="number"&&c>=0&&c<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:"Invalid rgba value ["+[a,s,c,g].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof g=="number"?[a,s,c,g]:[a,s,c]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function au(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof na||a instanceof To||a instanceof ko||a instanceof ao)return!0;if(Array.isArray(a)){for(var s=0,c=a;s<c.length;s+=1)if(!au(c[s]))return!1;return!0}if(typeof a=="object"){for(var g in a)if(!au(a[g]))return!1;return!0}return!1}function Ua(a){if(a===null)return Un;if(typeof a=="string")return ot;if(typeof a=="boolean")return Cn;if(typeof a=="number")return ar;if(a instanceof na)return se;if(a instanceof To)return ta;if(a instanceof ko)return $a;if(a instanceof ao)return ra;if(Array.isArray(a)){for(var s,c=a.length,g=0,b=a;g<b.length;g+=1){var A=Ua(b[g]);if(s){if(s===A)continue;s=Fn;break}s=A}return pa(s||Fn,c)}return Yi}function zl(a){var s=typeof a;return a===null?"":s==="string"||s==="number"||s==="boolean"?String(a):a instanceof na||a instanceof ko||a instanceof ao?a.toString():JSON.stringify(a)}ao.prototype.toString=function(){return this.name},ao.fromString=function(a){return a?new ao({name:a,available:!1}):null},ao.prototype.serialize=function(){return["image",this.name]};var Xo=function(a,s){this.type=a,this.value=s};Xo.parse=function(a,s){if(a.length!==2)return s.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!au(a[1]))return s.error("invalid value");var c=a[1],g=Ua(c),b=s.expectedType;return g.kind!=="array"||g.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(g=b),new Xo(g,c)},Xo.prototype.evaluate=function(){return this.value},Xo.prototype.eachChild=function(){},Xo.prototype.outputDefined=function(){return!0},Xo.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof na?["rgba"].concat(this.value.toArray()):this.value instanceof ko?this.value.serialize():this.value};var Eo=function(a){this.name="ExpressionEvaluationError",this.message=a};Eo.prototype.toJSON=function(){return this.message};var jo={string:ot,number:ar,boolean:Cn,object:Yi},Va=function(a,s){this.type=a,this.args=s};Va.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c,g=1,b=a[0];if(b==="array"){var A,T;if(a.length>2){var O=a[1];if(typeof O!="string"||!(O in jo)||O==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);A=jo[O],g++}else A=Fn;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=a[2],g++}c=pa(A,T)}else c=jo[b];for(var z=[];g<a.length;g++){var $=s.parse(a[g],g,Fn);if(!$)return null;z.push($)}return new Va(c,z)},Va.prototype.evaluate=function(a){for(var s=0;s<this.args.length;s++){var c=this.args[s].evaluate(a);if(!ma(this.type,Ua(c)))return c;if(s===this.args.length-1)throw new Eo("Expected value to be of type "+Xi(this.type)+", but found "+Xi(Ua(c))+" instead.")}return null},Va.prototype.eachChild=function(a){this.args.forEach(a)},Va.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Va.prototype.serialize=function(){var a=this.type,s=[a.kind];if(a.kind==="array"){var c=a.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);var g=a.N;(typeof g=="number"||this.args.length>1)&&s.push(g)}}return s.concat(this.args.map(function(b){return b.serialize()}))};var vs=function(a){this.type=$a,this.sections=a};vs.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c=a[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");for(var g=[],b=!1,A=1;A<=a.length-1;++A){var T=a[A];if(b&&typeof T=="object"&&!Array.isArray(T)){b=!1;var O=null;if(T["font-scale"]&&!(O=s.parse(T["font-scale"],1,ar)))return null;var z=null;if(T["text-font"]&&!(z=s.parse(T["text-font"],1,pa(ot))))return null;var $=null;if(T["text-color"]&&!($=s.parse(T["text-color"],1,se)))return null;var Q=g[g.length-1];Q.scale=O,Q.font=z,Q.textColor=$}else{var re=s.parse(a[A],1,Fn);if(!re)return null;var me=re.type.kind;if(me!=="string"&&me!=="value"&&me!=="null"&&me!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,g.push({content:re,scale:null,font:null,textColor:null})}}return new vs(g)},vs.prototype.evaluate=function(a){return new ko(this.sections.map(function(s){var c=s.content.evaluate(a);return Ua(c)===ra?new Ou("",c,null,null,null):new Ou(zl(c),null,s.scale?s.scale.evaluate(a):null,s.font?s.font.evaluate(a).join(","):null,s.textColor?s.textColor.evaluate(a):null)}))},vs.prototype.eachChild=function(a){for(var s=0,c=this.sections;s<c.length;s+=1){var g=c[s];a(g.content),g.scale&&a(g.scale),g.font&&a(g.font),g.textColor&&a(g.textColor)}},vs.prototype.outputDefined=function(){return!1},vs.prototype.serialize=function(){for(var a=["format"],s=0,c=this.sections;s<c.length;s+=1){var g=c[s];a.push(g.content.serialize());var b={};g.scale&&(b["font-scale"]=g.scale.serialize()),g.font&&(b["text-font"]=g.font.serialize()),g.textColor&&(b["text-color"]=g.textColor.serialize()),a.push(b)}return a};var Hs=function(a){this.type=ra,this.input=a};Hs.parse=function(a,s){if(a.length!==2)return s.error("Expected two arguments.");var c=s.parse(a[1],1,ot);return c?new Hs(c):s.error("No image name provided.")},Hs.prototype.evaluate=function(a){var s=this.input.evaluate(a),c=ao.fromString(s);return c&&a.availableImages&&(c.available=a.availableImages.indexOf(s)>-1),c},Hs.prototype.eachChild=function(a){a(this.input)},Hs.prototype.outputDefined=function(){return!1},Hs.prototype.serialize=function(){return["image",this.input.serialize()]};var Ml={"to-boolean":Cn,"to-color":se,"to-number":ar,"to-string":ot},ms=function(a,s){this.type=a,this.args=s};ms.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c=a[0];if((c==="to-boolean"||c==="to-string")&&a.length!==2)return s.error("Expected one argument.");for(var g=Ml[c],b=[],A=1;A<a.length;A++){var T=s.parse(a[A],A,Fn);if(!T)return null;b.push(T)}return new ms(g,b)},ms.prototype.evaluate=function(a){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(a));if(this.type.kind==="color"){for(var s,c,g=0,b=this.args;g<b.length;g+=1){if(c=null,(s=b[g].evaluate(a))instanceof na)return s;if(typeof s=="string"){var A=a.parseColor(s);if(A)return A}else if(Array.isArray(s)&&!(c=s.length<3||s.length>4?"Invalid rbga value "+JSON.stringify(s)+": expected an array containing either three or four numeric values.":iu(s[0],s[1],s[2],s[3])))return new na(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Eo(c||"Could not parse color from value '"+(typeof s=="string"?s:String(JSON.stringify(s)))+"'")}if(this.type.kind==="number"){for(var T=null,O=0,z=this.args;O<z.length;O+=1){if((T=z[O].evaluate(a))===null)return 0;var $=Number(T);if(!isNaN($))return $}throw new Eo("Could not convert "+JSON.stringify(T)+" to number.")}return this.type.kind==="formatted"?ko.fromString(zl(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?ao.fromString(zl(this.args[0].evaluate(a))):zl(this.args[0].evaluate(a))},ms.prototype.eachChild=function(a){this.args.forEach(a)},ms.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},ms.prototype.serialize=function(){if(this.type.kind==="formatted")return new vs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Hs(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(s){a.push(s.serialize())}),a};var Bs=["Unknown","Point","LineString","Polygon"],Da=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Da.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Da.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Bs[this.feature.type]:this.feature.type:null},Da.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Da.prototype.canonicalID=function(){return this.canonical},Da.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Da.prototype.parseColor=function(a){var s=this._parseColorCache[a];return s||(s=this._parseColorCache[a]=na.parse(a)),s};var $o=function(a,s,c,g){this.name=a,this.type=s,this._evaluate=c,this.args=g};$o.prototype.evaluate=function(a){return this._evaluate(a,this.args)},$o.prototype.eachChild=function(a){this.args.forEach(a)},$o.prototype.outputDefined=function(){return!1},$o.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},$o.parse=function(a,s){var c,g=a[0],b=$o.definitions[g];if(!b)return s.error('Unknown expression "'+g+'". If you wanted a literal array, use ["literal", [...]].',0);for(var A=Array.isArray(b)?b[0]:b.type,T=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,O=T.filter(function(Ai){var Wn=Ai[0];return!Array.isArray(Wn)||Wn.length===a.length-1}),z=null,$=0,Q=O;$<Q.length;$+=1){var re=Q[$],me=re[0],Ee=re[1];z=new _u(s.registry,s.path,null,s.scope);for(var $e=[],qe=!1,bt=1;bt<a.length;bt++){var st=a[bt],Nt=Array.isArray(me)?me[bt-1]:me.type,er=z.parse(st,1+$e.length,Nt);if(!er){qe=!0;break}$e.push(er)}if(!qe)if(Array.isArray(me)&&me.length!==$e.length)z.error("Expected "+me.length+" arguments, but found "+$e.length+" instead.");else{for(var _r=0;_r<$e.length;_r++){var Er=Array.isArray(me)?me[_r]:me.type,Br=$e[_r];z.concat(_r+1).checkSubtype(Er,Br.type)}if(z.errors.length===0)return new $o(g,A,Ee,$e)}}if(O.length===1)(c=s.errors).push.apply(c,z.errors);else{for(var dn=(O.length?O:T).map(function(Ai){var Wn;return Wn=Ai[0],Array.isArray(Wn)?"("+Wn.map(Xi).join(", ")+")":"("+Xi(Wn.type)+"...)"}).join(" | "),Ln=[],xi=1;xi<a.length;xi++){var jn=s.parse(a[xi],1+Ln.length);if(!jn)return null;Ln.push(Xi(jn.type))}s.error("Expected arguments of type "+dn+", but found ("+Ln.join(", ")+") instead.")}return null},$o.register=function(a,s){for(var c in $o.definitions=s,s)a[c]=$o};var Ys=function(a,s,c){this.type=ta,this.locale=c,this.caseSensitive=a,this.diacriticSensitive=s};function Ht(a,s){a[0]=Math.min(a[0],s[0]),a[1]=Math.min(a[1],s[1]),a[2]=Math.max(a[2],s[0]),a[3]=Math.max(a[3],s[1])}function tr(a,s){return!(a[0]<=s[0]||a[2]>=s[2]||a[1]<=s[1]||a[3]>=s[3])}function J(a,s){var c=(180+a[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,b=Math.pow(2,s.z);return[Math.round(c*b*8192),Math.round(g*b*8192)]}function Cu(a,s,c){return s[1]>a[1]!=c[1]>a[1]&&a[0]<(c[0]-s[0])*(a[1]-s[1])/(c[1]-s[1])+s[0]}function _e(a,s){for(var c,g,b,A,T,O,z,$=!1,Q=0,re=s.length;Q<re;Q++)for(var me=s[Q],Ee=0,$e=me.length;Ee<$e-1;Ee++){if((A=(c=a)[0]-(g=me[Ee])[0])*(z=c[1]-(b=me[Ee+1])[1])-(O=c[0]-b[0])*(T=c[1]-g[1])==0&&A*O<=0&&T*z<=0)return!1;Cu(a,me[Ee],me[Ee+1])&&($=!$)}return $}function Ne(a,s){for(var c=0;c<s.length;c++)if(_e(a,s[c]))return!0;return!1}function wt(a,s,c,g){var b=g[0]-c[0],A=g[1]-c[1],T=(a[0]-c[0])*A-b*(a[1]-c[1]),O=(s[0]-c[0])*A-b*(s[1]-c[1]);return T>0&&O<0||T<0&&O>0}function ur(a,s,c){for(var g=0,b=c;g<b.length;g+=1)for(var A=b[g],T=0;T<A.length-1;++T)if((re=[(Q=A[T+1])[0]-($=A[T])[0],Q[1]-$[1]])[0]*(me=[(z=s)[0]-(O=a)[0],z[1]-O[1]])[1]-re[1]*me[0]!=0&&wt(O,z,$,Q)&&wt($,Q,O,z))return!0;var O,z,$,Q,re,me;return!1}function gn(a,s){for(var c=0;c<a.length;++c)if(!_e(a[c],s))return!1;for(var g=0;g<a.length-1;++g)if(ur(a[g],a[g+1],s))return!1;return!0}function li(a,s){for(var c=0;c<s.length;c++)if(gn(a,s[c]))return!0;return!1}function da(a,s,c){for(var g=[],b=0;b<a.length;b++){for(var A=[],T=0;T<a[b].length;T++){var O=J(a[b][T],c);Ht(s,O),A.push(O)}g.push(A)}return g}function es(a,s,c){for(var g=[],b=0;b<a.length;b++){var A=da(a[b],s,c);g.push(A)}return g}function Fr(a,s,c,g){if(a[0]<c[0]||a[0]>c[2]){var b=.5*g,A=a[0]-c[0]>b?-g:c[0]-a[0]>b?g:0;A===0&&(A=a[0]-c[2]>b?-g:c[2]-a[0]>b?g:0),a[0]+=A}Ht(s,a)}function Nr(a,s,c,g){for(var b=8192*Math.pow(2,g.z),A=[8192*g.x,8192*g.y],T=[],O=0,z=a;O<z.length;O+=1)for(var $=0,Q=z[O];$<Q.length;$+=1){var re=Q[$],me=[re.x+A[0],re.y+A[1]];Fr(me,s,c,b),T.push(me)}return T}function it(a,s,c,g){for(var b,A=8192*Math.pow(2,g.z),T=[8192*g.x,8192*g.y],O=[],z=0,$=a;z<$.length;z+=1){for(var Q=[],re=0,me=$[z];re<me.length;re+=1){var Ee=me[re],$e=[Ee.x+T[0],Ee.y+T[1]];Ht(s,$e),Q.push($e)}O.push(Q)}if(s[2]-s[0]<=A/2){(b=s)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(var qe=0,bt=O;qe<bt.length;qe+=1)for(var st=0,Nt=bt[qe];st<Nt.length;st+=1)Fr(Nt[st],s,c,A)}return O}Ys.parse=function(a,s){if(a.length!==2)return s.error("Expected one argument.");var c=a[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");var g=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Cn);if(!g)return null;var b=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Cn);if(!b)return null;var A=null;return c.locale&&!(A=s.parse(c.locale,1,ot))?null:new Ys(g,b,A)},Ys.prototype.evaluate=function(a){return new To(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},Ys.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},Ys.prototype.outputDefined=function(){return!1},Ys.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var gu=function(a,s){this.type=Cn,this.geojson=a,this.geometries=s};function qs(a){if(a instanceof $o&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof gu)return!1;var s=!0;return a.eachChild(function(c){s&&!qs(c)&&(s=!1)}),s}function Tu(a){if(a instanceof $o&&a.name==="feature-state")return!1;var s=!0;return a.eachChild(function(c){s&&!Tu(c)&&(s=!1)}),s}function Ns(a,s){if(a instanceof $o&&s.indexOf(a.name)>=0)return!1;var c=!0;return a.eachChild(function(g){c&&!Ns(g,s)&&(c=!1)}),c}gu.parse=function(a,s){if(a.length!==2)return s.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(au(a[1])){var c=a[1];if(c.type==="FeatureCollection")for(var g=0;g<c.features.length;++g){var b=c.features[g].geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new gu(c,c.features[g].geometry)}else if(c.type==="Feature"){var A=c.geometry.type;if(A==="Polygon"||A==="MultiPolygon")return new gu(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new gu(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")},gu.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(s,c){var g=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],A=s.canonicalID();if(c.type==="Polygon"){var T=da(c.coordinates,b,A),O=Nr(s.geometry(),g,b,A);if(!tr(g,b))return!1;for(var z=0,$=O;z<$.length;z+=1)if(!_e($[z],T))return!1}if(c.type==="MultiPolygon"){var Q=es(c.coordinates,b,A),re=Nr(s.geometry(),g,b,A);if(!tr(g,b))return!1;for(var me=0,Ee=re;me<Ee.length;me+=1)if(!Ne(Ee[me],Q))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(s,c){var g=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],A=s.canonicalID();if(c.type==="Polygon"){var T=da(c.coordinates,b,A),O=it(s.geometry(),g,b,A);if(!tr(g,b))return!1;for(var z=0,$=O;z<$.length;z+=1)if(!gn($[z],T))return!1}if(c.type==="MultiPolygon"){var Q=es(c.coordinates,b,A),re=it(s.geometry(),g,b,A);if(!tr(g,b))return!1;for(var me=0,Ee=re;me<Ee.length;me+=1)if(!li(Ee[me],Q))return!1}return!0}(a,this.geometries)}return!1},gu.prototype.eachChild=function(){},gu.prototype.outputDefined=function(){return!0},gu.prototype.serialize=function(){return["within",this.geojson]};var yu=function(a,s){this.type=s.type,this.name=a,this.boundExpression=s};yu.parse=function(a,s){if(a.length!==2||typeof a[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");var c=a[1];return s.scope.has(c)?new yu(c,s.scope.get(c)):s.error('Unknown variable "'+c+'". Make sure "'+c+'" has been bound in an enclosing "let" expression before using it.',1)},yu.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},yu.prototype.eachChild=function(){},yu.prototype.outputDefined=function(){return!1},yu.prototype.serialize=function(){return["var",this.name]};var _u=function(a,s,c,g,b){s===void 0&&(s=[]),g===void 0&&(g=new qn),b===void 0&&(b=[]),this.registry=a,this.path=s,this.key=s.map(function(A){return"["+A+"]"}).join(""),this.scope=g,this.errors=b,this.expectedType=c};function Ju(a,s){for(var c,g=a.length-1,b=0,A=g,T=0;b<=A;)if((c=a[T=Math.floor((b+A)/2)])<=s){if(T===g||s<a[T+1])return T;b=T+1}else{if(!(c>s))throw new Eo("Input is not a number.");A=T-1}return 0}_u.prototype.parse=function(a,s,c,g,b){return b===void 0&&(b={}),s?this.concat(s,c,g)._parse(a,b):this._parse(a,b)},_u.prototype._parse=function(a,s){function c($,Q,re){return re==="assert"?new Va(Q,[$]):re==="coerce"?new ms(Q,[$]):$}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var g=a[0];if(typeof g!="string")return this.error("Expression name must be a string, but found "+typeof g+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var b=this.registry[g];if(b){var A=b.parse(a,this);if(!A)return null;if(this.expectedType){var T=this.expectedType,O=A.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||O.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||O.kind!=="value"&&O.kind!=="string"){if(this.checkSubtype(T,O))return null}else A=c(A,T,s.typeAnnotation||"coerce");else A=c(A,T,s.typeAnnotation||"assert")}if(!(A instanceof Xo)&&A.type.kind!=="resolvedImage"&&function $(Q){if(Q instanceof yu)return $(Q.boundExpression);if(Q instanceof $o&&Q.name==="error"||Q instanceof Ys||Q instanceof gu)return!1;var re=Q instanceof ms||Q instanceof Va,me=!0;return Q.eachChild(function(Ee){me=re?me&&$(Ee):me&&Ee instanceof Xo}),!!me&&qs(Q)&&Ns(Q,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(A)){var z=new Da;try{A=new Xo(A.type,A.evaluate(z))}catch($){return this.error($.message),null}}return A}return this.error('Unknown expression "'+g+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},_u.prototype.concat=function(a,s,c){var g=typeof a=="number"?this.path.concat(a):this.path,b=c?this.scope.concat(c):this.scope;return new _u(this.registry,g,s||null,b,this.errors)},_u.prototype.error=function(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];var g=""+this.key+s.map(function(b){return"["+b+"]"}).join("");this.errors.push(new jr(g,a))},_u.prototype.checkSubtype=function(a,s){var c=ma(a,s);return c&&this.error(c),c};var Mu=function(a,s,c){this.type=a,this.input=s,this.labels=[],this.outputs=[];for(var g=0,b=c;g<b.length;g+=1){var A=b[g],T=A[1];this.labels.push(A[0]),this.outputs.push(T)}};function lo(a,s,c){return a*(1-c)+s*c}Mu.parse=function(a,s){if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");var c=s.parse(a[1],1,ar);if(!c)return null;var g=[],b=null;s.expectedType&&s.expectedType.kind!=="value"&&(b=s.expectedType);for(var A=1;A<a.length;A+=2){var T=A===1?-1/0:a[A],O=a[A+1],z=A,$=A+1;if(typeof T!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(g.length&&g[g.length-1][0]>=T)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);var Q=s.parse(O,$,b);if(!Q)return null;b=b||Q.type,g.push([T,Q])}return new Mu(b,c,g)},Mu.prototype.evaluate=function(a){var s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(a);var g=this.input.evaluate(a);if(g<=s[0])return c[0].evaluate(a);var b=s.length;return g>=s[b-1]?c[b-1].evaluate(a):c[Ju(s,g)].evaluate(a)},Mu.prototype.eachChild=function(a){a(this.input);for(var s=0,c=this.outputs;s<c.length;s+=1)a(c[s])},Mu.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Mu.prototype.serialize=function(){for(var a=["step",this.input.serialize()],s=0;s<this.labels.length;s++)s>0&&a.push(this.labels[s]),a.push(this.outputs[s].serialize());return a};var xa=Object.freeze({__proto__:null,number:lo,color:function(a,s,c){return new na(lo(a.r,s.r,c),lo(a.g,s.g,c),lo(a.b,s.b,c),lo(a.a,s.a,c))},array:function(a,s,c){return a.map(function(g,b){return lo(g,s[b],c)})}}),mo=6/29*3*(6/29),Wf=Math.PI/180,Ks=180/Math.PI;function Xf(a){return a>.008856451679035631?Math.pow(a,1/3):a/mo+4/29}function Jc(a){return a>6/29?a*a*a:mo*(a-4/29)}function Il(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Ke(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Rc(a){var s=Ke(a.r),c=Ke(a.g),g=Ke(a.b),b=Xf((.4124564*s+.3575761*c+.1804375*g)/.95047),A=Xf((.2126729*s+.7151522*c+.072175*g)/1);return{l:116*A-16,a:500*(b-A),b:200*(A-Xf((.0193339*s+.119192*c+.9503041*g)/1.08883)),alpha:a.a}}function S(a){var s=(a.l+16)/116,c=isNaN(a.a)?s:s+a.a/500,g=isNaN(a.b)?s:s-a.b/200;return s=1*Jc(s),c=.95047*Jc(c),g=1.08883*Jc(g),new na(Il(3.2404542*c-1.5371385*s-.4985314*g),Il(-.969266*c+1.8760108*s+.041556*g),Il(.0556434*c-.2040259*s+1.0572252*g),a.alpha)}function R(a,s,c){var g=s-a;return a+c*(g>180||g<-180?g-360*Math.round(g/360):g)}var W={forward:Rc,reverse:S,interpolate:function(a,s,c){return{l:lo(a.l,s.l,c),a:lo(a.a,s.a,c),b:lo(a.b,s.b,c),alpha:lo(a.alpha,s.alpha,c)}}},F={forward:function(a){var s=Rc(a),c=s.l,g=s.a,b=s.b,A=Math.atan2(b,g)*Ks;return{h:A<0?A+360:A,c:Math.sqrt(g*g+b*b),l:c,alpha:a.a}},reverse:function(a){var s=a.h*Wf,c=a.c;return S({l:a.l,a:Math.cos(s)*c,b:Math.sin(s)*c,alpha:a.alpha})},interpolate:function(a,s,c){return{h:R(a.h,s.h,c),c:lo(a.c,s.c,c),l:lo(a.l,s.l,c),alpha:lo(a.alpha,s.alpha,c)}}},ue=Object.freeze({__proto__:null,lab:W,hcl:F}),De=function(a,s,c,g,b){this.type=a,this.operator=s,this.interpolation=c,this.input=g,this.labels=[],this.outputs=[];for(var A=0,T=b;A<T.length;A+=1){var O=T[A],z=O[1];this.labels.push(O[0]),this.outputs.push(z)}};function ft(a,s,c,g){var b=g-c,A=a-c;return b===0?0:s===1?A/b:(Math.pow(s,A)-1)/(Math.pow(s,b)-1)}De.interpolationFactor=function(a,s,c,g){var b=0;if(a.name==="exponential")b=ft(s,a.base,c,g);else if(a.name==="linear")b=ft(s,1,c,g);else if(a.name==="cubic-bezier"){var A=a.controlPoints;b=new K(A[0],A[1],A[2],A[3]).solve(ft(s,1,c,g))}return b},De.parse=function(a,s){var c=a[0],g=a[1],b=a[2],A=a.slice(3);if(!Array.isArray(g)||g.length===0)return s.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){var T=g[1];if(typeof T!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:T}}else{if(g[0]!=="cubic-bezier")return s.error("Unknown interpolation type "+String(g[0]),1,0);var O=g.slice(1);if(O.length!==4||O.some(function(bt){return typeof bt!="number"||bt<0||bt>1}))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:O}}if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(!(b=s.parse(b,2,ar)))return null;var z=[],$=null;c==="interpolate-hcl"||c==="interpolate-lab"?$=se:s.expectedType&&s.expectedType.kind!=="value"&&($=s.expectedType);for(var Q=0;Q<A.length;Q+=2){var re=A[Q],me=A[Q+1],Ee=Q+3,$e=Q+4;if(typeof re!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Ee);if(z.length&&z[z.length-1][0]>=re)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Ee);var qe=s.parse(me,$e,$);if(!qe)return null;$=$||qe.type,z.push([re,qe])}return $.kind==="number"||$.kind==="color"||$.kind==="array"&&$.itemType.kind==="number"&&typeof $.N=="number"?new De($,c,g,b,z):s.error("Type "+Xi($)+" is not interpolatable.")},De.prototype.evaluate=function(a){var s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(a);var g=this.input.evaluate(a);if(g<=s[0])return c[0].evaluate(a);var b=s.length;if(g>=s[b-1])return c[b-1].evaluate(a);var A=Ju(s,g),T=De.interpolationFactor(this.interpolation,g,s[A],s[A+1]),O=c[A].evaluate(a),z=c[A+1].evaluate(a);return this.operator==="interpolate"?xa[this.type.kind.toLowerCase()](O,z,T):this.operator==="interpolate-hcl"?F.reverse(F.interpolate(F.forward(O),F.forward(z),T)):W.reverse(W.interpolate(W.forward(O),W.forward(z),T))},De.prototype.eachChild=function(a){a(this.input);for(var s=0,c=this.outputs;s<c.length;s+=1)a(c[s])},De.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},De.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var s=[this.operator,a,this.input.serialize()],c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s};var Gt=function(a,s){this.type=a,this.args=s};Gt.parse=function(a,s){if(a.length<2)return s.error("Expectected at least one argument.");var c=null,g=s.expectedType;g&&g.kind!=="value"&&(c=g);for(var b=[],A=0,T=a.slice(1);A<T.length;A+=1){var O=s.parse(T[A],1+b.length,c,void 0,{typeAnnotation:"omit"});if(!O)return null;c=c||O.type,b.push(O)}var z=g&&b.some(function($){return ma(g,$.type)});return new Gt(z?Fn:c,b)},Gt.prototype.evaluate=function(a){for(var s,c=null,g=0,b=0,A=this.args;b<A.length&&(g++,(c=A[b].evaluate(a))&&c instanceof ao&&!c.available&&(s||(s=c.name),c=null,g===this.args.length&&(c=s)),c===null);b+=1);return c},Gt.prototype.eachChild=function(a){this.args.forEach(a)},Gt.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Gt.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Wt=function(a,s){this.type=s.type,this.bindings=[].concat(a),this.result=s};Wt.prototype.evaluate=function(a){return this.result.evaluate(a)},Wt.prototype.eachChild=function(a){for(var s=0,c=this.bindings;s<c.length;s+=1)a(c[s][1]);a(this.result)},Wt.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var c=[],g=1;g<a.length-1;g+=2){var b=a[g];if(typeof b!="string")return s.error("Expected string, but found "+typeof b+" instead.",g);if(/[^a-zA-Z0-9_]/.test(b))return s.error("Variable names must contain only alphanumeric characters or '_'.",g);var A=s.parse(a[g+1],g+1);if(!A)return null;c.push([b,A])}var T=s.parse(a[a.length-1],a.length-1,s.expectedType,c);return T?new Wt(c,T):null},Wt.prototype.outputDefined=function(){return this.result.outputDefined()},Wt.prototype.serialize=function(){for(var a=["let"],s=0,c=this.bindings;s<c.length;s+=1){var g=c[s];a.push(g[0],g[1].serialize())}return a.push(this.result.serialize()),a};var Or=function(a,s,c){this.type=a,this.index=s,this.input=c};Or.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,ar),g=s.parse(a[2],2,pa(s.expectedType||Fn));return c&&g?new Or(g.type.itemType,c,g):null},Or.prototype.evaluate=function(a){var s=this.index.evaluate(a),c=this.input.evaluate(a);if(s<0)throw new Eo("Array index out of bounds: "+s+" < 0.");if(s>=c.length)throw new Eo("Array index out of bounds: "+s+" > "+(c.length-1)+".");if(s!==Math.floor(s))throw new Eo("Array index must be an integer, but found "+s+" instead.");return c[s]},Or.prototype.eachChild=function(a){a(this.index),a(this.input)},Or.prototype.outputDefined=function(){return!1},Or.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var en=function(a,s){this.type=Cn,this.needle=a,this.haystack=s};en.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,Fn),g=s.parse(a[2],2,Fn);return c&&g?bo(c.type,[Cn,ot,ar,Un,Fn])?new en(c,g):s.error("Expected first argument to be of type boolean, string, number or null, but found "+Xi(c.type)+" instead"):null},en.prototype.evaluate=function(a){var s=this.needle.evaluate(a),c=this.haystack.evaluate(a);if(!c)return!1;if(!Za(s,["boolean","string","number","null"]))throw new Eo("Expected first argument to be of type boolean, string, number or null, but found "+Xi(Ua(s))+" instead.");if(!Za(c,["string","array"]))throw new Eo("Expected second argument to be of type array or string, but found "+Xi(Ua(c))+" instead.");return c.indexOf(s)>=0},en.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},en.prototype.outputDefined=function(){return!0},en.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var ci=function(a,s,c){this.type=ar,this.needle=a,this.haystack=s,this.fromIndex=c};ci.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,Fn),g=s.parse(a[2],2,Fn);if(!c||!g)return null;if(!bo(c.type,[Cn,ot,ar,Un,Fn]))return s.error("Expected first argument to be of type boolean, string, number or null, but found "+Xi(c.type)+" instead");if(a.length===4){var b=s.parse(a[3],3,ar);return b?new ci(c,g,b):null}return new ci(c,g)},ci.prototype.evaluate=function(a){var s=this.needle.evaluate(a),c=this.haystack.evaluate(a);if(!Za(s,["boolean","string","number","null"]))throw new Eo("Expected first argument to be of type boolean, string, number or null, but found "+Xi(Ua(s))+" instead.");if(!Za(c,["string","array"]))throw new Eo("Expected second argument to be of type array or string, but found "+Xi(Ua(c))+" instead.");if(this.fromIndex){var g=this.fromIndex.evaluate(a);return c.indexOf(s,g)}return c.indexOf(s)},ci.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},ci.prototype.outputDefined=function(){return!1},ci.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Gi=function(a,s,c,g,b,A){this.inputType=a,this.type=s,this.input=c,this.cases=g,this.outputs=b,this.otherwise=A};Gi.parse=function(a,s){if(a.length<5)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return s.error("Expected an even number of arguments.");var c,g;s.expectedType&&s.expectedType.kind!=="value"&&(g=s.expectedType);for(var b={},A=[],T=2;T<a.length-1;T+=2){var O=a[T],z=a[T+1];Array.isArray(O)||(O=[O]);var $=s.concat(T);if(O.length===0)return $.error("Expected at least one branch label.");for(var Q=0,re=O;Q<re.length;Q+=1){var me=re[Q];if(typeof me!="number"&&typeof me!="string")return $.error("Branch labels must be numbers or strings.");if(typeof me=="number"&&Math.abs(me)>Number.MAX_SAFE_INTEGER)return $.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof me=="number"&&Math.floor(me)!==me)return $.error("Numeric branch labels must be integer values.");if(c){if($.checkSubtype(c,Ua(me)))return null}else c=Ua(me);if(b[String(me)]!==void 0)return $.error("Branch labels must be unique.");b[String(me)]=A.length}var Ee=s.parse(z,T,g);if(!Ee)return null;g=g||Ee.type,A.push(Ee)}var $e=s.parse(a[1],1,Fn);if(!$e)return null;var qe=s.parse(a[a.length-1],a.length-1,g);return qe?$e.type.kind!=="value"&&s.concat(1).checkSubtype(c,$e.type)?null:new Gi(c,g,$e,b,A,qe):null},Gi.prototype.evaluate=function(a){var s=this.input.evaluate(a);return(Ua(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(a)},Gi.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},Gi.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},Gi.prototype.serialize=function(){for(var a=this,s=["match",this.input.serialize()],c=[],g={},b=0,A=Object.keys(this.cases).sort();b<A.length;b+=1){var T=A[b];(re=g[this.cases[T]])===void 0?(g[this.cases[T]]=c.length,c.push([this.cases[T],[T]])):c[re][1].push(T)}for(var O=function(Ee){return a.inputType.kind==="number"?Number(Ee):Ee},z=0,$=c;z<$.length;z+=1){var Q=$[z],re=Q[0],me=Q[1];s.push(me.length===1?O(me[0]):me.map(O)),s.push(this.outputs[outputIndex$1].serialize())}return s.push(this.otherwise.serialize()),s};var vi=function(a,s,c){this.type=a,this.branches=s,this.otherwise=c};vi.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return s.error("Expected an odd number of arguments.");var c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);for(var g=[],b=1;b<a.length-1;b+=2){var A=s.parse(a[b],b,Cn);if(!A)return null;var T=s.parse(a[b+1],b+1,c);if(!T)return null;g.push([A,T]),c=c||T.type}var O=s.parse(a[a.length-1],a.length-1,c);return O?new vi(c,g,O):null},vi.prototype.evaluate=function(a){for(var s=0,c=this.branches;s<c.length;s+=1){var g=c[s],b=g[1];if(g[0].evaluate(a))return b.evaluate(a)}return this.otherwise.evaluate(a)},vi.prototype.eachChild=function(a){for(var s=0,c=this.branches;s<c.length;s+=1){var g=c[s],b=g[1];a(g[0]),a(b)}a(this.otherwise)},vi.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},vi.prototype.serialize=function(){var a=["case"];return this.eachChild(function(s){a.push(s.serialize())}),a};var ka=function(a,s,c,g){this.type=a,this.input=s,this.beginIndex=c,this.endIndex=g};function ha(a,s){return a==="=="||a==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function So(a,s,c,g){return g.compare(s,c)===0}function Sa(a,s,c){var g=a!=="=="&&a!=="!=";return function(){function b(A,T,O){this.type=Cn,this.lhs=A,this.rhs=T,this.collator=O,this.hasUntypedArgument=A.type.kind==="value"||T.type.kind==="value"}return b.parse=function(A,T){if(A.length!==3&&A.length!==4)return T.error("Expected two or three arguments.");var O=A[0],z=T.parse(A[1],1,Fn);if(!z)return null;if(!ha(O,z.type))return T.concat(1).error('"'+O+`" comparisons are not supported for type '`+Xi(z.type)+"'.");var $=T.parse(A[2],2,Fn);if(!$)return null;if(!ha(O,$.type))return T.concat(2).error('"'+O+`" comparisons are not supported for type '`+Xi($.type)+"'.");if(z.type.kind!==$.type.kind&&z.type.kind!=="value"&&$.type.kind!=="value")return T.error("Cannot compare types '"+Xi(z.type)+"' and '"+Xi($.type)+"'.");g&&(z.type.kind==="value"&&$.type.kind!=="value"?z=new Va($.type,[z]):z.type.kind!=="value"&&$.type.kind==="value"&&($=new Va(z.type,[$])));var Q=null;if(A.length===4){if(z.type.kind!=="string"&&$.type.kind!=="string"&&z.type.kind!=="value"&&$.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(!(Q=T.parse(A[3],3,ta)))return null}return new b(z,$,Q)},b.prototype.evaluate=function(A){var T=this.lhs.evaluate(A),O=this.rhs.evaluate(A);if(g&&this.hasUntypedArgument){var z=Ua(T),$=Ua(O);if(z.kind!==$.kind||z.kind!=="string"&&z.kind!=="number")throw new Eo('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+z.kind+", "+$.kind+") instead.")}if(this.collator&&!g&&this.hasUntypedArgument){var Q=Ua(T),re=Ua(O);if(Q.kind!=="string"||re.kind!=="string")return s(A,T,O)}return this.collator?c(A,T,O,this.collator.evaluate(A)):s(A,T,O)},b.prototype.eachChild=function(A){A(this.lhs),A(this.rhs),this.collator&&A(this.collator)},b.prototype.outputDefined=function(){return!0},b.prototype.serialize=function(){var A=[a];return this.eachChild(function(T){A.push(T.serialize())}),A},b}()}ka.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,Fn),g=s.parse(a[2],2,ar);if(!c||!g)return null;if(!bo(c.type,[pa(Fn),ot,Fn]))return s.error("Expected first argument to be of type array or string, but found "+Xi(c.type)+" instead");if(a.length===4){var b=s.parse(a[3],3,ar);return b?new ka(c.type,c,g,b):null}return new ka(c.type,c,g)},ka.prototype.evaluate=function(a){var s=this.input.evaluate(a),c=this.beginIndex.evaluate(a);if(!Za(s,["string","array"]))throw new Eo("Expected first argument to be of type array or string, but found "+Xi(Ua(s))+" instead.");if(this.endIndex){var g=this.endIndex.evaluate(a);return s.slice(c,g)}return s.slice(c)},ka.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},ka.prototype.outputDefined=function(){return!1},ka.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Ho=Sa("==",function(a,s,c){return s===c},So),xu=Sa("!=",function(a,s,c){return s!==c},function(a,s,c,g){return!So(0,s,c,g)}),hl=Sa("<",function(a,s,c){return s<c},function(a,s,c,g){return g.compare(s,c)<0}),No=Sa(">",function(a,s,c){return s>c},function(a,s,c,g){return g.compare(s,c)>0}),Iu=Sa("<=",function(a,s,c){return s<=c},function(a,s,c,g){return g.compare(s,c)<=0}),ef=Sa(">=",function(a,s,c){return s>=c},function(a,s,c,g){return g.compare(s,c)>=0}),ql=function(a,s,c,g,b){this.type=ot,this.number=a,this.locale=s,this.currency=c,this.minFractionDigits=g,this.maxFractionDigits=b};ql.parse=function(a,s){if(a.length!==3)return s.error("Expected two arguments.");var c=s.parse(a[1],1,ar);if(!c)return null;var g=a[2];if(typeof g!="object"||Array.isArray(g))return s.error("NumberFormat options argument must be an object.");var b=null;if(g.locale&&!(b=s.parse(g.locale,1,ot)))return null;var A=null;if(g.currency&&!(A=s.parse(g.currency,1,ot)))return null;var T=null;if(g["min-fraction-digits"]&&!(T=s.parse(g["min-fraction-digits"],1,ar)))return null;var O=null;return g["max-fraction-digits"]&&!(O=s.parse(g["max-fraction-digits"],1,ar))?null:new ql(c,b,A,T,O)},ql.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},ql.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},ql.prototype.outputDefined=function(){return!1},ql.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var kl=function(a){this.type=ar,this.input=a};kl.parse=function(a,s){if(a.length!==2)return s.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error("Expected argument of type string or array, but found "+Xi(c.type)+" instead."):new kl(c):null},kl.prototype.evaluate=function(a){var s=this.input.evaluate(a);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Eo("Expected value to be of type string or array, but found "+Xi(Ua(s))+" instead.")},kl.prototype.eachChild=function(a){a(this.input)},kl.prototype.outputDefined=function(){return!1},kl.prototype.serialize=function(){var a=["length"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Kl={"==":Ho,"!=":xu,">":No,"<":hl,">=":ef,"<=":Iu,array:Va,at:Or,boolean:Va,case:vi,coalesce:Gt,collator:Ys,format:vs,image:Hs,in:en,"index-of":ci,interpolate:De,"interpolate-hcl":De,"interpolate-lab":De,length:kl,let:Wt,literal:Xo,match:Gi,number:Va,"number-format":ql,object:Va,slice:ka,step:Mu,string:Va,"to-boolean":ms,"to-color":ms,"to-number":ms,"to-string":ms,var:yu,within:gu};function ts(a,s){var c=s[0],g=s[1],b=s[2],A=s[3];c=c.evaluate(a),g=g.evaluate(a),b=b.evaluate(a);var T=A?A.evaluate(a):1,O=iu(c,g,b,T);if(O)throw new Eo(O);return new na(c/255*T,g/255*T,b/255*T,T)}function Hh(a,s){return a in s}function Sh(a,s){var c=s[a];return c===void 0?null:c}function us(a){return{type:a}}function el(a){return{result:"success",value:a}}function Ql(a){return{result:"error",value:a}}function tl(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function kf(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Jl(a){return!!a.expression&&a.expression.interpolated}function oo(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function vc(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function rl(a){return a}function zs(a,s,c){return a!==void 0?a:s!==void 0?s:c!==void 0?c:void 0}function wh(a,s,c,g,b){return zs(typeof c===b?g[c]:void 0,a.default,s.default)}function dd(a,s,c){if(oo(c)!=="number")return zs(a.default,s.default);var g=a.stops.length;if(g===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[g-1][0])return a.stops[g-1][1];var b=Ju(a.stops.map(function(A){return A[0]}),c);return a.stops[b][1]}function Zl(a,s,c){var g=a.base!==void 0?a.base:1;if(oo(c)!=="number")return zs(a.default,s.default);var b=a.stops.length;if(b===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[b-1][0])return a.stops[b-1][1];var A=Ju(a.stops.map(function(re){return re[0]}),c),T=function(re,me,Ee,$e){var qe=$e-Ee,bt=re-Ee;return qe===0?0:me===1?bt/qe:(Math.pow(me,bt)-1)/(Math.pow(me,qe)-1)}(c,g,a.stops[A][0],a.stops[A+1][0]),O=a.stops[A][1],z=a.stops[A+1][1],$=xa[s.type]||rl;if(a.colorSpace&&a.colorSpace!=="rgb"){var Q=ue[a.colorSpace];$=function(re,me){return Q.reverse(Q.interpolate(Q.forward(re),Q.forward(me),T))}}return typeof O.evaluate=="function"?{evaluate:function(){for(var re=[],me=arguments.length;me--;)re[me]=arguments[me];var Ee=O.evaluate.apply(void 0,re),$e=z.evaluate.apply(void 0,re);if(Ee!==void 0&&$e!==void 0)return $(Ee,$e,T)}}:$(O,z,T)}function Fu(a,s,c){return s.type==="color"?c=na.parse(c):s.type==="formatted"?c=ko.fromString(c.toString()):s.type==="resolvedImage"?c=ao.fromString(c.toString()):oo(c)===s.type||s.type==="enum"&&s.values[c]||(c=void 0),zs(c,a.default,s.default)}$o.register(Kl,{error:[{kind:"error"},[ot],function(a,s){throw new Eo(s[0].evaluate(a))}],typeof:[ot,[Fn],function(a,s){return Xi(Ua(s[0].evaluate(a)))}],"to-rgba":[pa(ar,4),[se],function(a,s){return s[0].evaluate(a).toArray()}],rgb:[se,[ar,ar,ar],ts],rgba:[se,[ar,ar,ar,ar],ts],has:{type:Cn,overloads:[[[ot],function(a,s){return Hh(s[0].evaluate(a),a.properties())}],[[ot,Yi],function(a,s){var c=s[1];return Hh(s[0].evaluate(a),c.evaluate(a))}]]},get:{type:Fn,overloads:[[[ot],function(a,s){return Sh(s[0].evaluate(a),a.properties())}],[[ot,Yi],function(a,s){var c=s[1];return Sh(s[0].evaluate(a),c.evaluate(a))}]]},"feature-state":[Fn,[ot],function(a,s){return Sh(s[0].evaluate(a),a.featureState||{})}],properties:[Yi,[],function(a){return a.properties()}],"geometry-type":[ot,[],function(a){return a.geometryType()}],id:[Fn,[],function(a){return a.id()}],zoom:[ar,[],function(a){return a.globals.zoom}],"heatmap-density":[ar,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[ar,[],function(a){return a.globals.lineProgress||0}],accumulated:[Fn,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[ar,us(ar),function(a,s){for(var c=0,g=0,b=s;g<b.length;g+=1)c+=b[g].evaluate(a);return c}],"*":[ar,us(ar),function(a,s){for(var c=1,g=0,b=s;g<b.length;g+=1)c*=b[g].evaluate(a);return c}],"-":{type:ar,overloads:[[[ar,ar],function(a,s){var c=s[1];return s[0].evaluate(a)-c.evaluate(a)}],[[ar],function(a,s){return-s[0].evaluate(a)}]]},"/":[ar,[ar,ar],function(a,s){var c=s[1];return s[0].evaluate(a)/c.evaluate(a)}],"%":[ar,[ar,ar],function(a,s){var c=s[1];return s[0].evaluate(a)%c.evaluate(a)}],ln2:[ar,[],function(){return Math.LN2}],pi:[ar,[],function(){return Math.PI}],e:[ar,[],function(){return Math.E}],"^":[ar,[ar,ar],function(a,s){var c=s[1];return Math.pow(s[0].evaluate(a),c.evaluate(a))}],sqrt:[ar,[ar],function(a,s){return Math.sqrt(s[0].evaluate(a))}],log10:[ar,[ar],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN10}],ln:[ar,[ar],function(a,s){return Math.log(s[0].evaluate(a))}],log2:[ar,[ar],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN2}],sin:[ar,[ar],function(a,s){return Math.sin(s[0].evaluate(a))}],cos:[ar,[ar],function(a,s){return Math.cos(s[0].evaluate(a))}],tan:[ar,[ar],function(a,s){return Math.tan(s[0].evaluate(a))}],asin:[ar,[ar],function(a,s){return Math.asin(s[0].evaluate(a))}],acos:[ar,[ar],function(a,s){return Math.acos(s[0].evaluate(a))}],atan:[ar,[ar],function(a,s){return Math.atan(s[0].evaluate(a))}],min:[ar,us(ar),function(a,s){return Math.min.apply(Math,s.map(function(c){return c.evaluate(a)}))}],max:[ar,us(ar),function(a,s){return Math.max.apply(Math,s.map(function(c){return c.evaluate(a)}))}],abs:[ar,[ar],function(a,s){return Math.abs(s[0].evaluate(a))}],round:[ar,[ar],function(a,s){var c=s[0].evaluate(a);return c<0?-Math.round(-c):Math.round(c)}],floor:[ar,[ar],function(a,s){return Math.floor(s[0].evaluate(a))}],ceil:[ar,[ar],function(a,s){return Math.ceil(s[0].evaluate(a))}],"filter-==":[Cn,[ot,Fn],function(a,s){var c=s[0],g=s[1];return a.properties()[c.value]===g.value}],"filter-id-==":[Cn,[Fn],function(a,s){var c=s[0];return a.id()===c.value}],"filter-type-==":[Cn,[ot],function(a,s){var c=s[0];return a.geometryType()===c.value}],"filter-<":[Cn,[ot,Fn],function(a,s){var c=s[0],g=s[1],b=a.properties()[c.value],A=g.value;return typeof b==typeof A&&b<A}],"filter-id-<":[Cn,[Fn],function(a,s){var c=s[0],g=a.id(),b=c.value;return typeof g==typeof b&&g<b}],"filter->":[Cn,[ot,Fn],function(a,s){var c=s[0],g=s[1],b=a.properties()[c.value],A=g.value;return typeof b==typeof A&&b>A}],"filter-id->":[Cn,[Fn],function(a,s){var c=s[0],g=a.id(),b=c.value;return typeof g==typeof b&&g>b}],"filter-<=":[Cn,[ot,Fn],function(a,s){var c=s[0],g=s[1],b=a.properties()[c.value],A=g.value;return typeof b==typeof A&&b<=A}],"filter-id-<=":[Cn,[Fn],function(a,s){var c=s[0],g=a.id(),b=c.value;return typeof g==typeof b&&g<=b}],"filter->=":[Cn,[ot,Fn],function(a,s){var c=s[0],g=s[1],b=a.properties()[c.value],A=g.value;return typeof b==typeof A&&b>=A}],"filter-id->=":[Cn,[Fn],function(a,s){var c=s[0],g=a.id(),b=c.value;return typeof g==typeof b&&g>=b}],"filter-has":[Cn,[Fn],function(a,s){return s[0].value in a.properties()}],"filter-has-id":[Cn,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[Cn,[pa(ot)],function(a,s){return s[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[Cn,[pa(Fn)],function(a,s){return s[0].value.indexOf(a.id())>=0}],"filter-in-small":[Cn,[ot,pa(Fn)],function(a,s){var c=s[0];return s[1].value.indexOf(a.properties()[c.value])>=0}],"filter-in-large":[Cn,[ot,pa(Fn)],function(a,s){var c=s[0],g=s[1];return function(b,A,T,O){for(;T<=O;){var z=T+O>>1;if(A[z]===b)return!0;A[z]>b?O=z-1:T=z+1}return!1}(a.properties()[c.value],g.value,0,g.value.length-1)}],all:{type:Cn,overloads:[[[Cn,Cn],function(a,s){var c=s[1];return s[0].evaluate(a)&&c.evaluate(a)}],[us(Cn),function(a,s){for(var c=0,g=s;c<g.length;c+=1)if(!g[c].evaluate(a))return!1;return!0}]]},any:{type:Cn,overloads:[[[Cn,Cn],function(a,s){var c=s[1];return s[0].evaluate(a)||c.evaluate(a)}],[us(Cn),function(a,s){for(var c=0,g=s;c<g.length;c+=1)if(g[c].evaluate(a))return!0;return!1}]]},"!":[Cn,[Cn],function(a,s){return!s[0].evaluate(a)}],"is-supported-script":[Cn,[ot],function(a,s){var c=a.globals&&a.globals.isSupportedScript;return!c||c(s[0].evaluate(a))}],upcase:[ot,[ot],function(a,s){return s[0].evaluate(a).toUpperCase()}],downcase:[ot,[ot],function(a,s){return s[0].evaluate(a).toLowerCase()}],concat:[ot,us(Fn),function(a,s){return s.map(function(c){return zl(c.evaluate(a))}).join("")}],"resolved-locale":[ot,[ta],function(a,s){return s[0].evaluate(a).resolvedLocale()}]});var mc=function(a,s){this.expression=a,this._warningHistory={},this._evaluator=new Da,this._defaultValue=s?function(c){return c.type==="color"&&vc(c.default)?new na(0,0,0,0):c.type==="color"?na.parse(c.default)||null:c.default===void 0?null:c.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null};function Pl(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Kl}function gc(a,s){var c=new _u(Kl,[],s?function(b){var A={color:se,string:ot,number:ar,enum:ot,boolean:Cn,formatted:$a,resolvedImage:ra};return b.type==="array"?pa(A[b.value]||Fn,b.length):A[b.type]}(s):void 0),g=c.parse(a,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?el(new mc(g,s)):Ql(c.errors)}mc.prototype.evaluateWithoutErrorHandling=function(a,s,c,g,b,A){return this._evaluator.globals=a,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=g,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=A,this.expression.evaluate(this._evaluator)},mc.prototype.evaluate=function(a,s,c,g,b,A){this._evaluator.globals=a,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=g,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=A||null;try{var T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Eo("Expected value to be one of "+Object.keys(this._enumValues).map(function(O){return JSON.stringify(O)}).join(", ")+", but found "+JSON.stringify(T)+" instead.");return T}catch(O){return this._warningHistory[O.message]||(this._warningHistory[O.message]=!0,typeof console!="undefined"&&console.warn(O.message)),this._defaultValue}};var Lc=function(a,s){this.kind=a,this._styleExpression=s,this.isStateDependent=a!=="constant"&&!Tu(s.expression)};Lc.prototype.evaluateWithoutErrorHandling=function(a,s,c,g,b,A){return this._styleExpression.evaluateWithoutErrorHandling(a,s,c,g,b,A)},Lc.prototype.evaluate=function(a,s,c,g,b,A){return this._styleExpression.evaluate(a,s,c,g,b,A)};var Oc=function(a,s,c,g){this.kind=a,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=a!=="camera"&&!Tu(s.expression),this.interpolationType=g};function tf(a,s){if((a=gc(a,s)).result==="error")return a;var c=a.value.expression,g=qs(c);if(!g&&!tl(s))return Ql([new jr("","data expressions not supported")]);var b=Ns(c,["zoom"]);if(!b&&!kf(s))return Ql([new jr("","zoom expressions not supported")]);var A=function T(O){var z=null;if(O instanceof Wt)z=T(O.result);else if(O instanceof Gt)for(var $=0,Q=O.args;$<Q.length&&!(z=T(Q[$]));$+=1);else(O instanceof Mu||O instanceof De)&&O.input instanceof $o&&O.input.name==="zoom"&&(z=O);return z instanceof jr||O.eachChild(function(re){var me=T(re);me instanceof jr?z=me:!z&&me?z=new jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):z&&me&&z!==me&&(z=new jr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),z}(c);return A||b?A instanceof jr?Ql([A]):A instanceof De&&!Jl(s)?Ql([new jr("",'"interpolate" expressions cannot be used with this property')]):el(A?new Oc(g?"camera":"composite",a.value,A.labels,A instanceof De?A.interpolation:void 0):new Lc(g?"constant":"source",a.value)):Ql([new jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Oc.prototype.evaluateWithoutErrorHandling=function(a,s,c,g,b,A){return this._styleExpression.evaluateWithoutErrorHandling(a,s,c,g,b,A)},Oc.prototype.evaluate=function(a,s,c,g,b,A){return this._styleExpression.evaluate(a,s,c,g,b,A)},Oc.prototype.interpolationFactor=function(a,s,c){return this.interpolationType?De.interpolationFactor(this.interpolationType,a,s,c):0};var Rl=function(a,s){this._parameters=a,this._specification=s,Wr(this,function c(g,b){var A,T,O,z=b.type==="color",$=g.stops&&typeof g.stops[0][0]=="object",Q=$||!($||g.property!==void 0),re=g.type||(Jl(b)?"exponential":"interval");if(z&&((g=Wr({},g)).stops&&(g.stops=g.stops.map(function(jn){return[jn[0],na.parse(jn[1])]})),g.default=na.parse(g.default?g.default:b.default)),g.colorSpace&&g.colorSpace!=="rgb"&&!ue[g.colorSpace])throw new Error("Unknown color space: "+g.colorSpace);if(re==="exponential")A=Zl;else if(re==="interval")A=dd;else if(re==="categorical"){A=wh,T=Object.create(null);for(var me=0,Ee=g.stops;me<Ee.length;me+=1){var $e=Ee[me];T[$e[0]]=$e[1]}O=typeof g.stops[0][0]}else{if(re!=="identity")throw new Error('Unknown function type "'+re+'"');A=Fu}if($){for(var qe={},bt=[],st=0;st<g.stops.length;st++){var Nt=g.stops[st],er=Nt[0].zoom;qe[er]===void 0&&(qe[er]={zoom:er,type:g.type,property:g.property,default:g.default,stops:[]},bt.push(er)),qe[er].stops.push([Nt[0].value,Nt[1]])}for(var _r=[],Er=0,Br=bt;Er<Br.length;Er+=1){var dn=Br[Er];_r.push([qe[dn].zoom,c(qe[dn],b)])}var Ln={name:"linear"};return{kind:"composite",interpolationType:Ln,interpolationFactor:De.interpolationFactor.bind(void 0,Ln),zoomStops:_r.map(function(jn){return jn[0]}),evaluate:function(jn,Ai){var Wn=jn.zoom;return Zl({stops:_r,base:g.base},b,Wn).evaluate(Wn,Ai)}}}if(Q){var xi=re==="exponential"?{name:"exponential",base:g.base!==void 0?g.base:1}:null;return{kind:"camera",interpolationType:xi,interpolationFactor:De.interpolationFactor.bind(void 0,xi),zoomStops:g.stops.map(function(jn){return jn[0]}),evaluate:function(jn){return A(g,b,jn.zoom,T,O)}}}return{kind:"source",evaluate:function(jn,Ai){var Wn=Ai&&Ai.properties?Ai.properties[g.property]:void 0;return Wn===void 0?zs(g.default,b.default):A(g,b,Wn,T,O)}}}(this._parameters,this._specification))};function gs(a){var s=a.key,c=a.value,g=a.valueSpec||{},b=a.objectElementValidators||{},A=a.style,T=a.styleSpec,O=[],z=oo(c);if(z!=="object")return[new Je(s,c,"object expected, "+z+" found")];for(var $ in c){var Q=$.split(".")[0],re=g[Q]||g["*"],me=void 0;if(b[Q])me=b[Q];else if(g[Q])me=Vn;else if(b["*"])me=b["*"];else{if(!g["*"]){O.push(new Je(s,c[$],'unknown property "'+$+'"'));continue}me=Vn}O=O.concat(me({key:(s&&s+".")+$,value:c[$],valueSpec:re,style:A,styleSpec:T,object:c,objectKey:$},c))}for(var Ee in g)b[Ee]||g[Ee].required&&g[Ee].default===void 0&&c[Ee]===void 0&&O.push(new Je(s,c,'missing required property "'+Ee+'"'));return O}function Ah(a){var s=a.value,c=a.valueSpec,g=a.style,b=a.styleSpec,A=a.key,T=a.arrayElementValidator||Vn;if(oo(s)!=="array")return[new Je(A,s,"array expected, "+oo(s)+" found")];if(c.length&&s.length!==c.length)return[new Je(A,s,"array length "+c.length+" expected, length "+s.length+" found")];if(c["min-length"]&&s.length<c["min-length"])return[new Je(A,s,"array length at least "+c["min-length"]+" expected, length "+s.length+" found")];var O={type:c.value,values:c.values};b.$version<7&&(O.function=c.function),oo(c.value)==="object"&&(O=c.value);for(var z=[],$=0;$<s.length;$++)z=z.concat(T({array:s,arrayIndex:$,value:s[$],valueSpec:O,style:g,styleSpec:b,key:A+"["+$+"]"}));return z}function yc(a){var s=a.key,c=a.value,g=a.valueSpec,b=oo(c);return b==="number"&&c!=c&&(b="NaN"),b!=="number"?[new Je(s,c,"number expected, "+b+" found")]:"minimum"in g&&c<g.minimum?[new Je(s,c,c+" is less than the minimum value "+g.minimum)]:"maximum"in g&&c>g.maximum?[new Je(s,c,c+" is greater than the maximum value "+g.maximum)]:[]}function Wh(a){var s,c,g,b=a.valueSpec,A=cr(a.value.type),T={},O=A!=="categorical"&&a.value.property===void 0,z=!O,$=oo(a.value.stops)==="array"&&oo(a.value.stops[0])==="array"&&oo(a.value.stops[0][0])==="object",Q=gs({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(Ee){if(A==="identity")return[new Je(Ee.key,Ee.value,'identity function may not have a "stops" property')];var $e=[],qe=Ee.value;return $e=$e.concat(Ah({key:Ee.key,value:qe,valueSpec:Ee.valueSpec,style:Ee.style,styleSpec:Ee.styleSpec,arrayElementValidator:re})),oo(qe)==="array"&&qe.length===0&&$e.push(new Je(Ee.key,qe,"array must have at least one stop")),$e},default:function(Ee){return Vn({key:Ee.key,value:Ee.value,valueSpec:b,style:Ee.style,styleSpec:Ee.styleSpec})}}});return A==="identity"&&O&&Q.push(new Je(a.key,a.value,'missing required property "property"')),A==="identity"||a.value.stops||Q.push(new Je(a.key,a.value,'missing required property "stops"')),A==="exponential"&&a.valueSpec.expression&&!Jl(a.valueSpec)&&Q.push(new Je(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(z&&!tl(a.valueSpec)?Q.push(new Je(a.key,a.value,"property functions not supported")):O&&!kf(a.valueSpec)&&Q.push(new Je(a.key,a.value,"zoom functions not supported"))),A!=="categorical"&&!$||a.value.property!==void 0||Q.push(new Je(a.key,a.value,'"property" property is required')),Q;function re(Ee){var $e=[],qe=Ee.value,bt=Ee.key;if(oo(qe)!=="array")return[new Je(bt,qe,"array expected, "+oo(qe)+" found")];if(qe.length!==2)return[new Je(bt,qe,"array length 2 expected, length "+qe.length+" found")];if($){if(oo(qe[0])!=="object")return[new Je(bt,qe,"object expected, "+oo(qe[0])+" found")];if(qe[0].zoom===void 0)return[new Je(bt,qe,"object stop key must have zoom")];if(qe[0].value===void 0)return[new Je(bt,qe,"object stop key must have value")];if(g&&g>cr(qe[0].zoom))return[new Je(bt,qe[0].zoom,"stop zoom values must appear in ascending order")];cr(qe[0].zoom)!==g&&(g=cr(qe[0].zoom),c=void 0,T={}),$e=$e.concat(gs({key:bt+"[0]",value:qe[0],valueSpec:{zoom:{}},style:Ee.style,styleSpec:Ee.styleSpec,objectElementValidators:{zoom:yc,value:me}}))}else $e=$e.concat(me({key:bt+"[0]",value:qe[0],valueSpec:{},style:Ee.style,styleSpec:Ee.styleSpec},qe));return Pl(dr(qe[1]))?$e.concat([new Je(bt+"[1]",qe[1],"expressions are not allowed in function stops.")]):$e.concat(Vn({key:bt+"[1]",value:qe[1],valueSpec:b,style:Ee.style,styleSpec:Ee.styleSpec}))}function me(Ee,$e){var qe=oo(Ee.value),bt=cr(Ee.value),st=Ee.value!==null?Ee.value:$e;if(s){if(qe!==s)return[new Je(Ee.key,st,qe+" stop domain type must match previous stop domain type "+s)]}else s=qe;if(qe!=="number"&&qe!=="string"&&qe!=="boolean")return[new Je(Ee.key,st,"stop domain value must be a number, string, or boolean")];if(qe!=="number"&&A!=="categorical"){var Nt="number expected, "+qe+" found";return tl(b)&&A===void 0&&(Nt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Je(Ee.key,st,Nt)]}return A!=="categorical"||qe!=="number"||isFinite(bt)&&Math.floor(bt)===bt?A!=="categorical"&&qe==="number"&&c!==void 0&&bt<c?[new Je(Ee.key,st,"stop domain values must appear in ascending order")]:(c=bt,A==="categorical"&&bt in T?[new Je(Ee.key,st,"stop domain values must be unique")]:(T[bt]=!0,[])):[new Je(Ee.key,st,"integer expected, found "+bt)]}}function ec(a){var s=(a.expressionContext==="property"?tf:gc)(dr(a.value),a.valueSpec);if(s.result==="error")return s.value.map(function(g){return new Je(""+a.key+g.key,a.value,g.message)});var c=s.value.expression||s.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!c.outputDefined())return[new Je(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Tu(c))return[new Je(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Tu(c))return[new Je(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Ns(c,["zoom","feature-state"]))return[new Je(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!qs(c))return[new Je(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zs(a){var s=a.key,c=a.value,g=a.valueSpec,b=[];return Array.isArray(g.values)?g.values.indexOf(cr(c))===-1&&b.push(new Je(s,c,"expected one of ["+g.values.join(", ")+"], "+JSON.stringify(c)+" found")):Object.keys(g.values).indexOf(cr(c))===-1&&b.push(new Je(s,c,"expected one of ["+Object.keys(g.values).join(", ")+"], "+JSON.stringify(c)+" found")),b}function _c(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var s=0,c=a.slice(1);s<c.length;s+=1){var g=c[s];if(!_c(g)&&typeof g!="boolean")return!1}return!0;default:return!0}}Rl.deserialize=function(a){return new Rl(a._parameters,a._specification)},Rl.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var pl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ws(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};_c(a)||(a=Pf(a));var s=gc(a,pl);if(s.result==="error")throw new Error(s.value.map(function(c){return c.key+": "+c.message}).join(", "));return{filter:function(c,g,b){return s.value.evaluate(c,g,{},b)},needGeometry:function c(g){if(!Array.isArray(g))return!1;if(g[0]==="within")return!0;for(var b=1;b<g.length;b++)if(c(g[b]))return!0;return!1}(a)}}function yp(a,s){return a<s?-1:a>s?1:0}function Pf(a){if(!a)return!0;var s,c=a[0];return a.length<=1?c!=="any":c==="=="?Fc(a[1],a[2],"=="):c==="!="?tc(Fc(a[1],a[2],"==")):c==="<"||c===">"||c==="<="||c===">="?Fc(a[1],a[2],c):c==="any"?(s=a.slice(1),["any"].concat(s.map(Pf))):c==="all"?["all"].concat(a.slice(1).map(Pf)):c==="none"?["all"].concat(a.slice(1).map(Pf).map(tc)):c==="in"?xc(a[1],a.slice(2)):c==="!in"?tc(xc(a[1],a.slice(2))):c==="has"?nl(a[1]):c==="!has"?tc(nl(a[1])):c!=="within"||a}function Fc(a,s,c){switch(a){case"$type":return["filter-type-"+c,s];case"$id":return["filter-id-"+c,s];default:return["filter-"+c,a,s]}}function xc(a,s){if(s.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(function(c){return typeof c!=typeof s[0]})?["filter-in-large",a,["literal",s.sort(yp)]]:["filter-in-small",a,["literal",s]]}}function nl(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function tc(a){return["!",a]}function Ch(a){return _c(dr(a.value))?ec(Wr({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function s(c){var g=c.value,b=c.key;if(oo(g)!=="array")return[new Je(b,g,"array expected, "+oo(g)+" found")];var A,T=c.styleSpec,O=[];if(g.length<1)return[new Je(b,g,"filter array must have at least 1 element")];switch(O=O.concat(Zs({key:b+"[0]",value:g[0],valueSpec:T.filter_operator,style:c.style,styleSpec:c.styleSpec})),cr(g[0])){case"<":case"<=":case">":case">=":g.length>=2&&cr(g[1])==="$type"&&O.push(new Je(b,g,'"$type" cannot be use with operator "'+g[0]+'"'));case"==":case"!=":g.length!==3&&O.push(new Je(b,g,'filter array for operator "'+g[0]+'" must have 3 elements'));case"in":case"!in":g.length>=2&&(A=oo(g[1]))!=="string"&&O.push(new Je(b+"[1]",g[1],"string expected, "+A+" found"));for(var z=2;z<g.length;z++)A=oo(g[z]),cr(g[1])==="$type"?O=O.concat(Zs({key:b+"["+z+"]",value:g[z],valueSpec:T.geometry_type,style:c.style,styleSpec:c.styleSpec})):A!=="string"&&A!=="number"&&A!=="boolean"&&O.push(new Je(b+"["+z+"]",g[z],"string, number, or boolean expected, "+A+" found"));break;case"any":case"all":case"none":for(var $=1;$<g.length;$++)O=O.concat(s({key:b+"["+$+"]",value:g[$],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":A=oo(g[1]),g.length!==2?O.push(new Je(b,g,'filter array for "'+g[0]+'" operator must have 2 elements')):A!=="string"&&O.push(new Je(b+"[1]",g[1],"string expected, "+A+" found"));break;case"within":A=oo(g[1]),g.length!==2?O.push(new Je(b,g,'filter array for "'+g[0]+'" operator must have 2 elements')):A!=="object"&&O.push(new Je(b+"[1]",g[1],"object expected, "+A+" found"))}return O}(a)}function Xh(a,s){var c=a.key,g=a.style,b=a.styleSpec,A=a.value,T=a.objectKey,O=b[s+"_"+a.layerType];if(!O)return[];var z=T.match(/^(.*)-transition$/);if(s==="paint"&&z&&O[z[1]]&&O[z[1]].transition)return Vn({key:c,value:A,valueSpec:b.transition,style:g,styleSpec:b});var $,Q=a.valueSpec||O[T];if(!Q)return[new Je(c,A,'unknown property "'+T+'"')];if(oo(A)==="string"&&tl(Q)&&!Q.tokens&&($=/^{([^}]+)}$/.exec(A)))return[new Je(c,A,'"'+T+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify($[1])+" }`.")];var re=[];return a.layerType==="symbol"&&(T==="text-field"&&g&&!g.glyphs&&re.push(new Je(c,A,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&vc(dr(A))&&cr(A.type)==="identity"&&re.push(new Je(c,A,'"text-font" does not support identity functions'))),re.concat(Vn({key:a.key,value:A,valueSpec:Q,style:g,styleSpec:b,expressionContext:"property",propertyType:s,propertyKey:T}))}function $h(a){return Xh(a,"paint")}function rf(a){return Xh(a,"layout")}function _p(a){var s=[],c=a.value,g=a.key,b=a.style,A=a.styleSpec;c.type||c.ref||s.push(new Je(g,c,'either "type" or "ref" is required'));var T,O=cr(c.type),z=cr(c.ref);if(c.id)for(var $=cr(c.id),Q=0;Q<a.arrayIndex;Q++){var re=b.layers[Q];cr(re.id)===$&&s.push(new Je(g,c.id,'duplicate layer id "'+c.id+'", previously used at line '+re.id.__line__))}if("ref"in c)["type","source","source-layer","filter","layout"].forEach(function($e){$e in c&&s.push(new Je(g,c[$e],'"'+$e+'" is prohibited for ref layers'))}),b.layers.forEach(function($e){cr($e.id)===z&&(T=$e)}),T?T.ref?s.push(new Je(g,c.ref,"ref cannot reference another ref layer")):O=cr(T.type):s.push(new Je(g,c.ref,'ref layer "'+z+'" not found'));else if(O!=="background")if(c.source){var me=b.sources&&b.sources[c.source],Ee=me&&cr(me.type);me?Ee==="vector"&&O==="raster"?s.push(new Je(g,c.source,'layer "'+c.id+'" requires a raster source')):Ee==="raster"&&O!=="raster"?s.push(new Je(g,c.source,'layer "'+c.id+'" requires a vector source')):Ee!=="vector"||c["source-layer"]?Ee==="raster-dem"&&O!=="hillshade"?s.push(new Je(g,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="line"||!c.paint||!c.paint["line-gradient"]||Ee==="geojson"&&me.lineMetrics||s.push(new Je(g,c,'layer "'+c.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):s.push(new Je(g,c,'layer "'+c.id+'" must specify a "source-layer"')):s.push(new Je(g,c.source,'source "'+c.source+'" not found'))}else s.push(new Je(g,c,'missing required property "source"'));return s=s.concat(gs({key:g,value:c,valueSpec:A.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Vn({key:g+".type",value:c.type,valueSpec:A.layer.type,style:a.style,styleSpec:a.styleSpec,object:c,objectKey:"type"})},filter:Ch,layout:function($e){return gs({layer:c,key:$e.key,value:$e.value,style:$e.style,styleSpec:$e.styleSpec,objectElementValidators:{"*":function(qe){return rf(Wr({layerType:O},qe))}}})},paint:function($e){return gs({layer:c,key:$e.key,value:$e.value,style:$e.style,styleSpec:$e.styleSpec,objectElementValidators:{"*":function(qe){return $h(Wr({layerType:O},qe))}}})}}}))}function rc(a){var s=a.value,c=a.key,g=oo(s);return g!=="string"?[new Je(c,s,"string expected, "+g+" found")]:[]}var kt={promoteId:function(a){var s=a.key,c=a.value;if(oo(c)==="string")return rc({key:s,value:c});var g=[];for(var b in c)g.push.apply(g,rc({key:s+"."+b,value:c[b]}));return g}};function Zr(a){var s=a.value,c=a.key,g=a.styleSpec,b=a.style;if(!s.type)return[new Je(c,s,'"type" is required')];var A,T=cr(s.type);switch(T){case"vector":case"raster":case"raster-dem":return gs({key:c,value:s,valueSpec:g["source_"+T.replace("-","_")],style:a.style,styleSpec:g,objectElementValidators:kt});case"geojson":if(A=gs({key:c,value:s,valueSpec:g.source_geojson,style:b,styleSpec:g,objectElementValidators:kt}),s.cluster)for(var O in s.clusterProperties){var z=s.clusterProperties[O],$=z[0],Q=typeof $=="string"?[$,["accumulated"],["get",O]]:$;A.push.apply(A,ec({key:c+"."+O+".map",value:z[1],expressionContext:"cluster-map"})),A.push.apply(A,ec({key:c+"."+O+".reduce",value:Q,expressionContext:"cluster-reduce"}))}return A;case"video":return gs({key:c,value:s,valueSpec:g.source_video,style:b,styleSpec:g});case"image":return gs({key:c,value:s,valueSpec:g.source_image,style:b,styleSpec:g});case"canvas":return[new Je(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zs({key:c+".type",value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,styleSpec:g})}}function Mr(a){var s=a.value,c=a.styleSpec,g=c.light,b=a.style,A=[],T=oo(s);if(s===void 0)return A;if(T!=="object")return A.concat([new Je("light",s,"object expected, "+T+" found")]);for(var O in s){var z=O.match(/^(.*)-transition$/);A=A.concat(z&&g[z[1]]&&g[z[1]].transition?Vn({key:O,value:s[O],valueSpec:c.transition,style:b,styleSpec:c}):g[O]?Vn({key:O,value:s[O],valueSpec:g[O],style:b,styleSpec:c}):[new Je(O,s[O],'unknown property "'+O+'"')])}return A}var fi={"*":function(){return[]},array:Ah,boolean:function(a){var s=a.value,c=a.key,g=oo(s);return g!=="boolean"?[new Je(c,s,"boolean expected, "+g+" found")]:[]},number:yc,color:function(a){var s=a.key,c=a.value,g=oo(c);return g!=="string"?[new Je(s,c,"color expected, "+g+" found")]:fa(c)===null?[new Je(s,c,'color expected, "'+c+'" found')]:[]},constants:Xt,enum:Zs,filter:Ch,function:Wh,layer:_p,object:gs,source:Zr,light:Mr,string:rc,formatted:function(a){return rc(a).length===0?[]:ec(a)},resolvedImage:function(a){return rc(a).length===0?[]:ec(a)}};function Vn(a){var s=a.value,c=a.valueSpec,g=a.styleSpec;return c.expression&&vc(cr(s))?Wh(a):c.expression&&Pl(dr(s))?ec(a):c.type&&fi[c.type]?fi[c.type](a):gs(Wr({},a,{valueSpec:c.type?g[c.type]:c}))}function Ni(a){var s=a.value,c=a.key,g=rc(a);return g.length||(s.indexOf("{fontstack}")===-1&&g.push(new Je(c,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&g.push(new Je(c,s,'"glyphs" url must include a "{range}" token'))),g}function Xa(a,s){s===void 0&&(s=Te);var c=[];return c=c.concat(Vn({key:"",value:a,valueSpec:s.$root,styleSpec:s,style:a,objectElementValidators:{glyphs:Ni,"*":function(){return[]}}})),a.constants&&(c=c.concat(Xt({key:"constants",value:a.constants,style:a,styleSpec:s}))),co(c)}function co(a){return[].concat(a).sort(function(s,c){return s.line-c.line})}function Ul(a){return function(){for(var s=[],c=arguments.length;c--;)s[c]=arguments[c];return co(a.apply(this,s))}}Xa.source=Ul(Zr),Xa.light=Ul(Mr),Xa.layer=Ul(_p),Xa.filter=Ul(Ch),Xa.paintProperty=Ul($h),Xa.layoutProperty=Ul(rf);var Th=Xa,ou=Th.light,Mh=Th.paintProperty,$f=Th.layoutProperty;function bc(a,s){var c=!1;if(s&&s.length)for(var g=0,b=s;g<b.length;g+=1)a.fire(new ht(new Error(b[g].message))),c=!0;return c}var il=ys;function ys(a,s,c){var g=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var b=new Int32Array(this.arrayBuffer);a=b[0],this.d=(s=b[1])+2*(c=b[2]);for(var A=0;A<this.d*this.d;A++){var T=b[3+A],O=b[3+A+1];g.push(T===O?null:b.subarray(T,O))}var z=b[3+g.length+1];this.keys=b.subarray(b[3+g.length],z),this.bboxes=b.subarray(z),this.insert=this._insertReadonly}else{this.d=s+2*c;for(var $=0;$<this.d*this.d;$++)g.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=a,this.padding=c,this.scale=s/a,this.uid=0;var Q=c/s*a;this.min=-Q,this.max=a+Q}ys.prototype.insert=function(a,s,c,g,b){this._forEachCell(s,c,g,b,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(g),this.bboxes.push(b)},ys.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ys.prototype._insertCell=function(a,s,c,g,b,A){this.cells[b].push(A)},ys.prototype.query=function(a,s,c,g,b){var A=this.min,T=this.max;if(a<=A&&s<=A&&T<=c&&T<=g&&!b)return Array.prototype.slice.call(this.keys);var O=[];return this._forEachCell(a,s,c,g,this._queryCell,O,{},b),O},ys.prototype._queryCell=function(a,s,c,g,b,A,T,O){var z=this.cells[b];if(z!==null)for(var $=this.keys,Q=this.bboxes,re=0;re<z.length;re++){var me=z[re];if(T[me]===void 0){var Ee=4*me;(O?O(Q[Ee+0],Q[Ee+1],Q[Ee+2],Q[Ee+3]):a<=Q[Ee+2]&&s<=Q[Ee+3]&&c>=Q[Ee+0]&&g>=Q[Ee+1])?(T[me]=!0,A.push($[me])):T[me]=!1}}},ys.prototype._forEachCell=function(a,s,c,g,b,A,T,O){for(var z=this._convertToCellCoord(a),$=this._convertToCellCoord(s),Q=this._convertToCellCoord(c),re=this._convertToCellCoord(g),me=z;me<=Q;me++)for(var Ee=$;Ee<=re;Ee++){var $e=this.d*Ee+me;if((!O||O(this._convertFromCellCoord(me),this._convertFromCellCoord(Ee),this._convertFromCellCoord(me+1),this._convertFromCellCoord(Ee+1)))&&b.call(this,a,s,c,g,$e,A,T,O))return}},ys.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},ys.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},ys.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,s=3+this.cells.length+1+1,c=0,g=0;g<this.cells.length;g++)c+=this.cells[g].length;var b=new Int32Array(s+c+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;for(var A=s,T=0;T<a.length;T++){var O=a[T];b[3+T]=A,b.set(O,A),A+=O.length}return b[3+a.length]=A,b.set(this.keys,A),b[3+a.length+1]=A+=this.keys.length,b.set(this.bboxes,A),A+=this.bboxes.length,b.buffer};var go=Ae.ImageData,Yf=Ae.ImageBitmap,_s={};function Gn(a,s,c){c===void 0&&(c={}),Object.defineProperty(s,"_classRegistryKey",{value:a,writeable:!1}),_s[a]={klass:s,omit:c.omit||[],shallow:c.shallow||[]}}for(var rs in Gn("Object",Object),il.serialize=function(a,s){var c=a.toArrayBuffer();return s&&s.push(c),{buffer:c}},il.deserialize=function(a){return new il(a.buffer)},Gn("Grid",il),Gn("Color",na),Gn("Error",Error),Gn("ResolvedImage",ao),Gn("StylePropertyFunction",Rl),Gn("StyleExpression",mc,{omit:["_evaluator"]}),Gn("ZoomDependentExpression",Oc),Gn("ZoomConstantExpression",Lc),Gn("CompoundExpression",$o,{omit:["_evaluate"]}),Kl)Kl[rs]._classRegistryKey||Gn("Expression_"+rs,Kl[rs]);function nc(a){return a&&typeof ArrayBuffer!="undefined"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function nf(a){return Yf&&a instanceof Yf}function Du(a,s){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(nc(a)||nf(a))return s&&s.push(a),a;if(ArrayBuffer.isView(a)){var c=a;return s&&s.push(c.buffer),c}if(a instanceof go)return s&&s.push(a.data.buffer),a;if(Array.isArray(a)){for(var g=[],b=0,A=a;b<A.length;b+=1)g.push(Du(A[b],s));return g}if(typeof a=="object"){var T=a.constructor,O=T._classRegistryKey;if(!O)throw new Error("can't serialize object of unregistered class");var z=T.serialize?T.serialize(a,s):{};if(!T.serialize){for(var $ in a)if(a.hasOwnProperty($)&&!(_s[O].omit.indexOf($)>=0)){var Q=a[$];z[$]=_s[O].shallow.indexOf($)>=0?Q:Du(Q,s)}a instanceof Error&&(z.message=a.message)}if(z.$name)throw new Error("$name property is reserved for worker serialization logic.");return O!=="Object"&&(z.$name=O),z}throw new Error("can't serialize object of type "+typeof a)}function Is(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||nc(a)||nf(a)||ArrayBuffer.isView(a)||a instanceof go)return a;if(Array.isArray(a))return a.map(Is);if(typeof a=="object"){var s=a.$name||"Object",c=_s[s].klass;if(!c)throw new Error("can't deserialize unregistered class "+s);if(c.deserialize)return c.deserialize(a);for(var g=Object.create(c.prototype),b=0,A=Object.keys(a);b<A.length;b+=1){var T=A[b];if(T!=="$name"){var O=a[T];g[T]=_s[s].shallow.indexOf(T)>=0?O:Is(O)}}return g}throw new Error("can't deserialize object of type "+typeof a)}var af=function(){this.first=!0};af.prototype.update=function(a,s){var c=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=c,!0))};var Sn={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function of(a){for(var s=0,c=a;s<c.length;s+=1)if(qf(c[s].charCodeAt(0)))return!0;return!1}function qf(a){return!(a!==746&&a!==747&&(a<4352||!(Sn["Bopomofo Extended"](a)||Sn.Bopomofo(a)||Sn["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Sn["CJK Compatibility Ideographs"](a)||Sn["CJK Compatibility"](a)||Sn["CJK Radicals Supplement"](a)||Sn["CJK Strokes"](a)||!(!Sn["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Sn["CJK Unified Ideographs Extension A"](a)||Sn["CJK Unified Ideographs"](a)||Sn["Enclosed CJK Letters and Months"](a)||Sn["Hangul Compatibility Jamo"](a)||Sn["Hangul Jamo Extended-A"](a)||Sn["Hangul Jamo Extended-B"](a)||Sn["Hangul Jamo"](a)||Sn["Hangul Syllables"](a)||Sn.Hiragana(a)||Sn["Ideographic Description Characters"](a)||Sn.Kanbun(a)||Sn["Kangxi Radicals"](a)||Sn["Katakana Phonetic Extensions"](a)||Sn.Katakana(a)&&a!==12540||!(!Sn["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Sn["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Sn["Unified Canadian Aboriginal Syllabics"](a)||Sn["Unified Canadian Aboriginal Syllabics Extended"](a)||Sn["Vertical Forms"](a)||Sn["Yijing Hexagram Symbols"](a)||Sn["Yi Syllables"](a)||Sn["Yi Radicals"](a))))}function Ec(a){return!(qf(a)||function(s){return!!(Sn["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Sn["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Sn["Letterlike Symbols"](s)||Sn["Number Forms"](s)||Sn["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Sn["Control Pictures"](s)&&s!==9251||Sn["Optical Character Recognition"](s)||Sn["Enclosed Alphanumerics"](s)||Sn["Geometric Shapes"](s)||Sn["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Sn["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Sn["CJK Symbols and Punctuation"](s)||Sn.Katakana(s)||Sn["Private Use Area"](s)||Sn["CJK Compatibility Forms"](s)||Sn["Small Form Variants"](s)||Sn["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(a))}function fo(a){return a>=1424&&a<=2303||Sn["Arabic Presentation Forms-A"](a)||Sn["Arabic Presentation Forms-B"](a)}function Bu(a,s){return!(!s&&fo(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Sn.Khmer(a))}function Dc(a){for(var s=0,c=a;s<c.length;s+=1)if(fo(c[s].charCodeAt(0)))return!0;return!1}var Nu=null,su="unavailable",ic=null,xp=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(su="error"),Nu&&Nu(a)};function sf(){Bc.fire(new He("pluginStateChange",{pluginStatus:su,pluginURL:ic}))}var Bc=new At,Rf=function(){return su},al=function(){if(su!=="deferred"||!ic)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");su="loading",sf(),ic&&to({url:ic},function(a){a?xp(a):(su="loaded",sf())})},dl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return su==="loaded"||dl.applyArabicShaping!=null},isLoading:function(){return su==="loading"},setState:function(a){su=a.pluginStatus,ic=a.pluginURL},isParsed:function(){return dl.applyArabicShaping!=null&&dl.processBidirectionalText!=null&&dl.processStyledBidirectionalText!=null},getPluginURL:function(){return ic}},ga=function(a,s){this.zoom=a,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new af,this.transition={})};ga.prototype.isSupportedScript=function(a){return function(s,c){for(var g=0,b=s;g<b.length;g+=1)if(!Bu(b[g].charCodeAt(0),c))return!1;return!0}(a,dl.isLoaded())},ga.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ga.prototype.getCrossfadeParameters=function(){var a=this.zoom,s=a-Math.floor(a),c=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}};var ac=function(a,s){this.property=a,this.value=s,this.expression=function(c,g){if(vc(c))return new Rl(c,g);if(Pl(c)){var b=tf(c,g);if(b.result==="error")throw new Error(b.value.map(function(T){return T.key+": "+T.message}).join(", "));return b.value}var A=c;return typeof c=="string"&&g.type==="color"&&(A=na.parse(c)),{kind:"constant",evaluate:function(){return A}}}(s===void 0?a.specification.default:s,a.specification)};ac.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},ac.prototype.possiblyEvaluate=function(a,s,c){return this.property.possiblyEvaluate(this,a,s,c)};var vl=function(a){this.property=a,this.value=new ac(a,void 0)};vl.prototype.transitioned=function(a,s){return new xs(this.property,this.value,s,jt({},a.transition,this.transition),a.now)},vl.prototype.untransitioned=function(){return new xs(this.property,this.value,null,{},0)};var Ya=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};Ya.prototype.getValue=function(a){return xt(this._values[a].value.value)},Ya.prototype.setValue=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new vl(this._values[a].property)),this._values[a].value=new ac(this._values[a].property,s===null?void 0:xt(s))},Ya.prototype.getTransition=function(a){return xt(this._values[a].transition)},Ya.prototype.setTransition=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new vl(this._values[a].property)),this._values[a].transition=xt(s)||void 0},Ya.prototype.serialize=function(){for(var a={},s=0,c=Object.keys(this._values);s<c.length;s+=1){var g=c[s],b=this.getValue(g);b!==void 0&&(a[g]=b);var A=this.getTransition(g);A!==void 0&&(a[g+"-transition"]=A)}return a},Ya.prototype.transitioned=function(a,s){for(var c=new Nc(this._properties),g=0,b=Object.keys(this._values);g<b.length;g+=1){var A=b[g];c._values[A]=this._values[A].transitioned(a,s._values[A])}return c},Ya.prototype.untransitioned=function(){for(var a=new Nc(this._properties),s=0,c=Object.keys(this._values);s<c.length;s+=1){var g=c[s];a._values[g]=this._values[g].untransitioned()}return a};var xs=function(a,s,c,g,b){this.property=a,this.value=s,this.begin=b+g.delay||0,this.end=this.begin+g.duration||0,a.specification.transition&&(g.delay||g.duration)&&(this.prior=c)};xs.prototype.possiblyEvaluate=function(a,s,c){var g=a.now||0,b=this.value.possiblyEvaluate(a,s,c),A=this.prior;if(A){if(g>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(g<this.begin)return A.possiblyEvaluate(a,s,c);var T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(A.possiblyEvaluate(a,s,c),b,function(O){if(O<=0)return 0;if(O>=1)return 1;var z=O*O,$=z*O;return 4*(O<.5?$:3*(O-z)+$-.75)}(T))}return b};var Nc=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};Nc.prototype.possiblyEvaluate=function(a,s,c){for(var g=new wa(this._properties),b=0,A=Object.keys(this._values);b<A.length;b+=1){var T=A[b];g._values[T]=this._values[T].possiblyEvaluate(a,s,c)}return g},Nc.prototype.hasTransition=function(){for(var a=0,s=Object.keys(this._values);a<s.length;a+=1)if(this._values[s[a]].prior)return!0;return!1};var Yo=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};Yo.prototype.getValue=function(a){return xt(this._values[a].value)},Yo.prototype.setValue=function(a,s){this._values[a]=new ac(this._values[a].property,s===null?void 0:xt(s))},Yo.prototype.serialize=function(){for(var a={},s=0,c=Object.keys(this._values);s<c.length;s+=1){var g=c[s],b=this.getValue(g);b!==void 0&&(a[g]=b)}return a},Yo.prototype.possiblyEvaluate=function(a,s,c){for(var g=new wa(this._properties),b=0,A=Object.keys(this._values);b<A.length;b+=1){var T=A[b];g._values[T]=this._values[T].possiblyEvaluate(a,s,c)}return g};var bu=function(a,s,c){this.property=a,this.value=s,this.parameters=c};bu.prototype.isConstant=function(){return this.value.kind==="constant"},bu.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},bu.prototype.evaluate=function(a,s,c,g){return this.property.evaluate(this.value,this.parameters,a,s,c,g)};var wa=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};wa.prototype.get=function(a){return this._values[a]};var mi=function(a){this.specification=a};mi.prototype.possiblyEvaluate=function(a,s){return a.expression.evaluate(s)},mi.prototype.interpolate=function(a,s,c){var g=xa[this.specification.type];return g?g(a,s,c):a};var ai=function(a,s){this.specification=a,this.overrides=s};ai.prototype.possiblyEvaluate=function(a,s,c,g){return new bu(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(s,null,{},c,g)}:a.expression,s)},ai.prototype.interpolate=function(a,s,c){if(a.value.kind!=="constant"||s.value.kind!=="constant")return a;if(a.value.value===void 0||s.value.value===void 0)return new bu(this,{kind:"constant",value:void 0},a.parameters);var g=xa[this.specification.type];return g?new bu(this,{kind:"constant",value:g(a.value.value,s.value.value,c)},a.parameters):a},ai.prototype.evaluate=function(a,s,c,g,b,A){return a.kind==="constant"?a.value:a.evaluate(s,c,g,b,A)};var uf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(c,g,b,A){if(c.value===void 0)return new bu(this,{kind:"constant",value:void 0},g);if(c.expression.kind==="constant"){var T=c.expression.evaluate(g,null,{},b,A),O=c.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,z=this._calculate(O,O,O,g);return new bu(this,{kind:"constant",value:z},g)}if(c.expression.kind==="camera"){var $=this._calculate(c.expression.evaluate({zoom:g.zoom-1}),c.expression.evaluate({zoom:g.zoom}),c.expression.evaluate({zoom:g.zoom+1}),g);return new bu(this,{kind:"constant",value:$},g)}return new bu(this,c.expression,g)},s.prototype.evaluate=function(c,g,b,A,T,O){if(c.kind==="source"){var z=c.evaluate(g,b,A,T,O);return this._calculate(z,z,z,g)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(g.zoom)-1},b,A),c.evaluate({zoom:Math.floor(g.zoom)},b,A),c.evaluate({zoom:Math.floor(g.zoom)+1},b,A),g):c.value},s.prototype._calculate=function(c,g,b,A){return A.zoom>A.zoomHistory.lastIntegerZoom?{from:c,to:g}:{from:b,to:g}},s.prototype.interpolate=function(c){return c},s}(ai),ks=function(a){this.specification=a};ks.prototype.possiblyEvaluate=function(a,s,c,g){if(a.value!==void 0){if(a.expression.kind==="constant"){var b=a.expression.evaluate(s,null,{},c,g);return this._calculate(b,b,b,s)}return this._calculate(a.expression.evaluate(new ga(Math.floor(s.zoom-1),s)),a.expression.evaluate(new ga(Math.floor(s.zoom),s)),a.expression.evaluate(new ga(Math.floor(s.zoom+1),s)),s)}},ks.prototype._calculate=function(a,s,c,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:a,to:s}:{from:c,to:s}},ks.prototype.interpolate=function(a){return a};var ku=function(a){this.specification=a};ku.prototype.possiblyEvaluate=function(a,s,c,g){return!!a.expression.evaluate(s,null,{},c,g)},ku.prototype.interpolate=function(){return!1};var ls=function(a){for(var s in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var c=a[s];c.specification.overridable&&this.overridableProperties.push(s);var g=this.defaultPropertyValues[s]=new ac(c,void 0),b=this.defaultTransitionablePropertyValues[s]=new vl(c);this.defaultTransitioningPropertyValues[s]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=g.possiblyEvaluate({})}};Gn("DataDrivenProperty",ai),Gn("DataConstantProperty",mi),Gn("CrossFadedDataDrivenProperty",uf),Gn("CrossFadedProperty",ks),Gn("ColorRampProperty",ku);var ol=function(a){function s(c,g){if(a.call(this),this.id=c.id,this.type=c.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},c.type!=="custom"&&(this.metadata=(c=c).metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),g.layout&&(this._unevaluatedLayout=new Yo(g.layout)),g.paint)){for(var b in this._transitionablePaint=new Ya(g.paint),c.paint)this.setPaintProperty(b,c.paint[b],{validate:!1});for(var A in c.layout)this.setLayoutProperty(A,c.layout[A],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wa(g.paint)}}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},s.prototype.getLayoutProperty=function(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)},s.prototype.setLayoutProperty=function(c,g,b){b===void 0&&(b={}),g!=null&&this._validate($f,"layers."+this.id+".layout."+c,c,g,b)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,g):this.visibility=g)},s.prototype.getPaintProperty=function(c){return ne(c,"-transition")?this._transitionablePaint.getTransition(c.slice(0,-"-transition".length)):this._transitionablePaint.getValue(c)},s.prototype.setPaintProperty=function(c,g,b){if(b===void 0&&(b={}),g!=null&&this._validate(Mh,"layers."+this.id+".paint."+c,c,g,b))return!1;if(ne(c,"-transition"))return this._transitionablePaint.setTransition(c.slice(0,-"-transition".length),g||void 0),!1;var A=this._transitionablePaint._values[c],T=A.property.specification["property-type"]==="cross-faded-data-driven",O=A.value.isDataDriven(),z=A.value;this._transitionablePaint.setValue(c,g),this._handleSpecialPaintPropertyUpdate(c);var $=this._transitionablePaint._values[c].value;return $.isDataDriven()||O||T||this._handleOverridablePaintPropertyUpdate(c,z,$)},s.prototype._handleSpecialPaintPropertyUpdate=function(c){},s.prototype._handleOverridablePaintPropertyUpdate=function(c,g,b){return!1},s.prototype.isHidden=function(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"},s.prototype.updateTransitions=function(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)},s.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},s.prototype.recalculate=function(c,g){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,g)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,g)},s.prototype.serialize=function(){var c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),It(c,function(g,b){return!(g===void 0||b==="layout"&&!Object.keys(g).length||b==="paint"&&!Object.keys(g).length)})},s.prototype._validate=function(c,g,b,A,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&bc(this,c.call(Th,{key:g,layerType:this.type,objectKey:b,value:A,styleSpec:Te,style:{glyphs:!0,sprite:!0}}))},s.prototype.is3D=function(){return!1},s.prototype.isTileClipped=function(){return!1},s.prototype.hasOffscreenPass=function(){return!1},s.prototype.resize=function(){},s.prototype.isStateDependent=function(){for(var c in this.paint._values){var g=this.paint.get(c);if(g instanceof bu&&tl(g.property.specification)&&(g.value.kind==="source"||g.value.kind==="composite")&&g.value.isStateDependent)return!0}return!1},s}(At),Vl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Kf=function(a,s){this._structArray=a,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},qa=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function zo(a,s){s===void 0&&(s=1);var c=0,g=0;return{members:a.map(function(b){var A=Vl[b.type].BYTES_PER_ELEMENT,T=c=bp(c,Math.max(s,A)),O=b.components||1;return g=Math.max(g,A),c+=A*O,{name:b.name,type:b.type,components:O,offset:T}}),size:bp(c,Math.max(g,s)),alignment:s}}function bp(a,s){return Math.ceil(a/s)*s}qa.serialize=function(a,s){return a._trim(),s&&(a.isTransferred=!0,s.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},qa.deserialize=function(a){var s=Object.create(this.prototype);return s.arrayBuffer=a.arrayBuffer,s.length=a.length,s.capacity=a.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s},qa.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},qa.prototype.clear=function(){this.length=0},qa.prototype.resize=function(a){this.reserve(a),this.length=a},qa.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}},qa.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var zc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g){var b=this.length;return this.resize(b+1),this.emplace(b,c,g)},s.prototype.emplace=function(c,g,b){var A=2*c;return this.int16[A+0]=g,this.int16[A+1]=b,c},s}(qa);zc.prototype.bytesPerElement=4,Gn("StructArrayLayout2i4",zc);var sl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g,b,A){var T=this.length;return this.resize(T+1),this.emplace(T,c,g,b,A)},s.prototype.emplace=function(c,g,b,A,T){var O=4*c;return this.int16[O+0]=g,this.int16[O+1]=b,this.int16[O+2]=A,this.int16[O+3]=T,c},s}(qa);sl.prototype.bytesPerElement=8,Gn("StructArrayLayout4i8",sl);var zu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g,b,A,T,O){var z=this.length;return this.resize(z+1),this.emplace(z,c,g,b,A,T,O)},s.prototype.emplace=function(c,g,b,A,T,O,z){var $=6*c;return this.int16[$+0]=g,this.int16[$+1]=b,this.int16[$+2]=A,this.int16[$+3]=T,this.int16[$+4]=O,this.int16[$+5]=z,c},s}(qa);zu.prototype.bytesPerElement=12,Gn("StructArrayLayout2i4i12",zu);var bs=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g,b,A,T,O){var z=this.length;return this.resize(z+1),this.emplace(z,c,g,b,A,T,O)},s.prototype.emplace=function(c,g,b,A,T,O,z){var $=4*c,Q=8*c;return this.int16[$+0]=g,this.int16[$+1]=b,this.uint8[Q+4]=A,this.uint8[Q+5]=T,this.uint8[Q+6]=O,this.uint8[Q+7]=z,c},s}(qa);bs.prototype.bytesPerElement=8,Gn("StructArrayLayout2i4ub8",bs);var Ie=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g){var b=this.length;return this.resize(b+1),this.emplace(b,c,g)},s.prototype.emplace=function(c,g,b){var A=2*c;return this.float32[A+0]=g,this.float32[A+1]=b,c},s}(qa);Ie.prototype.bytesPerElement=8,Gn("StructArrayLayout2f8",Ie);var Qs=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g,b,A,T,O,z,$,Q,re){var me=this.length;return this.resize(me+1),this.emplace(me,c,g,b,A,T,O,z,$,Q,re)},s.prototype.emplace=function(c,g,b,A,T,O,z,$,Q,re,me){var Ee=10*c;return this.uint16[Ee+0]=g,this.uint16[Ee+1]=b,this.uint16[Ee+2]=A,this.uint16[Ee+3]=T,this.uint16[Ee+4]=O,this.uint16[Ee+5]=z,this.uint16[Ee+6]=$,this.uint16[Ee+7]=Q,this.uint16[Ee+8]=re,this.uint16[Ee+9]=me,c},s}(qa);Qs.prototype.bytesPerElement=20,Gn("StructArrayLayout10ui20",Qs);var Sc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g,b,A,T,O,z,$,Q,re,me,Ee){var $e=this.length;return this.resize($e+1),this.emplace($e,c,g,b,A,T,O,z,$,Q,re,me,Ee)},s.prototype.emplace=function(c,g,b,A,T,O,z,$,Q,re,me,Ee,$e){var qe=12*c;return this.int16[qe+0]=g,this.int16[qe+1]=b,this.int16[qe+2]=A,this.int16[qe+3]=T,this.uint16[qe+4]=O,this.uint16[qe+5]=z,this.uint16[qe+6]=$,this.uint16[qe+7]=Q,this.int16[qe+8]=re,this.int16[qe+9]=me,this.int16[qe+10]=Ee,this.int16[qe+11]=$e,c},s}(qa);Sc.prototype.bytesPerElement=24,Gn("StructArrayLayout4i4ui4i24",Sc);var Js=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g,b){var A=this.length;return this.resize(A+1),this.emplace(A,c,g,b)},s.prototype.emplace=function(c,g,b,A){var T=3*c;return this.float32[T+0]=g,this.float32[T+1]=b,this.float32[T+2]=A,c},s}(qa);Js.prototype.bytesPerElement=12,Gn("StructArrayLayout3f12",Js);var Ba=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var g=this.length;return this.resize(g+1),this.emplace(g,c)},s.prototype.emplace=function(c,g){return this.uint32[1*c+0]=g,c},s}(qa);Ba.prototype.bytesPerElement=4,Gn("StructArrayLayout1ul4",Ba);var Oa=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g,b,A,T,O,z,$,Q){var re=this.length;return this.resize(re+1),this.emplace(re,c,g,b,A,T,O,z,$,Q)},s.prototype.emplace=function(c,g,b,A,T,O,z,$,Q,re){var me=10*c,Ee=5*c;return this.int16[me+0]=g,this.int16[me+1]=b,this.int16[me+2]=A,this.int16[me+3]=T,this.int16[me+4]=O,this.int16[me+5]=z,this.uint32[Ee+3]=$,this.uint16[me+8]=Q,this.uint16[me+9]=re,c},s}(qa);Oa.prototype.bytesPerElement=20,Gn("StructArrayLayout6i1ul2ui20",Oa);var Ll=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g,b,A,T,O){var z=this.length;return this.resize(z+1),this.emplace(z,c,g,b,A,T,O)},s.prototype.emplace=function(c,g,b,A,T,O,z){var $=6*c;return this.int16[$+0]=g,this.int16[$+1]=b,this.int16[$+2]=A,this.int16[$+3]=T,this.int16[$+4]=O,this.int16[$+5]=z,c},s}(qa);Ll.prototype.bytesPerElement=12,Gn("StructArrayLayout2i2i2i12",Ll);var Zu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g,b,A,T){var O=this.length;return this.resize(O+1),this.emplace(O,c,g,b,A,T)},s.prototype.emplace=function(c,g,b,A,T,O){var z=4*c,$=8*c;return this.float32[z+0]=g,this.float32[z+1]=b,this.float32[z+2]=A,this.int16[$+6]=T,this.int16[$+7]=O,c},s}(qa);Zu.prototype.bytesPerElement=16,Gn("StructArrayLayout2f1f2i16",Zu);var Gl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g,b,A){var T=this.length;return this.resize(T+1),this.emplace(T,c,g,b,A)},s.prototype.emplace=function(c,g,b,A,T){var O=12*c,z=3*c;return this.uint8[O+0]=g,this.uint8[O+1]=b,this.float32[z+1]=A,this.float32[z+2]=T,c},s}(qa);Gl.prototype.bytesPerElement=12,Gn("StructArrayLayout2ub2f12",Gl);var Zc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g,b){var A=this.length;return this.resize(A+1),this.emplace(A,c,g,b)},s.prototype.emplace=function(c,g,b,A){var T=3*c;return this.uint16[T+0]=g,this.uint16[T+1]=b,this.uint16[T+2]=A,c},s}(qa);Zc.prototype.bytesPerElement=6,Gn("StructArrayLayout3ui6",Zc);var Uc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g,b,A,T,O,z,$,Q,re,me,Ee,$e,qe,bt,st,Nt){var er=this.length;return this.resize(er+1),this.emplace(er,c,g,b,A,T,O,z,$,Q,re,me,Ee,$e,qe,bt,st,Nt)},s.prototype.emplace=function(c,g,b,A,T,O,z,$,Q,re,me,Ee,$e,qe,bt,st,Nt,er){var _r=24*c,Er=12*c,Br=48*c;return this.int16[_r+0]=g,this.int16[_r+1]=b,this.uint16[_r+2]=A,this.uint16[_r+3]=T,this.uint32[Er+2]=O,this.uint32[Er+3]=z,this.uint32[Er+4]=$,this.uint16[_r+10]=Q,this.uint16[_r+11]=re,this.uint16[_r+12]=me,this.float32[Er+7]=Ee,this.float32[Er+8]=$e,this.uint8[Br+36]=qe,this.uint8[Br+37]=bt,this.uint8[Br+38]=st,this.uint32[Er+10]=Nt,this.int16[_r+22]=er,c},s}(qa);Uc.prototype.bytesPerElement=48,Gn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Uc);var Ih=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g,b,A,T,O,z,$,Q,re,me,Ee,$e,qe,bt,st,Nt,er,_r,Er,Br,dn,Ln,xi,jn,Ai,Wn,la){var ji=this.length;return this.resize(ji+1),this.emplace(ji,c,g,b,A,T,O,z,$,Q,re,me,Ee,$e,qe,bt,st,Nt,er,_r,Er,Br,dn,Ln,xi,jn,Ai,Wn,la)},s.prototype.emplace=function(c,g,b,A,T,O,z,$,Q,re,me,Ee,$e,qe,bt,st,Nt,er,_r,Er,Br,dn,Ln,xi,jn,Ai,Wn,la,ji){var hi=34*c,Ca=17*c;return this.int16[hi+0]=g,this.int16[hi+1]=b,this.int16[hi+2]=A,this.int16[hi+3]=T,this.int16[hi+4]=O,this.int16[hi+5]=z,this.int16[hi+6]=$,this.int16[hi+7]=Q,this.uint16[hi+8]=re,this.uint16[hi+9]=me,this.uint16[hi+10]=Ee,this.uint16[hi+11]=$e,this.uint16[hi+12]=qe,this.uint16[hi+13]=bt,this.uint16[hi+14]=st,this.uint16[hi+15]=Nt,this.uint16[hi+16]=er,this.uint16[hi+17]=_r,this.uint16[hi+18]=Er,this.uint16[hi+19]=Br,this.uint16[hi+20]=dn,this.uint16[hi+21]=Ln,this.uint16[hi+22]=xi,this.uint32[Ca+12]=jn,this.float32[Ca+13]=Ai,this.float32[Ca+14]=Wn,this.float32[Ca+15]=la,this.float32[Ca+16]=ji,c},s}(qa);Ih.prototype.bytesPerElement=68,Gn("StructArrayLayout8i15ui1ul4f68",Ih);var Vc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var g=this.length;return this.resize(g+1),this.emplace(g,c)},s.prototype.emplace=function(c,g){return this.float32[1*c+0]=g,c},s}(qa);Vc.prototype.bytesPerElement=4,Gn("StructArrayLayout1f4",Vc);var Uu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g,b){var A=this.length;return this.resize(A+1),this.emplace(A,c,g,b)},s.prototype.emplace=function(c,g,b,A){var T=3*c;return this.int16[T+0]=g,this.int16[T+1]=b,this.int16[T+2]=A,c},s}(qa);Uu.prototype.bytesPerElement=6,Gn("StructArrayLayout3i6",Uu);var ul=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g,b){var A=this.length;return this.resize(A+1),this.emplace(A,c,g,b)},s.prototype.emplace=function(c,g,b,A){var T=4*c;return this.uint32[2*c+0]=g,this.uint16[T+2]=b,this.uint16[T+3]=A,c},s}(qa);ul.prototype.bytesPerElement=8,Gn("StructArrayLayout1ul2ui8",ul);var jl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g){var b=this.length;return this.resize(b+1),this.emplace(b,c,g)},s.prototype.emplace=function(c,g,b){var A=2*c;return this.uint16[A+0]=g,this.uint16[A+1]=b,c},s}(qa);jl.prototype.bytesPerElement=4,Gn("StructArrayLayout2ui4",jl);var Lf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var g=this.length;return this.resize(g+1),this.emplace(g,c)},s.prototype.emplace=function(c,g){return this.uint16[1*c+0]=g,c},s}(qa);Lf.prototype.bytesPerElement=2,Gn("StructArrayLayout1ui2",Lf);var Ti=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,g,b,A){var T=this.length;return this.resize(T+1),this.emplace(T,c,g,b,A)},s.prototype.emplace=function(c,g,b,A,T){var O=4*c;return this.float32[O+0]=g,this.float32[O+1]=b,this.float32[O+2]=A,this.float32[O+3]=T,c},s}(qa);Ti.prototype.bytesPerElement=16,Gn("StructArrayLayout4f16",Ti);var f=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return c.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},c.x1.get=function(){return this._structArray.int16[this._pos2+2]},c.y1.get=function(){return this._structArray.int16[this._pos2+3]},c.x2.get=function(){return this._structArray.int16[this._pos2+4]},c.y2.get=function(){return this._structArray.int16[this._pos2+5]},c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.anchorPoint.get=function(){return new ve(this.anchorPointX,this.anchorPointY)},Object.defineProperties(s.prototype,c),s}(Kf);f.prototype.size=20;var d=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new f(this,c)},s}(Oa);Gn("CollisionBoxArray",d);var h=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},c.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},c.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},c.segment.get=function(){return this._structArray.uint16[this._pos2+10]},c.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},c.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},c.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},c.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},c.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},c.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},c.placedOrientation.set=function(g){this._structArray.uint8[this._pos1+37]=g},c.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},c.hidden.set=function(g){this._structArray.uint8[this._pos1+38]=g},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},c.crossTileID.set=function(g){this._structArray.uint32[this._pos4+10]=g},c.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(s.prototype,c),s}(Kf);h.prototype.size=48;var y=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new h(this,c)},s}(Uc);Gn("PlacedSymbolArray",y);var C=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},c.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},c.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},c.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},c.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},c.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},c.key.get=function(){return this._structArray.uint16[this._pos2+8]},c.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},c.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},c.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},c.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},c.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},c.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},c.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},c.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},c.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},c.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},c.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},c.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},c.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},c.crossTileID.set=function(g){this._structArray.uint32[this._pos4+12]=g},c.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},c.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},c.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},c.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(s.prototype,c),s}(Kf);C.prototype.size=68;var I=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new C(this,c)},s}(Ih);Gn("SymbolInstanceArray",I);var L=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getoffsetX=function(c){return this.float32[1*c+0]},s}(Vc);Gn("GlyphOffsetArray",L);var B=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getx=function(c){return this.int16[3*c+0]},s.prototype.gety=function(c){return this.int16[3*c+1]},s.prototype.gettileUnitDistanceFromAnchor=function(c){return this.int16[3*c+2]},s}(Uu);Gn("SymbolLineVertexArray",B);var Y=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(s.prototype,c),s}(Kf);Y.prototype.size=8;var ae=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new Y(this,c)},s}(ul);Gn("FeatureIndexArray",ae);var Ce=zo([{name:"a_pos",components:2,type:"Int16"}],4).members,we=function(a){a===void 0&&(a=[]),this.segments=a};function ke(a,s){return 256*(a=Ft(Math.floor(a),0,255))+Ft(Math.floor(s),0,255)}we.prototype.prepareSegment=function(a,s,c,g){var b=this.segments[this.segments.length-1];return a>we.MAX_VERTEX_ARRAY_LENGTH&&Ct("Max vertices per segment is "+we.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!b||b.vertexLength+a>we.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==g)&&(b={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},g!==void 0&&(b.sortKey=g),this.segments.push(b)),b},we.prototype.get=function(){return this.segments},we.prototype.destroy=function(){for(var a=0,s=this.segments;a<s.length;a+=1){var c=s[a];for(var g in c.vaos)c.vaos[g].destroy()}},we.simpleSegment=function(a,s,c,g){return new we([{vertexOffset:a,primitiveOffset:s,vertexLength:c,primitiveLength:g,vaos:{},sortKey:0}])},we.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Gn("SegmentVector",we);var Qe=zo([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ye=Pe(function(a){a.exports=function(s,c){var g,b,A,T,O,z,$,Q;for(b=s.length-(g=3&s.length),A=c,O=3432918353,z=461845907,Q=0;Q<b;)$=255&s.charCodeAt(Q)|(255&s.charCodeAt(++Q))<<8|(255&s.charCodeAt(++Q))<<16|(255&s.charCodeAt(++Q))<<24,++Q,A=27492+(65535&(T=5*(65535&(A=(A^=$=(65535&($=($=(65535&$)*O+((($>>>16)*O&65535)<<16)&4294967295)<<15|$>>>17))*z+((($>>>16)*z&65535)<<16)&4294967295)<<13|A>>>19))+((5*(A>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch($=0,g){case 3:$^=(255&s.charCodeAt(Q+2))<<16;case 2:$^=(255&s.charCodeAt(Q+1))<<8;case 1:A^=$=(65535&($=($=(65535&($^=255&s.charCodeAt(Q)))*O+((($>>>16)*O&65535)<<16)&4294967295)<<15|$>>>17))*z+((($>>>16)*z&65535)<<16)&4294967295}return A^=s.length,A=2246822507*(65535&(A^=A>>>16))+((2246822507*(A>>>16)&65535)<<16)&4294967295,A=3266489909*(65535&(A^=A>>>13))+((3266489909*(A>>>16)&65535)<<16)&4294967295,(A^=A>>>16)>>>0}}),mt=Pe(function(a){a.exports=function(s,c){for(var g,b=s.length,A=c^b,T=0;b>=4;)g=1540483477*(65535&(g=255&s.charCodeAt(T)|(255&s.charCodeAt(++T))<<8|(255&s.charCodeAt(++T))<<16|(255&s.charCodeAt(++T))<<24))+((1540483477*(g>>>16)&65535)<<16),A=1540483477*(65535&A)+((1540483477*(A>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),b-=4,++T;switch(b){case 3:A^=(255&s.charCodeAt(T+2))<<16;case 2:A^=(255&s.charCodeAt(T+1))<<8;case 1:A=1540483477*(65535&(A^=255&s.charCodeAt(T)))+((1540483477*(A>>>16)&65535)<<16)}return A=1540483477*(65535&(A^=A>>>13))+((1540483477*(A>>>16)&65535)<<16),(A^=A>>>15)>>>0}}),je=Ye,dt=mt;je.murmur3=Ye,je.murmur2=dt;var vt=function(){this.ids=[],this.positions=[],this.indexed=!1};vt.prototype.add=function(a,s,c,g){this.ids.push(Sr(a)),this.positions.push(s,c,g)},vt.prototype.getPositions=function(a){for(var s=Sr(a),c=0,g=this.ids.length-1;c<g;){var b=c+g>>1;this.ids[b]>=s?g=b:c=b+1}for(var A=[];this.ids[c]===s;)A.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return A},vt.serialize=function(a,s){var c=new Float64Array(a.ids),g=new Uint32Array(a.positions);return function b(A,T,O,z){for(;O<z;){for(var $=A[O+z>>1],Q=O-1,re=z+1;;){do Q++;while(A[Q]<$);do re--;while(A[re]>$);if(Q>=re)break;yr(A,Q,re),yr(T,3*Q,3*re),yr(T,3*Q+1,3*re+1),yr(T,3*Q+2,3*re+2)}re-O<z-re?(b(A,T,O,re),O=re+1):(b(A,T,re+1,z),z=re)}}(c,g,0,c.length-1),s&&s.push(c.buffer,g.buffer),{ids:c,positions:g}},vt.deserialize=function(a){var s=new vt;return s.ids=a.ids,s.positions=a.positions,s.indexed=!0,s};var $t=Math.pow(2,53)-1;function Sr(a){var s=+a;return!isNaN(s)&&s<=$t?s:je(String(a))}function yr(a,s,c){var g=a[s];a[s]=a[c],a[c]=g}Gn("FeaturePositionMap",vt);var wr=function(a,s){this.gl=a.gl,this.location=s},Xr=function(a){function s(c,g){a.call(this,c,g),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))},s}(wr),yn=function(a){function s(c,g){a.call(this,c,g),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))},s}(wr),ln=function(a){function s(c,g){a.call(this,c,g),this.current=[0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))},s}(wr),Bn=function(a){function s(c,g){a.call(this,c,g),this.current=[0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))},s}(wr),ei=function(a){function s(c,g){a.call(this,c,g),this.current=[0,0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))},s}(wr),_i=function(a){function s(c,g){a.call(this,c,g),this.current=na.transparent}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))},s}(wr),gi=new Float32Array(16),Ki=function(a){function s(c,g){a.call(this,c,g),this.current=gi}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(var g=1;g<16;g++)if(c[g]!==this.current[g]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}},s}(wr);function Nn(a){return[ke(255*a.r,255*a.g),ke(255*a.b,255*a.a)]}var Hi=function(a,s,c){this.value=a,this.uniformNames=s.map(function(g){return"u_"+g}),this.type=c};Hi.prototype.setUniform=function(a,s,c){a.set(c.constantOr(this.value))},Hi.prototype.getBinding=function(a,s,c){return this.type==="color"?new _i(a,s):new yn(a,s)};var Qi=function(a,s){this.uniformNames=s.map(function(c){return"u_"+c}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Qi.prototype.setConstantPatternPositions=function(a,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=a.tlbr},Qi.prototype.setUniform=function(a,s,c,g){var b=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&a.set(b)},Qi.prototype.getBinding=function(a,s,c){return c.substr(0,9)==="u_pattern"?new ei(a,s):new yn(a,s)};var Li=function(a,s,c,g){this.expression=a,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(function(b){return{name:"a_"+b,type:"Float32",components:c==="color"?2:1,offset:0}}),this.paintVertexArray=new g};Li.prototype.populatePaintArray=function(a,s,c,g,b){var A=this.paintVertexArray.length,T=this.expression.evaluate(new ga(0),s,{},g,[],b);this.paintVertexArray.resize(a),this._setPaintValue(A,a,T)},Li.prototype.updatePaintArray=function(a,s,c,g){var b=this.expression.evaluate({zoom:0},c,g);this._setPaintValue(a,s,b)},Li.prototype._setPaintValue=function(a,s,c){if(this.type==="color")for(var g=Nn(c),b=a;b<s;b++)this.paintVertexArray.emplace(b,g[0],g[1]);else{for(var A=a;A<s;A++)this.paintVertexArray.emplace(A,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}},Li.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Li.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var yi=function(a,s,c,g,b,A){this.expression=a,this.uniformNames=s.map(function(T){return"u_"+T+"_t"}),this.type=c,this.useIntegerZoom=g,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=s.map(function(T){return{name:"a_"+T,type:"Float32",components:c==="color"?4:2,offset:0}}),this.paintVertexArray=new A};yi.prototype.populatePaintArray=function(a,s,c,g,b){var A=this.expression.evaluate(new ga(this.zoom),s,{},g,[],b),T=this.expression.evaluate(new ga(this.zoom+1),s,{},g,[],b),O=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(O,a,A,T)},yi.prototype.updatePaintArray=function(a,s,c,g){var b=this.expression.evaluate({zoom:this.zoom},c,g),A=this.expression.evaluate({zoom:this.zoom+1},c,g);this._setPaintValue(a,s,b,A)},yi.prototype._setPaintValue=function(a,s,c,g){if(this.type==="color")for(var b=Nn(c),A=Nn(g),T=a;T<s;T++)this.paintVertexArray.emplace(T,b[0],b[1],A[0],A[1]);else{for(var O=a;O<s;O++)this.paintVertexArray.emplace(O,c,g);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(g))}},yi.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},yi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},yi.prototype.setUniform=function(a,s){var c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,g=Ft(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);a.set(g)},yi.prototype.getBinding=function(a,s,c){return new yn(a,s)};var ia=function(a,s,c,g,b,A){this.expression=a,this.type=s,this.useIntegerZoom=c,this.zoom=g,this.layerId=A,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b};ia.prototype.populatePaintArray=function(a,s,c){var g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(g,a,s.patterns&&s.patterns[this.layerId],c)},ia.prototype.updatePaintArray=function(a,s,c,g,b){this._setPaintValues(a,s,c.patterns&&c.patterns[this.layerId],b)},ia.prototype._setPaintValues=function(a,s,c,g){if(g&&c){var b=g[c.min],A=g[c.mid],T=g[c.max];if(b&&A&&T)for(var O=a;O<s;O++)this.zoomInPaintVertexArray.emplace(O,A.tl[0],A.tl[1],A.br[0],A.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],A.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,A.tl[0],A.tl[1],A.br[0],A.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],A.pixelRatio,T.pixelRatio)}},ia.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,Qe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,Qe.members,this.expression.isStateDependent))},ia.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Ii=function(a,s,c){this.binders={},this._buffers=[];var g=[];for(var b in a.paint._values)if(c(b)){var A=a.paint.get(b);if(A instanceof bu&&tl(A.property.specification)){var T=cs(b,a.type),O=A.value,z=A.property.specification.type,$=A.property.useIntegerZoom,Q=A.property.specification["property-type"],re=Q==="cross-faded"||Q==="cross-faded-data-driven";if(O.kind==="constant")this.binders[b]=re?new Qi(O.value,T):new Hi(O.value,T,z),g.push("/u_"+b);else if(O.kind==="source"||re){var me=Po(b,z,"source");this.binders[b]=re?new ia(O,z,$,s,me,a.id):new Li(O,T,z,me),g.push("/a_"+b)}else{var Ee=Po(b,z,"composite");this.binders[b]=new yi(O,T,z,$,s,Ee),g.push("/z_"+b)}}}this.cacheKey=g.sort().join("")};Ii.prototype.getMaxValue=function(a){var s=this.binders[a];return s instanceof Li||s instanceof yi?s.maxValue:0},Ii.prototype.populatePaintArrays=function(a,s,c,g,b){for(var A in this.binders){var T=this.binders[A];(T instanceof Li||T instanceof yi||T instanceof ia)&&T.populatePaintArray(a,s,c,g,b)}},Ii.prototype.setConstantPatternPositions=function(a,s){for(var c in this.binders){var g=this.binders[c];g instanceof Qi&&g.setConstantPatternPositions(a,s)}},Ii.prototype.updatePaintArrays=function(a,s,c,g,b){var A=!1;for(var T in a)for(var O=0,z=s.getPositions(T);O<z.length;O+=1){var $=z[O],Q=c.feature($.index);for(var re in this.binders){var me=this.binders[re];if((me instanceof Li||me instanceof yi||me instanceof ia)&&me.expression.isStateDependent===!0){var Ee=g.paint.get(re);me.expression=Ee.value,me.updatePaintArray($.start,$.end,Q,a[T],b),A=!0}}}return A},Ii.prototype.defines=function(){var a=[];for(var s in this.binders){var c=this.binders[s];(c instanceof Hi||c instanceof Qi)&&a.push.apply(a,c.uniformNames.map(function(g){return"#define HAS_UNIFORM_"+g}))}return a},Ii.prototype.getBinderAttributes=function(){var a=[];for(var s in this.binders){var c=this.binders[s];if(c instanceof Li||c instanceof yi)for(var g=0;g<c.paintVertexAttributes.length;g++)a.push(c.paintVertexAttributes[g].name);else if(c instanceof ia)for(var b=0;b<Qe.members.length;b++)a.push(Qe.members[b].name)}return a},Ii.prototype.getBinderUniforms=function(){var a=[];for(var s in this.binders){var c=this.binders[s];if(c instanceof Hi||c instanceof Qi||c instanceof yi)for(var g=0,b=c.uniformNames;g<b.length;g+=1)a.push(b[g])}return a},Ii.prototype.getPaintVertexBuffers=function(){return this._buffers},Ii.prototype.getUniforms=function(a,s){var c=[];for(var g in this.binders){var b=this.binders[g];if(b instanceof Hi||b instanceof Qi||b instanceof yi)for(var A=0,T=b.uniformNames;A<T.length;A+=1){var O=T[A];if(s[O]){var z=b.getBinding(a,s[O],O);c.push({name:O,property:g,binding:z})}}}return c},Ii.prototype.setUniforms=function(a,s,c,g){for(var b=0,A=s;b<A.length;b+=1){var T=A[b],O=T.name,z=T.property;this.binders[z].setUniform(T.binding,g,c.get(z),O)}},Ii.prototype.updatePaintBuffers=function(a){for(var s in this._buffers=[],this.binders){var c=this.binders[s];if(a&&c instanceof ia){var g=a.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(c instanceof Li||c instanceof yi)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}},Ii.prototype.upload=function(a){for(var s in this.binders){var c=this.binders[s];(c instanceof Li||c instanceof yi||c instanceof ia)&&c.upload(a)}this.updatePaintBuffers()},Ii.prototype.destroy=function(){for(var a in this.binders){var s=this.binders[a];(s instanceof Li||s instanceof yi||s instanceof ia)&&s.destroy()}};var wi=function(a,s,c){c===void 0&&(c=function(){return!0}),this.programConfigurations={};for(var g=0,b=a;g<b.length;g+=1){var A=b[g];this.programConfigurations[A.id]=new Ii(A,s,c)}this.needsUpload=!1,this._featureMap=new vt,this._bufferOffset=0};function cs(a,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(s+"-","").replace(/-/g,"_")]}function Po(a,s,c){var g={color:{source:Ie,composite:Ti},number:{source:Vc,composite:Ie}},b=function(A){return{"line-pattern":{source:Qs,composite:Qs},"fill-pattern":{source:Qs,composite:Qs},"fill-extrusion-pattern":{source:Qs,composite:Qs}}[A]}(a);return b&&b[c]||g[s][c]}wi.prototype.populatePaintArrays=function(a,s,c,g,b,A){for(var T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(a,s,g,b,A);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},wi.prototype.updatePaintArrays=function(a,s,c,g){for(var b=0,A=c;b<A.length;b+=1){var T=A[b];this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(a,this._featureMap,s,T,g)||this.needsUpload}},wi.prototype.get=function(a){return this.programConfigurations[a]},wi.prototype.upload=function(a){if(this.needsUpload){for(var s in this.programConfigurations)this.programConfigurations[s].upload(a);this.needsUpload=!1}},wi.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},Gn("ConstantBinder",Hi),Gn("CrossFadedConstantBinder",Qi),Gn("SourceExpressionBinder",Li),Gn("CrossFadedCompositeBinder",ia),Gn("CompositeExpressionBinder",yi),Gn("ProgramConfiguration",Ii,{omit:["_buffers"]}),Gn("ProgramConfigurationSet",wi);var ro=Math.pow(2,14)-1,Ps=-ro-1;function Zo(a){for(var s=8192/a.extent,c=a.loadGeometry(),g=0;g<c.length;g++)for(var b=c[g],A=0;A<b.length;A++){var T=b[A],O=Math.round(T.x*s),z=Math.round(T.y*s);T.x=Ft(O,Ps,ro),T.y=Ft(z,Ps,ro),(O<T.x||O>T.x+1||z<T.y||z>T.y+1)&&Ct("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return c}function wo(a,s){return{type:a.type,id:a.id,properties:a.properties,geometry:s?Zo(a):[]}}function uu(a,s,c,g,b){a.emplaceBack(2*s+(g+1)/2,2*c+(b+1)/2)}var Rs=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new zc,this.indexArray=new Zc,this.segments=new we,this.programConfigurations=new wi(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function Vu(a,s){for(var c=0;c<a.length;c++)if(ju(s,a[c]))return!0;for(var g=0;g<s.length;g++)if(ju(a,s[g]))return!0;return!!Es(a,s)}function lu(a,s,c){return!!ju(a,s)||!!wc(s,a,c)}function qo(a,s){if(a.length===1)return Ff(s,a[0]);for(var c=0;c<s.length;c++)for(var g=s[c],b=0;b<g.length;b++)if(ju(a,g[b]))return!0;for(var A=0;A<a.length;A++)if(Ff(s,a[A]))return!0;for(var T=0;T<s.length;T++)if(Es(a,s[T]))return!0;return!1}function Gu(a,s,c){if(a.length>1){if(Es(a,s))return!0;for(var g=0;g<s.length;g++)if(wc(s[g],a,c))return!0}for(var b=0;b<a.length;b++)if(wc(a[b],s,c))return!0;return!1}function Es(a,s){if(a.length===0||s.length===0)return!1;for(var c=0;c<a.length-1;c++)for(var g=a[c],b=a[c+1],A=0;A<s.length-1;A++)if(Of(g,b,s[A],s[A+1]))return!0;return!1}function Of(a,s,c,g){return br(a,c,g)!==br(s,c,g)&&br(a,s,c)!==br(a,s,g)}function wc(a,s,c){var g=c*c;if(s.length===1)return a.distSqr(s[0])<g;for(var b=1;b<s.length;b++)if(Gc(a,s[b-1],s[b])<g)return!0;return!1}function Gc(a,s,c){var g=s.distSqr(c);if(g===0)return a.distSqr(s);var b=((a.x-s.x)*(c.x-s.x)+(a.y-s.y)*(c.y-s.y))/g;return a.distSqr(b<0?s:b>1?c:c.sub(s)._mult(b)._add(s))}function Ff(a,s){for(var c,g,b,A=!1,T=0;T<a.length;T++)for(var O=0,z=(c=a[T]).length-1;O<c.length;z=O++)(g=c[O]).y>s.y!=(b=c[z]).y>s.y&&s.x<(b.x-g.x)*(s.y-g.y)/(b.y-g.y)+g.x&&(A=!A);return A}function ju(a,s){for(var c=!1,g=0,b=a.length-1;g<a.length;b=g++){var A=a[g],T=a[b];A.y>s.y!=T.y>s.y&&s.x<(T.x-A.x)*(s.y-A.y)/(T.y-A.y)+A.x&&(c=!c)}return c}function Ol(a,s,c){var g=c[0],b=c[2];if(a.x<g.x&&s.x<g.x||a.x>b.x&&s.x>b.x||a.y<g.y&&s.y<g.y||a.y>b.y&&s.y>b.y)return!1;var A=br(a,s,c[0]);return A!==br(a,s,c[1])||A!==br(a,s,c[2])||A!==br(a,s,c[3])}function ml(a,s,c){var g=s.paint.get(a).value;return g.kind==="constant"?g.value:c.programConfigurations.get(s.id).getMaxValue(a)}function ns(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Hu(a,s,c,g,b){if(!s[0]&&!s[1])return a;var A=ve.convert(s)._mult(b);c==="viewport"&&A._rotate(-g);for(var T=[],O=0;O<a.length;O++)T.push(a[O].sub(A));return T}Rs.prototype.populate=function(a,s,c){var g=this.layers[0],b=[],A=null;g.type==="circle"&&(A=g.layout.get("circle-sort-key"));for(var T=0,O=a;T<O.length;T+=1){var z=O[T],$=z.feature,Q=z.id,re=z.index,me=z.sourceLayerIndex,Ee=this.layers[0]._featureFilter.needGeometry,$e=wo($,Ee);if(this.layers[0]._featureFilter.filter(new ga(this.zoom),$e,c)){var qe=A?A.evaluate($e,{},c):void 0,bt={id:Q,properties:$.properties,type:$.type,sourceLayerIndex:me,index:re,geometry:Ee?$e.geometry:Zo($),patterns:{},sortKey:qe};b.push(bt)}}A&&b.sort(function(Ln,xi){return Ln.sortKey-xi.sortKey});for(var st=0,Nt=b;st<Nt.length;st+=1){var er=Nt[st],_r=er.geometry,Er=er.index,Br=er.sourceLayerIndex,dn=a[Er].feature;this.addFeature(er,_r,Er,c),s.featureIndex.insert(dn,_r,Er,Br,this.index)}},Rs.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},Rs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Rs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Rs.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Ce),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Rs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Rs.prototype.addFeature=function(a,s,c,g){for(var b=0,A=s;b<A.length;b+=1)for(var T=0,O=A[b];T<O.length;T+=1){var z=O[T],$=z.x,Q=z.y;if(!($<0||$>=8192||Q<0||Q>=8192)){var re=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),me=re.vertexLength;uu(this.layoutVertexArray,$,Q,-1,-1),uu(this.layoutVertexArray,$,Q,1,-1),uu(this.layoutVertexArray,$,Q,1,1),uu(this.layoutVertexArray,$,Q,-1,1),this.indexArray.emplaceBack(me,me+1,me+2),this.indexArray.emplaceBack(me,me+3,me+2),re.vertexLength+=4,re.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,{},g)},Gn("CircleBucket",Rs,{omit:["layers"]});var oc=new ls({"circle-sort-key":new ai(Te.layout_circle["circle-sort-key"])}),Ac={paint:new ls({"circle-radius":new ai(Te.paint_circle["circle-radius"]),"circle-color":new ai(Te.paint_circle["circle-color"]),"circle-blur":new ai(Te.paint_circle["circle-blur"]),"circle-opacity":new ai(Te.paint_circle["circle-opacity"]),"circle-translate":new mi(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new mi(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new mi(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new mi(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ai(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ai(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ai(Te.paint_circle["circle-stroke-opacity"])}),layout:oc},Na=typeof Float32Array!="undefined"?Float32Array:Array;function ll(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Eu(a,s,c){var g=s[0],b=s[1],A=s[2],T=s[3],O=s[4],z=s[5],$=s[6],Q=s[7],re=s[8],me=s[9],Ee=s[10],$e=s[11],qe=s[12],bt=s[13],st=s[14],Nt=s[15],er=c[0],_r=c[1],Er=c[2],Br=c[3];return a[0]=er*g+_r*O+Er*re+Br*qe,a[1]=er*b+_r*z+Er*me+Br*bt,a[2]=er*A+_r*$+Er*Ee+Br*st,a[3]=er*T+_r*Q+Er*$e+Br*Nt,a[4]=(er=c[4])*g+(_r=c[5])*O+(Er=c[6])*re+(Br=c[7])*qe,a[5]=er*b+_r*z+Er*me+Br*bt,a[6]=er*A+_r*$+Er*Ee+Br*st,a[7]=er*T+_r*Q+Er*$e+Br*Nt,a[8]=(er=c[8])*g+(_r=c[9])*O+(Er=c[10])*re+(Br=c[11])*qe,a[9]=er*b+_r*z+Er*me+Br*bt,a[10]=er*A+_r*$+Er*Ee+Br*st,a[11]=er*T+_r*Q+Er*$e+Br*Nt,a[12]=(er=c[12])*g+(_r=c[13])*O+(Er=c[14])*re+(Br=c[15])*qe,a[13]=er*b+_r*z+Er*me+Br*bt,a[14]=er*A+_r*$+Er*Ee+Br*st,a[15]=er*T+_r*Q+Er*$e+Br*Nt,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,s=0,c=arguments.length;c--;)s+=a[c]*a[c];return Math.sqrt(s)});var jc,gl=Eu;function Df(a,s,c){var g=s[0],b=s[1],A=s[2],T=s[3];return a[0]=c[0]*g+c[4]*b+c[8]*A+c[12]*T,a[1]=c[1]*g+c[5]*b+c[9]*A+c[13]*T,a[2]=c[2]*g+c[6]*b+c[10]*A+c[14]*T,a[3]=c[3]*g+c[7]*b+c[11]*A+c[15]*T,a}jc=new Na(3),Na!=Float32Array&&(jc[0]=0,jc[1]=0,jc[2]=0),function(){var a=new Na(4);Na!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var Bf=(function(){var a=new Na(2);Na!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function s(c){a.call(this,c,Ac)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new Rs(c)},s.prototype.queryRadius=function(c){var g=c;return ml("circle-radius",this,g)+ml("circle-stroke-width",this,g)+ns(this.paint.get("circle-translate"))},s.prototype.queryIntersectsFeature=function(c,g,b,A,T,O,z,$){for(var Q=Hu(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),O.angle,z),re=this.paint.get("circle-radius").evaluate(g,b)+this.paint.get("circle-stroke-width").evaluate(g,b),me=this.paint.get("circle-pitch-alignment")==="map",Ee=me?Q:function(dn,Ln){return dn.map(function(xi){return Fl(xi,Ln)})}(Q,$),$e=me?re*z:re,qe=0,bt=A;qe<bt.length;qe+=1)for(var st=0,Nt=bt[qe];st<Nt.length;st+=1){var er=Nt[st],_r=me?er:Fl(er,$),Er=$e,Br=Df([],[er.x,er.y,0,1],$);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Er*=Br[3]/O.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Er*=O.cameraToCenterDistance/Br[3]),lu(Ee,_r,Er))return!0}return!1},s}(ol));function Fl(a,s){var c=Df([],[a.x,a.y,0,1],s);return new ve(c[0]/c[3],c[1]/c[3])}var lf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Rs);function yl(a,s,c,g){var b=s.width,A=s.height;if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==b*A*c)throw new RangeError("mismatched image size")}else g=new Uint8Array(b*A*c);return a.width=b,a.height=A,a.data=g,a}function sc(a,s,c){var g=s.width,b=s.height;if(g!==a.width||b!==a.height){var A=yl({},{width:g,height:b},c);Qf(a,A,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,g),height:Math.min(a.height,b)},c),a.width=g,a.height=b,a.data=A.data}}function Qf(a,s,c,g,b,A){if(b.width===0||b.height===0)return s;if(b.width>a.width||b.height>a.height||c.x>a.width-b.width||c.y>a.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>s.width||b.height>s.height||g.x>s.width-b.width||g.y>s.height-b.height)throw new RangeError("out of range destination coordinates for image copy");for(var T=a.data,O=s.data,z=0;z<b.height;z++)for(var $=((c.y+z)*a.width+c.x)*A,Q=((g.y+z)*s.width+g.x)*A,re=0;re<b.width*A;re++)O[Q+re]=T[$+re];return s}Gn("HeatmapBucket",lf,{omit:["layers"]});var Su=function(a,s){yl(this,a,1,s)};Su.prototype.resize=function(a){sc(this,a,1)},Su.prototype.clone=function(){return new Su({width:this.width,height:this.height},new Uint8Array(this.data))},Su.copy=function(a,s,c,g,b){Qf(a,s,c,g,b,1)};var Xs=function(a,s){yl(this,a,4,s)};Xs.prototype.resize=function(a){sc(this,a,4)},Xs.prototype.replace=function(a,s){s?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},Xs.prototype.clone=function(){return new Xs({width:this.width,height:this.height},new Uint8Array(this.data))},Xs.copy=function(a,s,c,g,b){Qf(a,s,c,g,b,4)},Gn("AlphaImage",Su),Gn("RGBAImage",Xs);var cf={paint:new ls({"heatmap-radius":new ai(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ai(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new mi(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ku(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new mi(Te.paint_heatmap["heatmap-opacity"])})};function Jf(a){var s={},c=a.resolution||256,g=a.clips?a.clips.length:1,b=a.image||new Xs({width:c,height:g}),A=function($e,qe,bt){s[a.evaluationKey]=bt;var st=a.expression.evaluate(s);b.data[$e+qe+0]=Math.floor(255*st.r/st.a),b.data[$e+qe+1]=Math.floor(255*st.g/st.a),b.data[$e+qe+2]=Math.floor(255*st.b/st.a),b.data[$e+qe+3]=Math.floor(255*st.a)};if(a.clips)for(var T=0,O=0;T<g;++T,O+=4*c)for(var z=0,$=0;z<c;z++,$+=4){var Q=z/(c-1),re=a.clips[T];A(O,$,re.start*(1-Q)+re.end*Q)}else for(var me=0,Ee=0;me<c;me++,Ee+=4)A(0,Ee,me/(c-1));return b}var zp=function(a){function s(c){a.call(this,c,cf),this._updateColorRamp()}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new lf(c)},s.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="heatmap-color"&&this._updateColorRamp()},s.prototype._updateColorRamp=function(){this.colorRamp=Jf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},s.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},s}(ol),kh={paint:new ls({"hillshade-illumination-direction":new mi(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new mi(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new mi(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new mi(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new mi(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new mi(Te.paint_hillshade["hillshade-accent-color"])})},Ep=function(a){function s(c){a.call(this,c,kh)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},s}(ol),Yh=zo([{name:"a_pos",components:2,type:"Int16"}],4).members,ff=Sp,eh=Sp;function Sp(a,s,c){c=c||2;var g,b,A,T,O,z,$,Q=s&&s.length,re=Q?s[0]*c:a.length,me=wp(a,0,re,c,!0),Ee=[];if(!me||me.next===me.prev)return Ee;if(Q&&(me=function(qe,bt,st,Nt){var er,_r,Er,Br=[];for(er=0,_r=bt.length;er<_r;er++)(Er=wp(qe,bt[er]*Nt,er<_r-1?bt[er+1]*Nt:qe.length,Nt,!1))===Er.next&&(Er.steiner=!0),Br.push(Qh(Er));for(Br.sort(md),er=0;er<Br.length;er++)uc(Br[er],st),st=ya(st,st.next);return st}(a,s,me,c)),a.length>80*c){g=A=a[0],b=T=a[1];for(var $e=c;$e<re;$e+=c)(O=a[$e])<g&&(g=O),(z=a[$e+1])<b&&(b=z),O>A&&(A=O),z>T&&(T=z);$=($=Math.max(A-g,T-b))!==0?1/$:0}return qh(me,Ee,c,g,b,$),Ee}function wp(a,s,c,g,b){var A,T;if(b===lc(a,s,c,g)>0)for(A=s;A<c;A+=g)T=hf(A,a[A],a[A+1],T);else for(A=c-g;A>=s;A-=g)T=hf(A,a[A],a[A+1],T);return T&&fs(T,T.next)&&(Wc(T),T=T.next),T}function ya(a,s){if(!a)return a;s||(s=a);var c,g=a;do if(c=!1,g.steiner||!fs(g,g.next)&&yo(g.prev,g,g.next)!==0)g=g.next;else{if(Wc(g),(g=s=g.prev)===g.next)break;c=!0}while(c||g!==s);return s}function qh(a,s,c,g,b,A,T){if(a){!T&&A&&function(Q,re,me,Ee){var $e=Q;do $e.z===null&&($e.z=Nf($e.x,$e.y,re,me,Ee)),$e.prevZ=$e.prev,$e.nextZ=$e.next,$e=$e.next;while($e!==Q);$e.prevZ.nextZ=null,$e.prevZ=null,function(qe){var bt,st,Nt,er,_r,Er,Br,dn,Ln=1;do{for(st=qe,qe=null,_r=null,Er=0;st;){for(Er++,Nt=st,Br=0,bt=0;bt<Ln&&(Br++,Nt=Nt.nextZ);bt++);for(dn=Ln;Br>0||dn>0&&Nt;)Br!==0&&(dn===0||!Nt||st.z<=Nt.z)?(er=st,st=st.nextZ,Br--):(er=Nt,Nt=Nt.nextZ,dn--),_r?_r.nextZ=er:qe=er,er.prevZ=_r,_r=er;st=Nt}_r.nextZ=null,Ln*=2}while(Er>1)}($e)}(a,g,b,A);for(var O,z,$=a;a.prev!==a.next;)if(O=a.prev,z=a.next,A?Kh(a,g,b,A):vd(a))s.push(O.i/c),s.push(a.i/c),s.push(z.i/c),Wc(a),a=z.next,$=z.next;else if((a=z)===$){T?T===1?qh(a=th(ya(a),s,c),s,c,g,b,A,2):T===2&&Zp(a,s,c,g,b,A):qh(ya(a),s,c,g,b,A,1);break}}}function vd(a){var s=a.prev,c=a,g=a.next;if(yo(s,c,g)>=0)return!1;for(var b=a.next.next;b!==a.prev;){if(rh(s.x,s.y,c.x,c.y,g.x,g.y,b.x,b.y)&&yo(b.prev,b,b.next)>=0)return!1;b=b.next}return!0}function Kh(a,s,c,g){var b=a.prev,A=a,T=a.next;if(yo(b,A,T)>=0)return!1;for(var O=b.x>A.x?b.x>T.x?b.x:T.x:A.x>T.x?A.x:T.x,z=b.y>A.y?b.y>T.y?b.y:T.y:A.y>T.y?A.y:T.y,$=Nf(b.x<A.x?b.x<T.x?b.x:T.x:A.x<T.x?A.x:T.x,b.y<A.y?b.y<T.y?b.y:T.y:A.y<T.y?A.y:T.y,s,c,g),Q=Nf(O,z,s,c,g),re=a.prevZ,me=a.nextZ;re&&re.z>=$&&me&&me.z<=Q;){if(re!==a.prev&&re!==a.next&&rh(b.x,b.y,A.x,A.y,T.x,T.y,re.x,re.y)&&yo(re.prev,re,re.next)>=0||(re=re.prevZ,me!==a.prev&&me!==a.next&&rh(b.x,b.y,A.x,A.y,T.x,T.y,me.x,me.y)&&yo(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;re&&re.z>=$;){if(re!==a.prev&&re!==a.next&&rh(b.x,b.y,A.x,A.y,T.x,T.y,re.x,re.y)&&yo(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;me&&me.z<=Q;){if(me!==a.prev&&me!==a.next&&rh(b.x,b.y,A.x,A.y,T.x,T.y,me.x,me.y)&&yo(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function th(a,s,c){var g=a;do{var b=g.prev,A=g.next.next;!fs(b,A)&&Ph(b,g,g.next,A)&&nh(b,A)&&nh(A,b)&&(s.push(b.i/c),s.push(g.i/c),s.push(A.i/c),Wc(g),Wc(g.next),g=a=A),g=g.next}while(g!==a);return ya(g)}function Zp(a,s,c,g,b,A){var T=a;do{for(var O=T.next.next;O!==T.prev;){if(T.i!==O.i&&Uo(T,O)){var z=ih(T,O);return T=ya(T,T.next),z=ya(z,z.next),qh(T,s,c,g,b,A),void qh(z,s,c,g,b,A)}O=O.next}T=T.next}while(T!==a)}function md(a,s){return a.x-s.x}function uc(a,s){if(s=function(g,b){var A,T=b,O=g.x,z=g.y,$=-1/0;do{if(z<=T.y&&z>=T.next.y&&T.next.y!==T.y){var Q=T.x+(z-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(Q<=O&&Q>$){if($=Q,Q===O){if(z===T.y)return T;if(z===T.next.y)return T.next}A=T.x<T.next.x?T:T.next}}T=T.next}while(T!==b);if(!A)return null;if(O===$)return A;var re,me=A,Ee=A.x,$e=A.y,qe=1/0;T=A;do O>=T.x&&T.x>=Ee&&O!==T.x&&rh(z<$e?O:$,z,Ee,$e,z<$e?$:O,z,T.x,T.y)&&(re=Math.abs(z-T.y)/(O-T.x),nh(T,g)&&(re<qe||re===qe&&(T.x>A.x||T.x===A.x&&gd(A,T)))&&(A=T,qe=re)),T=T.next;while(T!==me);return A}(a,s)){var c=ih(s,a);ya(s,s.next),ya(c,c.next)}}function gd(a,s){return yo(a.prev,a,s.prev)<0&&yo(s.next,a,a.next)<0}function Nf(a,s,c,g,b){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-c)*b)|a<<8))|a<<4))|a<<2))|a<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-g)*b)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function Qh(a){var s=a,c=a;do(s.x<c.x||s.x===c.x&&s.y<c.y)&&(c=s),s=s.next;while(s!==a);return c}function rh(a,s,c,g,b,A,T,O){return(b-T)*(s-O)-(a-T)*(A-O)>=0&&(a-T)*(g-O)-(c-T)*(s-O)>=0&&(c-T)*(A-O)-(b-T)*(g-O)>=0}function Uo(a,s){return a.next.i!==s.i&&a.prev.i!==s.i&&!function(c,g){var b=c;do{if(b.i!==c.i&&b.next.i!==c.i&&b.i!==g.i&&b.next.i!==g.i&&Ph(b,b.next,c,g))return!0;b=b.next}while(b!==c);return!1}(a,s)&&(nh(a,s)&&nh(s,a)&&function(c,g){var b=c,A=!1,T=(c.x+g.x)/2,O=(c.y+g.y)/2;do b.y>O!=b.next.y>O&&b.next.y!==b.y&&T<(b.next.x-b.x)*(O-b.y)/(b.next.y-b.y)+b.x&&(A=!A),b=b.next;while(b!==c);return A}(a,s)&&(yo(a.prev,a,s.prev)||yo(a,s.prev,s))||fs(a,s)&&yo(a.prev,a,a.next)>0&&yo(s.prev,s,s.next)>0)}function yo(a,s,c){return(s.y-a.y)*(c.x-s.x)-(s.x-a.x)*(c.y-s.y)}function fs(a,s){return a.x===s.x&&a.y===s.y}function Ph(a,s,c,g){var b=wu(yo(a,s,c)),A=wu(yo(a,s,g)),T=wu(yo(c,g,a)),O=wu(yo(c,g,s));return b!==A&&T!==O||!(b!==0||!Hc(a,c,s))||!(A!==0||!Hc(a,g,s))||!(T!==0||!Hc(c,a,g))||!(O!==0||!Hc(c,s,g))}function Hc(a,s,c){return s.x<=Math.max(a.x,c.x)&&s.x>=Math.min(a.x,c.x)&&s.y<=Math.max(a.y,c.y)&&s.y>=Math.min(a.y,c.y)}function wu(a){return a>0?1:a<0?-1:0}function nh(a,s){return yo(a.prev,a,a.next)<0?yo(a,s,a.next)>=0&&yo(a,a.prev,s)>=0:yo(a,s,a.prev)<0||yo(a,a.next,s)<0}function ih(a,s){var c=new zf(a.i,a.x,a.y),g=new zf(s.i,s.x,s.y),b=a.next,A=s.prev;return a.next=s,s.prev=a,c.next=b,b.prev=c,g.next=c,c.prev=g,A.next=g,g.prev=A,g}function hf(a,s,c,g){var b=new zf(a,s,c);return g?(b.next=g.next,b.prev=g,g.next.prev=b,g.next=b):(b.prev=b,b.next=b),b}function Wc(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function zf(a,s,c){this.i=a,this.x=s,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function lc(a,s,c,g){for(var b=0,A=s,T=c-g;A<c;A+=g)b+=(a[T]-a[A])*(a[A+1]+a[T+1]),T=A;return b}function Jh(a,s,c,g,b){(function A(T,O,z,$,Q){for(;$>z;){if($-z>600){var re=$-z+1,me=O-z+1,Ee=Math.log(re),$e=.5*Math.exp(2*Ee/3),qe=.5*Math.sqrt(Ee*$e*(re-$e)/re)*(me-re/2<0?-1:1);A(T,O,Math.max(z,Math.floor(O-me*$e/re+qe)),Math.min($,Math.floor(O+(re-me)*$e/re+qe)),Q)}var bt=T[O],st=z,Nt=$;for(Wu(T,z,O),Q(T[$],bt)>0&&Wu(T,z,$);st<Nt;){for(Wu(T,st,Nt),st++,Nt--;Q(T[st],bt)<0;)st++;for(;Q(T[Nt],bt)>0;)Nt--}Q(T[z],bt)===0?Wu(T,z,Nt):Wu(T,++Nt,$),Nt<=O&&(z=Nt+1),O<=Nt&&($=Nt-1)}})(a,s,c||0,g||a.length-1,b||pf)}function Wu(a,s,c){var g=a[s];a[s]=a[c],a[c]=g}function pf(a,s){return a<s?-1:a>s?1:0}function ep(a,s){var c=a.length;if(c<=1)return[a];for(var g,b,A=[],T=0;T<c;T++){var O=$r(a[T]);O!==0&&(a[T].area=Math.abs(O),b===void 0&&(b=O<0),b===O<0?(g&&A.push(g),g=[a[T]]):g.push(a[T]))}if(g&&A.push(g),s>1)for(var z=0;z<A.length;z++)A[z].length<=s||(Jh(A[z],s,1,A[z].length-1,ah),A[z]=A[z].slice(0,s));return A}function ah(a,s){return s.area-a.area}function Rh(a,s,c){for(var g=c.patternDependencies,b=!1,A=0,T=s;A<T.length;A+=1){var O=T[A].paint.get(a+"-pattern");O.isConstant()||(b=!0);var z=O.constantOr(null);z&&(b=!0,g[z.to]=!0,g[z.from]=!0)}return b}function Lh(a,s,c,g,b){for(var A=b.patternDependencies,T=0,O=s;T<O.length;T+=1){var z=O[T],$=z.paint.get(a+"-pattern").value;if($.kind!=="constant"){var Q=$.evaluate({zoom:g-1},c,{},b.availableImages),re=$.evaluate({zoom:g},c,{},b.availableImages),me=$.evaluate({zoom:g+1},c,{},b.availableImages);re=re&&re.name?re.name:re,me=me&&me.name?me.name:me,A[Q=Q&&Q.name?Q.name:Q]=!0,A[re]=!0,A[me]=!0,c.patterns[z.id]={min:Q,mid:re,max:me}}}return c}Sp.deviation=function(a,s,c,g){var b=s&&s.length,A=Math.abs(lc(a,0,b?s[0]*c:a.length,c));if(b)for(var T=0,O=s.length;T<O;T++)A-=Math.abs(lc(a,s[T]*c,T<O-1?s[T+1]*c:a.length,c));var z=0;for(T=0;T<g.length;T+=3){var $=g[T]*c,Q=g[T+1]*c,re=g[T+2]*c;z+=Math.abs((a[$]-a[re])*(a[Q+1]-a[$+1])-(a[$]-a[Q])*(a[re+1]-a[$+1]))}return A===0&&z===0?0:Math.abs((z-A)/A)},Sp.flatten=function(a){for(var s=a[0][0].length,c={vertices:[],holes:[],dimensions:s},g=0,b=0;b<a.length;b++){for(var A=0;A<a[b].length;A++)for(var T=0;T<s;T++)c.vertices.push(a[b][A][T]);b>0&&c.holes.push(g+=a[b-1].length)}return c},ff.default=eh;var _l=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new zc,this.indexArray=new Zc,this.indexArray2=new jl,this.programConfigurations=new wi(a.layers,a.zoom),this.segments=new we,this.segments2=new we,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};_l.prototype.populate=function(a,s,c){this.hasPattern=Rh("fill",this.layers,s);for(var g=this.layers[0].layout.get("fill-sort-key"),b=[],A=0,T=a;A<T.length;A+=1){var O=T[A],z=O.feature,$=O.id,Q=O.index,re=O.sourceLayerIndex,me=this.layers[0]._featureFilter.needGeometry,Ee=wo(z,me);if(this.layers[0]._featureFilter.filter(new ga(this.zoom),Ee,c)){var $e=g?g.evaluate(Ee,{},c,s.availableImages):void 0,qe={id:$,properties:z.properties,type:z.type,sourceLayerIndex:re,index:Q,geometry:me?Ee.geometry:Zo(z),patterns:{},sortKey:$e};b.push(qe)}}g&&b.sort(function(dn,Ln){return dn.sortKey-Ln.sortKey});for(var bt=0,st=b;bt<st.length;bt+=1){var Nt=st[bt],er=Nt.geometry,_r=Nt.index,Er=Nt.sourceLayerIndex;if(this.hasPattern){var Br=Lh("fill",this.layers,Nt,this.zoom,s);this.patternFeatures.push(Br)}else this.addFeature(Nt,er,_r,c,{});s.featureIndex.insert(a[_r].feature,er,_r,Er,this.index)}},_l.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},_l.prototype.addFeatures=function(a,s,c){for(var g=0,b=this.patternFeatures;g<b.length;g+=1){var A=b[g];this.addFeature(A,A.geometry,A.index,s,c)}},_l.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},_l.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},_l.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Yh),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},_l.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},_l.prototype.addFeature=function(a,s,c,g,b){for(var A=0,T=ep(s,500);A<T.length;A+=1){for(var O=T[A],z=0,$=0,Q=O;$<Q.length;$+=1)z+=Q[$].length;for(var re=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray),me=re.vertexLength,Ee=[],$e=[],qe=0,bt=O;qe<bt.length;qe+=1){var st=bt[qe];if(st.length!==0){st!==O[0]&&$e.push(Ee.length/2);var Nt=this.segments2.prepareSegment(st.length,this.layoutVertexArray,this.indexArray2),er=Nt.vertexLength;this.layoutVertexArray.emplaceBack(st[0].x,st[0].y),this.indexArray2.emplaceBack(er+st.length-1,er),Ee.push(st[0].x),Ee.push(st[0].y);for(var _r=1;_r<st.length;_r++)this.layoutVertexArray.emplaceBack(st[_r].x,st[_r].y),this.indexArray2.emplaceBack(er+_r-1,er+_r),Ee.push(st[_r].x),Ee.push(st[_r].y);Nt.vertexLength+=st.length,Nt.primitiveLength+=st.length}}for(var Er=ff(Ee,$e),Br=0;Br<Er.length;Br+=3)this.indexArray.emplaceBack(me+Er[Br],me+Er[Br+1],me+Er[Br+2]);re.vertexLength+=z,re.primitiveLength+=Er.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,b,g)},Gn("FillBucket",_l,{omit:["layers","patternFeatures"]});var Oh=new ls({"fill-sort-key":new ai(Te.layout_fill["fill-sort-key"])}),Zf={paint:new ls({"fill-antialias":new mi(Te.paint_fill["fill-antialias"]),"fill-opacity":new ai(Te.paint_fill["fill-opacity"]),"fill-color":new ai(Te.paint_fill["fill-color"]),"fill-outline-color":new ai(Te.paint_fill["fill-outline-color"]),"fill-translate":new mi(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new mi(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new uf(Te.paint_fill["fill-pattern"])}),layout:Oh},Fh=function(a){function s(c){a.call(this,c,Zf)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(c,g){a.prototype.recalculate.call(this,c,g);var b=this.paint._values["fill-outline-color"];b.value.kind==="constant"&&b.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},s.prototype.createBucket=function(c){return new _l(c)},s.prototype.queryRadius=function(){return ns(this.paint.get("fill-translate"))},s.prototype.queryIntersectsFeature=function(c,g,b,A,T,O,z){return qo(Hu(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),O.angle,z),A)},s.prototype.isTileClipped=function(){return!0},s}(ol),oh=zo([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,tp=Us;function Us(a,s,c,g,b){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=g,this._values=b,a.readFields(cl,this,s)}function cl(a,s,c){a==1?s.id=c.readVarint():a==2?function(g,b){for(var A=g.readVarint()+g.pos;g.pos<A;){var T=b._keys[g.readVarint()],O=b._values[g.readVarint()];b.properties[T]=O}}(c,s):a==3?s.type=c.readVarint():a==4&&(s._geometry=c.pos)}function yd(a){for(var s,c,g=0,b=0,A=a.length,T=A-1;b<A;T=b++)g+=((c=a[T]).x-(s=a[b]).x)*(s.y+c.y);return g}Us.types=["Unknown","Point","LineString","Polygon"],Us.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var s,c=a.readVarint()+a.pos,g=1,b=0,A=0,T=0,O=[];a.pos<c;){if(b<=0){var z=a.readVarint();g=7&z,b=z>>3}if(b--,g===1||g===2)A+=a.readSVarint(),T+=a.readSVarint(),g===1&&(s&&O.push(s),s=[]),s.push(new ve(A,T));else{if(g!==7)throw new Error("unknown command "+g);s&&s.push(s[0].clone())}}return s&&O.push(s),O},Us.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var s=a.readVarint()+a.pos,c=1,g=0,b=0,A=0,T=1/0,O=-1/0,z=1/0,$=-1/0;a.pos<s;){if(g<=0){var Q=a.readVarint();c=7&Q,g=Q>>3}if(g--,c===1||c===2)(b+=a.readSVarint())<T&&(T=b),b>O&&(O=b),(A+=a.readSVarint())<z&&(z=A),A>$&&($=A);else if(c!==7)throw new Error("unknown command "+c)}return[T,z,O,$]},Us.prototype.toGeoJSON=function(a,s,c){var g,b,A=this.extent*Math.pow(2,c),T=this.extent*a,O=this.extent*s,z=this.loadGeometry(),$=Us.types[this.type];function Q(Ee){for(var $e=0;$e<Ee.length;$e++){var qe=Ee[$e];Ee[$e]=[360*(qe.x+T)/A-180,360/Math.PI*Math.atan(Math.exp((180-360*(qe.y+O)/A)*Math.PI/180))-90]}}switch(this.type){case 1:var re=[];for(g=0;g<z.length;g++)re[g]=z[g][0];Q(z=re);break;case 2:for(g=0;g<z.length;g++)Q(z[g]);break;case 3:for(z=function(Ee){var $e=Ee.length;if($e<=1)return[Ee];for(var qe,bt,st=[],Nt=0;Nt<$e;Nt++){var er=yd(Ee[Nt]);er!==0&&(bt===void 0&&(bt=er<0),bt===er<0?(qe&&st.push(qe),qe=[Ee[Nt]]):qe.push(Ee[Nt]))}return qe&&st.push(qe),st}(z),g=0;g<z.length;g++)for(b=0;b<z[g].length;b++)Q(z[g][b])}z.length===1?z=z[0]:$="Multi"+$;var me={type:"Feature",geometry:{type:$,coordinates:z},properties:this.properties};return"id"in this&&(me.id=this.id),me};var Ap=rp;function rp(a,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Dh,this,s),this.length=this._features.length}function Dh(a,s,c){a===15?s.version=c.readVarint():a===1?s.name=c.readString():a===5?s.extent=c.readVarint():a===2?s._features.push(c.pos):a===3?s._keys.push(c.readString()):a===4&&s._values.push(function(g){for(var b=null,A=g.readVarint()+g.pos;g.pos<A;){var T=g.readVarint()>>3;b=T===1?g.readString():T===2?g.readFloat():T===3?g.readDouble():T===4?g.readVarint64():T===5?g.readVarint():T===6?g.readSVarint():T===7?g.readBoolean():null}return b}(c))}function df(a,s,c){if(a===3){var g=new Ap(c,c.readVarint()+c.pos);g.length&&(s[g.name]=g)}}rp.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var s=this._pbf.readVarint()+this._pbf.pos;return new tp(this._pbf,s,this.extent,this._keys,this._values)};var Dl={VectorTile:function(a,s){this.layers=a.readFields(df,{},s)},VectorTileFeature:tp,VectorTileLayer:Ap},Up=Dl.VectorTileFeature.types,np=Math.pow(2,13);function Cc(a,s,c,g,b,A,T,O){a.emplaceBack(s,c,2*Math.floor(g*np)+T,b*np*2,A*np*2,Math.round(O))}var xl=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new zu,this.indexArray=new Zc,this.programConfigurations=new wi(a.layers,a.zoom),this.segments=new we,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function zd(a,s){return a.x===s.x&&(a.x<0||a.x>8192)||a.y===s.y&&(a.y<0||a.y>8192)}xl.prototype.populate=function(a,s,c){this.features=[],this.hasPattern=Rh("fill-extrusion",this.layers,s);for(var g=0,b=a;g<b.length;g+=1){var A=b[g],T=A.feature,O=A.id,z=A.index,$=A.sourceLayerIndex,Q=this.layers[0]._featureFilter.needGeometry,re=wo(T,Q);if(this.layers[0]._featureFilter.filter(new ga(this.zoom),re,c)){var me={id:O,sourceLayerIndex:$,index:z,geometry:Q?re.geometry:Zo(T),properties:T.properties,type:T.type,patterns:{}};this.hasPattern?this.features.push(Lh("fill-extrusion",this.layers,me,this.zoom,s)):this.addFeature(me,me.geometry,z,c,{}),s.featureIndex.insert(T,me.geometry,z,$,this.index,!0)}}},xl.prototype.addFeatures=function(a,s,c){for(var g=0,b=this.features;g<b.length;g+=1){var A=b[g];this.addFeature(A,A.geometry,A.index,s,c)}},xl.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},xl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},xl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},xl.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,oh),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},xl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},xl.prototype.addFeature=function(a,s,c,g,b){for(var A=0,T=ep(s,500);A<T.length;A+=1){for(var O=T[A],z=0,$=0,Q=O;$<Q.length;$+=1)z+=Q[$].length;for(var re=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),me=0,Ee=O;me<Ee.length;me+=1){var $e=Ee[me];if($e.length!==0&&!((Ca=$e).every(function(oa){return oa.x<0})||Ca.every(function(oa){return oa.x>8192})||Ca.every(function(oa){return oa.y<0})||Ca.every(function(oa){return oa.y>8192})))for(var qe=0,bt=0;bt<$e.length;bt++){var st=$e[bt];if(bt>=1){var Nt=$e[bt-1];if(!zd(st,Nt)){re.vertexLength+4>we.MAX_VERTEX_ARRAY_LENGTH&&(re=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var er=st.sub(Nt)._perp()._unit(),_r=Nt.dist(st);qe+_r>32768&&(qe=0),Cc(this.layoutVertexArray,st.x,st.y,er.x,er.y,0,0,qe),Cc(this.layoutVertexArray,st.x,st.y,er.x,er.y,0,1,qe),Cc(this.layoutVertexArray,Nt.x,Nt.y,er.x,er.y,0,0,qe+=_r),Cc(this.layoutVertexArray,Nt.x,Nt.y,er.x,er.y,0,1,qe);var Er=re.vertexLength;this.indexArray.emplaceBack(Er,Er+2,Er+1),this.indexArray.emplaceBack(Er+1,Er+2,Er+3),re.vertexLength+=4,re.primitiveLength+=2}}}}if(re.vertexLength+z>we.MAX_VERTEX_ARRAY_LENGTH&&(re=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray)),Up[a.type]==="Polygon"){for(var Br=[],dn=[],Ln=re.vertexLength,xi=0,jn=O;xi<jn.length;xi+=1){var Ai=jn[xi];if(Ai.length!==0){Ai!==O[0]&&dn.push(Br.length/2);for(var Wn=0;Wn<Ai.length;Wn++){var la=Ai[Wn];Cc(this.layoutVertexArray,la.x,la.y,0,0,1,1,0),Br.push(la.x),Br.push(la.y)}}}for(var ji=ff(Br,dn),hi=0;hi<ji.length;hi+=3)this.indexArray.emplaceBack(Ln+ji[hi],Ln+ji[hi+2],Ln+ji[hi+1]);re.primitiveLength+=ji.length/3,re.vertexLength+=z}}var Ca;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,b,g)},Gn("FillExtrusionBucket",xl,{omit:["layers","features"]});var _d={paint:new ls({"fill-extrusion-opacity":new mi(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ai(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new mi(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new mi(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new uf(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ai(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ai(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new mi(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},bl=function(a){function s(c){a.call(this,c,_d)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new xl(c)},s.prototype.queryRadius=function(){return ns(this.paint.get("fill-extrusion-translate"))},s.prototype.is3D=function(){return!0},s.prototype.queryIntersectsFeature=function(c,g,b,A,T,O,z,$){var Q=Hu(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),O.angle,z),re=this.paint.get("fill-extrusion-height").evaluate(g,b),me=this.paint.get("fill-extrusion-base").evaluate(g,b),Ee=function(qe,bt,st,Nt){for(var er=[],_r=0,Er=qe;_r<Er.length;_r+=1){var Br=Er[_r],dn=[Br.x,Br.y,0,1];Df(dn,dn,bt),er.push(new ve(dn[0]/dn[3],dn[1]/dn[3]))}return er}(Q,$),$e=function(qe,bt,st,Nt){for(var er=[],_r=[],Er=Nt[8]*bt,Br=Nt[9]*bt,dn=Nt[10]*bt,Ln=Nt[11]*bt,xi=Nt[8]*st,jn=Nt[9]*st,Ai=Nt[10]*st,Wn=Nt[11]*st,la=0,ji=qe;la<ji.length;la+=1){for(var hi=[],Ca=[],oa=0,Pa=ji[la];oa<Pa.length;oa+=1){var Ci=Pa[oa],Mi=Ci.x,_o=Ci.y,Os=Nt[0]*Mi+Nt[4]*_o+Nt[12],As=Nt[1]*Mi+Nt[5]*_o+Nt[13],Qo=Nt[2]*Mi+Nt[6]*_o+Nt[14],as=Nt[3]*Mi+Nt[7]*_o+Nt[15],Fs=Qo+dn,pu=as+Ln,Au=Os+xi,nu=As+jn,Yu=Qo+Ai,Oo=as+Wn,Vs=new ve((Os+Er)/pu,(As+Br)/pu);Vs.z=Fs/pu,hi.push(Vs);var ba=new ve(Au/Oo,nu/Oo);ba.z=Yu/Oo,Ca.push(ba)}er.push(hi),_r.push(Ca)}return[er,_r]}(A,me,re,$);return function(qe,bt,st){var Nt=1/0;qo(st,bt)&&(Nt=cc(st,bt[0]));for(var er=0;er<bt.length;er++)for(var _r=bt[er],Er=qe[er],Br=0;Br<_r.length-1;Br++){var dn=_r[Br],Ln=[dn,_r[Br+1],Er[Br+1],Er[Br],dn];Vu(st,Ln)&&(Nt=Math.min(Nt,cc(st,Ln)))}return Nt!==1/0&&Nt}($e[0],$e[1],Ee)},s}(ol);function vf(a,s){return a.x*s.x+a.y*s.y}function cc(a,s){if(a.length===1){for(var c,g=0,b=s[g++];!c||b.equals(c);)if(!(c=s[g++]))return 1/0;for(;g<s.length;g++){var A=s[g],T=a[0],O=c.sub(b),z=A.sub(b),$=T.sub(b),Q=vf(O,O),re=vf(O,z),me=vf(z,z),Ee=vf($,O),$e=vf($,z),qe=Q*me-re*re,bt=(me*Ee-re*$e)/qe,st=(Q*$e-re*Ee)/qe,Nt=b.z*(1-bt-st)+c.z*bt+A.z*st;if(isFinite(Nt))return Nt}return 1/0}for(var er=1/0,_r=0,Er=s;_r<Er.length;_r+=1)er=Math.min(er,Er[_r].z);return er}var Xu=zo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Vp=zo([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,ip=Dl.VectorTileFeature.types,Gp=Math.cos(Math.PI/180*37.5),jp=Math.pow(2,14)/.5,no=function(a){var s=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(c){return c.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(c){s.gradients[c.id]={}}),this.layoutVertexArray=new bs,this.layoutVertexArray2=new Ie,this.indexArray=new Zc,this.programConfigurations=new wi(a.layers,a.zoom),this.segments=new we,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(c){return c.isStateDependent()}).map(function(c){return c.id})};no.prototype.populate=function(a,s,c){this.hasPattern=Rh("line",this.layers,s);for(var g=this.layers[0].layout.get("line-sort-key"),b=[],A=0,T=a;A<T.length;A+=1){var O=T[A],z=O.feature,$=O.id,Q=O.index,re=O.sourceLayerIndex,me=this.layers[0]._featureFilter.needGeometry,Ee=wo(z,me);if(this.layers[0]._featureFilter.filter(new ga(this.zoom),Ee,c)){var $e=g?g.evaluate(Ee,{},c):void 0,qe={id:$,properties:z.properties,type:z.type,sourceLayerIndex:re,index:Q,geometry:me?Ee.geometry:Zo(z),patterns:{},sortKey:$e};b.push(qe)}}g&&b.sort(function(dn,Ln){return dn.sortKey-Ln.sortKey});for(var bt=0,st=b;bt<st.length;bt+=1){var Nt=st[bt],er=Nt.geometry,_r=Nt.index,Er=Nt.sourceLayerIndex;if(this.hasPattern){var Br=Lh("line",this.layers,Nt,this.zoom,s);this.patternFeatures.push(Br)}else this.addFeature(Nt,er,_r,c,{});s.featureIndex.insert(a[_r].feature,er,_r,Er,this.index)}},no.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},no.prototype.addFeatures=function(a,s,c){for(var g=0,b=this.patternFeatures;g<b.length;g+=1){var A=b[g];this.addFeature(A,A.geometry,A.index,s,c)}},no.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},no.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},no.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,Vp)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Xu),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},no.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},no.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},no.prototype.addFeature=function(a,s,c,g,b){var A=this.layers[0].layout,T=A.get("line-join").evaluate(a,{}),O=A.get("line-cap"),z=A.get("line-miter-limit"),$=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var Q=0,re=s;Q<re.length;Q+=1)this.addLine(re[Q],a,T,O,z,$);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,b,g)},no.prototype.addLine=function(a,s,c,g,b,A){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var T=0;T<a.length-1;T++)this.totalDistance+=a[T].dist(a[T+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var O=ip[s.type]==="Polygon",z=a.length;z>=2&&a[z-1].equals(a[z-2]);)z--;for(var $=0;$<z-1&&a[$].equals(a[$+1]);)$++;if(!(z<(O?3:2))){c==="bevel"&&(b=1.05);var Q,re=this.overscaling<=16?122880/(512*this.overscaling):0,me=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray),Ee=void 0,$e=void 0,qe=void 0,bt=void 0;this.e1=this.e2=-1,O&&(bt=a[$].sub(Q=a[z-2])._unit()._perp());for(var st=$;st<z;st++)if(!($e=st===z-1?O?a[$+1]:void 0:a[st+1])||!a[st].equals($e)){bt&&(qe=bt),Q&&(Ee=Q),Q=a[st],bt=$e?$e.sub(Q)._unit()._perp():qe;var Nt=(qe=qe||bt).add(bt);Nt.x===0&&Nt.y===0||Nt._unit();var er=qe.x*bt.x+qe.y*bt.y,_r=Nt.x*bt.x+Nt.y*bt.y,Er=_r!==0?1/_r:1/0,Br=2*Math.sqrt(2-2*_r),dn=_r<Gp&&Ee&&$e,Ln=qe.x*bt.y-qe.y*bt.x>0;if(dn&&st>$){var xi=Q.dist(Ee);if(xi>2*re){var jn=Q.sub(Q.sub(Ee)._mult(re/xi)._round());this.updateDistance(Ee,jn),this.addCurrentVertex(jn,qe,0,0,me),Ee=jn}}var Ai=Ee&&$e,Wn=Ai?c:O?"butt":g;if(Ai&&Wn==="round"&&(Er<A?Wn="miter":Er<=2&&(Wn="fakeround")),Wn==="miter"&&Er>b&&(Wn="bevel"),Wn==="bevel"&&(Er>2&&(Wn="flipbevel"),Er<b&&(Wn="miter")),Ee&&this.updateDistance(Ee,Q),Wn==="miter")Nt._mult(Er),this.addCurrentVertex(Q,Nt,0,0,me);else if(Wn==="flipbevel"){if(Er>100)Nt=bt.mult(-1);else{var la=Er*qe.add(bt).mag()/qe.sub(bt).mag();Nt._perp()._mult(la*(Ln?-1:1))}this.addCurrentVertex(Q,Nt,0,0,me),this.addCurrentVertex(Q,Nt.mult(-1),0,0,me)}else if(Wn==="bevel"||Wn==="fakeround"){var ji=-Math.sqrt(Er*Er-1),hi=Ln?ji:0,Ca=Ln?0:ji;if(Ee&&this.addCurrentVertex(Q,qe,hi,Ca,me),Wn==="fakeround")for(var oa=Math.round(180*Br/Math.PI/20),Pa=1;Pa<oa;Pa++){var Ci=Pa/oa;if(Ci!==.5){var Mi=Ci-.5;Ci+=Ci*Mi*(Ci-1)*((1.0904+er*(er*(3.55645-1.43519*er)-3.2452))*Mi*Mi+(.848013+er*(.215638*er-1.06021)))}var _o=bt.sub(qe)._mult(Ci)._add(qe)._unit()._mult(Ln?-1:1);this.addHalfVertex(Q,_o.x,_o.y,!1,Ln,0,me)}$e&&this.addCurrentVertex(Q,bt,-hi,-Ca,me)}else if(Wn==="butt")this.addCurrentVertex(Q,Nt,0,0,me);else if(Wn==="square"){var Os=Ee?1:-1;this.addCurrentVertex(Q,Nt,Os,Os,me)}else Wn==="round"&&(Ee&&(this.addCurrentVertex(Q,qe,0,0,me),this.addCurrentVertex(Q,qe,1,1,me,!0)),$e&&(this.addCurrentVertex(Q,bt,-1,-1,me,!0),this.addCurrentVertex(Q,bt,0,0,me)));if(dn&&st<z-1){var As=Q.dist($e);if(As>2*re){var Qo=Q.add($e.sub(Q)._mult(re/As)._round());this.updateDistance(Q,Qo),this.addCurrentVertex(Qo,bt,0,0,me),Q=Qo}}}}},no.prototype.addCurrentVertex=function(a,s,c,g,b,A){A===void 0&&(A=!1);var T=s.y*g-s.x,O=-s.y-s.x*g;this.addHalfVertex(a,s.x+s.y*c,s.y-s.x*c,A,!1,c,b),this.addHalfVertex(a,T,O,A,!0,-g,b),this.distance>jp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,s,c,g,b,A))},no.prototype.addHalfVertex=function(a,s,c,g,b,A,T){var O=.5*(this.lineClips?this.scaledDistance*(jp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(g?1:0),(a.y<<1)+(b?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(A===0?0:A<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var z=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),T.primitiveLength++),b?this.e2=z:this.e1=z},no.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},no.prototype.updateDistance=function(a,s){this.distance+=a.dist(s),this.updateScaledDistance()},Gn("LineBucket",no,{omit:["layers","patternFeatures"]});var mf=new ls({"line-cap":new mi(Te.layout_line["line-cap"]),"line-join":new ai(Te.layout_line["line-join"]),"line-miter-limit":new mi(Te.layout_line["line-miter-limit"]),"line-round-limit":new mi(Te.layout_line["line-round-limit"]),"line-sort-key":new ai(Te.layout_line["line-sort-key"])}),Ss={paint:new ls({"line-opacity":new ai(Te.paint_line["line-opacity"]),"line-color":new ai(Te.paint_line["line-color"]),"line-translate":new mi(Te.paint_line["line-translate"]),"line-translate-anchor":new mi(Te.paint_line["line-translate-anchor"]),"line-width":new ai(Te.paint_line["line-width"]),"line-gap-width":new ai(Te.paint_line["line-gap-width"]),"line-offset":new ai(Te.paint_line["line-offset"]),"line-blur":new ai(Te.paint_line["line-blur"]),"line-dasharray":new ks(Te.paint_line["line-dasharray"]),"line-pattern":new uf(Te.paint_line["line-pattern"]),"line-gradient":new ku(Te.paint_line["line-gradient"])}),layout:mf},El=new(function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(c,g){return g=new ga(Math.floor(g.zoom),{now:g.now,fadeDuration:g.fadeDuration,zoomHistory:g.zoomHistory,transition:g.transition}),a.prototype.possiblyEvaluate.call(this,c,g)},s.prototype.evaluate=function(c,g,b,A){return g=jt({},g,{zoom:Math.floor(g.zoom)}),a.prototype.evaluate.call(this,c,g,b,A)},s}(ai))(Ss.paint.properties["line-width"].specification);El.useIntegerZoom=!0;var ap=function(a){function s(c){a.call(this,c,Ss),this.gradientVersion=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Mu,this.gradientVersion=(this.gradientVersion+1)%at)},s.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},s.prototype.recalculate=function(c,g){a.prototype.recalculate.call(this,c,g),this.paint._values["line-floorwidth"]=El.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)},s.prototype.createBucket=function(c){return new no(c)},s.prototype.queryRadius=function(c){var g=c,b=Xc(ml("line-width",this,g),ml("line-gap-width",this,g)),A=ml("line-offset",this,g);return b/2+Math.abs(A)+ns(this.paint.get("line-translate"))},s.prototype.queryIntersectsFeature=function(c,g,b,A,T,O,z){var $=Hu(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),O.angle,z),Q=z/2*Xc(this.paint.get("line-width").evaluate(g,b),this.paint.get("line-gap-width").evaluate(g,b)),re=this.paint.get("line-offset").evaluate(g,b);return re&&(A=function(me,Ee){for(var $e=[],qe=new ve(0,0),bt=0;bt<me.length;bt++){for(var st=me[bt],Nt=[],er=0;er<st.length;er++){var _r=st[er],Er=st[er+1],Br=er===0?qe:_r.sub(st[er-1])._unit()._perp(),dn=er===st.length-1?qe:Er.sub(_r)._unit()._perp(),Ln=Br._add(dn)._unit();Ln._mult(1/(Ln.x*dn.x+Ln.y*dn.y)),Nt.push(Ln._mult(Ee)._add(_r))}$e.push(Nt)}return $e}(A,re*z)),function(me,Ee,$e){for(var qe=0;qe<Ee.length;qe++){var bt=Ee[qe];if(me.length>=3){for(var st=0;st<bt.length;st++)if(ju(me,bt[st]))return!0}if(Gu(me,bt,$e))return!0}return!1}($,A,Q)},s.prototype.isTileClipped=function(){return!0},s}(ol);function Xc(a,s){return s>0?s+2*a:a}var xd=zo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hp=zo([{name:"a_projected_pos",components:3,type:"Float32"}],4),Zd=(zo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),zo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Bh=(zo([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),zo([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),bd=zo([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Wp(a,s,c){return a.sections.forEach(function(g){g.text=function(b,A,T){var O=A.layout.get("text-transform").evaluate(T,{});return O==="uppercase"?b=b.toLocaleUpperCase():O==="lowercase"&&(b=b.toLocaleLowerCase()),dl.applyArabicShaping&&(b=dl.applyArabicShaping(b)),b}(g.text,s,c)}),a}zo([{name:"triangle",components:3,type:"Uint16"}]),zo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),zo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),zo([{type:"Float32",name:"offsetX"}]),zo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Hl={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},op=function(a,s,c,g,b){var A,T,O=8*b-g-1,z=(1<<O)-1,$=z>>1,Q=-7,re=c?b-1:0,me=c?-1:1,Ee=a[s+re];for(re+=me,A=Ee&(1<<-Q)-1,Ee>>=-Q,Q+=O;Q>0;A=256*A+a[s+re],re+=me,Q-=8);for(T=A&(1<<-Q)-1,A>>=-Q,Q+=g;Q>0;T=256*T+a[s+re],re+=me,Q-=8);if(A===0)A=1-$;else{if(A===z)return T?NaN:1/0*(Ee?-1:1);T+=Math.pow(2,g),A-=$}return(Ee?-1:1)*T*Math.pow(2,A-g)},sh=function(a,s,c,g,b,A){var T,O,z,$=8*A-b-1,Q=(1<<$)-1,re=Q>>1,me=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ee=g?0:A-1,$e=g?1:-1,qe=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(O=isNaN(s)?1:0,T=Q):(T=Math.floor(Math.log(s)/Math.LN2),s*(z=Math.pow(2,-T))<1&&(T--,z*=2),(s+=T+re>=1?me/z:me*Math.pow(2,1-re))*z>=2&&(T++,z/=2),T+re>=Q?(O=0,T=Q):T+re>=1?(O=(s*z-1)*Math.pow(2,b),T+=re):(O=s*Math.pow(2,re-1)*Math.pow(2,b),T=0));b>=8;a[c+Ee]=255&O,Ee+=$e,O/=256,b-=8);for(T=T<<b|O,$+=b;$>0;a[c+Ee]=255&T,Ee+=$e,T/=256,$-=8);a[c+Ee-$e]|=128*qe},Uf=ho;function ho(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}ho.Varint=0,ho.Fixed64=1,ho.Bytes=2,ho.Fixed32=5;var Vf=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Wi(a){return a.type===ho.Bytes?a.readVarint()+a.pos:a.pos+1}function Wl(a,s,c){return c?4294967296*s+(a>>>0):4294967296*(s>>>0)+(a>>>0)}function Nh(a,s,c){var g=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));c.realloc(g);for(var b=c.pos-1;b>=a;b--)c.buf[b+g]=c.buf[b]}function uh(a,s){for(var c=0;c<a.length;c++)s.writeVarint(a[c])}function X(a,s){for(var c=0;c<a.length;c++)s.writeSVarint(a[c])}function Le(a,s){for(var c=0;c<a.length;c++)s.writeFloat(a[c])}function rt(a,s){for(var c=0;c<a.length;c++)s.writeDouble(a[c])}function Kt(a,s){for(var c=0;c<a.length;c++)s.writeBoolean(a[c])}function Pr(a,s){for(var c=0;c<a.length;c++)s.writeFixed32(a[c])}function lr(a,s){for(var c=0;c<a.length;c++)s.writeSFixed32(a[c])}function Ir(a,s){for(var c=0;c<a.length;c++)s.writeFixed64(a[c])}function Hr(a,s){for(var c=0;c<a.length;c++)s.writeSFixed64(a[c])}function Qr(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+16777216*a[s+3]}function an(a,s,c){a[c]=s,a[c+1]=s>>>8,a[c+2]=s>>>16,a[c+3]=s>>>24}function cn(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+(a[s+3]<<24)}function hn(a,s,c){a===1&&c.readMessage(_n,s)}function _n(a,s,c){if(a===3){var g=c.readMessage(Ur,{}),b=g.width,A=g.height,T=g.left,O=g.top,z=g.advance;s.push({id:g.id,bitmap:new Su({width:b+6,height:A+6},g.bitmap),metrics:{width:b,height:A,left:T,top:O,advance:z}})}}function Ur(a,s,c){a===1?s.id=c.readVarint():a===2?s.bitmap=c.readBytes():a===3?s.width=c.readVarint():a===4?s.height=c.readVarint():a===5?s.left=c.readSVarint():a===6?s.top=c.readSVarint():a===7&&(s.advance=c.readVarint())}function sn(a){for(var s=0,c=0,g=0,b=a;g<b.length;g+=1){var A=b[g];s+=A.w*A.h,c=Math.max(c,A.w)}a.sort(function(qe,bt){return bt.h-qe.h});for(var T=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),c),h:1/0}],O=0,z=0,$=0,Q=a;$<Q.length;$+=1)for(var re=Q[$],me=T.length-1;me>=0;me--){var Ee=T[me];if(!(re.w>Ee.w||re.h>Ee.h)){if(re.x=Ee.x,re.y=Ee.y,z=Math.max(z,re.y+re.h),O=Math.max(O,re.x+re.w),re.w===Ee.w&&re.h===Ee.h){var $e=T.pop();me<T.length&&(T[me]=$e)}else re.h===Ee.h?(Ee.x+=re.w,Ee.w-=re.w):re.w===Ee.w?(Ee.y+=re.h,Ee.h-=re.h):(T.push({x:Ee.x+re.w,y:Ee.y,w:Ee.w-re.w,h:re.h}),Ee.y+=re.h,Ee.h-=re.h);break}}return{w:O,h:z,fill:s/(O*z)||0}}ho.prototype={destroy:function(){this.buf=null},readFields:function(a,s,c){for(c=c||this.length;this.pos<c;){var g=this.readVarint(),b=g>>3,A=this.pos;this.type=7&g,a(b,s,this),this.pos===A&&this.skip(g)}return s},readMessage:function(a,s){return this.readFields(a,s,this.readVarint()+this.pos)},readFixed32:function(){var a=Qr(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=cn(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Qr(this.buf,this.pos)+4294967296*Qr(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=Qr(this.buf,this.pos)+4294967296*cn(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=op(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=op(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var s,c,g=this.buf;return s=127&(c=g[this.pos++]),c<128?s:(s|=(127&(c=g[this.pos++]))<<7,c<128?s:(s|=(127&(c=g[this.pos++]))<<14,c<128?s:(s|=(127&(c=g[this.pos++]))<<21,c<128?s:function(b,A,T){var O,z,$=T.buf;if(O=(112&(z=$[T.pos++]))>>4,z<128||(O|=(127&(z=$[T.pos++]))<<3,z<128)||(O|=(127&(z=$[T.pos++]))<<10,z<128)||(O|=(127&(z=$[T.pos++]))<<17,z<128)||(O|=(127&(z=$[T.pos++]))<<24,z<128)||(O|=(1&(z=$[T.pos++]))<<31,z<128))return Wl(b,O,A);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(c=g[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,s=this.pos;return this.pos=a,a-s>=12&&Vf?function(c,g,b){return Vf.decode(c.subarray(g,b))}(this.buf,s,a):function(c,g,b){for(var A="",T=g;T<b;){var O,z,$,Q=c[T],re=null,me=Q>239?4:Q>223?3:Q>191?2:1;if(T+me>b)break;me===1?Q<128&&(re=Q):me===2?(192&(O=c[T+1]))==128&&(re=(31&Q)<<6|63&O)<=127&&(re=null):me===3?(z=c[T+2],(192&(O=c[T+1]))==128&&(192&z)==128&&((re=(15&Q)<<12|(63&O)<<6|63&z)<=2047||re>=55296&&re<=57343)&&(re=null)):me===4&&(z=c[T+2],$=c[T+3],(192&(O=c[T+1]))==128&&(192&z)==128&&(192&$)==128&&((re=(15&Q)<<18|(63&O)<<12|(63&z)<<6|63&$)<=65535||re>=1114112)&&(re=null)),re===null?(re=65533,me=1):re>65535&&(re-=65536,A+=String.fromCharCode(re>>>10&1023|55296),re=56320|1023&re),A+=String.fromCharCode(re),T+=me}return A}(this.buf,s,a)},readBytes:function(){var a=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,a);return this.pos=a,s},readPackedVarint:function(a,s){if(this.type!==ho.Bytes)return a.push(this.readVarint(s));var c=Wi(this);for(a=a||[];this.pos<c;)a.push(this.readVarint(s));return a},readPackedSVarint:function(a){if(this.type!==ho.Bytes)return a.push(this.readSVarint());var s=Wi(this);for(a=a||[];this.pos<s;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==ho.Bytes)return a.push(this.readBoolean());var s=Wi(this);for(a=a||[];this.pos<s;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==ho.Bytes)return a.push(this.readFloat());var s=Wi(this);for(a=a||[];this.pos<s;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==ho.Bytes)return a.push(this.readDouble());var s=Wi(this);for(a=a||[];this.pos<s;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==ho.Bytes)return a.push(this.readFixed32());var s=Wi(this);for(a=a||[];this.pos<s;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==ho.Bytes)return a.push(this.readSFixed32());var s=Wi(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==ho.Bytes)return a.push(this.readFixed64());var s=Wi(this);for(a=a||[];this.pos<s;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==ho.Bytes)return a.push(this.readSFixed64());var s=Wi(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed64());return a},skip:function(a){var s=7&a;if(s===ho.Varint)for(;this.buf[this.pos++]>127;);else if(s===ho.Bytes)this.pos=this.readVarint()+this.pos;else if(s===ho.Fixed32)this.pos+=4;else{if(s!==ho.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(a,s){this.writeVarint(a<<3|s)},realloc:function(a){for(var s=this.length||16;s<this.pos+a;)s*=2;if(s!==this.length){var c=new Uint8Array(s);c.set(this.buf),this.buf=c,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),an(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),an(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),an(this.buf,-1&a,this.pos),an(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),an(this.buf,-1&a,this.pos),an(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(s,c){var g,b;if(s>=0?(g=s%4294967296|0,b=s/4294967296|0):(b=~(-s/4294967296),4294967295^(g=~(-s%4294967296))?g=g+1|0:(g=0,b=b+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(A,T,O){O.buf[O.pos++]=127&A|128,A>>>=7,O.buf[O.pos++]=127&A|128,A>>>=7,O.buf[O.pos++]=127&A|128,A>>>=7,O.buf[O.pos++]=127&A|128,O.buf[O.pos]=127&(A>>>=7)}(g,0,c),function(A,T){var O=(7&A)<<4;T.buf[T.pos++]|=O|((A>>>=3)?128:0),A&&(T.buf[T.pos++]=127&A|((A>>>=7)?128:0),A&&(T.buf[T.pos++]=127&A|((A>>>=7)?128:0),A&&(T.buf[T.pos++]=127&A|((A>>>=7)?128:0),A&&(T.buf[T.pos++]=127&A|((A>>>=7)?128:0),A&&(T.buf[T.pos++]=127&A)))))}(b,c)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var s=this.pos;this.pos=function(g,b,A){for(var T,O,z=0;z<b.length;z++){if((T=b.charCodeAt(z))>55295&&T<57344){if(!O){T>56319||z+1===b.length?(g[A++]=239,g[A++]=191,g[A++]=189):O=T;continue}if(T<56320){g[A++]=239,g[A++]=191,g[A++]=189,O=T;continue}T=O-55296<<10|T-56320|65536,O=null}else O&&(g[A++]=239,g[A++]=191,g[A++]=189,O=null);T<128?g[A++]=T:(T<2048?g[A++]=T>>6|192:(T<65536?g[A++]=T>>12|224:(g[A++]=T>>18|240,g[A++]=T>>12&63|128),g[A++]=T>>6&63|128),g[A++]=63&T|128)}return A}(this.buf,a,this.pos);var c=this.pos-s;c>=128&&Nh(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeFloat:function(a){this.realloc(4),sh(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),sh(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var s=a.length;this.writeVarint(s),this.realloc(s);for(var c=0;c<s;c++)this.buf[this.pos++]=a[c]},writeRawMessage:function(a,s){this.pos++;var c=this.pos;a(s,this);var g=this.pos-c;g>=128&&Nh(c,g,this),this.pos=c-1,this.writeVarint(g),this.pos+=g},writeMessage:function(a,s,c){this.writeTag(a,ho.Bytes),this.writeRawMessage(s,c)},writePackedVarint:function(a,s){s.length&&this.writeMessage(a,uh,s)},writePackedSVarint:function(a,s){s.length&&this.writeMessage(a,X,s)},writePackedBoolean:function(a,s){s.length&&this.writeMessage(a,Kt,s)},writePackedFloat:function(a,s){s.length&&this.writeMessage(a,Le,s)},writePackedDouble:function(a,s){s.length&&this.writeMessage(a,rt,s)},writePackedFixed32:function(a,s){s.length&&this.writeMessage(a,Pr,s)},writePackedSFixed32:function(a,s){s.length&&this.writeMessage(a,lr,s)},writePackedFixed64:function(a,s){s.length&&this.writeMessage(a,Ir,s)},writePackedSFixed64:function(a,s){s.length&&this.writeMessage(a,Hr,s)},writeBytesField:function(a,s){this.writeTag(a,ho.Bytes),this.writeBytes(s)},writeFixed32Field:function(a,s){this.writeTag(a,ho.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(a,s){this.writeTag(a,ho.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(a,s){this.writeTag(a,ho.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(a,s){this.writeTag(a,ho.Fixed64),this.writeSFixed64(s)},writeVarintField:function(a,s){this.writeTag(a,ho.Varint),this.writeVarint(s)},writeSVarintField:function(a,s){this.writeTag(a,ho.Varint),this.writeSVarint(s)},writeStringField:function(a,s){this.writeTag(a,ho.Bytes),this.writeString(s)},writeFloatField:function(a,s){this.writeTag(a,ho.Fixed32),this.writeFloat(s)},writeDoubleField:function(a,s){this.writeTag(a,ho.Fixed64),this.writeDouble(s)},writeBooleanField:function(a,s){this.writeVarintField(a,Boolean(s))}};var zt=function(a,s){var c=s.pixelRatio,g=s.version,b=s.stretchX,A=s.stretchY,T=s.content;this.paddedRect=a,this.pixelRatio=c,this.stretchX=b,this.stretchY=A,this.content=T,this.version=g},xr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};xr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},xr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},xr.tlbr.get=function(){return this.tl.concat(this.br)},xr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(zt.prototype,xr);var nn=function(a,s){var c={},g={};this.haveRenderCallbacks=[];var b=[];this.addImages(a,c,b),this.addImages(s,g,b);var A=sn(b),T=new Xs({width:A.w||1,height:A.h||1});for(var O in a){var z=a[O],$=c[O].paddedRect;Xs.copy(z.data,T,{x:0,y:0},{x:$.x+1,y:$.y+1},z.data)}for(var Q in s){var re=s[Q],me=g[Q].paddedRect,Ee=me.x+1,$e=me.y+1,qe=re.data.width,bt=re.data.height;Xs.copy(re.data,T,{x:0,y:0},{x:Ee,y:$e},re.data),Xs.copy(re.data,T,{x:0,y:bt-1},{x:Ee,y:$e-1},{width:qe,height:1}),Xs.copy(re.data,T,{x:0,y:0},{x:Ee,y:$e+bt},{width:qe,height:1}),Xs.copy(re.data,T,{x:qe-1,y:0},{x:Ee-1,y:$e},{width:1,height:bt}),Xs.copy(re.data,T,{x:0,y:0},{x:Ee+qe,y:$e},{width:1,height:bt})}this.image=T,this.iconPositions=c,this.patternPositions=g};nn.prototype.addImages=function(a,s,c){for(var g in a){var b=a[g],A={x:0,y:0,w:b.data.width+2,h:b.data.height+2};c.push(A),s[g]=new zt(A,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(g)}},nn.prototype.patchUpdatedImages=function(a,s){for(var c in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[c],a.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],a.getImage(c),s)},nn.prototype.patchUpdatedImage=function(a,s,c){if(a&&s&&a.version!==s.version){a.version=s.version;var g=a.tl;c.update(s.data,void 0,{x:g[0],y:g[1]})}},Gn("ImagePosition",zt),Gn("ImageAtlas",nn);var wn={horizontal:1,vertical:2,horizontalOnly:3},Dr=function(){this.scale=1,this.fontStack="",this.imageName=null};Dr.forText=function(a,s){var c=new Dr;return c.scale=a||1,c.fontStack=s,c},Dr.forImage=function(a){var s=new Dr;return s.imageName=a,s};var pn=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Mn(a,s,c,g,b,A,T,O,z,$,Q,re,me,Ee,$e,qe){var bt,st=pn.fromFeature(a,b);re===wn.vertical&&st.verticalizePunctuation();var Nt=dl.processBidirectionalText,er=dl.processStyledBidirectionalText;if(Nt&&st.sections.length===1){bt=[];for(var _r=0,Er=Nt(st.toString(),On(st,$,A,s,g,Ee,$e));_r<Er.length;_r+=1){var Br=Er[_r],dn=new pn;dn.text=Br,dn.sections=st.sections;for(var Ln=0;Ln<Br.length;Ln++)dn.sectionIndex.push(0);bt.push(dn)}}else if(er){bt=[];for(var xi=0,jn=er(st.text,st.sectionIndex,On(st,$,A,s,g,Ee,$e));xi<jn.length;xi+=1){var Ai=jn[xi],Wn=new pn;Wn.text=Ai[0],Wn.sectionIndex=Ai[1],Wn.sections=st.sections,bt.push(Wn)}}else bt=function(hi,Ca){for(var oa=[],Pa=hi.text,Ci=0,Mi=0,_o=Ca;Mi<_o.length;Mi+=1){var Os=_o[Mi];oa.push(hi.substring(Ci,Os)),Ci=Os}return Ci<Pa.length&&oa.push(hi.substring(Ci,Pa.length)),oa}(st,On(st,$,A,s,g,Ee,$e));var la=[],ji={positionedLines:la,text:st.toString(),top:Q[1],bottom:Q[1],left:Q[0],right:Q[0],writingMode:re,iconsInText:!1,verticalizable:!1};return function(hi,Ca,oa,Pa,Ci,Mi,_o,Os,As,Qo,as,Fs){for(var pu=0,Au=-17,nu=0,Yu=0,Oo=Os==="right"?1:Os==="left"?0:.5,Vs=0,ba=0,Bo=Ci;ba<Bo.length;ba+=1){var po=Bo[ba];po.trim();var ja=po.getMaxScale(),qu=24*(ja-1),Pu={positionedGlyphs:[],lineOffset:0};hi.positionedLines[Vs]=Pu;var Jo=Pu.positionedGlyphs,$s=0;if(po.length()){for(var Ku=0;Ku<po.length();Ku++){var so=po.getSection(Ku),Ru=po.getSectionIndex(Ku),$l=po.getCharCode(Ku),Gf=0,Wo=null,ca=null,Yc=null,Qu=24,Cs=!(As===wn.horizontal||!as&&!qf($l)||as&&(Ei[$l]||(fh=$l,Sn.Arabic(fh)||Sn["Arabic Supplement"](fh)||Sn["Arabic Extended-A"](fh)||Sn["Arabic Presentation Forms-A"](fh)||Sn["Arabic Presentation Forms-B"](fh))));if(so.imageName){var Cp=Pa[so.imageName];if(!Cp)continue;Yc=so.imageName,hi.iconsInText=hi.iconsInText||!0,ca=Cp.paddedRect;var Bl=Cp.displaySize;so.scale=24*so.scale/Fs,Gf=qu+(24-Bl[1]*so.scale),Qu=(Wo={width:Bl[0],height:Bl[1],left:1,top:-3,advance:Cs?Bl[1]:Bl[0]}).advance;var up=Cs?Bl[0]*so.scale-24*ja:Bl[1]*so.scale-24*ja;up>0&&up>$s&&($s=up)}else{var Yp=oa[so.fontStack],Tp=Yp&&Yp[$l];if(Tp&&Tp.rect)ca=Tp.rect,Wo=Tp.metrics;else{var qp=Ca[so.fontStack],Kp=qp&&qp[$l];if(!Kp)continue;Wo=Kp.metrics}Gf=24*(ja-so.scale)}Cs?(hi.verticalizable=!0,Jo.push({glyph:$l,imageName:Yc,x:pu,y:Au+Gf,vertical:Cs,scale:so.scale,fontStack:so.fontStack,sectionIndex:Ru,metrics:Wo,rect:ca}),pu+=Qu*so.scale+Qo):(Jo.push({glyph:$l,imageName:Yc,x:pu,y:Au+Gf,vertical:Cs,scale:so.scale,fontStack:so.fontStack,sectionIndex:Ru,metrics:Wo,rect:ca}),pu+=Wo.advance*so.scale+Qo)}Jo.length!==0&&(nu=Math.max(pu-Qo,nu),aa(Jo,0,Jo.length-1,Oo,$s)),pu=0;var Mp=Mi*ja+$s;Pu.lineOffset=Math.max($s,qu),Au+=Mp,Yu=Math.max(Mp,Yu),++Vs}else Au+=Mi,++Vs}var fh,Tc=Au- -17,lp=Rn(_o),_f=lp.horizontalAlign,hs=lp.verticalAlign;(function(Gs,Ip,Qp,Jp,wd,cp,ed,td,kp){var xf,Pp=(Ip-Qp)*wd;xf=cp!==ed?-td*Jp- -17:(-Jp*kp+.5)*ed;for(var fc=0,fp=Gs;fc<fp.length;fc+=1)for(var bf=0,Al=fp[fc].positionedGlyphs;bf<Al.length;bf+=1){var Ef=Al[bf];Ef.x+=Pp,Ef.y+=xf}})(hi.positionedLines,Oo,_f,hs,nu,Yu,Mi,Tc,Ci.length),hi.top+=-hs*Tc,hi.bottom=hi.top+Tc,hi.left+=-_f*nu,hi.right=hi.left+nu}(ji,s,c,g,bt,T,O,z,re,$,me,qe),!function(hi){for(var Ca=0,oa=hi;Ca<oa.length;Ca+=1)if(oa[Ca].positionedGlyphs.length!==0)return!1;return!0}(la)&&ji}pn.fromFeature=function(a,s){for(var c=new pn,g=0;g<a.sections.length;g++){var b=a.sections[g];b.image?c.addImageSection(b):c.addTextSection(b,s)}return c},pn.prototype.length=function(){return this.text.length},pn.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},pn.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},pn.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},pn.prototype.verticalizePunctuation=function(){this.text=function(a){for(var s="",c=0;c<a.length;c++){var g=a.charCodeAt(c+1)||null,b=a.charCodeAt(c-1)||null;s+=g&&Ec(g)&&!Hl[a[c+1]]||b&&Ec(b)&&!Hl[a[c-1]]||!Hl[a[c]]?a[c]:Hl[a[c]]}return s}(this.text)},pn.prototype.trim=function(){for(var a=0,s=0;s<this.text.length&&Ei[this.text.charCodeAt(s)];s++)a++;for(var c=this.text.length,g=this.text.length-1;g>=0&&g>=a&&Ei[this.text.charCodeAt(g)];g--)c--;this.text=this.text.substring(a,c),this.sectionIndex=this.sectionIndex.slice(a,c)},pn.prototype.substring=function(a,s){var c=new pn;return c.text=this.text.substring(a,s),c.sectionIndex=this.sectionIndex.slice(a,s),c.sections=this.sections,c},pn.prototype.toString=function(){return this.text},pn.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(s,c){return Math.max(s,a.sections[c].scale)},0)},pn.prototype.addTextSection=function(a,s){this.text+=a.text,this.sections.push(Dr.forText(a.scale,a.fontStack||s));for(var c=this.sections.length-1,g=0;g<a.text.length;++g)this.sectionIndex.push(c)},pn.prototype.addImageSection=function(a){var s=a.image?a.image.name:"";if(s.length!==0){var c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Dr.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Ct("Reached maximum number of images 6401")}else Ct("Can't add FormattedSection with an empty image.")},pn.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Ei={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},kr={};function Lr(a,s,c,g,b,A){if(s.imageName){var T=g[s.imageName];return T?T.displaySize[0]*s.scale*24/A+b:0}var O=c[s.fontStack],z=O&&O[a];return z?z.metrics.advance*s.scale+b:0}function Kn(a,s,c,g){var b=Math.pow(a-s,2);return g?a<s?b/2:2*b:b+Math.abs(c)*c}function In(a,s,c){var g=0;return a===10&&(g-=1e4),c&&(g+=150),a!==40&&a!==65288||(g+=50),s!==41&&s!==65289||(g+=50),g}function rn(a,s,c,g,b,A){for(var T=null,O=Kn(s,c,b,A),z=0,$=g;z<$.length;z+=1){var Q=$[z],re=Kn(s-Q.x,c,b,A)+Q.badness;re<=O&&(T=Q,O=re)}return{index:a,x:s,priorBreak:T,badness:O}}function On(a,s,c,g,b,A,T){if(A!=="point")return[];if(!a)return[];for(var O,z=[],$=function(bt,st,Nt,er,_r,Er){for(var Br=0,dn=0;dn<bt.length();dn++){var Ln=bt.getSection(dn);Br+=Lr(bt.getCharCode(dn),Ln,er,_r,st,Er)}return Br/Math.max(1,Math.ceil(Br/Nt))}(a,s,c,g,b,T),Q=a.text.indexOf("\u200B")>=0,re=0,me=0;me<a.length();me++){var Ee=a.getSection(me),$e=a.getCharCode(me);if(Ei[$e]||(re+=Lr($e,Ee,g,b,s,T)),me<a.length()-1){var qe=!((O=$e)<11904||!(Sn["Bopomofo Extended"](O)||Sn.Bopomofo(O)||Sn["CJK Compatibility Forms"](O)||Sn["CJK Compatibility Ideographs"](O)||Sn["CJK Compatibility"](O)||Sn["CJK Radicals Supplement"](O)||Sn["CJK Strokes"](O)||Sn["CJK Symbols and Punctuation"](O)||Sn["CJK Unified Ideographs Extension A"](O)||Sn["CJK Unified Ideographs"](O)||Sn["Enclosed CJK Letters and Months"](O)||Sn["Halfwidth and Fullwidth Forms"](O)||Sn.Hiragana(O)||Sn["Ideographic Description Characters"](O)||Sn["Kangxi Radicals"](O)||Sn["Katakana Phonetic Extensions"](O)||Sn.Katakana(O)||Sn["Vertical Forms"](O)||Sn["Yi Radicals"](O)||Sn["Yi Syllables"](O)));(kr[$e]||qe||Ee.imageName)&&z.push(rn(me+1,re,$,z,In($e,a.getCharCode(me+1),qe&&Q),!1))}}return function bt(st){return st?bt(st.priorBreak).concat(st.index):[]}(rn(a.length(),re,$,z,0,!0))}function Rn(a){var s=.5,c=.5;switch(a){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:s,verticalAlign:c}}function aa(a,s,c,g,b){if(g||b)for(var A=a[c],T=(a[c].x+A.metrics.advance*A.scale)*g,O=s;O<=c;O++)a[O].x-=T,a[O].y+=b}function zi(a,s,c,g,b,A){var T,O=a.image;if(O.content){var z=O.content,$=O.pixelRatio||1;T=[z[0]/$,z[1]/$,O.displaySize[0]-z[2]/$,O.displaySize[1]-z[3]/$]}var Q,re,me,Ee,$e=s.left*A,qe=s.right*A;c==="width"||c==="both"?(Ee=b[0]+$e-g[3],re=b[0]+qe+g[1]):re=(Ee=b[0]+($e+qe-O.displaySize[0])/2)+O.displaySize[0];var bt=s.top*A,st=s.bottom*A;return c==="height"||c==="both"?(Q=b[1]+bt-g[0],me=b[1]+st+g[2]):me=(Q=b[1]+(bt+st-O.displaySize[1])/2)+O.displaySize[1],{image:O,top:Q,right:re,bottom:me,left:Ee,collisionPadding:T}}kr[10]=!0,kr[32]=!0,kr[38]=!0,kr[40]=!0,kr[41]=!0,kr[43]=!0,kr[45]=!0,kr[47]=!0,kr[173]=!0,kr[183]=!0,kr[8203]=!0,kr[8208]=!0,kr[8211]=!0,kr[8231]=!0;var Pn=function(a){function s(c,g,b,A){a.call(this,c,g),this.angle=b,A!==void 0&&(this.segment=A)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.clone=function(){return new s(this.x,this.y,this.angle,this.segment)},s}(ve);function zn(a,s){var c=s.expression;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new ga(a+1))};if(c.kind==="source")return{kind:"source"};for(var g=c.zoomStops,b=c.interpolationType,A=0;A<g.length&&g[A]<=a;)A++;for(var T=A=Math.max(0,A-1);T<g.length&&g[T]<a+1;)T++;T=Math.min(g.length-1,T);var O=g[A],z=g[T];return c.kind==="composite"?{kind:"composite",minZoom:O,maxZoom:z,interpolationType:b}:{kind:"camera",minZoom:O,maxZoom:z,minSize:c.evaluate(new ga(O)),maxSize:c.evaluate(new ga(z)),interpolationType:b}}function ki(a,s,c){var g=s.uSize,b=c.lowerSize;return a.kind==="source"?b/128:a.kind==="composite"?lo(b/128,c.upperSize/128,s.uSizeT):g}function Vi(a,s){var c=0,g=0;if(a.kind==="constant")g=a.layoutSize;else if(a.kind!=="source"){var b=a.interpolationType,A=b?Ft(De.interpolationFactor(b,s,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?g=lo(a.minSize,a.maxSize,A):c=A}return{uSizeT:c,uSize:g}}Gn("Anchor",Pn);var _a=Object.freeze({__proto__:null,getSizeData:zn,evaluateSizeForFeature:ki,evaluateSizeForZoom:Vi,SIZE_PACK_FACTOR:128});function io(a,s,c,g,b){if(s.segment===void 0)return!0;for(var A=s,T=s.segment+1,O=0;O>-c/2;){if(--T<0)return!1;O-=a[T].dist(A),A=a[T]}O+=a[T].dist(a[T+1]),T++;for(var z=[],$=0;O<c/2;){var Q=a[T],re=a[T+1];if(!re)return!1;var me=a[T-1].angleTo(Q)-Q.angleTo(re);for(me=Math.abs((me+3*Math.PI)%(2*Math.PI)-Math.PI),z.push({distance:O,angleDelta:me}),$+=me;O-z[0].distance>g;)$-=z.shift().angleDelta;if($>b)return!1;T++,O+=Q.dist(re)}return!0}function Ro(a){for(var s=0,c=0;c<a.length-1;c++)s+=a[c].dist(a[c+1]);return s}function qi(a,s,c){return a?.6*s*c:0}function Gr(a,s){return Math.max(a?a.right-a.left:0,s?s.right-s.left:0)}function Lo(a,s,c,g,b,A){for(var T=qi(c,b,A),O=Gr(c,g)*A,z=0,$=Ro(a)/2,Q=0;Q<a.length-1;Q++){var re=a[Q],me=a[Q+1],Ee=re.dist(me);if(z+Ee>$){var $e=($-z)/Ee,qe=lo(re.x,me.x,$e),bt=lo(re.y,me.y,$e),st=new Pn(qe,bt,me.angleTo(re),Q);return st._round(),!T||io(a,st,O,T,s)?st:void 0}z+=Ee}}function cu(a,s,c,g,b,A,T,O,z){var $=qi(g,A,T),Q=Gr(g,b),re=Q*T,me=a[0].x===0||a[0].x===z||a[0].y===0||a[0].y===z;return s-re<s/4&&(s=re+s/4),function Ee($e,qe,bt,st,Nt,er,_r,Er,Br){for(var dn=er/2,Ln=Ro($e),xi=0,jn=qe-bt,Ai=[],Wn=0;Wn<$e.length-1;Wn++){for(var la=$e[Wn],ji=$e[Wn+1],hi=la.dist(ji),Ca=ji.angleTo(la);jn+bt<xi+hi;){var oa=((jn+=bt)-xi)/hi,Pa=lo(la.x,ji.x,oa),Ci=lo(la.y,ji.y,oa);if(Pa>=0&&Pa<Br&&Ci>=0&&Ci<Br&&jn-dn>=0&&jn+dn<=Ln){var Mi=new Pn(Pa,Ci,Ca,Wn);Mi._round(),st&&!io($e,Mi,er,st,Nt)||Ai.push(Mi)}}xi+=hi}return Er||Ai.length||_r||(Ai=Ee($e,xi/2,bt,st,Nt,er,_r,!0,Br)),Ai}(a,me?s/2*O%s:(Q/2+2*A)*T*O%s,s,$,c,re,me,!1,z)}function Fa(a,s,c,g,b){for(var A=[],T=0;T<a.length;T++)for(var O=a[T],z=void 0,$=0;$<O.length-1;$++){var Q=O[$],re=O[$+1];Q.x<s&&re.x<s||(Q.x<s?Q=new ve(s,Q.y+(s-Q.x)/(re.x-Q.x)*(re.y-Q.y))._round():re.x<s&&(re=new ve(s,Q.y+(s-Q.x)/(re.x-Q.x)*(re.y-Q.y))._round()),Q.y<c&&re.y<c||(Q.y<c?Q=new ve(Q.x+(c-Q.y)/(re.y-Q.y)*(re.x-Q.x),c)._round():re.y<c&&(re=new ve(Q.x+(c-Q.y)/(re.y-Q.y)*(re.x-Q.x),c)._round()),Q.x>=g&&re.x>=g||(Q.x>=g?Q=new ve(g,Q.y+(g-Q.x)/(re.x-Q.x)*(re.y-Q.y))._round():re.x>=g&&(re=new ve(g,Q.y+(g-Q.x)/(re.x-Q.x)*(re.y-Q.y))._round()),Q.y>=b&&re.y>=b||(Q.y>=b?Q=new ve(Q.x+(b-Q.y)/(re.y-Q.y)*(re.x-Q.x),b)._round():re.y>=b&&(re=new ve(Q.x+(b-Q.y)/(re.y-Q.y)*(re.x-Q.x),b)._round()),z&&Q.equals(z[z.length-1])||A.push(z=[Q]),z.push(re)))))}return A}function Ko(a,s,c,g){var b=[],A=a.image,T=A.pixelRatio,O=A.paddedRect.w-2,z=A.paddedRect.h-2,$=a.right-a.left,Q=a.bottom-a.top,re=A.stretchX||[[0,O]],me=A.stretchY||[[0,z]],Ee=function(Pa,Ci){return Pa+Ci[1]-Ci[0]},$e=re.reduce(Ee,0),qe=me.reduce(Ee,0),bt=O-$e,st=z-qe,Nt=0,er=$e,_r=0,Er=qe,Br=0,dn=bt,Ln=0,xi=st;if(A.content&&g){var jn=A.content;Nt=is(re,0,jn[0]),_r=is(me,0,jn[1]),er=is(re,jn[0],jn[2]),Er=is(me,jn[1],jn[3]),Br=jn[0]-Nt,Ln=jn[1]-_r,dn=jn[2]-jn[0]-er,xi=jn[3]-jn[1]-Er}var Ai=function(Pa,Ci,Mi,_o){var Os=Mo(Pa.stretch-Nt,er,$,a.left),As=$i(Pa.fixed-Br,dn,Pa.stretch,$e),Qo=Mo(Ci.stretch-_r,Er,Q,a.top),as=$i(Ci.fixed-Ln,xi,Ci.stretch,qe),Fs=Mo(Mi.stretch-Nt,er,$,a.left),pu=$i(Mi.fixed-Br,dn,Mi.stretch,$e),Au=Mo(_o.stretch-_r,Er,Q,a.top),nu=$i(_o.fixed-Ln,xi,_o.stretch,qe),Yu=new ve(Os,Qo),Oo=new ve(Fs,Qo),Vs=new ve(Fs,Au),ba=new ve(Os,Au),Bo=new ve(As/T,as/T),po=new ve(pu/T,nu/T),ja=s*Math.PI/180;if(ja){var qu=Math.sin(ja),Pu=Math.cos(ja),Jo=[Pu,-qu,qu,Pu];Yu._matMult(Jo),Oo._matMult(Jo),ba._matMult(Jo),Vs._matMult(Jo)}var $s=Pa.stretch+Pa.fixed,Ku=Ci.stretch+Ci.fixed;return{tl:Yu,tr:Oo,bl:ba,br:Vs,tex:{x:A.paddedRect.x+1+$s,y:A.paddedRect.y+1+Ku,w:Mi.stretch+Mi.fixed-$s,h:_o.stretch+_o.fixed-Ku},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Bo,pixelOffsetBR:po,minFontScaleX:dn/T/$,minFontScaleY:xi/T/Q,isSDF:c}};if(g&&(A.stretchX||A.stretchY))for(var Wn=eu(re,bt,$e),la=eu(me,st,qe),ji=0;ji<Wn.length-1;ji++)for(var hi=Wn[ji],Ca=Wn[ji+1],oa=0;oa<la.length-1;oa++)b.push(Ai(hi,la[oa],Ca,la[oa+1]));else b.push(Ai({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:O+1},{fixed:0,stretch:z+1}));return b}function is(a,s,c){for(var g=0,b=0,A=a;b<A.length;b+=1){var T=A[b];g+=Math.max(s,Math.min(c,T[1]))-Math.max(s,Math.min(c,T[0]))}return g}function eu(a,s,c){for(var g=[{fixed:-1,stretch:0}],b=0,A=a;b<A.length;b+=1){var T=A[b],O=T[0],z=T[1],$=g[g.length-1];g.push({fixed:O-$.stretch,stretch:$.stretch}),g.push({fixed:O-$.stretch,stretch:$.stretch+(z-O)})}return g.push({fixed:s+1,stretch:c}),g}function Mo(a,s,c,g){return a/s*c+g}function $i(a,s,c,g){return a-s*c/g}var Ls=function(a,s,c,g,b,A,T,O,z,$){if(this.boxStartIndex=a.length,z){var Q=A.top,re=A.bottom,me=A.collisionPadding;me&&(Q-=me[1],re+=me[3]);var Ee=re-Q;Ee>0&&(Ee=Math.max(10,Ee),this.circleDiameter=Ee)}else{var $e=A.top*T-O,qe=A.bottom*T+O,bt=A.left*T-O,st=A.right*T+O,Nt=A.collisionPadding;if(Nt&&(bt-=Nt[0]*T,$e-=Nt[1]*T,st+=Nt[2]*T,qe+=Nt[3]*T),$){var er=new ve(bt,$e),_r=new ve(st,$e),Er=new ve(bt,qe),Br=new ve(st,qe),dn=$*Math.PI/180;er._rotate(dn),_r._rotate(dn),Er._rotate(dn),Br._rotate(dn),bt=Math.min(er.x,_r.x,Er.x,Br.x),st=Math.max(er.x,_r.x,Er.x,Br.x),$e=Math.min(er.y,_r.y,Er.y,Br.y),qe=Math.max(er.y,_r.y,Er.y,Br.y)}a.emplaceBack(s.x,s.y,bt,$e,st,qe,c,g,b)}this.boxEndIndex=a.length},Ka=function(a,s){if(a===void 0&&(a=[]),s===void 0&&(s=fu),this.data=a,this.length=this.data.length,this.compare=s,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function fu(a,s){return a<s?-1:a>s?1:0}function Oi(a,s,c){s===void 0&&(s=1),c===void 0&&(c=!1);for(var g=1/0,b=1/0,A=-1/0,T=-1/0,O=a[0],z=0;z<O.length;z++){var $=O[z];(!z||$.x<g)&&(g=$.x),(!z||$.y<b)&&(b=$.y),(!z||$.x>A)&&(A=$.x),(!z||$.y>T)&&(T=$.y)}var Q=Math.min(A-g,T-b),re=Q/2,me=new Ka([],va);if(Q===0)return new ve(g,b);for(var Ee=g;Ee<A;Ee+=Q)for(var $e=b;$e<T;$e+=Q)me.push(new Ga(Ee+re,$e+re,re,a));for(var qe=function(Nt){for(var er=0,_r=0,Er=0,Br=Nt[0],dn=0,Ln=Br.length,xi=Ln-1;dn<Ln;xi=dn++){var jn=Br[dn],Ai=Br[xi],Wn=jn.x*Ai.y-Ai.x*jn.y;_r+=(jn.x+Ai.x)*Wn,Er+=(jn.y+Ai.y)*Wn,er+=3*Wn}return new Ga(_r/er,Er/er,0,Nt)}(a),bt=me.length;me.length;){var st=me.pop();(st.d>qe.d||!qe.d)&&(qe=st,c&&console.log("found best %d after %d probes",Math.round(1e4*st.d)/1e4,bt)),st.max-qe.d<=s||(me.push(new Ga(st.p.x-(re=st.h/2),st.p.y-re,re,a)),me.push(new Ga(st.p.x+re,st.p.y-re,re,a)),me.push(new Ga(st.p.x-re,st.p.y+re,re,a)),me.push(new Ga(st.p.x+re,st.p.y+re,re,a)),bt+=4)}return c&&(console.log("num probes: "+bt),console.log("best distance: "+qe.d)),qe.p}function va(a,s){return s.max-a.max}function Ga(a,s,c,g){this.p=new ve(a,s),this.h=c,this.d=function(b,A){for(var T=!1,O=1/0,z=0;z<A.length;z++)for(var $=A[z],Q=0,re=$.length,me=re-1;Q<re;me=Q++){var Ee=$[Q],$e=$[me];Ee.y>b.y!=$e.y>b.y&&b.x<($e.x-Ee.x)*(b.y-Ee.y)/($e.y-Ee.y)+Ee.x&&(T=!T),O=Math.min(O,Gc(b,Ee,$e))}return(T?1:-1)*Math.sqrt(O)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}Ka.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},Ka.prototype.pop=function(){if(this.length!==0){var a=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),a}},Ka.prototype.peek=function(){return this.data[0]},Ka.prototype._up=function(a){for(var s=this.data,c=this.compare,g=s[a];a>0;){var b=a-1>>1,A=s[b];if(c(g,A)>=0)break;s[a]=A,a=b}s[a]=g},Ka.prototype._down=function(a){for(var s=this.data,c=this.compare,g=this.length>>1,b=s[a];a<g;){var A=1+(a<<1),T=s[A],O=A+1;if(O<this.length&&c(s[O],T)<0&&(A=O,T=s[O]),c(T,b)>=0)break;s[a]=T,a=A}s[a]=b};var ws=Number.POSITIVE_INFINITY;function gf(a,s){return s[1]!==ws?function(c,g,b){var A=0,T=0;switch(g=Math.abs(g),b=Math.abs(b),c){case"top-right":case"top-left":case"top":T=b-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-b}switch(c){case"top-right":case"bottom-right":case"right":A=-g;break;case"top-left":case"bottom-left":case"left":A=g}return[A,T]}(a,s[0],s[1]):function(c,g){var b=0,A=0;g<0&&(g=0);var T=g/Math.sqrt(2);switch(c){case"top-right":case"top-left":A=T-7;break;case"bottom-right":case"bottom-left":A=7-T;break;case"bottom":A=7-g;break;case"top":A=g-7}switch(c){case"top-right":case"bottom-right":b=-T;break;case"top-left":case"bottom-left":b=T;break;case"left":b=g;break;case"right":b=-g}return[b,A]}(a,s[0])}function We(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function vr(a,s,c,g,b,A,T,O,z,$,Q,re,me,Ee,$e){var qe=function(_r,Er,Br,dn,Ln,xi,jn,Ai){for(var Wn=dn.layout.get("text-rotate").evaluate(xi,{})*Math.PI/180,la=[],ji=0,hi=Er.positionedLines;ji<hi.length;ji+=1)for(var Ca=hi[ji],oa=0,Pa=Ca.positionedGlyphs;oa<Pa.length;oa+=1){var Ci=Pa[oa];if(Ci.rect){var Mi=Ci.rect||{},_o=4,Os=!0,As=1,Qo=0,as=(Ln||Ai)&&Ci.vertical,Fs=Ci.metrics.advance*Ci.scale/2;if(Ai&&Er.verticalizable&&(Qo=Ca.lineOffset/2-(Ci.imageName?-(24-Ci.metrics.width*Ci.scale)/2:24*(Ci.scale-1))),Ci.imageName){var pu=jn[Ci.imageName];Os=pu.sdf,_o=1/(As=pu.pixelRatio)}var Au=Ln?[Ci.x+Fs,Ci.y]:[0,0],nu=Ln?[0,0]:[Ci.x+Fs+Br[0],Ci.y+Br[1]-Qo],Yu=[0,0];as&&(Yu=nu,nu=[0,0]);var Oo=(Ci.metrics.left-_o)*Ci.scale-Fs+nu[0],Vs=(-Ci.metrics.top-_o)*Ci.scale+nu[1],ba=Oo+Mi.w*Ci.scale/As,Bo=Vs+Mi.h*Ci.scale/As,po=new ve(Oo,Vs),ja=new ve(ba,Vs),qu=new ve(Oo,Bo),Pu=new ve(ba,Bo);if(as){var Jo=new ve(-Fs,Fs- -17),$s=-Math.PI/2,Ku=12-Fs,so=new ve(22-Ku,-(Ci.imageName?Ku:0)),Ru=new(Function.prototype.bind.apply(ve,[null].concat(Yu)));po._rotateAround($s,Jo)._add(so)._add(Ru),ja._rotateAround($s,Jo)._add(so)._add(Ru),qu._rotateAround($s,Jo)._add(so)._add(Ru),Pu._rotateAround($s,Jo)._add(so)._add(Ru)}if(Wn){var $l=Math.sin(Wn),Gf=Math.cos(Wn),Wo=[Gf,-$l,$l,Gf];po._matMult(Wo),ja._matMult(Wo),qu._matMult(Wo),Pu._matMult(Wo)}var ca=new ve(0,0),Yc=new ve(0,0);la.push({tl:po,tr:ja,bl:qu,br:Pu,tex:Mi,writingMode:Er.writingMode,glyphOffset:Au,sectionIndex:Ci.sectionIndex,isSDF:Os,pixelOffsetTL:ca,pixelOffsetBR:Yc,minFontScaleX:0,minFontScaleY:0})}}return la}(0,c,O,b,A,T,g,a.allowVerticalPlacement),bt=a.textSizeData,st=null;bt.kind==="source"?(st=[128*b.layout.get("text-size").evaluate(T,{})])[0]>32640&&Ct(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):bt.kind==="composite"&&((st=[128*Ee.compositeTextSizes[0].evaluate(T,{},$e),128*Ee.compositeTextSizes[1].evaluate(T,{},$e)])[0]>32640||st[1]>32640)&&Ct(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,qe,st,O,A,T,$,s,z.lineStartIndex,z.lineLength,me,$e);for(var Nt=0,er=Q;Nt<er.length;Nt+=1)re[er[Nt]]=a.text.placedSymbolArray.length-1;return 4*qe.length}function rr(a){for(var s in a)return a[s];return null}function Xn(a,s,c,g){var b=a.compareText;if(s in b){for(var A=b[s],T=A.length-1;T>=0;T--)if(g.dist(A[T])<c)return!0}else b[s]=[];return b[s].push(g),!1}var Aa=Dl.VectorTileFeature.types,Ze=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Se(a,s,c,g,b,A,T,O,z,$,Q,re,me){var Ee=O?Math.min(32640,Math.round(O[0])):0,$e=O?Math.min(32640,Math.round(O[1])):0;a.emplaceBack(s,c,Math.round(32*g),Math.round(32*b),A,T,(Ee<<1)+(z?1:0),$e,16*$,16*Q,256*re,256*me)}function pt(a,s,c){a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c)}function Lt(a){for(var s=0,c=a.sections;s<c.length;s+=1)if(Dc(c[s].text))return!0;return!1}var sr=function(a){this.layoutVertexArray=new Sc,this.indexArray=new Zc,this.programConfigurations=a,this.segments=new we,this.dynamicLayoutVertexArray=new Js,this.opacityVertexArray=new Ba,this.placedSymbolArray=new y};sr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},sr.prototype.upload=function(a,s,c,g){this.isEmpty()||(c&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,xd.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,Hp.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,Ze,!0),this.opacityVertexBuffer.itemSize=1),(c||g)&&this.programConfigurations.upload(a))},sr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Gn("SymbolBuffers",sr);var Et=function(a,s,c){this.layoutVertexArray=new a,this.layoutAttributes=s,this.indexArray=new c,this.segments=new we,this.collisionVertexArray=new Gl};Et.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,Zd.members,!0)},Et.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Gn("CollisionBuffers",Et);var et=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(A){return A.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ll([]),this.placementViewportMatrix=ll([]);var s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=zn(this.zoom,s["text-size"]),this.iconSizeData=zn(this.zoom,s["icon-size"]);var c=this.layers[0].layout,g=c.get("symbol-sort-key"),b=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&g.constantOr(1)!==void 0,this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(function(A){return wn[A]})),this.stateDependentLayerIds=this.layers.filter(function(A){return A.isStateDependent()}).map(function(A){return A.id}),this.sourceID=a.sourceID};et.prototype.createArrays=function(){this.text=new sr(new wi(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new sr(new wi(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new L,this.lineVertexArray=new B,this.symbolInstances=new I},et.prototype.calculateGlyphDependencies=function(a,s,c,g,b){for(var A=0;A<a.length;A++)if(s[a.charCodeAt(A)]=!0,(c||g)&&b){var T=Hl[a.charAt(A)];T&&(s[T.charCodeAt(0)]=!0)}},et.prototype.populate=function(a,s,c){var g=this.layers[0],b=g.layout,A=b.get("text-font"),T=b.get("text-field"),O=b.get("icon-image"),z=(T.value.kind!=="constant"||T.value.value instanceof ko&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),$=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,Q=b.get("symbol-sort-key");if(this.features=[],z||$){for(var re=s.iconDependencies,me=s.glyphDependencies,Ee=s.availableImages,$e=new ga(this.zoom),qe=0,bt=a;qe<bt.length;qe+=1){var st=bt[qe],Nt=st.feature,er=st.id,_r=st.index,Er=st.sourceLayerIndex,Br=g._featureFilter.needGeometry,dn=wo(Nt,Br);if(g._featureFilter.filter($e,dn,c)){Br||(dn.geometry=Zo(Nt));var Ln=void 0;if(z){var xi=g.getValueAndResolveTokens("text-field",dn,c,Ee),jn=ko.factory(xi);Lt(jn)&&(this.hasRTLText=!0),(!this.hasRTLText||Rf()==="unavailable"||this.hasRTLText&&dl.isParsed())&&(Ln=Wp(jn,g,dn))}var Ai=void 0;if($){var Wn=g.getValueAndResolveTokens("icon-image",dn,c,Ee);Ai=Wn instanceof ao?Wn:ao.fromString(Wn)}if(Ln||Ai){var la=this.sortFeaturesByKey?Q.evaluate(dn,{},c):void 0;if(this.features.push({id:er,text:Ln,icon:Ai,index:_r,sourceLayerIndex:Er,geometry:dn.geometry,properties:Nt.properties,type:Aa[Nt.type],sortKey:la}),Ai&&(re[Ai.name]=!0),Ln){var ji=A.evaluate(dn,{},c).join(","),hi=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(wn.vertical)>=0;for(var Ca=0,oa=Ln.sections;Ca<oa.length;Ca+=1){var Pa=oa[Ca];if(Pa.image)re[Pa.image.name]=!0;else{var Ci=of(Ln.toString()),Mi=Pa.fontStack||ji,_o=me[Mi]=me[Mi]||{};this.calculateGlyphDependencies(Pa.text,_o,hi,this.allowVerticalPlacement,Ci)}}}}}}b.get("symbol-placement")==="line"&&(this.features=function(Os){var As={},Qo={},as=[],Fs=0;function pu(Jo){as.push(Os[Jo]),Fs++}function Au(Jo,$s,Ku){var so=Qo[Jo];return delete Qo[Jo],Qo[$s]=so,as[so].geometry[0].pop(),as[so].geometry[0]=as[so].geometry[0].concat(Ku[0]),so}function nu(Jo,$s,Ku){var so=As[$s];return delete As[$s],As[Jo]=so,as[so].geometry[0].shift(),as[so].geometry[0]=Ku[0].concat(as[so].geometry[0]),so}function Yu(Jo,$s,Ku){var so=Ku?$s[0][$s[0].length-1]:$s[0][0];return Jo+":"+so.x+":"+so.y}for(var Oo=0;Oo<Os.length;Oo++){var Vs=Os[Oo],ba=Vs.geometry,Bo=Vs.text?Vs.text.toString():null;if(Bo){var po=Yu(Bo,ba),ja=Yu(Bo,ba,!0);if(po in Qo&&ja in As&&Qo[po]!==As[ja]){var qu=nu(po,ja,ba),Pu=Au(po,ja,as[qu].geometry);delete As[po],delete Qo[ja],Qo[Yu(Bo,as[Pu].geometry,!0)]=Pu,as[qu].geometry=null}else po in Qo?Au(po,ja,ba):ja in As?nu(po,ja,ba):(pu(Oo),As[po]=Fs-1,Qo[ja]=Fs-1)}else pu(Oo)}return as.filter(function(Jo){return Jo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Os,As){return Os.sortKey-As.sortKey})}},et.prototype.update=function(a,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,s,this.layers,c),this.icon.programConfigurations.updatePaintArrays(a,s,this.layers,c))},et.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},et.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},et.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},et.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},et.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},et.prototype.addToLineVertexArray=function(a,s){var c=this.lineVertexArray.length;if(a.segment!==void 0){for(var g=a.dist(s[a.segment+1]),b=a.dist(s[a.segment]),A={},T=a.segment+1;T<s.length;T++)A[T]={x:s[T].x,y:s[T].y,tileUnitDistanceFromAnchor:g},T<s.length-1&&(g+=s[T+1].dist(s[T]));for(var O=a.segment||0;O>=0;O--)A[O]={x:s[O].x,y:s[O].y,tileUnitDistanceFromAnchor:b},O>0&&(b+=s[O-1].dist(s[O]));for(var z=0;z<s.length;z++){var $=A[z];this.lineVertexArray.emplaceBack($.x,$.y,$.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}},et.prototype.addSymbols=function(a,s,c,g,b,A,T,O,z,$,Q,re){for(var me=a.indexArray,Ee=a.layoutVertexArray,$e=a.segments.prepareSegment(4*s.length,Ee,me,this.canOverlap?A.sortKey:void 0),qe=this.glyphOffsetArray.length,bt=$e.vertexLength,st=this.allowVerticalPlacement&&T===wn.vertical?Math.PI/2:0,Nt=A.text&&A.text.sections,er=0;er<s.length;er++){var _r=s[er],Er=_r.tl,Br=_r.tr,dn=_r.bl,Ln=_r.br,xi=_r.tex,jn=_r.pixelOffsetTL,Ai=_r.pixelOffsetBR,Wn=_r.minFontScaleX,la=_r.minFontScaleY,ji=_r.glyphOffset,hi=_r.isSDF,Ca=_r.sectionIndex,oa=$e.vertexLength,Pa=ji[1];Se(Ee,O.x,O.y,Er.x,Pa+Er.y,xi.x,xi.y,c,hi,jn.x,jn.y,Wn,la),Se(Ee,O.x,O.y,Br.x,Pa+Br.y,xi.x+xi.w,xi.y,c,hi,Ai.x,jn.y,Wn,la),Se(Ee,O.x,O.y,dn.x,Pa+dn.y,xi.x,xi.y+xi.h,c,hi,jn.x,Ai.y,Wn,la),Se(Ee,O.x,O.y,Ln.x,Pa+Ln.y,xi.x+xi.w,xi.y+xi.h,c,hi,Ai.x,Ai.y,Wn,la),pt(a.dynamicLayoutVertexArray,O,st),me.emplaceBack(oa,oa+1,oa+2),me.emplaceBack(oa+1,oa+2,oa+3),$e.vertexLength+=4,$e.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ji[0]),er!==s.length-1&&Ca===s[er+1].sectionIndex||a.programConfigurations.populatePaintArrays(Ee.length,A,A.index,{},re,Nt&&Nt[Ca])}a.placedSymbolArray.emplaceBack(O.x,O.y,qe,this.glyphOffsetArray.length-qe,bt,z,$,O.segment,c?c[0]:0,c?c[1]:0,g[0],g[1],T,0,!1,0,Q)},et.prototype._addCollisionDebugVertex=function(a,s,c,g,b,A){return s.emplaceBack(0,0),a.emplaceBack(c.x,c.y,g,b,Math.round(A.x),Math.round(A.y))},et.prototype.addCollisionDebugVertices=function(a,s,c,g,b,A,T){var O=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),z=O.vertexLength,$=b.layoutVertexArray,Q=b.collisionVertexArray,re=T.anchorX,me=T.anchorY;this._addCollisionDebugVertex($,Q,A,re,me,new ve(a,s)),this._addCollisionDebugVertex($,Q,A,re,me,new ve(c,s)),this._addCollisionDebugVertex($,Q,A,re,me,new ve(c,g)),this._addCollisionDebugVertex($,Q,A,re,me,new ve(a,g)),O.vertexLength+=4;var Ee=b.indexArray;Ee.emplaceBack(z,z+1),Ee.emplaceBack(z+1,z+2),Ee.emplaceBack(z+2,z+3),Ee.emplaceBack(z+3,z),O.primitiveLength+=4},et.prototype.addDebugCollisionBoxes=function(a,s,c,g){for(var b=a;b<s;b++){var A=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(A.x1,A.y1,A.x2,A.y2,g?this.textCollisionBox:this.iconCollisionBox,A.anchorPoint,c)}},et.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Et(Ll,Bh.members,jl),this.iconCollisionBox=new Et(Ll,Bh.members,jl);for(var a=0;a<this.symbolInstances.length;a++){var s=this.symbolInstances.get(a);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}},et.prototype._deserializeCollisionBoxesForSymbol=function(a,s,c,g,b,A,T,O,z){for(var $={},Q=s;Q<c;Q++){var re=a.get(Q);$.textBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},$.textFeatureIndex=re.featureIndex;break}for(var me=g;me<b;me++){var Ee=a.get(me);$.verticalTextBox={x1:Ee.x1,y1:Ee.y1,x2:Ee.x2,y2:Ee.y2,anchorPointX:Ee.anchorPointX,anchorPointY:Ee.anchorPointY},$.verticalTextFeatureIndex=Ee.featureIndex;break}for(var $e=A;$e<T;$e++){var qe=a.get($e);$.iconBox={x1:qe.x1,y1:qe.y1,x2:qe.x2,y2:qe.y2,anchorPointX:qe.anchorPointX,anchorPointY:qe.anchorPointY},$.iconFeatureIndex=qe.featureIndex;break}for(var bt=O;bt<z;bt++){var st=a.get(bt);$.verticalIconBox={x1:st.x1,y1:st.y1,x2:st.x2,y2:st.y2,anchorPointX:st.anchorPointX,anchorPointY:st.anchorPointY},$.verticalIconFeatureIndex=st.featureIndex;break}return $},et.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var s=0;s<this.symbolInstances.length;s++){var c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}},et.prototype.hasTextData=function(){return this.text.segments.get().length>0},et.prototype.hasIconData=function(){return this.icon.segments.get().length>0},et.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},et.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},et.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},et.prototype.addIndicesForPlacedSymbol=function(a,s){for(var c=a.placedSymbolArray.get(s),g=c.vertexStartIndex+4*c.numGlyphs,b=c.vertexStartIndex;b<g;b+=4)a.indexArray.emplaceBack(b,b+1,b+2),a.indexArray.emplaceBack(b+1,b+2,b+3)},et.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var s=Math.sin(a),c=Math.cos(a),g=[],b=[],A=[],T=0;T<this.symbolInstances.length;++T){A.push(T);var O=this.symbolInstances.get(T);g.push(0|Math.round(s*O.anchorX+c*O.anchorY)),b.push(O.featureIndex)}return A.sort(function(z,$){return g[z]-g[$]||b[$]-b[z]}),A},et.prototype.addToSortKeyRanges=function(a,s){var c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:a,symbolInstanceEnd:a+1})},et.prototype.sortFeatures=function(a){var s=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var c=0,g=this.symbolInstanceIndexes;c<g.length;c+=1){var b=this.symbolInstances.get(g[c]);this.featureSortOrder.push(b.featureIndex),[b.rightJustifiedTextSymbolIndex,b.centerJustifiedTextSymbolIndex,b.leftJustifiedTextSymbolIndex].forEach(function(A,T,O){A>=0&&O.indexOf(A)===T&&s.addIndicesForPlacedSymbol(s.text,A)}),b.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,b.verticalPlacedTextSymbolIndex),b.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,b.placedIconSymbolIndex),b.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,b.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Gn("SymbolBucket",et,{omit:["layers","collisionBoxArray","features","compareText"]}),et.MAX_GLYPHS=65535,et.addDynamicAttributes=pt;var Tt=new ls({"symbol-placement":new mi(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new mi(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new mi(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ai(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new mi(Te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new mi(Te.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new mi(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new mi(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new mi(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new ai(Te.layout_symbol["icon-size"]),"icon-text-fit":new mi(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new mi(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new ai(Te.layout_symbol["icon-image"]),"icon-rotate":new ai(Te.layout_symbol["icon-rotate"]),"icon-padding":new mi(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new mi(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new ai(Te.layout_symbol["icon-offset"]),"icon-anchor":new ai(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new mi(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new mi(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new mi(Te.layout_symbol["text-rotation-alignment"]),"text-field":new ai(Te.layout_symbol["text-field"]),"text-font":new ai(Te.layout_symbol["text-font"]),"text-size":new ai(Te.layout_symbol["text-size"]),"text-max-width":new ai(Te.layout_symbol["text-max-width"]),"text-line-height":new mi(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new ai(Te.layout_symbol["text-letter-spacing"]),"text-justify":new ai(Te.layout_symbol["text-justify"]),"text-radial-offset":new ai(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new mi(Te.layout_symbol["text-variable-anchor"]),"text-anchor":new ai(Te.layout_symbol["text-anchor"]),"text-max-angle":new mi(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new mi(Te.layout_symbol["text-writing-mode"]),"text-rotate":new ai(Te.layout_symbol["text-rotate"]),"text-padding":new mi(Te.layout_symbol["text-padding"]),"text-keep-upright":new mi(Te.layout_symbol["text-keep-upright"]),"text-transform":new ai(Te.layout_symbol["text-transform"]),"text-offset":new ai(Te.layout_symbol["text-offset"]),"text-allow-overlap":new mi(Te.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new mi(Te.layout_symbol["text-ignore-placement"]),"text-optional":new mi(Te.layout_symbol["text-optional"])}),Fe={paint:new ls({"icon-opacity":new ai(Te.paint_symbol["icon-opacity"]),"icon-color":new ai(Te.paint_symbol["icon-color"]),"icon-halo-color":new ai(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new ai(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ai(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new mi(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new mi(Te.paint_symbol["icon-translate-anchor"]),"text-opacity":new ai(Te.paint_symbol["text-opacity"]),"text-color":new ai(Te.paint_symbol["text-color"],{runtimeType:se,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new ai(Te.paint_symbol["text-halo-color"]),"text-halo-width":new ai(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new ai(Te.paint_symbol["text-halo-blur"]),"text-translate":new mi(Te.paint_symbol["text-translate"]),"text-translate-anchor":new mi(Te.paint_symbol["text-translate-anchor"])}),layout:Tt},ct=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:Un,this.defaultValue=a};ct.prototype.evaluate=function(a){if(a.formattedSection){var s=this.defaultValue.property.overrides;if(s&&s.hasOverride(a.formattedSection))return s.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},ct.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},ct.prototype.outputDefined=function(){return!1},ct.prototype.serialize=function(){return null},Gn("FormatSectionOverride",ct,{omit:["defaultValue"]});var Ve=function(a){function s(c){a.call(this,c,Fe)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(c,g){if(a.prototype.recalculate.call(this,c,g),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var b=this.layout.get("text-writing-mode");if(b){for(var A=[],T=0,O=b;T<O.length;T+=1){var z=O[T];A.indexOf(z)<0&&A.push(z)}this.layout._values["text-writing-mode"]=A}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},s.prototype.getValueAndResolveTokens=function(c,g,b,A){var T=this.layout.get(c).evaluate(g,{},b,A),O=this._unevaluatedLayout._values[c];return O.isDataDriven()||Pl(O.value)||!T?T:function(z,$){return $.replace(/{([^{}]+)}/g,function(Q,re){return re in z?String(z[re]):""})}(g.properties,T)},s.prototype.createBucket=function(c){return new et(c)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype._setPaintOverrides=function(){for(var c=0,g=Fe.paint.overridableProperties;c<g.length;c+=1){var b=g[c];if(s.hasPaintOverride(this.layout,b)){var A,T=this.paint.get(b),O=new ct(T),z=new mc(O,T.property.specification);A=T.value.kind==="constant"||T.value.kind==="source"?new Lc("source",z):new Oc("composite",z,T.value.zoomStops,T.value._interpolationType),this.paint._values[b]=new bu(T.property,A,T.parameters)}}},s.prototype._handleOverridablePaintPropertyUpdate=function(c,g,b){return!(!this.layout||g.isDataDriven()||b.isDataDriven())&&s.hasPaintOverride(this.layout,c)},s.hasPaintOverride=function(c,g){var b=c.get("text-field"),A=Fe.paint.properties[g],T=!1,O=function(Q){for(var re=0,me=Q;re<me.length;re+=1)if(A.overrides&&A.overrides.hasOverride(me[re]))return void(T=!0)};if(b.value.kind==="constant"&&b.value.value instanceof ko)O(b.value.value.sections);else if(b.value.kind==="source"){var z=function(Q){T||(Q instanceof Xo&&Ua(Q.value)===$a?O(Q.value.sections):Q instanceof vs?O(Q.sections):Q.eachChild(z))},$=b.value;$._styleExpression&&z($._styleExpression.expression)}return T},s}(ol),Zt={paint:new ls({"background-color":new mi(Te.paint_background["background-color"]),"background-pattern":new ks(Te.paint_background["background-pattern"]),"background-opacity":new mi(Te.paint_background["background-opacity"])})},Qt=function(a){function s(c){a.call(this,c,Zt)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(ol),Vr={paint:new ls({"raster-opacity":new mi(Te.paint_raster["raster-opacity"]),"raster-hue-rotate":new mi(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new mi(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new mi(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new mi(Te.paint_raster["raster-saturation"]),"raster-contrast":new mi(Te.paint_raster["raster-contrast"]),"raster-resampling":new mi(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new mi(Te.paint_raster["raster-fade-duration"])})},En=function(a){function s(c){a.call(this,c,Vr)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(ol),An=function(a){function s(c){a.call(this,c,{}),this.implementation=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},s.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},s.prototype.recalculate=function(){},s.prototype.updateTransitions=function(){},s.prototype.hasTransition=function(){},s.prototype.serialize=function(){},s.prototype.onAdd=function(c){this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},s.prototype.onRemove=function(c){this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},s}(ol),Dn={circle:Bf,heatmap:zp,hillshade:Ep,fill:Fh,"fill-extrusion":bl,line:ap,symbol:Ve,background:Qt,raster:En},bn=Ae.HTMLImageElement,oi=Ae.HTMLCanvasElement,Zn=Ae.HTMLVideoElement,ti=Ae.ImageData,Qn=Ae.ImageBitmap,$n=function(a,s,c,g){this.context=a,this.format=c,this.texture=a.gl.createTexture(),this.update(s,g)};$n.prototype.update=function(a,s,c){var g=a.width,b=a.height,A=!(this.size&&this.size[0]===g&&this.size[1]===b||c),T=this.context,O=T.gl;if(this.useMipmap=Boolean(s&&s.useMipmap),O.bindTexture(O.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===O.RGBA&&(!s||s.premultiply!==!1)),A)this.size=[g,b],a instanceof bn||a instanceof oi||a instanceof Zn||a instanceof ti||Qn&&a instanceof Qn?O.texImage2D(O.TEXTURE_2D,0,this.format,this.format,O.UNSIGNED_BYTE,a):O.texImage2D(O.TEXTURE_2D,0,this.format,g,b,0,this.format,O.UNSIGNED_BYTE,a.data);else{var z=c||{x:0,y:0},$=z.x,Q=z.y;a instanceof bn||a instanceof oi||a instanceof Zn||a instanceof ti||Qn&&a instanceof Qn?O.texSubImage2D(O.TEXTURE_2D,0,$,Q,O.RGBA,O.UNSIGNED_BYTE,a):O.texSubImage2D(O.TEXTURE_2D,0,$,Q,g,b,O.RGBA,O.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&O.generateMipmap(O.TEXTURE_2D)},$n.prototype.bind=function(a,s,c){var g=this.context.gl;g.bindTexture(g.TEXTURE_2D,this.texture),c!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=g.LINEAR),a!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,a),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,c||a),this.filter=a),s!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,s),this.wrap=s)},$n.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},$n.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Zi=function(a){var s=this;this._callback=a,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){s._triggered=!1,s._callback()})};Zi.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},Zi.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Qa=function(a,s,c){this.target=a,this.parent=s,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Cr(["receive","process"],this),this.invoker=new Zi(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=oe()?a:Ae};function tu(a,s,c){var g=2*Math.PI*6378137/256/Math.pow(2,c);return[a*g-2*Math.PI*6378137/2,s*g-2*Math.PI*6378137/2]}Qa.prototype.send=function(a,s,c,g,b){var A=this;b===void 0&&(b=!1);var T=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[T]=c);var O=U(this.globalScope)?void 0:[];return this.target.postMessage({id:T,type:a,hasCallback:!!c,targetMapId:g,mustQueue:b,sourceMapId:this.mapId,data:Du(s,O)},O),{cancel:function(){c&&delete A.callbacks[T],A.target.postMessage({id:T,type:"<cancel>",targetMapId:g,sourceMapId:A.mapId})}}},Qa.prototype.receive=function(a){var s=a.data,c=s.id;if(c&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[c];var g=this.cancelCallbacks[c];delete this.cancelCallbacks[c],g&&g()}else oe()||s.mustQueue?(this.tasks[c]=s,this.taskQueue.push(c),this.invoker.trigger()):this.processTask(c,s)},Qa.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),s=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(a,s)}},Qa.prototype.processTask=function(a,s){var c=this;if(s.type==="<response>"){var g=this.callbacks[a];delete this.callbacks[a],g&&(s.error?g(Is(s.error)):g(null,Is(s.data)))}else{var b=!1,A=U(this.globalScope)?void 0:[],T=s.hasCallback?function(Q,re){b=!0,delete c.cancelCallbacks[a],c.target.postMessage({id:a,type:"<response>",sourceMapId:c.mapId,error:Q?Du(Q):null,data:Du(re,A)},A)}:function(Q){b=!0},O=null,z=Is(s.data);if(this.parent[s.type])O=this.parent[s.type](s.sourceMapId,z,T);else if(this.parent.getWorkerSource){var $=s.type.split(".");O=this.parent.getWorkerSource(s.sourceMapId,$[0],z.source)[$[1]](z,T)}else T(new Error("Could not find function "+s.type));!b&&O&&O.cancel&&(this.cancelCallbacks[a]=O.cancel)}},Qa.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Do=function(a,s){a&&(s?this.setSouthWest(a).setNorthEast(s):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};Do.prototype.setNorthEast=function(a){return this._ne=a instanceof Ja?new Ja(a.lng,a.lat):Ja.convert(a),this},Do.prototype.setSouthWest=function(a){return this._sw=a instanceof Ja?new Ja(a.lng,a.lat):Ja.convert(a),this},Do.prototype.extend=function(a){var s,c,g=this._sw,b=this._ne;if(a instanceof Ja)s=a,c=a;else{if(!(a instanceof Do))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(Do.convert(a)):this.extend(Ja.convert(a)):this;if(c=a._ne,!(s=a._sw)||!c)return this}return g||b?(g.lng=Math.min(s.lng,g.lng),g.lat=Math.min(s.lat,g.lat),b.lng=Math.max(c.lng,b.lng),b.lat=Math.max(c.lat,b.lat)):(this._sw=new Ja(s.lng,s.lat),this._ne=new Ja(c.lng,c.lat)),this},Do.prototype.getCenter=function(){return new Ja((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Do.prototype.getSouthWest=function(){return this._sw},Do.prototype.getNorthEast=function(){return this._ne},Do.prototype.getNorthWest=function(){return new Ja(this.getWest(),this.getNorth())},Do.prototype.getSouthEast=function(){return new Ja(this.getEast(),this.getSouth())},Do.prototype.getWest=function(){return this._sw.lng},Do.prototype.getSouth=function(){return this._sw.lat},Do.prototype.getEast=function(){return this._ne.lng},Do.prototype.getNorth=function(){return this._ne.lat},Do.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Do.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Do.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Do.prototype.contains=function(a){var s=Ja.convert(a),c=s.lng,g=s.lat,b=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(b=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=g&&g<=this._ne.lat&&b},Do.convert=function(a){return!a||a instanceof Do?a:new Do(a)};var Ja=function(a,s){if(isNaN(a)||isNaN(s))throw new Error("Invalid LngLat object: ("+a+", "+s+")");if(this.lng=+a,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Ja.prototype.wrap=function(){return new Ja(mr(this.lng,-180,180),this.lat)},Ja.prototype.toArray=function(){return[this.lng,this.lat]},Ja.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Ja.prototype.distanceTo=function(a){var s=Math.PI/180,c=this.lat*s,g=a.lat*s,b=Math.sin(c)*Math.sin(g)+Math.cos(c)*Math.cos(g)*Math.cos((a.lng-this.lng)*s);return 63710088e-1*Math.acos(Math.min(b,1))},Ja.prototype.toBounds=function(a){a===void 0&&(a=0);var s=360*a/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new Do(new Ja(this.lng-c,this.lat-s),new Ja(this.lng+c,this.lat+s))},Ja.convert=function(a){if(a instanceof Ja)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Ja(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Ja(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var $c=2*Math.PI*63710088e-1;function $u(a){return $c*Math.cos(a*Math.PI/180)}function Xl(a){return(180+a)/360}function Sl(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function sp(a,s){return a/$u(s)}function wl(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var yf=function(a,s,c){c===void 0&&(c=0),this.x=+a,this.y=+s,this.z=+c};yf.fromLngLat=function(a,s){s===void 0&&(s=0);var c=Ja.convert(a);return new yf(Xl(c.lng),Sl(c.lat),sp(s,c.lat))},yf.prototype.toLngLat=function(){return new Ja(360*this.x-180,wl(this.y))},yf.prototype.toAltitude=function(){return this.z*$u(wl(this.y))},yf.prototype.meterInMercatorCoordinateUnits=function(){return 1/$c*(a=wl(this.y),1/Math.cos(a*Math.PI/180));var a};var lh=function(a,s,c){this.z=a,this.x=s,this.y=c,this.key=Xp(0,a,a,s,c)};lh.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},lh.prototype.url=function(a,s){var c,g,b,A,T,O=(g=this.y,b=this.z,A=tu(256*(c=this.x),256*(g=Math.pow(2,b)-g-1),b),T=tu(256*(c+1),256*(g+1),b),A[0]+","+A[1]+","+T[0]+","+T[1]),z=function($,Q,re){for(var me,Ee="",$e=$;$e>0;$e--)Ee+=(Q&(me=1<<$e-1)?1:0)+(re&me?2:0);return Ee}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",z).replace("{bbox-epsg-3857}",O)},lh.prototype.getTilePoint=function(a){var s=Math.pow(2,this.z);return new ve(8192*(a.x*s-this.x),8192*(a.y*s-this.y))},lh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Ed=function(a,s){this.wrap=a,this.canonical=s,this.key=Xp(a,s.z,s.z,s.x,s.y)},ru=function(a,s,c,g,b){this.overscaledZ=a,this.wrap=s,this.canonical=new lh(c,+g,+b),this.key=Xp(s,a,c,g,b)};function Xp(a,s,c,g,b){(a*=2)<0&&(a=-1*a-1);var A=1<<c;return(A*A*a+A*b+g).toString(36)+c.toString(36)+s.toString(36)}ru.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},ru.prototype.scaledTo=function(a){var s=this.canonical.z-a;return a>this.canonical.z?new ru(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ru(a,this.wrap,a,this.canonical.x>>s,this.canonical.y>>s)},ru.prototype.calculateScaledKey=function(a,s){var c=this.canonical.z-a;return a>this.canonical.z?Xp(this.wrap*+s,a,this.canonical.z,this.canonical.x,this.canonical.y):Xp(this.wrap*+s,a,a,this.canonical.x>>c,this.canonical.y>>c)},ru.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var s=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>s&&a.canonical.y===this.canonical.y>>s},ru.prototype.children=function(a){if(this.overscaledZ>=a)return[new ru(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var s=this.canonical.z+1,c=2*this.canonical.x,g=2*this.canonical.y;return[new ru(s,this.wrap,s,c,g),new ru(s,this.wrap,s,c+1,g),new ru(s,this.wrap,s,c,g+1),new ru(s,this.wrap,s,c+1,g+1)]},ru.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},ru.prototype.wrapped=function(){return new ru(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ru.prototype.unwrapTo=function(a){return new ru(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},ru.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ru.prototype.toUnwrapped=function(){return new Ed(this.wrap,this.canonical)},ru.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ru.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new yf(a.x-this.wrap,a.y))},Gn("CanonicalTileID",lh),Gn("OverscaledTileID",ru,{omit:["posMatrix"]});var zh=function(a,s,c){if(this.uid=a,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return Ct('"'+c+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=s.height;var g=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=c||"mapbox";for(var b=0;b<g;b++)this.data[this._idx(-1,b)]=this.data[this._idx(0,b)],this.data[this._idx(g,b)]=this.data[this._idx(g-1,b)],this.data[this._idx(b,-1)]=this.data[this._idx(b,0)],this.data[this._idx(b,g)]=this.data[this._idx(b,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)]};zh.prototype.get=function(a,s){var c=new Uint8Array(this.data.buffer),g=4*this._idx(a,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(c[g],c[g+1],c[g+2])},zh.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},zh.prototype._idx=function(a,s){if(a<-1||a>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(a+1)},zh.prototype._unpackMapbox=function(a,s,c){return(256*a*256+256*s+c)/10-1e4},zh.prototype._unpackTerrarium=function(a,s,c){return 256*a+s+c/256-32768},zh.prototype.getPixels=function(){return new Xs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},zh.prototype.backfillBorder=function(a,s,c){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var g=s*this.dim,b=s*this.dim+this.dim,A=c*this.dim,T=c*this.dim+this.dim;switch(s){case-1:g=b-1;break;case 1:b=g+1}switch(c){case-1:A=T-1;break;case 1:T=A+1}for(var O=-s*this.dim,z=-c*this.dim,$=A;$<T;$++)for(var Q=g;Q<b;Q++)this.data[this._idx(Q,$)]=a.data[this._idx(Q+O,$+z)]},Gn("DEMData",zh);var $p=function(a){this._stringToNumber={},this._numberToString=[];for(var s=0;s<a.length;s++){var c=a[s];this._stringToNumber[c]=s,this._numberToString[s]=c}};$p.prototype.encode=function(a){return this._stringToNumber[a]},$p.prototype.decode=function(a){return this._numberToString[a]};var Sd=function(a,s,c,g,b){this.type="Feature",this._vectorTileFeature=a,a._z=s,a._x=c,a._y=g,this.properties=a.properties,this.id=b},hv={geometry:{configurable:!0}};hv.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},hv.geometry.set=function(a){this._geometry=a},Sd.prototype.toJSON=function(){var a={geometry:this.geometry};for(var s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(a[s]=this[s]);return a},Object.defineProperties(Sd.prototype,hv);var kn=function(){this.state={},this.stateChanges={},this.deletedStates={}};kn.prototype.updateState=function(a,s,c){var g=String(s);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][g]=this.stateChanges[a][g]||{},jt(this.stateChanges[a][g],c),this.deletedStates[a]===null)for(var b in this.deletedStates[a]={},this.state[a])b!==g&&(this.deletedStates[a][b]=null);else if(this.deletedStates[a]&&this.deletedStates[a][g]===null)for(var A in this.deletedStates[a][g]={},this.state[a][g])c[A]||(this.deletedStates[a][g][A]=null);else for(var T in c)this.deletedStates[a]&&this.deletedStates[a][g]&&this.deletedStates[a][g][T]===null&&delete this.deletedStates[a][g][T]},kn.prototype.removeFeatureState=function(a,s,c){if(this.deletedStates[a]!==null){var g=String(s);if(this.deletedStates[a]=this.deletedStates[a]||{},c&&s!==void 0)this.deletedStates[a][g]!==null&&(this.deletedStates[a][g]=this.deletedStates[a][g]||{},this.deletedStates[a][g][c]=null);else if(s!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][g])for(c in this.deletedStates[a][g]={},this.stateChanges[a][g])this.deletedStates[a][g][c]=null;else this.deletedStates[a][g]=null;else this.deletedStates[a]=null}},kn.prototype.getState=function(a,s){var c=String(s),g=jt({},(this.state[a]||{})[c],(this.stateChanges[a]||{})[c]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var b=this.deletedStates[a][s];if(b===null)return{};for(var A in b)delete g[A]}return g},kn.prototype.initializeTileState=function(a,s){a.setFeatureState(this.state,s)},kn.prototype.coalesceChanges=function(a,s){var c={};for(var g in this.stateChanges){this.state[g]=this.state[g]||{};var b={};for(var A in this.stateChanges[g])this.state[g][A]||(this.state[g][A]={}),jt(this.state[g][A],this.stateChanges[g][A]),b[A]=this.state[g][A];c[g]=b}for(var T in this.deletedStates){this.state[T]=this.state[T]||{};var O={};if(this.deletedStates[T]===null)for(var z in this.state[T])O[z]={},this.state[T][z]={};else for(var $ in this.deletedStates[T]){if(this.deletedStates[T][$]===null)this.state[T][$]={};else for(var Q=0,re=Object.keys(this.deletedStates[T][$]);Q<re.length;Q+=1)delete this.state[T][$][re[Q]];O[$]=this.state[T][$]}c[T]=c[T]||{},jt(c[T],O)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(var me in a)a[me].setFeatureState(c,s)};var ch=function(a,s){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new il(8192,16,0),this.grid3D=new il(8192,16,0),this.featureIndexArray=new ae,this.promoteId=s};function fr(a,s,c,g,b){return gr(a,function(A,T){var O=s instanceof wa?s.get(T):null;return O&&O.evaluate?O.evaluate(c,g,b):O})}function pv(a){for(var s=1/0,c=1/0,g=-1/0,b=-1/0,A=0,T=a;A<T.length;A+=1){var O=T[A];s=Math.min(s,O.x),c=Math.min(c,O.y),g=Math.max(g,O.x),b=Math.max(b,O.y)}return{minX:s,minY:c,maxX:g,maxY:b}}function n0(a,s){return s-a}ch.prototype.insert=function(a,s,c,g,b,A){var T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,g,b);for(var O=A?this.grid3D:this.grid,z=0;z<s.length;z++){for(var $=s[z],Q=[1/0,1/0,-1/0,-1/0],re=0;re<$.length;re++){var me=$[re];Q[0]=Math.min(Q[0],me.x),Q[1]=Math.min(Q[1],me.y),Q[2]=Math.max(Q[2],me.x),Q[3]=Math.max(Q[3],me.y)}Q[0]<8192&&Q[1]<8192&&Q[2]>=0&&Q[3]>=0&&O.insert(T,Q[0],Q[1],Q[2],Q[3])}},ch.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Dl.VectorTile(new Uf(this.rawTileData)).layers,this.sourceLayerCoder=new $p(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ch.prototype.query=function(a,s,c,g){var b=this;this.loadVTLayers();for(var A=a.params||{},T=8192/a.tileSize/a.scale,O=Ws(A.filter),z=a.queryGeometry,$=a.queryPadding*T,Q=pv(z),re=this.grid.query(Q.minX-$,Q.minY-$,Q.maxX+$,Q.maxY+$),me=pv(a.cameraQueryGeometry),Ee=this.grid3D.query(me.minX-$,me.minY-$,me.maxX+$,me.maxY+$,function(_r,Er,Br,dn){return function(Ln,xi,jn,Ai,Wn){for(var la=0,ji=Ln;la<ji.length;la+=1){var hi=ji[la];if(xi<=hi.x&&jn<=hi.y&&Ai>=hi.x&&Wn>=hi.y)return!0}var Ca=[new ve(xi,jn),new ve(xi,Wn),new ve(Ai,Wn),new ve(Ai,jn)];if(Ln.length>2){for(var oa=0,Pa=Ca;oa<Pa.length;oa+=1)if(ju(Ln,Pa[oa]))return!0}for(var Ci=0;Ci<Ln.length-1;Ci++)if(Ol(Ln[Ci],Ln[Ci+1],Ca))return!0;return!1}(a.cameraQueryGeometry,_r-$,Er-$,Br+$,dn+$)}),$e=0,qe=Ee;$e<qe.length;$e+=1)re.push(qe[$e]);re.sort(n0);for(var bt,st={},Nt=function(_r){var Er=re[_r];if(Er!==bt){bt=Er;var Br=b.featureIndexArray.get(Er),dn=null;b.loadMatchingFeature(st,Br.bucketIndex,Br.sourceLayerIndex,Br.featureIndex,O,A.layers,A.availableImages,s,c,g,function(Ln,xi,jn){return dn||(dn=Zo(Ln)),xi.queryIntersectsFeature(z,Ln,jn,dn,b.z,a.transform,T,a.pixelPosMatrix)})}},er=0;er<re.length;er++)Nt(er);return st},ch.prototype.loadMatchingFeature=function(a,s,c,g,b,A,T,O,z,$,Q){var re=this.bucketLayerIDs[s];if(!A||function(Ln,xi){for(var jn=0;jn<Ln.length;jn++)if(xi.indexOf(Ln[jn])>=0)return!0;return!1}(A,re)){var me=this.sourceLayerCoder.decode(c),Ee=this.vtLayers[me].feature(g);if(b.needGeometry){var $e=wo(Ee,!0);if(!b.filter(new ga(this.tileID.overscaledZ),$e,this.tileID.canonical))return}else if(!b.filter(new ga(this.tileID.overscaledZ),Ee))return;for(var qe=this.getId(Ee,me),bt=0;bt<re.length;bt++){var st=re[bt];if(!(A&&A.indexOf(st)<0)){var Nt=O[st];if(Nt){var er={};qe!==void 0&&$&&(er=$.getState(Nt.sourceLayer||"_geojsonTileLayer",qe));var _r=jt({},z[st]);_r.paint=fr(_r.paint,Nt.paint,Ee,er,T),_r.layout=fr(_r.layout,Nt.layout,Ee,er,T);var Er=!Q||Q(Ee,Nt,er);if(Er){var Br=new Sd(Ee,this.z,this.x,this.y,qe);Br.layer=_r;var dn=a[st];dn===void 0&&(dn=a[st]=[]),dn.push({featureIndex:g,feature:Br,intersectionZ:Er})}}}}}},ch.prototype.lookupSymbolFeatures=function(a,s,c,g,b,A,T,O){var z={};this.loadVTLayers();for(var $=Ws(b),Q=0,re=a;Q<re.length;Q+=1)this.loadMatchingFeature(z,c,g,re[Q],$,A,T,O,s);return z},ch.prototype.hasLayer=function(a){for(var s=0,c=this.bucketLayerIDs;s<c.length;s+=1)for(var g=0,b=c[s];g<b.length;g+=1)if(a===b[g])return!0;return!1},ch.prototype.getId=function(a,s){var c=a.id;return this.promoteId&&typeof(c=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]])=="boolean"&&(c=Number(c)),c},Gn("FeatureIndex",ch,{omit:["rawTileData","sourceLayerCoder"]});var hu=function(a,s){this.tileID=a,this.uid=qt(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};hu.prototype.registerFadeDuration=function(a){var s=a+this.timeAdded;s<si.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)},hu.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},hu.prototype.loadVectorData=function(a,s,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var g in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function($,Q){var re={};if(!Q)return re;for(var me=function(){var qe=$e[Ee],bt=qe.layerIds.map(function(er){return Q.getLayer(er)}).filter(Boolean);if(bt.length!==0){qe.layers=bt,qe.stateDependentLayerIds&&(qe.stateDependentLayers=qe.stateDependentLayerIds.map(function(er){return bt.filter(function(_r){return _r.id===er})[0]}));for(var st=0,Nt=bt;st<Nt.length;st+=1)re[Nt[st].id]=qe}},Ee=0,$e=$;Ee<$e.length;Ee+=1)me();return re}(a.buckets,s.style),this.hasSymbolBuckets=!1,this.buckets){var b=this.buckets[g];if(b instanceof et){if(this.hasSymbolBuckets=!0,!c)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var A in this.buckets){var T=this.buckets[A];if(T instanceof et&&T.hasRTLText){this.hasRTLText=!0,dl.isLoading()||dl.isLoaded()||Rf()!=="deferred"||al();break}}for(var O in this.queryPadding=0,this.buckets){var z=this.buckets[O];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(O).queryRadius(z))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new d},hu.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},hu.prototype.getBucket=function(a){return this.buckets[a.id]},hu.prototype.upload=function(a){for(var s in this.buckets){var c=this.buckets[s];c.uploadPending()&&c.upload(a)}var g=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new $n(a,this.imageAtlas.image,g.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new $n(a,this.glyphAtlasImage,g.ALPHA),this.glyphAtlasImage=null)},hu.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},hu.prototype.queryRenderedFeatures=function(a,s,c,g,b,A,T,O,z,$){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:b,scale:A,tileSize:this.tileSize,pixelPosMatrix:$,transform:O,params:T,queryPadding:this.queryPadding*z},a,s,c):{}},hu.prototype.querySourceFeatures=function(a,s){var c=this.latestFeatureIndex;if(c&&c.rawTileData){var g=c.loadVTLayers(),b=s?s.sourceLayer:"",A=g._geojsonTileLayer||g[b];if(A)for(var T=Ws(s&&s.filter),O=this.tileID.canonical,z=O.z,$=O.x,Q=O.y,re={z,x:$,y:Q},me=0;me<A.length;me++){var Ee=A.feature(me);if(T.needGeometry){var $e=wo(Ee,!0);if(!T.filter(new ga(this.tileID.overscaledZ),$e,this.tileID.canonical))continue}else if(!T.filter(new ga(this.tileID.overscaledZ),Ee))continue;var qe=c.getId(Ee,b),bt=new Sd(Ee,z,$,Q,qe);bt.tile=re,a.push(bt)}}},hu.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},hu.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},hu.prototype.setExpiryData=function(a){var s=this.expirationTime;if(a.cacheControl){var c=Ue(a.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var g=Date.now(),b=!1;if(this.expirationTime>g)b=!1;else if(s)if(this.expirationTime<s)b=!0;else{var A=this.expirationTime-s;A?this.expirationTime=g+Math.max(A,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},hu.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},hu.prototype.setFeatureState=function(a,s){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var c=this.latestFeatureIndex.loadVTLayers();for(var g in this.buckets)if(s.style.hasLayer(g)){var b=this.buckets[g],A=b.layers[0].sourceLayer||"_geojsonTileLayer",T=c[A],O=a[A];if(T&&O&&Object.keys(O).length!==0){b.update(O,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});var z=s&&s.style&&s.style.getLayer(g);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(b)))}}}},hu.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},hu.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<si.now()},hu.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},hu.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=si.now()+a},hu.prototype.setDependencies=function(a,s){for(var c={},g=0,b=s;g<b.length;g+=1)c[b[g]]=!0;this.dependencies[a]=c},hu.prototype.hasDependency=function(a,s){for(var c=0,g=a;c<g.length;c+=1){var b=this.dependencies[g[c]];if(b){for(var A=0,T=s;A<T.length;A+=1)if(b[T[A]])return!0}}return!1};var Zh=Ae.performance,Ud=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},Zh.mark(this._marks.start)};Ud.prototype.finish=function(){Zh.mark(this._marks.end);var a=Zh.getEntriesByName(this._marks.measure);return a.length===0&&(Zh.measure(this._marks.measure,this._marks.start,this._marks.end),a=Zh.getEntriesByName(this._marks.measure),Zh.clearMarks(this._marks.start),Zh.clearMarks(this._marks.end),Zh.clearMeasures(this._marks.measure)),a},_.Actor=Qa,_.AlphaImage=Su,_.CanonicalTileID=lh,_.CollisionBoxArray=d,_.Color=na,_.DEMData=zh,_.DataConstantProperty=mi,_.DictionaryCoder=$p,_.EXTENT=8192,_.ErrorEvent=ht,_.EvaluationParameters=ga,_.Event=He,_.Evented=At,_.FeatureIndex=ch,_.FillBucket=_l,_.FillExtrusionBucket=xl,_.ImageAtlas=nn,_.ImagePosition=zt,_.LineBucket=no,_.LngLat=Ja,_.LngLatBounds=Do,_.MercatorCoordinate=yf,_.ONE_EM=24,_.OverscaledTileID=ru,_.Point=ve,_.Point$1=ve,_.Properties=ls,_.Protobuf=Uf,_.RGBAImage=Xs,_.RequestManager=sa,_.RequestPerformance=Ud,_.ResourceType=mn,_.SegmentVector=we,_.SourceFeatureState=kn,_.StructArrayLayout1ui2=Lf,_.StructArrayLayout2f1f2i16=Zu,_.StructArrayLayout2i4=zc,_.StructArrayLayout3ui6=Zc,_.StructArrayLayout4i8=sl,_.SymbolBucket=et,_.Texture=$n,_.Tile=hu,_.Transitionable=Ya,_.Uniform1f=yn,_.Uniform1i=Xr,_.Uniform2f=ln,_.Uniform3f=Bn,_.Uniform4f=ei,_.UniformColor=_i,_.UniformMatrix4f=Ki,_.UnwrappedTileID=Ed,_.ValidationError=Je,_.WritingMode=wn,_.ZoomHistory=af,_.add=function(a,s,c){return a[0]=s[0]+c[0],a[1]=s[1]+c[1],a[2]=s[2]+c[2],a},_.addDynamicAttributes=pt,_.asyncAll=function(a,s,c){if(!a.length)return c(null,[]);var g=a.length,b=new Array(a.length),A=null;a.forEach(function(T,O){s(T,function(z,$){z&&(A=z),b[O]=$,--g==0&&c(A,b)})})},_.bezier=gt,_.bindAll=Cr,_.browser=si,_.cacheEntryPossiblyAdded=function(a){++ui>Ar&&(a.getActor().send("enforceCacheSizeLimit",Bt),ui=0)},_.clamp=Ft,_.clearTileCache=function(a){var s=Ae.caches.delete("mapbox-tiles");a&&s.catch(a).then(function(){return a()})},_.clipLine=Fa,_.clone=function(a){var s=new Na(16);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],s[4]=a[4],s[5]=a[5],s[6]=a[6],s[7]=a[7],s[8]=a[8],s[9]=a[9],s[10]=a[10],s[11]=a[11],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15],s},_.clone$1=xt,_.clone$2=function(a){var s=new Na(3);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s},_.collisionCircleLayout=bd,_.config=xn,_.create=function(){var a=new Na(16);return Na!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},_.create$1=function(){var a=new Na(9);return Na!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},_.create$2=function(){var a=new Na(4);return Na!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},_.createCommonjsModule=Pe,_.createExpression=gc,_.createLayout=zo,_.createStyleLayer=function(a){return a.type==="custom"?new An(a):new Dn[a.type](a)},_.cross=function(a,s,c){var g=s[0],b=s[1],A=s[2],T=c[0],O=c[1],z=c[2];return a[0]=b*z-A*O,a[1]=A*T-g*z,a[2]=g*O-b*T,a},_.deepEqual=function a(s,c){if(Array.isArray(s)){if(!Array.isArray(c)||s.length!==c.length)return!1;for(var g=0;g<s.length;g++)if(!a(s[g],c[g]))return!1;return!0}if(typeof s=="object"&&s!==null&&c!==null){if(typeof c!="object"||Object.keys(s).length!==Object.keys(c).length)return!1;for(var b in s)if(!a(s[b],c[b]))return!1;return!0}return s===c},_.dot=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]},_.dot$1=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]+a[3]*s[3]},_.ease=Mt,_.emitValidationErrors=bc,_.endsWith=ne,_.enforceCacheSizeLimit=function(a){zr(),ce&&ce.then(function(s){s.keys().then(function(c){for(var g=0;g<c.length-a;g++)s.delete(c[g])})})},_.evaluateSizeForFeature=ki,_.evaluateSizeForZoom=Vi,_.evaluateVariableOffset=gf,_.evented=Bc,_.extend=jt,_.featureFilter=Ws,_.filterObject=It,_.fromRotation=function(a,s){var c=Math.sin(s),g=Math.cos(s);return a[0]=g,a[1]=c,a[2]=0,a[3]=-c,a[4]=g,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},_.getAnchorAlignment=Rn,_.getAnchorJustification=We,_.getArrayBuffer=to,_.getImage=le,_.getJSON=function(a,s){return Io(jt(a,{type:"json"}),s)},_.getRTLTextPluginStatus=Rf,_.getReferrer=Si,_.getVideo=function(a,s){var c,g,b=Ae.document.createElement("video");b.muted=!0,b.onloadstart=function(){s(null,b)};for(var A=0;A<a.length;A++){var T=Ae.document.createElement("source");c=a[A],g=void 0,(g=Ae.document.createElement("a")).href=c,(g.protocol!==Ae.document.location.protocol||g.host!==Ae.document.location.host)&&(b.crossOrigin="Anonymous"),T.src=a[A],b.appendChild(T)}return{cancel:function(){}}},_.identity=ll,_.invert=function(a,s){var c=s[0],g=s[1],b=s[2],A=s[3],T=s[4],O=s[5],z=s[6],$=s[7],Q=s[8],re=s[9],me=s[10],Ee=s[11],$e=s[12],qe=s[13],bt=s[14],st=s[15],Nt=c*O-g*T,er=c*z-b*T,_r=c*$-A*T,Er=g*z-b*O,Br=g*$-A*O,dn=b*$-A*z,Ln=Q*qe-re*$e,xi=Q*bt-me*$e,jn=Q*st-Ee*$e,Ai=re*bt-me*qe,Wn=re*st-Ee*qe,la=me*st-Ee*bt,ji=Nt*la-er*Wn+_r*Ai+Er*jn-Br*xi+dn*Ln;return ji?(a[0]=(O*la-z*Wn+$*Ai)*(ji=1/ji),a[1]=(b*Wn-g*la-A*Ai)*ji,a[2]=(qe*dn-bt*Br+st*Er)*ji,a[3]=(me*Br-re*dn-Ee*Er)*ji,a[4]=(z*jn-T*la-$*xi)*ji,a[5]=(c*la-b*jn+A*xi)*ji,a[6]=(bt*_r-$e*dn-st*er)*ji,a[7]=(Q*dn-me*_r+Ee*er)*ji,a[8]=(T*Wn-O*jn+$*Ln)*ji,a[9]=(g*jn-c*Wn-A*Ln)*ji,a[10]=($e*Br-qe*_r+st*Nt)*ji,a[11]=(re*_r-Q*Br-Ee*Nt)*ji,a[12]=(O*xi-T*Ai-z*Ln)*ji,a[13]=(c*Ai-g*xi+b*Ln)*ji,a[14]=(qe*er-$e*Er-bt*Nt)*ji,a[15]=(Q*Er-re*er+me*Nt)*ji,a):null},_.isChar=Sn,_.isMapboxURL=Bi,_.keysDifference=function(a,s){var c=[];for(var g in a)g in s||c.push(g);return c},_.makeRequest=Io,_.mapObject=gr,_.mercatorXfromLng=Xl,_.mercatorYfromLat=Sl,_.mercatorZfromAltitude=sp,_.mul=gl,_.multiply=Eu,_.mvt=Dl,_.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},_.normalize=function(a,s){var c=s[0],g=s[1],b=s[2],A=c*c+g*g+b*b;return A>0&&(A=1/Math.sqrt(A)),a[0]=s[0]*A,a[1]=s[1]*A,a[2]=s[2]*A,a},_.number=lo,_.offscreenCanvasSupported=Jn,_.ortho=function(a,s,c,g,b,A,T){var O=1/(s-c),z=1/(g-b),$=1/(A-T);return a[0]=-2*O,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*z,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*$,a[11]=0,a[12]=(s+c)*O,a[13]=(b+g)*z,a[14]=(T+A)*$,a[15]=1,a},_.parseGlyphPBF=function(a){return new Uf(a).readFields(hn,[])},_.pbf=Uf,_.performSymbolLayout=function(a,s,c,g,b,A,T){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var O=a.layers[0].layout,z=a.layers[0]._unevaluatedLayout._values,$={};if(a.textSizeData.kind==="composite"){var Q=a.textSizeData,re=Q.maxZoom;$.compositeTextSizes=[z["text-size"].possiblyEvaluate(new ga(Q.minZoom),T),z["text-size"].possiblyEvaluate(new ga(re),T)]}if(a.iconSizeData.kind==="composite"){var me=a.iconSizeData,Ee=me.maxZoom;$.compositeIconSizes=[z["icon-size"].possiblyEvaluate(new ga(me.minZoom),T),z["icon-size"].possiblyEvaluate(new ga(Ee),T)]}$.layoutTextSize=z["text-size"].possiblyEvaluate(new ga(a.zoom+1),T),$.layoutIconSize=z["icon-size"].possiblyEvaluate(new ga(a.zoom+1),T),$.textMaxSize=z["text-size"].possiblyEvaluate(new ga(18));for(var $e=24*O.get("text-line-height"),qe=O.get("text-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",bt=O.get("text-keep-upright"),st=O.get("text-size"),Nt=function(){var Er=_r[er],Br=O.get("text-font").evaluate(Er,{},T).join(","),dn=st.evaluate(Er,{},T),Ln=$.layoutTextSize.evaluate(Er,{},T),xi=$.layoutIconSize.evaluate(Er,{},T),jn={horizontal:{},vertical:void 0},Ai=Er.text,Wn=[0,0];if(Ai){var la=Ai.toString(),ji=24*O.get("text-letter-spacing").evaluate(Er,{},T),hi=function(ba){for(var Bo=0,po=ba;Bo<po.length;Bo+=1)if(ja=po[Bo].charCodeAt(0),Sn.Arabic(ja)||Sn["Arabic Supplement"](ja)||Sn["Arabic Extended-A"](ja)||Sn["Arabic Presentation Forms-A"](ja)||Sn["Arabic Presentation Forms-B"](ja))return!1;var ja;return!0}(la)?ji:0,Ca=O.get("text-anchor").evaluate(Er,{},T),oa=O.get("text-variable-anchor");if(!oa){var Pa=O.get("text-radial-offset").evaluate(Er,{},T);Wn=Pa?gf(Ca,[24*Pa,ws]):O.get("text-offset").evaluate(Er,{},T).map(function(ba){return 24*ba})}var Ci=qe?"center":O.get("text-justify").evaluate(Er,{},T),Mi=O.get("symbol-placement"),_o=Mi==="point"?24*O.get("text-max-width").evaluate(Er,{},T):0,Os=function(){a.allowVerticalPlacement&&of(la)&&(jn.vertical=Mn(Ai,s,c,b,Br,_o,$e,Ca,"left",hi,Wn,wn.vertical,!0,Mi,Ln,dn))};if(!qe&&oa){for(var As=Ci==="auto"?oa.map(function(ba){return We(ba)}):[Ci],Qo=!1,as=0;as<As.length;as++){var Fs=As[as];if(!jn.horizontal[Fs])if(Qo)jn.horizontal[Fs]=jn.horizontal[0];else{var pu=Mn(Ai,s,c,b,Br,_o,$e,"center",Fs,hi,Wn,wn.horizontal,!1,Mi,Ln,dn);pu&&(jn.horizontal[Fs]=pu,Qo=pu.positionedLines.length===1)}}Os()}else{Ci==="auto"&&(Ci=We(Ca));var Au=Mn(Ai,s,c,b,Br,_o,$e,Ca,Ci,hi,Wn,wn.horizontal,!1,Mi,Ln,dn);Au&&(jn.horizontal[Ci]=Au),Os(),of(la)&&qe&&bt&&(jn.vertical=Mn(Ai,s,c,b,Br,_o,$e,Ca,Ci,hi,Wn,wn.vertical,!1,Mi,Ln,dn))}}var nu=void 0,Yu=!1;if(Er.icon&&Er.icon.name){var Oo=g[Er.icon.name];Oo&&(nu=function(ba,Bo,po){var ja=Rn(po),qu=Bo[0]-ba.displaySize[0]*ja.horizontalAlign,Pu=Bo[1]-ba.displaySize[1]*ja.verticalAlign;return{image:ba,top:Pu,bottom:Pu+ba.displaySize[1],left:qu,right:qu+ba.displaySize[0]}}(b[Er.icon.name],O.get("icon-offset").evaluate(Er,{},T),O.get("icon-anchor").evaluate(Er,{},T)),Yu=Oo.sdf,a.sdfIcons===void 0?a.sdfIcons=Oo.sdf:a.sdfIcons!==Oo.sdf&&Ct("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Oo.pixelRatio!==a.pixelRatio||O.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var Vs=rr(jn.horizontal)||jn.vertical;a.iconsInText=!!Vs&&Vs.iconsInText,(Vs||nu)&&function(ba,Bo,po,ja,qu,Pu,Jo,$s,Ku,so,Ru){var $l=Pu.textMaxSize.evaluate(Bo,{});$l===void 0&&($l=Jo);var Gf,Wo=ba.layers[0].layout,ca=Wo.get("icon-offset").evaluate(Bo,{},Ru),Yc=rr(po.horizontal),Qu=Jo/24,Cs=ba.tilePixelRatio*Qu,Cp=ba.tilePixelRatio*$l/24,Bl=ba.tilePixelRatio*$s,up=ba.tilePixelRatio*Wo.get("symbol-spacing"),Yp=Wo.get("text-padding")*ba.tilePixelRatio,Tp=Wo.get("icon-padding")*ba.tilePixelRatio,qp=Wo.get("text-max-angle")/180*Math.PI,Kp=Wo.get("text-rotation-alignment")==="map"&&Wo.get("symbol-placement")!=="point",Mp=Wo.get("icon-rotation-alignment")==="map"&&Wo.get("symbol-placement")!=="point",fh=Wo.get("symbol-placement"),Tc=up/2,lp=Wo.get("icon-text-fit");ja&&lp!=="none"&&(ba.allowVerticalPlacement&&po.vertical&&(Gf=zi(ja,po.vertical,lp,Wo.get("icon-text-fit-padding"),ca,Qu)),Yc&&(ja=zi(ja,Yc,lp,Wo.get("icon-text-fit-padding"),ca,Qu)));var _f=function(vv,hc){hc.x<0||hc.x>=8192||hc.y<0||hc.y>=8192||function(Fi,qc,Kc,hh,Td,Vo,Md,Sf,hp,Ta,Ma,rd,mv,gv,Id,i0,a0,o0,s0,u0,Mc,jd,Hd,ph,yv){var _v,Rp,nd,du,fl,id=Fi.addToLineVertexArray(qc,Kc),l0=0,c0=0,xv=0,f0=0,bv=-1,Ev=-1,dh={},kd=je(""),Sv=0,wv=0;if(Sf._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Sv=(_v=Sf.layout.get("text-offset").evaluate(Mc,{},ph).map(function(ad){return 24*ad}))[0],wv=_v[1]):(Sv=24*Sf.layout.get("text-radial-offset").evaluate(Mc,{},ph),wv=ws),Fi.allowVerticalPlacement&&hh.vertical){var Av=Sf.layout.get("text-rotate").evaluate(Mc,{},ph)+90;du=new Ls(hp,qc,Ta,Ma,rd,hh.vertical,mv,gv,Id,Av),Md&&(fl=new Ls(hp,qc,Ta,Ma,rd,Md,a0,o0,Id,Av))}if(Td){var Wd=Sf.layout.get("icon-rotate").evaluate(Mc,{}),h0=Sf.layout.get("icon-text-fit")!=="none",p0=Ko(Td,Wd,Hd,h0),Cv=Md?Ko(Md,Wd,Hd,h0):void 0;nd=new Ls(hp,qc,Ta,Ma,rd,Td,a0,o0,!1,Wd),l0=4*p0.length;var d0=Fi.iconSizeData,vh=null;d0.kind==="source"?(vh=[128*Sf.layout.get("icon-size").evaluate(Mc,{})])[0]>32640&&Ct(Fi.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):d0.kind==="composite"&&((vh=[128*jd.compositeIconSizes[0].evaluate(Mc,{},ph),128*jd.compositeIconSizes[1].evaluate(Mc,{},ph)])[0]>32640||vh[1]>32640)&&Ct(Fi.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Fi.addSymbols(Fi.icon,p0,vh,u0,s0,Mc,!1,qc,id.lineStartIndex,id.lineLength,-1,ph),bv=Fi.icon.placedSymbolArray.length-1,Cv&&(c0=4*Cv.length,Fi.addSymbols(Fi.icon,Cv,vh,u0,s0,Mc,wn.vertical,qc,id.lineStartIndex,id.lineLength,-1,ph),Ev=Fi.icon.placedSymbolArray.length-1)}for(var v0 in hh.horizontal){var Xd=hh.horizontal[v0];if(!Rp){kd=je(Xd.text);var tm=Sf.layout.get("text-rotate").evaluate(Mc,{},ph);Rp=new Ls(hp,qc,Ta,Ma,rd,Xd,mv,gv,Id,tm)}var m0=Xd.positionedLines.length===1;if(xv+=vr(Fi,qc,Xd,Vo,Sf,Id,Mc,i0,id,hh.vertical?wn.horizontal:wn.horizontalOnly,m0?Object.keys(hh.horizontal):[v0],dh,bv,jd,ph),m0)break}hh.vertical&&(f0+=vr(Fi,qc,hh.vertical,Vo,Sf,Id,Mc,i0,id,wn.vertical,["vertical"],dh,Ev,jd,ph));var $d=Rp?Rp.boxStartIndex:Fi.collisionBoxArray.length,Tv=Rp?Rp.boxEndIndex:Fi.collisionBoxArray.length,Yd=du?du.boxStartIndex:Fi.collisionBoxArray.length,Mv=du?du.boxEndIndex:Fi.collisionBoxArray.length,Uh=nd?nd.boxStartIndex:Fi.collisionBoxArray.length,pp=nd?nd.boxEndIndex:Fi.collisionBoxArray.length,Iv=fl?fl.boxStartIndex:Fi.collisionBoxArray.length,kv=fl?fl.boxEndIndex:Fi.collisionBoxArray.length,wf=-1,Lp=function(ad,Pv){return ad&&ad.circleDiameter?Math.max(ad.circleDiameter,Pv):Pv};wf=Lp(Rp,wf),wf=Lp(du,wf),wf=Lp(nd,wf);var qd=(wf=Lp(fl,wf))>-1?1:0;qd&&(wf*=yv/24),Fi.glyphOffsetArray.length>=et.MAX_GLYPHS&&Ct("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Mc.sortKey!==void 0&&Fi.addToSortKeyRanges(Fi.symbolInstances.length,Mc.sortKey),Fi.symbolInstances.emplaceBack(qc.x,qc.y,dh.right>=0?dh.right:-1,dh.center>=0?dh.center:-1,dh.left>=0?dh.left:-1,dh.vertical||-1,bv,Ev,kd,$d,Tv,Yd,Mv,Uh,pp,Iv,kv,Ta,xv,f0,l0,c0,qd,0,mv,Sv,wv,wf)}(ba,hc,vv,po,ja,qu,Gf,ba.layers[0],ba.collisionBoxArray,Bo.index,Bo.sourceLayerIndex,ba.index,Cs,Yp,Kp,Ku,Bl,Tp,Mp,ca,Bo,Pu,so,Ru,Jo)};if(fh==="line")for(var hs=0,Gs=Fa(Bo.geometry,0,0,8192,8192);hs<Gs.length;hs+=1)for(var Ip=Gs[hs],Qp=0,Jp=cu(Ip,up,qp,po.vertical||Yc,ja,24,Cp,ba.overscaling,8192);Qp<Jp.length;Qp+=1){var wd=Jp[Qp];Yc&&Xn(ba,Yc.text,Tc,wd)||_f(Ip,wd)}else if(fh==="line-center")for(var cp=0,ed=Bo.geometry;cp<ed.length;cp+=1){var td=ed[cp];if(td.length>1){var kp=Lo(td,qp,po.vertical||Yc,ja,24,Cp);kp&&_f(td,kp)}}else if(Bo.type==="Polygon")for(var xf=0,Pp=ep(Bo.geometry,0);xf<Pp.length;xf+=1){var fc=Pp[xf],fp=Oi(fc,16);_f(fc[0],new Pn(fp.x,fp.y,0))}else if(Bo.type==="LineString")for(var bf=0,Al=Bo.geometry;bf<Al.length;bf+=1){var Ef=Al[bf];_f(Ef,new Pn(Ef[0].x,Ef[0].y,0))}else if(Bo.type==="Point")for(var Ad=0,dv=Bo.geometry;Ad<dv.length;Ad+=1)for(var Vd=0,Gd=dv[Ad];Vd<Gd.length;Vd+=1){var Cd=Gd[Vd];_f([Cd],new Pn(Cd.x,Cd.y,0))}}(a,Er,jn,nu,g,$,Ln,xi,Wn,Yu,T)},er=0,_r=a.features;er<_r.length;er+=1)Nt();A&&a.generateCollisionDebugBuffers()},_.perspective=function(a,s,c,g,b){var A,T=1/Math.tan(s/2);return a[0]=T/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=T,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,b!=null&&b!==1/0?(a[10]=(b+g)*(A=1/(g-b)),a[14]=2*b*g*A):(a[10]=-1,a[14]=-2*g),a},_.pick=function(a,s){for(var c={},g=0;g<s.length;g++){var b=s[g];b in a&&(c[b]=a[b])}return c},_.plugin=dl,_.polygonIntersectsPolygon=Vu,_.postMapLoadEvent=nt,_.postTurnstileEvent=ir,_.potpack=sn,_.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],_.register=Gn,_.registerForPluginStateChange=function(a){return a({pluginStatus:su,pluginURL:ic}),Bc.on("pluginStateChange",a),a},_.renderColorRamp=Jf,_.rotate=function(a,s,c){var g=s[0],b=s[1],A=s[2],T=s[3],O=Math.sin(c),z=Math.cos(c);return a[0]=g*z+A*O,a[1]=b*z+T*O,a[2]=g*-O+A*z,a[3]=b*-O+T*z,a},_.rotateX=function(a,s,c){var g=Math.sin(c),b=Math.cos(c),A=s[4],T=s[5],O=s[6],z=s[7],$=s[8],Q=s[9],re=s[10],me=s[11];return s!==a&&(a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=s[3],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[4]=A*b+$*g,a[5]=T*b+Q*g,a[6]=O*b+re*g,a[7]=z*b+me*g,a[8]=$*b-A*g,a[9]=Q*b-T*g,a[10]=re*b-O*g,a[11]=me*b-z*g,a},_.rotateZ=function(a,s,c){var g=Math.sin(c),b=Math.cos(c),A=s[0],T=s[1],O=s[2],z=s[3],$=s[4],Q=s[5],re=s[6],me=s[7];return s!==a&&(a[8]=s[8],a[9]=s[9],a[10]=s[10],a[11]=s[11],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[0]=A*b+$*g,a[1]=T*b+Q*g,a[2]=O*b+re*g,a[3]=z*b+me*g,a[4]=$*b-A*g,a[5]=Q*b-T*g,a[6]=re*b-O*g,a[7]=me*b-z*g,a},_.scale=function(a,s,c){var g=c[0],b=c[1],A=c[2];return a[0]=s[0]*g,a[1]=s[1]*g,a[2]=s[2]*g,a[3]=s[3]*g,a[4]=s[4]*b,a[5]=s[5]*b,a[6]=s[6]*b,a[7]=s[7]*b,a[8]=s[8]*A,a[9]=s[9]*A,a[10]=s[10]*A,a[11]=s[11]*A,a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15],a},_.scale$1=function(a,s,c){return a[0]=s[0]*c,a[1]=s[1]*c,a[2]=s[2]*c,a[3]=s[3]*c,a},_.scale$2=function(a,s,c){return a[0]=s[0]*c,a[1]=s[1]*c,a[2]=s[2]*c,a},_.setCacheLimits=function(a,s){Bt=a,Ar=s},_.setRTLTextPlugin=function(a,s,c){if(c===void 0&&(c=!1),su==="deferred"||su==="loading"||su==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");ic=si.resolveURL(a),su="deferred",Nu=s,sf(),c||al()},_.sphericalToCartesian=function(a){var s=a[0],c=a[1],g=a[2];return c+=90,c*=Math.PI/180,g*=Math.PI/180,{x:s*Math.cos(c)*Math.sin(g),y:s*Math.sin(c)*Math.sin(g),z:s*Math.cos(g)}},_.sqrLen=function(a){var s=a[0],c=a[1];return s*s+c*c},_.styleSpec=Te,_.sub=function(a,s,c){return a[0]=s[0]-c[0],a[1]=s[1]-c[1],a[2]=s[2]-c[2],a},_.symbolSize=_a,_.transformMat3=function(a,s,c){var g=s[0],b=s[1],A=s[2];return a[0]=g*c[0]+b*c[3]+A*c[6],a[1]=g*c[1]+b*c[4]+A*c[7],a[2]=g*c[2]+b*c[5]+A*c[8],a},_.transformMat4=Df,_.translate=function(a,s,c){var g,b,A,T,O,z,$,Q,re,me,Ee,$e,qe=c[0],bt=c[1],st=c[2];return s===a?(a[12]=s[0]*qe+s[4]*bt+s[8]*st+s[12],a[13]=s[1]*qe+s[5]*bt+s[9]*st+s[13],a[14]=s[2]*qe+s[6]*bt+s[10]*st+s[14],a[15]=s[3]*qe+s[7]*bt+s[11]*st+s[15]):(b=s[1],A=s[2],T=s[3],O=s[4],z=s[5],$=s[6],Q=s[7],re=s[8],me=s[9],Ee=s[10],$e=s[11],a[0]=g=s[0],a[1]=b,a[2]=A,a[3]=T,a[4]=O,a[5]=z,a[6]=$,a[7]=Q,a[8]=re,a[9]=me,a[10]=Ee,a[11]=$e,a[12]=g*qe+O*bt+re*st+s[12],a[13]=b*qe+z*bt+me*st+s[13],a[14]=A*qe+$*bt+Ee*st+s[14],a[15]=T*qe+Q*bt+$e*st+s[15]),a},_.triggerPluginCompletionEvent=xp,_.uniqueId=qt,_.validateCustomStyleLayer=function(a){var s=[],c=a.id;return c===void 0&&s.push({message:"layers."+c+': missing required property "id"'}),a.render===void 0&&s.push({message:"layers."+c+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&s.push({message:"layers."+c+': property "renderingMode" must be either "2d" or "3d"'}),s},_.validateLight=ou,_.validateStyle=Th,_.values=function(a){var s=[];for(var c in a)s.push(a[c]);return s},_.vectorTile=Dl,_.version="1.13.3",_.warnOnce=Ct,_.webpSupported=ii,_.window=Ae,_.wrap=mr}),Z(["./shared"],function(_){"use strict";function Pe(te){var le=typeof te;if(le==="number"||le==="boolean"||le==="string"||te==null)return JSON.stringify(te);if(Array.isArray(te)){for(var ye="[",Re=0,He=te;Re<He.length;Re+=1)ye+=Pe(He[Re])+",";return ye+"]"}for(var ht=Object.keys(te).sort(),At="{",Te=0;Te<ht.length;Te++)At+=JSON.stringify(ht[Te])+":"+Pe(te[ht[Te]])+",";return At+"}"}function K(te){for(var le="",ye=0,Re=_.refProperties;ye<Re.length;ye+=1)le+="/"+Pe(te[Re[ye]]);return le}var xe=function(te){this.keyCache={},te&&this.replace(te)};xe.prototype.replace=function(te){this._layerConfigs={},this._layers={},this.update(te,[])},xe.prototype.update=function(te,le){for(var ye=this,Re=0,He=te;Re<He.length;Re+=1){var ht=He[Re];this._layerConfigs[ht.id]=ht;var At=this._layers[ht.id]=_.createStyleLayer(ht);At._featureFilter=_.featureFilter(At.filter),this.keyCache[ht.id]&&delete this.keyCache[ht.id]}for(var Te=0,Je=le;Te<Je.length;Te+=1){var Xt=Je[Te];delete this.keyCache[Xt],delete this._layerConfigs[Xt],delete this._layers[Xt]}this.familiesBySource={};for(var Wr=0,cr=function(Cn,se){for(var Yi={},Fn=0;Fn<Cn.length;Fn++){var ta=se&&se[Cn[Fn].id]||K(Cn[Fn]);se&&(se[Cn[Fn].id]=ta);var $a=Yi[ta];$a||($a=Yi[ta]=[]),$a.push(Cn[Fn])}var ra=[];for(var pa in Yi)ra.push(Yi[pa]);return ra}(_.values(this._layerConfigs),this.keyCache);Wr<cr.length;Wr+=1){var dr=cr[Wr].map(function(Cn){return ye._layers[Cn.id]}),jr=dr[0];if(jr.visibility!=="none"){var qn=jr.source||"",Un=this.familiesBySource[qn];Un||(Un=this.familiesBySource[qn]={});var ar=jr.sourceLayer||"_geojsonTileLayer",ot=Un[ar];ot||(ot=Un[ar]=[]),ot.push(dr)}}};var ve=function(te){var le={},ye=[];for(var Re in te){var He=te[Re],ht=le[Re]={};for(var At in He){var Te=He[+At];if(Te&&Te.bitmap.width!==0&&Te.bitmap.height!==0){var Je={x:0,y:0,w:Te.bitmap.width+2,h:Te.bitmap.height+2};ye.push(Je),ht[At]={rect:Je,metrics:Te.metrics}}}}var Xt=_.potpack(ye),Wr=new _.AlphaImage({width:Xt.w||1,height:Xt.h||1});for(var cr in te){var dr=te[cr];for(var jr in dr){var qn=dr[+jr];if(qn&&qn.bitmap.width!==0&&qn.bitmap.height!==0){var Un=le[cr][jr].rect;_.AlphaImage.copy(qn.bitmap,Wr,{x:0,y:0},{x:Un.x+1,y:Un.y+1},qn.bitmap)}}}this.image=Wr,this.positions=le};_.register("GlyphAtlas",ve);var tt=function(te){this.tileID=new _.OverscaledTileID(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.uid=te.uid,this.zoom=te.zoom,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.collectResourceTiming,this.returnDependencies=!!te.returnDependencies,this.promoteId=te.promoteId};function Ae(te,le,ye){for(var Re=new _.EvaluationParameters(le),He=0,ht=te;He<ht.length;He+=1)ht[He].recalculate(Re,ye)}function at(te,le){var ye=_.getArrayBuffer(te.request,function(Re,He,ht,At){Re?le(Re):He&&le(null,{vectorTile:new _.vectorTile.VectorTile(new _.pbf(He)),rawData:He,cacheControl:ht,expires:At})});return function(){ye.cancel(),le()}}tt.prototype.parse=function(te,le,ye,Re,He){var ht=this;this.status="parsing",this.data=te,this.collisionBoxArray=new _.CollisionBoxArray;var At=new _.DictionaryCoder(Object.keys(te.layers).sort()),Te=new _.FeatureIndex(this.tileID,this.promoteId);Te.bucketLayerIDs=[];var Je,Xt,Wr,cr,dr={},jr={featureIndex:Te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ye},qn=le.familiesBySource[this.source];for(var Un in qn){var ar=te.layers[Un];if(ar){ar.version===1&&_.warnOnce('Vector tile source "'+this.source+'" layer "'+Un+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var ot=At.encode(Un),Cn=[],se=0;se<ar.length;se++){var Yi=ar.feature(se),Fn=Te.getId(Yi,Un);Cn.push({feature:Yi,id:Fn,index:se,sourceLayerIndex:ot})}for(var ta=0,$a=qn[Un];ta<$a.length;ta+=1){var ra=$a[ta],pa=ra[0];pa.minzoom&&this.zoom<Math.floor(pa.minzoom)||pa.maxzoom&&this.zoom>=pa.maxzoom||pa.visibility!=="none"&&(Ae(ra,this.zoom,ye),(dr[pa.id]=pa.createBucket({index:Te.bucketLayerIDs.length,layers:ra,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ot,sourceID:this.source})).populate(Cn,jr,this.tileID.canonical),Te.bucketLayerIDs.push(ra.map(function(Za){return Za.id})))}}}var Xi=_.mapObject(jr.glyphDependencies,function(Za){return Object.keys(Za).map(Number)});Object.keys(Xi).length?Re.send("getGlyphs",{uid:this.uid,stacks:Xi},function(Za,fa){Je||(Je=Za,Xt=fa,bo.call(ht))}):Xt={};var Ui=Object.keys(jr.iconDependencies);Ui.length?Re.send("getImages",{icons:Ui,source:this.source,tileID:this.tileID,type:"icons"},function(Za,fa){Je||(Je=Za,Wr=fa,bo.call(ht))}):Wr={};var ma=Object.keys(jr.patternDependencies);function bo(){if(Je)return He(Je);if(Xt&&Wr&&cr){var Za=new ve(Xt),fa=new _.ImageAtlas(Wr,cr);for(var na in dr){var To=dr[na];To instanceof _.SymbolBucket?(Ae(To.layers,this.zoom,ye),_.performSymbolLayout(To,Xt,Za.positions,Wr,fa.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):To.hasPattern&&(To instanceof _.LineBucket||To instanceof _.FillBucket||To instanceof _.FillExtrusionBucket)&&(Ae(To.layers,this.zoom,ye),To.addFeatures(jr,this.tileID.canonical,fa.patternPositions))}this.status="done",He(null,{buckets:_.values(dr).filter(function(Ou){return!Ou.isEmpty()}),featureIndex:Te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Za.image,imageAtlas:fa,glyphMap:this.returnDependencies?Xt:null,iconMap:this.returnDependencies?Wr:null,glyphPositions:this.returnDependencies?Za.positions:null})}}ma.length?Re.send("getImages",{icons:ma,source:this.source,tileID:this.tileID,type:"patterns"},function(Za,fa){Je||(Je=Za,cr=fa,bo.call(ht))}):cr={},bo.call(this)};var gt=function(te,le,ye,Re){this.actor=te,this.layerIndex=le,this.availableImages=ye,this.loadVectorData=Re||at,this.loading={},this.loaded={}};gt.prototype.loadTile=function(te,le){var ye=this,Re=te.uid;this.loading||(this.loading={});var He=!!(te&&te.request&&te.request.collectResourceTiming)&&new _.RequestPerformance(te.request),ht=this.loading[Re]=new tt(te);ht.abort=this.loadVectorData(te,function(At,Te){if(delete ye.loading[Re],At||!Te)return ht.status="done",ye.loaded[Re]=ht,le(At);var Je=Te.rawData,Xt={};Te.expires&&(Xt.expires=Te.expires),Te.cacheControl&&(Xt.cacheControl=Te.cacheControl);var Wr={};if(He){var cr=He.finish();cr&&(Wr.resourceTiming=JSON.parse(JSON.stringify(cr)))}ht.vectorTile=Te.vectorTile,ht.parse(Te.vectorTile,ye.layerIndex,ye.availableImages,ye.actor,function(dr,jr){if(dr||!jr)return le(dr);le(null,_.extend({rawTileData:Je.slice(0)},jr,Xt,Wr))}),ye.loaded=ye.loaded||{},ye.loaded[Re]=ht})},gt.prototype.reloadTile=function(te,le){var ye=this,Re=this.loaded,He=te.uid,ht=this;if(Re&&Re[He]){var At=Re[He];At.showCollisionBoxes=te.showCollisionBoxes;var Te=function(Je,Xt){var Wr=At.reloadCallback;Wr&&(delete At.reloadCallback,At.parse(At.vectorTile,ht.layerIndex,ye.availableImages,ht.actor,Wr)),le(Je,Xt)};At.status==="parsing"?At.reloadCallback=Te:At.status==="done"&&(At.vectorTile?At.parse(At.vectorTile,this.layerIndex,this.availableImages,this.actor,Te):Te())}},gt.prototype.abortTile=function(te,le){var ye=this.loading,Re=te.uid;ye&&ye[Re]&&ye[Re].abort&&(ye[Re].abort(),delete ye[Re]),le()},gt.prototype.removeTile=function(te,le){var ye=this.loaded,Re=te.uid;ye&&ye[Re]&&delete ye[Re],le()};var Mt=_.window.ImageBitmap,Ft=function(){this.loaded={}};function mr(te,le){if(te.length!==0){jt(te[0],le);for(var ye=1;ye<te.length;ye++)jt(te[ye],!le)}}function jt(te,le){for(var ye=0,Re=0,He=0,ht=te.length,At=ht-1;He<ht;At=He++){var Te=(te[He][0]-te[At][0])*(te[At][1]+te[He][1]),Je=ye+Te;Re+=Math.abs(ye)>=Math.abs(Te)?ye-Je+Te:Te-Je+ye,ye=Je}ye+Re>=0!=!!le&&te.reverse()}Ft.prototype.loadTile=function(te,le){var ye=te.uid,Re=te.encoding,He=te.rawImageData,ht=Mt&&He instanceof Mt?this.getImageData(He):He,At=new _.DEMData(ye,ht,Re);this.loaded=this.loaded||{},this.loaded[ye]=At,le(null,At)},Ft.prototype.getImageData=function(te){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);var le=this.offscreenCanvasContext.getImageData(-1,-1,te.width+2,te.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new _.RGBAImage({width:le.width,height:le.height},le.data)},Ft.prototype.removeTile=function(te){var le=this.loaded,ye=te.uid;le&&le[ye]&&delete le[ye]};var hr=_.vectorTile.VectorTileFeature.prototype.toGeoJSON,qt=function(te){this._feature=te,this.extent=_.EXTENT,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))};qt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var te=[],le=0,ye=this._feature.geometry;le<ye.length;le+=1){var Re=ye[le];te.push([new _.Point$1(Re[0],Re[1])])}return te}for(var He=[],ht=0,At=this._feature.geometry;ht<At.length;ht+=1){for(var Te=[],Je=0,Xt=At[ht];Je<Xt.length;Je+=1){var Wr=Xt[Je];Te.push(new _.Point$1(Wr[0],Wr[1]))}He.push(Te)}return He},qt.prototype.toGeoJSON=function(te,le,ye){return hr.call(this,te,le,ye)};var Dt=function(te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=_.EXTENT,this.length=te.length,this._features=te};Dt.prototype.feature=function(te){return new qt(this._features[te])};var Pt=_.vectorTile.VectorTileFeature,Cr=ne;function ne(te,le){this.options=le||{},this.features=te,this.length=te.length}function gr(te,le){this.id=typeof te.id=="number"?te.id:void 0,this.type=te.type,this.rawGeometry=te.type===1?[te.geometry]:te.geometry,this.properties=te.tags,this.extent=le||4096}ne.prototype.feature=function(te){return new gr(this.features[te],this.options.extent)},gr.prototype.loadGeometry=function(){var te=this.rawGeometry;this.geometry=[];for(var le=0;le<te.length;le++){for(var ye=te[le],Re=[],He=0;He<ye.length;He++)Re.push(new _.Point$1(ye[He][0],ye[He][1]));this.geometry.push(Re)}return this.geometry},gr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var te=this.geometry,le=1/0,ye=-1/0,Re=1/0,He=-1/0,ht=0;ht<te.length;ht++)for(var At=te[ht],Te=0;Te<At.length;Te++){var Je=At[Te];le=Math.min(le,Je.x),ye=Math.max(ye,Je.x),Re=Math.min(Re,Je.y),He=Math.max(He,Je.y)}return[le,Re,ye,He]},gr.prototype.toGeoJSON=Pt.prototype.toGeoJSON;var It=Jt,xt=Cr;function Jt(te){var le=new _.pbf;return function(ye,Re){for(var He in ye.layers)Re.writeMessage(3,Ct,ye.layers[He])}(te,le),le.finish()}function Ct(te,le){var ye;le.writeVarintField(15,te.version||1),le.writeStringField(1,te.name||""),le.writeVarintField(5,te.extent||4096);var Re={keys:[],values:[],keycache:{},valuecache:{}};for(ye=0;ye<te.length;ye++)Re.feature=te.feature(ye),le.writeMessage(2,br,Re);var He=Re.keys;for(ye=0;ye<He.length;ye++)le.writeStringField(3,He[ye]);var ht=Re.values;for(ye=0;ye<ht.length;ye++)le.writeMessage(4,U,ht[ye])}function br(te,le){var ye=te.feature;ye.id!==void 0&&le.writeVarintField(1,ye.id),le.writeMessage(2,$r,te),le.writeVarintField(3,ye.type),le.writeMessage(4,H,ye)}function $r(te,le){var ye=te.feature,Re=te.keys,He=te.values,ht=te.keycache,At=te.valuecache;for(var Te in ye.properties){var Je=ht[Te];Je===void 0&&(Re.push(Te),ht[Te]=Je=Re.length-1),le.writeVarint(Je);var Xt=ye.properties[Te],Wr=typeof Xt;Wr!=="string"&&Wr!=="boolean"&&Wr!=="number"&&(Xt=JSON.stringify(Xt));var cr=Wr+":"+Xt,dr=At[cr];dr===void 0&&(He.push(Xt),At[cr]=dr=He.length-1),le.writeVarint(dr)}}function oe(te,le){return(le<<3)+(7&te)}function Ue(te){return te<<1^te>>31}function H(te,le){for(var ye=te.loadGeometry(),Re=te.type,He=0,ht=0,At=ye.length,Te=0;Te<At;Te++){var Je=ye[Te],Xt=1;Re===1&&(Xt=Je.length),le.writeVarint(oe(1,Xt));for(var Wr=Re===3?Je.length-1:Je.length,cr=0;cr<Wr;cr++){cr===1&&Re!==1&&le.writeVarint(oe(2,Wr-1));var dr=Je[cr].x-He,jr=Je[cr].y-ht;le.writeVarint(Ue(dr)),le.writeVarint(Ue(jr)),He+=dr,ht+=jr}Re===3&&le.writeVarint(oe(7,1))}}function U(te,le){var ye=typeof te;ye==="string"?le.writeStringField(1,te):ye==="boolean"?le.writeBooleanField(7,te):ye==="number"&&(te%1!=0?le.writeDoubleField(3,te):te<0?le.writeSVarintField(6,te):le.writeVarintField(5,te))}function de(te,le,ye,Re){Xe(te,ye,Re),Xe(le,2*ye,2*Re),Xe(le,2*ye+1,2*Re+1)}function Xe(te,le,ye){var Re=te[le];te[le]=te[ye],te[ye]=Re}function lt(te,le,ye,Re){var He=te-ye,ht=le-Re;return He*He+ht*ht}It.fromVectorTileJs=Jt,It.fromGeojsonVt=function(te,le){le=le||{};var ye={};for(var Re in te)ye[Re]=new Cr(te[Re].features,le),ye[Re].name=Re,ye[Re].version=le.version,ye[Re].extent=le.extent;return Jt({layers:ye})},It.GeoJSONWrapper=xt;var yt=function(te){return te[0]},Vt=function(te){return te[1]},pr=function(te,le,ye,Re,He){le===void 0&&(le=yt),ye===void 0&&(ye=Vt),Re===void 0&&(Re=64),He===void 0&&(He=Float64Array),this.nodeSize=Re,this.points=te;for(var ht=te.length<65536?Uint16Array:Uint32Array,At=this.ids=new ht(te.length),Te=this.coords=new He(2*te.length),Je=0;Je<te.length;Je++)At[Je]=Je,Te[2*Je]=le(te[Je]),Te[2*Je+1]=ye(te[Je]);(function Xt(Wr,cr,dr,jr,qn,Un){if(!(qn-jr<=dr)){var ar=jr+qn>>1;(function ot(Cn,se,Yi,Fn,ta,$a){for(;ta>Fn;){if(ta-Fn>600){var ra=ta-Fn+1,pa=Yi-Fn+1,Xi=Math.log(ra),Ui=.5*Math.exp(2*Xi/3),ma=.5*Math.sqrt(Xi*Ui*(ra-Ui)/ra)*(pa-ra/2<0?-1:1);ot(Cn,se,Yi,Math.max(Fn,Math.floor(Yi-pa*Ui/ra+ma)),Math.min(ta,Math.floor(Yi+(ra-pa)*Ui/ra+ma)),$a)}var bo=se[2*Yi+$a],Za=Fn,fa=ta;for(de(Cn,se,Fn,Yi),se[2*ta+$a]>bo&&de(Cn,se,Fn,ta);Za<fa;){for(de(Cn,se,Za,fa),Za++,fa--;se[2*Za+$a]<bo;)Za++;for(;se[2*fa+$a]>bo;)fa--}se[2*Fn+$a]===bo?de(Cn,se,Fn,fa):de(Cn,se,++fa,ta),fa<=Yi&&(Fn=fa+1),Yi<=fa&&(ta=fa-1)}})(Wr,cr,ar,jr,qn,Un%2),Xt(Wr,cr,dr,jr,ar-1,Un+1),Xt(Wr,cr,dr,ar+1,qn,Un+1)}})(At,Te,Re,0,At.length-1,0)};pr.prototype.range=function(te,le,ye,Re){return function(He,ht,At,Te,Je,Xt,Wr){for(var cr,dr,jr=[0,He.length-1,0],qn=[];jr.length;){var Un=jr.pop(),ar=jr.pop(),ot=jr.pop();if(ar-ot<=Wr)for(var Cn=ot;Cn<=ar;Cn++)dr=ht[2*Cn+1],(cr=ht[2*Cn])>=At&&cr<=Je&&dr>=Te&&dr<=Xt&&qn.push(He[Cn]);else{var se=Math.floor((ot+ar)/2);dr=ht[2*se+1],(cr=ht[2*se])>=At&&cr<=Je&&dr>=Te&&dr<=Xt&&qn.push(He[se]);var Yi=(Un+1)%2;(Un===0?At<=cr:Te<=dr)&&(jr.push(ot),jr.push(se-1),jr.push(Yi)),(Un===0?Je>=cr:Xt>=dr)&&(jr.push(se+1),jr.push(ar),jr.push(Yi))}}return qn}(this.ids,this.coords,te,le,ye,Re,this.nodeSize)},pr.prototype.within=function(te,le,ye){return function(Re,He,ht,At,Te,Je){for(var Xt=[0,Re.length-1,0],Wr=[],cr=Te*Te;Xt.length;){var dr=Xt.pop(),jr=Xt.pop(),qn=Xt.pop();if(jr-qn<=Je)for(var Un=qn;Un<=jr;Un++)lt(He[2*Un],He[2*Un+1],ht,At)<=cr&&Wr.push(Re[Un]);else{var ar=Math.floor((qn+jr)/2),ot=He[2*ar],Cn=He[2*ar+1];lt(ot,Cn,ht,At)<=cr&&Wr.push(Re[ar]);var se=(dr+1)%2;(dr===0?ht-Te<=ot:At-Te<=Cn)&&(Xt.push(qn),Xt.push(ar-1),Xt.push(se)),(dr===0?ht+Te>=ot:At+Te>=Cn)&&(Xt.push(ar+1),Xt.push(jr),Xt.push(se))}}return Wr}(this.ids,this.coords,te,le,ye,this.nodeSize)};var tn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(te){return te}},Kr=function(te){this.options=ua(Object.create(tn),te),this.trees=new Array(this.options.maxZoom+1)};function si(te,le,ye,Re,He){return{x:te,y:le,zoom:1/0,id:ye,parentId:-1,numPoints:Re,properties:He}}function xn(te,le){var ye=te.geometry.coordinates,Re=ye[1];return{x:Di(ye[0]),y:Pi(Re),zoom:1/0,index:le,parentId:-1}}function ii(te){return{type:"Feature",id:te.id,properties:Ra(te),geometry:{type:"Point",coordinates:[(Re=te.x,360*(Re-.5)),(le=te.y,ye=(180-360*le)*Math.PI/180,360*Math.atan(Math.exp(ye))/Math.PI-90)]}};var le,ye,Re}function Ra(te){var le=te.numPoints,ye=le>=1e4?Math.round(le/1e3)+"k":le>=1e3?Math.round(le/100)/10+"k":le;return ua(ua({},te.properties),{cluster:!0,cluster_id:te.id,point_count:le,point_count_abbreviated:ye})}function Di(te){return te/360+.5}function Pi(te){var le=Math.sin(te*Math.PI/180),ye=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return ye<0?0:ye>1?1:ye}function ua(te,le){for(var ye in le)te[ye]=le[ye];return te}function sa(te){return te.x}function Bi(te){return te.y}function Yn(te,le,ye,Re,He,ht){var At=He-ye,Te=ht-Re;if(At!==0||Te!==0){var Je=((te-ye)*At+(le-Re)*Te)/(At*At+Te*Te);Je>1?(ye=He,Re=ht):Je>0&&(ye+=At*Je,Re+=Te*Je)}return(At=te-ye)*At+(Te=le-Re)*Te}function bi(te,le,ye,Re){var He={id:te===void 0?null:te,type:le,geometry:ye,tags:Re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ht){var At=ht.geometry,Te=ht.type;if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")Ms(ht,At);else if(Te==="Polygon"||Te==="MultiLineString")for(var Je=0;Je<At.length;Je++)Ms(ht,At[Je]);else if(Te==="MultiPolygon")for(Je=0;Je<At.length;Je++)for(var Xt=0;Xt<At[Je].length;Xt++)Ms(ht,At[Je][Xt])}(He),He}function Ms(te,le){for(var ye=0;ye<le.length;ye+=3)te.minX=Math.min(te.minX,le[ye]),te.minY=Math.min(te.minY,le[ye+1]),te.maxX=Math.max(te.maxX,le[ye]),te.maxY=Math.max(te.maxY,le[ye+1])}function Ha(te,le,ye,Re){if(le.geometry){var He=le.geometry.coordinates,ht=le.geometry.type,At=Math.pow(ye.tolerance/((1<<ye.maxZoom)*ye.extent),2),Te=[],Je=le.id;if(ye.promoteId?Je=le.properties[ye.promoteId]:ye.generateId&&(Je=Re||0),ht==="Point")eo(He,Te);else if(ht==="MultiPoint")for(var Xt=0;Xt<He.length;Xt++)eo(He[Xt],Te);else if(ht==="LineString")Rt(He,Te,At,!1);else if(ht==="MultiLineString"){if(ye.lineMetrics){for(Xt=0;Xt<He.length;Xt++)Rt(He[Xt],Te=[],At,!1),te.push(bi(Je,"LineString",Te,le.properties));return}be(He,Te,At,!1)}else if(ht==="Polygon")be(He,Te,At,!0);else{if(ht!=="MultiPolygon"){if(ht==="GeometryCollection"){for(Xt=0;Xt<le.geometry.geometries.length;Xt++)Ha(te,{id:Je,geometry:le.geometry.geometries[Xt],properties:le.properties},ye,Re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Xt=0;Xt<He.length;Xt++){var Wr=[];be(He[Xt],Wr,At,!0),Te.push(Wr)}}te.push(bi(Je,ht,Te,le.properties))}}function eo(te,le){le.push(ce(te[0])),le.push(Me(te[1])),le.push(0)}function Rt(te,le,ye,Re){for(var He,ht,At=0,Te=0;Te<te.length;Te++){var Je=ce(te[Te][0]),Xt=Me(te[Te][1]);le.push(Je),le.push(Xt),le.push(0),Te>0&&(At+=Re?(He*Xt-Je*ht)/2:Math.sqrt(Math.pow(Je-He,2)+Math.pow(Xt-ht,2))),He=Je,ht=Xt}var Wr=le.length-3;le[2]=1,function cr(dr,jr,qn,Un){for(var ar,ot=Un,Cn=qn-jr>>1,se=qn-jr,Yi=dr[jr],Fn=dr[jr+1],ta=dr[qn],$a=dr[qn+1],ra=jr+3;ra<qn;ra+=3){var pa=Yn(dr[ra],dr[ra+1],Yi,Fn,ta,$a);if(pa>ot)ar=ra,ot=pa;else if(pa===ot){var Xi=Math.abs(ra-Cn);Xi<se&&(ar=ra,se=Xi)}}ot>Un&&(ar-jr>3&&cr(dr,jr,ar,Un),dr[ar+2]=ot,qn-ar>3&&cr(dr,ar,qn,Un))}(le,0,Wr,ye),le[Wr+2]=1,le.size=Math.abs(At),le.start=0,le.end=le.size}function be(te,le,ye,Re){for(var He=0;He<te.length;He++){var ht=[];Rt(te[He],ht,ye,Re),le.push(ht)}}function ce(te){return te/360+.5}function Me(te){var le=Math.sin(te*Math.PI/180),ye=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return ye<0?0:ye>1?1:ye}function j(te,le,ye,Re,He,ht,At,Te){if(Re/=le,ht>=(ye/=le)&&At<Re)return te;if(At<ye||ht>=Re)return null;for(var Je=[],Xt=0;Xt<te.length;Xt++){var Wr=te[Xt],cr=Wr.geometry,dr=Wr.type,jr=He===0?Wr.minX:Wr.minY,qn=He===0?Wr.maxX:Wr.maxY;if(jr>=ye&&qn<Re)Je.push(Wr);else if(!(qn<ye||jr>=Re)){var Un=[];if(dr==="Point"||dr==="MultiPoint")ut(cr,Un,ye,Re,He);else if(dr==="LineString")ir(cr,Un,ye,Re,He,!1,Te.lineMetrics);else if(dr==="MultiLineString")nt(cr,Un,ye,Re,He,!1);else if(dr==="Polygon")nt(cr,Un,ye,Re,He,!0);else if(dr==="MultiPolygon")for(var ar=0;ar<cr.length;ar++){var ot=[];nt(cr[ar],ot,ye,Re,He,!0),ot.length&&Un.push(ot)}if(Un.length){if(Te.lineMetrics&&dr==="LineString"){for(ar=0;ar<Un.length;ar++)Je.push(bi(Wr.id,dr,Un[ar],Wr.tags));continue}dr!=="LineString"&&dr!=="MultiLineString"||(Un.length===1?(dr="LineString",Un=Un[0]):dr="MultiLineString"),dr!=="Point"&&dr!=="MultiPoint"||(dr=Un.length===3?"Point":"MultiPoint"),Je.push(bi(Wr.id,dr,Un,Wr.tags))}}}return Je.length?Je:null}function ut(te,le,ye,Re,He){for(var ht=0;ht<te.length;ht+=3){var At=te[ht+He];At>=ye&&At<=Re&&(le.push(te[ht]),le.push(te[ht+1]),le.push(te[ht+2]))}}function ir(te,le,ye,Re,He,ht,At){for(var Te,Je,Xt=Jr(te),Wr=He===0?Ar:zr,cr=te.start,dr=0;dr<te.length-3;dr+=3){var jr=te[dr],qn=te[dr+1],Un=te[dr+2],ar=te[dr+3],ot=te[dr+4],Cn=He===0?jr:qn,se=He===0?ar:ot,Yi=!1;At&&(Te=Math.sqrt(Math.pow(jr-ar,2)+Math.pow(qn-ot,2))),Cn<ye?se>ye&&(Je=Wr(Xt,jr,qn,ar,ot,ye),At&&(Xt.start=cr+Te*Je)):Cn>Re?se<Re&&(Je=Wr(Xt,jr,qn,ar,ot,Re),At&&(Xt.start=cr+Te*Je)):Bt(Xt,jr,qn,Un),se<ye&&Cn>=ye&&(Je=Wr(Xt,jr,qn,ar,ot,ye),Yi=!0),se>Re&&Cn<=Re&&(Je=Wr(Xt,jr,qn,ar,ot,Re),Yi=!0),!ht&&Yi&&(At&&(Xt.end=cr+Te*Je),le.push(Xt),Xt=Jr(te)),At&&(cr+=Te)}var Fn=te.length-3;jr=te[Fn],qn=te[Fn+1],Un=te[Fn+2],(Cn=He===0?jr:qn)>=ye&&Cn<=Re&&Bt(Xt,jr,qn,Un),Fn=Xt.length-3,ht&&Fn>=3&&(Xt[Fn]!==Xt[0]||Xt[Fn+1]!==Xt[1])&&Bt(Xt,Xt[0],Xt[1],Xt[2]),Xt.length&&le.push(Xt)}function Jr(te){var le=[];return le.size=te.size,le.start=te.start,le.end=te.end,le}function nt(te,le,ye,Re,He,ht){for(var At=0;At<te.length;At++)ir(te[At],le,ye,Re,He,ht,!1)}function Bt(te,le,ye,Re){te.push(le),te.push(ye),te.push(Re)}function Ar(te,le,ye,Re,He,ht){var At=(ht-le)/(Re-le);return te.push(ht),te.push(ye+(He-ye)*At),te.push(1),At}function zr(te,le,ye,Re,He,ht){var At=(ht-ye)/(He-ye);return te.push(le+(Re-le)*At),te.push(ht),te.push(1),At}function un(te,le){for(var ye=[],Re=0;Re<te.length;Re++){var He,ht=te[Re],At=ht.type;if(At==="Point"||At==="MultiPoint"||At==="LineString")He=vn(ht.geometry,le);else if(At==="MultiLineString"||At==="Polygon"){He=[];for(var Te=0;Te<ht.geometry.length;Te++)He.push(vn(ht.geometry[Te],le))}else if(At==="MultiPolygon")for(He=[],Te=0;Te<ht.geometry.length;Te++){for(var Je=[],Xt=0;Xt<ht.geometry[Te].length;Xt++)Je.push(vn(ht.geometry[Te][Xt],le));He.push(Je)}ye.push(bi(ht.id,At,He,ht.tags))}return ye}function vn(te,le){var ye=[];ye.size=te.size,te.start!==void 0&&(ye.start=te.start,ye.end=te.end);for(var Re=0;Re<te.length;Re+=3)ye.push(te[Re]+le,te[Re+1],te[Re+2]);return ye}function ui(te,le){if(te.transformed)return te;var ye,Re,He,ht=1<<te.z,At=te.x,Te=te.y;for(ye=0;ye<te.features.length;ye++){var Je=te.features[ye],Xt=Je.geometry,Wr=Je.type;if(Je.geometry=[],Wr===1)for(Re=0;Re<Xt.length;Re+=2)Je.geometry.push(Jn(Xt[Re],Xt[Re+1],le,ht,At,Te));else for(Re=0;Re<Xt.length;Re++){var cr=[];for(He=0;He<Xt[Re].length;He+=2)cr.push(Jn(Xt[Re][He],Xt[Re][He+1],le,ht,At,Te));Je.geometry.push(cr)}}return te.transformed=!0,te}function Jn(te,le,ye,Re,He,ht){return[Math.round(ye*(te*Re-He)),Math.round(ye*(le*Re-ht))]}function mn(te,le,ye,Re,He){for(var ht=le===He.maxZoom?0:He.tolerance/((1<<le)*He.extent),At={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ye,y:Re,z:le,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Te=0;Te<te.length;Te++){At.numFeatures++,Ri(At,te[Te],ht,He);var Je=te[Te].minX,Xt=te[Te].minY,Wr=te[Te].maxX,cr=te[Te].maxY;Je<At.minX&&(At.minX=Je),Xt<At.minY&&(At.minY=Xt),Wr>At.maxX&&(At.maxX=Wr),cr>At.maxY&&(At.maxY=cr)}return At}function Ri(te,le,ye,Re){var He=le.geometry,ht=le.type,At=[];if(ht==="Point"||ht==="MultiPoint")for(var Te=0;Te<He.length;Te+=3)At.push(He[Te]),At.push(He[Te+1]),te.numPoints++,te.numSimplified++;else if(ht==="LineString")Si(At,He,te,ye,!1,!1);else if(ht==="MultiLineString"||ht==="Polygon")for(Te=0;Te<He.length;Te++)Si(At,He[Te],te,ye,ht==="Polygon",Te===0);else if(ht==="MultiPolygon")for(var Je=0;Je<He.length;Je++){var Xt=He[Je];for(Te=0;Te<Xt.length;Te++)Si(At,Xt[Te],te,ye,!0,Te===0)}if(At.length){var Wr=le.tags||null;if(ht==="LineString"&&Re.lineMetrics){for(var cr in Wr={},le.tags)Wr[cr]=le.tags[cr];Wr.mapbox_clip_start=He.start/He.size,Wr.mapbox_clip_end=He.end/He.size}var dr={geometry:At,type:ht==="Polygon"||ht==="MultiPolygon"?3:ht==="LineString"||ht==="MultiLineString"?2:1,tags:Wr};le.id!==null&&(dr.id=le.id),te.features.push(dr)}}function Si(te,le,ye,Re,He,ht){var At=Re*Re;if(Re>0&&le.size<(He?At:Re))ye.numPoints+=le.length/3;else{for(var Te=[],Je=0;Je<le.length;Je+=3)(Re===0||le[Je+2]>At)&&(ye.numSimplified++,Te.push(le[Je]),Te.push(le[Je+1])),ye.numPoints++;He&&function(Xt,Wr){for(var cr=0,dr=0,jr=Xt.length,qn=jr-2;dr<jr;qn=dr,dr+=2)cr+=(Xt[dr]-Xt[qn])*(Xt[dr+1]+Xt[qn+1]);if(cr>0===Wr)for(dr=0,jr=Xt.length;dr<jr/2;dr+=2){var Un=Xt[dr],ar=Xt[dr+1];Xt[dr]=Xt[jr-2-dr],Xt[dr+1]=Xt[jr-1-dr],Xt[jr-2-dr]=Un,Xt[jr-1-dr]=ar}}(Te,ht),te.push(Te)}}function Wa(te,le){var ye=(le=this.options=function(He,ht){for(var At in ht)He[At]=ht[At];return He}(Object.create(this.options),le)).debug;if(ye&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");var Re=function(He,ht){var At=[];if(He.type==="FeatureCollection")for(var Te=0;Te<He.features.length;Te++)Ha(At,He.features[Te],ht,Te);else Ha(At,He.type==="Feature"?He:{geometry:He},ht);return At}(te,le);this.tiles={},this.tileCoords=[],ye&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Re=function(He,ht){var At=ht.buffer/ht.extent,Te=He,Je=j(He,1,-1-At,At,0,-1,2,ht),Xt=j(He,1,1-At,2+At,0,-1,2,ht);return(Je||Xt)&&(Te=j(He,1,-At,1+At,0,-1,2,ht)||[],Je&&(Te=un(Je,1).concat(Te)),Xt&&(Te=Te.concat(un(Xt,-1)))),Te}(Re,le)).length&&this.splitTile(Re,0,0,0),ye&&(Re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function uo(te,le,ye){return 32*((1<<te)*ye+le)+te}function Io(te,le){var ye=te.tileID.canonical;if(!this._geoJSONIndex)return le(null,null);var Re=this._geoJSONIndex.getTile(ye.z,ye.x,ye.y);if(!Re)return le(null,null);var He=new Dt(Re.features),ht=It(He);ht.byteOffset===0&&ht.byteLength===ht.buffer.byteLength||(ht=new Uint8Array(ht)),le(null,{vectorTile:He,rawData:ht.buffer})}Kr.prototype.load=function(te){var le=this.options,ye=le.log,Re=le.minZoom,He=le.maxZoom,ht=le.nodeSize;ye&&console.time("total time");var At="prepare "+te.length+" points";ye&&console.time(At),this.points=te;for(var Te=[],Je=0;Je<te.length;Je++)te[Je].geometry&&Te.push(xn(te[Je],Je));this.trees[He+1]=new pr(Te,sa,Bi,ht,Float32Array),ye&&console.timeEnd(At);for(var Xt=He;Xt>=Re;Xt--){var Wr=+Date.now();Te=this._cluster(Te,Xt),this.trees[Xt]=new pr(Te,sa,Bi,ht,Float32Array),ye&&console.log("z%d: %d clusters in %dms",Xt,Te.length,+Date.now()-Wr)}return ye&&console.timeEnd("total time"),this},Kr.prototype.getClusters=function(te,le){var ye=((te[0]+180)%360+360)%360-180,Re=Math.max(-90,Math.min(90,te[1])),He=te[2]===180?180:((te[2]+180)%360+360)%360-180,ht=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)ye=-180,He=180;else if(ye>He){var At=this.getClusters([ye,Re,180,ht],le),Te=this.getClusters([-180,Re,He,ht],le);return At.concat(Te)}for(var Je=this.trees[this._limitZoom(le)],Xt=[],Wr=0,cr=Je.range(Di(ye),Pi(ht),Di(He),Pi(Re));Wr<cr.length;Wr+=1){var dr=Je.points[cr[Wr]];Xt.push(dr.numPoints?ii(dr):this.points[dr.index])}return Xt},Kr.prototype.getChildren=function(te){var le=this._getOriginId(te),ye=this._getOriginZoom(te),Re="No cluster with the specified id.",He=this.trees[ye];if(!He)throw new Error(Re);var ht=He.points[le];if(!ht)throw new Error(Re);for(var At=this.options.radius/(this.options.extent*Math.pow(2,ye-1)),Te=[],Je=0,Xt=He.within(ht.x,ht.y,At);Je<Xt.length;Je+=1){var Wr=He.points[Xt[Je]];Wr.parentId===te&&Te.push(Wr.numPoints?ii(Wr):this.points[Wr.index])}if(Te.length===0)throw new Error(Re);return Te},Kr.prototype.getLeaves=function(te,le,ye){var Re=[];return this._appendLeaves(Re,te,le=le||10,ye=ye||0,0),Re},Kr.prototype.getTile=function(te,le,ye){var Re=this.trees[this._limitZoom(te)],He=Math.pow(2,te),ht=this.options,At=ht.radius/ht.extent,Te=(ye-At)/He,Je=(ye+1+At)/He,Xt={features:[]};return this._addTileFeatures(Re.range((le-At)/He,Te,(le+1+At)/He,Je),Re.points,le,ye,He,Xt),le===0&&this._addTileFeatures(Re.range(1-At/He,Te,1,Je),Re.points,He,ye,He,Xt),le===He-1&&this._addTileFeatures(Re.range(0,Te,At/He,Je),Re.points,-1,ye,He,Xt),Xt.features.length?Xt:null},Kr.prototype.getClusterExpansionZoom=function(te){for(var le=this._getOriginZoom(te)-1;le<=this.options.maxZoom;){var ye=this.getChildren(te);if(le++,ye.length!==1)break;te=ye[0].properties.cluster_id}return le},Kr.prototype._appendLeaves=function(te,le,ye,Re,He){for(var ht=0,At=this.getChildren(le);ht<At.length;ht+=1){var Te=At[ht],Je=Te.properties;if(Je&&Je.cluster?He+Je.point_count<=Re?He+=Je.point_count:He=this._appendLeaves(te,Je.cluster_id,ye,Re,He):He<Re?He++:te.push(Te),te.length===ye)break}return He},Kr.prototype._addTileFeatures=function(te,le,ye,Re,He,ht){for(var At=0,Te=te;At<Te.length;At+=1){var Je=le[Te[At]],Xt=Je.numPoints,Wr={type:1,geometry:[[Math.round(this.options.extent*(Je.x*He-ye)),Math.round(this.options.extent*(Je.y*He-Re))]],tags:Xt?Ra(Je):this.points[Je.index].properties},cr=void 0;Xt?cr=Je.id:this.options.generateId?cr=Je.index:this.points[Je.index].id&&(cr=this.points[Je.index].id),cr!==void 0&&(Wr.id=cr),ht.features.push(Wr)}},Kr.prototype._limitZoom=function(te){return Math.max(this.options.minZoom,Math.min(+te,this.options.maxZoom+1))},Kr.prototype._cluster=function(te,le){for(var ye=[],Re=this.options,He=Re.reduce,ht=Re.minPoints,At=Re.radius/(Re.extent*Math.pow(2,le)),Te=0;Te<te.length;Te++){var Je=te[Te];if(!(Je.zoom<=le)){Je.zoom=le;for(var Xt=this.trees[le+1],Wr=Xt.within(Je.x,Je.y,At),cr=Je.numPoints||1,dr=cr,jr=0,qn=Wr;jr<qn.length;jr+=1){var Un=Xt.points[qn[jr]];Un.zoom>le&&(dr+=Un.numPoints||1)}if(dr>=ht){for(var ar=Je.x*cr,ot=Je.y*cr,Cn=He&&cr>1?this._map(Je,!0):null,se=(Te<<5)+(le+1)+this.points.length,Yi=0,Fn=Wr;Yi<Fn.length;Yi+=1){var ta=Xt.points[Fn[Yi]];if(!(ta.zoom<=le)){ta.zoom=le;var $a=ta.numPoints||1;ar+=ta.x*$a,ot+=ta.y*$a,ta.parentId=se,He&&(Cn||(Cn=this._map(Je,!0)),He(Cn,this._map(ta)))}}Je.parentId=se,ye.push(si(ar/dr,ot/dr,se,dr,Cn))}else if(ye.push(Je),dr>1)for(var ra=0,pa=Wr;ra<pa.length;ra+=1){var Xi=Xt.points[pa[ra]];Xi.zoom<=le||(Xi.zoom=le,ye.push(Xi))}}}return ye},Kr.prototype._getOriginId=function(te){return te-this.points.length>>5},Kr.prototype._getOriginZoom=function(te){return(te-this.points.length)%32},Kr.prototype._map=function(te,le){if(te.numPoints)return le?ua({},te.properties):te.properties;var ye=this.points[te.index].properties,Re=this.options.map(ye);return le&&Re===ye?ua({},Re):Re},Wa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Wa.prototype.splitTile=function(te,le,ye,Re,He,ht,At){for(var Te=[te,le,ye,Re],Je=this.options,Xt=Je.debug;Te.length;){Re=Te.pop(),ye=Te.pop(),le=Te.pop(),te=Te.pop();var Wr=1<<le,cr=uo(le,ye,Re),dr=this.tiles[cr];if(!dr&&(Xt>1&&console.time("creation"),dr=this.tiles[cr]=mn(te,le,ye,Re,Je),this.tileCoords.push({z:le,x:ye,y:Re}),Xt)){Xt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,ye,Re,dr.numFeatures,dr.numPoints,dr.numSimplified),console.timeEnd("creation"));var jr="z"+le;this.stats[jr]=(this.stats[jr]||0)+1,this.total++}if(dr.source=te,He){if(le===Je.maxZoom||le===He)continue;var qn=1<<He-le;if(ye!==Math.floor(ht/qn)||Re!==Math.floor(At/qn))continue}else if(le===Je.indexMaxZoom||dr.numPoints<=Je.indexMaxPoints)continue;if(dr.source=null,te.length!==0){Xt>1&&console.time("clipping");var Un,ar,ot,Cn,se,Yi,Fn=.5*Je.buffer/Je.extent,ta=.5-Fn,$a=.5+Fn,ra=1+Fn;Un=ar=ot=Cn=null,se=j(te,Wr,ye-Fn,ye+$a,0,dr.minX,dr.maxX,Je),Yi=j(te,Wr,ye+ta,ye+ra,0,dr.minX,dr.maxX,Je),te=null,se&&(Un=j(se,Wr,Re-Fn,Re+$a,1,dr.minY,dr.maxY,Je),ar=j(se,Wr,Re+ta,Re+ra,1,dr.minY,dr.maxY,Je),se=null),Yi&&(ot=j(Yi,Wr,Re-Fn,Re+$a,1,dr.minY,dr.maxY,Je),Cn=j(Yi,Wr,Re+ta,Re+ra,1,dr.minY,dr.maxY,Je),Yi=null),Xt>1&&console.timeEnd("clipping"),Te.push(Un||[],le+1,2*ye,2*Re),Te.push(ar||[],le+1,2*ye,2*Re+1),Te.push(ot||[],le+1,2*ye+1,2*Re),Te.push(Cn||[],le+1,2*ye+1,2*Re+1)}}},Wa.prototype.getTile=function(te,le,ye){var Re=this.options,He=Re.extent,ht=Re.debug;if(te<0||te>24)return null;var At=1<<te,Te=uo(te,le=(le%At+At)%At,ye);if(this.tiles[Te])return ui(this.tiles[Te],He);ht>1&&console.log("drilling down to z%d-%d-%d",te,le,ye);for(var Je,Xt=te,Wr=le,cr=ye;!Je&&Xt>0;)Xt--,Wr=Math.floor(Wr/2),cr=Math.floor(cr/2),Je=this.tiles[uo(Xt,Wr,cr)];return Je&&Je.source?(ht>1&&console.log("found parent tile z%d-%d-%d",Xt,Wr,cr),ht>1&&console.time("drilling down"),this.splitTile(Je.source,Xt,Wr,cr,te,le,ye),ht>1&&console.timeEnd("drilling down"),this.tiles[Te]?ui(this.tiles[Te],He):null):null};var to=function(te){function le(ye,Re,He,ht){te.call(this,ye,Re,He,Io),ht&&(this.loadGeoJSON=ht)}return te&&(le.__proto__=te),(le.prototype=Object.create(te&&te.prototype)).constructor=le,le.prototype.loadData=function(ye,Re){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=Re,this._pendingLoadDataParams=ye,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},le.prototype._loadData=function(){var ye=this;if(this._pendingCallback&&this._pendingLoadDataParams){var Re=this._pendingCallback,He=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var ht=!!(He&&He.request&&He.request.collectResourceTiming)&&new _.RequestPerformance(He.request);this.loadGeoJSON(He,function(At,Te){if(At||!Te)return Re(At);if(typeof Te!="object")return Re(new Error("Input data given to '"+He.source+"' is not a valid GeoJSON object."));(function dr(jr,qn){var Un,ar=jr&&jr.type;if(ar==="FeatureCollection")for(Un=0;Un<jr.features.length;Un++)dr(jr.features[Un],qn);else if(ar==="GeometryCollection")for(Un=0;Un<jr.geometries.length;Un++)dr(jr.geometries[Un],qn);else if(ar==="Feature")dr(jr.geometry,qn);else if(ar==="Polygon")mr(jr.coordinates,qn);else if(ar==="MultiPolygon")for(Un=0;Un<jr.coordinates.length;Un++)mr(jr.coordinates[Un],qn);return jr})(Te,!0);try{if(He.filter){var Je=_.createExpression(He.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Je.result==="error")throw new Error(Je.value.map(function(dr){return dr.key+": "+dr.message}).join(", "));var Xt=Te.features.filter(function(dr){return Je.value.evaluate({zoom:0},dr)});Te={type:"FeatureCollection",features:Xt}}ye._geoJSONIndex=He.cluster?new Kr(function(dr){var jr=dr.superclusterOptions,qn=dr.clusterProperties;if(!qn||!jr)return jr;for(var Un={},ar={},ot={accumulated:null,zoom:0},Cn={properties:null},se=Object.keys(qn),Yi=0,Fn=se;Yi<Fn.length;Yi+=1){var ta=Fn[Yi],$a=qn[ta],ra=$a[0],pa=_.createExpression($a[1]),Xi=_.createExpression(typeof ra=="string"?[ra,["accumulated"],["get",ta]]:ra);Un[ta]=pa.value,ar[ta]=Xi.value}return jr.map=function(Ui){Cn.properties=Ui;for(var ma={},bo=0,Za=se;bo<Za.length;bo+=1){var fa=Za[bo];ma[fa]=Un[fa].evaluate(ot,Cn)}return ma},jr.reduce=function(Ui,ma){Cn.properties=ma;for(var bo=0,Za=se;bo<Za.length;bo+=1){var fa=Za[bo];ot.accumulated=Ui[fa],Ui[fa]=ar[fa].evaluate(ot,Cn)}},jr}(He)).load(Te.features):function(dr,jr){return new Wa(dr,jr)}(Te,He.geojsonVtOptions)}catch(dr){return Re(dr)}ye.loaded={};var Wr={};if(ht){var cr=ht.finish();cr&&(Wr.resourceTiming={},Wr.resourceTiming[He.source]=JSON.parse(JSON.stringify(cr)))}Re(null,Wr)})}},le.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},le.prototype.reloadTile=function(ye,Re){var He=this.loaded;return He&&He[ye.uid]?te.prototype.reloadTile.call(this,ye,Re):this.loadTile(ye,Re)},le.prototype.loadGeoJSON=function(ye,Re){if(ye.request)_.getJSON(ye.request,Re);else{if(typeof ye.data!="string")return Re(new Error("Input data given to '"+ye.source+"' is not a valid GeoJSON object."));try{return Re(null,JSON.parse(ye.data))}catch(He){return Re(new Error("Input data given to '"+ye.source+"' is not a valid GeoJSON object."))}}},le.prototype.removeSource=function(ye,Re){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Re()},le.prototype.getClusterExpansionZoom=function(ye,Re){try{Re(null,this._geoJSONIndex.getClusterExpansionZoom(ye.clusterId))}catch(He){Re(He)}},le.prototype.getClusterChildren=function(ye,Re){try{Re(null,this._geoJSONIndex.getChildren(ye.clusterId))}catch(He){Re(He)}},le.prototype.getClusterLeaves=function(ye,Re){try{Re(null,this._geoJSONIndex.getLeaves(ye.clusterId,ye.limit,ye.offset))}catch(He){Re(He)}},le}(gt),La=function(te){var le=this;this.self=te,this.actor=new _.Actor(te,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:gt,geojson:to},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ye,Re){if(le.workerSourceTypes[ye])throw new Error('Worker source with name "'+ye+'" already registered.');le.workerSourceTypes[ye]=Re},this.self.registerRTLTextPlugin=function(ye){if(_.plugin.isParsed())throw new Error("RTL text plugin already registered.");_.plugin.applyArabicShaping=ye.applyArabicShaping,_.plugin.processBidirectionalText=ye.processBidirectionalText,_.plugin.processStyledBidirectionalText=ye.processStyledBidirectionalText}};return La.prototype.setReferrer=function(te,le){this.referrer=le},La.prototype.setImages=function(te,le,ye){for(var Re in this.availableImages[te]=le,this.workerSources[te]){var He=this.workerSources[te][Re];for(var ht in He)He[ht].availableImages=le}ye()},La.prototype.setLayers=function(te,le,ye){this.getLayerIndex(te).replace(le),ye()},La.prototype.updateLayers=function(te,le,ye){this.getLayerIndex(te).update(le.layers,le.removedIds),ye()},La.prototype.loadTile=function(te,le,ye){this.getWorkerSource(te,le.type,le.source).loadTile(le,ye)},La.prototype.loadDEMTile=function(te,le,ye){this.getDEMWorkerSource(te,le.source).loadTile(le,ye)},La.prototype.reloadTile=function(te,le,ye){this.getWorkerSource(te,le.type,le.source).reloadTile(le,ye)},La.prototype.abortTile=function(te,le,ye){this.getWorkerSource(te,le.type,le.source).abortTile(le,ye)},La.prototype.removeTile=function(te,le,ye){this.getWorkerSource(te,le.type,le.source).removeTile(le,ye)},La.prototype.removeDEMTile=function(te,le){this.getDEMWorkerSource(te,le.source).removeTile(le)},La.prototype.removeSource=function(te,le,ye){if(this.workerSources[te]&&this.workerSources[te][le.type]&&this.workerSources[te][le.type][le.source]){var Re=this.workerSources[te][le.type][le.source];delete this.workerSources[te][le.type][le.source],Re.removeSource!==void 0?Re.removeSource(le,ye):ye()}},La.prototype.loadWorkerSource=function(te,le,ye){try{this.self.importScripts(le.url),ye()}catch(Re){ye(Re.toString())}},La.prototype.syncRTLPluginState=function(te,le,ye){try{_.plugin.setState(le);var Re=_.plugin.getPluginURL();if(_.plugin.isLoaded()&&!_.plugin.isParsed()&&Re!=null){this.self.importScripts(Re);var He=_.plugin.isParsed();ye(He?void 0:new Error("RTL Text Plugin failed to import scripts from "+Re),He)}}catch(ht){ye(ht.toString())}},La.prototype.getAvailableImages=function(te){var le=this.availableImages[te];return le||(le=[]),le},La.prototype.getLayerIndex=function(te){var le=this.layerIndexes[te];return le||(le=this.layerIndexes[te]=new xe),le},La.prototype.getWorkerSource=function(te,le,ye){var Re=this;return this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][le]||(this.workerSources[te][le]={}),this.workerSources[te][le][ye]||(this.workerSources[te][le][ye]=new this.workerSourceTypes[le]({send:function(He,ht,At){Re.actor.send(He,ht,At,te)}},this.getLayerIndex(te),this.getAvailableImages(te))),this.workerSources[te][le][ye]},La.prototype.getDEMWorkerSource=function(te,le){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][le]||(this.demWorkerSources[te][le]=new Ft),this.demWorkerSources[te][le]},La.prototype.enforceCacheSizeLimit=function(te,le){_.enforceCacheSizeLimit(le)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new La(self)),La}),Z(["./shared"],function(_){"use strict";var Pe=_.createCommonjsModule(function(f){function d(C){return!h(C)}function h(C){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var L,B,Y=new Blob([""],{type:"text/javascript"}),ae=URL.createObjectURL(Y);try{B=new Worker(ae),L=!0}catch(Ce){L=!1}return B&&B.terminate(),URL.revokeObjectURL(ae),L}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var L=document.createElement("canvas");L.width=L.height=1;var B=L.getContext("2d");if(!B)return!1;var Y=B.getImageData(0,0,1,1);return Y&&Y.width===L.width}()?(y[I=C&&C.failIfMajorPerformanceCaveat]===void 0&&(y[I]=function(L){var B=function(ae){var Ce=document.createElement("canvas"),we=Object.create(d.webGLContextAttributes);return we.failIfMajorPerformanceCaveat=ae,Ce.probablySupportsContext?Ce.probablySupportsContext("webgl",we)||Ce.probablySupportsContext("experimental-webgl",we):Ce.supportsContext?Ce.supportsContext("webgl",we)||Ce.supportsContext("experimental-webgl",we):Ce.getContext("webgl",we)||Ce.getContext("experimental-webgl",we)}(L);if(!B)return!1;var Y=B.createShader(B.VERTEX_SHADER);return!(!Y||B.isContextLost())&&(B.shaderSource(Y,"void main() {}"),B.compileShader(Y),B.getShaderParameter(Y,B.COMPILE_STATUS)===!0)}(I)),y[I]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var I}f.exports?f.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d,window.mapboxgl.notSupportedReason=h);var y={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),K={create:function(f,d,h){var y=_.window.document.createElement(f);return d!==void 0&&(y.className=d),h&&h.appendChild(y),y},createNS:function(f,d){return _.window.document.createElementNS(f,d)}},xe=_.window.document&&_.window.document.documentElement.style;function ve(f){if(!xe)return f[0];for(var d=0;d<f.length;d++)if(f[d]in xe)return f[d];return f[0]}var tt,Ae=ve(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);K.disableDrag=function(){xe&&Ae&&(tt=xe[Ae],xe[Ae]="none")},K.enableDrag=function(){xe&&Ae&&(xe[Ae]=tt)};var at=ve(["transform","WebkitTransform"]);K.setTransform=function(f,d){f.style[at]=d};var gt=!1;try{var Mt=Object.defineProperty({},"passive",{get:function(){gt=!0}});_.window.addEventListener("test",Mt,Mt),_.window.removeEventListener("test",Mt,Mt)}catch(f){gt=!1}K.addEventListener=function(f,d,h,y){y===void 0&&(y={}),f.addEventListener(d,h,"passive"in y&&gt?y:y.capture)},K.removeEventListener=function(f,d,h,y){y===void 0&&(y={}),f.removeEventListener(d,h,"passive"in y&&gt?y:y.capture)};var Ft=function(f){f.preventDefault(),f.stopPropagation(),_.window.removeEventListener("click",Ft,!0)};function mr(f){var d=f.userImage;return!!(d&&d.render&&d.render())&&(f.data.replace(new Uint8Array(d.data.buffer)),!0)}K.suppressClick=function(){_.window.addEventListener("click",Ft,!0),_.window.setTimeout(function(){_.window.removeEventListener("click",Ft,!0)},0)},K.mousePos=function(f,d){var h=f.getBoundingClientRect();return new _.Point(d.clientX-h.left-f.clientLeft,d.clientY-h.top-f.clientTop)},K.touchPos=function(f,d){for(var h=f.getBoundingClientRect(),y=[],C=0;C<d.length;C++)y.push(new _.Point(d[C].clientX-h.left-f.clientLeft,d[C].clientY-h.top-f.clientTop));return y},K.mouseButton=function(f){return _.window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&_.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button},K.remove=function(f){f.parentNode&&f.parentNode.removeChild(f)};var jt=function(f){function d(){f.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new _.RGBAImage({width:1,height:1}),this.dirty=!0}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(h){if(this.loaded!==h&&(this.loaded=h,h)){for(var y=0,C=this.requestors;y<C.length;y+=1){var I=C[y];this._notify(I.ids,I.callback)}this.requestors=[]}},d.prototype.getImage=function(h){return this.images[h]},d.prototype.addImage=function(h,y){this._validate(h,y)&&(this.images[h]=y)},d.prototype._validate=function(h,y){var C=!0;return this._validateStretch(y.stretchX,y.data&&y.data.width)||(this.fire(new _.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchX" value'))),C=!1),this._validateStretch(y.stretchY,y.data&&y.data.height)||(this.fire(new _.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchY" value'))),C=!1),this._validateContent(y.content,y)||(this.fire(new _.ErrorEvent(new Error('Image "'+h+'" has invalid "content" value'))),C=!1),C},d.prototype._validateStretch=function(h,y){if(!h)return!0;for(var C=0,I=0,L=h;I<L.length;I+=1){var B=L[I];if(B[0]<C||B[1]<B[0]||y<B[1])return!1;C=B[1]}return!0},d.prototype._validateContent=function(h,y){return!(h&&(h.length!==4||h[0]<0||y.data.width<h[0]||h[1]<0||y.data.height<h[1]||h[2]<0||y.data.width<h[2]||h[3]<0||y.data.height<h[3]||h[2]<h[0]||h[3]<h[1]))},d.prototype.updateImage=function(h,y){y.version=this.images[h].version+1,this.images[h]=y,this.updatedImages[h]=!0},d.prototype.removeImage=function(h){var y=this.images[h];delete this.images[h],delete this.patterns[h],y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(h,y){var C=!0;if(!this.isLoaded())for(var I=0,L=h;I<L.length;I+=1)this.images[L[I]]||(C=!1);this.isLoaded()||C?this._notify(h,y):this.requestors.push({ids:h,callback:y})},d.prototype._notify=function(h,y){for(var C={},I=0,L=h;I<L.length;I+=1){var B=L[I];this.images[B]||this.fire(new _.Event("styleimagemissing",{id:B}));var Y=this.images[B];Y?C[B]={data:Y.data.clone(),pixelRatio:Y.pixelRatio,sdf:Y.sdf,version:Y.version,stretchX:Y.stretchX,stretchY:Y.stretchY,content:Y.content,hasRenderCallback:Boolean(Y.userImage&&Y.userImage.render)}:_.warnOnce('Image "'+B+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}y(null,C)},d.prototype.getPixelSize=function(){var h=this.atlasImage;return{width:h.width,height:h.height}},d.prototype.getPattern=function(h){var y=this.patterns[h],C=this.getImage(h);if(!C)return null;if(y&&y.position.version===C.version)return y.position;if(y)y.position.version=C.version;else{var I={w:C.data.width+2,h:C.data.height+2,x:0,y:0},L=new _.ImagePosition(I,C);this.patterns[h]={bin:I,position:L}}return this._updatePatternAtlas(),this.patterns[h].position},d.prototype.bind=function(h){var y=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new _.Texture(h,this.atlasImage,y.RGBA),this.atlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var h=[];for(var y in this.patterns)h.push(this.patterns[y].bin);var C=_.potpack(h),I=C.w,L=C.h,B=this.atlasImage;for(var Y in B.resize({width:I||1,height:L||1}),this.patterns){var ae=this.patterns[Y].bin,Ce=ae.x+1,we=ae.y+1,ke=this.images[Y].data,Qe=ke.width,Ye=ke.height;_.RGBAImage.copy(ke,B,{x:0,y:0},{x:Ce,y:we},{width:Qe,height:Ye}),_.RGBAImage.copy(ke,B,{x:0,y:Ye-1},{x:Ce,y:we-1},{width:Qe,height:1}),_.RGBAImage.copy(ke,B,{x:0,y:0},{x:Ce,y:we+Ye},{width:Qe,height:1}),_.RGBAImage.copy(ke,B,{x:Qe-1,y:0},{x:Ce-1,y:we},{width:1,height:Ye}),_.RGBAImage.copy(ke,B,{x:0,y:0},{x:Ce+Qe,y:we},{width:1,height:Ye})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(h){for(var y=0,C=h;y<C.length;y+=1){var I=C[y];if(!this.callbackDispatchedThisFrame[I]){this.callbackDispatchedThisFrame[I]=!0;var L=this.images[I];mr(L)&&this.updateImage(I,L)}}},d}(_.Evented),hr=Pt,qt=Pt,Dt=1e20;function Pt(f,d,h,y,C,I){this.fontSize=f||24,this.buffer=d===void 0?3:d,this.cutoff=y||.25,this.fontFamily=C||"sans-serif",this.fontWeight=I||"normal",this.radius=h||8;var L=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=L,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(L*L),this.gridInner=new Float64Array(L*L),this.f=new Float64Array(L),this.d=new Float64Array(L),this.z=new Float64Array(L+1),this.v=new Int16Array(L),this.middle=Math.round(L/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Cr(f,d,h,y,C,I,L){for(var B=0;B<d;B++){for(var Y=0;Y<h;Y++)y[Y]=f[Y*d+B];for(ne(y,C,I,L,h),Y=0;Y<h;Y++)f[Y*d+B]=C[Y]}for(Y=0;Y<h;Y++){for(B=0;B<d;B++)y[B]=f[Y*d+B];for(ne(y,C,I,L,d),B=0;B<d;B++)f[Y*d+B]=Math.sqrt(C[B])}}function ne(f,d,h,y,C){h[0]=0,y[0]=-Dt,y[1]=+Dt;for(var I=1,L=0;I<C;I++){for(var B=(f[I]+I*I-(f[h[L]]+h[L]*h[L]))/(2*I-2*h[L]);B<=y[L];)L--,B=(f[I]+I*I-(f[h[L]]+h[L]*h[L]))/(2*I-2*h[L]);h[++L]=I,y[L]=B,y[L+1]=+Dt}for(I=0,L=0;I<C;I++){for(;y[L+1]<I;)L++;d[I]=(I-h[L])*(I-h[L])+f[h[L]]}}Pt.prototype.draw=function(f){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(f,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),h=new Uint8ClampedArray(this.size*this.size),y=0;y<this.size*this.size;y++){var C=d.data[4*y+3]/255;this.gridOuter[y]=C===1?0:C===0?Dt:Math.pow(Math.max(0,.5-C),2),this.gridInner[y]=C===1?Dt:C===0?0:Math.pow(Math.max(0,C-.5),2)}for(Cr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Cr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),y=0;y<this.size*this.size;y++)h[y]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[y]-this.gridInner[y])/this.radius+this.cutoff))));return h},hr.default=qt;var gr=function(f,d){this.requestManager=f,this.localIdeographFontFamily=d,this.entries={}};gr.prototype.setURL=function(f){this.url=f},gr.prototype.getGlyphs=function(f,d){var h=this,y=[];for(var C in f)for(var I=0,L=f[C];I<L.length;I+=1)y.push({stack:C,id:L[I]});_.asyncAll(y,function(B,Y){var ae=B.stack,Ce=B.id,we=h.entries[ae];we||(we=h.entries[ae]={glyphs:{},requests:{},ranges:{}});var ke=we.glyphs[Ce];if(ke===void 0){if(ke=h._tinySDF(we,ae,Ce))return we.glyphs[Ce]=ke,void Y(null,{stack:ae,id:Ce,glyph:ke});var Qe=Math.floor(Ce/256);if(256*Qe>65535)Y(new Error("glyphs > 65535 not supported"));else if(we.ranges[Qe])Y(null,{stack:ae,id:Ce,glyph:ke});else{var Ye=we.requests[Qe];Ye||(Ye=we.requests[Qe]=[],gr.loadGlyphRange(ae,Qe,h.url,h.requestManager,function(mt,je){if(je){for(var dt in je)h._doesCharSupportLocalGlyph(+dt)||(we.glyphs[+dt]=je[+dt]);we.ranges[Qe]=!0}for(var vt=0,$t=Ye;vt<$t.length;vt+=1)(0,$t[vt])(mt,je);delete we.requests[Qe]})),Ye.push(function(mt,je){mt?Y(mt):je&&Y(null,{stack:ae,id:Ce,glyph:je[Ce]||null})})}}else Y(null,{stack:ae,id:Ce,glyph:ke})},function(B,Y){if(B)d(B);else if(Y){for(var ae={},Ce=0,we=Y;Ce<we.length;Ce+=1){var ke=we[Ce],Qe=ke.stack,Ye=ke.id,mt=ke.glyph;(ae[Qe]||(ae[Qe]={}))[Ye]=mt&&{id:mt.id,bitmap:mt.bitmap.clone(),metrics:mt.metrics}}d(null,ae)}})},gr.prototype._doesCharSupportLocalGlyph=function(f){return!!this.localIdeographFontFamily&&(_.isChar["CJK Unified Ideographs"](f)||_.isChar["Hangul Syllables"](f)||_.isChar.Hiragana(f)||_.isChar.Katakana(f))},gr.prototype._tinySDF=function(f,d,h){var y=this.localIdeographFontFamily;if(y&&this._doesCharSupportLocalGlyph(h)){var C=f.tinySDF;if(!C){var I="400";/bold/i.test(d)?I="900":/medium/i.test(d)?I="500":/light/i.test(d)&&(I="200"),C=f.tinySDF=new gr.TinySDF(24,3,8,.25,y,I)}return{id:h,bitmap:new _.AlphaImage({width:30,height:30},C.draw(String.fromCharCode(h))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},gr.loadGlyphRange=function(f,d,h,y,C){var I=256*d,L=I+255,B=y.transformRequest(y.normalizeGlyphsURL(h).replace("{fontstack}",f).replace("{range}",I+"-"+L),_.ResourceType.Glyphs);_.getArrayBuffer(B,function(Y,ae){if(Y)C(Y);else if(ae){for(var Ce={},we=0,ke=_.parseGlyphPBF(ae);we<ke.length;we+=1){var Qe=ke[we];Ce[Qe.id]=Qe}C(null,Ce)}})},gr.TinySDF=hr;var It=function(){this.specification=_.styleSpec.light.position};It.prototype.possiblyEvaluate=function(f,d){return _.sphericalToCartesian(f.expression.evaluate(d))},It.prototype.interpolate=function(f,d,h){return{x:_.number(f.x,d.x,h),y:_.number(f.y,d.y,h),z:_.number(f.z,d.z,h)}};var xt=new _.Properties({anchor:new _.DataConstantProperty(_.styleSpec.light.anchor),position:new It,color:new _.DataConstantProperty(_.styleSpec.light.color),intensity:new _.DataConstantProperty(_.styleSpec.light.intensity)}),Jt=function(f){function d(h){f.call(this),this._transitionable=new _.Transitionable(xt),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(h,y){if(y===void 0&&(y={}),!this._validate(_.validateLight,h,y))for(var C in h){var I=h[C];_.endsWith(C,"-transition")?this._transitionable.setTransition(C.slice(0,-"-transition".length),I):this._transitionable.setValue(C,I)}},d.prototype.updateTransitions=function(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(h){this.properties=this._transitioning.possiblyEvaluate(h)},d.prototype._validate=function(h,y,C){return(!C||C.validate!==!1)&&_.emitValidationErrors(this,h.call(_.validateStyle,_.extend({value:y,style:{glyphs:!0,sprite:!0},styleSpec:_.styleSpec})))},d}(_.Evented),Ct=function(f,d){this.width=f,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Ct.prototype.getDash=function(f,d){var h=f.join(",")+String(d);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(f,d)),this.dashEntry[h]},Ct.prototype.getDashRanges=function(f,d,h){var y=[],C=f.length%2==1?-f[f.length-1]*h:0,I=f[0]*h,L=!0;y.push({left:C,right:I,isDash:L,zeroLength:f[0]===0});for(var B=f[0],Y=1;Y<f.length;Y++){var ae=f[Y];y.push({left:C=B*h,right:I=(B+=ae)*h,isDash:L=!L,zeroLength:ae===0})}return y},Ct.prototype.addRoundDash=function(f,d,h){for(var y=d/2,C=-h;C<=h;C++)for(var I=this.width*(this.nextRow+h+C),L=0,B=f[L],Y=0;Y<this.width;Y++){Y/B.right>1&&(B=f[++L]);var ae=Math.abs(Y-B.left),Ce=Math.abs(Y-B.right),we=Math.min(ae,Ce),ke=void 0,Qe=C/h*(y+1);if(B.isDash){var Ye=y-Math.abs(Qe);ke=Math.sqrt(we*we+Ye*Ye)}else ke=y-Math.sqrt(we*we+Qe*Qe);this.data[I+Y]=Math.max(0,Math.min(255,ke+128))}},Ct.prototype.addRegularDash=function(f){for(var d=f.length-1;d>=0;--d){var h=f[d],y=f[d+1];h.zeroLength?f.splice(d,1):y&&y.isDash===h.isDash&&(y.left=h.left,f.splice(d,1))}var C=f[0],I=f[f.length-1];C.isDash===I.isDash&&(C.left=I.left-this.width,I.right=C.right+this.width);for(var L=this.width*this.nextRow,B=0,Y=f[B],ae=0;ae<this.width;ae++){ae/Y.right>1&&(Y=f[++B]);var Ce=Math.abs(ae-Y.left),we=Math.abs(ae-Y.right),ke=Math.min(Ce,we);this.data[L+ae]=Math.max(0,Math.min(255,(Y.isDash?ke:-ke)+128))}},Ct.prototype.addDash=function(f,d){var h=d?7:0,y=2*h+1;if(this.nextRow+y>this.height)return _.warnOnce("LineAtlas out of space"),null;for(var C=0,I=0;I<f.length;I++)C+=f[I];if(C!==0){var L=this.width/C,B=this.getDashRanges(f,this.width,L);d?this.addRoundDash(B,L,h):this.addRegularDash(B)}var Y={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:C};return this.nextRow+=y,this.dirty=!0,Y},Ct.prototype.bind=function(f){var d=f.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var br=function f(d,h){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=_.uniqueId();for(var y=this.workerPool.acquire(this.id),C=0;C<y.length;C++){var I=new f.Actor(y[C],h,this.id);I.name="Worker "+C,this.actors.push(I)}};function $r(f,d,h){var y=function(C,I){if(C)return h(C);if(I){var L=_.pick(_.extend(I,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(L.vectorLayers=I.vector_layers,L.vectorLayerIds=L.vectorLayers.map(function(B){return B.id})),L.tiles=d.canonicalizeTileset(L,f.url),h(null,L)}};return f.url?_.getJSON(d.transformRequest(d.normalizeSourceURL(f.url),_.ResourceType.Source),y):_.browser.frame(function(){return y(null,f)})}br.prototype.broadcast=function(f,d,h){_.asyncAll(this.actors,function(y,C){y.send(f,d,C)},h=h||function(){})},br.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},br.prototype.remove=function(){this.actors.forEach(function(f){f.remove()}),this.actors=[],this.workerPool.release(this.id)},br.Actor=_.Actor;var oe=function(f,d,h){this.bounds=_.LngLatBounds.convert(this.validateBounds(f)),this.minzoom=d||0,this.maxzoom=h||24};oe.prototype.validateBounds=function(f){return Array.isArray(f)&&f.length===4?[Math.max(-180,f[0]),Math.max(-90,f[1]),Math.min(180,f[2]),Math.min(90,f[3])]:[-180,-90,180,90]},oe.prototype.contains=function(f){var d=Math.pow(2,f.z),h=Math.floor(_.mercatorXfromLng(this.bounds.getWest())*d),y=Math.floor(_.mercatorYfromLat(this.bounds.getNorth())*d),C=Math.ceil(_.mercatorXfromLng(this.bounds.getEast())*d),I=Math.ceil(_.mercatorYfromLat(this.bounds.getSouth())*d);return f.x>=h&&f.x<C&&f.y>=y&&f.y<I};var Ue=function(f){function d(h,y,C,I){if(f.call(this),this.id=h,this.dispatcher=C,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,_.extend(this,_.pick(y,["url","scheme","tileSize","promoteId"])),this._options=_.extend({type:"vector"},y),this._collectResourceTiming=y.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(I)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new _.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=$r(this._options,this.map._requestManager,function(y,C){h._tileJSONRequest=null,h._loaded=!0,y?h.fire(new _.ErrorEvent(y)):C&&(_.extend(h,C),C.bounds&&(h.tileBounds=new oe(C.bounds,h.minzoom,h.maxzoom)),_.postTurnstileEvent(C.tiles,h.map._requestManager._customAccessToken),_.postMapLoadEvent(C.tiles,h.map._getMapId(),h.map._requestManager._skuToken,h.map._requestManager._customAccessToken),h.fire(new _.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new _.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setSourceProperty=function(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},d.prototype.setTiles=function(h){var y=this;return this.setSourceProperty(function(){y._options.tiles=h}),this},d.prototype.setUrl=function(h){var y=this;return this.setSourceProperty(function(){y.url=h,y._options.url=h}),this},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return _.extend({},this._options)},d.prototype.loadTile=function(h,y){var C=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),I={request:this.map._requestManager.transformRequest(C,_.ResourceType.Tile),uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:_.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function L(B,Y){return delete h.request,h.aborted?y(null):B&&B.status!==404?y(B):(Y&&Y.resourceTiming&&(h.resourceTiming=Y.resourceTiming),this.map._refreshExpiredTiles&&Y&&h.setExpiryData(Y),h.loadVectorData(Y,this.map.painter),_.cacheEntryPossiblyAdded(this.dispatcher),y(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}I.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired"?h.state==="loading"?h.reloadCallback=y:h.request=h.actor.send("reloadTile",I,L.bind(this)):(h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",I,L.bind(this)))},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d}(_.Evented),H=function(f){function d(h,y,C,I){f.call(this),this.id=h,this.dispatcher=C,this.setEventedParent(I),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=_.extend({type:"raster"},y),_.extend(this,_.pick(y,["url","scheme","tileSize"]))}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new _.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=$r(this._options,this.map._requestManager,function(y,C){h._tileJSONRequest=null,h._loaded=!0,y?h.fire(new _.ErrorEvent(y)):C&&(_.extend(h,C),C.bounds&&(h.tileBounds=new oe(C.bounds,h.minzoom,h.maxzoom)),_.postTurnstileEvent(C.tiles),_.postMapLoadEvent(C.tiles,h.map._getMapId(),h.map._requestManager._skuToken),h.fire(new _.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new _.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return _.extend({},this._options)},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.loadTile=function(h,y){var C=this,I=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);h.request=_.getImage(this.map._requestManager.transformRequest(I,_.ResourceType.Tile),function(L,B){if(delete h.request,h.aborted)h.state="unloaded",y(null);else if(L)h.state="errored",y(L);else if(B){C.map._refreshExpiredTiles&&h.setExpiryData(B),delete B.cacheControl,delete B.expires;var Y=C.map.painter.context,ae=Y.gl;h.texture=C.map.painter.getTileTexture(B.width),h.texture?h.texture.update(B,{useMipmap:!0}):(h.texture=new _.Texture(Y,B,ae.RGBA,{useMipmap:!0}),h.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE,ae.LINEAR_MIPMAP_NEAREST),Y.extTextureFilterAnisotropic&&ae.texParameterf(ae.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax)),h.state="loaded",_.cacheEntryPossiblyAdded(C.dispatcher),y(null)}})},d.prototype.abortTile=function(h,y){h.request&&(h.request.cancel(),delete h.request),y()},d.prototype.unloadTile=function(h,y){h.texture&&this.map.painter.saveTileTexture(h.texture),y()},d.prototype.hasTransition=function(){return!1},d}(_.Evented),U=function(f){function d(h,y,C,I){f.call(this,h,y,C,I),this.type="raster-dem",this.maxzoom=22,this._options=_.extend({type:"raster-dem"},y),this.encoding=y.encoding||"mapbox"}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(h,y){var C=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function I(L,B){L&&(h.state="errored",y(L)),B&&(h.dem=B,h.needsHillshadePrepare=!0,h.state="loaded",y(null))}h.request=_.getImage(this.map._requestManager.transformRequest(C,_.ResourceType.Tile),function(L,B){if(delete h.request,h.aborted)h.state="unloaded",y(null);else if(L)h.state="errored",y(L);else if(B){this.map._refreshExpiredTiles&&h.setExpiryData(B),delete B.cacheControl,delete B.expires;var Y=_.window.ImageBitmap&&B instanceof _.window.ImageBitmap&&_.offscreenCanvasSupported()?B:_.browser.getImageData(B,1),ae={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:Y,encoding:this.encoding};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",ae,I.bind(this)))}}.bind(this)),h.neighboringTiles=this._getNeighboringTiles(h.tileID)},d.prototype._getNeighboringTiles=function(h){var y=h.canonical,C=Math.pow(2,y.z),I=(y.x-1+C)%C,L=y.x===0?h.wrap-1:h.wrap,B=(y.x+1+C)%C,Y=y.x+1===C?h.wrap+1:h.wrap,ae={};return ae[new _.OverscaledTileID(h.overscaledZ,L,y.z,I,y.y).key]={backfilled:!1},ae[new _.OverscaledTileID(h.overscaledZ,Y,y.z,B,y.y).key]={backfilled:!1},y.y>0&&(ae[new _.OverscaledTileID(h.overscaledZ,L,y.z,I,y.y-1).key]={backfilled:!1},ae[new _.OverscaledTileID(h.overscaledZ,h.wrap,y.z,y.x,y.y-1).key]={backfilled:!1},ae[new _.OverscaledTileID(h.overscaledZ,Y,y.z,B,y.y-1).key]={backfilled:!1}),y.y+1<C&&(ae[new _.OverscaledTileID(h.overscaledZ,L,y.z,I,y.y+1).key]={backfilled:!1},ae[new _.OverscaledTileID(h.overscaledZ,h.wrap,y.z,y.x,y.y+1).key]={backfilled:!1},ae[new _.OverscaledTileID(h.overscaledZ,Y,y.z,B,y.y+1).key]={backfilled:!1}),ae},d.prototype.unloadTile=function(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded",h.actor&&h.actor.send("removeDEMTile",{uid:h.uid,source:this.id})},d}(H),de=function(f){function d(h,y,C,I){f.call(this),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=C.getActor(),this.setEventedParent(I),this._data=y.data,this._options=_.extend({},y),this._collectResourceTiming=y.collectResourceTiming,this._resourceTiming=[],y.maxzoom!==void 0&&(this.maxzoom=y.maxzoom),y.type&&(this.type=y.type),y.attribution&&(this.attribution=y.attribution),this.promoteId=y.promoteId;var L=_.EXTENT/this.tileSize;this.workerOptions=_.extend({source:this.id,cluster:y.cluster||!1,geojsonVtOptions:{buffer:(y.buffer!==void 0?y.buffer:128)*L,tolerance:(y.tolerance!==void 0?y.tolerance:.375)*L,extent:_.EXTENT,maxZoom:this.maxzoom,lineMetrics:y.lineMetrics||!1,generateId:y.generateId||!1},superclusterOptions:{maxZoom:y.clusterMaxZoom!==void 0?Math.min(y.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,y.clusterMinPoints||2),extent:_.EXTENT,radius:(y.clusterRadius||50)*L,log:!1,generateId:y.generateId||!1},clusterProperties:y.clusterProperties,filter:y.filter},y.workerOptions)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this.fire(new _.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(y){if(y)h.fire(new _.ErrorEvent(y));else{var C={dataType:"source",sourceDataType:"metadata"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(C.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new _.Event("data",C))}})},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setData=function(h){var y=this;return this._data=h,this.fire(new _.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(C){if(C)y.fire(new _.ErrorEvent(C));else{var I={dataType:"source",sourceDataType:"content"};y._collectResourceTiming&&y._resourceTiming&&y._resourceTiming.length>0&&(I.resourceTiming=y._resourceTiming,y._resourceTiming=[]),y.fire(new _.Event("data",I))}}),this},d.prototype.getClusterExpansionZoom=function(h,y){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},y),this},d.prototype.getClusterChildren=function(h,y){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},y),this},d.prototype.getClusterLeaves=function(h,y,C,I){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:y,offset:C},I),this},d.prototype._updateWorkerData=function(h){var y=this;this._loaded=!1;var C=_.extend({},this.workerOptions),I=this._data;typeof I=="string"?(C.request=this.map._requestManager.transformRequest(_.browser.resolveURL(I),_.ResourceType.Source),C.request.collectResourceTiming=this._collectResourceTiming):C.data=JSON.stringify(I),this.actor.send(this.type+".loadData",C,function(L,B){y._removed||B&&B.abandoned||(y._loaded=!0,B&&B.resourceTiming&&B.resourceTiming[y.id]&&(y._resourceTiming=B.resourceTiming[y.id].slice(0)),y.actor.send(y.type+".coalesce",{source:C.source},null),h(L))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(h,y){var C=this,I=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(I,{type:this.type,uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:_.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(L,B){return delete h.request,h.unloadVectorData(),h.aborted?y(null):L?y(L):(h.loadVectorData(B,C.map.painter,I==="reloadTile"),y(null))})},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0},d.prototype.unloadTile=function(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return _.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d}(_.Evented),Xe=_.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),lt=function(f){function d(h,y,C,I){f.call(this),this.id=h,this.dispatcher=C,this.coordinates=y.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(I),this.options=y}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(h,y){var C=this;this._loaded=!1,this.fire(new _.Event("dataloading",{dataType:"source"})),this.url=this.options.url,_.getImage(this.map._requestManager.transformRequest(this.url,_.ResourceType.Image),function(I,L){C._loaded=!0,I?C.fire(new _.ErrorEvent(I)):L&&(C.image=L,h&&(C.coordinates=h),y&&y(),C._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(h){var y=this;return this.image&&h.url?(this.options.url=h.url,this.load(h.coordinates,function(){y.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new _.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setCoordinates=function(h){var y=this;this.coordinates=h;var C=h.map(_.MercatorCoordinate.fromLngLat);this.tileID=function(L){for(var B=1/0,Y=1/0,ae=-1/0,Ce=-1/0,we=0,ke=L;we<ke.length;we+=1){var Qe=ke[we];B=Math.min(B,Qe.x),Y=Math.min(Y,Qe.y),ae=Math.max(ae,Qe.x),Ce=Math.max(Ce,Qe.y)}var Ye=Math.max(ae-B,Ce-Y),mt=Math.max(0,Math.floor(-Math.log(Ye)/Math.LN2)),je=Math.pow(2,mt);return new _.CanonicalTileID(mt,Math.floor((B+ae)/2*je),Math.floor((Y+Ce)/2*je))}(C),this.minzoom=this.maxzoom=this.tileID.z;var I=C.map(function(L){return y.tileID.getTilePoint(L)._round()});return this._boundsArray=new _.StructArrayLayout4i8,this._boundsArray.emplaceBack(I[0].x,I[0].y,0,0),this._boundsArray.emplaceBack(I[1].x,I[1].y,_.EXTENT,0),this._boundsArray.emplaceBack(I[3].x,I[3].y,0,_.EXTENT),this._boundsArray.emplaceBack(I[2].x,I[2].y,_.EXTENT,_.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new _.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var h=this.map.painter.context,y=h.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Xe.members)),this.boundsSegments||(this.boundsSegments=_.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new _.Texture(h,this.image,y.RGBA),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE)),this.tiles){var I=this.tiles[C];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}}},d.prototype.loadTile=function(h,y){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},y(null)):(h.state="errored",y(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d}(_.Evented),yt=function(f){function d(h,y,C,I){f.call(this,h,y,C,I),this.roundZoom=!0,this.type="video",this.options=y}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1;var y=this.options;this.urls=[];for(var C=0,I=y.urls;C<I.length;C+=1)this.urls.push(this.map._requestManager.transformRequest(I[C],_.ResourceType.Source).url);_.getVideo(this.urls,function(L,B){h._loaded=!0,L?h.fire(new _.ErrorEvent(L)):B&&(h.video=B,h.video.loop=!0,h.video.setAttribute("playsinline",""),h.video.addEventListener("playing",function(){h.map.triggerRepaint()}),h.map&&h.video.play(),h._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(h){if(this.video){var y=this.video.seekable;h<y.start(0)||h>y.end(0)?this.fire(new _.ErrorEvent(new _.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+y.start(0)+" and "+y.end(0)+"-second mark."))):this.video.currentTime=h}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var h=this.map.painter.context,y=h.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Xe.members)),this.boundsSegments||(this.boundsSegments=_.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE),y.texSubImage2D(y.TEXTURE_2D,0,0,0,y.RGBA,y.UNSIGNED_BYTE,this.video)):(this.texture=new _.Texture(h,this.video,y.RGBA),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE)),this.tiles){var I=this.tiles[C];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d}(lt),Vt=function(f){function d(h,y,C,I){f.call(this,h,y,C,I),y.coordinates?Array.isArray(y.coordinates)&&y.coordinates.length===4&&!y.coordinates.some(function(L){return!Array.isArray(L)||L.length!==2||L.some(function(B){return typeof B!="number"})})||this.fire(new _.ErrorEvent(new _.ValidationError("sources."+h,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new _.ErrorEvent(new _.ValidationError("sources."+h,null,'missing required property "coordinates"'))),y.animate&&typeof y.animate!="boolean"&&this.fire(new _.ErrorEvent(new _.ValidationError("sources."+h,null,'optional "animate" property must be a boolean value'))),y.canvas?typeof y.canvas=="string"||y.canvas instanceof _.window.HTMLCanvasElement||this.fire(new _.ErrorEvent(new _.ValidationError("sources."+h,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new _.ErrorEvent(new _.ValidationError("sources."+h,null,'missing required property "canvas"'))),this.options=y,this.animate=y.animate===void 0||y.animate}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof _.window.HTMLCanvasElement?this.options.canvas:_.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new _.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var y=this.map.painter.context,C=y.gl;for(var I in this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,Xe.members)),this.boundsSegments||(this.boundsSegments=_.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new _.Texture(y,this.canvas,C.RGBA,{premultiply:!0}),this.tiles){var L=this.tiles[I];L.state!=="loaded"&&(L.state="loaded",L.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var h=0,y=[this.canvas.width,this.canvas.height];h<y.length;h+=1){var C=y[h];if(isNaN(C)||C<=0)return!0}return!1},d}(lt),pr={vector:Ue,raster:H,"raster-dem":U,geojson:de,video:yt,image:lt,canvas:Vt};function tn(f,d){var h=_.identity([]);return _.translate(h,h,[1,1,0]),_.scale(h,h,[.5*f.width,.5*f.height,1]),_.multiply(h,h,f.calculatePosMatrix(d.toUnwrapped()))}function Kr(f,d,h,y,C,I){var L=function(mt,je,dt){if(mt)for(var vt=0,$t=mt;vt<$t.length;vt+=1){var Sr=je[$t[vt]];if(Sr&&Sr.source===dt&&Sr.type==="fill-extrusion")return!0}else for(var yr in je){var wr=je[yr];if(wr.source===dt&&wr.type==="fill-extrusion")return!0}return!1}(C&&C.layers,d,f.id),B=I.maxPitchScaleFactor(),Y=f.tilesIn(y,B,L);Y.sort(si);for(var ae=[],Ce=0,we=Y;Ce<we.length;Ce+=1){var ke=we[Ce];ae.push({wrappedTileID:ke.tileID.wrapped().key,queryResults:ke.tile.queryRenderedFeatures(d,h,f._state,ke.queryGeometry,ke.cameraQueryGeometry,ke.scale,C,I,B,tn(f.transform,ke.tileID))})}var Qe=function(mt){for(var je={},dt={},vt=0,$t=mt;vt<$t.length;vt+=1){var Sr=$t[vt],yr=Sr.queryResults,wr=Sr.wrappedTileID,Xr=dt[wr]=dt[wr]||{};for(var yn in yr)for(var ln=yr[yn],Bn=Xr[yn]=Xr[yn]||{},ei=je[yn]=je[yn]||[],_i=0,gi=ln;_i<gi.length;_i+=1){var Ki=gi[_i];Bn[Ki.featureIndex]||(Bn[Ki.featureIndex]=!0,ei.push(Ki))}}return je}(ae);for(var Ye in Qe)Qe[Ye].forEach(function(mt){var je=mt.feature,dt=f.getFeatureState(je.layer["source-layer"],je.id);je.source=je.layer.source,je.layer["source-layer"]&&(je.sourceLayer=je.layer["source-layer"]),je.state=dt});return Qe}function si(f,d){var h=f.tileID,y=d.tileID;return h.overscaledZ-y.overscaledZ||h.canonical.y-y.canonical.y||h.wrap-y.wrap||h.canonical.x-y.canonical.x}var xn=function(f,d){this.max=f,this.onRemove=d,this.reset()};xn.prototype.reset=function(){for(var f in this.data)for(var d=0,h=this.data[f];d<h.length;d+=1){var y=h[d];y.timeout&&clearTimeout(y.timeout),this.onRemove(y.value)}return this.data={},this.order=[],this},xn.prototype.add=function(f,d,h){var y=this,C=f.wrapped().key;this.data[C]===void 0&&(this.data[C]=[]);var I={value:d,timeout:void 0};if(h!==void 0&&(I.timeout=setTimeout(function(){y.remove(f,I)},h)),this.data[C].push(I),this.order.push(C),this.order.length>this.max){var L=this._getAndRemoveByKey(this.order[0]);L&&this.onRemove(L)}return this},xn.prototype.has=function(f){return f.wrapped().key in this.data},xn.prototype.getAndRemove=function(f){return this.has(f)?this._getAndRemoveByKey(f.wrapped().key):null},xn.prototype._getAndRemoveByKey=function(f){var d=this.data[f].shift();return d.timeout&&clearTimeout(d.timeout),this.data[f].length===0&&delete this.data[f],this.order.splice(this.order.indexOf(f),1),d.value},xn.prototype.getByKey=function(f){var d=this.data[f];return d?d[0].value:null},xn.prototype.get=function(f){return this.has(f)?this.data[f.wrapped().key][0].value:null},xn.prototype.remove=function(f,d){if(!this.has(f))return this;var h=f.wrapped().key,y=d===void 0?0:this.data[h].indexOf(d),C=this.data[h][y];return this.data[h].splice(y,1),C.timeout&&clearTimeout(C.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(C.value),this.order.splice(this.order.indexOf(h),1),this},xn.prototype.setMaxSize=function(f){for(this.max=f;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},xn.prototype.filter=function(f){var d=[];for(var h in this.data)for(var y=0,C=this.data[h];y<C.length;y+=1){var I=C[y];f(I.value)||d.push(I)}for(var L=0,B=d;L<B.length;L+=1){var Y=B[L];this.remove(Y.value.tileID,Y)}};var ii=function(f,d,h){this.context=f;var y=f.gl;this.buffer=y.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),f.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};ii.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ii.prototype.updateData=function(f){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,f.arrayBuffer)},ii.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Ra={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Di=function(f,d,h,y){this.length=d.length,this.attributes=h,this.itemSize=d.bytesPerElement,this.dynamicDraw=y,this.context=f;var C=f.gl;this.buffer=C.createBuffer(),f.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Di.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Di.prototype.updateData=function(f){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,f.arrayBuffer)},Di.prototype.enableAttributes=function(f,d){for(var h=0;h<this.attributes.length;h++){var y=d.attributes[this.attributes[h].name];y!==void 0&&f.enableVertexAttribArray(y)}},Di.prototype.setVertexAttribPointers=function(f,d,h){for(var y=0;y<this.attributes.length;y++){var C=this.attributes[y],I=d.attributes[C.name];I!==void 0&&f.vertexAttribPointer(I,C.components,f[Ra[C.type]],!1,this.itemSize,C.offset+this.itemSize*(h||0))}},Di.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Pi=function(f){this.gl=f.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Pi.prototype.get=function(){return this.current},Pi.prototype.set=function(f){},Pi.prototype.getDefault=function(){return this.default},Pi.prototype.setDefault=function(){this.set(this.default)};var ua=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return _.Color.transparent},d.prototype.set=function(h){var y=this.current;(h.r!==y.r||h.g!==y.g||h.b!==y.b||h.a!==y.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(Pi),sa=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)},d}(Pi),Bi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)},d}(Pi),Yn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(h){var y=this.current;(h[0]!==y[0]||h[1]!==y[1]||h[2]!==y[2]||h[3]!==y[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(Pi),bi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)},d}(Pi),Ms=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)},d}(Pi),Ha=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(h){var y=this.current;(h.func!==y.func||h.ref!==y.ref||h.mask!==y.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)},d}(Pi),eo=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]},d.prototype.set=function(h){var y=this.current;(h[0]!==y[0]||h[1]!==y[1]||h[2]!==y[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)},d}(Pi),Rt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;h?y.enable(y.STENCIL_TEST):y.disable(y.STENCIL_TEST),this.current=h,this.dirty=!1}},d}(Pi),be=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(h){var y=this.current;(h[0]!==y[0]||h[1]!==y[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)},d}(Pi),ce=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;h?y.enable(y.DEPTH_TEST):y.disable(y.DEPTH_TEST),this.current=h,this.dirty=!1}},d}(Pi),Me=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)},d}(Pi),j=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;h?y.enable(y.BLEND):y.disable(y.BLEND),this.current=h,this.dirty=!1}},d}(Pi),ut=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.ONE,h.ZERO]},d.prototype.set=function(h){var y=this.current;(h[0]!==y[0]||h[1]!==y[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)},d}(Pi),ir=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return _.Color.transparent},d.prototype.set=function(h){var y=this.current;(h.r!==y.r||h.g!==y.g||h.b!==y.b||h.a!==y.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(Pi),Jr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)},d}(Pi),nt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;h?y.enable(y.CULL_FACE):y.disable(y.CULL_FACE),this.current=h,this.dirty=!1}},d}(Pi),Bt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)},d}(Pi),Ar=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)},d}(Pi),zr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)},d}(Pi),un=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)},d}(Pi),vn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]},d.prototype.set=function(h){var y=this.current;(h[0]!==y[0]||h[1]!==y[1]||h[2]!==y[2]||h[3]!==y[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(Pi),ui=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;y.bindFramebuffer(y.FRAMEBUFFER,h),this.current=h,this.dirty=!1}},d}(Pi),Jn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;y.bindRenderbuffer(y.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(Pi),mn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;y.bindTexture(y.TEXTURE_2D,h),this.current=h,this.dirty=!1}},d}(Pi),Ri=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;y.bindBuffer(y.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}},d}(Pi),Si=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){var y=this.gl;y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1},d}(Pi),Wa=function(f){function d(h){f.call(this,h),this.vao=h.extVertexArrayObject}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){this.vao&&(h!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(h),this.current=h,this.dirty=!1)},d}(Pi),uo=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;y.pixelStorei(y.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}},d}(Pi),Io=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}},d}(Pi),to=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}},d}(Pi),La=function(f){function d(h,y){f.call(this,h),this.context=h,this.parent=y}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d}(Pi),te=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var y=this.gl;y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}},d}(La),le=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var y=this.gl;y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(La),ye=function(f,d,h,y){this.context=f,this.width=d,this.height=h;var C=this.framebuffer=f.gl.createFramebuffer();this.colorAttachment=new te(f,C),y&&(this.depthAttachment=new le(f,C))};ye.prototype.destroy=function(){var f=this.context.gl,d=this.colorAttachment.get();if(d&&f.deleteTexture(d),this.depthAttachment){var h=this.depthAttachment.get();h&&f.deleteRenderbuffer(h)}f.deleteFramebuffer(this.framebuffer)};var Re=function(f,d,h){this.func=f,this.mask=d,this.range=h};Re.ReadOnly=!1,Re.ReadWrite=!0,Re.disabled=new Re(519,Re.ReadOnly,[0,1]);var He=function(f,d,h,y,C,I){this.test=f,this.ref=d,this.mask=h,this.fail=y,this.depthFail=C,this.pass=I};He.disabled=new He({func:519,mask:0},0,0,7680,7680,7680);var ht=function(f,d,h){this.blendFunction=f,this.blendColor=d,this.mask=h};ht.disabled=new ht(ht.Replace=[1,0],_.Color.transparent,[!1,!1,!1,!1]),ht.unblended=new ht(ht.Replace,_.Color.transparent,[!0,!0,!0,!0]),ht.alphaBlended=new ht([1,771],_.Color.transparent,[!0,!0,!0,!0]);var At=function(f,d,h){this.enable=f,this.mode=d,this.frontFace=h};At.disabled=new At(!1,1029,2305),At.backCCW=new At(!0,1029,2305);var Te=function(f){this.gl=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ua(this),this.clearDepth=new sa(this),this.clearStencil=new Bi(this),this.colorMask=new Yn(this),this.depthMask=new bi(this),this.stencilMask=new Ms(this),this.stencilFunc=new Ha(this),this.stencilOp=new eo(this),this.stencilTest=new Rt(this),this.depthRange=new be(this),this.depthTest=new ce(this),this.depthFunc=new Me(this),this.blend=new j(this),this.blendFunc=new ut(this),this.blendColor=new ir(this),this.blendEquation=new Jr(this),this.cullFace=new nt(this),this.cullFaceSide=new Bt(this),this.frontFace=new Ar(this),this.program=new zr(this),this.activeTexture=new un(this),this.viewport=new vn(this),this.bindFramebuffer=new ui(this),this.bindRenderbuffer=new Jn(this),this.bindTexture=new mn(this),this.bindVertexBuffer=new Ri(this),this.bindElementBuffer=new Si(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Wa(this),this.pixelStoreUnpack=new uo(this),this.pixelStoreUnpackPremultiplyAlpha=new Io(this),this.pixelStoreUnpackFlipY=new to(this),this.extTextureFilterAnisotropic=f.getExtension("EXT_texture_filter_anisotropic")||f.getExtension("MOZ_EXT_texture_filter_anisotropic")||f.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=f.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=f.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(f.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=f.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=f.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=f.getParameter(f.MAX_TEXTURE_SIZE)};Te.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Te.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Te.prototype.createIndexBuffer=function(f,d){return new ii(this,f,d)},Te.prototype.createVertexBuffer=function(f,d,h){return new Di(this,f,d,h)},Te.prototype.createRenderbuffer=function(f,d,h){var y=this.gl,C=y.createRenderbuffer();return this.bindRenderbuffer.set(C),y.renderbufferStorage(y.RENDERBUFFER,f,d,h),this.bindRenderbuffer.set(null),C},Te.prototype.createFramebuffer=function(f,d,h){return new ye(this,f,d,h)},Te.prototype.clear=function(f){var d=f.color,h=f.depth,y=this.gl,C=0;d&&(C|=y.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(C|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),y.clear(C)},Te.prototype.setCullFace=function(f){f.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(f.mode),this.frontFace.set(f.frontFace))},Te.prototype.setDepthMode=function(f){f.func!==this.gl.ALWAYS||f.mask?(this.depthTest.set(!0),this.depthFunc.set(f.func),this.depthMask.set(f.mask),this.depthRange.set(f.range)):this.depthTest.set(!1)},Te.prototype.setStencilMode=function(f){f.test.func!==this.gl.ALWAYS||f.mask?(this.stencilTest.set(!0),this.stencilMask.set(f.mask),this.stencilOp.set([f.fail,f.depthFail,f.pass]),this.stencilFunc.set({func:f.test.func,ref:f.ref,mask:f.test.mask})):this.stencilTest.set(!1)},Te.prototype.setColorMode=function(f){_.deepEqual(f.blendFunction,ht.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(f.blendFunction),this.blendColor.set(f.blendColor)),this.colorMask.set(f.mask)},Te.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Je=function(f){function d(h,y,C){var I=this;f.call(this),this.id=h,this.dispatcher=C,this.on("data",function(L){L.dataType==="source"&&L.sourceDataType==="metadata"&&(I._sourceLoaded=!0),I._sourceLoaded&&!I._paused&&L.dataType==="source"&&L.sourceDataType==="content"&&(I.reload(),I.transform&&I.update(I.transform))}),this.on("error",function(){I._sourceErrored=!0}),this._source=function(L,B,Y,ae){var Ce=new pr[B.type](L,B,Y,ae);if(Ce.id!==L)throw new Error("Expected Source id to be "+L+" instead of "+Ce.id);return _.bindAll(["load","abort","unload","serialize","prepare"],Ce),Ce}(h,y,C,this),this._tiles={},this._cache=new xn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new _.SourceFeatureState}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){this.map=h,this._maxTileCacheSize=h?h._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(h)},d.prototype.onRemove=function(h){this._source&&this._source.onRemove&&this._source.onRemove(h)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var h in this._tiles){var y=this._tiles[h];if(y.state!=="loaded"&&y.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var h=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,h&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(h,y){return this._source.loadTile(h,y)},d.prototype._unloadTile=function(h){if(this._source.unloadTile)return this._source.unloadTile(h,function(){})},d.prototype._abortTile=function(h){if(this._source.abortTile)return this._source.abortTile(h,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(h){for(var y in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var C=this._tiles[y];C.upload(h),C.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return _.values(this._tiles).map(function(h){return h.tileID}).sort(Xt).map(function(h){return h.key})},d.prototype.getRenderableIds=function(h){var y=this,C=[];for(var I in this._tiles)this._isIdRenderable(I,h)&&C.push(this._tiles[I]);return h?C.sort(function(L,B){var Y=L.tileID,ae=B.tileID,Ce=new _.Point(Y.canonical.x,Y.canonical.y)._rotate(y.transform.angle),we=new _.Point(ae.canonical.x,ae.canonical.y)._rotate(y.transform.angle);return Y.overscaledZ-ae.overscaledZ||we.y-Ce.y||we.x-Ce.x}).map(function(L){return L.tileID.key}):C.map(function(L){return L.tileID}).sort(Xt).map(function(L){return L.key})},d.prototype.hasRenderableParent=function(h){var y=this.findLoadedParent(h,0);return!!y&&this._isIdRenderable(y.tileID.key)},d.prototype._isIdRenderable=function(h,y){return this._tiles[h]&&this._tiles[h].hasData()&&!this._coveredTiles[h]&&(y||!this._tiles[h].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var h in this._cache.reset(),this._tiles)this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")},d.prototype._reloadTile=function(h,y){var C=this._tiles[h];C&&(C.state!=="loading"&&(C.state=y),this._loadTile(C,this._tileLoaded.bind(this,C,h,y)))},d.prototype._tileLoaded=function(h,y,C,I){if(I)return h.state="errored",void(I.status!==404?this._source.fire(new _.ErrorEvent(I,{tile:h})):this.update(this.transform));h.timeAdded=_.browser.now(),C==="expired"&&(h.refreshedUponExpiration=!0),this._setTileReloadTimer(y,h),this.getSource().type==="raster-dem"&&h.dem&&this._backfillDEM(h),this._state.initializeTileState(h,this.map?this.map.painter:null),this._source.fire(new _.Event("data",{dataType:"source",tile:h,coord:h.tileID}))},d.prototype._backfillDEM=function(h){for(var y=this.getRenderableIds(),C=0;C<y.length;C++){var I=y[C];if(h.neighboringTiles&&h.neighboringTiles[I]){var L=this.getTileByID(I);B(h,L),B(L,h)}}function B(Y,ae){Y.needsHillshadePrepare=!0;var Ce=ae.tileID.canonical.x-Y.tileID.canonical.x,we=ae.tileID.canonical.y-Y.tileID.canonical.y,ke=Math.pow(2,Y.tileID.canonical.z),Qe=ae.tileID.key;Ce===0&&we===0||Math.abs(we)>1||(Math.abs(Ce)>1&&(Math.abs(Ce+ke)===1?Ce+=ke:Math.abs(Ce-ke)===1&&(Ce-=ke)),ae.dem&&Y.dem&&(Y.dem.backfillBorder(ae.dem,Ce,we),Y.neighboringTiles&&Y.neighboringTiles[Qe]&&(Y.neighboringTiles[Qe].backfilled=!0)))}},d.prototype.getTile=function(h){return this.getTileByID(h.key)},d.prototype.getTileByID=function(h){return this._tiles[h]},d.prototype._retainLoadedChildren=function(h,y,C,I){for(var L in this._tiles){var B=this._tiles[L];if(!(I[L]||!B.hasData()||B.tileID.overscaledZ<=y||B.tileID.overscaledZ>C)){for(var Y=B.tileID;B&&B.tileID.overscaledZ>y+1;){var ae=B.tileID.scaledTo(B.tileID.overscaledZ-1);(B=this._tiles[ae.key])&&B.hasData()&&(Y=ae)}for(var Ce=Y;Ce.overscaledZ>y;)if(h[(Ce=Ce.scaledTo(Ce.overscaledZ-1)).key]){I[Y.key]=Y;break}}}},d.prototype.findLoadedParent=function(h,y){if(h.key in this._loadedParentTiles){var C=this._loadedParentTiles[h.key];return C&&C.tileID.overscaledZ>=y?C:null}for(var I=h.overscaledZ-1;I>=y;I--){var L=h.scaledTo(I),B=this._getLoadedTile(L);if(B)return B}},d.prototype._getLoadedTile=function(h){var y=this._tiles[h.key];return y&&y.hasData()?y:this._cache.getByKey(h.wrapped().key)},d.prototype.updateCacheSize=function(h){var y=Math.ceil(h.width/this._source.tileSize)+1,C=Math.ceil(h.height/this._source.tileSize)+1,I=Math.floor(y*C*5),L=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,I):I;this._cache.setMaxSize(L)},d.prototype.handleWrapJump=function(h){var y=Math.round((h-(this._prevLng===void 0?h:this._prevLng))/360);if(this._prevLng=h,y){var C={};for(var I in this._tiles){var L=this._tiles[I];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+y),C[L.tileID.key]=L}for(var B in this._tiles=C,this._timers)clearTimeout(this._timers[B]),delete this._timers[B];for(var Y in this._tiles)this._setTileReloadTimer(Y,this._tiles[Y])}},d.prototype.update=function(h){var y=this;if(this.transform=h,this._sourceLoaded&&!this._paused){var C;this.updateCacheSize(h),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?C=h.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Xr){return new _.OverscaledTileID(Xr.canonical.z,Xr.wrap,Xr.canonical.z,Xr.canonical.x,Xr.canonical.y)}):(C=h.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(C=C.filter(function(Xr){return y._source.hasTile(Xr)}))):C=[];var I=h.coveringZoomLevel(this._source),L=Math.max(I-d.maxOverzooming,this._source.minzoom),B=Math.max(I+d.maxUnderzooming,this._source.minzoom),Y=this._updateRetainedTiles(C,I);if(Wr(this._source.type)){for(var ae={},Ce={},we=0,ke=Object.keys(Y);we<ke.length;we+=1){var Qe=ke[we],Ye=Y[Qe],mt=this._tiles[Qe];if(mt&&!(mt.fadeEndTime&&mt.fadeEndTime<=_.browser.now())){var je=this.findLoadedParent(Ye,L);je&&(this._addTile(je.tileID),ae[je.tileID.key]=je.tileID),Ce[Qe]=Ye}}for(var dt in this._retainLoadedChildren(Ce,I,B,Y),ae)Y[dt]||(this._coveredTiles[dt]=!0,Y[dt]=ae[dt])}for(var vt in Y)this._tiles[vt].clearFadeHold();for(var $t=0,Sr=_.keysDifference(this._tiles,Y);$t<Sr.length;$t+=1){var yr=Sr[$t],wr=this._tiles[yr];wr.hasSymbolBuckets&&!wr.holdingForFade()?wr.setHoldDuration(this.map._fadeDuration):wr.hasSymbolBuckets&&!wr.symbolFadeFinished()||this._removeTile(yr)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var h in this._tiles)this._tiles[h].holdingForFade()&&this._removeTile(h)},d.prototype._updateRetainedTiles=function(h,y){for(var C={},I={},L=Math.max(y-d.maxOverzooming,this._source.minzoom),B=Math.max(y+d.maxUnderzooming,this._source.minzoom),Y={},ae=0,Ce=h;ae<Ce.length;ae+=1){var we=Ce[ae],ke=this._addTile(we);C[we.key]=we,ke.hasData()||y<this._source.maxzoom&&(Y[we.key]=we)}this._retainLoadedChildren(Y,y,B,C);for(var Qe=0,Ye=h;Qe<Ye.length;Qe+=1){var mt=Ye[Qe],je=this._tiles[mt.key];if(!je.hasData()){if(y+1>this._source.maxzoom){var dt=mt.children(this._source.maxzoom)[0],vt=this.getTile(dt);if(vt&&vt.hasData()){C[dt.key]=dt;continue}}else{var $t=mt.children(this._source.maxzoom);if(C[$t[0].key]&&C[$t[1].key]&&C[$t[2].key]&&C[$t[3].key])continue}for(var Sr=je.wasRequested(),yr=mt.overscaledZ-1;yr>=L;--yr){var wr=mt.scaledTo(yr);if(I[wr.key]||(I[wr.key]=!0,!(je=this.getTile(wr))&&Sr&&(je=this._addTile(wr)),je&&(C[wr.key]=wr,Sr=je.wasRequested(),je.hasData())))break}}}return C},d.prototype._updateLoadedParentTileCache=function(){for(var h in this._loadedParentTiles={},this._tiles){for(var y=[],C=void 0,I=this._tiles[h].tileID;I.overscaledZ>0;){if(I.key in this._loadedParentTiles){C=this._loadedParentTiles[I.key];break}y.push(I.key);var L=I.scaledTo(I.overscaledZ-1);if(C=this._getLoadedTile(L))break;I=L}for(var B=0,Y=y;B<Y.length;B+=1)this._loadedParentTiles[Y[B]]=C}},d.prototype._addTile=function(h){var y=this._tiles[h.key];if(y)return y;(y=this._cache.getAndRemove(h))&&(this._setTileReloadTimer(h.key,y),y.tileID=h,this._state.initializeTileState(y,this.map?this.map.painter:null),this._cacheTimers[h.key]&&(clearTimeout(this._cacheTimers[h.key]),delete this._cacheTimers[h.key],this._setTileReloadTimer(h.key,y)));var C=Boolean(y);return C||(y=new _.Tile(h,this._source.tileSize*h.overscaleFactor()),this._loadTile(y,this._tileLoaded.bind(this,y,h.key,y.state))),y?(y.uses++,this._tiles[h.key]=y,C||this._source.fire(new _.Event("dataloading",{tile:y,coord:y.tileID,dataType:"source"})),y):null},d.prototype._setTileReloadTimer=function(h,y){var C=this;h in this._timers&&(clearTimeout(this._timers[h]),delete this._timers[h]);var I=y.getExpiryTimeout();I&&(this._timers[h]=setTimeout(function(){C._reloadTile(h,"expired"),delete C._timers[h]},I))},d.prototype._removeTile=function(h){var y=this._tiles[h];y&&(y.uses--,delete this._tiles[h],this._timers[h]&&(clearTimeout(this._timers[h]),delete this._timers[h]),y.uses>0||(y.hasData()&&y.state!=="reloading"?this._cache.add(y.tileID,y,y.getExpiryTimeout()):(y.aborted=!0,this._abortTile(y),this._unloadTile(y))))},d.prototype.clearTiles=function(){for(var h in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(h);this._cache.reset()},d.prototype.tilesIn=function(h,y,C){var I=this,L=[],B=this.transform;if(!B)return L;for(var Y=C?B.getCameraQueryGeometry(h):h,ae=h.map(function(yr){return B.pointCoordinate(yr)}),Ce=Y.map(function(yr){return B.pointCoordinate(yr)}),we=this.getIds(),ke=1/0,Qe=1/0,Ye=-1/0,mt=-1/0,je=0,dt=Ce;je<dt.length;je+=1){var vt=dt[je];ke=Math.min(ke,vt.x),Qe=Math.min(Qe,vt.y),Ye=Math.max(Ye,vt.x),mt=Math.max(mt,vt.y)}for(var $t=function(yr){var wr=I._tiles[we[yr]];if(!wr.holdingForFade()){var Xr=wr.tileID,yn=Math.pow(2,B.zoom-wr.tileID.overscaledZ),ln=y*wr.queryPadding*_.EXTENT/wr.tileSize/yn,Bn=[Xr.getTilePoint(new _.MercatorCoordinate(ke,Qe)),Xr.getTilePoint(new _.MercatorCoordinate(Ye,mt))];if(Bn[0].x-ln<_.EXTENT&&Bn[0].y-ln<_.EXTENT&&Bn[1].x+ln>=0&&Bn[1].y+ln>=0){var ei=ae.map(function(gi){return Xr.getTilePoint(gi)}),_i=Ce.map(function(gi){return Xr.getTilePoint(gi)});L.push({tile:wr,tileID:Xr,queryGeometry:ei,cameraQueryGeometry:_i,scale:yn})}}},Sr=0;Sr<we.length;Sr++)$t(Sr);return L},d.prototype.getVisibleCoordinates=function(h){for(var y=this,C=this.getRenderableIds(h).map(function(Y){return y._tiles[Y].tileID}),I=0,L=C;I<L.length;I+=1){var B=L[I];B.posMatrix=this.transform.calculatePosMatrix(B.toUnwrapped())}return C},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Wr(this._source.type))for(var h in this._tiles){var y=this._tiles[h];if(y.fadeEndTime!==void 0&&y.fadeEndTime>=_.browser.now())return!0}return!1},d.prototype.setFeatureState=function(h,y,C){this._state.updateState(h=h||"_geojsonTileLayer",y,C)},d.prototype.removeFeatureState=function(h,y,C){this._state.removeFeatureState(h=h||"_geojsonTileLayer",y,C)},d.prototype.getFeatureState=function(h,y){return this._state.getState(h=h||"_geojsonTileLayer",y)},d.prototype.setDependencies=function(h,y,C){var I=this._tiles[h];I&&I.setDependencies(y,C)},d.prototype.reloadTilesForDependencies=function(h,y){for(var C in this._tiles)this._tiles[C].hasDependency(h,y)&&this._reloadTile(C,"reloading");this._cache.filter(function(I){return!I.hasDependency(h,y)})},d}(_.Evented);function Xt(f,d){var h=Math.abs(2*f.wrap)-+(f.wrap<0),y=Math.abs(2*d.wrap)-+(d.wrap<0);return f.overscaledZ-d.overscaledZ||y-h||d.canonical.y-f.canonical.y||d.canonical.x-f.canonical.x}function Wr(f){return f==="raster"||f==="image"||f==="video"}function cr(){return new _.window.Worker(Ti.workerUrl)}Je.maxOverzooming=10,Je.maxUnderzooming=3;var dr="mapboxgl_preloaded_worker_pool",jr=function(){this.active={}};jr.prototype.acquire=function(f){if(!this.workers)for(this.workers=[];this.workers.length<jr.workerCount;)this.workers.push(new cr);return this.active[f]=!0,this.workers.slice()},jr.prototype.release=function(f){delete this.active[f],this.numActive()===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)},jr.prototype.isPreloaded=function(){return!!this.active[dr]},jr.prototype.numActive=function(){return Object.keys(this.active).length};var qn,Un=Math.floor(_.browser.hardwareConcurrency/2);function ar(){return qn||(qn=new jr),qn}function ot(f,d){var h={};for(var y in f)y!=="ref"&&(h[y]=f[y]);return _.refProperties.forEach(function(C){C in d&&(h[C]=d[C])}),h}function Cn(f){f=f.slice();for(var d=Object.create(null),h=0;h<f.length;h++)d[f[h].id]=f[h];for(var y=0;y<f.length;y++)"ref"in f[y]&&(f[y]=ot(f[y],d[f[y].ref]));return f}jr.workerCount=Math.max(Math.min(Un,6),1);var se={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Yi(f,d,h){h.push({command:se.addSource,args:[f,d[f]]})}function Fn(f,d,h){d.push({command:se.removeSource,args:[f]}),h[f]=!0}function ta(f,d,h,y){Fn(f,h,y),Yi(f,d,h)}function $a(f,d,h){var y;for(y in f[h])if(f[h].hasOwnProperty(y)&&y!=="data"&&!_.deepEqual(f[h][y],d[h][y]))return!1;for(y in d[h])if(d[h].hasOwnProperty(y)&&y!=="data"&&!_.deepEqual(f[h][y],d[h][y]))return!1;return!0}function ra(f,d,h,y,C,I){var L;for(L in d=d||{},f=f||{})f.hasOwnProperty(L)&&(_.deepEqual(f[L],d[L])||h.push({command:I,args:[y,L,d[L],C]}));for(L in d)d.hasOwnProperty(L)&&!f.hasOwnProperty(L)&&(_.deepEqual(f[L],d[L])||h.push({command:I,args:[y,L,d[L],C]}))}function pa(f){return f.id}function Xi(f,d){return f[d.id]=d,f}var Ui=function(f,d){this.reset(f,d)};Ui.prototype.reset=function(f,d){this.points=f||[],this._distances=[0];for(var h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Ui.prototype.lerp=function(f){if(this.points.length===1)return this.points[0];f=_.clamp(f,0,1);for(var d=1,h=this._distances[d],y=f*this.paddedLength+this.padding;h<y&&d<this._distances.length;)h=this._distances[++d];var C=d-1,I=this._distances[C],L=h-I,B=L>0?(y-I)/L:0;return this.points[C].mult(1-B).add(this.points[d].mult(B))};var ma=function(f,d,h){var y=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(f/h),this.yCellCount=Math.ceil(d/h);for(var I=0;I<this.xCellCount*this.yCellCount;I++)y.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=f,this.height=d,this.xScale=this.xCellCount/f,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0};function bo(f,d,h,y,C){var I=_.create();return d?(_.scale(I,I,[1/C,1/C,1]),h||_.rotateZ(I,I,y.angle)):_.multiply(I,y.labelPlaneMatrix,f),I}function Za(f,d,h,y,C){if(d){var I=_.clone(f);return _.scale(I,I,[C,C,1]),h||_.rotateZ(I,I,-y.angle),I}return y.glCoordMatrix}function fa(f,d){var h=[f.x,f.y,0,1];Eo(h,h,d);var y=h[3];return{point:new _.Point(h[0]/y,h[1]/y),signedDistanceFromCamera:y}}function na(f,d){return .5+f/d*.5}function To(f,d){var h=f[0]/f[3],y=f[1]/f[3];return h>=-d[0]&&h<=d[0]&&y>=-d[1]&&y<=d[1]}function Ou(f,d,h,y,C,I,L,B){var Y=y?f.textSizeData:f.iconSizeData,ae=_.evaluateSizeForZoom(Y,h.transform.zoom),Ce=[256/h.width*2+1,256/h.height*2+1],we=y?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;we.clear();for(var ke=f.lineVertexArray,Qe=y?f.text.placedSymbolArray:f.icon.placedSymbolArray,Ye=h.transform.width/h.transform.height,mt=!1,je=0;je<Qe.length;je++){var dt=Qe.get(je);if(dt.hidden||dt.writingMode===_.WritingMode.vertical&&!mt)Xo(dt.numGlyphs,we);else{mt=!1;var vt=[dt.anchorX,dt.anchorY,0,1];if(_.transformMat4(vt,vt,d),To(vt,Ce)){var $t=na(h.transform.cameraToCenterDistance,vt[3]),Sr=_.evaluateSizeForFeature(Y,ae,dt),yr=L?Sr/$t:Sr*$t,wr=new _.Point(dt.anchorX,dt.anchorY),Xr=fa(wr,C).point,yn={},ln=iu(dt,yr,!1,B,d,C,I,f.glyphOffsetArray,ke,we,Xr,wr,yn,Ye);mt=ln.useVertical,(ln.notEnoughRoom||mt||ln.needsFlipping&&iu(dt,yr,!0,B,d,C,I,f.glyphOffsetArray,ke,we,Xr,wr,yn,Ye).notEnoughRoom)&&Xo(dt.numGlyphs,we)}else Xo(dt.numGlyphs,we)}}y?f.text.dynamicLayoutVertexBuffer.updateData(we):f.icon.dynamicLayoutVertexBuffer.updateData(we)}function ko(f,d,h,y,C,I,L,B,Y,ae,Ce){var we=B.glyphStartIndex+B.numGlyphs,ke=B.lineStartIndex,Qe=B.lineStartIndex+B.lineLength,Ye=d.getoffsetX(B.glyphStartIndex),mt=d.getoffsetX(we-1),je=Ua(f*Ye,h,y,C,I,L,B.segment,ke,Qe,Y,ae,Ce);if(!je)return null;var dt=Ua(f*mt,h,y,C,I,L,B.segment,ke,Qe,Y,ae,Ce);return dt?{first:je,last:dt}:null}function ao(f,d,h,y){return f===_.WritingMode.horizontal&&Math.abs(h.y-d.y)>Math.abs(h.x-d.x)*y?{useVertical:!0}:(f===_.WritingMode.vertical?d.y<h.y:d.x>h.x)?{needsFlipping:!0}:null}function iu(f,d,h,y,C,I,L,B,Y,ae,Ce,we,ke,Qe){var Ye,mt=d/24,je=f.lineOffsetX*mt,dt=f.lineOffsetY*mt;if(f.numGlyphs>1){var vt=f.glyphStartIndex+f.numGlyphs,$t=f.lineStartIndex,Sr=f.lineStartIndex+f.lineLength,yr=ko(mt,B,je,dt,h,Ce,we,f,Y,I,ke);if(!yr)return{notEnoughRoom:!0};var wr=fa(yr.first.point,L).point,Xr=fa(yr.last.point,L).point;if(y&&!h){var yn=ao(f.writingMode,wr,Xr,Qe);if(yn)return yn}Ye=[yr.first];for(var ln=f.glyphStartIndex+1;ln<vt-1;ln++)Ye.push(Ua(mt*B.getoffsetX(ln),je,dt,h,Ce,we,f.segment,$t,Sr,Y,I,ke));Ye.push(yr.last)}else{if(y&&!h){var Bn=fa(we,C).point,ei=f.lineStartIndex+f.segment+1,_i=new _.Point(Y.getx(ei),Y.gety(ei)),gi=fa(_i,C),Ki=gi.signedDistanceFromCamera>0?gi.point:au(we,_i,Bn,1,C),Nn=ao(f.writingMode,Bn,Ki,Qe);if(Nn)return Nn}var Hi=Ua(mt*B.getoffsetX(f.glyphStartIndex),je,dt,h,Ce,we,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,Y,I,ke);if(!Hi)return{notEnoughRoom:!0};Ye=[Hi]}for(var Qi=0,Li=Ye;Qi<Li.length;Qi+=1){var yi=Li[Qi];_.addDynamicAttributes(ae,yi.point,yi.angle)}return{}}function au(f,d,h,y,C){var I=fa(f.add(f.sub(d)._unit()),C).point,L=h.sub(I);return h.add(L._mult(y/L.mag()))}function Ua(f,d,h,y,C,I,L,B,Y,ae,Ce,we){var ke=y?f-d:f+d,Qe=ke>0?1:-1,Ye=0;y&&(Qe*=-1,Ye=Math.PI),Qe<0&&(Ye+=Math.PI);for(var mt=Qe>0?B+L:B+L+1,je=C,dt=C,vt=0,$t=0,Sr=Math.abs(ke),yr=[];vt+$t<=Sr;){if((mt+=Qe)<B||mt>=Y)return null;if(dt=je,yr.push(je),(je=we[mt])===void 0){var wr=new _.Point(ae.getx(mt),ae.gety(mt)),Xr=fa(wr,Ce);if(Xr.signedDistanceFromCamera>0)je=we[mt]=Xr.point;else{var yn=mt-Qe;je=au(vt===0?I:new _.Point(ae.getx(yn),ae.gety(yn)),wr,dt,Sr-vt+1,Ce)}}vt+=$t,$t=dt.dist(je)}var ln=(Sr-vt)/$t,Bn=je.sub(dt),ei=Bn.mult(ln)._add(dt);ei._add(Bn._unit()._perp()._mult(h*Qe));var _i=Ye+Math.atan2(je.y-dt.y,je.x-dt.x);return yr.push(ei),{point:ei,angle:_i,path:yr}}ma.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ma.prototype.insert=function(f,d,h,y,C){this._forEachCell(d,h,y,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(f),this.bboxes.push(d),this.bboxes.push(h),this.bboxes.push(y),this.bboxes.push(C)},ma.prototype.insertCircle=function(f,d,h,y){this._forEachCell(d-y,h-y,d+y,h+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(f),this.circles.push(d),this.circles.push(h),this.circles.push(y)},ma.prototype._insertBoxCell=function(f,d,h,y,C,I){this.boxCells[C].push(I)},ma.prototype._insertCircleCell=function(f,d,h,y,C,I){this.circleCells[C].push(I)},ma.prototype._query=function(f,d,h,y,C,I){if(h<0||f>this.width||y<0||d>this.height)return!C&&[];var L=[];if(f<=0&&d<=0&&this.width<=h&&this.height<=y){if(C)return!0;for(var B=0;B<this.boxKeys.length;B++)L.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(var Y=0;Y<this.circleKeys.length;Y++){var ae=this.circles[3*Y],Ce=this.circles[3*Y+1],we=this.circles[3*Y+2];L.push({key:this.circleKeys[Y],x1:ae-we,y1:Ce-we,x2:ae+we,y2:Ce+we})}return I?L.filter(I):L}return this._forEachCell(f,d,h,y,this._queryCell,L,{hitTest:C,seenUids:{box:{},circle:{}}},I),C?L.length>0:L},ma.prototype._queryCircle=function(f,d,h,y,C){var I=f-h,L=f+h,B=d-h,Y=d+h;if(L<0||I>this.width||Y<0||B>this.height)return!y&&[];var ae=[];return this._forEachCell(I,B,L,Y,this._queryCellCircle,ae,{hitTest:y,circle:{x:f,y:d,radius:h},seenUids:{box:{},circle:{}}},C),y?ae.length>0:ae},ma.prototype.query=function(f,d,h,y,C){return this._query(f,d,h,y,!1,C)},ma.prototype.hitTest=function(f,d,h,y,C){return this._query(f,d,h,y,!0,C)},ma.prototype.hitTestCircle=function(f,d,h,y){return this._queryCircle(f,d,h,!0,y)},ma.prototype._queryCell=function(f,d,h,y,C,I,L,B){var Y=L.seenUids,ae=this.boxCells[C];if(ae!==null)for(var Ce=this.bboxes,we=0,ke=ae;we<ke.length;we+=1){var Qe=ke[we];if(!Y.box[Qe]){Y.box[Qe]=!0;var Ye=4*Qe;if(f<=Ce[Ye+2]&&d<=Ce[Ye+3]&&h>=Ce[Ye+0]&&y>=Ce[Ye+1]&&(!B||B(this.boxKeys[Qe]))){if(L.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[Qe],x1:Ce[Ye],y1:Ce[Ye+1],x2:Ce[Ye+2],y2:Ce[Ye+3]})}}}var mt=this.circleCells[C];if(mt!==null)for(var je=this.circles,dt=0,vt=mt;dt<vt.length;dt+=1){var $t=vt[dt];if(!Y.circle[$t]){Y.circle[$t]=!0;var Sr=3*$t;if(this._circleAndRectCollide(je[Sr],je[Sr+1],je[Sr+2],f,d,h,y)&&(!B||B(this.circleKeys[$t]))){if(L.hitTest)return I.push(!0),!0;var yr=je[Sr],wr=je[Sr+1],Xr=je[Sr+2];I.push({key:this.circleKeys[$t],x1:yr-Xr,y1:wr-Xr,x2:yr+Xr,y2:wr+Xr})}}}},ma.prototype._queryCellCircle=function(f,d,h,y,C,I,L,B){var Y=L.circle,ae=L.seenUids,Ce=this.boxCells[C];if(Ce!==null)for(var we=this.bboxes,ke=0,Qe=Ce;ke<Qe.length;ke+=1){var Ye=Qe[ke];if(!ae.box[Ye]){ae.box[Ye]=!0;var mt=4*Ye;if(this._circleAndRectCollide(Y.x,Y.y,Y.radius,we[mt+0],we[mt+1],we[mt+2],we[mt+3])&&(!B||B(this.boxKeys[Ye])))return I.push(!0),!0}}var je=this.circleCells[C];if(je!==null)for(var dt=this.circles,vt=0,$t=je;vt<$t.length;vt+=1){var Sr=$t[vt];if(!ae.circle[Sr]){ae.circle[Sr]=!0;var yr=3*Sr;if(this._circlesCollide(dt[yr],dt[yr+1],dt[yr+2],Y.x,Y.y,Y.radius)&&(!B||B(this.circleKeys[Sr])))return I.push(!0),!0}}},ma.prototype._forEachCell=function(f,d,h,y,C,I,L,B){for(var Y=this._convertToXCellCoord(f),ae=this._convertToYCellCoord(d),Ce=this._convertToXCellCoord(h),we=this._convertToYCellCoord(y),ke=Y;ke<=Ce;ke++)for(var Qe=ae;Qe<=we;Qe++)if(C.call(this,f,d,h,y,this.xCellCount*Qe+ke,I,L,B))return},ma.prototype._convertToXCellCoord=function(f){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(f*this.xScale)))},ma.prototype._convertToYCellCoord=function(f){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(f*this.yScale)))},ma.prototype._circlesCollide=function(f,d,h,y,C,I){var L=y-f,B=C-d,Y=h+I;return Y*Y>L*L+B*B},ma.prototype._circleAndRectCollide=function(f,d,h,y,C,I,L){var B=(I-y)/2,Y=Math.abs(f-(y+B));if(Y>B+h)return!1;var ae=(L-C)/2,Ce=Math.abs(d-(C+ae));if(Ce>ae+h)return!1;if(Y<=B||Ce<=ae)return!0;var we=Y-B,ke=Ce-ae;return we*we+ke*ke<=h*h};var zl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Xo(f,d){for(var h=0;h<f;h++){var y=d.length;d.resize(y+4),d.float32.set(zl,3*y)}}function Eo(f,d,h){var y=d[0],C=d[1];return f[0]=h[0]*y+h[4]*C+h[12],f[1]=h[1]*y+h[5]*C+h[13],f[3]=h[3]*y+h[7]*C+h[15],f}var jo=function(f,d,h){d===void 0&&(d=new ma(f.width+200,f.height+200,25)),h===void 0&&(h=new ma(f.width+200,f.height+200,25)),this.transform=f,this.grid=d,this.ignoredGrid=h,this.pitchfactor=Math.cos(f._pitch)*f.cameraToCenterDistance,this.screenRightBoundary=f.width+100,this.screenBottomBoundary=f.height+100,this.gridRightBoundary=f.width+200,this.gridBottomBoundary=f.height+200};function Va(f,d,h){return d*(_.EXTENT/(f.tileSize*Math.pow(2,h-f.tileID.overscaledZ)))}jo.prototype.placeCollisionBox=function(f,d,h,y,C){var I=this.projectAndGetPerspectiveRatio(y,f.anchorPointX,f.anchorPointY),L=h*I.perspectiveRatio,B=f.x1*L+I.point.x,Y=f.y1*L+I.point.y,ae=f.x2*L+I.point.x,Ce=f.y2*L+I.point.y;return!this.isInsideGrid(B,Y,ae,Ce)||!d&&this.grid.hitTest(B,Y,ae,Ce,C)?{box:[],offscreen:!1}:{box:[B,Y,ae,Ce],offscreen:this.isOffscreen(B,Y,ae,Ce)}},jo.prototype.placeCollisionCircles=function(f,d,h,y,C,I,L,B,Y,ae,Ce,we,ke){var Qe=[],Ye=new _.Point(d.anchorX,d.anchorY),mt=fa(Ye,I),je=na(this.transform.cameraToCenterDistance,mt.signedDistanceFromCamera),dt=(ae?C/je:C*je)/_.ONE_EM,vt=fa(Ye,L).point,$t=ko(dt,y,d.lineOffsetX*dt,d.lineOffsetY*dt,!1,vt,Ye,d,h,L,{}),Sr=!1,yr=!1,wr=!0;if($t){for(var Xr=.5*we*je+ke,yn=new _.Point(-100,-100),ln=new _.Point(this.screenRightBoundary,this.screenBottomBoundary),Bn=new Ui,ei=$t.first,_i=$t.last,gi=[],Ki=ei.path.length-1;Ki>=1;Ki--)gi.push(ei.path[Ki]);for(var Nn=1;Nn<_i.path.length;Nn++)gi.push(_i.path[Nn]);var Hi=2.5*Xr;if(B){var Qi=gi.map(function(Gu){return fa(Gu,B)});gi=Qi.some(function(Gu){return Gu.signedDistanceFromCamera<=0})?[]:Qi.map(function(Gu){return Gu.point})}var Li=[];if(gi.length>0){for(var yi=gi[0].clone(),ia=gi[0].clone(),Ii=1;Ii<gi.length;Ii++)yi.x=Math.min(yi.x,gi[Ii].x),yi.y=Math.min(yi.y,gi[Ii].y),ia.x=Math.max(ia.x,gi[Ii].x),ia.y=Math.max(ia.y,gi[Ii].y);Li=yi.x>=yn.x&&ia.x<=ln.x&&yi.y>=yn.y&&ia.y<=ln.y?[gi]:ia.x<yn.x||yi.x>ln.x||ia.y<yn.y||yi.y>ln.y?[]:_.clipLine([gi],yn.x,yn.y,ln.x,ln.y)}for(var wi=0,cs=Li;wi<cs.length;wi+=1){var Po;Bn.reset(cs[wi],.25*Xr),Po=Bn.length<=.5*Xr?1:Math.ceil(Bn.paddedLength/Hi)+1;for(var ro=0;ro<Po;ro++){var Ps=ro/Math.max(Po-1,1),Zo=Bn.lerp(Ps),wo=Zo.x+100,uu=Zo.y+100;Qe.push(wo,uu,Xr,0);var Rs=wo-Xr,Vu=uu-Xr,lu=wo+Xr,qo=uu+Xr;if(wr=wr&&this.isOffscreen(Rs,Vu,lu,qo),yr=yr||this.isInsideGrid(Rs,Vu,lu,qo),!f&&this.grid.hitTestCircle(wo,uu,Xr,Ce)&&(Sr=!0,!Y))return{circles:[],offscreen:!1,collisionDetected:Sr}}}}return{circles:!Y&&Sr||!yr?[]:Qe,offscreen:wr,collisionDetected:Sr}},jo.prototype.queryRenderedSymbols=function(f){if(f.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],h=1/0,y=1/0,C=-1/0,I=-1/0,L=0,B=f;L<B.length;L+=1){var Y=B[L],ae=new _.Point(Y.x+100,Y.y+100);h=Math.min(h,ae.x),y=Math.min(y,ae.y),C=Math.max(C,ae.x),I=Math.max(I,ae.y),d.push(ae)}for(var Ce={},we={},ke=0,Qe=this.grid.query(h,y,C,I).concat(this.ignoredGrid.query(h,y,C,I));ke<Qe.length;ke+=1){var Ye=Qe[ke],mt=Ye.key;if(Ce[mt.bucketInstanceId]===void 0&&(Ce[mt.bucketInstanceId]={}),!Ce[mt.bucketInstanceId][mt.featureIndex]){var je=[new _.Point(Ye.x1,Ye.y1),new _.Point(Ye.x2,Ye.y1),new _.Point(Ye.x2,Ye.y2),new _.Point(Ye.x1,Ye.y2)];_.polygonIntersectsPolygon(d,je)&&(Ce[mt.bucketInstanceId][mt.featureIndex]=!0,we[mt.bucketInstanceId]===void 0&&(we[mt.bucketInstanceId]=[]),we[mt.bucketInstanceId].push(mt.featureIndex))}}return we},jo.prototype.insertCollisionBox=function(f,d,h,y,C){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:y,collisionGroupID:C},f[0],f[1],f[2],f[3])},jo.prototype.insertCollisionCircles=function(f,d,h,y,C){for(var I=d?this.ignoredGrid:this.grid,L={bucketInstanceId:h,featureIndex:y,collisionGroupID:C},B=0;B<f.length;B+=4)I.insertCircle(L,f[B],f[B+1],f[B+2])},jo.prototype.projectAndGetPerspectiveRatio=function(f,d,h){var y=[d,h,0,1];return Eo(y,y,f),{point:new _.Point((y[0]/y[3]+1)/2*this.transform.width+100,(-y[1]/y[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5}},jo.prototype.isOffscreen=function(f,d,h,y){return h<100||f>=this.screenRightBoundary||y<100||d>this.screenBottomBoundary},jo.prototype.isInsideGrid=function(f,d,h,y){return h>=0&&f<this.gridRightBoundary&&y>=0&&d<this.gridBottomBoundary},jo.prototype.getViewportMatrix=function(){var f=_.identity([]);return _.translate(f,f,[-100,-100,0]),f};var vs=function(f,d,h,y){this.opacity=f?Math.max(0,Math.min(1,f.opacity+(f.placed?d:-d))):y&&h?1:0,this.placed=h};vs.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Hs=function(f,d,h,y,C){this.text=new vs(f?f.text:null,d,h,C),this.icon=new vs(f?f.icon:null,d,y,C)};Hs.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Ml=function(f,d,h){this.text=f,this.icon=d,this.skipFade=h},ms=function(){this.invProjMatrix=_.create(),this.viewportMatrix=_.create(),this.circles=[]},Bs=function(f,d,h,y,C){this.bucketInstanceId=f,this.featureIndex=d,this.sourceLayerIndex=h,this.bucketIndex=y,this.tileID=C},Da=function(f){this.crossSourceCollisions=f,this.maxGroupID=0,this.collisionGroups={}};function $o(f,d,h,y,C){var I=_.getAnchorAlignment(f),L=-(I.horizontalAlign-.5)*d,B=-(I.verticalAlign-.5)*h,Y=_.evaluateVariableOffset(f,y);return new _.Point(L+Y[0]*C,B+Y[1]*C)}function Ys(f,d,h,y,C,I){var L=f.x1,B=f.x2,Y=f.y1,ae=f.y2,Ce=f.anchorPointX,we=f.anchorPointY,ke=new _.Point(d,h);return y&&ke._rotate(C?I:-I),{x1:L+ke.x,y1:Y+ke.y,x2:B+ke.x,y2:ae+ke.y,anchorPointX:Ce,anchorPointY:we}}Da.prototype.get=function(f){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[f]){var d=++this.maxGroupID;this.collisionGroups[f]={ID:d,predicate:function(h){return h.collisionGroupID===d}}}return this.collisionGroups[f]};var Ht=function(f,d,h,y){this.transform=f.clone(),this.collisionIndex=new jo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Da(h),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}};function tr(f,d,h,y,C){f.emplaceBack(d?1:0,h?1:0,y||0,C||0),f.emplaceBack(d?1:0,h?1:0,y||0,C||0),f.emplaceBack(d?1:0,h?1:0,y||0,C||0),f.emplaceBack(d?1:0,h?1:0,y||0,C||0)}Ht.prototype.getBucketParts=function(f,d,h,y){var C=h.getBucket(d),I=h.latestFeatureIndex;if(C&&I&&d.id===C.layerIds[0]){var L=h.collisionBoxArray,B=C.layers[0].layout,Y=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),ae=h.tileSize/_.EXTENT,Ce=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),we=B.get("text-pitch-alignment")==="map",ke=B.get("text-rotation-alignment")==="map",Qe=Va(h,1,this.transform.zoom),Ye=bo(Ce,we,ke,this.transform,Qe),mt=null;if(we){var je=Za(Ce,we,ke,this.transform,Qe);mt=_.multiply([],this.transform.labelPlaneMatrix,je)}this.retainedQueryData[C.bucketInstanceId]=new Bs(C.bucketInstanceId,I,C.sourceLayerIndex,C.index,h.tileID);var dt={bucket:C,layout:B,posMatrix:Ce,textLabelPlaneMatrix:Ye,labelToScreenMatrix:mt,scale:Y,textPixelRatio:ae,holdingForFade:h.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:_.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(y)for(var vt=0,$t=C.sortKeyRanges;vt<$t.length;vt+=1){var Sr=$t[vt];f.push({sortKey:Sr.sortKey,symbolInstanceStart:Sr.symbolInstanceStart,symbolInstanceEnd:Sr.symbolInstanceEnd,parameters:dt})}else f.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:dt})}},Ht.prototype.attemptAnchorPlacement=function(f,d,h,y,C,I,L,B,Y,ae,Ce,we,ke,Qe,Ye){var mt,je=[we.textOffset0,we.textOffset1],dt=$o(f,h,y,je,C),vt=this.collisionIndex.placeCollisionBox(Ys(d,dt.x,dt.y,I,L,this.transform.angle),Ce,B,Y,ae.predicate);if(!Ye||this.collisionIndex.placeCollisionBox(Ys(Ye,dt.x,dt.y,I,L,this.transform.angle),Ce,B,Y,ae.predicate).box.length!==0)return vt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID].text&&(mt=this.prevPlacement.variableOffsets[we.crossTileID].anchor),this.variableOffsets[we.crossTileID]={textOffset:je,width:h,height:y,anchor:f,textBoxScale:C,prevAnchor:mt},this.markUsedJustification(ke,f,we,Qe),ke.allowVerticalPlacement&&(this.markUsedOrientation(ke,Qe,we),this.placedOrientations[we.crossTileID]=Qe),{shift:dt,placedGlyphBoxes:vt}):void 0},Ht.prototype.placeLayerBucketPart=function(f,d,h){var y=this,C=f.parameters,I=C.bucket,L=C.layout,B=C.posMatrix,Y=C.textLabelPlaneMatrix,ae=C.labelToScreenMatrix,Ce=C.textPixelRatio,we=C.holdingForFade,ke=C.collisionBoxArray,Qe=C.partiallyEvaluatedTextSize,Ye=C.collisionGroup,mt=L.get("text-optional"),je=L.get("icon-optional"),dt=L.get("text-allow-overlap"),vt=L.get("icon-allow-overlap"),$t=L.get("text-rotation-alignment")==="map",Sr=L.get("text-pitch-alignment")==="map",yr=L.get("icon-text-fit")!=="none",wr=L.get("symbol-z-order")==="viewport-y",Xr=dt&&(vt||!I.hasIconData()||je),yn=vt&&(dt||!I.hasTextData()||mt);!I.collisionArrays&&ke&&I.deserializeCollisionBoxes(ke);var ln=function(Nn,Hi){if(!d[Nn.crossTileID])if(we)y.placements[Nn.crossTileID]=new Ml(!1,!1,!1);else{var Qi,Li=!1,yi=!1,ia=!0,Ii=null,wi={box:null,offscreen:null},cs={box:null,offscreen:null},Po=null,ro=null,Ps=0,Zo=0,wo=0;Hi.textFeatureIndex?Ps=Hi.textFeatureIndex:Nn.useRuntimeCollisionCircles&&(Ps=Nn.featureIndex),Hi.verticalTextFeatureIndex&&(Zo=Hi.verticalTextFeatureIndex);var uu=Hi.textBox;if(uu){var Rs=function(Na){var ll=_.WritingMode.horizontal;if(I.allowVerticalPlacement&&!Na&&y.prevPlacement){var Eu=y.prevPlacement.placedOrientations[Nn.crossTileID];Eu&&(y.placedOrientations[Nn.crossTileID]=Eu,y.markUsedOrientation(I,ll=Eu,Nn))}return ll},Vu=function(Na,ll){if(I.allowVerticalPlacement&&Nn.numVerticalGlyphVertices>0&&Hi.verticalTextBox)for(var Eu=0,jc=I.writingModes;Eu<jc.length&&(jc[Eu]===_.WritingMode.vertical?(wi=ll(),cs=wi):wi=Na(),!(wi&&wi.box&&wi.box.length));Eu+=1);else wi=Na()};if(L.get("text-variable-anchor")){var lu=L.get("text-variable-anchor");if(y.prevPlacement&&y.prevPlacement.variableOffsets[Nn.crossTileID]){var qo=y.prevPlacement.variableOffsets[Nn.crossTileID];lu.indexOf(qo.anchor)>0&&(lu=lu.filter(function(Na){return Na!==qo.anchor})).unshift(qo.anchor)}var Gu=function(Na,ll,Eu){for(var jc=Na.x2-Na.x1,gl=Na.y2-Na.y1,Df=Nn.textBoxScale,Bf=yr&&!vt?ll:null,Fl={box:[],offscreen:!1},lf=dt?2*lu.length:lu.length,yl=0;yl<lf;++yl){var sc=y.attemptAnchorPlacement(lu[yl%lu.length],Na,jc,gl,Df,$t,Sr,Ce,B,Ye,yl>=lu.length,Nn,I,Eu,Bf);if(sc&&(Fl=sc.placedGlyphBoxes)&&Fl.box&&Fl.box.length){Li=!0,Ii=sc.shift;break}}return Fl};Vu(function(){return Gu(uu,Hi.iconBox,_.WritingMode.horizontal)},function(){var Na=Hi.verticalTextBox;return I.allowVerticalPlacement&&!(wi&&wi.box&&wi.box.length)&&Nn.numVerticalGlyphVertices>0&&Na?Gu(Na,Hi.verticalIconBox,_.WritingMode.vertical):{box:null,offscreen:null}}),wi&&(Li=wi.box,ia=wi.offscreen);var Es=Rs(wi&&wi.box);if(!Li&&y.prevPlacement){var Of=y.prevPlacement.variableOffsets[Nn.crossTileID];Of&&(y.variableOffsets[Nn.crossTileID]=Of,y.markUsedJustification(I,Of.anchor,Nn,Es))}}else{var wc=function(Na,ll){var Eu=y.collisionIndex.placeCollisionBox(Na,dt,Ce,B,Ye.predicate);return Eu&&Eu.box&&Eu.box.length&&(y.markUsedOrientation(I,ll,Nn),y.placedOrientations[Nn.crossTileID]=ll),Eu};Vu(function(){return wc(uu,_.WritingMode.horizontal)},function(){var Na=Hi.verticalTextBox;return I.allowVerticalPlacement&&Nn.numVerticalGlyphVertices>0&&Na?wc(Na,_.WritingMode.vertical):{box:null,offscreen:null}}),Rs(wi&&wi.box&&wi.box.length)}}if(Li=(Qi=wi)&&Qi.box&&Qi.box.length>0,ia=Qi&&Qi.offscreen,Nn.useRuntimeCollisionCircles){var Gc=I.text.placedSymbolArray.get(Nn.centerJustifiedTextSymbolIndex),Ff=_.evaluateSizeForFeature(I.textSizeData,Qe,Gc),ju=L.get("text-padding");Po=y.collisionIndex.placeCollisionCircles(dt,Gc,I.lineVertexArray,I.glyphOffsetArray,Ff,B,Y,ae,h,Sr,Ye.predicate,Nn.collisionCircleDiameter,ju),Li=dt||Po.circles.length>0&&!Po.collisionDetected,ia=ia&&Po.offscreen}if(Hi.iconFeatureIndex&&(wo=Hi.iconFeatureIndex),Hi.iconBox){var Ol=function(Na){var ll=yr&&Ii?Ys(Na,Ii.x,Ii.y,$t,Sr,y.transform.angle):Na;return y.collisionIndex.placeCollisionBox(ll,vt,Ce,B,Ye.predicate)};yi=cs&&cs.box&&cs.box.length&&Hi.verticalIconBox?(ro=Ol(Hi.verticalIconBox)).box.length>0:(ro=Ol(Hi.iconBox)).box.length>0,ia=ia&&ro.offscreen}var ml=mt||Nn.numHorizontalGlyphVertices===0&&Nn.numVerticalGlyphVertices===0,ns=je||Nn.numIconVertices===0;if(ml||ns?ns?ml||(yi=yi&&Li):Li=yi&&Li:yi=Li=yi&&Li,Li&&Qi&&Qi.box&&y.collisionIndex.insertCollisionBox(Qi.box,L.get("text-ignore-placement"),I.bucketInstanceId,cs&&cs.box&&Zo?Zo:Ps,Ye.ID),yi&&ro&&y.collisionIndex.insertCollisionBox(ro.box,L.get("icon-ignore-placement"),I.bucketInstanceId,wo,Ye.ID),Po&&(Li&&y.collisionIndex.insertCollisionCircles(Po.circles,L.get("text-ignore-placement"),I.bucketInstanceId,Ps,Ye.ID),h)){var Hu=I.bucketInstanceId,oc=y.collisionCircleArrays[Hu];oc===void 0&&(oc=y.collisionCircleArrays[Hu]=new ms);for(var Ac=0;Ac<Po.circles.length;Ac+=4)oc.circles.push(Po.circles[Ac+0]),oc.circles.push(Po.circles[Ac+1]),oc.circles.push(Po.circles[Ac+2]),oc.circles.push(Po.collisionDetected?1:0)}y.placements[Nn.crossTileID]=new Ml(Li||Xr,yi||yn,ia||I.justReloaded),d[Nn.crossTileID]=!0}};if(wr)for(var Bn=I.getSortedSymbolIndexes(this.transform.angle),ei=Bn.length-1;ei>=0;--ei){var _i=Bn[ei];ln(I.symbolInstances.get(_i),I.collisionArrays[_i])}else for(var gi=f.symbolInstanceStart;gi<f.symbolInstanceEnd;gi++)ln(I.symbolInstances.get(gi),I.collisionArrays[gi]);if(h&&I.bucketInstanceId in this.collisionCircleArrays){var Ki=this.collisionCircleArrays[I.bucketInstanceId];_.invert(Ki.invProjMatrix,B),Ki.viewportMatrix=this.collisionIndex.getViewportMatrix()}I.justReloaded=!1},Ht.prototype.markUsedJustification=function(f,d,h,y){var C;C=y===_.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[_.getAnchorJustification(d)];for(var I=0,L=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];I<L.length;I+=1){var B=L[I];B>=0&&(f.text.placedSymbolArray.get(B).crossTileID=C>=0&&B!==C?0:h.crossTileID)}},Ht.prototype.markUsedOrientation=function(f,d,h){for(var y=d===_.WritingMode.horizontal||d===_.WritingMode.horizontalOnly?d:0,C=d===_.WritingMode.vertical?d:0,I=0,L=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];I<L.length;I+=1)f.text.placedSymbolArray.get(L[I]).placedOrientation=y;h.verticalPlacedTextSymbolIndex&&(f.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=C)},Ht.prototype.commit=function(f){this.commitTime=f,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,h=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var y=d?d.symbolFadeChange(f):1,C=d?d.opacities:{},I=d?d.variableOffsets:{},L=d?d.placedOrientations:{};for(var B in this.placements){var Y=this.placements[B],ae=C[B];ae?(this.opacities[B]=new Hs(ae,y,Y.text,Y.icon),h=h||Y.text!==ae.text.placed||Y.icon!==ae.icon.placed):(this.opacities[B]=new Hs(null,y,Y.text,Y.icon,Y.skipFade),h=h||Y.text||Y.icon)}for(var Ce in C){var we=C[Ce];if(!this.opacities[Ce]){var ke=new Hs(we,y,!1,!1);ke.isHidden()||(this.opacities[Ce]=ke,h=h||we.text.placed||we.icon.placed)}}for(var Qe in I)this.variableOffsets[Qe]||!this.opacities[Qe]||this.opacities[Qe].isHidden()||(this.variableOffsets[Qe]=I[Qe]);for(var Ye in L)this.placedOrientations[Ye]||!this.opacities[Ye]||this.opacities[Ye].isHidden()||(this.placedOrientations[Ye]=L[Ye]);h?this.lastPlacementChangeTime=f:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:f)},Ht.prototype.updateLayerOpacities=function(f,d){for(var h={},y=0,C=d;y<C.length;y+=1){var I=C[y],L=I.getBucket(f);L&&I.latestFeatureIndex&&f.id===L.layerIds[0]&&this.updateBucketOpacities(L,h,I.collisionBoxArray)}},Ht.prototype.updateBucketOpacities=function(f,d,h){var y=this;f.hasTextData()&&f.text.opacityVertexArray.clear(),f.hasIconData()&&f.icon.opacityVertexArray.clear(),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexArray.clear(),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexArray.clear();var C=f.layers[0].layout,I=new Hs(null,0,!1,!1,!0),L=C.get("text-allow-overlap"),B=C.get("icon-allow-overlap"),Y=C.get("text-variable-anchor"),ae=C.get("text-rotation-alignment")==="map",Ce=C.get("text-pitch-alignment")==="map",we=C.get("icon-text-fit")!=="none",ke=new Hs(null,0,L&&(B||!f.hasIconData()||C.get("icon-optional")),B&&(L||!f.hasTextData()||C.get("text-optional")),!0);!f.collisionArrays&&h&&(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData())&&f.deserializeCollisionBoxes(h);for(var Qe=function(dt,vt,$t){for(var Sr=0;Sr<vt/4;Sr++)dt.opacityVertexArray.emplaceBack($t)},Ye=function(dt){var vt=f.symbolInstances.get(dt),$t=vt.numHorizontalGlyphVertices,Sr=vt.numVerticalGlyphVertices,yr=vt.crossTileID,wr=y.opacities[yr];d[yr]?wr=I:wr||(y.opacities[yr]=wr=ke),d[yr]=!0;var Xr=vt.numIconVertices>0,yn=y.placedOrientations[vt.crossTileID],ln=yn===_.WritingMode.vertical,Bn=yn===_.WritingMode.horizontal||yn===_.WritingMode.horizontalOnly;if($t>0||Sr>0){var ei=li(wr.text);Qe(f.text,$t,ln?da:ei),Qe(f.text,Sr,Bn?da:ei);var _i=wr.text.isHidden();[vt.rightJustifiedTextSymbolIndex,vt.centerJustifiedTextSymbolIndex,vt.leftJustifiedTextSymbolIndex].forEach(function(wi){wi>=0&&(f.text.placedSymbolArray.get(wi).hidden=_i||ln?1:0)}),vt.verticalPlacedTextSymbolIndex>=0&&(f.text.placedSymbolArray.get(vt.verticalPlacedTextSymbolIndex).hidden=_i||Bn?1:0);var gi=y.variableOffsets[vt.crossTileID];gi&&y.markUsedJustification(f,gi.anchor,vt,yn);var Ki=y.placedOrientations[vt.crossTileID];Ki&&(y.markUsedJustification(f,"left",vt,Ki),y.markUsedOrientation(f,Ki,vt))}if(Xr){var Nn=li(wr.icon),Hi=!(we&&vt.verticalPlacedIconSymbolIndex&&ln);vt.placedIconSymbolIndex>=0&&(Qe(f.icon,vt.numIconVertices,Hi?Nn:da),f.icon.placedSymbolArray.get(vt.placedIconSymbolIndex).hidden=wr.icon.isHidden()),vt.verticalPlacedIconSymbolIndex>=0&&(Qe(f.icon,vt.numVerticalIconVertices,Hi?da:Nn),f.icon.placedSymbolArray.get(vt.verticalPlacedIconSymbolIndex).hidden=wr.icon.isHidden())}if(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData()){var Qi=f.collisionArrays[dt];if(Qi){var Li=new _.Point(0,0);if(Qi.textBox||Qi.verticalTextBox){var yi=!0;if(Y){var ia=y.variableOffsets[yr];ia?(Li=$o(ia.anchor,ia.width,ia.height,ia.textOffset,ia.textBoxScale),ae&&Li._rotate(Ce?y.transform.angle:-y.transform.angle)):yi=!1}Qi.textBox&&tr(f.textCollisionBox.collisionVertexArray,wr.text.placed,!yi||ln,Li.x,Li.y),Qi.verticalTextBox&&tr(f.textCollisionBox.collisionVertexArray,wr.text.placed,!yi||Bn,Li.x,Li.y)}var Ii=Boolean(!Bn&&Qi.verticalIconBox);Qi.iconBox&&tr(f.iconCollisionBox.collisionVertexArray,wr.icon.placed,Ii,we?Li.x:0,we?Li.y:0),Qi.verticalIconBox&&tr(f.iconCollisionBox.collisionVertexArray,wr.icon.placed,!Ii,we?Li.x:0,we?Li.y:0)}}},mt=0;mt<f.symbolInstances.length;mt++)Ye(mt);if(f.sortFeatures(this.transform.angle),this.retainedQueryData[f.bucketInstanceId]&&(this.retainedQueryData[f.bucketInstanceId].featureSortOrder=f.featureSortOrder),f.hasTextData()&&f.text.opacityVertexBuffer&&f.text.opacityVertexBuffer.updateData(f.text.opacityVertexArray),f.hasIconData()&&f.icon.opacityVertexBuffer&&f.icon.opacityVertexBuffer.updateData(f.icon.opacityVertexArray),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexBuffer&&f.iconCollisionBox.collisionVertexBuffer.updateData(f.iconCollisionBox.collisionVertexArray),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexBuffer&&f.textCollisionBox.collisionVertexBuffer.updateData(f.textCollisionBox.collisionVertexArray),f.bucketInstanceId in this.collisionCircleArrays){var je=this.collisionCircleArrays[f.bucketInstanceId];f.placementInvProjMatrix=je.invProjMatrix,f.placementViewportMatrix=je.viewportMatrix,f.collisionCircleArray=je.circles,delete this.collisionCircleArrays[f.bucketInstanceId]}},Ht.prototype.symbolFadeChange=function(f){return this.fadeDuration===0?1:(f-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Ht.prototype.zoomAdjustment=function(f){return Math.max(0,(this.transform.zoom-f)/1.5)},Ht.prototype.hasTransitions=function(f){return this.stale||f-this.lastPlacementChangeTime<this.fadeDuration},Ht.prototype.stillRecent=function(f,d){var h=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*h>f},Ht.prototype.setStale=function(){this.stale=!0};var J=Math.pow(2,25),Cu=Math.pow(2,24),_e=Math.pow(2,17),Ne=Math.pow(2,16),wt=Math.pow(2,9),ur=Math.pow(2,8),gn=Math.pow(2,1);function li(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;var d=f.placed?1:0,h=Math.floor(127*f.opacity);return h*J+d*Cu+h*_e+d*Ne+h*wt+d*ur+h*gn+d}var da=0,es=function(f){this._sortAcrossTiles=f.layout.get("symbol-z-order")!=="viewport-y"&&f.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};es.prototype.continuePlacement=function(f,d,h,y,C){for(var I=this._bucketParts;this._currentTileIndex<f.length;)if(d.getBucketParts(I,y,f[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort(function(L,B){return L.sortKey-B.sortKey}));this._currentPartIndex<I.length;)if(d.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,C())return!0;return!1};var Fr=function(f,d,h,y,C,I,L){this.placement=new Ht(f,C,I,L),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=y,this._done=!1};Fr.prototype.isDone=function(){return this._done},Fr.prototype.continuePlacement=function(f,d,h){for(var y=this,C=_.browser.now(),I=function(){var Y=_.browser.now()-C;return!y._forceFullPlacement&&Y>2};this._currentPlacementIndex>=0;){var L=d[f[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(L.type==="symbol"&&(!L.minzoom||L.minzoom<=B)&&(!L.maxzoom||L.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new es(L)),this._inProgressLayer.continuePlacement(h[L.source],this.placement,this._showCollisionBoxes,L,I))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Fr.prototype.commit=function(f){return this.placement.commit(f),this.placement};var Nr=512/_.EXTENT/2,it=function(f,d,h){this.tileID=f,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(var y=0;y<d.length;y++){var C=d.get(y),I=C.key;this.indexedSymbolInstances[I]||(this.indexedSymbolInstances[I]=[]),this.indexedSymbolInstances[I].push({crossTileID:C.crossTileID,coord:this.getScaledCoordinates(C,f)})}};it.prototype.getScaledCoordinates=function(f,d){var h=Nr/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*_.EXTENT+f.anchorX)*h),y:Math.floor((d.canonical.y*_.EXTENT+f.anchorY)*h)}},it.prototype.findMatches=function(f,d,h){for(var y=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),C=0;C<f.length;C++){var I=f.get(C);if(!I.crossTileID){var L=this.indexedSymbolInstances[I.key];if(L)for(var B=this.getScaledCoordinates(I,d),Y=0,ae=L;Y<ae.length;Y+=1){var Ce=ae[Y];if(Math.abs(Ce.coord.x-B.x)<=y&&Math.abs(Ce.coord.y-B.y)<=y&&!h[Ce.crossTileID]){h[Ce.crossTileID]=!0,I.crossTileID=Ce.crossTileID;break}}}}};var gu=function(){this.maxCrossTileID=0};gu.prototype.generate=function(){return++this.maxCrossTileID};var qs=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};qs.prototype.handleWrapJump=function(f){var d=Math.round((f-this.lng)/360);if(d!==0)for(var h in this.indexes){var y=this.indexes[h],C={};for(var I in y){var L=y[I];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+d),C[L.tileID.key]=L}this.indexes[h]=C}this.lng=f},qs.prototype.addBucket=function(f,d,h){if(this.indexes[f.overscaledZ]&&this.indexes[f.overscaledZ][f.key]){if(this.indexes[f.overscaledZ][f.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(f.overscaledZ,this.indexes[f.overscaledZ][f.key])}for(var y=0;y<d.symbolInstances.length;y++)d.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[f.overscaledZ]||(this.usedCrossTileIDs[f.overscaledZ]={});var C=this.usedCrossTileIDs[f.overscaledZ];for(var I in this.indexes){var L=this.indexes[I];if(Number(I)>f.overscaledZ)for(var B in L){var Y=L[B];Y.tileID.isChildOf(f)&&Y.findMatches(d.symbolInstances,f,C)}else{var ae=L[f.scaledTo(Number(I)).key];ae&&ae.findMatches(d.symbolInstances,f,C)}}for(var Ce=0;Ce<d.symbolInstances.length;Ce++){var we=d.symbolInstances.get(Ce);we.crossTileID||(we.crossTileID=h.generate(),C[we.crossTileID]=!0)}return this.indexes[f.overscaledZ]===void 0&&(this.indexes[f.overscaledZ]={}),this.indexes[f.overscaledZ][f.key]=new it(f,d.symbolInstances,d.bucketInstanceId),!0},qs.prototype.removeBucketCrossTileIDs=function(f,d){for(var h in d.indexedSymbolInstances)for(var y=0,C=d.indexedSymbolInstances[h];y<C.length;y+=1)delete this.usedCrossTileIDs[f][C[y].crossTileID]},qs.prototype.removeStaleBuckets=function(f){var d=!1;for(var h in this.indexes){var y=this.indexes[h];for(var C in y)f[y[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,y[C]),delete y[C],d=!0)}return d};var Tu=function(){this.layerIndexes={},this.crossTileIDs=new gu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Tu.prototype.addLayer=function(f,d,h){var y=this.layerIndexes[f.id];y===void 0&&(y=this.layerIndexes[f.id]=new qs);var C=!1,I={};y.handleWrapJump(h);for(var L=0,B=d;L<B.length;L+=1){var Y=B[L],ae=Y.getBucket(f);ae&&f.id===ae.layerIds[0]&&(ae.bucketInstanceId||(ae.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(Y.tileID,ae,this.crossTileIDs)&&(C=!0),I[ae.bucketInstanceId]=!0)}return y.removeStaleBuckets(I)&&(C=!0),C},Tu.prototype.pruneUnusedLayers=function(f){var d={};for(var h in f.forEach(function(y){d[y]=!0}),this.layerIndexes)d[h]||delete this.layerIndexes[h]};var Ns=function(f,d){return _.emitValidationErrors(f,d&&d.filter(function(h){return h.identifier!=="source.canvas"}))},yu=_.pick(se,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),_u=_.pick(se,["setCenter","setZoom","setBearing","setPitch"]),Ju=function(){var f={},d=_.styleSpec.$version;for(var h in _.styleSpec.$root){var y,C=_.styleSpec.$root[h];C.required&&(y=h==="version"?d:C.type==="array"?[]:{})!=null&&(f[h]=y)}return f}(),Mu=function(f){function d(h,y){var C=this;y===void 0&&(y={}),f.call(this),this.map=h,this.dispatcher=new br(ar(),this),this.imageManager=new jt,this.imageManager.setEventedParent(this),this.glyphManager=new gr(h._requestManager,y.localIdeographFontFamily),this.lineAtlas=new Ct(256,512),this.crossTileSymbolIndex=new Tu,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new _.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",_.getReferrer());var I=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(L){I.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:L.pluginStatus,pluginURL:L.pluginURL},function(B,Y){if(_.triggerPluginCompletionEvent(B),Y&&Y.every(function(Ce){return Ce}))for(var ae in I.sourceCaches)I.sourceCaches[ae].reload()})}),this.on("data",function(L){if(L.dataType==="source"&&L.sourceDataType==="metadata"){var B=C.sourceCaches[L.sourceId];if(B){var Y=B.getSource();if(Y&&Y.vectorLayerIds)for(var ae in C._layers){var Ce=C._layers[ae];Ce.source===Y.id&&C._validateLayer(Ce)}}}})}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.loadURL=function(h,y){var C=this;y===void 0&&(y={}),this.fire(new _.Event("dataloading",{dataType:"style"}));var I=typeof y.validate=="boolean"?y.validate:!_.isMapboxURL(h);h=this.map._requestManager.normalizeStyleURL(h,y.accessToken);var L=this.map._requestManager.transformRequest(h,_.ResourceType.Style);this._request=_.getJSON(L,function(B,Y){C._request=null,B?C.fire(new _.ErrorEvent(B)):Y&&C._load(Y,I)})},d.prototype.loadJSON=function(h,y){var C=this;y===void 0&&(y={}),this.fire(new _.Event("dataloading",{dataType:"style"})),this._request=_.browser.frame(function(){C._request=null,C._load(h,y.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new _.Event("dataloading",{dataType:"style"})),this._load(Ju,!1)},d.prototype._load=function(h,y){if(!y||!Ns(this,_.validateStyle(h))){for(var C in this._loaded=!0,this.stylesheet=h,h.sources)this.addSource(C,h.sources[C],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs);var I=Cn(this.stylesheet.layers);this._order=I.map(function(ae){return ae.id}),this._layers={},this._serializedLayers={};for(var L=0,B=I;L<B.length;L+=1){var Y=B[L];(Y=_.createStyleLayer(Y)).setEventedParent(this,{layer:{id:Y.id}}),this._layers[Y.id]=Y,this._serializedLayers[Y.id]=Y.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Jt(this.stylesheet.light),this.fire(new _.Event("data",{dataType:"style"})),this.fire(new _.Event("style.load"))}},d.prototype._loadSprite=function(h){var y=this;this._spriteRequest=function(C,I,L){var B,Y,ae,Ce=_.browser.devicePixelRatio>1?"@2x":"",we=_.getJSON(I.transformRequest(I.normalizeSpriteURL(C,Ce,".json"),_.ResourceType.SpriteJSON),function(Ye,mt){we=null,ae||(ae=Ye,B=mt,Qe())}),ke=_.getImage(I.transformRequest(I.normalizeSpriteURL(C,Ce,".png"),_.ResourceType.SpriteImage),function(Ye,mt){ke=null,ae||(ae=Ye,Y=mt,Qe())});function Qe(){if(ae)L(ae);else if(B&&Y){var Ye=_.browser.getImageData(Y),mt={};for(var je in B){var dt=B[je],vt=dt.width,$t=dt.height,Sr=dt.x,yr=dt.y,wr=dt.sdf,Xr=dt.pixelRatio,yn=dt.stretchX,ln=dt.stretchY,Bn=dt.content,ei=new _.RGBAImage({width:vt,height:$t});_.RGBAImage.copy(Ye,ei,{x:Sr,y:yr},{x:0,y:0},{width:vt,height:$t}),mt[je]={data:ei,pixelRatio:Xr,sdf:wr,stretchX:yn,stretchY:ln,content:Bn}}L(null,mt)}}return{cancel:function(){we&&(we.cancel(),we=null),ke&&(ke.cancel(),ke=null)}}}(h,this.map._requestManager,function(C,I){if(y._spriteRequest=null,C)y.fire(new _.ErrorEvent(C));else if(I)for(var L in I)y.imageManager.addImage(L,I[L]);y.imageManager.setLoaded(!0),y._availableImages=y.imageManager.listImages(),y.dispatcher.broadcast("setImages",y._availableImages),y.fire(new _.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(h){var y=this.sourceCaches[h.source];if(y){var C=h.sourceLayer;if(C){var I=y.getSource();(I.type==="geojson"||I.vectorLayerIds&&I.vectorLayerIds.indexOf(C)===-1)&&this.fire(new _.ErrorEvent(new Error('Source layer "'+C+'" does not exist on source "'+I.id+'" as specified by style layer "'+h.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var h in this.sourceCaches)if(!this.sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(h){for(var y=[],C=0,I=h;C<I.length;C+=1){var L=this._layers[I[C]];L.type!=="custom"&&y.push(L.serialize())}return y},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(var y in this._layers)if(this._layers[y].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(h){if(this._loaded){var y=this._changed;if(this._changed){var C=Object.keys(this._updatedLayers),I=Object.keys(this._removedLayers);for(var L in(C.length||I.length)&&this._updateWorkerLayers(C,I),this._updatedSources){var B=this._updatedSources[L];B==="reload"?this._reloadSource(L):B==="clear"&&this._clearSource(L)}for(var Y in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[Y].updateTransitions(h);this.light.updateTransitions(h),this._resetUpdates()}var ae={};for(var Ce in this.sourceCaches){var we=this.sourceCaches[Ce];ae[Ce]=we.used,we.used=!1}for(var ke=0,Qe=this._order;ke<Qe.length;ke+=1){var Ye=this._layers[Qe[ke]];Ye.recalculate(h,this._availableImages),!Ye.isHidden(h.zoom)&&Ye.source&&(this.sourceCaches[Ye.source].used=!0)}for(var mt in ae){var je=this.sourceCaches[mt];ae[mt]!==je.used&&je.fire(new _.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:mt}))}this.light.recalculate(h),this.z=h.zoom,y&&this.fire(new _.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var h=Object.keys(this._changedImages);if(h.length){for(var y in this.sourceCaches)this.sourceCaches[y].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}},d.prototype._updateWorkerLayers=function(h,y){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(h),removedIds:y})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(h){var y=this;if(this._checkLoaded(),Ns(this,_.validateStyle(h)))return!1;(h=_.clone$1(h)).layers=Cn(h.layers);var C=function(L,B){if(!L)return[{command:se.setStyle,args:[B]}];var Y=[];try{if(!_.deepEqual(L.version,B.version))return[{command:se.setStyle,args:[B]}];_.deepEqual(L.center,B.center)||Y.push({command:se.setCenter,args:[B.center]}),_.deepEqual(L.zoom,B.zoom)||Y.push({command:se.setZoom,args:[B.zoom]}),_.deepEqual(L.bearing,B.bearing)||Y.push({command:se.setBearing,args:[B.bearing]}),_.deepEqual(L.pitch,B.pitch)||Y.push({command:se.setPitch,args:[B.pitch]}),_.deepEqual(L.sprite,B.sprite)||Y.push({command:se.setSprite,args:[B.sprite]}),_.deepEqual(L.glyphs,B.glyphs)||Y.push({command:se.setGlyphs,args:[B.glyphs]}),_.deepEqual(L.transition,B.transition)||Y.push({command:se.setTransition,args:[B.transition]}),_.deepEqual(L.light,B.light)||Y.push({command:se.setLight,args:[B.light]});var ae={},Ce=[];(function(ke,Qe,Ye,mt){var je;for(je in Qe=Qe||{},ke=ke||{})ke.hasOwnProperty(je)&&(Qe.hasOwnProperty(je)||Fn(je,Ye,mt));for(je in Qe)Qe.hasOwnProperty(je)&&(ke.hasOwnProperty(je)?_.deepEqual(ke[je],Qe[je])||(ke[je].type==="geojson"&&Qe[je].type==="geojson"&&$a(ke,Qe,je)?Ye.push({command:se.setGeoJSONSourceData,args:[je,Qe[je].data]}):ta(je,Qe,Ye,mt)):Yi(je,Qe,Ye))})(L.sources,B.sources,Ce,ae);var we=[];L.layers&&L.layers.forEach(function(ke){ae[ke.source]?Y.push({command:se.removeLayer,args:[ke.id]}):we.push(ke)}),Y=Y.concat(Ce),function(ke,Qe,Ye){Qe=Qe||[];var mt,je,dt,vt,$t,Sr,yr,wr=(ke=ke||[]).map(pa),Xr=Qe.map(pa),yn=ke.reduce(Xi,{}),ln=Qe.reduce(Xi,{}),Bn=wr.slice(),ei=Object.create(null);for(mt=0,je=0;mt<wr.length;mt++)ln.hasOwnProperty(dt=wr[mt])?je++:(Ye.push({command:se.removeLayer,args:[dt]}),Bn.splice(Bn.indexOf(dt,je),1));for(mt=0,je=0;mt<Xr.length;mt++)Bn[Bn.length-1-mt]!==(dt=Xr[Xr.length-1-mt])&&(yn.hasOwnProperty(dt)?(Ye.push({command:se.removeLayer,args:[dt]}),Bn.splice(Bn.lastIndexOf(dt,Bn.length-je),1)):je++,Ye.push({command:se.addLayer,args:[ln[dt],Sr=Bn[Bn.length-mt]]}),Bn.splice(Bn.length-mt,0,dt),ei[dt]=!0);for(mt=0;mt<Xr.length;mt++)if(vt=yn[dt=Xr[mt]],$t=ln[dt],!ei[dt]&&!_.deepEqual(vt,$t))if(_.deepEqual(vt.source,$t.source)&&_.deepEqual(vt["source-layer"],$t["source-layer"])&&_.deepEqual(vt.type,$t.type)){for(yr in ra(vt.layout,$t.layout,Ye,dt,null,se.setLayoutProperty),ra(vt.paint,$t.paint,Ye,dt,null,se.setPaintProperty),_.deepEqual(vt.filter,$t.filter)||Ye.push({command:se.setFilter,args:[dt,$t.filter]}),_.deepEqual(vt.minzoom,$t.minzoom)&&_.deepEqual(vt.maxzoom,$t.maxzoom)||Ye.push({command:se.setLayerZoomRange,args:[dt,$t.minzoom,$t.maxzoom]}),vt)vt.hasOwnProperty(yr)&&yr!=="layout"&&yr!=="paint"&&yr!=="filter"&&yr!=="metadata"&&yr!=="minzoom"&&yr!=="maxzoom"&&(yr.indexOf("paint.")===0?ra(vt[yr],$t[yr],Ye,dt,yr.slice(6),se.setPaintProperty):_.deepEqual(vt[yr],$t[yr])||Ye.push({command:se.setLayerProperty,args:[dt,yr,$t[yr]]}));for(yr in $t)$t.hasOwnProperty(yr)&&!vt.hasOwnProperty(yr)&&yr!=="layout"&&yr!=="paint"&&yr!=="filter"&&yr!=="metadata"&&yr!=="minzoom"&&yr!=="maxzoom"&&(yr.indexOf("paint.")===0?ra(vt[yr],$t[yr],Ye,dt,yr.slice(6),se.setPaintProperty):_.deepEqual(vt[yr],$t[yr])||Ye.push({command:se.setLayerProperty,args:[dt,yr,$t[yr]]}))}else Ye.push({command:se.removeLayer,args:[dt]}),Sr=Bn[Bn.lastIndexOf(dt)+1],Ye.push({command:se.addLayer,args:[$t,Sr]})}(we,B.layers,Y)}catch(ke){console.warn("Unable to compute style diff:",ke),Y=[{command:se.setStyle,args:[B]}]}return Y}(this.serialize(),h).filter(function(L){return!(L.command in _u)});if(C.length===0)return!1;var I=C.filter(function(L){return!(L.command in yu)});if(I.length>0)throw new Error("Unimplemented: "+I.map(function(L){return L.command}).join(", ")+".");return C.forEach(function(L){L.command!=="setTransition"&&y[L.command].apply(y,L.args)}),this.stylesheet=h,!0},d.prototype.addImage=function(h,y){if(this.getImage(h))return this.fire(new _.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(h,y),this._afterImageUpdated(h)},d.prototype.updateImage=function(h,y){this.imageManager.updateImage(h,y)},d.prototype.getImage=function(h){return this.imageManager.getImage(h)},d.prototype.removeImage=function(h){if(!this.getImage(h))return this.fire(new _.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(h),this._afterImageUpdated(h)},d.prototype._afterImageUpdated=function(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new _.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(h,y,C){var I=this;if(C===void 0&&(C={}),this._checkLoaded(),this.sourceCaches[h]!==void 0)throw new Error("There is already a source with this ID");if(!y.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(y).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(y.type)>=0&&this._validate(_.validateStyle.source,"sources."+h,y,null,C))){this.map&&this.map._collectResourceTiming&&(y.collectResourceTiming=!0);var L=this.sourceCaches[h]=new Je(h,y,this.dispatcher);L.style=this,L.setEventedParent(this,function(){return{isSourceLoaded:I.loaded(),source:L.serialize(),sourceId:h}}),L.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(h){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error("There is no source with this ID");for(var y in this._layers)if(this._layers[y].source===h)return this.fire(new _.ErrorEvent(new Error('Source "'+h+'" cannot be removed while layer "'+y+'" is using it.')));var C=this.sourceCaches[h];delete this.sourceCaches[h],delete this._updatedSources[h],C.fire(new _.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:h})),C.setEventedParent(null),C.clearTiles(),C.onRemove&&C.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(h,y){this._checkLoaded(),this.sourceCaches[h].getSource().setData(y),this._changed=!0},d.prototype.getSource=function(h){return this.sourceCaches[h]&&this.sourceCaches[h].getSource()},d.prototype.addLayer=function(h,y,C){C===void 0&&(C={}),this._checkLoaded();var I=h.id;if(this.getLayer(I))this.fire(new _.ErrorEvent(new Error('Layer with id "'+I+'" already exists on this map')));else{var L;if(h.type==="custom"){if(Ns(this,_.validateCustomStyleLayer(h)))return;L=_.createStyleLayer(h)}else{if(typeof h.source=="object"&&(this.addSource(I,h.source),h=_.clone$1(h),h=_.extend(h,{source:I})),this._validate(_.validateStyle.layer,"layers."+I,h,{arrayIndex:-1},C))return;L=_.createStyleLayer(h),this._validateLayer(L),L.setEventedParent(this,{layer:{id:I}}),this._serializedLayers[L.id]=L.serialize()}var B=y?this._order.indexOf(y):this._order.length;if(y&&B===-1)this.fire(new _.ErrorEvent(new Error('Layer with id "'+y+'" does not exist on this map.')));else{if(this._order.splice(B,0,I),this._layerOrderChanged=!0,this._layers[I]=L,this._removedLayers[I]&&L.source&&L.type!=="custom"){var Y=this._removedLayers[I];delete this._removedLayers[I],Y.type!==L.type?this._updatedSources[L.source]="clear":(this._updatedSources[L.source]="reload",this.sourceCaches[L.source].pause())}this._updateLayer(L),L.onAdd&&L.onAdd(this.map)}}},d.prototype.moveLayer=function(h,y){if(this._checkLoaded(),this._changed=!0,this._layers[h]){if(h!==y){var C=this._order.indexOf(h);this._order.splice(C,1);var I=y?this._order.indexOf(y):this._order.length;y&&I===-1?this.fire(new _.ErrorEvent(new Error('Layer with id "'+y+'" does not exist on this map.'))):(this._order.splice(I,0,h),this._layerOrderChanged=!0)}}else this.fire(new _.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(h){this._checkLoaded();var y=this._layers[h];if(y){y.setEventedParent(null);var C=this._order.indexOf(h);this._order.splice(C,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=y,delete this._layers[h],delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],y.onRemove&&y.onRemove(this.map)}else this.fire(new _.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(h){return this._layers[h]},d.prototype.hasLayer=function(h){return h in this._layers},d.prototype.setLayerZoomRange=function(h,y,C){this._checkLoaded();var I=this.getLayer(h);I?I.minzoom===y&&I.maxzoom===C||(y!=null&&(I.minzoom=y),C!=null&&(I.maxzoom=C),this._updateLayer(I)):this.fire(new _.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(h,y,C){C===void 0&&(C={}),this._checkLoaded();var I=this.getLayer(h);if(I){if(!_.deepEqual(I.filter,y))return y==null?(I.filter=void 0,void this._updateLayer(I)):void(this._validate(_.validateStyle.filter,"layers."+I.id+".filter",y,null,C)||(I.filter=_.clone$1(y),this._updateLayer(I)))}else this.fire(new _.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(h){return _.clone$1(this.getLayer(h).filter)},d.prototype.setLayoutProperty=function(h,y,C,I){I===void 0&&(I={}),this._checkLoaded();var L=this.getLayer(h);L?_.deepEqual(L.getLayoutProperty(y),C)||(L.setLayoutProperty(y,C,I),this._updateLayer(L)):this.fire(new _.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(h,y){var C=this.getLayer(h);if(C)return C.getLayoutProperty(y);this.fire(new _.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(h,y,C,I){I===void 0&&(I={}),this._checkLoaded();var L=this.getLayer(h);L?_.deepEqual(L.getPaintProperty(y),C)||(L.setPaintProperty(y,C,I)&&this._updateLayer(L),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new _.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(h,y){return this.getLayer(h).getPaintProperty(y)},d.prototype.setFeatureState=function(h,y){this._checkLoaded();var C=h.source,I=h.sourceLayer,L=this.sourceCaches[C];if(L!==void 0){var B=L.getSource().type;B==="geojson"&&I?this.fire(new _.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):B!=="vector"||I?(h.id===void 0&&this.fire(new _.ErrorEvent(new Error("The feature id parameter must be provided."))),L.setFeatureState(I,h.id,y)):this.fire(new _.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new _.ErrorEvent(new Error("The source '"+C+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(h,y){this._checkLoaded();var C=h.source,I=this.sourceCaches[C];if(I!==void 0){var L=I.getSource().type,B=L==="vector"?h.sourceLayer:void 0;L!=="vector"||B?y&&typeof h.id!="string"&&typeof h.id!="number"?this.fire(new _.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):I.removeFeatureState(B,h.id,y):this.fire(new _.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new _.ErrorEvent(new Error("The source '"+C+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(h){this._checkLoaded();var y=h.source,C=h.sourceLayer,I=this.sourceCaches[y];if(I!==void 0){if(I.getSource().type!=="vector"||C)return h.id===void 0&&this.fire(new _.ErrorEvent(new Error("The feature id parameter must be provided."))),I.getFeatureState(C,h.id);this.fire(new _.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new _.ErrorEvent(new Error("The source '"+y+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return _.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return _.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:_.mapObject(this.sourceCaches,function(h){return h.serialize()}),layers:this._serializeLayers(this._order)},function(h){return h!==void 0})},d.prototype._updateLayer=function(h){this._updatedLayers[h.id]=!0,h.source&&!this._updatedSources[h.source]&&this.sourceCaches[h.source].getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(h){for(var y=this,C=function(yn){return y._layers[yn].type==="fill-extrusion"},I={},L=[],B=this._order.length-1;B>=0;B--){var Y=this._order[B];if(C(Y)){I[Y]=B;for(var ae=0,Ce=h;ae<Ce.length;ae+=1){var we=Ce[ae][Y];if(we)for(var ke=0,Qe=we;ke<Qe.length;ke+=1)L.push(Qe[ke])}}}L.sort(function(yn,ln){return ln.intersectionZ-yn.intersectionZ});for(var Ye=[],mt=this._order.length-1;mt>=0;mt--){var je=this._order[mt];if(C(je))for(var dt=L.length-1;dt>=0;dt--){var vt=L[dt].feature;if(I[vt.layer.id]<mt)break;Ye.push(vt),L.pop()}else for(var $t=0,Sr=h;$t<Sr.length;$t+=1){var yr=Sr[$t][je];if(yr)for(var wr=0,Xr=yr;wr<Xr.length;wr+=1)Ye.push(Xr[wr].feature)}}return Ye},d.prototype.queryRenderedFeatures=function(h,y,C){y&&y.filter&&this._validate(_.validateStyle.filter,"queryRenderedFeatures.filter",y.filter,null,y);var I={};if(y&&y.layers){if(!Array.isArray(y.layers))return this.fire(new _.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var L=0,B=y.layers;L<B.length;L+=1){var Y=B[L],ae=this._layers[Y];if(!ae)return this.fire(new _.ErrorEvent(new Error("The layer '"+Y+"' does not exist in the map's style and cannot be queried for features."))),[];I[ae.source]=!0}}var Ce=[];for(var we in y.availableImages=this._availableImages,this.sourceCaches)y.layers&&!I[we]||Ce.push(Kr(this.sourceCaches[we],this._layers,this._serializedLayers,h,y,C));return this.placement&&Ce.push(function(ke,Qe,Ye,mt,je,dt,vt){for(var $t={},Sr=dt.queryRenderedSymbols(mt),yr=[],wr=0,Xr=Object.keys(Sr).map(Number);wr<Xr.length;wr+=1)yr.push(vt[Xr[wr]]);yr.sort(si);for(var yn=function(){var gi=Bn[ln],Ki=gi.featureIndex.lookupSymbolFeatures(Sr[gi.bucketInstanceId],Qe,gi.bucketIndex,gi.sourceLayerIndex,je.filter,je.layers,je.availableImages,ke);for(var Nn in Ki){var Hi=$t[Nn]=$t[Nn]||[],Qi=Ki[Nn];Qi.sort(function(ia,Ii){var wi=gi.featureSortOrder;if(wi){var cs=wi.indexOf(ia.featureIndex);return wi.indexOf(Ii.featureIndex)-cs}return Ii.featureIndex-ia.featureIndex});for(var Li=0,yi=Qi;Li<yi.length;Li+=1)Hi.push(yi[Li])}},ln=0,Bn=yr;ln<Bn.length;ln+=1)yn();var ei=function(gi){$t[gi].forEach(function(Ki){var Nn=Ki.feature,Hi=Ye[ke[gi].source].getFeatureState(Nn.layer["source-layer"],Nn.id);Nn.source=Nn.layer.source,Nn.layer["source-layer"]&&(Nn.sourceLayer=Nn.layer["source-layer"]),Nn.state=Hi})};for(var _i in $t)ei(_i);return $t}(this._layers,this._serializedLayers,this.sourceCaches,h,y,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(Ce)},d.prototype.querySourceFeatures=function(h,y){y&&y.filter&&this._validate(_.validateStyle.filter,"querySourceFeatures.filter",y.filter,null,y);var C=this.sourceCaches[h];return C?function(I,L){for(var B=I.getRenderableIds().map(function(Qe){return I.getTileByID(Qe)}),Y=[],ae={},Ce=0;Ce<B.length;Ce++){var we=B[Ce],ke=we.tileID.canonical.key;ae[ke]||(ae[ke]=!0,we.querySourceFeatures(Y,L))}return Y}(C,y):[]},d.prototype.addSourceType=function(h,y,C){return d.getSourceType(h)?C(new Error('A source type called "'+h+'" already exists.')):(d.setSourceType(h,y),y.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:y.workerSourceURL},C):C(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(h,y){y===void 0&&(y={}),this._checkLoaded();var C=this.light.getLight(),I=!1;for(var L in h)if(!_.deepEqual(h[L],C[L])){I=!0;break}if(I){var B={now:_.browser.now(),transition:_.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(h,y),this.light.updateTransitions(B)}},d.prototype._validate=function(h,y,C,I,L){return L===void 0&&(L={}),(!L||L.validate!==!1)&&Ns(this,h.call(_.validateStyle,_.extend({key:y,style:this.serialize(),value:C,styleSpec:_.styleSpec},I)))},d.prototype._remove=function(){for(var h in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),_.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[h].setEventedParent(null);for(var y in this.sourceCaches)this.sourceCaches[y].clearTiles(),this.sourceCaches[y].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(h){this.sourceCaches[h].clearTiles()},d.prototype._reloadSource=function(h){this.sourceCaches[h].resume(),this.sourceCaches[h].reload()},d.prototype._updateSources=function(h){for(var y in this.sourceCaches)this.sourceCaches[y].update(h)},d.prototype._generateCollisionBoxes=function(){for(var h in this.sourceCaches)this._reloadSource(h)},d.prototype._updatePlacement=function(h,y,C,I,L){L===void 0&&(L=!1);for(var B=!1,Y=!1,ae={},Ce=0,we=this._order;Ce<we.length;Ce+=1){var ke=this._layers[we[Ce]];if(ke.type==="symbol"){if(!ae[ke.source]){var Qe=this.sourceCaches[ke.source];ae[ke.source]=Qe.getRenderableIds(!0).map(function(vt){return Qe.getTileByID(vt)}).sort(function(vt,$t){return $t.tileID.overscaledZ-vt.tileID.overscaledZ||(vt.tileID.isLessThan($t.tileID)?-1:1)})}var Ye=this.crossTileSymbolIndex.addLayer(ke,ae[ke.source],h.center.lng);B=B||Ye}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((L=L||this._layerOrderChanged||C===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(_.browser.now(),h.zoom))&&(this.pauseablePlacement=new Fr(h,this._order,L,y,C,I,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ae),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(_.browser.now()),Y=!0),B&&this.pauseablePlacement.placement.setStale()),Y||B)for(var mt=0,je=this._order;mt<je.length;mt+=1){var dt=this._layers[je[mt]];dt.type==="symbol"&&this.placement.updateLayerOpacities(dt,ae[dt.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(_.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var h in this.sourceCaches)this.sourceCaches[h].releaseSymbolFadeTiles()},d.prototype.getImages=function(h,y,C){this.imageManager.getImages(y.icons,C),this._updateTilesForChangedImages();var I=this.sourceCaches[y.source];I&&I.setDependencies(y.tileID.key,y.type,y.icons)},d.prototype.getGlyphs=function(h,y,C){this.glyphManager.getGlyphs(y.stacks,C)},d.prototype.getResource=function(h,y,C){return _.makeRequest(y,C)},d}(_.Evented);Mu.getSourceType=function(f){return pr[f]},Mu.setSourceType=function(f,d){pr[f]=d},Mu.registerForPluginStateChange=_.registerForPluginStateChange;var lo=_.createLayout([{name:"a_pos",type:"Int16",components:2}]),xa=Sa(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),mo=Sa(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Wf=Sa(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ks=Sa(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Xf=Sa("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Jc=Sa(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Il=Sa(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ke=Sa("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Rc=Sa("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),S=Sa("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),R=Sa(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),W=Sa(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),F=Sa(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ue=Sa(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),De=Sa(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),ft=Sa(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Gt=Sa(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Wt=Sa(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Or=Sa(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),en=Sa(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ci=Sa(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Gi=Sa(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),vi=Sa(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ka=Sa(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ha=Sa(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),So=Sa(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Sa(f,d){var h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=d.match(/attribute ([\w]+) ([\w]+)/g),C=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),L=I?I.concat(C):C,B={};return{fragmentSource:f=f.replace(h,function(Y,ae,Ce,we,ke){return B[ke]=!0,ae==="define"?`
#ifndef HAS_UNIFORM_u_`+ke+`
varying `+Ce+" "+we+" "+ke+`;
#else
uniform `+Ce+" "+we+" u_"+ke+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+ke+`
    `+Ce+" "+we+" "+ke+" = u_"+ke+`;
#endif
`}),vertexSource:d=d.replace(h,function(Y,ae,Ce,we,ke){var Qe=we==="float"?"vec2":"vec4",Ye=ke.match(/color/)?"color":Qe;return B[ke]?ae==="define"?`
#ifndef HAS_UNIFORM_u_`+ke+`
uniform lowp float u_`+ke+`_t;
attribute `+Ce+" "+Qe+" a_"+ke+`;
varying `+Ce+" "+we+" "+ke+`;
#else
uniform `+Ce+" "+we+" u_"+ke+`;
#endif
`:Ye==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ke+`
    `+ke+" = a_"+ke+`;
#else
    `+Ce+" "+we+" "+ke+" = u_"+ke+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ke+`
    `+ke+" = unpack_mix_"+Ye+"(a_"+ke+", u_"+ke+`_t);
#else
    `+Ce+" "+we+" "+ke+" = u_"+ke+`;
#endif
`:ae==="define"?`
#ifndef HAS_UNIFORM_u_`+ke+`
uniform lowp float u_`+ke+`_t;
attribute `+Ce+" "+Qe+" a_"+ke+`;
#else
uniform `+Ce+" "+we+" u_"+ke+`;
#endif
`:Ye==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ke+`
    `+Ce+" "+we+" "+ke+" = a_"+ke+`;
#else
    `+Ce+" "+we+" "+ke+" = u_"+ke+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ke+`
    `+Ce+" "+we+" "+ke+" = unpack_mix_"+Ye+"(a_"+ke+", u_"+ke+`_t);
#else
    `+Ce+" "+we+" "+ke+" = u_"+ke+`;
#endif
`}),staticAttributes:y,staticUniforms:L}}var Ho=Object.freeze({__proto__:null,prelude:xa,background:mo,backgroundPattern:Wf,circle:Ks,clippingMask:Xf,heatmap:Jc,heatmapTexture:Il,collisionBox:Ke,collisionCircle:Rc,debug:S,fill:R,fillOutline:W,fillOutlinePattern:F,fillPattern:ue,fillExtrusion:De,fillExtrusionPattern:ft,hillshadePrepare:Gt,hillshade:Wt,line:Or,lineGradient:en,linePattern:ci,lineSDF:Gi,raster:vi,symbolIcon:ka,symbolSDF:ha,symbolTextAndIcon:So}),xu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function hl(f){for(var d=[],h=0;h<f.length;h++)if(f[h]!==null){var y=f[h].split(" ");d.push(y.pop())}return d}xu.prototype.bind=function(f,d,h,y,C,I,L,B){this.context=f;for(var Y=this.boundPaintVertexBuffers.length!==y.length,ae=0;!Y&&ae<y.length;ae++)this.boundPaintVertexBuffers[ae]!==y[ae]&&(Y=!0);f.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===h&&!Y&&this.boundIndexBuffer===C&&this.boundVertexOffset===I&&this.boundDynamicVertexBuffer===L&&this.boundDynamicVertexBuffer2===B?(f.bindVertexArrayOES.set(this.vao),L&&L.bind(),C&&C.dynamicDraw&&C.bind(),B&&B.bind()):this.freshBind(d,h,y,C,I,L,B)},xu.prototype.freshBind=function(f,d,h,y,C,I,L){var B,Y=f.numAttributes,ae=this.context,Ce=ae.gl;if(ae.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ae.extVertexArrayObject.createVertexArrayOES(),ae.bindVertexArrayOES.set(this.vao),B=0,this.boundProgram=f,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=y,this.boundVertexOffset=C,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=L;else{B=ae.currentNumAttributes||0;for(var we=Y;we<B;we++)Ce.disableVertexAttribArray(we)}d.enableAttributes(Ce,f);for(var ke=0,Qe=h;ke<Qe.length;ke+=1)Qe[ke].enableAttributes(Ce,f);I&&I.enableAttributes(Ce,f),L&&L.enableAttributes(Ce,f),d.bind(),d.setVertexAttribPointers(Ce,f,C);for(var Ye=0,mt=h;Ye<mt.length;Ye+=1){var je=mt[Ye];je.bind(),je.setVertexAttribPointers(Ce,f,C)}I&&(I.bind(),I.setVertexAttribPointers(Ce,f,C)),y&&y.bind(),L&&(L.bind(),L.setVertexAttribPointers(Ce,f,C)),ae.currentNumAttributes=Y},xu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var No=function(f,d,h,y,C,I){var L=f.gl;this.program=L.createProgram();for(var B=hl(h.staticAttributes),Y=y?y.getBinderAttributes():[],ae=B.concat(Y),Ce=h.staticUniforms?hl(h.staticUniforms):[],we=y?y.getBinderUniforms():[],ke=[],Qe=0,Ye=Ce.concat(we);Qe<Ye.length;Qe+=1){var mt=Ye[Qe];ke.indexOf(mt)<0&&ke.push(mt)}var je=y?y.defines():[];I&&je.push("#define OVERDRAW_INSPECTOR;");var dt=je.concat(xa.fragmentSource,h.fragmentSource).join(`
`),vt=je.concat(xa.vertexSource,h.vertexSource).join(`
`),$t=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())this.failedToCreate=!0;else{L.shaderSource($t,dt),L.compileShader($t),L.attachShader(this.program,$t);var Sr=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())this.failedToCreate=!0;else{L.shaderSource(Sr,vt),L.compileShader(Sr),L.attachShader(this.program,Sr),this.attributes={};var yr={};this.numAttributes=ae.length;for(var wr=0;wr<this.numAttributes;wr++)ae[wr]&&(L.bindAttribLocation(this.program,wr,ae[wr]),this.attributes[ae[wr]]=wr);L.linkProgram(this.program),L.deleteShader(Sr),L.deleteShader($t);for(var Xr=0;Xr<ke.length;Xr++){var yn=ke[Xr];if(yn&&!yr[yn]){var ln=L.getUniformLocation(this.program,yn);ln&&(yr[yn]=ln)}}this.fixedUniforms=C(f,yr),this.binderUniforms=y?y.getUniforms(f,yr):[]}}};function Iu(f,d,h){var y=1/Va(h,1,d.transform.tileZoom),C=Math.pow(2,h.tileID.overscaledZ),I=h.tileSize*Math.pow(2,d.transform.tileZoom)/C,L=I*(h.tileID.canonical.x+h.tileID.wrap*C),B=I*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[y,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[L>>16,B>>16],u_pixel_coord_lower:[65535&L,65535&B]}}No.prototype.draw=function(f,d,h,y,C,I,L,B,Y,ae,Ce,we,ke,Qe,Ye,mt){var je,dt=f.gl;if(!this.failedToCreate){for(var vt in f.program.set(this.program),f.setDepthMode(h),f.setStencilMode(y),f.setColorMode(C),f.setCullFace(I),this.fixedUniforms)this.fixedUniforms[vt].set(L[vt]);Qe&&Qe.setUniforms(f,this.binderUniforms,we,{zoom:ke});for(var $t=(je={},je[dt.LINES]=2,je[dt.TRIANGLES]=3,je[dt.LINE_STRIP]=1,je)[d],Sr=0,yr=Ce.get();Sr<yr.length;Sr+=1){var wr=yr[Sr],Xr=wr.vaos||(wr.vaos={});(Xr[B]||(Xr[B]=new xu)).bind(f,this,Y,Qe?Qe.getPaintVertexBuffers():[],ae,wr.vertexOffset,Ye,mt),dt.drawElements(d,wr.primitiveLength*$t,dt.UNSIGNED_SHORT,wr.primitiveOffset*$t*2)}}};var ef=function(f,d,h,y){var C=d.style.light,I=C.properties.get("position"),L=[I.x,I.y,I.z],B=_.create$1();C.properties.get("anchor")==="viewport"&&_.fromRotation(B,-d.transform.angle),_.transformMat3(L,L,B);var Y=C.properties.get("color");return{u_matrix:f,u_lightpos:L,u_lightintensity:C.properties.get("intensity"),u_lightcolor:[Y.r,Y.g,Y.b],u_vertical_gradient:+h,u_opacity:y}},ql=function(f,d,h,y,C,I,L){return _.extend(ef(f,d,h,y),Iu(I,d,L),{u_height_factor:-Math.pow(2,C.overscaledZ)/L.tileSize/8})},kl=function(f){return{u_matrix:f}},Kl=function(f,d,h,y){return _.extend(kl(f),Iu(h,d,y))},ts=function(f,d){return{u_matrix:f,u_world:d}},Hh=function(f,d,h,y,C){return _.extend(Kl(f,d,h,y),{u_world:C})},Sh=function(f,d,h,y){var C,I,L=f.transform;if(y.paint.get("circle-pitch-alignment")==="map"){var B=Va(h,1,L.zoom);C=!0,I=[B,B]}else C=!1,I=L.pixelsToGLUnits;return{u_camera_to_center_distance:L.cameraToCenterDistance,u_scale_with_map:+(y.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(d.posMatrix,h,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_pitch_with_map:+C,u_device_pixel_ratio:_.browser.devicePixelRatio,u_extrude_scale:I}},us=function(f,d,h){var y=Va(h,1,d.zoom),C=Math.pow(2,d.zoom-h.tileID.overscaledZ),I=h.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:d.cameraToCenterDistance,u_pixels_to_tile_units:y,u_extrude_scale:[d.pixelsToGLUnits[0]/(y*C),d.pixelsToGLUnits[1]/(y*C)],u_overscale_factor:I}},el=function(f,d,h){return{u_matrix:f,u_inv_matrix:d,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}},Ql=function(f,d,h){return h===void 0&&(h=1),{u_matrix:f,u_color:d,u_overlay:0,u_overlay_scale:h}},tl=function(f){return{u_matrix:f}},kf=function(f,d,h,y){return{u_matrix:f,u_extrude_scale:Va(d,1,h),u_intensity:y}},Jl=function(f,d,h){var y=f.transform;return{u_matrix:wh(f,d,h),u_ratio:1/Va(d,1,y.zoom),u_device_pixel_ratio:_.browser.devicePixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},oo=function(f,d,h,y){return _.extend(Jl(f,d,h),{u_image:0,u_image_height:y})},vc=function(f,d,h,y){var C=f.transform,I=zs(d,C);return{u_matrix:wh(f,d,h),u_texsize:d.imageAtlasTexture.size,u_ratio:1/Va(d,1,C.zoom),u_device_pixel_ratio:_.browser.devicePixelRatio,u_image:0,u_scale:[I,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]]}},rl=function(f,d,h,y,C){var I=f.lineAtlas,L=zs(d,f.transform),B=h.layout.get("line-cap")==="round",Y=I.getDash(y.from,B),ae=I.getDash(y.to,B),Ce=Y.width*C.fromScale,we=ae.width*C.toScale;return _.extend(Jl(f,d,h),{u_patternscale_a:[L/Ce,-Y.height/2],u_patternscale_b:[L/we,-ae.height/2],u_sdfgamma:I.width/(256*Math.min(Ce,we)*_.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:Y.y,u_tex_y_b:ae.y,u_mix:C.t})};function zs(f,d){return 1/Va(f,1,d.tileZoom)}function wh(f,d,h){return f.translatePosMatrix(d.tileID.posMatrix,d,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}var dd=function(f,d,h,y,C){return{u_matrix:f,u_tl_parent:d,u_scale_parent:h,u_buffer_scale:1,u_fade_t:y.mix,u_opacity:y.opacity*C.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:C.paint.get("raster-brightness-min"),u_brightness_high:C.paint.get("raster-brightness-max"),u_saturation_factor:(L=C.paint.get("raster-saturation"),L>0?1-1/(1.001-L):-L),u_contrast_factor:(I=C.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:Zl(C.paint.get("raster-hue-rotate"))};var I,L};function Zl(f){f*=Math.PI/180;var d=Math.sin(f),h=Math.cos(f);return[(2*h+1)/3,(-Math.sqrt(3)*d-h+1)/3,(Math.sqrt(3)*d-h+1)/3]}var Fu,mc=function(f,d,h,y,C,I,L,B,Y,ae){var Ce=C.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:Ce.cameraToCenterDistance,u_pitch:Ce.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:Ce.width/Ce.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_matrix:I,u_label_plane_matrix:L,u_coord_matrix:B,u_is_text:+Y,u_pitch_with_map:+y,u_texsize:ae,u_texture:0}},Pl=function(f,d,h,y,C,I,L,B,Y,ae,Ce){var we=C.transform;return _.extend(mc(f,d,h,y,C,I,L,B,Y,ae),{u_gamma_scale:y?Math.cos(we._pitch)*we.cameraToCenterDistance:1,u_device_pixel_ratio:_.browser.devicePixelRatio,u_is_halo:+Ce})},gc=function(f,d,h,y,C,I,L,B,Y,ae){return _.extend(Pl(f,d,h,y,C,I,L,B,!0,Y,!0),{u_texsize_icon:ae,u_texture_icon:1})},Lc=function(f,d,h){return{u_matrix:f,u_opacity:d,u_color:h}},Oc=function(f,d,h,y,C,I){return _.extend(function(L,B,Y,ae){var Ce=Y.imageManager.getPattern(L.from.toString()),we=Y.imageManager.getPattern(L.to.toString()),ke=Y.imageManager.getPixelSize(),Qe=ke.width,Ye=ke.height,mt=Math.pow(2,ae.tileID.overscaledZ),je=ae.tileSize*Math.pow(2,Y.transform.tileZoom)/mt,dt=je*(ae.tileID.canonical.x+ae.tileID.wrap*mt),vt=je*ae.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Ce.tl,u_pattern_br_a:Ce.br,u_pattern_tl_b:we.tl,u_pattern_br_b:we.br,u_texsize:[Qe,Ye],u_mix:B.t,u_pattern_size_a:Ce.displaySize,u_pattern_size_b:we.displaySize,u_scale_a:B.fromScale,u_scale_b:B.toScale,u_tile_units_to_pixels:1/Va(ae,1,Y.transform.tileZoom),u_pixel_coord_upper:[dt>>16,vt>>16],u_pixel_coord_lower:[65535&dt,65535&vt]}}(y,I,h,C),{u_matrix:f,u_opacity:d})},tf={fillExtrusion:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_lightpos:new _.Uniform3f(f,d.u_lightpos),u_lightintensity:new _.Uniform1f(f,d.u_lightintensity),u_lightcolor:new _.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new _.Uniform1f(f,d.u_vertical_gradient),u_opacity:new _.Uniform1f(f,d.u_opacity)}},fillExtrusionPattern:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_lightpos:new _.Uniform3f(f,d.u_lightpos),u_lightintensity:new _.Uniform1f(f,d.u_lightintensity),u_lightcolor:new _.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new _.Uniform1f(f,d.u_vertical_gradient),u_height_factor:new _.Uniform1f(f,d.u_height_factor),u_image:new _.Uniform1i(f,d.u_image),u_texsize:new _.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new _.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new _.Uniform3f(f,d.u_scale),u_fade:new _.Uniform1f(f,d.u_fade),u_opacity:new _.Uniform1f(f,d.u_opacity)}},fill:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix)}},fillPattern:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_image:new _.Uniform1i(f,d.u_image),u_texsize:new _.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new _.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new _.Uniform3f(f,d.u_scale),u_fade:new _.Uniform1f(f,d.u_fade)}},fillOutline:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_world:new _.Uniform2f(f,d.u_world)}},fillOutlinePattern:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_world:new _.Uniform2f(f,d.u_world),u_image:new _.Uniform1i(f,d.u_image),u_texsize:new _.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new _.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new _.Uniform3f(f,d.u_scale),u_fade:new _.Uniform1f(f,d.u_fade)}},circle:function(f,d){return{u_camera_to_center_distance:new _.Uniform1f(f,d.u_camera_to_center_distance),u_scale_with_map:new _.Uniform1i(f,d.u_scale_with_map),u_pitch_with_map:new _.Uniform1i(f,d.u_pitch_with_map),u_extrude_scale:new _.Uniform2f(f,d.u_extrude_scale),u_device_pixel_ratio:new _.Uniform1f(f,d.u_device_pixel_ratio),u_matrix:new _.UniformMatrix4f(f,d.u_matrix)}},collisionBox:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_camera_to_center_distance:new _.Uniform1f(f,d.u_camera_to_center_distance),u_pixels_to_tile_units:new _.Uniform1f(f,d.u_pixels_to_tile_units),u_extrude_scale:new _.Uniform2f(f,d.u_extrude_scale),u_overscale_factor:new _.Uniform1f(f,d.u_overscale_factor)}},collisionCircle:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_inv_matrix:new _.UniformMatrix4f(f,d.u_inv_matrix),u_camera_to_center_distance:new _.Uniform1f(f,d.u_camera_to_center_distance),u_viewport_size:new _.Uniform2f(f,d.u_viewport_size)}},debug:function(f,d){return{u_color:new _.UniformColor(f,d.u_color),u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_overlay:new _.Uniform1i(f,d.u_overlay),u_overlay_scale:new _.Uniform1f(f,d.u_overlay_scale)}},clippingMask:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix)}},heatmap:function(f,d){return{u_extrude_scale:new _.Uniform1f(f,d.u_extrude_scale),u_intensity:new _.Uniform1f(f,d.u_intensity),u_matrix:new _.UniformMatrix4f(f,d.u_matrix)}},heatmapTexture:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_world:new _.Uniform2f(f,d.u_world),u_image:new _.Uniform1i(f,d.u_image),u_color_ramp:new _.Uniform1i(f,d.u_color_ramp),u_opacity:new _.Uniform1f(f,d.u_opacity)}},hillshade:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_image:new _.Uniform1i(f,d.u_image),u_latrange:new _.Uniform2f(f,d.u_latrange),u_light:new _.Uniform2f(f,d.u_light),u_shadow:new _.UniformColor(f,d.u_shadow),u_highlight:new _.UniformColor(f,d.u_highlight),u_accent:new _.UniformColor(f,d.u_accent)}},hillshadePrepare:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_image:new _.Uniform1i(f,d.u_image),u_dimension:new _.Uniform2f(f,d.u_dimension),u_zoom:new _.Uniform1f(f,d.u_zoom),u_unpack:new _.Uniform4f(f,d.u_unpack)}},line:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_ratio:new _.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new _.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new _.Uniform2f(f,d.u_units_to_pixels)}},lineGradient:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_ratio:new _.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new _.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new _.Uniform2f(f,d.u_units_to_pixels),u_image:new _.Uniform1i(f,d.u_image),u_image_height:new _.Uniform1f(f,d.u_image_height)}},linePattern:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_texsize:new _.Uniform2f(f,d.u_texsize),u_ratio:new _.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new _.Uniform1f(f,d.u_device_pixel_ratio),u_image:new _.Uniform1i(f,d.u_image),u_units_to_pixels:new _.Uniform2f(f,d.u_units_to_pixels),u_scale:new _.Uniform3f(f,d.u_scale),u_fade:new _.Uniform1f(f,d.u_fade)}},lineSDF:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_ratio:new _.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new _.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new _.Uniform2f(f,d.u_units_to_pixels),u_patternscale_a:new _.Uniform2f(f,d.u_patternscale_a),u_patternscale_b:new _.Uniform2f(f,d.u_patternscale_b),u_sdfgamma:new _.Uniform1f(f,d.u_sdfgamma),u_image:new _.Uniform1i(f,d.u_image),u_tex_y_a:new _.Uniform1f(f,d.u_tex_y_a),u_tex_y_b:new _.Uniform1f(f,d.u_tex_y_b),u_mix:new _.Uniform1f(f,d.u_mix)}},raster:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_tl_parent:new _.Uniform2f(f,d.u_tl_parent),u_scale_parent:new _.Uniform1f(f,d.u_scale_parent),u_buffer_scale:new _.Uniform1f(f,d.u_buffer_scale),u_fade_t:new _.Uniform1f(f,d.u_fade_t),u_opacity:new _.Uniform1f(f,d.u_opacity),u_image0:new _.Uniform1i(f,d.u_image0),u_image1:new _.Uniform1i(f,d.u_image1),u_brightness_low:new _.Uniform1f(f,d.u_brightness_low),u_brightness_high:new _.Uniform1f(f,d.u_brightness_high),u_saturation_factor:new _.Uniform1f(f,d.u_saturation_factor),u_contrast_factor:new _.Uniform1f(f,d.u_contrast_factor),u_spin_weights:new _.Uniform3f(f,d.u_spin_weights)}},symbolIcon:function(f,d){return{u_is_size_zoom_constant:new _.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new _.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new _.Uniform1f(f,d.u_size_t),u_size:new _.Uniform1f(f,d.u_size),u_camera_to_center_distance:new _.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new _.Uniform1f(f,d.u_pitch),u_rotate_symbol:new _.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new _.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new _.Uniform1f(f,d.u_fade_change),u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new _.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new _.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new _.Uniform1i(f,d.u_is_text),u_pitch_with_map:new _.Uniform1i(f,d.u_pitch_with_map),u_texsize:new _.Uniform2f(f,d.u_texsize),u_texture:new _.Uniform1i(f,d.u_texture)}},symbolSDF:function(f,d){return{u_is_size_zoom_constant:new _.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new _.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new _.Uniform1f(f,d.u_size_t),u_size:new _.Uniform1f(f,d.u_size),u_camera_to_center_distance:new _.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new _.Uniform1f(f,d.u_pitch),u_rotate_symbol:new _.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new _.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new _.Uniform1f(f,d.u_fade_change),u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new _.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new _.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new _.Uniform1i(f,d.u_is_text),u_pitch_with_map:new _.Uniform1i(f,d.u_pitch_with_map),u_texsize:new _.Uniform2f(f,d.u_texsize),u_texture:new _.Uniform1i(f,d.u_texture),u_gamma_scale:new _.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new _.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new _.Uniform1i(f,d.u_is_halo)}},symbolTextAndIcon:function(f,d){return{u_is_size_zoom_constant:new _.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new _.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new _.Uniform1f(f,d.u_size_t),u_size:new _.Uniform1f(f,d.u_size),u_camera_to_center_distance:new _.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new _.Uniform1f(f,d.u_pitch),u_rotate_symbol:new _.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new _.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new _.Uniform1f(f,d.u_fade_change),u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new _.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new _.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new _.Uniform1i(f,d.u_is_text),u_pitch_with_map:new _.Uniform1i(f,d.u_pitch_with_map),u_texsize:new _.Uniform2f(f,d.u_texsize),u_texsize_icon:new _.Uniform2f(f,d.u_texsize_icon),u_texture:new _.Uniform1i(f,d.u_texture),u_texture_icon:new _.Uniform1i(f,d.u_texture_icon),u_gamma_scale:new _.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new _.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new _.Uniform1i(f,d.u_is_halo)}},background:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_opacity:new _.Uniform1f(f,d.u_opacity),u_color:new _.UniformColor(f,d.u_color)}},backgroundPattern:function(f,d){return{u_matrix:new _.UniformMatrix4f(f,d.u_matrix),u_opacity:new _.Uniform1f(f,d.u_opacity),u_image:new _.Uniform1i(f,d.u_image),u_pattern_tl_a:new _.Uniform2f(f,d.u_pattern_tl_a),u_pattern_br_a:new _.Uniform2f(f,d.u_pattern_br_a),u_pattern_tl_b:new _.Uniform2f(f,d.u_pattern_tl_b),u_pattern_br_b:new _.Uniform2f(f,d.u_pattern_br_b),u_texsize:new _.Uniform2f(f,d.u_texsize),u_mix:new _.Uniform1f(f,d.u_mix),u_pattern_size_a:new _.Uniform2f(f,d.u_pattern_size_a),u_pattern_size_b:new _.Uniform2f(f,d.u_pattern_size_b),u_scale_a:new _.Uniform1f(f,d.u_scale_a),u_scale_b:new _.Uniform1f(f,d.u_scale_b),u_pixel_coord_upper:new _.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(f,d.u_pixel_coord_lower),u_tile_units_to_pixels:new _.Uniform1f(f,d.u_tile_units_to_pixels)}}};function Rl(f,d,h,y,C,I,L){for(var B=f.context,Y=B.gl,ae=f.useProgram("collisionBox"),Ce=[],we=0,ke=0,Qe=0;Qe<y.length;Qe++){var Ye=y[Qe],mt=d.getTile(Ye),je=mt.getBucket(h);if(je){var dt=Ye.posMatrix;C[0]===0&&C[1]===0||(dt=f.translatePosMatrix(Ye.posMatrix,mt,C,I));var vt=L?je.textCollisionBox:je.iconCollisionBox,$t=je.collisionCircleArray;if($t.length>0){var Sr=_.create(),yr=dt;_.mul(Sr,je.placementInvProjMatrix,f.transform.glCoordMatrix),_.mul(Sr,Sr,je.placementViewportMatrix),Ce.push({circleArray:$t,circleOffset:ke,transform:yr,invTransform:Sr}),ke=we+=$t.length/4}vt&&ae.draw(B,Y.LINES,Re.disabled,He.disabled,f.colorModeForRenderPass(),At.disabled,us(dt,f.transform,mt),h.id,vt.layoutVertexBuffer,vt.indexBuffer,vt.segments,null,f.transform.zoom,null,null,vt.collisionVertexBuffer)}}if(L&&Ce.length){var wr=f.useProgram("collisionCircle"),Xr=new _.StructArrayLayout2f1f2i16;Xr.resize(4*we),Xr._trim();for(var yn=0,ln=0,Bn=Ce;ln<Bn.length;ln+=1)for(var ei=Bn[ln],_i=0;_i<ei.circleArray.length/4;_i++){var gi=4*_i,Ki=ei.circleArray[gi+0],Nn=ei.circleArray[gi+1],Hi=ei.circleArray[gi+2],Qi=ei.circleArray[gi+3];Xr.emplace(yn++,Ki,Nn,Hi,Qi,0),Xr.emplace(yn++,Ki,Nn,Hi,Qi,1),Xr.emplace(yn++,Ki,Nn,Hi,Qi,2),Xr.emplace(yn++,Ki,Nn,Hi,Qi,3)}(!Fu||Fu.length<2*we)&&(Fu=function(Po){var ro=2*Po,Ps=new _.StructArrayLayout3ui6;Ps.resize(ro),Ps._trim();for(var Zo=0;Zo<ro;Zo++){var wo=6*Zo;Ps.uint16[wo+0]=4*Zo+0,Ps.uint16[wo+1]=4*Zo+1,Ps.uint16[wo+2]=4*Zo+2,Ps.uint16[wo+3]=4*Zo+2,Ps.uint16[wo+4]=4*Zo+3,Ps.uint16[wo+5]=4*Zo+0}return Ps}(we));for(var Li=B.createIndexBuffer(Fu,!0),yi=B.createVertexBuffer(Xr,_.collisionCircleLayout.members,!0),ia=0,Ii=Ce;ia<Ii.length;ia+=1){var wi=Ii[ia],cs=el(wi.transform,wi.invTransform,f.transform);wr.draw(B,Y.TRIANGLES,Re.disabled,He.disabled,f.colorModeForRenderPass(),At.disabled,cs,h.id,yi,Li,_.SegmentVector.simpleSegment(0,2*wi.circleOffset,wi.circleArray.length,wi.circleArray.length/2),null,f.transform.zoom,null,null,null)}yi.destroy(),Li.destroy()}}var gs=_.identity(new Float32Array(16));function Ah(f,d,h,y,C,I){var L=_.getAnchorAlignment(f),B=-(L.horizontalAlign-.5)*d,Y=-(L.verticalAlign-.5)*h,ae=_.evaluateVariableOffset(f,y);return new _.Point((B/C+ae[0])*I,(Y/C+ae[1])*I)}function yc(f,d,h,y,C,I,L,B,Y,ae,Ce){var we=f.text.placedSymbolArray,ke=f.text.dynamicLayoutVertexArray,Qe=f.icon.dynamicLayoutVertexArray,Ye={};ke.clear();for(var mt=0;mt<we.length;mt++){var je=we.get(mt),dt=je.hidden||!je.crossTileID||f.allowVerticalPlacement&&!je.placedOrientation?null:y[je.crossTileID];if(dt){var vt=new _.Point(je.anchorX,je.anchorY),$t=fa(vt,h?B:L),Sr=na(I.cameraToCenterDistance,$t.signedDistanceFromCamera),yr=C.evaluateSizeForFeature(f.textSizeData,ae,je)*Sr/_.ONE_EM;h&&(yr*=f.tilePixelRatio/Y);for(var wr=Ah(dt.anchor,dt.width,dt.height,dt.textOffset,dt.textBoxScale,yr),Xr=h?fa(vt.add(wr),L).point:$t.point.add(d?wr.rotate(-I.angle):wr),yn=f.allowVerticalPlacement&&je.placedOrientation===_.WritingMode.vertical?Math.PI/2:0,ln=0;ln<je.numGlyphs;ln++)_.addDynamicAttributes(ke,Xr,yn);Ce&&je.associatedIconIndex>=0&&(Ye[je.associatedIconIndex]={shiftedAnchor:Xr,angle:yn})}else Xo(je.numGlyphs,ke)}if(Ce){Qe.clear();for(var Bn=f.icon.placedSymbolArray,ei=0;ei<Bn.length;ei++){var _i=Bn.get(ei);if(_i.hidden)Xo(_i.numGlyphs,Qe);else{var gi=Ye[ei];if(gi)for(var Ki=0;Ki<_i.numGlyphs;Ki++)_.addDynamicAttributes(Qe,gi.shiftedAnchor,gi.angle);else Xo(_i.numGlyphs,Qe)}}f.icon.dynamicLayoutVertexBuffer.updateData(Qe)}f.text.dynamicLayoutVertexBuffer.updateData(ke)}function Wh(f,d,h){return h.iconsInText&&d?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function ec(f,d,h,y,C,I,L,B,Y,ae,Ce,we){for(var ke=f.context,Qe=ke.gl,Ye=f.transform,mt=B==="map",je=Y==="map",dt=mt&&h.layout.get("symbol-placement")!=="point",vt=mt&&!je&&!dt,$t=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,Sr=!1,yr=f.depthModeForSublayer(0,Re.ReadOnly),wr=h.layout.get("text-variable-anchor"),Xr=[],yn=0,ln=y;yn<ln.length;yn+=1){var Bn=ln[yn],ei=d.getTile(Bn),_i=ei.getBucket(h);if(_i){var gi=C?_i.text:_i.icon;if(gi&&gi.segments.get().length){var Ki=gi.programConfigurations.get(h.id),Nn=C||_i.sdfIcons,Hi=C?_i.textSizeData:_i.iconSizeData,Qi=je||Ye.pitch!==0,Li=f.useProgram(Wh(Nn,C,_i),Ki),yi=_.evaluateSizeForZoom(Hi,Ye.zoom),ia=void 0,Ii=[0,0],wi=void 0,cs=void 0,Po=null,ro=void 0;if(C)wi=ei.glyphAtlasTexture,cs=Qe.LINEAR,ia=ei.glyphAtlasTexture.size,_i.iconsInText&&(Ii=ei.imageAtlasTexture.size,Po=ei.imageAtlasTexture,ro=Qi||f.options.rotating||f.options.zooming||Hi.kind==="composite"||Hi.kind==="camera"?Qe.LINEAR:Qe.NEAREST);else{var Ps=h.layout.get("icon-size").constantOr(0)!==1||_i.iconsNeedLinear;wi=ei.imageAtlasTexture,cs=Nn||f.options.rotating||f.options.zooming||Ps||Qi?Qe.LINEAR:Qe.NEAREST,ia=ei.imageAtlasTexture.size}var Zo=Va(ei,1,f.transform.zoom),wo=bo(Bn.posMatrix,je,mt,f.transform,Zo),uu=Za(Bn.posMatrix,je,mt,f.transform,Zo),Rs=wr&&_i.hasTextData(),Vu=h.layout.get("icon-text-fit")!=="none"&&Rs&&_i.hasIconData();dt&&Ou(_i,Bn.posMatrix,f,C,wo,uu,je,ae);var lu=f.translatePosMatrix(Bn.posMatrix,ei,I,L),qo=dt||C&&wr||Vu?gs:wo,Gu=f.translatePosMatrix(uu,ei,I,L,!0),Es=Nn&&h.paint.get(C?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Of={program:Li,buffers:gi,uniformValues:Nn?_i.iconsInText?gc(Hi.kind,yi,vt,je,f,lu,qo,Gu,ia,Ii):Pl(Hi.kind,yi,vt,je,f,lu,qo,Gu,C,ia,!0):mc(Hi.kind,yi,vt,je,f,lu,qo,Gu,C,ia),atlasTexture:wi,atlasTextureIcon:Po,atlasInterpolation:cs,atlasInterpolationIcon:ro,isSDF:Nn,hasHalo:Es};if($t&&_i.canOverlap){Sr=!0;for(var wc=0,Gc=gi.segments.get();wc<Gc.length;wc+=1){var Ff=Gc[wc];Xr.push({segments:new _.SegmentVector([Ff]),sortKey:Ff.sortKey,state:Of})}}else Xr.push({segments:gi.segments,sortKey:0,state:Of})}}}Sr&&Xr.sort(function(oc,Ac){return oc.sortKey-Ac.sortKey});for(var ju=0,Ol=Xr;ju<Ol.length;ju+=1){var ml=Ol[ju],ns=ml.state;if(ke.activeTexture.set(Qe.TEXTURE0),ns.atlasTexture.bind(ns.atlasInterpolation,Qe.CLAMP_TO_EDGE),ns.atlasTextureIcon&&(ke.activeTexture.set(Qe.TEXTURE1),ns.atlasTextureIcon&&ns.atlasTextureIcon.bind(ns.atlasInterpolationIcon,Qe.CLAMP_TO_EDGE)),ns.isSDF){var Hu=ns.uniformValues;ns.hasHalo&&(Hu.u_is_halo=1,Zs(ns.buffers,ml.segments,h,f,ns.program,yr,Ce,we,Hu)),Hu.u_is_halo=0}Zs(ns.buffers,ml.segments,h,f,ns.program,yr,Ce,we,ns.uniformValues)}}function Zs(f,d,h,y,C,I,L,B,Y){var ae=y.context;C.draw(ae,ae.gl.TRIANGLES,I,L,B,At.disabled,Y,h.id,f.layoutVertexBuffer,f.indexBuffer,d,h.paint,y.transform.zoom,f.programConfigurations.get(h.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function _c(f,d,h,y,C,I,L){var B,Y,ae,Ce,we,ke=f.context.gl,Qe=h.paint.get("fill-pattern"),Ye=Qe&&Qe.constantOr(1),mt=h.getCrossfadeParameters();L?(Y=Ye&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=ke.LINES):(Y=Ye?"fillPattern":"fill",B=ke.TRIANGLES);for(var je=0,dt=y;je<dt.length;je+=1){var vt=dt[je],$t=d.getTile(vt);if(!Ye||$t.patternsLoaded()){var Sr=$t.getBucket(h);if(Sr){var yr=Sr.programConfigurations.get(h.id),wr=f.useProgram(Y,yr);Ye&&(f.context.activeTexture.set(ke.TEXTURE0),$t.imageAtlasTexture.bind(ke.LINEAR,ke.CLAMP_TO_EDGE),yr.updatePaintBuffers(mt));var Xr=Qe.constantOr(null);if(Xr&&$t.imageAtlas){var yn=$t.imageAtlas,ln=yn.patternPositions[Xr.to.toString()],Bn=yn.patternPositions[Xr.from.toString()];ln&&Bn&&yr.setConstantPatternPositions(ln,Bn)}var ei=f.translatePosMatrix(vt.posMatrix,$t,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(L){Ce=Sr.indexBuffer2,we=Sr.segments2;var _i=[ke.drawingBufferWidth,ke.drawingBufferHeight];ae=Y==="fillOutlinePattern"&&Ye?Hh(ei,f,mt,$t,_i):ts(ei,_i)}else Ce=Sr.indexBuffer,we=Sr.segments,ae=Ye?Kl(ei,f,mt,$t):kl(ei);wr.draw(f.context,B,C,f.stencilModeForClipping(vt),I,At.disabled,ae,h.id,Sr.layoutVertexBuffer,Ce,we,h.paint,f.transform.zoom,yr)}}}}function pl(f,d,h,y,C,I,L){for(var B=f.context,Y=B.gl,ae=h.paint.get("fill-extrusion-pattern"),Ce=ae.constantOr(1),we=h.getCrossfadeParameters(),ke=h.paint.get("fill-extrusion-opacity"),Qe=0,Ye=y;Qe<Ye.length;Qe+=1){var mt=Ye[Qe],je=d.getTile(mt),dt=je.getBucket(h);if(dt){var vt=dt.programConfigurations.get(h.id),$t=f.useProgram(Ce?"fillExtrusionPattern":"fillExtrusion",vt);Ce&&(f.context.activeTexture.set(Y.TEXTURE0),je.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),vt.updatePaintBuffers(we));var Sr=ae.constantOr(null);if(Sr&&je.imageAtlas){var yr=je.imageAtlas,wr=yr.patternPositions[Sr.to.toString()],Xr=yr.patternPositions[Sr.from.toString()];wr&&Xr&&vt.setConstantPatternPositions(wr,Xr)}var yn=f.translatePosMatrix(mt.posMatrix,je,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),ln=h.paint.get("fill-extrusion-vertical-gradient"),Bn=Ce?ql(yn,f,ln,ke,mt,we,je):ef(yn,f,ln,ke);$t.draw(B,B.gl.TRIANGLES,C,I,L,At.backCCW,Bn,h.id,dt.layoutVertexBuffer,dt.indexBuffer,dt.segments,h.paint,f.transform.zoom,vt)}}}function Ws(f,d,h,y,C,I){var L=f.context,B=L.gl,Y=d.fbo;if(Y){var ae=f.useProgram("hillshade");L.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,Y.colorAttachment.get());var Ce=function(we,ke,Qe){var Ye=Qe.paint.get("hillshade-shadow-color"),mt=Qe.paint.get("hillshade-highlight-color"),je=Qe.paint.get("hillshade-accent-color"),dt=Qe.paint.get("hillshade-illumination-direction")*(Math.PI/180);Qe.paint.get("hillshade-illumination-anchor")==="viewport"&&(dt-=we.transform.angle);var vt,$t,Sr,yr=!we.options.moving;return{u_matrix:we.transform.calculatePosMatrix(ke.tileID.toUnwrapped(),yr),u_image:0,u_latrange:(vt=ke.tileID,$t=Math.pow(2,vt.canonical.z),Sr=vt.canonical.y,[new _.MercatorCoordinate(0,Sr/$t).toLngLat().lat,new _.MercatorCoordinate(0,(Sr+1)/$t).toLngLat().lat]),u_light:[Qe.paint.get("hillshade-exaggeration"),dt],u_shadow:Ye,u_highlight:mt,u_accent:je}}(f,d,h);ae.draw(L,B.TRIANGLES,y,C,I,At.disabled,Ce,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}}function yp(f,d,h,y,C,I){var L=f.context,B=L.gl,Y=d.dem;if(Y&&Y.data){var ae=Y.dim,Ce=Y.stride,we=Y.getPixels();if(L.activeTexture.set(B.TEXTURE1),L.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||f.getTileTexture(Ce),d.demTexture){var ke=d.demTexture;ke.update(we,{premultiply:!1}),ke.bind(B.NEAREST,B.CLAMP_TO_EDGE)}else d.demTexture=new _.Texture(L,we,B.RGBA,{premultiply:!1}),d.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);L.activeTexture.set(B.TEXTURE0);var Qe=d.fbo;if(!Qe){var Ye=new _.Texture(L,{width:ae,height:ae,data:null},B.RGBA);Ye.bind(B.LINEAR,B.CLAMP_TO_EDGE),(Qe=d.fbo=L.createFramebuffer(ae,ae,!0)).colorAttachment.set(Ye.texture)}L.bindFramebuffer.set(Qe.framebuffer),L.viewport.set([0,0,ae,ae]),f.useProgram("hillshadePrepare").draw(L,B.TRIANGLES,y,C,I,At.disabled,function(mt,je){var dt=je.stride,vt=_.create();return _.ortho(vt,0,_.EXTENT,-_.EXTENT,0,0,1),_.translate(vt,vt,[0,-_.EXTENT,0]),{u_matrix:vt,u_image:1,u_dimension:[dt,dt],u_zoom:mt.overscaledZ,u_unpack:je.getUnpackVector()}}(d.tileID,Y),h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function Pf(f,d,h,y,C){var I=y.paint.get("raster-fade-duration");if(I>0){var L=_.browser.now(),B=(L-f.timeAdded)/I,Y=d?(L-d.timeAdded)/I:-1,ae=h.getSource(),Ce=C.coveringZoomLevel({tileSize:ae.tileSize,roundZoom:ae.roundZoom}),we=!d||Math.abs(d.tileID.overscaledZ-Ce)>Math.abs(f.tileID.overscaledZ-Ce),ke=we&&f.refreshedUponExpiration?1:_.clamp(we?B:1-Y,0,1);return f.refreshedUponExpiration&&B>=1&&(f.refreshedUponExpiration=!1),d?{opacity:1,mix:1-ke}:{opacity:ke,mix:0}}return{opacity:1,mix:0}}var Fc=new _.Color(1,0,0,1),xc=new _.Color(0,1,0,1),nl=new _.Color(0,0,1,1),tc=new _.Color(1,0,1,1),Ch=new _.Color(0,1,1,1);function Xh(f,d,h,y){rf(f,0,d+h/2,f.transform.width,h,y)}function $h(f,d,h,y){rf(f,d-h/2,0,h,f.transform.height,y)}function rf(f,d,h,y,C,I){var L=f.context,B=L.gl;B.enable(B.SCISSOR_TEST),B.scissor(d*_.browser.devicePixelRatio,h*_.browser.devicePixelRatio,y*_.browser.devicePixelRatio,C*_.browser.devicePixelRatio),L.clear({color:I}),B.disable(B.SCISSOR_TEST)}function _p(f,d,h){var y=f.context,C=y.gl,I=h.posMatrix,L=f.useProgram("debug"),B=Re.disabled,Y=He.disabled,ae=f.colorModeForRenderPass();y.activeTexture.set(C.TEXTURE0),f.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),L.draw(y,C.LINE_STRIP,B,Y,ae,At.disabled,Ql(I,_.Color.red),"$debug",f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments);var Ce=d.getTileByID(h.key).latestRawTileData,we=Math.floor((Ce&&Ce.byteLength||0)/1024),ke=d.getTile(h).tileSize,Qe=512/Math.min(ke,512)*(h.overscaledZ/f.transform.zoom)*.5,Ye=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Ye+=" => "+h.overscaledZ),function(mt,je){mt.initDebugOverlayCanvas();var dt=mt.debugOverlayCanvas,vt=mt.context.gl,$t=mt.debugOverlayCanvas.getContext("2d");$t.clearRect(0,0,dt.width,dt.height),$t.shadowColor="white",$t.shadowBlur=2,$t.lineWidth=1.5,$t.strokeStyle="white",$t.textBaseline="top",$t.font="bold 36px Open Sans, sans-serif",$t.fillText(je,5,5),$t.strokeText(je,5,5),mt.debugOverlayTexture.update(dt),mt.debugOverlayTexture.bind(vt.LINEAR,vt.CLAMP_TO_EDGE)}(f,Ye+" "+we+"kb"),L.draw(y,C.TRIANGLES,B,Y,ht.alphaBlended,At.disabled,Ql(I,_.Color.transparent,Qe),"$debug",f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}var rc={symbol:function(f,d,h,y,C){if(f.renderPass==="translucent"){var I=He.disabled,L=f.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(B,Y,ae,Ce,we,ke,Qe){for(var Ye=Y.transform,mt=we==="map",je=ke==="map",dt=0,vt=B;dt<vt.length;dt+=1){var $t=vt[dt],Sr=Ce.getTile($t),yr=Sr.getBucket(ae);if(yr&&yr.text&&yr.text.segments.get().length){var wr=_.evaluateSizeForZoom(yr.textSizeData,Ye.zoom),Xr=Va(Sr,1,Y.transform.zoom),yn=bo($t.posMatrix,je,mt,Y.transform,Xr),ln=ae.layout.get("icon-text-fit")!=="none"&&yr.hasIconData();if(wr){var Bn=Math.pow(2,Ye.zoom-Sr.tileID.overscaledZ);yc(yr,mt,je,Qe,_.symbolSize,Ye,yn,$t.posMatrix,Bn,wr,ln)}}}}(y,f,h,d,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),C),h.paint.get("icon-opacity").constantOr(1)!==0&&ec(f,d,h,y,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),I,L),h.paint.get("text-opacity").constantOr(1)!==0&&ec(f,d,h,y,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),I,L),d.map.showCollisionBoxes&&(Rl(f,d,h,y,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Rl(f,d,h,y,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))}},circle:function(f,d,h,y){if(f.renderPass==="translucent"){var C=h.paint.get("circle-opacity"),I=h.paint.get("circle-stroke-width"),L=h.paint.get("circle-stroke-opacity"),B=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(C.constantOr(1)!==0||I.constantOr(1)!==0&&L.constantOr(1)!==0){for(var Y=f.context,ae=Y.gl,Ce=f.depthModeForSublayer(0,Re.ReadOnly),we=He.disabled,ke=f.colorModeForRenderPass(),Qe=[],Ye=0;Ye<y.length;Ye++){var mt=y[Ye],je=d.getTile(mt),dt=je.getBucket(h);if(dt){var vt=dt.programConfigurations.get(h.id),$t={programConfiguration:vt,program:f.useProgram("circle",vt),layoutVertexBuffer:dt.layoutVertexBuffer,indexBuffer:dt.indexBuffer,uniformValues:Sh(f,mt,je,h)};if(B)for(var Sr=0,yr=dt.segments.get();Sr<yr.length;Sr+=1){var wr=yr[Sr];Qe.push({segments:new _.SegmentVector([wr]),sortKey:wr.sortKey,state:$t})}else Qe.push({segments:dt.segments,sortKey:0,state:$t})}}B&&Qe.sort(function(ei,_i){return ei.sortKey-_i.sortKey});for(var Xr=0,yn=Qe;Xr<yn.length;Xr+=1){var ln=yn[Xr],Bn=ln.state;Bn.program.draw(Y,ae.TRIANGLES,Ce,we,ke,At.disabled,Bn.uniformValues,h.id,Bn.layoutVertexBuffer,Bn.indexBuffer,ln.segments,h.paint,f.transform.zoom,Bn.programConfiguration)}}}},heatmap:function(f,d,h,y){if(h.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){var C=f.context,I=C.gl,L=He.disabled,B=new ht([I.ONE,I.ONE],_.Color.transparent,[!0,!0,!0,!0]);(function(Qe,Ye,mt){var je=Qe.gl;Qe.activeTexture.set(je.TEXTURE1),Qe.viewport.set([0,0,Ye.width/4,Ye.height/4]);var dt=mt.heatmapFbo;if(dt)je.bindTexture(je.TEXTURE_2D,dt.colorAttachment.get()),Qe.bindFramebuffer.set(dt.framebuffer);else{var vt=je.createTexture();je.bindTexture(je.TEXTURE_2D,vt),je.texParameteri(je.TEXTURE_2D,je.TEXTURE_WRAP_S,je.CLAMP_TO_EDGE),je.texParameteri(je.TEXTURE_2D,je.TEXTURE_WRAP_T,je.CLAMP_TO_EDGE),je.texParameteri(je.TEXTURE_2D,je.TEXTURE_MIN_FILTER,je.LINEAR),je.texParameteri(je.TEXTURE_2D,je.TEXTURE_MAG_FILTER,je.LINEAR),dt=mt.heatmapFbo=Qe.createFramebuffer(Ye.width/4,Ye.height/4,!1),function($t,Sr,yr,wr){var Xr=$t.gl;Xr.texImage2D(Xr.TEXTURE_2D,0,Xr.RGBA,Sr.width/4,Sr.height/4,0,Xr.RGBA,$t.extRenderToTextureHalfFloat?$t.extTextureHalfFloat.HALF_FLOAT_OES:Xr.UNSIGNED_BYTE,null),wr.colorAttachment.set(yr)}(Qe,Ye,vt,dt)}})(C,f,h),C.clear({color:_.Color.transparent});for(var Y=0;Y<y.length;Y++){var ae=y[Y];if(!d.hasRenderableParent(ae)){var Ce=d.getTile(ae),we=Ce.getBucket(h);if(we){var ke=we.programConfigurations.get(h.id);f.useProgram("heatmap",ke).draw(C,I.TRIANGLES,Re.disabled,L,B,At.disabled,kf(ae.posMatrix,Ce,f.transform.zoom,h.paint.get("heatmap-intensity")),h.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,h.paint,f.transform.zoom,ke)}}}C.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(Qe,Ye){var mt=Qe.context,je=mt.gl,dt=Ye.heatmapFbo;if(dt){mt.activeTexture.set(je.TEXTURE0),je.bindTexture(je.TEXTURE_2D,dt.colorAttachment.get()),mt.activeTexture.set(je.TEXTURE1);var vt=Ye.colorRampTexture;vt||(vt=Ye.colorRampTexture=new _.Texture(mt,Ye.colorRamp,je.RGBA)),vt.bind(je.LINEAR,je.CLAMP_TO_EDGE),Qe.useProgram("heatmapTexture").draw(mt,je.TRIANGLES,Re.disabled,He.disabled,Qe.colorModeForRenderPass(),At.disabled,function($t,Sr,yr,wr){var Xr=_.create();_.ortho(Xr,0,$t.width,$t.height,0,0,1);var yn=$t.context.gl;return{u_matrix:Xr,u_world:[yn.drawingBufferWidth,yn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Sr.paint.get("heatmap-opacity")}}(Qe,Ye),Ye.id,Qe.viewportBuffer,Qe.quadTriangleIndexBuffer,Qe.viewportSegments,Ye.paint,Qe.transform.zoom)}}(f,h))},line:function(f,d,h,y){if(f.renderPass==="translucent"){var C=h.paint.get("line-opacity"),I=h.paint.get("line-width");if(C.constantOr(1)!==0&&I.constantOr(1)!==0)for(var L=f.depthModeForSublayer(0,Re.ReadOnly),B=f.colorModeForRenderPass(),Y=h.paint.get("line-dasharray"),ae=h.paint.get("line-pattern"),Ce=ae.constantOr(1),we=h.paint.get("line-gradient"),ke=h.getCrossfadeParameters(),Qe=Ce?"linePattern":Y?"lineSDF":we?"lineGradient":"line",Ye=f.context,mt=Ye.gl,je=!0,dt=0,vt=y;dt<vt.length;dt+=1){var $t=vt[dt],Sr=d.getTile($t);if(!Ce||Sr.patternsLoaded()){var yr=Sr.getBucket(h);if(yr){var wr=yr.programConfigurations.get(h.id),Xr=f.context.program.get(),yn=f.useProgram(Qe,wr),ln=je||yn.program!==Xr,Bn=ae.constantOr(null);if(Bn&&Sr.imageAtlas){var ei=Sr.imageAtlas,_i=ei.patternPositions[Bn.to.toString()],gi=ei.patternPositions[Bn.from.toString()];_i&&gi&&wr.setConstantPatternPositions(_i,gi)}var Ki=Ce?vc(f,Sr,h,ke):Y?rl(f,Sr,h,Y,ke):we?oo(f,Sr,h,yr.lineClipsArray.length):Jl(f,Sr,h);if(Ce)Ye.activeTexture.set(mt.TEXTURE0),Sr.imageAtlasTexture.bind(mt.LINEAR,mt.CLAMP_TO_EDGE),wr.updatePaintBuffers(ke);else if(Y&&(ln||f.lineAtlas.dirty))Ye.activeTexture.set(mt.TEXTURE0),f.lineAtlas.bind(Ye);else if(we){var Nn=yr.gradients[h.id],Hi=Nn.texture;if(h.gradientVersion!==Nn.version){var Qi=256;if(h.stepInterpolant){var Li=d.getSource().maxzoom,yi=$t.canonical.z===Li?Math.ceil(1<<f.transform.maxZoom-$t.canonical.z):1;Qi=_.clamp(_.nextPowerOfTwo(yr.maxLineLength/_.EXTENT*1024*yi),256,Ye.maxTextureSize)}Nn.gradient=_.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Qi,image:Nn.gradient||void 0,clips:yr.lineClipsArray}),Nn.texture?Nn.texture.update(Nn.gradient):Nn.texture=new _.Texture(Ye,Nn.gradient,mt.RGBA),Nn.version=h.gradientVersion,Hi=Nn.texture}Ye.activeTexture.set(mt.TEXTURE0),Hi.bind(h.stepInterpolant?mt.NEAREST:mt.LINEAR,mt.CLAMP_TO_EDGE)}yn.draw(Ye,mt.TRIANGLES,L,f.stencilModeForClipping($t),B,At.disabled,Ki,h.id,yr.layoutVertexBuffer,yr.indexBuffer,yr.segments,h.paint,f.transform.zoom,wr,yr.layoutVertexBuffer2),je=!1}}}}},fill:function(f,d,h,y){var C=h.paint.get("fill-color"),I=h.paint.get("fill-opacity");if(I.constantOr(1)!==0){var L=f.colorModeForRenderPass(),B=h.paint.get("fill-pattern"),Y=f.opaquePassEnabledForLayer()&&!B.constantOr(1)&&C.constantOr(_.Color.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===Y){var ae=f.depthModeForSublayer(1,f.renderPass==="opaque"?Re.ReadWrite:Re.ReadOnly);_c(f,d,h,y,ae,L,!1)}if(f.renderPass==="translucent"&&h.paint.get("fill-antialias")){var Ce=f.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,Re.ReadOnly);_c(f,d,h,y,Ce,L,!0)}}},"fill-extrusion":function(f,d,h,y){var C=h.paint.get("fill-extrusion-opacity");if(C!==0&&f.renderPass==="translucent"){var I=new Re(f.context.gl.LEQUAL,Re.ReadWrite,f.depthRangeFor3D);if(C!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))pl(f,d,h,y,I,He.disabled,ht.disabled),pl(f,d,h,y,I,f.stencilModeFor3D(),f.colorModeForRenderPass());else{var L=f.colorModeForRenderPass();pl(f,d,h,y,I,He.disabled,L)}}},hillshade:function(f,d,h,y){if(f.renderPass==="offscreen"||f.renderPass==="translucent"){for(var C=f.context,I=f.depthModeForSublayer(0,Re.ReadOnly),L=f.colorModeForRenderPass(),B=f.renderPass==="translucent"?f.stencilConfigForOverlap(y):[{},y],Y=B[0],ae=0,Ce=B[1];ae<Ce.length;ae+=1){var we=Ce[ae],ke=d.getTile(we);ke.needsHillshadePrepare&&f.renderPass==="offscreen"?yp(f,ke,h,I,He.disabled,L):f.renderPass==="translucent"&&Ws(f,ke,h,I,Y[we.overscaledZ],L)}C.viewport.set([0,0,f.width,f.height])}},raster:function(f,d,h,y){if(f.renderPass==="translucent"&&h.paint.get("raster-opacity")!==0&&y.length)for(var C=f.context,I=C.gl,L=d.getSource(),B=f.useProgram("raster"),Y=f.colorModeForRenderPass(),ae=L instanceof lt?[{},y]:f.stencilConfigForOverlap(y),Ce=ae[0],we=ae[1],ke=we[we.length-1].overscaledZ,Qe=!f.options.moving,Ye=0,mt=we;Ye<mt.length;Ye+=1){var je=mt[Ye],dt=f.depthModeForSublayer(je.overscaledZ-ke,h.paint.get("raster-opacity")===1?Re.ReadWrite:Re.ReadOnly,I.LESS),vt=d.getTile(je),$t=f.transform.calculatePosMatrix(je.toUnwrapped(),Qe);vt.registerFadeDuration(h.paint.get("raster-fade-duration"));var Sr=d.findLoadedParent(je,0),yr=Pf(vt,Sr,d,h,f.transform),wr=void 0,Xr=void 0,yn=h.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;C.activeTexture.set(I.TEXTURE0),vt.texture.bind(yn,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(I.TEXTURE1),Sr?(Sr.texture.bind(yn,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),wr=Math.pow(2,Sr.tileID.overscaledZ-vt.tileID.overscaledZ),Xr=[vt.tileID.canonical.x*wr%1,vt.tileID.canonical.y*wr%1]):vt.texture.bind(yn,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);var ln=dd($t,Xr||[0,0],wr||1,yr,h);L instanceof lt?B.draw(C,I.TRIANGLES,dt,He.disabled,Y,At.disabled,ln,h.id,L.boundsBuffer,f.quadTriangleIndexBuffer,L.boundsSegments):B.draw(C,I.TRIANGLES,dt,Ce[je.overscaledZ],Y,At.disabled,ln,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}},background:function(f,d,h){var y=h.paint.get("background-color"),C=h.paint.get("background-opacity");if(C!==0){var I=f.context,L=I.gl,B=f.transform,Y=B.tileSize,ae=h.paint.get("background-pattern");if(!f.isPatternMissing(ae)){var Ce=!ae&&y.a===1&&C===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass===Ce){var we=He.disabled,ke=f.depthModeForSublayer(0,Ce==="opaque"?Re.ReadWrite:Re.ReadOnly),Qe=f.colorModeForRenderPass(),Ye=f.useProgram(ae?"backgroundPattern":"background"),mt=B.coveringTiles({tileSize:Y});ae&&(I.activeTexture.set(L.TEXTURE0),f.imageManager.bind(f.context));for(var je=h.getCrossfadeParameters(),dt=0,vt=mt;dt<vt.length;dt+=1){var $t=vt[dt],Sr=f.transform.calculatePosMatrix($t.toUnwrapped()),yr=ae?Oc(Sr,C,f,ae,{tileID:$t,tileSize:Y},je):Lc(Sr,C,y);Ye.draw(I,L.TRIANGLES,ke,we,Qe,At.disabled,yr,h.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}}}},debug:function(f,d,h){for(var y=0;y<h.length;y++)_p(f,d,h[y])},custom:function(f,d,h){var y=f.context,C=h.implementation;if(f.renderPass==="offscreen"){var I=C.prerender;I&&(f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),I.call(C,y.gl,f.transform.customLayerMatrix()),y.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),y.setStencilMode(He.disabled);var L=C.renderingMode==="3d"?new Re(f.context.gl.LEQUAL,Re.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Re.ReadOnly);y.setDepthMode(L),C.render(y.gl,f.transform.customLayerMatrix()),y.setDirty(),f.setBaseState(),y.bindFramebuffer.set(null)}}},kt=function(f,d){this.context=new Te(f),this.transform=d,this._tileTextures={},this.setup(),this.numSublayers=Je.maxUnderzooming+Je.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Tu,this.gpuTimers={}};kt.prototype.resize=function(f,d){if(this.width=f*_.browser.devicePixelRatio,this.height=d*_.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var h=0,y=this.style._order;h<y.length;h+=1)this.style._layers[y[h]].resize()},kt.prototype.setup=function(){var f=this.context,d=new _.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(_.EXTENT,0),d.emplaceBack(0,_.EXTENT),d.emplaceBack(_.EXTENT,_.EXTENT),this.tileExtentBuffer=f.createVertexBuffer(d,lo.members),this.tileExtentSegments=_.SegmentVector.simpleSegment(0,0,4,2);var h=new _.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(_.EXTENT,0),h.emplaceBack(0,_.EXTENT),h.emplaceBack(_.EXTENT,_.EXTENT),this.debugBuffer=f.createVertexBuffer(h,lo.members),this.debugSegments=_.SegmentVector.simpleSegment(0,0,4,5);var y=new _.StructArrayLayout4i8;y.emplaceBack(0,0,0,0),y.emplaceBack(_.EXTENT,0,_.EXTENT,0),y.emplaceBack(0,_.EXTENT,0,_.EXTENT),y.emplaceBack(_.EXTENT,_.EXTENT,_.EXTENT,_.EXTENT),this.rasterBoundsBuffer=f.createVertexBuffer(y,Xe.members),this.rasterBoundsSegments=_.SegmentVector.simpleSegment(0,0,4,2);var C=new _.StructArrayLayout2i4;C.emplaceBack(0,0),C.emplaceBack(1,0),C.emplaceBack(0,1),C.emplaceBack(1,1),this.viewportBuffer=f.createVertexBuffer(C,lo.members),this.viewportSegments=_.SegmentVector.simpleSegment(0,0,4,2);var I=new _.StructArrayLayout1ui2;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=f.createIndexBuffer(I);var L=new _.StructArrayLayout3ui6;L.emplaceBack(0,1,2),L.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=f.createIndexBuffer(L),this.emptyTexture=new _.Texture(f,{width:1,height:1,data:new Uint8Array([0,0,0,0])},f.gl.RGBA);var B=this.context.gl;this.stencilClearMode=new He({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO)},kt.prototype.clearStencil=function(){var f=this.context,d=f.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var h=_.create();_.ortho(h,0,this.width,this.height,0,0,1),_.scale(h,h,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(f,d.TRIANGLES,Re.disabled,this.stencilClearMode,ht.disabled,At.disabled,tl(h),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},kt.prototype._renderTileClippingMasks=function(f,d){if(this.currentStencilSource!==f.source&&f.isTileClipped()&&d&&d.length){this.currentStencilSource=f.source;var h=this.context,y=h.gl;this.nextStencilID+d.length>256&&this.clearStencil(),h.setColorMode(ht.disabled),h.setDepthMode(Re.disabled);var C=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var I=0,L=d;I<L.length;I+=1){var B=L[I],Y=this._tileClippingMaskIDs[B.key]=this.nextStencilID++;C.draw(h,y.TRIANGLES,Re.disabled,new He({func:y.ALWAYS,mask:0},Y,255,y.KEEP,y.KEEP,y.REPLACE),ht.disabled,At.disabled,tl(B.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},kt.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var f=this.nextStencilID++,d=this.context.gl;return new He({func:d.NOTEQUAL,mask:255},f,255,d.KEEP,d.KEEP,d.REPLACE)},kt.prototype.stencilModeForClipping=function(f){var d=this.context.gl;return new He({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[f.key],0,d.KEEP,d.KEEP,d.REPLACE)},kt.prototype.stencilConfigForOverlap=function(f){var d,h=this.context.gl,y=f.sort(function(Y,ae){return ae.overscaledZ-Y.overscaledZ}),C=y[y.length-1].overscaledZ,I=y[0].overscaledZ-C+1;if(I>1){this.currentStencilSource=void 0,this.nextStencilID+I>256&&this.clearStencil();for(var L={},B=0;B<I;B++)L[B+C]=new He({func:h.GEQUAL,mask:255},B+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=I,[L,y]}return[(d={},d[C]=He.disabled,d),y]},kt.prototype.colorModeForRenderPass=function(){var f=this.context.gl;return this._showOverdrawInspector?new ht([f.CONSTANT_COLOR,f.ONE],new _.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ht.unblended:ht.alphaBlended},kt.prototype.depthModeForSublayer=function(f,d,h){if(!this.opaquePassEnabledForLayer())return Re.disabled;var y=1-((1+this.currentLayer)*this.numSublayers+f)*this.depthEpsilon;return new Re(h||this.context.gl.LEQUAL,d,[y,y])},kt.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},kt.prototype.render=function(f,d){var h=this;this.style=f,this.options=d,this.lineAtlas=f.lineAtlas,this.imageManager=f.imageManager,this.glyphManager=f.glyphManager,this.symbolFadeChange=f.placement.symbolFadeChange(_.browser.now()),this.imageManager.beginFrame();var y=this.style._order,C=this.style.sourceCaches;for(var I in C){var L=C[I];L.used&&L.prepare(this.context)}var B,Y,ae={},Ce={},we={};for(var ke in C){var Qe=C[ke];ae[ke]=Qe.getVisibleCoordinates(),Ce[ke]=ae[ke].slice().reverse(),we[ke]=Qe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ye=0;Ye<y.length;Ye++)if(this.style._layers[y[Ye]].is3D()){this.opaquePassCutoff=Ye;break}this.renderPass="offscreen";for(var mt=0,je=y;mt<je.length;mt+=1){var dt=this.style._layers[je[mt]];if(dt.hasOffscreenPass()&&!dt.isHidden(this.transform.zoom)){var vt=Ce[dt.source];(dt.type==="custom"||vt.length)&&this.renderLayer(this,C[dt.source],dt,vt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?_.Color.black:_.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(f._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){var $t=this.style._layers[y[this.currentLayer]],Sr=C[$t.source],yr=ae[$t.source];this._renderTileClippingMasks($t,yr),this.renderLayer(this,Sr,$t,yr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){var wr=this.style._layers[y[this.currentLayer]],Xr=C[wr.source],yn=(wr.type==="symbol"?we:Ce)[wr.source];this._renderTileClippingMasks(wr,ae[wr.source]),this.renderLayer(this,Xr,wr,yn)}this.options.showTileBoundaries&&(_.values(this.style._layers).forEach(function(ln){ln.source&&!ln.isHidden(h.transform.zoom)&&(ln.source!==(Y&&Y.id)&&(Y=h.style.sourceCaches[ln.source]),(!B||B.getSource().maxzoom<Y.getSource().maxzoom)&&(B=Y))}),B&&rc.debug(this,B,B.getVisibleCoordinates())),this.options.showPadding&&function(ln){var Bn=ln.transform.padding;Xh(ln,ln.transform.height-(Bn.top||0),3,Fc),Xh(ln,Bn.bottom||0,3,xc),$h(ln,Bn.left||0,3,nl),$h(ln,ln.transform.width-(Bn.right||0),3,tc);var ei=ln.transform.centerPoint;(function(_i,gi,Ki,Nn){rf(_i,gi-1,Ki-10,2,20,Nn),rf(_i,gi-10,Ki-1,20,2,Nn)})(ln,ei.x,ln.transform.height-ei.y,Ch)}(this),this.context.setDefault()},kt.prototype.renderLayer=function(f,d,h,y){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||y.length)&&(this.id=h.id,this.gpuTimingStart(h),rc[h.type](f,d,h,y,this.style.placement.variableOffsets),this.gpuTimingEnd())},kt.prototype.gpuTimingStart=function(f){if(this.options.gpuTiming){var d=this.context.extTimerQuery,h=this.gpuTimers[f.id];h||(h=this.gpuTimers[f.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),h.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,h.query)}},kt.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var f=this.context.extTimerQuery;f.endQueryEXT(f.TIME_ELAPSED_EXT)}},kt.prototype.collectGpuTimers=function(){var f=this.gpuTimers;return this.gpuTimers={},f},kt.prototype.queryGpuTimers=function(f){var d={};for(var h in f){var y=f[h],C=this.context.extTimerQuery,I=C.getQueryObjectEXT(y.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(y.query),d[h]=I}return d},kt.prototype.translatePosMatrix=function(f,d,h,y,C){if(!h[0]&&!h[1])return f;var I=C?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(I){var L=Math.sin(I),B=Math.cos(I);h=[h[0]*B-h[1]*L,h[0]*L+h[1]*B]}var Y=[C?h[0]:Va(d,h[0],this.transform.zoom),C?h[1]:Va(d,h[1],this.transform.zoom),0],ae=new Float32Array(16);return _.translate(ae,f,Y),ae},kt.prototype.saveTileTexture=function(f){var d=this._tileTextures[f.size[0]];d?d.push(f):this._tileTextures[f.size[0]]=[f]},kt.prototype.getTileTexture=function(f){var d=this._tileTextures[f];return d&&d.length>0?d.pop():null},kt.prototype.isPatternMissing=function(f){if(!f)return!1;if(!f.from||!f.to)return!0;var d=this.imageManager.getPattern(f.from.toString()),h=this.imageManager.getPattern(f.to.toString());return!d||!h},kt.prototype.useProgram=function(f,d){this.cache=this.cache||{};var h=""+f+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[h]||(this.cache[h]=new No(this.context,f,Ho[f],d,tf[f],this._showOverdrawInspector)),this.cache[h]},kt.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},kt.prototype.setBaseState=function(){var f=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(f.FUNC_ADD)},kt.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=_.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new _.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},kt.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Zr=function(f,d){this.points=f,this.planes=d};Zr.fromInvProjectionMatrix=function(f,d,h){var y=Math.pow(2,h),C=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(L){return _.transformMat4([],L,f)}).map(function(L){return _.scale$1([],L,1/L[3]/d*y)}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(L){var B=_.sub([],C[L[0]],C[L[1]]),Y=_.sub([],C[L[2]],C[L[1]]),ae=_.normalize([],_.cross([],B,Y)),Ce=-_.dot(ae,C[L[1]]);return ae.concat(Ce)});return new Zr(C,I)};var Mr=function(f,d){this.min=f,this.max=d,this.center=_.scale$2([],_.add([],this.min,this.max),.5)};Mr.prototype.quadrant=function(f){for(var d=[f%2==0,f<2],h=_.clone$2(this.min),y=_.clone$2(this.max),C=0;C<d.length;C++)h[C]=d[C]?this.min[C]:this.center[C],y[C]=d[C]?this.center[C]:this.max[C];return y[2]=this.max[2],new Mr(h,y)},Mr.prototype.distanceX=function(f){return Math.max(Math.min(this.max[0],f[0]),this.min[0])-f[0]},Mr.prototype.distanceY=function(f){return Math.max(Math.min(this.max[1],f[1]),this.min[1])-f[1]},Mr.prototype.intersects=function(f){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],h=!0,y=0;y<f.planes.length;y++){for(var C=f.planes[y],I=0,L=0;L<d.length;L++)I+=_.dot$1(C,d[L])>=0;if(I===0)return 0;I!==d.length&&(h=!1)}if(h)return 2;for(var B=0;B<3;B++){for(var Y=Number.MAX_VALUE,ae=-Number.MAX_VALUE,Ce=0;Ce<f.points.length;Ce++){var we=f.points[Ce][B]-this.min[B];Y=Math.min(Y,we),ae=Math.max(ae,we)}if(ae<0||Y>this.max[B]-this.min[B])return 0}return 1};var fi=function(f,d,h,y){if(f===void 0&&(f=0),d===void 0&&(d=0),h===void 0&&(h=0),y===void 0&&(y=0),isNaN(f)||f<0||isNaN(d)||d<0||isNaN(h)||h<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=f,this.bottom=d,this.left=h,this.right=y};fi.prototype.interpolate=function(f,d,h){return d.top!=null&&f.top!=null&&(this.top=_.number(f.top,d.top,h)),d.bottom!=null&&f.bottom!=null&&(this.bottom=_.number(f.bottom,d.bottom,h)),d.left!=null&&f.left!=null&&(this.left=_.number(f.left,d.left,h)),d.right!=null&&f.right!=null&&(this.right=_.number(f.right,d.right,h)),this},fi.prototype.getCenter=function(f,d){var h=_.clamp((this.left+f-this.right)/2,0,f),y=_.clamp((this.top+d-this.bottom)/2,0,d);return new _.Point(h,y)},fi.prototype.equals=function(f){return this.top===f.top&&this.bottom===f.bottom&&this.left===f.left&&this.right===f.right},fi.prototype.clone=function(){return new fi(this.top,this.bottom,this.left,this.right)},fi.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Vn=function(f,d,h,y,C){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=C===void 0||C,this._minZoom=f||0,this._maxZoom=d||22,this._minPitch=h==null?0:h,this._maxPitch=y==null?60:y,this.setMaxBounds(),this.width=0,this.height=0,this._center=new _.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new fi,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ni={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Vn.prototype.clone=function(){var f=new Vn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return f.tileSize=this.tileSize,f.latRange=this.latRange,f.width=this.width,f.height=this.height,f._center=this._center,f.zoom=this.zoom,f.angle=this.angle,f._fov=this._fov,f._pitch=this._pitch,f._unmodified=this._unmodified,f._edgeInsets=this._edgeInsets.clone(),f._calcMatrices(),f},Ni.minZoom.get=function(){return this._minZoom},Ni.minZoom.set=function(f){this._minZoom!==f&&(this._minZoom=f,this.zoom=Math.max(this.zoom,f))},Ni.maxZoom.get=function(){return this._maxZoom},Ni.maxZoom.set=function(f){this._maxZoom!==f&&(this._maxZoom=f,this.zoom=Math.min(this.zoom,f))},Ni.minPitch.get=function(){return this._minPitch},Ni.minPitch.set=function(f){this._minPitch!==f&&(this._minPitch=f,this.pitch=Math.max(this.pitch,f))},Ni.maxPitch.get=function(){return this._maxPitch},Ni.maxPitch.set=function(f){this._maxPitch!==f&&(this._maxPitch=f,this.pitch=Math.min(this.pitch,f))},Ni.renderWorldCopies.get=function(){return this._renderWorldCopies},Ni.renderWorldCopies.set=function(f){f===void 0?f=!0:f===null&&(f=!1),this._renderWorldCopies=f},Ni.worldSize.get=function(){return this.tileSize*this.scale},Ni.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ni.size.get=function(){return new _.Point(this.width,this.height)},Ni.bearing.get=function(){return-this.angle/Math.PI*180},Ni.bearing.set=function(f){var d=-_.wrap(f,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=_.create$2(),_.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ni.pitch.get=function(){return this._pitch/Math.PI*180},Ni.pitch.set=function(f){var d=_.clamp(f,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},Ni.fov.get=function(){return this._fov/Math.PI*180},Ni.fov.set=function(f){f=Math.max(.01,Math.min(60,f)),this._fov!==f&&(this._unmodified=!1,this._fov=f/180*Math.PI,this._calcMatrices())},Ni.zoom.get=function(){return this._zoom},Ni.zoom.set=function(f){var d=Math.min(Math.max(f,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},Ni.center.get=function(){return this._center},Ni.center.set=function(f){f.lat===this._center.lat&&f.lng===this._center.lng||(this._unmodified=!1,this._center=f,this._constrain(),this._calcMatrices())},Ni.padding.get=function(){return this._edgeInsets.toJSON()},Ni.padding.set=function(f){this._edgeInsets.equals(f)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,f,1),this._calcMatrices())},Ni.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Vn.prototype.isPaddingEqual=function(f){return this._edgeInsets.equals(f)},Vn.prototype.interpolatePadding=function(f,d,h){this._unmodified=!1,this._edgeInsets.interpolate(f,d,h),this._constrain(),this._calcMatrices()},Vn.prototype.coveringZoomLevel=function(f){var d=(f.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/f.tileSize));return Math.max(0,d)},Vn.prototype.getVisibleUnwrappedCoordinates=function(f){var d=[new _.UnwrappedTileID(0,f)];if(this._renderWorldCopies)for(var h=this.pointCoordinate(new _.Point(0,0)),y=this.pointCoordinate(new _.Point(this.width,0)),C=this.pointCoordinate(new _.Point(this.width,this.height)),I=this.pointCoordinate(new _.Point(0,this.height)),L=Math.floor(Math.min(h.x,y.x,C.x,I.x)),B=Math.floor(Math.max(h.x,y.x,C.x,I.x)),Y=L-1;Y<=B+1;Y++)Y!==0&&d.push(new _.UnwrappedTileID(Y,f));return d},Vn.prototype.coveringTiles=function(f){var d=this.coveringZoomLevel(f),h=d;if(f.minzoom!==void 0&&d<f.minzoom)return[];f.maxzoom!==void 0&&d>f.maxzoom&&(d=f.maxzoom);var y=_.MercatorCoordinate.fromLngLat(this.center),C=Math.pow(2,d),I=[C*y.x,C*y.y,0],L=Zr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),B=f.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(B=d);var Y=function(ln){return{aabb:new Mr([ln*C,0,0],[(ln+1)*C,C,0]),zoom:0,x:0,y:0,wrap:ln,fullyVisible:!1}},ae=[],Ce=[],we=d,ke=f.reparseOverscaled?h:d;if(this._renderWorldCopies)for(var Qe=1;Qe<=3;Qe++)ae.push(Y(-Qe)),ae.push(Y(Qe));for(ae.push(Y(0));ae.length>0;){var Ye=ae.pop(),mt=Ye.x,je=Ye.y,dt=Ye.fullyVisible;if(!dt){var vt=Ye.aabb.intersects(L);if(vt===0)continue;dt=vt===2}var $t=Ye.aabb.distanceX(I),Sr=Ye.aabb.distanceY(I),yr=Math.max(Math.abs($t),Math.abs(Sr));if(Ye.zoom===we||yr>3+(1<<we-Ye.zoom)-2&&Ye.zoom>=B)Ce.push({tileID:new _.OverscaledTileID(Ye.zoom===we?ke:Ye.zoom,Ye.wrap,Ye.zoom,mt,je),distanceSq:_.sqrLen([I[0]-.5-mt,I[1]-.5-je])});else for(var wr=0;wr<4;wr++){var Xr=(mt<<1)+wr%2,yn=(je<<1)+(wr>>1);ae.push({aabb:Ye.aabb.quadrant(wr),zoom:Ye.zoom+1,x:Xr,y:yn,wrap:Ye.wrap,fullyVisible:dt})}}return Ce.sort(function(ln,Bn){return ln.distanceSq-Bn.distanceSq}).map(function(ln){return ln.tileID})},Vn.prototype.resize=function(f,d){this.width=f,this.height=d,this.pixelsToGLUnits=[2/f,-2/d],this._constrain(),this._calcMatrices()},Ni.unmodified.get=function(){return this._unmodified},Vn.prototype.zoomScale=function(f){return Math.pow(2,f)},Vn.prototype.scaleZoom=function(f){return Math.log(f)/Math.LN2},Vn.prototype.project=function(f){var d=_.clamp(f.lat,-this.maxValidLatitude,this.maxValidLatitude);return new _.Point(_.mercatorXfromLng(f.lng)*this.worldSize,_.mercatorYfromLat(d)*this.worldSize)},Vn.prototype.unproject=function(f){return new _.MercatorCoordinate(f.x/this.worldSize,f.y/this.worldSize).toLngLat()},Ni.point.get=function(){return this.project(this.center)},Vn.prototype.setLocationAtPoint=function(f,d){var h=this.pointCoordinate(d),y=this.pointCoordinate(this.centerPoint),C=this.locationCoordinate(f),I=new _.MercatorCoordinate(C.x-(h.x-y.x),C.y-(h.y-y.y));this.center=this.coordinateLocation(I),this._renderWorldCopies&&(this.center=this.center.wrap())},Vn.prototype.locationPoint=function(f){return this.coordinatePoint(this.locationCoordinate(f))},Vn.prototype.pointLocation=function(f){return this.coordinateLocation(this.pointCoordinate(f))},Vn.prototype.locationCoordinate=function(f){return _.MercatorCoordinate.fromLngLat(f)},Vn.prototype.coordinateLocation=function(f){return f.toLngLat()},Vn.prototype.pointCoordinate=function(f){var d=[f.x,f.y,0,1],h=[f.x,f.y,1,1];_.transformMat4(d,d,this.pixelMatrixInverse),_.transformMat4(h,h,this.pixelMatrixInverse);var y=d[3],C=h[3],I=d[1]/y,L=h[1]/C,B=d[2]/y,Y=h[2]/C,ae=B===Y?0:(0-B)/(Y-B);return new _.MercatorCoordinate(_.number(d[0]/y,h[0]/C,ae)/this.worldSize,_.number(I,L,ae)/this.worldSize)},Vn.prototype.coordinatePoint=function(f){var d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return _.transformMat4(d,d,this.pixelMatrix),new _.Point(d[0]/d[3],d[1]/d[3])},Vn.prototype.getBounds=function(){return new _.LngLatBounds().extend(this.pointLocation(new _.Point(0,0))).extend(this.pointLocation(new _.Point(this.width,0))).extend(this.pointLocation(new _.Point(this.width,this.height))).extend(this.pointLocation(new _.Point(0,this.height)))},Vn.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new _.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Vn.prototype.setMaxBounds=function(f){f?(this.lngRange=[f.getWest(),f.getEast()],this.latRange=[f.getSouth(),f.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Vn.prototype.calculatePosMatrix=function(f,d){d===void 0&&(d=!1);var h=f.key,y=d?this._alignedPosMatrixCache:this._posMatrixCache;if(y[h])return y[h];var C=f.canonical,I=this.worldSize/this.zoomScale(C.z),L=C.x+Math.pow(2,C.z)*f.wrap,B=_.identity(new Float64Array(16));return _.translate(B,B,[L*I,C.y*I,0]),_.scale(B,B,[I/_.EXTENT,I/_.EXTENT,1]),_.multiply(B,d?this.alignedProjMatrix:this.projMatrix,B),y[h]=new Float32Array(B),y[h]},Vn.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Vn.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var f,d,h,y,C=-90,I=90,L=-180,B=180,Y=this.size,ae=this._unmodified;if(this.latRange){var Ce=this.latRange;C=_.mercatorYfromLat(Ce[1])*this.worldSize,f=(I=_.mercatorYfromLat(Ce[0])*this.worldSize)-C<Y.y?Y.y/(I-C):0}if(this.lngRange){var we=this.lngRange;L=_.mercatorXfromLng(we[0])*this.worldSize,d=(B=_.mercatorXfromLng(we[1])*this.worldSize)-L<Y.x?Y.x/(B-L):0}var ke=this.point,Qe=Math.max(d||0,f||0);if(Qe)return this.center=this.unproject(new _.Point(d?(B+L)/2:ke.x,f?(I+C)/2:ke.y)),this.zoom+=this.scaleZoom(Qe),this._unmodified=ae,void(this._constraining=!1);if(this.latRange){var Ye=ke.y,mt=Y.y/2;Ye-mt<C&&(y=C+mt),Ye+mt>I&&(y=I-mt)}if(this.lngRange){var je=ke.x,dt=Y.x/2;je-dt<L&&(h=L+dt),je+dt>B&&(h=B-dt)}h===void 0&&y===void 0||(this.center=this.unproject(new _.Point(h!==void 0?h:ke.x,y!==void 0?y:ke.y))),this._unmodified=ae,this._constraining=!1}},Vn.prototype._calcMatrices=function(){if(this.height){var f=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var d=Math.PI/2+this._pitch,h=this._fov*(.5+f.y/this.height),y=Math.sin(h)*this.cameraToCenterDistance/Math.sin(_.clamp(Math.PI-d-h,.01,Math.PI-.01)),C=this.point,I=C.x,L=C.y,B=1.01*(Math.cos(Math.PI/2-this._pitch)*y+this.cameraToCenterDistance),Y=this.height/50,ae=new Float64Array(16);_.perspective(ae,this._fov,this.width/this.height,Y,B),ae[8]=2*-f.x/this.width,ae[9]=2*f.y/this.height,_.scale(ae,ae,[1,-1,1]),_.translate(ae,ae,[0,0,-this.cameraToCenterDistance]),_.rotateX(ae,ae,this._pitch),_.rotateZ(ae,ae,this.angle),_.translate(ae,ae,[-I,-L,0]),this.mercatorMatrix=_.scale([],ae,[this.worldSize,this.worldSize,this.worldSize]),_.scale(ae,ae,[1,1,_.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=ae,this.invProjMatrix=_.invert([],this.projMatrix);var Ce=this.width%2/2,we=this.height%2/2,ke=Math.cos(this.angle),Qe=Math.sin(this.angle),Ye=I-Math.round(I)+ke*Ce+Qe*we,mt=L-Math.round(L)+ke*we+Qe*Ce,je=new Float64Array(ae);if(_.translate(je,je,[Ye>.5?Ye-1:Ye,mt>.5?mt-1:mt,0]),this.alignedProjMatrix=je,ae=_.create(),_.scale(ae,ae,[this.width/2,-this.height/2,1]),_.translate(ae,ae,[1,-1,0]),this.labelPlaneMatrix=ae,ae=_.create(),_.scale(ae,ae,[1,-1,1]),_.translate(ae,ae,[-1,-1,0]),_.scale(ae,ae,[2/this.width,2/this.height,1]),this.glCoordMatrix=ae,this.pixelMatrix=_.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(ae=_.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=ae,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Vn.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var f=this.pointCoordinate(new _.Point(0,0)),d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return _.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},Vn.prototype.getCameraPoint=function(){var f=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new _.Point(0,f))},Vn.prototype.getCameraQueryGeometry=function(f){var d=this.getCameraPoint();if(f.length===1)return[f[0],d];for(var h=d.x,y=d.y,C=d.x,I=d.y,L=0,B=f;L<B.length;L+=1){var Y=B[L];h=Math.min(h,Y.x),y=Math.min(y,Y.y),C=Math.max(C,Y.x),I=Math.max(I,Y.y)}return[new _.Point(h,y),new _.Point(C,y),new _.Point(C,I),new _.Point(h,I),new _.Point(h,y)]},Object.defineProperties(Vn.prototype,Ni);var Xa=function(f){var d,h,y,C;this._hashName=f&&encodeURIComponent(f),_.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(d=this._updateHashUnthrottled.bind(this),h=!1,y=null,C=function(){y=null,h&&(d(),y=setTimeout(C,300),h=!1)},function(){return h=!0,y||C(),y})};Xa.prototype.addTo=function(f){return this._map=f,_.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Xa.prototype.remove=function(){return _.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Xa.prototype.getHashString=function(f){var d=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,y=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,y),I=Math.round(d.lng*C)/C,L=Math.round(d.lat*C)/C,B=this._map.getBearing(),Y=this._map.getPitch(),ae="";if(ae+=f?"/"+I+"/"+L+"/"+h:h+"/"+L+"/"+I,(B||Y)&&(ae+="/"+Math.round(10*B)/10),Y&&(ae+="/"+Math.round(Y)),this._hashName){var Ce=this._hashName,we=!1,ke=_.window.location.hash.slice(1).split("&").map(function(Qe){var Ye=Qe.split("=")[0];return Ye===Ce?(we=!0,Ye+"="+ae):Qe}).filter(function(Qe){return Qe});return we||ke.push(Ce+"="+ae),"#"+ke.join("&")}return"#"+ae},Xa.prototype._getCurrentHash=function(){var f,d=this,h=_.window.location.hash.replace("#","");return this._hashName?(h.split("&").map(function(y){return y.split("=")}).forEach(function(y){y[0]===d._hashName&&(f=y)}),(f&&f[1]||"").split("/")):h.split("/")},Xa.prototype._onHashChange=function(){var f=this._getCurrentHash();if(f.length>=3&&!f.some(function(h){return isNaN(h)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:d,pitch:+(f[4]||0)}),!0}return!1},Xa.prototype._updateHashUnthrottled=function(){var f=_.window.location.href.replace(/(#.+)?$/,this.getHashString());try{_.window.history.replaceState(_.window.history.state,null,f)}catch(d){}};var co={linearity:.3,easing:_.bezier(0,0,.3,1)},Ul=_.extend({deceleration:2500,maxSpeed:1400},co),Th=_.extend({deceleration:20,maxSpeed:1400},co),ou=_.extend({deceleration:1e3,maxSpeed:360},co),Mh=_.extend({deceleration:1e3,maxSpeed:90},co),$f=function(f){this._map=f,this.clear()};function bc(f,d){(!f.duration||f.duration<d.duration)&&(f.duration=d.duration,f.easing=d.easing)}function il(f,d,h){var y=h.maxSpeed,C=h.linearity,I=h.deceleration,L=_.clamp(f*C/(d/1e3),-y,y),B=Math.abs(L)/(I*C);return{easing:h.easing,duration:1e3*B,amount:L*(B/2)}}$f.prototype.clear=function(){this._inertiaBuffer=[]},$f.prototype.record=function(f){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:_.browser.now(),settings:f})},$f.prototype._drainInertiaBuffer=function(){for(var f=this._inertiaBuffer,d=_.browser.now();f.length>0&&d-f[0].time>160;)f.shift()},$f.prototype._onMoveEnd=function(f){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var d={zoom:0,bearing:0,pitch:0,pan:new _.Point(0,0),pinchAround:void 0,around:void 0},h=0,y=this._inertiaBuffer;h<y.length;h+=1){var C=y[h].settings;d.zoom+=C.zoomDelta||0,d.bearing+=C.bearingDelta||0,d.pitch+=C.pitchDelta||0,C.panDelta&&d.pan._add(C.panDelta),C.around&&(d.around=C.around),C.pinchAround&&(d.pinchAround=C.pinchAround)}var I=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,L={};if(d.pan.mag()){var B=il(d.pan.mag(),I,_.extend({},Ul,f||{}));L.offset=d.pan.mult(B.amount/d.pan.mag()),L.center=this._map.transform.center,bc(L,B)}if(d.zoom){var Y=il(d.zoom,I,Th);L.zoom=this._map.transform.zoom+Y.amount,bc(L,Y)}if(d.bearing){var ae=il(d.bearing,I,ou);L.bearing=this._map.transform.bearing+_.clamp(ae.amount,-179,179),bc(L,ae)}if(d.pitch){var Ce=il(d.pitch,I,Mh);L.pitch=this._map.transform.pitch+Ce.amount,bc(L,Ce)}if(L.zoom||L.bearing){var we=d.pinchAround===void 0?d.around:d.pinchAround;L.around=we?this._map.unproject(we):this._map.getCenter()}return this.clear(),_.extend(L,{noMoveStart:!0})}};var ys=function(f){function d(y,C,I,L){L===void 0&&(L={});var B=K.mousePos(C.getCanvasContainer(),I),Y=C.unproject(B);f.call(this,y,_.extend({point:B,lngLat:Y,originalEvent:I},L)),this._defaultPrevented=!1,this.target=C}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(_.Event),go=function(f){function d(y,C,I){var L=y==="touchend"?I.changedTouches:I.touches,B=K.touchPos(C.getCanvasContainer(),L),Y=B.map(function(we){return C.unproject(we)}),ae=B.reduce(function(we,ke,Qe,Ye){return we.add(ke.div(Ye.length))},new _.Point(0,0)),Ce=C.unproject(ae);f.call(this,y,{points:B,point:ae,lngLats:Y,lngLat:Ce,originalEvent:I}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(_.Event),Yf=function(f){function d(y,C,I){f.call(this,y,{originalEvent:I}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(_.Event),_s=function(f,d){this._map=f,this._clickTolerance=d.clickTolerance};_s.prototype.reset=function(){delete this._mousedownPos},_s.prototype.wheel=function(f){return this._firePreventable(new Yf(f.type,this._map,f))},_s.prototype.mousedown=function(f,d){return this._mousedownPos=d,this._firePreventable(new ys(f.type,this._map,f))},_s.prototype.mouseup=function(f){this._map.fire(new ys(f.type,this._map,f))},_s.prototype.click=function(f,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new ys(f.type,this._map,f))},_s.prototype.dblclick=function(f){return this._firePreventable(new ys(f.type,this._map,f))},_s.prototype.mouseover=function(f){this._map.fire(new ys(f.type,this._map,f))},_s.prototype.mouseout=function(f){this._map.fire(new ys(f.type,this._map,f))},_s.prototype.touchstart=function(f){return this._firePreventable(new go(f.type,this._map,f))},_s.prototype.touchmove=function(f){this._map.fire(new go(f.type,this._map,f))},_s.prototype.touchend=function(f){this._map.fire(new go(f.type,this._map,f))},_s.prototype.touchcancel=function(f){this._map.fire(new go(f.type,this._map,f))},_s.prototype._firePreventable=function(f){if(this._map.fire(f),f.defaultPrevented)return{}},_s.prototype.isEnabled=function(){return!0},_s.prototype.isActive=function(){return!1},_s.prototype.enable=function(){},_s.prototype.disable=function(){};var Gn=function(f){this._map=f};Gn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Gn.prototype.mousemove=function(f){this._map.fire(new ys(f.type,this._map,f))},Gn.prototype.mousedown=function(){this._delayContextMenu=!0},Gn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ys("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Gn.prototype.contextmenu=function(f){this._delayContextMenu?this._contextMenuEvent=f:this._map.fire(new ys(f.type,this._map,f)),this._map.listens("contextmenu")&&f.preventDefault()},Gn.prototype.isEnabled=function(){return!0},Gn.prototype.isActive=function(){return!1},Gn.prototype.enable=function(){},Gn.prototype.disable=function(){};var rs=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._container=f.getContainer(),this._clickTolerance=d.clickTolerance||1};function nc(f,d){for(var h={},y=0;y<f.length;y++)h[f[y].identifier]=d[y];return h}rs.prototype.isEnabled=function(){return!!this._enabled},rs.prototype.isActive=function(){return!!this._active},rs.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},rs.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},rs.prototype.mousedown=function(f,d){this.isEnabled()&&f.shiftKey&&f.button===0&&(K.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)},rs.prototype.mousemoveWindow=function(f,d){if(this._active){var h=d;if(!(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)){var y=this._startPos;this._lastPos=h,this._box||(this._box=K.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",f));var C=Math.min(y.x,h.x),I=Math.max(y.x,h.x),L=Math.min(y.y,h.y),B=Math.max(y.y,h.y);K.setTransform(this._box,"translate("+C+"px,"+L+"px)"),this._box.style.width=I-C+"px",this._box.style.height=B-L+"px"}}},rs.prototype.mouseupWindow=function(f,d){var h=this;if(this._active&&f.button===0){var y=this._startPos,C=d;if(this.reset(),K.suppressClick(),y.x!==C.x||y.y!==C.y)return this._map.fire(new _.Event("boxzoomend",{originalEvent:f})),{cameraAnimation:function(I){return I.fitScreenCoordinates(y,C,h._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",f)}},rs.prototype.keydown=function(f){this._active&&f.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",f))},rs.prototype.blur=function(){this.reset()},rs.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(K.remove(this._box),this._box=null),K.enableDrag(),delete this._startPos,delete this._lastPos},rs.prototype._fireEvent=function(f,d){return this._map.fire(new _.Event(f,{originalEvent:d}))};var nf=function(f){this.reset(),this.numTouches=f.numTouches};nf.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},nf.prototype.touchstart=function(f,d,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=f.timeStamp),h.length===this.numTouches&&(this.centroid=function(y){for(var C=new _.Point(0,0),I=0,L=y;I<L.length;I+=1)C._add(L[I]);return C.div(y.length)}(d),this.touches=nc(h,d)))},nf.prototype.touchmove=function(f,d,h){if(!this.aborted&&this.centroid){var y=nc(h,d);for(var C in this.touches){var I=y[C];(!I||I.dist(this.touches[C])>30)&&(this.aborted=!0)}}},nf.prototype.touchend=function(f,d,h){if((!this.centroid||f.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){var y=!this.aborted&&this.centroid;if(this.reset(),y)return y}};var Du=function(f){this.singleTap=new nf(f),this.numTaps=f.numTaps,this.reset()};Du.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Du.prototype.touchstart=function(f,d,h){this.singleTap.touchstart(f,d,h)},Du.prototype.touchmove=function(f,d,h){this.singleTap.touchmove(f,d,h)},Du.prototype.touchend=function(f,d,h){var y=this.singleTap.touchend(f,d,h);if(y){var C=f.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(y)<30;if(C&&I||this.reset(),this.count++,this.lastTime=f.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}};var Is=function(){this._zoomIn=new Du({numTouches:1,numTaps:2}),this._zoomOut=new Du({numTouches:2,numTaps:1}),this.reset()};Is.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Is.prototype.touchstart=function(f,d,h){this._zoomIn.touchstart(f,d,h),this._zoomOut.touchstart(f,d,h)},Is.prototype.touchmove=function(f,d,h){this._zoomIn.touchmove(f,d,h),this._zoomOut.touchmove(f,d,h)},Is.prototype.touchend=function(f,d,h){var y=this,C=this._zoomIn.touchend(f,d,h),I=this._zoomOut.touchend(f,d,h);return C?(this._active=!0,f.preventDefault(),setTimeout(function(){return y.reset()},0),{cameraAnimation:function(L){return L.easeTo({duration:300,zoom:L.getZoom()+1,around:L.unproject(C)},{originalEvent:f})}}):I?(this._active=!0,f.preventDefault(),setTimeout(function(){return y.reset()},0),{cameraAnimation:function(L){return L.easeTo({duration:300,zoom:L.getZoom()-1,around:L.unproject(I)},{originalEvent:f})}}):void 0},Is.prototype.touchcancel=function(){this.reset()},Is.prototype.enable=function(){this._enabled=!0},Is.prototype.disable=function(){this._enabled=!1,this.reset()},Is.prototype.isEnabled=function(){return this._enabled},Is.prototype.isActive=function(){return this._active};var af={0:1,2:2},Sn=function(f){this.reset(),this._clickTolerance=f.clickTolerance||1};Sn.prototype.blur=function(){this.reset()},Sn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Sn.prototype._correctButton=function(f,d){return!1},Sn.prototype._move=function(f,d){return{}},Sn.prototype.mousedown=function(f,d){if(!this._lastPoint){var h=K.mouseButton(f);this._correctButton(f,h)&&(this._lastPoint=d,this._eventButton=h)}},Sn.prototype.mousemoveWindow=function(f,d){var h=this._lastPoint;if(h){if(f.preventDefault(),function(y,C){var I=af[C];return y.buttons===void 0||(y.buttons&I)!==I}(f,this._eventButton))this.reset();else if(this._moved||!(d.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(h,d)}},Sn.prototype.mouseupWindow=function(f){this._lastPoint&&K.mouseButton(f)===this._eventButton&&(this._moved&&K.suppressClick(),this.reset())},Sn.prototype.enable=function(){this._enabled=!0},Sn.prototype.disable=function(){this._enabled=!1,this.reset()},Sn.prototype.isEnabled=function(){return this._enabled},Sn.prototype.isActive=function(){return this._active};var of=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.mousedown=function(h,y){f.prototype.mousedown.call(this,h,y),this._lastPoint&&(this._active=!0)},d.prototype._correctButton=function(h,y){return y===0&&!h.ctrlKey},d.prototype._move=function(h,y){return{around:y,panDelta:y.sub(h)}},d}(Sn),qf=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,y){return y===0&&h.ctrlKey||y===2},d.prototype._move=function(h,y){var C=.8*(y.x-h.x);if(C)return this._active=!0,{bearingDelta:C}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(Sn),Ec=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,y){return y===0&&h.ctrlKey||y===2},d.prototype._move=function(h,y){var C=-.5*(y.y-h.y);if(C)return this._active=!0,{pitchDelta:C}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(Sn),fo=function(f){this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset()};fo.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new _.Point(0,0)},fo.prototype.touchstart=function(f,d,h){return this._calculateTransform(f,d,h)},fo.prototype.touchmove=function(f,d,h){if(this._active&&!(h.length<this._minTouches))return f.preventDefault(),this._calculateTransform(f,d,h)},fo.prototype.touchend=function(f,d,h){this._calculateTransform(f,d,h),this._active&&h.length<this._minTouches&&this.reset()},fo.prototype.touchcancel=function(){this.reset()},fo.prototype._calculateTransform=function(f,d,h){h.length>0&&(this._active=!0);var y=nc(h,d),C=new _.Point(0,0),I=new _.Point(0,0),L=0;for(var B in y){var Y=y[B],ae=this._touches[B];ae&&(C._add(Y),I._add(Y.sub(ae)),L++,y[B]=Y)}if(this._touches=y,!(L<this._minTouches)&&I.mag()){var Ce=I.div(L);if(this._sum._add(Ce),!(this._sum.mag()<this._clickTolerance))return{around:C.div(L),panDelta:Ce}}},fo.prototype.enable=function(){this._enabled=!0},fo.prototype.disable=function(){this._enabled=!1,this.reset()},fo.prototype.isEnabled=function(){return this._enabled},fo.prototype.isActive=function(){return this._active};var Bu=function(){this.reset()};function Dc(f,d,h){for(var y=0;y<f.length;y++)if(f[y].identifier===h)return d[y]}function Nu(f,d){return Math.log(f/d)/Math.LN2}Bu.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Bu.prototype._start=function(f){},Bu.prototype._move=function(f,d,h){return{}},Bu.prototype.touchstart=function(f,d,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([d[0],d[1]]))},Bu.prototype.touchmove=function(f,d,h){if(this._firstTwoTouches){f.preventDefault();var y=this._firstTwoTouches,C=y[1],I=Dc(h,d,y[0]),L=Dc(h,d,C);if(I&&L){var B=this._aroundCenter?null:I.add(L).div(2);return this._move([I,L],B,f)}}},Bu.prototype.touchend=function(f,d,h){if(this._firstTwoTouches){var y=this._firstTwoTouches,C=y[1],I=Dc(h,d,y[0]),L=Dc(h,d,C);I&&L||(this._active&&K.suppressClick(),this.reset())}},Bu.prototype.touchcancel=function(){this.reset()},Bu.prototype.enable=function(f){this._enabled=!0,this._aroundCenter=!!f&&f.around==="center"},Bu.prototype.disable=function(){this._enabled=!1,this.reset()},Bu.prototype.isEnabled=function(){return this._enabled},Bu.prototype.isActive=function(){return this._active};var su=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._distance,delete this._startDistance},d.prototype._start=function(h){this._startDistance=this._distance=h[0].dist(h[1])},d.prototype._move=function(h,y){var C=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(Nu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Nu(this._distance,C),pinchAround:y}},d}(Bu);function ic(f,d){return 180*f.angleWith(d)/Math.PI}var xp=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},d.prototype._start=function(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])},d.prototype._move=function(h,y){var C=this._vector;if(this._vector=h[0].sub(h[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ic(this._vector,C),pinchAround:y}},d.prototype._isBelowThreshold=function(h){this._minDiameter=Math.min(this._minDiameter,h.mag());var y=25/(Math.PI*this._minDiameter)*360,C=ic(h,this._startVector);return Math.abs(C)<y},d}(Bu);function sf(f){return Math.abs(f.y)>Math.abs(f.x)}var Bc=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},d.prototype._start=function(h){this._lastPoints=h,sf(h[0].sub(h[1]))&&(this._valid=!1)},d.prototype._move=function(h,y,C){var I=h[0].sub(this._lastPoints[0]),L=h[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(I,L,C.timeStamp),this._valid)return this._lastPoints=h,this._active=!0,{pitchDelta:(I.y+L.y)/2*-.5}},d.prototype.gestureBeginsVertically=function(h,y,C){if(this._valid!==void 0)return this._valid;var I=h.mag()>=2,L=y.mag()>=2;if(I||L){if(!I||!L)return this._firstMove===void 0&&(this._firstMove=C),C-this._firstMove<100&&void 0;var B=h.y>0==y.y>0;return sf(h)&&sf(y)&&B}},d}(Bu),Rf={panStep:100,bearingStep:15,pitchStep:10},al=function(){var f=Rf;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1};function dl(f){return f*(2-f)}al.prototype.blur=function(){this.reset()},al.prototype.reset=function(){this._active=!1},al.prototype.keydown=function(f){var d=this;if(!(f.altKey||f.ctrlKey||f.metaKey)){var h=0,y=0,C=0,I=0,L=0;switch(f.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:f.shiftKey?y=-1:(f.preventDefault(),I=-1);break;case 39:f.shiftKey?y=1:(f.preventDefault(),I=1);break;case 38:f.shiftKey?C=1:(f.preventDefault(),L=-1);break;case 40:f.shiftKey?C=-1:(f.preventDefault(),L=1);break;default:return}return this._rotationDisabled&&(y=0,C=0),{cameraAnimation:function(B){var Y=B.getZoom();B.easeTo({duration:300,easeId:"keyboardHandler",easing:dl,zoom:h?Math.round(Y)+h*(f.shiftKey?2:1):Y,bearing:B.getBearing()+y*d._bearingStep,pitch:B.getPitch()+C*d._pitchStep,offset:[-I*d._panStep,-L*d._panStep],center:B.getCenter()},{originalEvent:f})}}}},al.prototype.enable=function(){this._enabled=!0},al.prototype.disable=function(){this._enabled=!1,this.reset()},al.prototype.isEnabled=function(){return this._enabled},al.prototype.isActive=function(){return this._active},al.prototype.disableRotation=function(){this._rotationDisabled=!0},al.prototype.enableRotation=function(){this._rotationDisabled=!1};var ga=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,_.bindAll(["_onTimeout"],this)};ga.prototype.setZoomRate=function(f){this._defaultZoomRate=f},ga.prototype.setWheelZoomRate=function(f){this._wheelZoomRate=f},ga.prototype.isEnabled=function(){return!!this._enabled},ga.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},ga.prototype.isZooming=function(){return!!this._zooming},ga.prototype.enable=function(f){this.isEnabled()||(this._enabled=!0,this._aroundCenter=f&&f.around==="center")},ga.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ga.prototype.wheel=function(f){if(this.isEnabled()){var d=f.deltaMode===_.window.WheelEvent.DOM_DELTA_LINE?40*f.deltaY:f.deltaY,h=_.browser.now(),y=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,f)):this._type||(this._type=Math.abs(y*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),f.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=f,this._delta-=d,this._active||this._start(f)),f.preventDefault()}},ga.prototype._onTimeout=function(f){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},ga.prototype._start=function(f){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var d=K.mousePos(this._el,f);this._around=_.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},ga.prototype.renderFrame=function(){var f=this;if(this._frameId&&(this._frameId=null,this.isActive())){var d=this._map.transform;if(this._delta!==0){var h=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,y=2/(1+Math.exp(-Math.abs(this._delta*h)));this._delta<0&&y!==0&&(y=1/y);var C=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(C*y))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var I,L=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,B=this._startZoom,Y=this._easing,ae=!1;if(this._type==="wheel"&&B&&Y){var Ce=Math.min((_.browser.now()-this._lastWheelEventTime)/200,1),we=Y(Ce);I=_.number(B,L,we),Ce<1?this._frameId||(this._frameId=!0):ae=!0}else I=L,ae=!0;return this._active=!0,ae&&(this._active=!1,this._finishTimeout=setTimeout(function(){f._zooming=!1,f._handler._triggerRenderFrame(),delete f._targetZoom,delete f._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ae,zoomDelta:I-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},ga.prototype._smoothOutEasing=function(f){var d=_.ease;if(this._prevEase){var h=this._prevEase,y=(_.browser.now()-h.start)/h.duration,C=h.easing(y+.01)-h.easing(y),I=.27/Math.sqrt(C*C+1e-4)*.01,L=Math.sqrt(.0729-I*I);d=_.bezier(I,L,.25,1)}return this._prevEase={start:_.browser.now(),duration:f,easing:d},d},ga.prototype.blur=function(){this.reset()},ga.prototype.reset=function(){this._active=!1};var ac=function(f,d){this._clickZoom=f,this._tapZoom=d};ac.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ac.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ac.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ac.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var vl=function(){this.reset()};vl.prototype.reset=function(){this._active=!1},vl.prototype.blur=function(){this.reset()},vl.prototype.dblclick=function(f,d){return f.preventDefault(),{cameraAnimation:function(h){h.easeTo({duration:300,zoom:h.getZoom()+(f.shiftKey?-1:1),around:h.unproject(d)},{originalEvent:f})}}},vl.prototype.enable=function(){this._enabled=!0},vl.prototype.disable=function(){this._enabled=!1,this.reset()},vl.prototype.isEnabled=function(){return this._enabled},vl.prototype.isActive=function(){return this._active};var Ya=function(){this._tap=new Du({numTouches:1,numTaps:1}),this.reset()};Ya.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Ya.prototype.touchstart=function(f,d,h){this._swipePoint||(this._tapTime&&f.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=d[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(f,d,h))},Ya.prototype.touchmove=function(f,d,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;var y=d[0],C=y.y-this._swipePoint.y;return this._swipePoint=y,f.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(f,d,h)},Ya.prototype.touchend=function(f,d,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(f,d,h)&&(this._tapTime=f.timeStamp)},Ya.prototype.touchcancel=function(){this.reset()},Ya.prototype.enable=function(){this._enabled=!0},Ya.prototype.disable=function(){this._enabled=!1,this.reset()},Ya.prototype.isEnabled=function(){return this._enabled},Ya.prototype.isActive=function(){return this._active};var xs=function(f,d,h){this._el=f,this._mousePan=d,this._touchPan=h};xs.prototype.enable=function(f){this._inertiaOptions=f||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},xs.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},xs.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},xs.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Nc=function(f,d,h){this._pitchWithRotate=f.pitchWithRotate,this._mouseRotate=d,this._mousePitch=h};Nc.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Nc.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Nc.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Nc.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Yo=function(f,d,h,y){this._el=f,this._touchZoom=d,this._touchRotate=h,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0};Yo.prototype.enable=function(f){this._touchZoom.enable(f),this._rotationDisabled||this._touchRotate.enable(f),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Yo.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Yo.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Yo.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Yo.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Yo.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var bu=function(f){return f.zoom||f.drag||f.pitch||f.rotate},wa=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d}(_.Event);function mi(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}var ai=function(f,d){this._map=f,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new $f(f),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),_.bindAll(["handleEvent","handleWindowEvent"],this);var h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[_.window.document,"mousemove",{capture:!0}],[_.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[_.window,"blur",void 0]];for(var y=0,C=this._listeners;y<C.length;y+=1){var I=C[y],L=I[0];K.addEventListener(L,I[1],L===_.window.document?this.handleWindowEvent:this.handleEvent,I[2])}};ai.prototype.destroy=function(){for(var f=0,d=this._listeners;f<d.length;f+=1){var h=d[f],y=h[0];K.removeEventListener(y,h[1],y===_.window.document?this.handleWindowEvent:this.handleEvent,h[2])}},ai.prototype._addDefaultHandlers=function(f){var d=this._map,h=d.getCanvasContainer();this._add("mapEvent",new _s(d,f));var y=d.boxZoom=new rs(d,f);this._add("boxZoom",y);var C=new Is,I=new vl;d.doubleClickZoom=new ac(I,C),this._add("tapZoom",C),this._add("clickZoom",I);var L=new Ya;this._add("tapDragZoom",L);var B=d.touchPitch=new Bc;this._add("touchPitch",B);var Y=new qf(f),ae=new Ec(f);d.dragRotate=new Nc(f,Y,ae),this._add("mouseRotate",Y,["mousePitch"]),this._add("mousePitch",ae,["mouseRotate"]);var Ce=new of(f),we=new fo(f);d.dragPan=new xs(h,Ce,we),this._add("mousePan",Ce),this._add("touchPan",we,["touchZoom","touchRotate"]);var ke=new xp,Qe=new su;d.touchZoomRotate=new Yo(h,Qe,ke,L),this._add("touchRotate",ke,["touchPan","touchZoom"]),this._add("touchZoom",Qe,["touchPan","touchRotate"]);var Ye=d.scrollZoom=new ga(d,this);this._add("scrollZoom",Ye,["mousePan"]);var mt=d.keyboard=new al;this._add("keyboard",mt),this._add("blockableMapEvent",new Gn(d));for(var je=0,dt=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];je<dt.length;je+=1){var vt=dt[je];f.interactive&&f[vt]&&d[vt].enable(f[vt])}},ai.prototype._add=function(f,d,h){this._handlers.push({handlerName:f,handler:d,allowed:h}),this._handlersById[f]=d},ai.prototype.stop=function(f){if(!this._updatingCamera){for(var d=0,h=this._handlers;d<h.length;d+=1)h[d].handler.reset();this._inertia.clear(),this._fireEvents({},{},f),this._changes=[]}},ai.prototype.isActive=function(){for(var f=0,d=this._handlers;f<d.length;f+=1)if(d[f].handler.isActive())return!0;return!1},ai.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},ai.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},ai.prototype.isMoving=function(){return Boolean(bu(this._eventsInProgress))||this.isZooming()},ai.prototype._blockedByActive=function(f,d,h){for(var y in f)if(y!==h&&(!d||d.indexOf(y)<0))return!0;return!1},ai.prototype.handleWindowEvent=function(f){this.handleEvent(f,f.type+"Window")},ai.prototype._getMapTouches=function(f){for(var d=[],h=0,y=f;h<y.length;h+=1){var C=y[h];this._el.contains(C.target)&&d.push(C)}return d},ai.prototype.handleEvent=function(f,d){this._updatingCamera=!0;for(var h=f.type==="renderFrame"?void 0:f,y={needsRenderFrame:!1},C={},I={},L=f.touches?this._getMapTouches(f.touches):void 0,B=L?K.touchPos(this._el,L):K.mousePos(this._el,f),Y=0,ae=this._handlers;Y<ae.length;Y+=1){var Ce=ae[Y],we=Ce.handlerName,ke=Ce.handler,Qe=Ce.allowed;if(ke.isEnabled()){var Ye=void 0;this._blockedByActive(I,Qe,we)?ke.reset():ke[d||f.type]&&(Ye=ke[d||f.type](f,B,L),this.mergeHandlerResult(y,C,Ye,we,h),Ye&&Ye.needsRenderFrame&&this._triggerRenderFrame()),(Ye||ke.isActive())&&(I[we]=ke)}}var mt={};for(var je in this._previousActiveHandlers)I[je]||(mt[je]=h);this._previousActiveHandlers=I,(Object.keys(mt).length||mi(y))&&(this._changes.push([y,C,mt]),this._triggerRenderFrame()),(Object.keys(I).length||mi(y))&&this._map._stop(!0),this._updatingCamera=!1;var dt=y.cameraAnimation;dt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],dt(this._map))},ai.prototype.mergeHandlerResult=function(f,d,h,y,C){if(h){_.extend(f,h);var I={handlerName:y,originalEvent:h.originalEvent||C};h.zoomDelta!==void 0&&(d.zoom=I),h.panDelta!==void 0&&(d.drag=I),h.pitchDelta!==void 0&&(d.pitch=I),h.bearingDelta!==void 0&&(d.rotate=I)}},ai.prototype._applyChanges=function(){for(var f={},d={},h={},y=0,C=this._changes;y<C.length;y+=1){var I=C[y],L=I[0],B=I[1],Y=I[2];L.panDelta&&(f.panDelta=(f.panDelta||new _.Point(0,0))._add(L.panDelta)),L.zoomDelta&&(f.zoomDelta=(f.zoomDelta||0)+L.zoomDelta),L.bearingDelta&&(f.bearingDelta=(f.bearingDelta||0)+L.bearingDelta),L.pitchDelta&&(f.pitchDelta=(f.pitchDelta||0)+L.pitchDelta),L.around!==void 0&&(f.around=L.around),L.pinchAround!==void 0&&(f.pinchAround=L.pinchAround),L.noInertia&&(f.noInertia=L.noInertia),_.extend(d,B),_.extend(h,Y)}this._updateMapTransform(f,d,h),this._changes=[]},ai.prototype._updateMapTransform=function(f,d,h){var y=this._map,C=y.transform;if(!mi(f))return this._fireEvents(d,h,!0);var I=f.panDelta,L=f.zoomDelta,B=f.bearingDelta,Y=f.pitchDelta,ae=f.around,Ce=f.pinchAround;Ce!==void 0&&(ae=Ce),y._stop(!0),ae=ae||y.transform.centerPoint;var we=C.pointLocation(I?ae.sub(I):ae);B&&(C.bearing+=B),Y&&(C.pitch+=Y),L&&(C.zoom+=L),C.setLocationAtPoint(we,ae),this._map._update(),f.noInertia||this._inertia.record(f),this._fireEvents(d,h,!0)},ai.prototype._fireEvents=function(f,d,h){var y=this,C=bu(this._eventsInProgress),I=bu(f),L={};for(var B in f)this._eventsInProgress[B]||(L[B+"start"]=f[B].originalEvent),this._eventsInProgress[B]=f[B];for(var Y in!C&&I&&this._fireEvent("movestart",I.originalEvent),L)this._fireEvent(Y,L[Y]);for(var ae in I&&this._fireEvent("move",I.originalEvent),f)this._fireEvent(ae,f[ae].originalEvent);var Ce,we={};for(var ke in this._eventsInProgress){var Qe=this._eventsInProgress[ke],Ye=Qe.handlerName,mt=Qe.originalEvent;this._handlersById[Ye].isActive()||(delete this._eventsInProgress[ke],we[ke+"end"]=Ce=d[Ye]||mt)}for(var je in we)this._fireEvent(je,we[je]);var dt=bu(this._eventsInProgress);if(h&&(C||I)&&!dt){this._updatingCamera=!0;var vt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$t=function(Sr){return Sr!==0&&-y._bearingSnap<Sr&&Sr<y._bearingSnap};vt?($t(vt.bearing||this._map.getBearing())&&(vt.bearing=0),this._map.easeTo(vt,{originalEvent:Ce})):(this._map.fire(new _.Event("moveend",{originalEvent:Ce})),$t(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},ai.prototype._fireEvent=function(f,d){this._map.fire(new _.Event(f,d?{originalEvent:d}:{}))},ai.prototype._requestFrame=function(){var f=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(d){delete f._frameId,f.handleEvent(new wa("renderFrame",{timeStamp:d})),f._applyChanges()})},ai.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var uf=function(f){function d(h,y){f.call(this),this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=y.bearingSnap,_.bindAll(["_renderFrameCallback"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getCenter=function(){return new _.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(h,y){return this.jumpTo({center:h},y)},d.prototype.panBy=function(h,y,C){return h=_.Point.convert(h).mult(-1),this.panTo(this.transform.center,_.extend({offset:h},y),C)},d.prototype.panTo=function(h,y,C){return this.easeTo(_.extend({center:h},y),C)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(h,y){return this.jumpTo({zoom:h},y),this},d.prototype.zoomTo=function(h,y,C){return this.easeTo(_.extend({zoom:h},y),C)},d.prototype.zoomIn=function(h,y){return this.zoomTo(this.getZoom()+1,h,y),this},d.prototype.zoomOut=function(h,y){return this.zoomTo(this.getZoom()-1,h,y),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(h,y){return this.jumpTo({bearing:h},y),this},d.prototype.getPadding=function(){return this.transform.padding},d.prototype.setPadding=function(h,y){return this.jumpTo({padding:h},y),this},d.prototype.rotateTo=function(h,y,C){return this.easeTo(_.extend({bearing:h},y),C)},d.prototype.resetNorth=function(h,y){return this.rotateTo(0,_.extend({duration:1e3},h),y),this},d.prototype.resetNorthPitch=function(h,y){return this.easeTo(_.extend({bearing:0,pitch:0,duration:1e3},h),y),this},d.prototype.snapToNorth=function(h,y){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,y):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(h,y){return this.jumpTo({pitch:h},y),this},d.prototype.cameraForBounds=function(h,y){h=_.LngLatBounds.convert(h);var C=y&&y.bearing||0;return this._cameraForBoxAndBearing(h.getNorthWest(),h.getSouthEast(),C,y)},d.prototype._cameraForBoxAndBearing=function(h,y,C,I){var L={top:0,bottom:0,right:0,left:0};if(typeof(I=_.extend({padding:L,offset:[0,0],maxZoom:this.transform.maxZoom},I)).padding=="number"){var B=I.padding;I.padding={top:B,bottom:B,right:B,left:B}}I.padding=_.extend(L,I.padding);var Y=this.transform,ae=Y.padding,Ce=Y.project(_.LngLat.convert(h)),we=Y.project(_.LngLat.convert(y)),ke=Ce.rotate(-C*Math.PI/180),Qe=we.rotate(-C*Math.PI/180),Ye=new _.Point(Math.max(ke.x,Qe.x),Math.max(ke.y,Qe.y)),mt=new _.Point(Math.min(ke.x,Qe.x),Math.min(ke.y,Qe.y)),je=Ye.sub(mt),dt=(Y.width-(ae.left+ae.right+I.padding.left+I.padding.right))/je.x,vt=(Y.height-(ae.top+ae.bottom+I.padding.top+I.padding.bottom))/je.y;if(!(vt<0||dt<0)){var $t=Math.min(Y.scaleZoom(Y.scale*Math.min(dt,vt)),I.maxZoom),Sr=typeof I.offset.x=="number"?new _.Point(I.offset.x,I.offset.y):_.Point.convert(I.offset),yr=new _.Point((I.padding.left-I.padding.right)/2,(I.padding.top-I.padding.bottom)/2).rotate(C*Math.PI/180),wr=Sr.add(yr).mult(Y.scale/Y.zoomScale($t));return{center:Y.unproject(Ce.add(we).div(2).sub(wr)),zoom:$t,bearing:C}}_.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},d.prototype.fitBounds=function(h,y,C){return this._fitInternal(this.cameraForBounds(h,y),y,C)},d.prototype.fitScreenCoordinates=function(h,y,C,I,L){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(_.Point.convert(h)),this.transform.pointLocation(_.Point.convert(y)),C,I),I,L)},d.prototype._fitInternal=function(h,y,C){return h?(delete(y=_.extend(h,y)).padding,y.linear?this.easeTo(y,C):this.flyTo(y,C)):this},d.prototype.jumpTo=function(h,y){this.stop();var C=this.transform,I=!1,L=!1,B=!1;return"zoom"in h&&C.zoom!==+h.zoom&&(I=!0,C.zoom=+h.zoom),h.center!==void 0&&(C.center=_.LngLat.convert(h.center)),"bearing"in h&&C.bearing!==+h.bearing&&(L=!0,C.bearing=+h.bearing),"pitch"in h&&C.pitch!==+h.pitch&&(B=!0,C.pitch=+h.pitch),h.padding==null||C.isPaddingEqual(h.padding)||(C.padding=h.padding),this.fire(new _.Event("movestart",y)).fire(new _.Event("move",y)),I&&this.fire(new _.Event("zoomstart",y)).fire(new _.Event("zoom",y)).fire(new _.Event("zoomend",y)),L&&this.fire(new _.Event("rotatestart",y)).fire(new _.Event("rotate",y)).fire(new _.Event("rotateend",y)),B&&this.fire(new _.Event("pitchstart",y)).fire(new _.Event("pitch",y)).fire(new _.Event("pitchend",y)),this.fire(new _.Event("moveend",y))},d.prototype.easeTo=function(h,y){var C=this;this._stop(!1,h.easeId),((h=_.extend({offset:[0,0],duration:500,easing:_.ease},h)).animate===!1||!h.essential&&_.browser.prefersReducedMotion)&&(h.duration=0);var I=this.transform,L=this.getZoom(),B=this.getBearing(),Y=this.getPitch(),ae=this.getPadding(),Ce="zoom"in h?+h.zoom:L,we="bearing"in h?this._normalizeBearing(h.bearing,B):B,ke="pitch"in h?+h.pitch:Y,Qe="padding"in h?h.padding:I.padding,Ye=_.Point.convert(h.offset),mt=I.centerPoint.add(Ye),je=I.pointLocation(mt),dt=_.LngLat.convert(h.center||je);this._normalizeCenter(dt);var vt,$t,Sr=I.project(je),yr=I.project(dt).sub(Sr),wr=I.zoomScale(Ce-L);h.around&&(vt=_.LngLat.convert(h.around),$t=I.locationPoint(vt));var Xr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ce!==L,this._rotating=this._rotating||B!==we,this._pitching=this._pitching||ke!==Y,this._padding=!I.isPaddingEqual(Qe),this._easeId=h.easeId,this._prepareEase(y,h.noMoveStart,Xr),this._ease(function(yn){if(C._zooming&&(I.zoom=_.number(L,Ce,yn)),C._rotating&&(I.bearing=_.number(B,we,yn)),C._pitching&&(I.pitch=_.number(Y,ke,yn)),C._padding&&(I.interpolatePadding(ae,Qe,yn),mt=I.centerPoint.add(Ye)),vt)I.setLocationAtPoint(vt,$t);else{var ln=I.zoomScale(I.zoom-L),Bn=Ce>L?Math.min(2,wr):Math.max(.5,wr),ei=Math.pow(Bn,1-yn),_i=I.unproject(Sr.add(yr.mult(yn*ei)).mult(ln));I.setLocationAtPoint(I.renderWorldCopies?_i.wrap():_i,mt)}C._fireMoveEvents(y)},function(yn){C._afterEase(y,yn)},h),this},d.prototype._prepareEase=function(h,y,C){C===void 0&&(C={}),this._moving=!0,y||C.moving||this.fire(new _.Event("movestart",h)),this._zooming&&!C.zooming&&this.fire(new _.Event("zoomstart",h)),this._rotating&&!C.rotating&&this.fire(new _.Event("rotatestart",h)),this._pitching&&!C.pitching&&this.fire(new _.Event("pitchstart",h))},d.prototype._fireMoveEvents=function(h){this.fire(new _.Event("move",h)),this._zooming&&this.fire(new _.Event("zoom",h)),this._rotating&&this.fire(new _.Event("rotate",h)),this._pitching&&this.fire(new _.Event("pitch",h))},d.prototype._afterEase=function(h,y){if(!this._easeId||!y||this._easeId!==y){delete this._easeId;var C=this._zooming,I=this._rotating,L=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,C&&this.fire(new _.Event("zoomend",h)),I&&this.fire(new _.Event("rotateend",h)),L&&this.fire(new _.Event("pitchend",h)),this.fire(new _.Event("moveend",h))}},d.prototype.flyTo=function(h,y){var C=this;if(!h.essential&&_.browser.prefersReducedMotion){var I=_.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(I,y)}this.stop(),h=_.extend({offset:[0,0],speed:1.2,curve:1.42,easing:_.ease},h);var L=this.transform,B=this.getZoom(),Y=this.getBearing(),ae=this.getPitch(),Ce=this.getPadding(),we="zoom"in h?_.clamp(+h.zoom,L.minZoom,L.maxZoom):B,ke="bearing"in h?this._normalizeBearing(h.bearing,Y):Y,Qe="pitch"in h?+h.pitch:ae,Ye="padding"in h?h.padding:L.padding,mt=L.zoomScale(we-B),je=_.Point.convert(h.offset),dt=L.centerPoint.add(je),vt=L.pointLocation(dt),$t=_.LngLat.convert(h.center||vt);this._normalizeCenter($t);var Sr=L.project(vt),yr=L.project($t).sub(Sr),wr=h.curve,Xr=Math.max(L.width,L.height),yn=Xr/mt,ln=yr.mag();if("minZoom"in h){var Bn=_.clamp(Math.min(h.minZoom,B,we),L.minZoom,L.maxZoom),ei=Xr/L.zoomScale(Bn-B);wr=Math.sqrt(ei/ln*2)}var _i=wr*wr;function gi(Ii){var wi=(yn*yn-Xr*Xr+(Ii?-1:1)*_i*_i*ln*ln)/(2*(Ii?yn:Xr)*_i*ln);return Math.log(Math.sqrt(wi*wi+1)-wi)}function Ki(Ii){return(Math.exp(Ii)-Math.exp(-Ii))/2}function Nn(Ii){return(Math.exp(Ii)+Math.exp(-Ii))/2}var Hi=gi(0),Qi=function(Ii){return Nn(Hi)/Nn(Hi+wr*Ii)},Li=function(Ii){return Xr*((Nn(Hi)*(Ki(wi=Hi+wr*Ii)/Nn(wi))-Ki(Hi))/_i)/ln;var wi},yi=(gi(1)-Hi)/wr;if(Math.abs(ln)<1e-6||!isFinite(yi)){if(Math.abs(Xr-yn)<1e-6)return this.easeTo(h,y);var ia=yn<Xr?-1:1;yi=Math.abs(Math.log(yn/Xr))/wr,Li=function(){return 0},Qi=function(Ii){return Math.exp(ia*wr*Ii)}}return h.duration="duration"in h?+h.duration:1e3*yi/("screenSpeed"in h?+h.screenSpeed/wr:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0),this._zooming=!0,this._rotating=Y!==ke,this._pitching=Qe!==ae,this._padding=!L.isPaddingEqual(Ye),this._prepareEase(y,!1),this._ease(function(Ii){var wi=Ii*yi,cs=1/Qi(wi);L.zoom=Ii===1?we:B+L.scaleZoom(cs),C._rotating&&(L.bearing=_.number(Y,ke,Ii)),C._pitching&&(L.pitch=_.number(ae,Qe,Ii)),C._padding&&(L.interpolatePadding(Ce,Ye,Ii),dt=L.centerPoint.add(je));var Po=Ii===1?$t:L.unproject(Sr.add(yr.mult(Li(wi))).mult(cs));L.setLocationAtPoint(L.renderWorldCopies?Po.wrap():Po,dt),C._fireMoveEvents(y)},function(){return C._afterEase(y)},h),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){return this._stop()},d.prototype._stop=function(h,y){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var C=this._onEaseEnd;delete this._onEaseEnd,C.call(this,y)}if(!h){var I=this.handlers;I&&I.stop(!1)}return this},d.prototype._ease=function(h,y,C){C.animate===!1||C.duration===0?(h(1),y()):(this._easeStart=_.browser.now(),this._easeOptions=C,this._onEaseFrame=h,this._onEaseEnd=y,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var h=Math.min((_.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(h,y){h=_.wrap(h,-180,180);var C=Math.abs(h-y);return Math.abs(h-360-y)<C&&(h-=360),Math.abs(h+360-y)<C&&(h+=360),h},d.prototype._normalizeCenter=function(h){var y=this.transform;if(y.renderWorldCopies&&!y.lngRange){var C=h.lng-y.center.lng;h.lng+=C>180?-360:C<-180?360:0}},d}(_.Evented),ks=function(f){f===void 0&&(f={}),this.options=f,_.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ks.prototype.getDefaultPosition=function(){return"bottom-right"},ks.prototype.onAdd=function(f){var d=this.options&&this.options.compact;return this._map=f,this._container=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=K.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=K.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ks.prototype.onRemove=function(){K.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ks.prototype._setElementTitle=function(f,d){var h=this._map._getUIString("AttributionControl."+d);f.title=h,f.setAttribute("aria-label",h)},ks.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ks.prototype._updateEditLink=function(){var f=this._editLink;f||(f=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||_.config.ACCESS_TOKEN}];if(f){var h=d.reduce(function(y,C,I){return C.value&&(y+=C.key+"="+C.value+(I<d.length-1?"&":"")),y},"?");f.href=_.config.FEEDBACK_URL+"/"+h+(this._map._hash?this._map._hash.getHashString(!0):""),f.rel="noopener nofollow",this._setElementTitle(f,"MapFeedback")}},ks.prototype._updateData=function(f){!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ks.prototype._updateAttributions=function(){if(this._map.style){var f=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?f=f.concat(this.options.customAttribution.map(function(B){return typeof B!="string"?"":B})):typeof this.options.customAttribution=="string"&&f.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var h=this._map.style.sourceCaches;for(var y in h){var C=h[y];if(C.used){var I=C.getSource();I.attribution&&f.indexOf(I.attribution)<0&&f.push(I.attribution)}}f.sort(function(B,Y){return B.length-Y.length});var L=(f=f.filter(function(B,Y){for(var ae=Y+1;ae<f.length;ae++)if(f[ae].indexOf(B)>=0)return!1;return!0})).join(" | ");L!==this._attribHTML&&(this._attribHTML=L,f.length?(this._innerContainer.innerHTML=L,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ks.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var ku=function(){_.bindAll(["_updateLogo"],this),_.bindAll(["_updateCompact"],this)};ku.prototype.onAdd=function(f){this._map=f,this._container=K.create("div","mapboxgl-ctrl");var d=K.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},ku.prototype.onRemove=function(){K.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},ku.prototype.getDefaultPosition=function(){return"bottom-left"},ku.prototype._updateLogo=function(f){f&&f.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},ku.prototype._logoRequired=function(){if(this._map.style){var f=this._map.style.sourceCaches;for(var d in f)if(f[d].getSource().mapbox_logo)return!0;return!1}},ku.prototype._updateCompact=function(){var f=this._container.children;if(f.length){var d=f[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var ls=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};ls.prototype.add=function(f){var d=++this._id;return this._queue.push({callback:f,id:d,cancelled:!1}),d},ls.prototype.remove=function(f){for(var d=this._currentlyRunning,h=0,y=d?this._queue.concat(d):this._queue;h<y.length;h+=1){var C=y[h];if(C.id===f)return void(C.cancelled=!0)}},ls.prototype.run=function(f){f===void 0&&(f=0);var d=this._currentlyRunning=this._queue;this._queue=[];for(var h=0,y=d;h<y.length;h+=1){var C=y[h];if(!C.cancelled&&(C.callback(f),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},ls.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var ol={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Vl=_.window.HTMLImageElement,Kf=_.window.HTMLElement,qa=_.window.ImageBitmap,zo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},bp=function(f){function d(y){var C=this;if((y=_.extend({},zo,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var I=new Vn(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies);if(f.call(this,I,y),this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new ls,this._controls=[],this._mapId=_.uniqueId(),this._locale=_.extend({},ol,y.locale),this._clickTolerance=y.clickTolerance,this._requestManager=new _.RequestManager(y.transformRequest,y.accessToken),typeof y.container=="string"){if(this._container=_.window.document.getElementById(y.container),!this._container)throw new Error("Container '"+y.container+"' not found.")}else{if(!(y.container instanceof Kf))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),_.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return C._update(!1)}),this.on("moveend",function(){return C._update(!1)}),this.on("zoom",function(){return C._update(!0)}),_.window!==void 0&&(_.window.addEventListener("online",this._onWindowOnline,!1),_.window.addEventListener("resize",this._onWindowResize,!1),_.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new ai(this,y),this._hash=y.hash&&new Xa(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,_.extend({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new ks({customAttribution:y.customAttribution})),this.addControl(new ku,y.logoPosition),this.on("style.load",function(){C.transform.unmodified&&C.jumpTo(C.style.stylesheet)}),this.on("data",function(L){C._update(L.dataType==="style"),C.fire(new _.Event(L.dataType+"data",L))}),this.on("dataloading",function(L){C.fire(new _.Event(L.dataType+"dataloading",L))})}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(y,C){if(C===void 0&&(C=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new _.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var I=y.onAdd(this);this._controls.push(y);var L=this._controlPositions[C];return C.indexOf("bottom")!==-1?L.insertBefore(I,L.firstChild):L.appendChild(I),this},d.prototype.removeControl=function(y){if(!y||!y.onRemove)return this.fire(new _.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var C=this._controls.indexOf(y);return C>-1&&this._controls.splice(C,1),y.onRemove(this),this},d.prototype.hasControl=function(y){return this._controls.indexOf(y)>-1},d.prototype.resize=function(y){var C=this._containerDimensions(),I=C[0],L=C[1];if(I===this.transform.width&&L===this.transform.height)return this;this._resizeCanvas(I,L),this.transform.resize(I,L),this.painter.resize(I,L);var B=!this._moving;return B&&this.fire(new _.Event("movestart",y)).fire(new _.Event("move",y)),this.fire(new _.Event("resize",y)),B&&this.fire(new _.Event("moveend",y)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(y){return this.transform.setMaxBounds(_.LngLatBounds.convert(y)),this._update()},d.prototype.setMinZoom=function(y){if((y=y==null?-2:y)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(y){if((y=y==null?22:y)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(y){if((y=y==null?0:y)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(y){if((y=y==null?60:y)>60)throw new Error("maxPitch must be less than or equal to 60");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(y){return this.transform.renderWorldCopies=y,this._update()},d.prototype.project=function(y){return this.transform.locationPoint(_.LngLat.convert(y))},d.prototype.unproject=function(y){return this.transform.pointLocation(_.Point.convert(y))},d.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},d.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},d.prototype._createDelegatedListener=function(y,C,I){var L,B=this;if(y==="mouseenter"||y==="mouseover"){var Y=!1;return{layer:C,listener:I,delegates:{mousemove:function(Ce){var we=B.getLayer(C)?B.queryRenderedFeatures(Ce.point,{layers:[C]}):[];we.length?Y||(Y=!0,I.call(B,new ys(y,B,Ce.originalEvent,{features:we}))):Y=!1},mouseout:function(){Y=!1}}}}if(y==="mouseleave"||y==="mouseout"){var ae=!1;return{layer:C,listener:I,delegates:{mousemove:function(Ce){(B.getLayer(C)?B.queryRenderedFeatures(Ce.point,{layers:[C]}):[]).length?ae=!0:ae&&(ae=!1,I.call(B,new ys(y,B,Ce.originalEvent)))},mouseout:function(Ce){ae&&(ae=!1,I.call(B,new ys(y,B,Ce.originalEvent)))}}}}return{layer:C,listener:I,delegates:(L={},L[y]=function(Ce){var we=B.getLayer(C)?B.queryRenderedFeatures(Ce.point,{layers:[C]}):[];we.length&&(Ce.features=we,I.call(B,Ce),delete Ce.features)},L)}},d.prototype.on=function(y,C,I){if(I===void 0)return f.prototype.on.call(this,y,C);var L=this._createDelegatedListener(y,C,I);for(var B in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(L),L.delegates)this.on(B,L.delegates[B]);return this},d.prototype.once=function(y,C,I){if(I===void 0)return f.prototype.once.call(this,y,C);var L=this._createDelegatedListener(y,C,I);for(var B in L.delegates)this.once(B,L.delegates[B]);return this},d.prototype.off=function(y,C,I){var L=this;return I===void 0?f.prototype.off.call(this,y,C):(this._delegatedListeners&&this._delegatedListeners[y]&&function(B){for(var Y=B[y],ae=0;ae<Y.length;ae++){var Ce=Y[ae];if(Ce.layer===C&&Ce.listener===I){for(var we in Ce.delegates)L.off(we,Ce.delegates[we]);return Y.splice(ae,1),L}}}(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(y,C){if(!this.style)return[];var I;if(C!==void 0||y===void 0||y instanceof _.Point||Array.isArray(y)||(C=y,y=void 0),C=C||{},(y=y||[[0,0],[this.transform.width,this.transform.height]])instanceof _.Point||typeof y[0]=="number")I=[_.Point.convert(y)];else{var L=_.Point.convert(y[0]),B=_.Point.convert(y[1]);I=[L,new _.Point(B.x,L.y),B,new _.Point(L.x,B.y),L]}return this.style.queryRenderedFeatures(I,C,this.transform)},d.prototype.querySourceFeatures=function(y,C){return this.style.querySourceFeatures(y,C)},d.prototype.setStyle=function(y,C){return(C=_.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},C)).diff!==!1&&C.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,C),this):(this._localIdeographFontFamily=C.localIdeographFontFamily,this._updateStyle(y,C))},d.prototype._getUIString=function(y){var C=this._locale[y];if(C==null)throw new Error("Missing UI string '"+y+"'");return C},d.prototype._updateStyle=function(y,C){return this.style&&(this.style.setEventedParent(null),this.style._remove()),y?(this.style=new Mu(this,C||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y):this.style.loadJSON(y),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Mu(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(y,C){var I=this;if(typeof y=="string"){var L=this._requestManager.normalizeStyleURL(y),B=this._requestManager.transformRequest(L,_.ResourceType.Style);_.getJSON(B,function(Y,ae){Y?I.fire(new _.ErrorEvent(Y)):ae&&I._updateDiff(ae,C)})}else typeof y=="object"&&this._updateDiff(y,C)},d.prototype._updateDiff=function(y,C){try{this.style.setState(y)&&this._update(!0)}catch(I){_.warnOnce("Unable to perform style diff: "+(I.message||I.error||I)+".  Rebuilding the style from scratch."),this._updateStyle(y,C)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():_.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(y,C){return this._lazyInitEmptyStyle(),this.style.addSource(y,C),this._update(!0)},d.prototype.isSourceLoaded=function(y){var C=this.style&&this.style.sourceCaches[y];if(C!==void 0)return C.loaded();this.fire(new _.ErrorEvent(new Error("There is no source with ID '"+y+"'")))},d.prototype.areTilesLoaded=function(){var y=this.style&&this.style.sourceCaches;for(var C in y){var I=y[C]._tiles;for(var L in I){var B=I[L];if(B.state!=="loaded"&&B.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(y,C,I){return this._lazyInitEmptyStyle(),this.style.addSourceType(y,C,I)},d.prototype.removeSource=function(y){return this.style.removeSource(y),this._update(!0)},d.prototype.getSource=function(y){return this.style.getSource(y)},d.prototype.addImage=function(y,C,I){I===void 0&&(I={});var L=I.pixelRatio;L===void 0&&(L=1);var B=I.sdf;B===void 0&&(B=!1);var Y=I.stretchX,ae=I.stretchY,Ce=I.content;if(this._lazyInitEmptyStyle(),C instanceof Vl||qa&&C instanceof qa){var we=_.browser.getImageData(C);this.style.addImage(y,{data:new _.RGBAImage({width:we.width,height:we.height},we.data),pixelRatio:L,stretchX:Y,stretchY:ae,content:Ce,sdf:B,version:0})}else{if(C.width===void 0||C.height===void 0)return this.fire(new _.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var ke=C;this.style.addImage(y,{data:new _.RGBAImage({width:C.width,height:C.height},new Uint8Array(C.data)),pixelRatio:L,stretchX:Y,stretchY:ae,content:Ce,sdf:B,version:0,userImage:ke}),ke.onAdd&&ke.onAdd(this,y)}},d.prototype.updateImage=function(y,C){var I=this.style.getImage(y);if(!I)return this.fire(new _.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var L=C instanceof Vl||qa&&C instanceof qa?_.browser.getImageData(C):C,B=L.width,Y=L.height,ae=L.data;return B===void 0||Y===void 0?this.fire(new _.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):B!==I.data.width||Y!==I.data.height?this.fire(new _.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(I.data.replace(ae,!(C instanceof Vl||qa&&C instanceof qa)),void this.style.updateImage(y,I))},d.prototype.hasImage=function(y){return y?!!this.style.getImage(y):(this.fire(new _.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(y){this.style.removeImage(y)},d.prototype.loadImage=function(y,C){_.getImage(this._requestManager.transformRequest(y,_.ResourceType.Image),C)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(y,C){return this._lazyInitEmptyStyle(),this.style.addLayer(y,C),this._update(!0)},d.prototype.moveLayer=function(y,C){return this.style.moveLayer(y,C),this._update(!0)},d.prototype.removeLayer=function(y){return this.style.removeLayer(y),this._update(!0)},d.prototype.getLayer=function(y){return this.style.getLayer(y)},d.prototype.setLayerZoomRange=function(y,C,I){return this.style.setLayerZoomRange(y,C,I),this._update(!0)},d.prototype.setFilter=function(y,C,I){return I===void 0&&(I={}),this.style.setFilter(y,C,I),this._update(!0)},d.prototype.getFilter=function(y){return this.style.getFilter(y)},d.prototype.setPaintProperty=function(y,C,I,L){return L===void 0&&(L={}),this.style.setPaintProperty(y,C,I,L),this._update(!0)},d.prototype.getPaintProperty=function(y,C){return this.style.getPaintProperty(y,C)},d.prototype.setLayoutProperty=function(y,C,I,L){return L===void 0&&(L={}),this.style.setLayoutProperty(y,C,I,L),this._update(!0)},d.prototype.getLayoutProperty=function(y,C){return this.style.getLayoutProperty(y,C)},d.prototype.setLight=function(y,C){return C===void 0&&(C={}),this._lazyInitEmptyStyle(),this.style.setLight(y,C),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(y,C){return this.style.setFeatureState(y,C),this._update()},d.prototype.removeFeatureState=function(y,C){return this.style.removeFeatureState(y,C),this._update()},d.prototype.getFeatureState=function(y){return this.style.getFeatureState(y)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var y=0,C=0;return this._container&&(y=this._container.clientWidth||400,C=this._container.clientHeight||300),[y,C]},d.prototype._detectMissingCSS=function(){_.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&_.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var y=this._container;y.classList.add("mapboxgl-map"),(this._missingCSSCanary=K.create("div","mapboxgl-canary",y)).style.visibility="hidden",this._detectMissingCSS();var C=this._canvasContainer=K.create("div","mapboxgl-canvas-container",y);this._interactive&&C.classList.add("mapboxgl-interactive"),this._canvas=K.create("canvas","mapboxgl-canvas",C),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var I=this._containerDimensions();this._resizeCanvas(I[0],I[1]);var L=this._controlContainer=K.create("div","mapboxgl-control-container",y),B=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(Y){B[Y]=K.create("div","mapboxgl-ctrl-"+Y,L)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},d.prototype._resizeCanvas=function(y,C){var I=_.browser.devicePixelRatio||1;this._canvas.width=I*y,this._canvas.height=I*C,this._canvas.style.width=y+"px",this._canvas.style.height=C+"px"},d.prototype._setupPainter=function(){var y=_.extend({},Pe.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),C=this._canvas.getContext("webgl",y)||this._canvas.getContext("experimental-webgl",y);C?(this.painter=new kt(C,this.transform),_.webpSupported.testSupport(C)):this.fire(new _.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(y){y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new _.Event("webglcontextlost",{originalEvent:y}))},d.prototype._contextRestored=function(y){this._setupPainter(),this.resize(),this._update(),this.fire(new _.Event("webglcontextrestored",{originalEvent:y}))},d.prototype._onMapScroll=function(y){if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(y){return this.style?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(y){return this._update(),this._renderTaskQueue.add(y)},d.prototype._cancelRenderFrame=function(y){this._renderTaskQueue.remove(y)},d.prototype._render=function(y){var C,I=this,L=0,B=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(C=B.createQueryEXT(),B.beginQueryEXT(B.TIME_ELAPSED_EXT,C),L=_.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),!this._removed){var Y=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var ae=this.transform.zoom,Ce=_.browser.now();this.style.zoomHistory.update(ae,Ce);var we=new _.EvaluationParameters(ae,{now:Ce,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ke=we.crossFadingFactor();ke===1&&ke===this._crossFadingFactor||(Y=!0,this._crossFadingFactor=ke),this.style.update(we)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new _.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new _.Event("load"))),this.style&&(this.style.hasTransitions()||Y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Qe=_.browser.now()-L;B.endQueryEXT(B.TIME_ELAPSED_EXT,C),setTimeout(function(){var je=B.getQueryObjectEXT(C,B.QUERY_RESULT_EXT)/1e6;B.deleteQueryEXT(C),I.fire(new _.Event("gpu-timing-frame",{cpuTime:Qe,gpuTime:je}))},50)}if(this.listens("gpu-timing-layer")){var Ye=this.painter.collectGpuTimers();setTimeout(function(){var je=I.painter.queryGpuTimers(Ye);I.fire(new _.Event("gpu-timing-layer",{layerTimes:je}))},50)}var mt=this._sourcesDirty||this._styleDirty||this._placementDirty;return mt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new _.Event("idle")),!this._loaded||this._fullyLoaded||mt||(this._fullyLoaded=!0),this}},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var y=0,C=this._controls;y<C.length;y+=1)C[y].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),_.window!==void 0&&(_.window.removeEventListener("resize",this._onWindowResize,!1),_.window.removeEventListener("orientationchange",this._onWindowResize,!1),_.window.removeEventListener("online",this._onWindowOnline,!1));var I=this.painter.context.gl.getExtension("WEBGL_lose_context");I&&I.loseContext(),zc(this._canvasContainer),zc(this._controlContainer),zc(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new _.Event("remove"))},d.prototype.triggerRepaint=function(){var y=this;this.style&&!this._frame&&(this._frame=_.browser.frame(function(C){y._frame=null,y._render(C)}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(y){this._trackResize&&this.resize({originalEvent:y})._update()},h.showTileBoundaries.get=function(){return!!this._showTileBoundaries},h.showTileBoundaries.set=function(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())},h.showPadding.get=function(){return!!this._showPadding},h.showPadding.set=function(y){this._showPadding!==y&&(this._showPadding=y,this._update())},h.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},h.showCollisionBoxes.set=function(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())},h.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},h.showOverdrawInspector.set=function(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())},h.repaint.get=function(){return!!this._repaint},h.repaint.set=function(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())},h.vertices.get=function(){return!!this._vertices},h.vertices.set=function(y){this._vertices=y,this._update()},d.prototype._setCacheLimits=function(y,C){_.setCacheLimits(y,C)},h.version.get=function(){return _.version},Object.defineProperties(d.prototype,h),d}(uf);function zc(f){f.parentNode&&f.parentNode.removeChild(f)}var sl={showCompass:!0,showZoom:!0,visualizePitch:!1},zu=function(f){var d=this;this.options=_.extend({},sl,f),this._container=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(h){return h.preventDefault()}),this.options.showZoom&&(_.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(h){return d._map.zoomIn({},{originalEvent:h})}),K.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(h){return d._map.zoomOut({},{originalEvent:h})}),K.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(_.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(h){d.options.visualizePitch?d._map.resetNorthPitch({},{originalEvent:h}):d._map.resetNorth({},{originalEvent:h})}),this._compassIcon=K.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};zu.prototype._updateZoomButtons=function(){var f=this._map.getZoom(),d=f===this._map.getMaxZoom(),h=f===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},zu.prototype._rotateCompassArrow=function(){var f=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=f},zu.prototype.onAdd=function(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new bs(this._map,this._compass,this.options.visualizePitch)),this._container},zu.prototype.onRemove=function(){K.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},zu.prototype._createButton=function(f,d){var h=K.create("button",f,this._container);return h.type="button",h.addEventListener("click",d),h},zu.prototype._setButtonTitle=function(f,d){var h=this._map._getUIString("NavigationControl."+d);f.title=h,f.setAttribute("aria-label",h)};var bs=function(f,d,h){h===void 0&&(h=!1),this._clickTolerance=10,this.element=d,this.mouseRotate=new qf({clickTolerance:f.dragRotate._mouseRotate._clickTolerance}),this.map=f,h&&(this.mousePitch=new Ec({clickTolerance:f.dragRotate._mousePitch._clickTolerance})),_.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),K.addEventListener(d,"mousedown",this.mousedown),K.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),K.addEventListener(d,"touchmove",this.touchmove),K.addEventListener(d,"touchend",this.touchend),K.addEventListener(d,"touchcancel",this.reset)};function Ie(f,d,h){if(f=new _.LngLat(f.lng,f.lat),d){var y=new _.LngLat(f.lng-360,f.lat),C=new _.LngLat(f.lng+360,f.lat),I=h.locationPoint(f).distSqr(d);h.locationPoint(y).distSqr(d)<I?f=y:h.locationPoint(C).distSqr(d)<I&&(f=C)}for(;Math.abs(f.lng-h.center.lng)>180;){var L=h.locationPoint(f);if(L.x>=0&&L.y>=0&&L.x<=h.width&&L.y<=h.height)break;f.lng>h.center.lng?f.lng-=360:f.lng+=360}return f}bs.prototype.down=function(f,d){this.mouseRotate.mousedown(f,d),this.mousePitch&&this.mousePitch.mousedown(f,d),K.disableDrag()},bs.prototype.move=function(f,d){var h=this.map,y=this.mouseRotate.mousemoveWindow(f,d);if(y&&y.bearingDelta&&h.setBearing(h.getBearing()+y.bearingDelta),this.mousePitch){var C=this.mousePitch.mousemoveWindow(f,d);C&&C.pitchDelta&&h.setPitch(h.getPitch()+C.pitchDelta)}},bs.prototype.off=function(){var f=this.element;K.removeEventListener(f,"mousedown",this.mousedown),K.removeEventListener(f,"touchstart",this.touchstart,{passive:!1}),K.removeEventListener(f,"touchmove",this.touchmove),K.removeEventListener(f,"touchend",this.touchend),K.removeEventListener(f,"touchcancel",this.reset),this.offTemp()},bs.prototype.offTemp=function(){K.enableDrag(),K.removeEventListener(_.window,"mousemove",this.mousemove),K.removeEventListener(_.window,"mouseup",this.mouseup)},bs.prototype.mousedown=function(f){this.down(_.extend({},f,{ctrlKey:!0,preventDefault:function(){return f.preventDefault()}}),K.mousePos(this.element,f)),K.addEventListener(_.window,"mousemove",this.mousemove),K.addEventListener(_.window,"mouseup",this.mouseup)},bs.prototype.mousemove=function(f){this.move(f,K.mousePos(this.element,f))},bs.prototype.mouseup=function(f){this.mouseRotate.mouseupWindow(f),this.mousePitch&&this.mousePitch.mouseupWindow(f),this.offTemp()},bs.prototype.touchstart=function(f){f.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=K.touchPos(this.element,f.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return f.preventDefault()}},this._startPos))},bs.prototype.touchmove=function(f){f.targetTouches.length!==1?this.reset():(this._lastPos=K.touchPos(this.element,f.targetTouches)[0],this.move({preventDefault:function(){return f.preventDefault()}},this._lastPos))},bs.prototype.touchend=function(f){f.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},bs.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Qs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Sc(f,d,h){var y=f.classList;for(var C in Qs)y.remove("mapboxgl-"+h+"-anchor-"+C);y.add("mapboxgl-"+h+"-anchor-"+d)}var Js,Ba=function(f){function d(h,y){if(f.call(this),(h instanceof _.window.HTMLElement||y)&&(h=_.extend({element:h},y)),_.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment!=="auto"?h.pitchAlignment:this._rotationAlignment,h&&h.element)this._element=h.element,this._offset=_.Point.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=K.create("div"),this._element.setAttribute("aria-label","Map marker");var C=K.createNS("http://www.w3.org/2000/svg","svg");C.setAttributeNS(null,"display","block"),C.setAttributeNS(null,"height","41px"),C.setAttributeNS(null,"width","27px"),C.setAttributeNS(null,"viewBox","0 0 27 41");var I=K.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"stroke","none"),I.setAttributeNS(null,"stroke-width","1"),I.setAttributeNS(null,"fill","none"),I.setAttributeNS(null,"fill-rule","evenodd");var L=K.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"fill-rule","nonzero");var B=K.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(3.0, 29.0)"),B.setAttributeNS(null,"fill","#000000");for(var Y=0,ae=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];Y<ae.length;Y+=1){var Ce=ae[Y],we=K.createNS("http://www.w3.org/2000/svg","ellipse");we.setAttributeNS(null,"opacity","0.04"),we.setAttributeNS(null,"cx","10.5"),we.setAttributeNS(null,"cy","5.80029008"),we.setAttributeNS(null,"rx",Ce.rx),we.setAttributeNS(null,"ry",Ce.ry),B.appendChild(we)}var ke=K.createNS("http://www.w3.org/2000/svg","g");ke.setAttributeNS(null,"fill",this._color);var Qe=K.createNS("http://www.w3.org/2000/svg","path");Qe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),ke.appendChild(Qe);var Ye=K.createNS("http://www.w3.org/2000/svg","g");Ye.setAttributeNS(null,"opacity","0.25"),Ye.setAttributeNS(null,"fill","#000000");var mt=K.createNS("http://www.w3.org/2000/svg","path");mt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ye.appendChild(mt);var je=K.createNS("http://www.w3.org/2000/svg","g");je.setAttributeNS(null,"transform","translate(6.0, 7.0)"),je.setAttributeNS(null,"fill","#FFFFFF");var dt=K.createNS("http://www.w3.org/2000/svg","g");dt.setAttributeNS(null,"transform","translate(8.0, 8.0)");var vt=K.createNS("http://www.w3.org/2000/svg","circle");vt.setAttributeNS(null,"fill","#000000"),vt.setAttributeNS(null,"opacity","0.25"),vt.setAttributeNS(null,"cx","5.5"),vt.setAttributeNS(null,"cy","5.5"),vt.setAttributeNS(null,"r","5.4999962");var $t=K.createNS("http://www.w3.org/2000/svg","circle");$t.setAttributeNS(null,"fill","#FFFFFF"),$t.setAttributeNS(null,"cx","5.5"),$t.setAttributeNS(null,"cy","5.5"),$t.setAttributeNS(null,"r","5.4999962"),dt.appendChild(vt),dt.appendChild($t),L.appendChild(B),L.appendChild(ke),L.appendChild(Ye),L.appendChild(je),L.appendChild(dt),C.appendChild(L),C.setAttributeNS(null,"height",41*this._scale+"px"),C.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(C),this._offset=_.Point.convert(h&&h.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Sr){Sr.preventDefault()}),this._element.addEventListener("mousedown",function(Sr){Sr.preventDefault()}),Sc(this._element,this._anchor,"marker"),this._popup=null}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._update),h.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),K.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=_.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){var y=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(24.6+y)],"bottom-right":[-y,-1*(24.6+y)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=h,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(h){var y=h.code,C=h.charCode||h.keyCode;y!=="Space"&&y!=="Enter"&&C!==32&&C!==13||this.togglePopup()},d.prototype._onMapClick=function(h){var y=h.originalEvent.target,C=this._element;this._popup&&(y===C||C.contains(y))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var h=this._popup;return h?(h.isOpen()?h.remove():h.addTo(this._map),this):this},d.prototype._update=function(h){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Ie(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(y="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var C="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?C="rotateX(0deg)":this._pitchAlignment==="map"&&(C="rotateX("+this._map.getPitch()+"deg)"),h&&h.type!=="moveend"||(this._pos=this._pos.round()),K.setTransform(this._element,Qs[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+C+" "+y)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(h){return this._offset=_.Point.convert(h),this._update(),this},d.prototype._onMove=function(h){if(!this._isDragging){var y=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=y}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new _.Event("dragstart"))),this.fire(new _.Event("drag")))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new _.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(h){this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(h){return this._draggable=!!h,this._map&&(h?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(h){return this._rotation=h||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(h){return this._rotationAlignment=h||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(h){return this._pitchAlignment=h&&h!=="auto"?h:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d}(_.Evented),Oa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ll=0,Zu=!1,Gl=function(f){function d(h){f.call(this),this.options=_.extend({},Oa,h),_.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){var y;return this._map=h,this._container=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),y=this._setupUI,Js!==void 0?y(Js):_.window.navigator.permissions!==void 0?_.window.navigator.permissions.query({name:"geolocation"}).then(function(C){y(Js=C.state!=="denied")}):y(Js=!!_.window.navigator.geolocation),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(_.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),K.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ll=0,Zu=!1},d.prototype._isOutOfMapMaxBounds=function(h){var y=this._map.getMaxBounds(),C=h.coords;return y&&(C.longitude<y.getWest()||C.longitude>y.getEast()||C.latitude<y.getSouth()||C.latitude>y.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new _.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new _.Event("geolocate",h)),this._finish()}},d.prototype._updateCamera=function(h){var y=new _.LngLat(h.coords.longitude,h.coords.latitude),C=h.coords.accuracy,I=this._map.getBearing(),L=_.extend({bearing:I},this.options.fitBoundsOptions);this._map.fitBounds(y.toBounds(C),L,{geolocateSource:!0})},d.prototype._updateMarker=function(h){if(h){var y=new _.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(y).addTo(this._map),this._userLocationDotMarker.setLngLat(y).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var h=this._map._container.clientHeight/2,y=this._map.unproject([0,h]),C=this._map.unproject([1,h]),I=y.distanceTo(C),L=Math.ceil(2*this._accuracy/I);this._circleElement.style.width=L+"px",this._circleElement.style.height=L+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=y,this._geolocateButton.setAttribute("aria-label",y),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&Zu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new _.Event("error",h)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(h){var y=this;if(this._container.addEventListener("contextmenu",function(L){return L.preventDefault()}),this._geolocateButton=K.create("button","mapboxgl-ctrl-geolocate",this._container),K.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",h===!1){_.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var C=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C)}else{var I=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=I,this._geolocateButton.setAttribute("aria-label",I)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=K.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ba(this._dotElement),this._circleElement=K.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ba({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(L){L.geolocateSource||y._watchState!=="ACTIVE_LOCK"||L.originalEvent&&L.originalEvent.type==="resize"||(y._watchState="BACKGROUND",y._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),y._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),y.fire(new _.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return _.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new _.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ll--,Zu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new _.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new _.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Ll>1?(h={maximumAge:6e5,timeout:0},Zu=!0):(h=this.options.positionOptions,Zu=!1),this._geolocationWatchID=_.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else _.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){_.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d}(_.Evented),Zc={maxWidth:100,unit:"metric"},Uc=function(f){this.options=_.extend({},Zc,f),_.bindAll(["_onMove","setUnit"],this)};function Ih(f,d,h){var y=h&&h.maxWidth||100,C=f._container.clientHeight/2,I=f.unproject([0,C]),L=f.unproject([y,C]),B=I.distanceTo(L);if(h&&h.unit==="imperial"){var Y=3.2808*B;Y>5280?Vc(d,y,Y/5280,f._getUIString("ScaleControl.Miles")):Vc(d,y,Y,f._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Vc(d,y,B/1852,f._getUIString("ScaleControl.NauticalMiles")):B>=1e3?Vc(d,y,B/1e3,f._getUIString("ScaleControl.Kilometers")):Vc(d,y,B,f._getUIString("ScaleControl.Meters"))}function Vc(f,d,h,y){var C,I,L,B=(C=h,(I=Math.pow(10,(""+Math.floor(C)).length-1))*(L=(L=C/I)>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(Y){var ae=Math.pow(10,Math.ceil(-Math.log(Y)/Math.LN10));return Math.round(Y*ae)/ae}(L)));f.style.width=d*(B/h)+"px",f.innerHTML=B+"&nbsp;"+y}Uc.prototype.getDefaultPosition=function(){return"bottom-left"},Uc.prototype._onMove=function(){Ih(this._map,this._container,this.options)},Uc.prototype.onAdd=function(f){return this._map=f,this._container=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Uc.prototype.onRemove=function(){K.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Uc.prototype.setUnit=function(f){this.options.unit=f,Ih(this._map,this._container,this.options)};var Uu=function(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof _.window.HTMLElement?this._container=f.container:_.warnOnce("Full screen control 'container' must be a DOM element.")),_.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in _.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in _.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in _.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in _.window.document&&(this._fullscreenchange="MSFullscreenChange")};Uu.prototype.onAdd=function(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",_.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Uu.prototype.onRemove=function(){K.remove(this._controlContainer),this._map=null,_.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Uu.prototype._checkFullscreenSupport=function(){return!!(_.window.document.fullscreenEnabled||_.window.document.mozFullScreenEnabled||_.window.document.msFullscreenEnabled||_.window.document.webkitFullscreenEnabled)},Uu.prototype._setupUI=function(){var f=this._fullscreenButton=K.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);K.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),_.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Uu.prototype._updateTitle=function(){var f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f},Uu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Uu.prototype._isFullscreen=function(){return this._fullscreen},Uu.prototype._changeIcon=function(){(_.window.document.fullscreenElement||_.window.document.mozFullScreenElement||_.window.document.webkitFullscreenElement||_.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Uu.prototype._onClickFullscreen=function(){this._isFullscreen()?_.window.document.exitFullscreen?_.window.document.exitFullscreen():_.window.document.mozCancelFullScreen?_.window.document.mozCancelFullScreen():_.window.document.msExitFullscreen?_.window.document.msExitFullscreen():_.window.document.webkitCancelFullScreen&&_.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var ul={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},jl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Lf=function(f){function d(h){f.call(this),this.options=_.extend(Object.create(ul),h),_.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new _.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&K.remove(this._content),this._container&&(K.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new _.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=_.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(h){return this.setDOMContent(_.window.document.createTextNode(h))},d.prototype.setHTML=function(h){var y,C=_.window.document.createDocumentFragment(),I=_.window.document.createElement("body");for(I.innerHTML=h;y=I.firstChild;)C.appendChild(y);return this.setDOMContent(C)},d.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},d.prototype.setMaxWidth=function(h){return this.options.maxWidth=h,this._update(),this},d.prototype.setDOMContent=function(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=K.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this},d.prototype.addClassName=function(h){this._container&&this._container.classList.add(h)},d.prototype.removeClassName=function(h){this._container&&this._container.classList.remove(h)},d.prototype.setOffset=function(h){return this.options.offset=h,this._update(),this},d.prototype.toggleClassName=function(h){if(this._container)return this._container.classList.toggle(h)},d.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=K.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._onMouseUp=function(h){this._update(h.point)},d.prototype._onMouseMove=function(h){this._update(h.point)},d.prototype._onDrag=function(h){this._update(h.point)},d.prototype._update=function(h){var y=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=K.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=K.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(we){return y._container.classList.add(we)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ie(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h)){var C=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),I=this.options.anchor,L=function we(ke){if(ke){if(typeof ke=="number"){var Qe=Math.round(Math.sqrt(.5*Math.pow(ke,2)));return{center:new _.Point(0,0),top:new _.Point(0,ke),"top-left":new _.Point(Qe,Qe),"top-right":new _.Point(-Qe,Qe),bottom:new _.Point(0,-ke),"bottom-left":new _.Point(Qe,-Qe),"bottom-right":new _.Point(-Qe,-Qe),left:new _.Point(ke,0),right:new _.Point(-ke,0)}}if(ke instanceof _.Point||Array.isArray(ke)){var Ye=_.Point.convert(ke);return{center:Ye,top:Ye,"top-left":Ye,"top-right":Ye,bottom:Ye,"bottom-left":Ye,"bottom-right":Ye,left:Ye,right:Ye}}return{center:_.Point.convert(ke.center||[0,0]),top:_.Point.convert(ke.top||[0,0]),"top-left":_.Point.convert(ke["top-left"]||[0,0]),"top-right":_.Point.convert(ke["top-right"]||[0,0]),bottom:_.Point.convert(ke.bottom||[0,0]),"bottom-left":_.Point.convert(ke["bottom-left"]||[0,0]),"bottom-right":_.Point.convert(ke["bottom-right"]||[0,0]),left:_.Point.convert(ke.left||[0,0]),right:_.Point.convert(ke.right||[0,0])}}return we(new _.Point(0,0))}(this.options.offset);if(!I){var B,Y=this._container.offsetWidth,ae=this._container.offsetHeight;B=C.y+L.bottom.y<ae?["top"]:C.y>this._map.transform.height-ae?["bottom"]:[],C.x<Y/2?B.push("left"):C.x>this._map.transform.width-Y/2&&B.push("right"),I=B.length===0?"bottom":B.join("-")}var Ce=C.add(L[I]).round();K.setTransform(this._container,Qs[I]+" translate("+Ce.x+"px,"+Ce.y+"px)"),Sc(this._container,I,"popup")}},d.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var h=this._container.querySelector(jl);h&&h.focus()}},d.prototype._onClose=function(){this.remove()},d}(_.Evented),Ti={version:_.version,supported:Pe,setRTLTextPlugin:_.setRTLTextPlugin,getRTLTextPluginStatus:_.getRTLTextPluginStatus,Map:bp,NavigationControl:zu,GeolocateControl:Gl,AttributionControl:ks,ScaleControl:Uc,FullscreenControl:Uu,Popup:Lf,Marker:Ba,Style:Mu,LngLat:_.LngLat,LngLatBounds:_.LngLatBounds,Point:_.Point,MercatorCoordinate:_.MercatorCoordinate,Evented:_.Evented,config:_.config,prewarm:function(){ar().acquire(dr)},clearPrewarmedResources:function(){var f=qn;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(dr),qn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return _.config.ACCESS_TOKEN},set accessToken(f){_.config.ACCESS_TOKEN=f},get baseApiUrl(){return _.config.API_URL},set baseApiUrl(f){_.config.API_URL=f},get workerCount(){return jr.workerCount},set workerCount(f){jr.workerCount=f},get maxParallelImageRequests(){return _.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){_.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage:function(f){_.clearTileCache(f)},workerUrl:""};return Ti}),Oe})},3614:function(Yr,ge,ie){"use strict";Yr.exports=Z;var Oe=ie(80645);function Z(oe){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(oe)?oe:new Uint8Array(oe||0),this.pos=0,this.type=0,this.length=this.buf.length}Z.Varint=0,Z.Fixed64=1,Z.Bytes=2,Z.Fixed32=5;var _=(1<<16)*(1<<16),Pe=1/_,K=12,xe=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");Z.prototype={destroy:function(){this.buf=null},readFields:function(oe,Ue,H){for(H=H||this.length;this.pos<H;){var U=this.readVarint(),de=U>>3,Xe=this.pos;this.type=U&7,oe(de,Ue,this),this.pos===Xe&&this.skip(U)}return Ue},readMessage:function(oe,Ue){return this.readFields(oe,Ue,this.readVarint()+this.pos)},readFixed32:function(){var oe=It(this.buf,this.pos);return this.pos+=4,oe},readSFixed32:function(){var oe=Jt(this.buf,this.pos);return this.pos+=4,oe},readFixed64:function(){var oe=It(this.buf,this.pos)+It(this.buf,this.pos+4)*_;return this.pos+=8,oe},readSFixed64:function(){var oe=It(this.buf,this.pos)+Jt(this.buf,this.pos+4)*_;return this.pos+=8,oe},readFloat:function(){var oe=Oe.read(this.buf,this.pos,!0,23,4);return this.pos+=4,oe},readDouble:function(){var oe=Oe.read(this.buf,this.pos,!0,52,8);return this.pos+=8,oe},readVarint:function(oe){var Ue=this.buf,H,U;return U=Ue[this.pos++],H=U&127,U<128||(U=Ue[this.pos++],H|=(U&127)<<7,U<128)||(U=Ue[this.pos++],H|=(U&127)<<14,U<128)||(U=Ue[this.pos++],H|=(U&127)<<21,U<128)?H:(U=Ue[this.pos],H|=(U&15)<<28,ve(H,oe,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var oe=this.readVarint();return oe%2==1?(oe+1)/-2:oe/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var oe=this.readVarint()+this.pos,Ue=this.pos;return this.pos=oe,oe-Ue>=K&&xe?br(this.buf,Ue,oe):Ct(this.buf,Ue,oe)},readBytes:function(){var oe=this.readVarint()+this.pos,Ue=this.buf.subarray(this.pos,oe);return this.pos=oe,Ue},readPackedVarint:function(oe,Ue){if(this.type!==Z.Bytes)return oe.push(this.readVarint(Ue));var H=tt(this);for(oe=oe||[];this.pos<H;)oe.push(this.readVarint(Ue));return oe},readPackedSVarint:function(oe){if(this.type!==Z.Bytes)return oe.push(this.readSVarint());var Ue=tt(this);for(oe=oe||[];this.pos<Ue;)oe.push(this.readSVarint());return oe},readPackedBoolean:function(oe){if(this.type!==Z.Bytes)return oe.push(this.readBoolean());var Ue=tt(this);for(oe=oe||[];this.pos<Ue;)oe.push(this.readBoolean());return oe},readPackedFloat:function(oe){if(this.type!==Z.Bytes)return oe.push(this.readFloat());var Ue=tt(this);for(oe=oe||[];this.pos<Ue;)oe.push(this.readFloat());return oe},readPackedDouble:function(oe){if(this.type!==Z.Bytes)return oe.push(this.readDouble());var Ue=tt(this);for(oe=oe||[];this.pos<Ue;)oe.push(this.readDouble());return oe},readPackedFixed32:function(oe){if(this.type!==Z.Bytes)return oe.push(this.readFixed32());var Ue=tt(this);for(oe=oe||[];this.pos<Ue;)oe.push(this.readFixed32());return oe},readPackedSFixed32:function(oe){if(this.type!==Z.Bytes)return oe.push(this.readSFixed32());var Ue=tt(this);for(oe=oe||[];this.pos<Ue;)oe.push(this.readSFixed32());return oe},readPackedFixed64:function(oe){if(this.type!==Z.Bytes)return oe.push(this.readFixed64());var Ue=tt(this);for(oe=oe||[];this.pos<Ue;)oe.push(this.readFixed64());return oe},readPackedSFixed64:function(oe){if(this.type!==Z.Bytes)return oe.push(this.readSFixed64());var Ue=tt(this);for(oe=oe||[];this.pos<Ue;)oe.push(this.readSFixed64());return oe},skip:function(oe){var Ue=oe&7;if(Ue===Z.Varint)for(;this.buf[this.pos++]>127;);else if(Ue===Z.Bytes)this.pos=this.readVarint()+this.pos;else if(Ue===Z.Fixed32)this.pos+=4;else if(Ue===Z.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+Ue)},writeTag:function(oe,Ue){this.writeVarint(oe<<3|Ue)},realloc:function(oe){for(var Ue=this.length||16;Ue<this.pos+oe;)Ue*=2;if(Ue!==this.length){var H=new Uint8Array(Ue);H.set(this.buf),this.buf=H,this.length=Ue}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(oe){this.realloc(4),xt(this.buf,oe,this.pos),this.pos+=4},writeSFixed32:function(oe){this.realloc(4),xt(this.buf,oe,this.pos),this.pos+=4},writeFixed64:function(oe){this.realloc(8),xt(this.buf,oe&-1,this.pos),xt(this.buf,Math.floor(oe*Pe),this.pos+4),this.pos+=8},writeSFixed64:function(oe){this.realloc(8),xt(this.buf,oe&-1,this.pos),xt(this.buf,Math.floor(oe*Pe),this.pos+4),this.pos+=8},writeVarint:function(oe){if(oe=+oe||0,oe>268435455||oe<0){at(oe,this);return}this.realloc(4),this.buf[this.pos++]=oe&127|(oe>127?128:0),!(oe<=127)&&(this.buf[this.pos++]=(oe>>>=7)&127|(oe>127?128:0),!(oe<=127)&&(this.buf[this.pos++]=(oe>>>=7)&127|(oe>127?128:0),!(oe<=127)&&(this.buf[this.pos++]=oe>>>7&127)))},writeSVarint:function(oe){this.writeVarint(oe<0?-oe*2-1:oe*2)},writeBoolean:function(oe){this.writeVarint(Boolean(oe))},writeString:function(oe){oe=String(oe),this.realloc(oe.length*4),this.pos++;var Ue=this.pos;this.pos=$r(this.buf,oe,this.pos);var H=this.pos-Ue;H>=128&&Ft(Ue,H,this),this.pos=Ue-1,this.writeVarint(H),this.pos+=H},writeFloat:function(oe){this.realloc(4),Oe.write(this.buf,oe,this.pos,!0,23,4),this.pos+=4},writeDouble:function(oe){this.realloc(8),Oe.write(this.buf,oe,this.pos,!0,52,8),this.pos+=8},writeBytes:function(oe){var Ue=oe.length;this.writeVarint(Ue),this.realloc(Ue);for(var H=0;H<Ue;H++)this.buf[this.pos++]=oe[H]},writeRawMessage:function(oe,Ue){this.pos++;var H=this.pos;oe(Ue,this);var U=this.pos-H;U>=128&&Ft(H,U,this),this.pos=H-1,this.writeVarint(U),this.pos+=U},writeMessage:function(oe,Ue,H){this.writeTag(oe,Z.Bytes),this.writeRawMessage(Ue,H)},writePackedVarint:function(oe,Ue){Ue.length&&this.writeMessage(oe,mr,Ue)},writePackedSVarint:function(oe,Ue){Ue.length&&this.writeMessage(oe,jt,Ue)},writePackedBoolean:function(oe,Ue){Ue.length&&this.writeMessage(oe,Dt,Ue)},writePackedFloat:function(oe,Ue){Ue.length&&this.writeMessage(oe,hr,Ue)},writePackedDouble:function(oe,Ue){Ue.length&&this.writeMessage(oe,qt,Ue)},writePackedFixed32:function(oe,Ue){Ue.length&&this.writeMessage(oe,Pt,Ue)},writePackedSFixed32:function(oe,Ue){Ue.length&&this.writeMessage(oe,Cr,Ue)},writePackedFixed64:function(oe,Ue){Ue.length&&this.writeMessage(oe,ne,Ue)},writePackedSFixed64:function(oe,Ue){Ue.length&&this.writeMessage(oe,gr,Ue)},writeBytesField:function(oe,Ue){this.writeTag(oe,Z.Bytes),this.writeBytes(Ue)},writeFixed32Field:function(oe,Ue){this.writeTag(oe,Z.Fixed32),this.writeFixed32(Ue)},writeSFixed32Field:function(oe,Ue){this.writeTag(oe,Z.Fixed32),this.writeSFixed32(Ue)},writeFixed64Field:function(oe,Ue){this.writeTag(oe,Z.Fixed64),this.writeFixed64(Ue)},writeSFixed64Field:function(oe,Ue){this.writeTag(oe,Z.Fixed64),this.writeSFixed64(Ue)},writeVarintField:function(oe,Ue){this.writeTag(oe,Z.Varint),this.writeVarint(Ue)},writeSVarintField:function(oe,Ue){this.writeTag(oe,Z.Varint),this.writeSVarint(Ue)},writeStringField:function(oe,Ue){this.writeTag(oe,Z.Bytes),this.writeString(Ue)},writeFloatField:function(oe,Ue){this.writeTag(oe,Z.Fixed32),this.writeFloat(Ue)},writeDoubleField:function(oe,Ue){this.writeTag(oe,Z.Fixed64),this.writeDouble(Ue)},writeBooleanField:function(oe,Ue){this.writeVarintField(oe,Boolean(Ue))}};function ve(oe,Ue,H){var U=H.buf,de,Xe;if(Xe=U[H.pos++],de=(Xe&112)>>4,Xe<128||(Xe=U[H.pos++],de|=(Xe&127)<<3,Xe<128)||(Xe=U[H.pos++],de|=(Xe&127)<<10,Xe<128)||(Xe=U[H.pos++],de|=(Xe&127)<<17,Xe<128)||(Xe=U[H.pos++],de|=(Xe&127)<<24,Xe<128)||(Xe=U[H.pos++],de|=(Xe&1)<<31,Xe<128))return Ae(oe,de,Ue);throw new Error("Expected varint not more than 10 bytes")}function tt(oe){return oe.type===Z.Bytes?oe.readVarint()+oe.pos:oe.pos+1}function Ae(oe,Ue,H){return H?Ue*4294967296+(oe>>>0):(Ue>>>0)*4294967296+(oe>>>0)}function at(oe,Ue){var H,U;if(oe>=0?(H=oe%4294967296|0,U=oe/4294967296|0):(H=~(-oe%4294967296),U=~(-oe/4294967296),H^4294967295?H=H+1|0:(H=0,U=U+1|0)),oe>=18446744073709552e3||oe<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Ue.realloc(10),gt(H,U,Ue),Mt(U,Ue)}function gt(oe,Ue,H){H.buf[H.pos++]=oe&127|128,oe>>>=7,H.buf[H.pos++]=oe&127|128,oe>>>=7,H.buf[H.pos++]=oe&127|128,oe>>>=7,H.buf[H.pos++]=oe&127|128,oe>>>=7,H.buf[H.pos]=oe&127}function Mt(oe,Ue){var H=(oe&7)<<4;Ue.buf[Ue.pos++]|=H|((oe>>>=3)?128:0),!!oe&&(Ue.buf[Ue.pos++]=oe&127|((oe>>>=7)?128:0),!!oe&&(Ue.buf[Ue.pos++]=oe&127|((oe>>>=7)?128:0),!!oe&&(Ue.buf[Ue.pos++]=oe&127|((oe>>>=7)?128:0),!!oe&&(Ue.buf[Ue.pos++]=oe&127|((oe>>>=7)?128:0),!!oe&&(Ue.buf[Ue.pos++]=oe&127)))))}function Ft(oe,Ue,H){var U=Ue<=16383?1:Ue<=2097151?2:Ue<=268435455?3:Math.floor(Math.log(Ue)/(Math.LN2*7));H.realloc(U);for(var de=H.pos-1;de>=oe;de--)H.buf[de+U]=H.buf[de]}function mr(oe,Ue){for(var H=0;H<oe.length;H++)Ue.writeVarint(oe[H])}function jt(oe,Ue){for(var H=0;H<oe.length;H++)Ue.writeSVarint(oe[H])}function hr(oe,Ue){for(var H=0;H<oe.length;H++)Ue.writeFloat(oe[H])}function qt(oe,Ue){for(var H=0;H<oe.length;H++)Ue.writeDouble(oe[H])}function Dt(oe,Ue){for(var H=0;H<oe.length;H++)Ue.writeBoolean(oe[H])}function Pt(oe,Ue){for(var H=0;H<oe.length;H++)Ue.writeFixed32(oe[H])}function Cr(oe,Ue){for(var H=0;H<oe.length;H++)Ue.writeSFixed32(oe[H])}function ne(oe,Ue){for(var H=0;H<oe.length;H++)Ue.writeFixed64(oe[H])}function gr(oe,Ue){for(var H=0;H<oe.length;H++)Ue.writeSFixed64(oe[H])}function It(oe,Ue){return(oe[Ue]|oe[Ue+1]<<8|oe[Ue+2]<<16)+oe[Ue+3]*16777216}function xt(oe,Ue,H){oe[H]=Ue,oe[H+1]=Ue>>>8,oe[H+2]=Ue>>>16,oe[H+3]=Ue>>>24}function Jt(oe,Ue){return(oe[Ue]|oe[Ue+1]<<8|oe[Ue+2]<<16)+(oe[Ue+3]<<24)}function Ct(oe,Ue,H){for(var U="",de=Ue;de<H;){var Xe=oe[de],lt=null,yt=Xe>239?4:Xe>223?3:Xe>191?2:1;if(de+yt>H)break;var Vt,pr,tn;yt===1?Xe<128&&(lt=Xe):yt===2?(Vt=oe[de+1],(Vt&192)==128&&(lt=(Xe&31)<<6|Vt&63,lt<=127&&(lt=null))):yt===3?(Vt=oe[de+1],pr=oe[de+2],(Vt&192)==128&&(pr&192)==128&&(lt=(Xe&15)<<12|(Vt&63)<<6|pr&63,(lt<=2047||lt>=55296&&lt<=57343)&&(lt=null))):yt===4&&(Vt=oe[de+1],pr=oe[de+2],tn=oe[de+3],(Vt&192)==128&&(pr&192)==128&&(tn&192)==128&&(lt=(Xe&15)<<18|(Vt&63)<<12|(pr&63)<<6|tn&63,(lt<=65535||lt>=1114112)&&(lt=null))),lt===null?(lt=65533,yt=1):lt>65535&&(lt-=65536,U+=String.fromCharCode(lt>>>10&1023|55296),lt=56320|lt&1023),U+=String.fromCharCode(lt),de+=yt}return U}function br(oe,Ue,H){return xe.decode(oe.subarray(Ue,H))}function $r(oe,Ue,H){for(var U=0,de,Xe;U<Ue.length;U++){if(de=Ue.charCodeAt(U),de>55295&&de<57344)if(Xe)if(de<56320){oe[H++]=239,oe[H++]=191,oe[H++]=189,Xe=de;continue}else de=Xe-55296<<10|de-56320|65536,Xe=null;else{de>56319||U+1===Ue.length?(oe[H++]=239,oe[H++]=191,oe[H++]=189):Xe=de;continue}else Xe&&(oe[H++]=239,oe[H++]=191,oe[H++]=189,Xe=null);de<128?oe[H++]=de:(de<2048?oe[H++]=de>>6|192:(de<65536?oe[H++]=de>>12|224:(oe[H++]=de>>18|240,oe[H++]=de>>12&63|128),oe[H++]=de>>6&63|128),oe[H++]=de&63|128)}return H}},32676:function(Yr,ge,ie){var Oe=ie(34155);(function(Z,_){Yr.exports=_()})(this,function(){"use strict";function Z(Rt,be){if(!(Rt instanceof be))throw new TypeError("Cannot call a class as a function")}function _(Rt,be){for(var ce=0;ce<be.length;ce++){var Me=be[ce];Me.enumerable=Me.enumerable||!1,Me.configurable=!0,"value"in Me&&(Me.writable=!0),Object.defineProperty(Rt,Me.key,Me)}}function Pe(Rt,be,ce){return be&&_(Rt.prototype,be),ce&&_(Rt,ce),Rt}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var K=function(){function Rt(be,ce){this.next=null,this.key=be,this.data=ce,this.left=null,this.right=null}return Rt}();function xe(Rt,be){return Rt>be?1:Rt<be?-1:0}function ve(Rt,be,ce){for(var Me=new K(null,null),j=Me,ut=Me;;){var ir=ce(Rt,be.key);if(ir<0){if(be.left===null)break;if(ce(Rt,be.left.key)<0){var Jr=be.left;if(be.left=Jr.right,Jr.right=be,be=Jr,be.left===null)break}ut.left=be,ut=be,be=be.left}else if(ir>0){if(be.right===null)break;if(ce(Rt,be.right.key)>0){var Jr=be.right;if(be.right=Jr.left,Jr.left=be,be=Jr,be.right===null)break}j.right=be,j=be,be=be.right}else break}return j.right=be.left,ut.left=be.right,be.left=Me.right,be.right=Me.left,be}function tt(Rt,be,ce,Me){var j=new K(Rt,be);if(ce===null)return j.left=j.right=null,j;ce=ve(Rt,ce,Me);var ut=Me(Rt,ce.key);return ut<0?(j.left=ce.left,j.right=ce,ce.left=null):ut>=0&&(j.right=ce.right,j.left=ce,ce.right=null),j}function Ae(Rt,be,ce){var Me=null,j=null;if(be){be=ve(Rt,be,ce);var ut=ce(be.key,Rt);ut===0?(Me=be.left,j=be.right):ut<0?(j=be.right,be.right=null,Me=be):(Me=be.left,be.left=null,j=be)}return{left:Me,right:j}}function at(Rt,be,ce){return be===null?Rt:(Rt===null||(be=ve(Rt.key,be,ce),be.left=Rt),be)}function gt(Rt,be,ce,Me,j){if(Rt){Me(""+be+(ce?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+j(Rt)+`
`);var ut=be+(ce?"    ":"\u2502   ");Rt.left&&gt(Rt.left,ut,!1,Me,j),Rt.right&&gt(Rt.right,ut,!0,Me,j)}}var Mt=function(){function Rt(be){be===void 0&&(be=xe),this._root=null,this._size=0,this._comparator=be}return Rt.prototype.insert=function(be,ce){return this._size++,this._root=tt(be,ce,this._root,this._comparator)},Rt.prototype.add=function(be,ce){var Me=new K(be,ce);this._root===null&&(Me.left=Me.right=null,this._size++,this._root=Me);var j=this._comparator,ut=ve(be,this._root,j),ir=j(be,ut.key);return ir===0?this._root=ut:(ir<0?(Me.left=ut.left,Me.right=ut,ut.left=null):ir>0&&(Me.right=ut.right,Me.left=ut,ut.right=null),this._size++,this._root=Me),this._root},Rt.prototype.remove=function(be){this._root=this._remove(be,this._root,this._comparator)},Rt.prototype._remove=function(be,ce,Me){var j;if(ce===null)return null;ce=ve(be,ce,Me);var ut=Me(be,ce.key);return ut===0?(ce.left===null?j=ce.right:(j=ve(be,ce.left,Me),j.right=ce.right),this._size--,j):ce},Rt.prototype.pop=function(){var be=this._root;if(be){for(;be.left;)be=be.left;return this._root=ve(be.key,this._root,this._comparator),this._root=this._remove(be.key,this._root,this._comparator),{key:be.key,data:be.data}}return null},Rt.prototype.findStatic=function(be){for(var ce=this._root,Me=this._comparator;ce;){var j=Me(be,ce.key);if(j===0)return ce;j<0?ce=ce.left:ce=ce.right}return null},Rt.prototype.find=function(be){return this._root&&(this._root=ve(be,this._root,this._comparator),this._comparator(be,this._root.key)!==0)?null:this._root},Rt.prototype.contains=function(be){for(var ce=this._root,Me=this._comparator;ce;){var j=Me(be,ce.key);if(j===0)return!0;j<0?ce=ce.left:ce=ce.right}return!1},Rt.prototype.forEach=function(be,ce){for(var Me=this._root,j=[],ut=!1;!ut;)Me!==null?(j.push(Me),Me=Me.left):j.length!==0?(Me=j.pop(),be.call(ce,Me),Me=Me.right):ut=!0;return this},Rt.prototype.range=function(be,ce,Me,j){for(var ut=[],ir=this._comparator,Jr=this._root,nt;ut.length!==0||Jr;)if(Jr)ut.push(Jr),Jr=Jr.left;else{if(Jr=ut.pop(),nt=ir(Jr.key,ce),nt>0)break;if(ir(Jr.key,be)>=0&&Me.call(j,Jr))return this;Jr=Jr.right}return this},Rt.prototype.keys=function(){var be=[];return this.forEach(function(ce){var Me=ce.key;return be.push(Me)}),be},Rt.prototype.values=function(){var be=[];return this.forEach(function(ce){var Me=ce.data;return be.push(Me)}),be},Rt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},Rt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},Rt.prototype.minNode=function(be){if(be===void 0&&(be=this._root),be)for(;be.left;)be=be.left;return be},Rt.prototype.maxNode=function(be){if(be===void 0&&(be=this._root),be)for(;be.right;)be=be.right;return be},Rt.prototype.at=function(be){for(var ce=this._root,Me=!1,j=0,ut=[];!Me;)if(ce)ut.push(ce),ce=ce.left;else if(ut.length>0){if(ce=ut.pop(),j===be)return ce;j++,ce=ce.right}else Me=!0;return null},Rt.prototype.next=function(be){var ce=this._root,Me=null;if(be.right){for(Me=be.right;Me.left;)Me=Me.left;return Me}for(var j=this._comparator;ce;){var ut=j(be.key,ce.key);if(ut===0)break;ut<0?(Me=ce,ce=ce.left):ce=ce.right}return Me},Rt.prototype.prev=function(be){var ce=this._root,Me=null;if(be.left!==null){for(Me=be.left;Me.right;)Me=Me.right;return Me}for(var j=this._comparator;ce;){var ut=j(be.key,ce.key);if(ut===0)break;ut<0?ce=ce.left:(Me=ce,ce=ce.right)}return Me},Rt.prototype.clear=function(){return this._root=null,this._size=0,this},Rt.prototype.toList=function(){return jt(this._root)},Rt.prototype.load=function(be,ce,Me){ce===void 0&&(ce=[]),Me===void 0&&(Me=!1);var j=be.length,ut=this._comparator;if(Me&&Dt(be,ce,0,j-1,ut),this._root===null)this._root=Ft(be,ce,0,j),this._size=j;else{var ir=qt(this.toList(),mr(be,ce),ut);j=this._size+j,this._root=hr({head:ir},0,j)}return this},Rt.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(Rt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(Rt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Rt.prototype.toString=function(be){be===void 0&&(be=function(j){return String(j.key)});var ce=[];return gt(this._root,"",!0,function(Me){return ce.push(Me)},be),ce.join("")},Rt.prototype.update=function(be,ce,Me){var j=this._comparator,ut=Ae(be,this._root,j),ir=ut.left,Jr=ut.right;j(be,ce)<0?Jr=tt(ce,Me,Jr,j):ir=tt(ce,Me,ir,j),this._root=at(ir,Jr,j)},Rt.prototype.split=function(be){return Ae(be,this._root,this._comparator)},Rt}();function Ft(Rt,be,ce,Me){var j=Me-ce;if(j>0){var ut=ce+Math.floor(j/2),ir=Rt[ut],Jr=be[ut],nt=new K(ir,Jr);return nt.left=Ft(Rt,be,ce,ut),nt.right=Ft(Rt,be,ut+1,Me),nt}return null}function mr(Rt,be){for(var ce=new K(null,null),Me=ce,j=0;j<Rt.length;j++)Me=Me.next=new K(Rt[j],be[j]);return Me.next=null,ce.next}function jt(Rt){for(var be=Rt,ce=[],Me=!1,j=new K(null,null),ut=j;!Me;)be?(ce.push(be),be=be.left):ce.length>0?(be=ut=ut.next=ce.pop(),be=be.right):Me=!0;return ut.next=null,j.next}function hr(Rt,be,ce){var Me=ce-be;if(Me>0){var j=be+Math.floor(Me/2),ut=hr(Rt,be,j),ir=Rt.head;return ir.left=ut,Rt.head=Rt.head.next,ir.right=hr(Rt,j+1,ce),ir}return null}function qt(Rt,be,ce){for(var Me=new K(null,null),j=Me,ut=Rt,ir=be;ut!==null&&ir!==null;)ce(ut.key,ir.key)<0?(j.next=ut,ut=ut.next):(j.next=ir,ir=ir.next),j=j.next;return ut!==null?j.next=ut:ir!==null&&(j.next=ir),Me.next}function Dt(Rt,be,ce,Me,j){if(!(ce>=Me)){for(var ut=Rt[ce+Me>>1],ir=ce-1,Jr=Me+1;;){do ir++;while(j(Rt[ir],ut)<0);do Jr--;while(j(Rt[Jr],ut)>0);if(ir>=Jr)break;var nt=Rt[ir];Rt[ir]=Rt[Jr],Rt[Jr]=nt,nt=be[ir],be[ir]=be[Jr],be[Jr]=nt}Dt(Rt,be,ce,Jr,j),Dt(Rt,be,Jr+1,Me,j)}}var Pt=function(be,ce){return be.ll.x<=ce.x&&ce.x<=be.ur.x&&be.ll.y<=ce.y&&ce.y<=be.ur.y},Cr=function(be,ce){if(ce.ur.x<be.ll.x||be.ur.x<ce.ll.x||ce.ur.y<be.ll.y||be.ur.y<ce.ll.y)return null;var Me=be.ll.x<ce.ll.x?ce.ll.x:be.ll.x,j=be.ur.x<ce.ur.x?be.ur.x:ce.ur.x,ut=be.ll.y<ce.ll.y?ce.ll.y:be.ll.y,ir=be.ur.y<ce.ur.y?be.ur.y:ce.ur.y;return{ll:{x:Me,y:ut},ur:{x:j,y:ir}}},ne=Number.EPSILON;ne===void 0&&(ne=Math.pow(2,-52));var gr=ne*ne,It=function(be,ce){if(-ne<be&&be<ne&&-ne<ce&&ce<ne)return 0;var Me=be-ce;return Me*Me<gr*be*ce?0:be<ce?-1:1},xt=function(){function Rt(){Z(this,Rt),this.reset()}return Pe(Rt,[{key:"reset",value:function(){this.xRounder=new Jt,this.yRounder=new Jt}},{key:"round",value:function(ce,Me){return{x:this.xRounder.round(ce),y:this.yRounder.round(Me)}}}]),Rt}(),Jt=function(){function Rt(){Z(this,Rt),this.tree=new Mt,this.round(0)}return Pe(Rt,[{key:"round",value:function(ce){var Me=this.tree.add(ce),j=this.tree.prev(Me);if(j!==null&&It(Me.key,j.key)===0)return this.tree.remove(ce),j.key;var ut=this.tree.next(Me);return ut!==null&&It(Me.key,ut.key)===0?(this.tree.remove(ce),ut.key):ce}}]),Rt}(),Ct=new xt,br=function(be,ce){return be.x*ce.y-be.y*ce.x},$r=function(be,ce){return be.x*ce.x+be.y*ce.y},oe=function(be,ce,Me){var j={x:ce.x-be.x,y:ce.y-be.y},ut={x:Me.x-be.x,y:Me.y-be.y},ir=br(j,ut);return It(ir,0)},Ue=function(be){return Math.sqrt($r(be,be))},H=function(be,ce,Me){var j={x:ce.x-be.x,y:ce.y-be.y},ut={x:Me.x-be.x,y:Me.y-be.y};return br(ut,j)/Ue(ut)/Ue(j)},U=function(be,ce,Me){var j={x:ce.x-be.x,y:ce.y-be.y},ut={x:Me.x-be.x,y:Me.y-be.y};return $r(ut,j)/Ue(ut)/Ue(j)},de=function(be,ce,Me){return ce.y===0?null:{x:be.x+ce.x/ce.y*(Me-be.y),y:Me}},Xe=function(be,ce,Me){return ce.x===0?null:{x:Me,y:be.y+ce.y/ce.x*(Me-be.x)}},lt=function(be,ce,Me,j){if(ce.x===0)return Xe(Me,j,be.x);if(j.x===0)return Xe(be,ce,Me.x);if(ce.y===0)return de(Me,j,be.y);if(j.y===0)return de(be,ce,Me.y);var ut=br(ce,j);if(ut==0)return null;var ir={x:Me.x-be.x,y:Me.y-be.y},Jr=br(ir,ce)/ut,nt=br(ir,j)/ut,Bt=be.x+nt*ce.x,Ar=Me.x+Jr*j.x,zr=be.y+nt*ce.y,un=Me.y+Jr*j.y,vn=(Bt+Ar)/2,ui=(zr+un)/2;return{x:vn,y:ui}},yt=function(){Pe(Rt,null,[{key:"compare",value:function(ce,Me){var j=Rt.comparePoints(ce.point,Me.point);return j!==0?j:(ce.point!==Me.point&&ce.link(Me),ce.isLeft!==Me.isLeft?ce.isLeft?1:-1:pr.compare(ce.segment,Me.segment))}},{key:"comparePoints",value:function(ce,Me){return ce.x<Me.x?-1:ce.x>Me.x?1:ce.y<Me.y?-1:ce.y>Me.y?1:0}}]);function Rt(be,ce){Z(this,Rt),be.events===void 0?be.events=[this]:be.events.push(this),this.point=be,this.isLeft=ce}return Pe(Rt,[{key:"link",value:function(ce){if(ce.point===this.point)throw new Error("Tried to link already linked events");for(var Me=ce.point.events,j=0,ut=Me.length;j<ut;j++){var ir=Me[j];this.point.events.push(ir),ir.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var ce=this.point.events.length,Me=0;Me<ce;Me++){var j=this.point.events[Me];if(j.segment.consumedBy===void 0)for(var ut=Me+1;ut<ce;ut++){var ir=this.point.events[ut];ir.consumedBy===void 0&&j.otherSE.point.events===ir.otherSE.point.events&&j.segment.consume(ir.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var ce=[],Me=0,j=this.point.events.length;Me<j;Me++){var ut=this.point.events[Me];ut!==this&&!ut.segment.ringOut&&ut.segment.isInResult()&&ce.push(ut)}return ce}},{key:"getLeftmostComparator",value:function(ce){var Me=this,j=new Map,ut=function(Jr){var nt=Jr.otherSE;j.set(Jr,{sine:H(Me.point,ce.point,nt.point),cosine:U(Me.point,ce.point,nt.point)})};return function(ir,Jr){j.has(ir)||ut(ir),j.has(Jr)||ut(Jr);var nt=j.get(ir),Bt=nt.sine,Ar=nt.cosine,zr=j.get(Jr),un=zr.sine,vn=zr.cosine;return Bt>=0&&un>=0?Ar<vn?1:Ar>vn?-1:0:Bt<0&&un<0?Ar<vn?-1:Ar>vn?1:0:un<Bt?-1:un>Bt?1:0}}}]),Rt}(),Vt=0,pr=function(){Pe(Rt,null,[{key:"compare",value:function(ce,Me){var j=ce.leftSE.point.x,ut=Me.leftSE.point.x,ir=ce.rightSE.point.x,Jr=Me.rightSE.point.x;if(Jr<j)return 1;if(ir<ut)return-1;var nt=ce.leftSE.point.y,Bt=Me.leftSE.point.y,Ar=ce.rightSE.point.y,zr=Me.rightSE.point.y;if(j<ut){if(Bt<nt&&Bt<Ar)return 1;if(Bt>nt&&Bt>Ar)return-1;var un=ce.comparePoint(Me.leftSE.point);if(un<0)return 1;if(un>0)return-1;var vn=Me.comparePoint(ce.rightSE.point);return vn!==0?vn:-1}if(j>ut){if(nt<Bt&&nt<zr)return-1;if(nt>Bt&&nt>zr)return 1;var ui=Me.comparePoint(ce.leftSE.point);if(ui!==0)return ui;var Jn=ce.comparePoint(Me.rightSE.point);return Jn<0?1:Jn>0?-1:1}if(nt<Bt)return-1;if(nt>Bt)return 1;if(ir<Jr){var mn=Me.comparePoint(ce.rightSE.point);if(mn!==0)return mn}if(ir>Jr){var Ri=ce.comparePoint(Me.rightSE.point);if(Ri<0)return 1;if(Ri>0)return-1}if(ir!==Jr){var Si=Ar-nt,Wa=ir-j,uo=zr-Bt,Io=Jr-ut;if(Si>Wa&&uo<Io)return 1;if(Si<Wa&&uo>Io)return-1}return ir>Jr?1:ir<Jr||Ar<zr?-1:Ar>zr?1:ce.id<Me.id?-1:ce.id>Me.id?1:0}}]);function Rt(be,ce,Me,j){Z(this,Rt),this.id=++Vt,this.leftSE=be,be.segment=this,be.otherSE=ce,this.rightSE=ce,ce.segment=this,ce.otherSE=be,this.rings=Me,this.windings=j}return Pe(Rt,[{key:"replaceRightSE",value:function(ce){this.rightSE=ce,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var ce=this.leftSE.point.y,Me=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:ce<Me?ce:Me},ur:{x:this.rightSE.point.x,y:ce>Me?ce:Me}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(ce){return ce.x===this.leftSE.point.x&&ce.y===this.leftSE.point.y||ce.x===this.rightSE.point.x&&ce.y===this.rightSE.point.y}},{key:"comparePoint",value:function(ce){if(this.isAnEndpoint(ce))return 0;var Me=this.leftSE.point,j=this.rightSE.point,ut=this.vector();if(Me.x===j.x)return ce.x===Me.x?0:ce.x<Me.x?1:-1;var ir=(ce.y-Me.y)/ut.y,Jr=Me.x+ir*ut.x;if(ce.x===Jr)return 0;var nt=(ce.x-Me.x)/ut.x,Bt=Me.y+nt*ut.y;return ce.y===Bt?0:ce.y<Bt?-1:1}},{key:"getIntersection",value:function(ce){var Me=this.bbox(),j=ce.bbox(),ut=Cr(Me,j);if(ut===null)return null;var ir=this.leftSE.point,Jr=this.rightSE.point,nt=ce.leftSE.point,Bt=ce.rightSE.point,Ar=Pt(Me,nt)&&this.comparePoint(nt)===0,zr=Pt(j,ir)&&ce.comparePoint(ir)===0,un=Pt(Me,Bt)&&this.comparePoint(Bt)===0,vn=Pt(j,Jr)&&ce.comparePoint(Jr)===0;if(zr&&Ar)return vn&&!un?Jr:!vn&&un?Bt:null;if(zr)return un&&ir.x===Bt.x&&ir.y===Bt.y?null:ir;if(Ar)return vn&&Jr.x===nt.x&&Jr.y===nt.y?null:nt;if(vn&&un)return null;if(vn)return Jr;if(un)return Bt;var ui=lt(ir,this.vector(),nt,ce.vector());return ui===null||!Pt(ut,ui)?null:Ct.round(ui.x,ui.y)}},{key:"split",value:function(ce){var Me=[],j=ce.events!==void 0,ut=new yt(ce,!0),ir=new yt(ce,!1),Jr=this.rightSE;this.replaceRightSE(ir),Me.push(ir),Me.push(ut);var nt=new Rt(ut,Jr,this.rings.slice(),this.windings.slice());return yt.comparePoints(nt.leftSE.point,nt.rightSE.point)>0&&nt.swapEvents(),yt.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),j&&(ut.checkForConsuming(),ir.checkForConsuming()),Me}},{key:"swapEvents",value:function(){var ce=this.rightSE;this.rightSE=this.leftSE,this.leftSE=ce,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var Me=0,j=this.windings.length;Me<j;Me++)this.windings[Me]*=-1}},{key:"consume",value:function(ce){for(var Me=this,j=ce;Me.consumedBy;)Me=Me.consumedBy;for(;j.consumedBy;)j=j.consumedBy;var ut=Rt.compare(Me,j);if(ut!==0){if(ut>0){var ir=Me;Me=j,j=ir}if(Me.prev===j){var Jr=Me;Me=j,j=Jr}for(var nt=0,Bt=j.rings.length;nt<Bt;nt++){var Ar=j.rings[nt],zr=j.windings[nt],un=Me.rings.indexOf(Ar);un===-1?(Me.rings.push(Ar),Me.windings.push(zr)):Me.windings[un]+=zr}j.rings=null,j.windings=null,j.consumedBy=Me,j.leftSE.consumedBy=Me.leftSE,j.rightSE.consumedBy=Me.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var ce=this.prev.consumedBy||this.prev;this._beforeState=ce.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var ce=this.beforeState();this._afterState={rings:ce.rings.slice(0),windings:ce.windings.slice(0),multiPolys:[]};for(var Me=this._afterState.rings,j=this._afterState.windings,ut=this._afterState.multiPolys,ir=0,Jr=this.rings.length;ir<Jr;ir++){var nt=this.rings[ir],Bt=this.windings[ir],Ar=Me.indexOf(nt);Ar===-1?(Me.push(nt),j.push(Bt)):j[Ar]+=Bt}for(var zr=[],un=[],vn=0,ui=Me.length;vn<ui;vn++)if(j[vn]!==0){var Jn=Me[vn],mn=Jn.poly;if(un.indexOf(mn)===-1)if(Jn.isExterior)zr.push(mn);else{un.indexOf(mn)===-1&&un.push(mn);var Ri=zr.indexOf(Jn.poly);Ri!==-1&&zr.splice(Ri,1)}}for(var Si=0,Wa=zr.length;Si<Wa;Si++){var uo=zr[Si].multiPoly;ut.indexOf(uo)===-1&&ut.push(uo)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var ce=this.beforeState().multiPolys,Me=this.afterState().multiPolys;switch(Bi.type){case"union":{var j=ce.length===0,ut=Me.length===0;this._isInResult=j!==ut;break}case"intersection":{var ir,Jr;ce.length<Me.length?(ir=ce.length,Jr=Me.length):(ir=Me.length,Jr=ce.length),this._isInResult=Jr===Bi.numMultiPolys&&ir<Jr;break}case"xor":{var nt=Math.abs(ce.length-Me.length);this._isInResult=nt%2==1;break}case"difference":{var Bt=function(zr){return zr.length===1&&zr[0].isSubject};this._isInResult=Bt(ce)!==Bt(Me);break}default:throw new Error("Unrecognized operation type found ".concat(Bi.type))}return this._isInResult}}],[{key:"fromRing",value:function(ce,Me,j){var ut,ir,Jr,nt=yt.comparePoints(ce,Me);if(nt<0)ut=ce,ir=Me,Jr=1;else if(nt>0)ut=Me,ir=ce,Jr=-1;else throw new Error("Tried to create degenerate segment at [".concat(ce.x,", ").concat(ce.y,"]"));var Bt=new yt(ut,!0),Ar=new yt(ir,!1);return new Rt(Bt,Ar,[j],[Jr])}}]),Rt}(),tn=function(){function Rt(be,ce,Me){if(Z(this,Rt),!Array.isArray(be)||be.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=ce,this.isExterior=Me,this.segments=[],typeof be[0][0]!="number"||typeof be[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var j=Ct.round(be[0][0],be[0][1]);this.bbox={ll:{x:j.x,y:j.y},ur:{x:j.x,y:j.y}};for(var ut=j,ir=1,Jr=be.length;ir<Jr;ir++){if(typeof be[ir][0]!="number"||typeof be[ir][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var nt=Ct.round(be[ir][0],be[ir][1]);nt.x===ut.x&&nt.y===ut.y||(this.segments.push(pr.fromRing(ut,nt,this)),nt.x<this.bbox.ll.x&&(this.bbox.ll.x=nt.x),nt.y<this.bbox.ll.y&&(this.bbox.ll.y=nt.y),nt.x>this.bbox.ur.x&&(this.bbox.ur.x=nt.x),nt.y>this.bbox.ur.y&&(this.bbox.ur.y=nt.y),ut=nt)}(j.x!==ut.x||j.y!==ut.y)&&this.segments.push(pr.fromRing(ut,j,this))}return Pe(Rt,[{key:"getSweepEvents",value:function(){for(var ce=[],Me=0,j=this.segments.length;Me<j;Me++){var ut=this.segments[Me];ce.push(ut.leftSE),ce.push(ut.rightSE)}return ce}}]),Rt}(),Kr=function(){function Rt(be,ce){if(Z(this,Rt),!Array.isArray(be))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new tn(be[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var Me=1,j=be.length;Me<j;Me++){var ut=new tn(be[Me],this,!1);ut.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ut.bbox.ll.x),ut.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ut.bbox.ll.y),ut.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ut.bbox.ur.x),ut.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ut.bbox.ur.y),this.interiorRings.push(ut)}this.multiPoly=ce}return Pe(Rt,[{key:"getSweepEvents",value:function(){for(var ce=this.exteriorRing.getSweepEvents(),Me=0,j=this.interiorRings.length;Me<j;Me++)for(var ut=this.interiorRings[Me].getSweepEvents(),ir=0,Jr=ut.length;ir<Jr;ir++)ce.push(ut[ir]);return ce}}]),Rt}(),si=function(){function Rt(be,ce){if(Z(this,Rt),!Array.isArray(be))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof be[0][0][0]=="number"&&(be=[be])}catch(ir){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var Me=0,j=be.length;Me<j;Me++){var ut=new Kr(be[Me],this);ut.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ut.bbox.ll.x),ut.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ut.bbox.ll.y),ut.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ut.bbox.ur.x),ut.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ut.bbox.ur.y),this.polys.push(ut)}this.isSubject=ce}return Pe(Rt,[{key:"getSweepEvents",value:function(){for(var ce=[],Me=0,j=this.polys.length;Me<j;Me++)for(var ut=this.polys[Me].getSweepEvents(),ir=0,Jr=ut.length;ir<Jr;ir++)ce.push(ut[ir]);return ce}}]),Rt}(),xn=function(){Pe(Rt,null,[{key:"factory",value:function(ce){for(var Me=[],j=0,ut=ce.length;j<ut;j++){var ir=ce[j];if(!(!ir.isInResult()||ir.ringOut)){for(var Jr=null,nt=ir.leftSE,Bt=ir.rightSE,Ar=[nt],zr=nt.point,un=[];Jr=nt,nt=Bt,Ar.push(nt),nt.point!==zr;)for(;;){var vn=nt.getAvailableLinkedEvents();if(vn.length===0){var ui=Ar[0].point,Jn=Ar[Ar.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(ui.x,",")+" ".concat(ui.y,"]. Last matching segment found ends at")+" [".concat(Jn.x,", ").concat(Jn.y,"]."))}if(vn.length===1){Bt=vn[0].otherSE;break}for(var mn=null,Ri=0,Si=un.length;Ri<Si;Ri++)if(un[Ri].point===nt.point){mn=Ri;break}if(mn!==null){var Wa=un.splice(mn)[0],uo=Ar.splice(Wa.index);uo.unshift(uo[0].otherSE),Me.push(new Rt(uo.reverse()));continue}un.push({index:Ar.length,point:nt.point});var Io=nt.getLeftmostComparator(Jr);Bt=vn.sort(Io)[0].otherSE;break}Me.push(new Rt(Ar))}}return Me}}]);function Rt(be){Z(this,Rt),this.events=be;for(var ce=0,Me=be.length;ce<Me;ce++)be[ce].segment.ringOut=this;this.poly=null}return Pe(Rt,[{key:"getGeom",value:function(){for(var ce=this.events[0].point,Me=[ce],j=1,ut=this.events.length-1;j<ut;j++){var ir=this.events[j].point,Jr=this.events[j+1].point;oe(ir,ce,Jr)!==0&&(Me.push(ir),ce=ir)}if(Me.length===1)return null;var nt=Me[0],Bt=Me[1];oe(nt,ce,Bt)===0&&Me.shift(),Me.push(Me[0]);for(var Ar=this.isExteriorRing()?1:-1,zr=this.isExteriorRing()?0:Me.length-1,un=this.isExteriorRing()?Me.length:-1,vn=[],ui=zr;ui!=un;ui+=Ar)vn.push([Me[ui].x,Me[ui].y]);return vn}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var ce=this.enclosingRing();this._isExteriorRing=ce?!ce.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var ce=this.events[0],Me=1,j=this.events.length;Me<j;Me++){var ut=this.events[Me];yt.compare(ce,ut)>0&&(ce=ut)}for(var ir=ce.segment.prevInResult(),Jr=ir?ir.prevInResult():null;;){if(!ir)return null;if(!Jr)return ir.ringOut;if(Jr.ringOut!==ir.ringOut)return Jr.ringOut.enclosingRing()!==ir.ringOut?ir.ringOut:ir.ringOut.enclosingRing();ir=Jr.prevInResult(),Jr=ir?ir.prevInResult():null}}}]),Rt}(),ii=function(){function Rt(be){Z(this,Rt),this.exteriorRing=be,be.poly=this,this.interiorRings=[]}return Pe(Rt,[{key:"addInterior",value:function(ce){this.interiorRings.push(ce),ce.poly=this}},{key:"getGeom",value:function(){var ce=[this.exteriorRing.getGeom()];if(ce[0]===null)return null;for(var Me=0,j=this.interiorRings.length;Me<j;Me++){var ut=this.interiorRings[Me].getGeom();ut!==null&&ce.push(ut)}return ce}}]),Rt}(),Ra=function(){function Rt(be){Z(this,Rt),this.rings=be,this.polys=this._composePolys(be)}return Pe(Rt,[{key:"getGeom",value:function(){for(var ce=[],Me=0,j=this.polys.length;Me<j;Me++){var ut=this.polys[Me].getGeom();ut!==null&&ce.push(ut)}return ce}},{key:"_composePolys",value:function(ce){for(var Me=[],j=0,ut=ce.length;j<ut;j++){var ir=ce[j];if(!ir.poly)if(ir.isExteriorRing())Me.push(new ii(ir));else{var Jr=ir.enclosingRing();Jr.poly||Me.push(new ii(Jr)),Jr.poly.addInterior(ir)}}return Me}}]),Rt}(),Di=function(){function Rt(be){var ce=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pr.compare;Z(this,Rt),this.queue=be,this.tree=new Mt(ce),this.segments=[]}return Pe(Rt,[{key:"process",value:function(ce){var Me=ce.segment,j=[];if(ce.consumedBy)return ce.isLeft?this.queue.remove(ce.otherSE):this.tree.remove(Me),j;var ut=ce.isLeft?this.tree.insert(Me):this.tree.find(Me);if(!ut)throw new Error("Unable to find segment #".concat(Me.id," ")+"[".concat(Me.leftSE.point.x,", ").concat(Me.leftSE.point.y,"] -> ")+"[".concat(Me.rightSE.point.x,", ").concat(Me.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var ir=ut,Jr=ut,nt=void 0,Bt=void 0;nt===void 0;)ir=this.tree.prev(ir),ir===null?nt=null:ir.key.consumedBy===void 0&&(nt=ir.key);for(;Bt===void 0;)Jr=this.tree.next(Jr),Jr===null?Bt=null:Jr.key.consumedBy===void 0&&(Bt=Jr.key);if(ce.isLeft){var Ar=null;if(nt){var zr=nt.getIntersection(Me);if(zr!==null&&(Me.isAnEndpoint(zr)||(Ar=zr),!nt.isAnEndpoint(zr)))for(var un=this._splitSafely(nt,zr),vn=0,ui=un.length;vn<ui;vn++)j.push(un[vn])}var Jn=null;if(Bt){var mn=Bt.getIntersection(Me);if(mn!==null&&(Me.isAnEndpoint(mn)||(Jn=mn),!Bt.isAnEndpoint(mn)))for(var Ri=this._splitSafely(Bt,mn),Si=0,Wa=Ri.length;Si<Wa;Si++)j.push(Ri[Si])}if(Ar!==null||Jn!==null){var uo=null;if(Ar===null)uo=Jn;else if(Jn===null)uo=Ar;else{var Io=yt.comparePoints(Ar,Jn);uo=Io<=0?Ar:Jn}this.queue.remove(Me.rightSE),j.push(Me.rightSE);for(var to=Me.split(uo),La=0,te=to.length;La<te;La++)j.push(to[La])}j.length>0?(this.tree.remove(Me),j.push(ce)):(this.segments.push(Me),Me.prev=nt)}else{if(nt&&Bt){var le=nt.getIntersection(Bt);if(le!==null){if(!nt.isAnEndpoint(le))for(var ye=this._splitSafely(nt,le),Re=0,He=ye.length;Re<He;Re++)j.push(ye[Re]);if(!Bt.isAnEndpoint(le))for(var ht=this._splitSafely(Bt,le),At=0,Te=ht.length;At<Te;At++)j.push(ht[At])}}this.tree.remove(Me)}return j}},{key:"_splitSafely",value:function(ce,Me){this.tree.remove(ce);var j=ce.rightSE;this.queue.remove(j);var ut=ce.split(Me);return ut.push(j),ce.consumedBy===void 0&&this.tree.insert(ce),ut}}]),Rt}(),Pi=typeof Oe!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ua=typeof Oe!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,sa=function(){function Rt(){Z(this,Rt)}return Pe(Rt,[{key:"run",value:function(ce,Me,j){Bi.type=ce,Ct.reset();for(var ut=[new si(Me,!0)],ir=0,Jr=j.length;ir<Jr;ir++)ut.push(new si(j[ir],!1));if(Bi.numMultiPolys=ut.length,Bi.type==="difference")for(var nt=ut[0],Bt=1;Bt<ut.length;)Cr(ut[Bt].bbox,nt.bbox)!==null?Bt++:ut.splice(Bt,1);if(Bi.type==="intersection"){for(var Ar=0,zr=ut.length;Ar<zr;Ar++)for(var un=ut[Ar],vn=Ar+1,ui=ut.length;vn<ui;vn++)if(Cr(un.bbox,ut[vn].bbox)===null)return[]}for(var Jn=new Mt(yt.compare),mn=0,Ri=ut.length;mn<Ri;mn++)for(var Si=ut[mn].getSweepEvents(),Wa=0,uo=Si.length;Wa<uo;Wa++)if(Jn.insert(Si[Wa]),Jn.size>Pi)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Io=new Di(Jn),to=Jn.size,La=Jn.pop();La;){var te=La.key;if(Jn.size===to){var le=te.segment;throw new Error("Unable to pop() ".concat(te.isLeft?"left":"right"," SweepEvent ")+"[".concat(te.point.x,", ").concat(te.point.y,"] from segment #").concat(le.id," ")+"[".concat(le.leftSE.point.x,", ").concat(le.leftSE.point.y,"] -> ")+"[".concat(le.rightSE.point.x,", ").concat(le.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(Jn.size>Pi)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Io.segments.length>ua)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var ye=Io.process(te),Re=0,He=ye.length;Re<He;Re++){var ht=ye[Re];ht.consumedBy===void 0&&Jn.insert(ht)}to=Jn.size,La=Jn.pop()}Ct.reset();var At=xn.factory(Io.segments),Te=new Ra(At);return Te.getGeom()}}]),Rt}(),Bi=new sa,Yn=function(be){for(var ce=arguments.length,Me=new Array(ce>1?ce-1:0),j=1;j<ce;j++)Me[j-1]=arguments[j];return Bi.run("union",be,Me)},bi=function(be){for(var ce=arguments.length,Me=new Array(ce>1?ce-1:0),j=1;j<ce;j++)Me[j-1]=arguments[j];return Bi.run("intersection",be,Me)},Ms=function(be){for(var ce=arguments.length,Me=new Array(ce>1?ce-1:0),j=1;j<ce;j++)Me[j-1]=arguments[j];return Bi.run("xor",be,Me)},Ha=function(be){for(var ce=arguments.length,Me=new Array(ce>1?ce-1:0),j=1;j<ce;j++)Me[j-1]=arguments[j];return Bi.run("difference",be,Me)},eo={union:Yn,intersection:bi,xor:Ms,difference:Ha};return eo})},28660:function(Yr,ge,ie){var Oe=ie(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Z;(function(_){(function(Pe){var K=typeof ie.g=="object"?ie.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),xe=ve(_);typeof K.Reflect=="undefined"?K.Reflect=_:xe=ve(K.Reflect,xe),Pe(xe);function ve(tt,Ae){return function(at,gt){typeof tt[at]!="function"&&Object.defineProperty(tt,at,{configurable:!0,writable:!0,value:gt}),Ae&&Ae(at,gt)}}})(function(Pe){var K=Object.prototype.hasOwnProperty,xe=typeof Symbol=="function",ve=xe&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",tt=xe&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",Ae=typeof Object.create=="function",at={__proto__:[]}instanceof Array,gt=!Ae&&!at,Mt={create:Ae?function(){return Jr(Object.create(null))}:at?function(){return Jr({__proto__:null})}:function(){return Jr({})},has:gt?function(nt,Bt){return K.call(nt,Bt)}:function(nt,Bt){return Bt in nt},get:gt?function(nt,Bt){return K.call(nt,Bt)?nt[Bt]:void 0}:function(nt,Bt){return nt[Bt]}},Ft=Object.getPrototypeOf(Function),mr=typeof Oe=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",jt=!mr&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:j(),hr=!mr&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:ut(),qt=!mr&&typeof WeakMap=="function"?WeakMap:ir(),Dt=new qt;function Pt(nt,Bt,Ar,zr){if(Kr(Ar)){if(!Bi(nt))throw new TypeError;if(!bi(Bt))throw new TypeError;return oe(nt,Bt)}else{if(!Bi(nt))throw new TypeError;if(!ii(Bt))throw new TypeError;if(!ii(zr)&&!Kr(zr)&&!si(zr))throw new TypeError;return si(zr)&&(zr=void 0),Ar=sa(Ar),Ue(nt,Bt,Ar,zr)}}Pe("decorate",Pt);function Cr(nt,Bt){function Ar(zr,un){if(!ii(zr))throw new TypeError;if(!Kr(un)&&!Ms(un))throw new TypeError;yt(nt,Bt,zr,un)}return Ar}Pe("metadata",Cr);function ne(nt,Bt,Ar,zr){if(!ii(Ar))throw new TypeError;return Kr(zr)||(zr=sa(zr)),yt(nt,Bt,Ar,zr)}Pe("defineMetadata",ne);function gr(nt,Bt,Ar){if(!ii(Bt))throw new TypeError;return Kr(Ar)||(Ar=sa(Ar)),U(nt,Bt,Ar)}Pe("hasMetadata",gr);function It(nt,Bt,Ar){if(!ii(Bt))throw new TypeError;return Kr(Ar)||(Ar=sa(Ar)),de(nt,Bt,Ar)}Pe("hasOwnMetadata",It);function xt(nt,Bt,Ar){if(!ii(Bt))throw new TypeError;return Kr(Ar)||(Ar=sa(Ar)),Xe(nt,Bt,Ar)}Pe("getMetadata",xt);function Jt(nt,Bt,Ar){if(!ii(Bt))throw new TypeError;return Kr(Ar)||(Ar=sa(Ar)),lt(nt,Bt,Ar)}Pe("getOwnMetadata",Jt);function Ct(nt,Bt){if(!ii(nt))throw new TypeError;return Kr(Bt)||(Bt=sa(Bt)),Vt(nt,Bt)}Pe("getMetadataKeys",Ct);function br(nt,Bt){if(!ii(nt))throw new TypeError;return Kr(Bt)||(Bt=sa(Bt)),pr(nt,Bt)}Pe("getOwnMetadataKeys",br);function $r(nt,Bt,Ar){if(!ii(Bt))throw new TypeError;Kr(Ar)||(Ar=sa(Ar));var zr=H(Bt,Ar,!1);if(Kr(zr)||!zr.delete(nt))return!1;if(zr.size>0)return!0;var un=Dt.get(Bt);return un.delete(Ar),un.size>0||Dt.delete(Bt),!0}Pe("deleteMetadata",$r);function oe(nt,Bt){for(var Ar=nt.length-1;Ar>=0;--Ar){var zr=nt[Ar],un=zr(Bt);if(!Kr(un)&&!si(un)){if(!bi(un))throw new TypeError;Bt=un}}return Bt}function Ue(nt,Bt,Ar,zr){for(var un=nt.length-1;un>=0;--un){var vn=nt[un],ui=vn(Bt,Ar,zr);if(!Kr(ui)&&!si(ui)){if(!ii(ui))throw new TypeError;zr=ui}}return zr}function H(nt,Bt,Ar){var zr=Dt.get(nt);if(Kr(zr)){if(!Ar)return;zr=new jt,Dt.set(nt,zr)}var un=zr.get(Bt);if(Kr(un)){if(!Ar)return;un=new jt,zr.set(Bt,un)}return un}function U(nt,Bt,Ar){var zr=de(nt,Bt,Ar);if(zr)return!0;var un=Me(Bt);return si(un)?!1:U(nt,un,Ar)}function de(nt,Bt,Ar){var zr=H(Bt,Ar,!1);return Kr(zr)?!1:Pi(zr.has(nt))}function Xe(nt,Bt,Ar){var zr=de(nt,Bt,Ar);if(zr)return lt(nt,Bt,Ar);var un=Me(Bt);if(!si(un))return Xe(nt,un,Ar)}function lt(nt,Bt,Ar){var zr=H(Bt,Ar,!1);if(!Kr(zr))return zr.get(nt)}function yt(nt,Bt,Ar,zr){var un=H(Ar,zr,!0);un.set(nt,Bt)}function Vt(nt,Bt){var Ar=pr(nt,Bt),zr=Me(nt);if(zr===null)return Ar;var un=Vt(zr,Bt);if(un.length<=0)return Ar;if(Ar.length<=0)return un;for(var vn=new hr,ui=[],Jn=0,mn=Ar;Jn<mn.length;Jn++){var Ri=mn[Jn],Si=vn.has(Ri);Si||(vn.add(Ri),ui.push(Ri))}for(var Wa=0,uo=un;Wa<uo.length;Wa++){var Ri=uo[Wa],Si=vn.has(Ri);Si||(vn.add(Ri),ui.push(Ri))}return ui}function pr(nt,Bt){var Ar=[],zr=H(nt,Bt,!1);if(Kr(zr))return Ar;for(var un=zr.keys(),vn=eo(un),ui=0;;){var Jn=be(vn);if(!Jn)return Ar.length=ui,Ar;var mn=Rt(Jn);try{Ar[ui]=mn}catch(Ri){try{ce(vn)}finally{throw Ri}}ui++}}function tn(nt){if(nt===null)return 1;switch(typeof nt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return nt===null?1:6;default:return 6}}function Kr(nt){return nt===void 0}function si(nt){return nt===null}function xn(nt){return typeof nt=="symbol"}function ii(nt){return typeof nt=="object"?nt!==null:typeof nt=="function"}function Ra(nt,Bt){switch(tn(nt)){case 0:return nt;case 1:return nt;case 2:return nt;case 3:return nt;case 4:return nt;case 5:return nt}var Ar=Bt===3?"string":Bt===5?"number":"default",zr=Ha(nt,ve);if(zr!==void 0){var un=zr.call(nt,Ar);if(ii(un))throw new TypeError;return un}return Di(nt,Ar==="default"?"number":Ar)}function Di(nt,Bt){if(Bt==="string"){var Ar=nt.toString;if(Yn(Ar)){var zr=Ar.call(nt);if(!ii(zr))return zr}var un=nt.valueOf;if(Yn(un)){var zr=un.call(nt);if(!ii(zr))return zr}}else{var un=nt.valueOf;if(Yn(un)){var zr=un.call(nt);if(!ii(zr))return zr}var vn=nt.toString;if(Yn(vn)){var zr=vn.call(nt);if(!ii(zr))return zr}}throw new TypeError}function Pi(nt){return!!nt}function ua(nt){return""+nt}function sa(nt){var Bt=Ra(nt,3);return xn(Bt)?Bt:ua(Bt)}function Bi(nt){return Array.isArray?Array.isArray(nt):nt instanceof Object?nt instanceof Array:Object.prototype.toString.call(nt)==="[object Array]"}function Yn(nt){return typeof nt=="function"}function bi(nt){return typeof nt=="function"}function Ms(nt){switch(tn(nt)){case 3:return!0;case 4:return!0;default:return!1}}function Ha(nt,Bt){var Ar=nt[Bt];if(Ar!=null){if(!Yn(Ar))throw new TypeError;return Ar}}function eo(nt){var Bt=Ha(nt,tt);if(!Yn(Bt))throw new TypeError;var Ar=Bt.call(nt);if(!ii(Ar))throw new TypeError;return Ar}function Rt(nt){return nt.value}function be(nt){var Bt=nt.next();return Bt.done?!1:Bt}function ce(nt){var Bt=nt.return;Bt&&Bt.call(nt)}function Me(nt){var Bt=Object.getPrototypeOf(nt);if(typeof nt!="function"||nt===Ft||Bt!==Ft)return Bt;var Ar=nt.prototype,zr=Ar&&Object.getPrototypeOf(Ar);if(zr==null||zr===Object.prototype)return Bt;var un=zr.constructor;return typeof un!="function"||un===nt?Bt:un}function j(){var nt={},Bt=[],Ar=function(){function ui(Jn,mn,Ri){this._index=0,this._keys=Jn,this._values=mn,this._selector=Ri}return ui.prototype["@@iterator"]=function(){return this},ui.prototype[tt]=function(){return this},ui.prototype.next=function(){var Jn=this._index;if(Jn>=0&&Jn<this._keys.length){var mn=this._selector(this._keys[Jn],this._values[Jn]);return Jn+1>=this._keys.length?(this._index=-1,this._keys=Bt,this._values=Bt):this._index++,{value:mn,done:!1}}return{value:void 0,done:!0}},ui.prototype.throw=function(Jn){throw this._index>=0&&(this._index=-1,this._keys=Bt,this._values=Bt),Jn},ui.prototype.return=function(Jn){return this._index>=0&&(this._index=-1,this._keys=Bt,this._values=Bt),{value:Jn,done:!0}},ui}();return function(){function ui(){this._keys=[],this._values=[],this._cacheKey=nt,this._cacheIndex=-2}return Object.defineProperty(ui.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ui.prototype.has=function(Jn){return this._find(Jn,!1)>=0},ui.prototype.get=function(Jn){var mn=this._find(Jn,!1);return mn>=0?this._values[mn]:void 0},ui.prototype.set=function(Jn,mn){var Ri=this._find(Jn,!0);return this._values[Ri]=mn,this},ui.prototype.delete=function(Jn){var mn=this._find(Jn,!1);if(mn>=0){for(var Ri=this._keys.length,Si=mn+1;Si<Ri;Si++)this._keys[Si-1]=this._keys[Si],this._values[Si-1]=this._values[Si];return this._keys.length--,this._values.length--,Jn===this._cacheKey&&(this._cacheKey=nt,this._cacheIndex=-2),!0}return!1},ui.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=nt,this._cacheIndex=-2},ui.prototype.keys=function(){return new Ar(this._keys,this._values,zr)},ui.prototype.values=function(){return new Ar(this._keys,this._values,un)},ui.prototype.entries=function(){return new Ar(this._keys,this._values,vn)},ui.prototype["@@iterator"]=function(){return this.entries()},ui.prototype[tt]=function(){return this.entries()},ui.prototype._find=function(Jn,mn){return this._cacheKey!==Jn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Jn)),this._cacheIndex<0&&mn&&(this._cacheIndex=this._keys.length,this._keys.push(Jn),this._values.push(void 0)),this._cacheIndex},ui}();function zr(ui,Jn){return ui}function un(ui,Jn){return Jn}function vn(ui,Jn){return[ui,Jn]}}function ut(){return function(){function nt(){this._map=new jt}return Object.defineProperty(nt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),nt.prototype.has=function(Bt){return this._map.has(Bt)},nt.prototype.add=function(Bt){return this._map.set(Bt,Bt),this},nt.prototype.delete=function(Bt){return this._map.delete(Bt)},nt.prototype.clear=function(){this._map.clear()},nt.prototype.keys=function(){return this._map.keys()},nt.prototype.values=function(){return this._map.values()},nt.prototype.entries=function(){return this._map.entries()},nt.prototype["@@iterator"]=function(){return this.keys()},nt.prototype[tt]=function(){return this.keys()},nt}()}function ir(){var nt=16,Bt=Mt.create(),Ar=zr();return function(){function mn(){this._key=zr()}return mn.prototype.has=function(Ri){var Si=un(Ri,!1);return Si!==void 0?Mt.has(Si,this._key):!1},mn.prototype.get=function(Ri){var Si=un(Ri,!1);return Si!==void 0?Mt.get(Si,this._key):void 0},mn.prototype.set=function(Ri,Si){var Wa=un(Ri,!0);return Wa[this._key]=Si,this},mn.prototype.delete=function(Ri){var Si=un(Ri,!1);return Si!==void 0?delete Si[this._key]:!1},mn.prototype.clear=function(){this._key=zr()},mn}();function zr(){var mn;do mn="@@WeakMap@@"+Jn();while(Mt.has(Bt,mn));return Bt[mn]=!0,mn}function un(mn,Ri){if(!K.call(mn,Ar)){if(!Ri)return;Object.defineProperty(mn,Ar,{value:Mt.create()})}return mn[Ar]}function vn(mn,Ri){for(var Si=0;Si<Ri;++Si)mn[Si]=Math.random()*255|0;return mn}function ui(mn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(mn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(mn)):vn(new Uint8Array(mn),mn):vn(new Array(mn),mn)}function Jn(){var mn=ui(nt);mn[6]=mn[6]&79|64,mn[8]=mn[8]&191|128;for(var Ri="",Si=0;Si<nt;++Si){var Wa=mn[Si];(Si===4||Si===6||Si===8)&&(Ri+="-"),Wa<16&&(Ri+="0"),Ri+=Wa.toString(16).toLowerCase()}return Ri}}function Jr(nt){return nt.__=void 0,delete nt.__,nt}})})(Z||(Z={}))},69848:function(Yr){(function(ge,ie){Yr.exports=ie()})(this,function(){"use strict";function ge(It,xt,Jt,Ct,br,$r){if(!(br-Ct<=Jt)){var oe=Ct+br>>1;ie(It,xt,oe,Ct,br,$r%2),ge(It,xt,Jt,Ct,oe-1,$r+1),ge(It,xt,Jt,oe+1,br,$r+1)}}function ie(It,xt,Jt,Ct,br,$r){for(;br>Ct;){if(br-Ct>600){var oe=br-Ct+1,Ue=Jt-Ct+1,H=Math.log(oe),U=.5*Math.exp(2*H/3),de=.5*Math.sqrt(H*U*(oe-U)/oe)*(Ue-oe/2<0?-1:1),Xe=Math.max(Ct,Math.floor(Jt-Ue*U/oe+de)),lt=Math.min(br,Math.floor(Jt+(oe-Ue)*U/oe+de));ie(It,xt,Jt,Xe,lt,$r)}var yt=xt[2*Jt+$r],Vt=Ct,pr=br;for(Oe(It,xt,Ct,Jt),xt[2*br+$r]>yt&&Oe(It,xt,Ct,br);Vt<pr;){for(Oe(It,xt,Vt,pr),Vt++,pr--;xt[2*Vt+$r]<yt;)Vt++;for(;xt[2*pr+$r]>yt;)pr--}xt[2*Ct+$r]===yt?Oe(It,xt,Ct,pr):(pr++,Oe(It,xt,pr,br)),pr<=Jt&&(Ct=pr+1),Jt<=pr&&(br=pr-1)}}function Oe(It,xt,Jt,Ct){Z(It,Jt,Ct),Z(xt,2*Jt,2*Ct),Z(xt,2*Jt+1,2*Ct+1)}function Z(It,xt,Jt){var Ct=It[xt];It[xt]=It[Jt],It[Jt]=Ct}function _(It,xt,Jt,Ct,br,$r,oe){for(var Ue=[0,It.length-1,0],H=[],U,de;Ue.length;){var Xe=Ue.pop(),lt=Ue.pop(),yt=Ue.pop();if(lt-yt<=oe){for(var Vt=yt;Vt<=lt;Vt++)U=xt[2*Vt],de=xt[2*Vt+1],U>=Jt&&U<=br&&de>=Ct&&de<=$r&&H.push(It[Vt]);continue}var pr=Math.floor((yt+lt)/2);U=xt[2*pr],de=xt[2*pr+1],U>=Jt&&U<=br&&de>=Ct&&de<=$r&&H.push(It[pr]);var tn=(Xe+1)%2;(Xe===0?Jt<=U:Ct<=de)&&(Ue.push(yt),Ue.push(pr-1),Ue.push(tn)),(Xe===0?br>=U:$r>=de)&&(Ue.push(pr+1),Ue.push(lt),Ue.push(tn))}return H}function Pe(It,xt,Jt,Ct,br,$r){for(var oe=[0,It.length-1,0],Ue=[],H=br*br;oe.length;){var U=oe.pop(),de=oe.pop(),Xe=oe.pop();if(de-Xe<=$r){for(var lt=Xe;lt<=de;lt++)K(xt[2*lt],xt[2*lt+1],Jt,Ct)<=H&&Ue.push(It[lt]);continue}var yt=Math.floor((Xe+de)/2),Vt=xt[2*yt],pr=xt[2*yt+1];K(Vt,pr,Jt,Ct)<=H&&Ue.push(It[yt]);var tn=(U+1)%2;(U===0?Jt-br<=Vt:Ct-br<=pr)&&(oe.push(Xe),oe.push(yt-1),oe.push(tn)),(U===0?Jt+br>=Vt:Ct+br>=pr)&&(oe.push(yt+1),oe.push(de),oe.push(tn))}return Ue}function K(It,xt,Jt,Ct){var br=It-Jt,$r=xt-Ct;return br*br+$r*$r}var xe=function(It){return It[0]},ve=function(It){return It[1]},tt=function(xt,Jt,Ct,br,$r){Jt===void 0&&(Jt=xe),Ct===void 0&&(Ct=ve),br===void 0&&(br=64),$r===void 0&&($r=Float64Array),this.nodeSize=br,this.points=xt;for(var oe=xt.length<65536?Uint16Array:Uint32Array,Ue=this.ids=new oe(xt.length),H=this.coords=new $r(xt.length*2),U=0;U<xt.length;U++)Ue[U]=U,H[2*U]=Jt(xt[U]),H[2*U+1]=Ct(xt[U]);ge(Ue,H,br,0,Ue.length-1,0)};tt.prototype.range=function(xt,Jt,Ct,br){return _(this.ids,this.coords,xt,Jt,Ct,br,this.nodeSize)},tt.prototype.within=function(xt,Jt,Ct){return Pe(this.ids,this.coords,xt,Jt,Ct,this.nodeSize)};var Ae={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(It){return It}},at=Math.fround||function(It){return function(xt){return It[0]=+xt,It[0]}}(new Float32Array(1)),gt=function(xt){this.options=Cr(Object.create(Ae),xt),this.trees=new Array(this.options.maxZoom+1)};gt.prototype.load=function(xt){var Jt=this.options,Ct=Jt.log,br=Jt.minZoom,$r=Jt.maxZoom,oe=Jt.nodeSize;Ct&&console.time("total time");var Ue="prepare "+xt.length+" points";Ct&&console.time(Ue),this.points=xt;for(var H=[],U=0;U<xt.length;U++)!xt[U].geometry||H.push(Ft(xt[U],U));this.trees[$r+1]=new tt(H,ne,gr,oe,Float32Array),Ct&&console.timeEnd(Ue);for(var de=$r;de>=br;de--){var Xe=+Date.now();H=this._cluster(H,de),this.trees[de]=new tt(H,ne,gr,oe,Float32Array),Ct&&console.log("z%d: %d clusters in %dms",de,H.length,+Date.now()-Xe)}return Ct&&console.timeEnd("total time"),this},gt.prototype.getClusters=function(xt,Jt){var Ct=((xt[0]+180)%360+360)%360-180,br=Math.max(-90,Math.min(90,xt[1])),$r=xt[2]===180?180:((xt[2]+180)%360+360)%360-180,oe=Math.max(-90,Math.min(90,xt[3]));if(xt[2]-xt[0]>=360)Ct=-180,$r=180;else if(Ct>$r){var Ue=this.getClusters([Ct,br,180,oe],Jt),H=this.getClusters([-180,br,$r,oe],Jt);return Ue.concat(H)}for(var U=this.trees[this._limitZoom(Jt)],de=U.range(hr(Ct),qt(oe),hr($r),qt(br)),Xe=[],lt=0,yt=de;lt<yt.length;lt+=1){var Vt=yt[lt],pr=U.points[Vt];Xe.push(pr.numPoints?mr(pr):this.points[pr.index])}return Xe},gt.prototype.getChildren=function(xt){var Jt=this._getOriginId(xt),Ct=this._getOriginZoom(xt),br="No cluster with the specified id.",$r=this.trees[Ct];if(!$r)throw new Error(br);var oe=$r.points[Jt];if(!oe)throw new Error(br);for(var Ue=this.options.radius/(this.options.extent*Math.pow(2,Ct-1)),H=$r.within(oe.x,oe.y,Ue),U=[],de=0,Xe=H;de<Xe.length;de+=1){var lt=Xe[de],yt=$r.points[lt];yt.parentId===xt&&U.push(yt.numPoints?mr(yt):this.points[yt.index])}if(U.length===0)throw new Error(br);return U},gt.prototype.getLeaves=function(xt,Jt,Ct){Jt=Jt||10,Ct=Ct||0;var br=[];return this._appendLeaves(br,xt,Jt,Ct,0),br},gt.prototype.getTile=function(xt,Jt,Ct){var br=this.trees[this._limitZoom(xt)],$r=Math.pow(2,xt),oe=this.options,Ue=oe.extent,H=oe.radius,U=H/Ue,de=(Ct-U)/$r,Xe=(Ct+1+U)/$r,lt={features:[]};return this._addTileFeatures(br.range((Jt-U)/$r,de,(Jt+1+U)/$r,Xe),br.points,Jt,Ct,$r,lt),Jt===0&&this._addTileFeatures(br.range(1-U/$r,de,1,Xe),br.points,$r,Ct,$r,lt),Jt===$r-1&&this._addTileFeatures(br.range(0,de,U/$r,Xe),br.points,-1,Ct,$r,lt),lt.features.length?lt:null},gt.prototype.getClusterExpansionZoom=function(xt){for(var Jt=this._getOriginZoom(xt)-1;Jt<=this.options.maxZoom;){var Ct=this.getChildren(xt);if(Jt++,Ct.length!==1)break;xt=Ct[0].properties.cluster_id}return Jt},gt.prototype._appendLeaves=function(xt,Jt,Ct,br,$r){for(var oe=this.getChildren(Jt),Ue=0,H=oe;Ue<H.length;Ue+=1){var U=H[Ue],de=U.properties;if(de&&de.cluster?$r+de.point_count<=br?$r+=de.point_count:$r=this._appendLeaves(xt,de.cluster_id,Ct,br,$r):$r<br?$r++:xt.push(U),xt.length===Ct)break}return $r},gt.prototype._addTileFeatures=function(xt,Jt,Ct,br,$r,oe){for(var Ue=0,H=xt;Ue<H.length;Ue+=1){var U=H[Ue],de=Jt[U],Xe=de.numPoints,lt=void 0,yt=void 0,Vt=void 0;if(Xe)lt=jt(de),yt=de.x,Vt=de.y;else{var pr=this.points[de.index];lt=pr.properties,yt=hr(pr.geometry.coordinates[0]),Vt=qt(pr.geometry.coordinates[1])}var tn={type:1,geometry:[[Math.round(this.options.extent*(yt*$r-Ct)),Math.round(this.options.extent*(Vt*$r-br))]],tags:lt},Kr=void 0;Xe?Kr=de.id:this.options.generateId?Kr=de.index:this.points[de.index].id&&(Kr=this.points[de.index].id),Kr!==void 0&&(tn.id=Kr),oe.features.push(tn)}},gt.prototype._limitZoom=function(xt){return Math.max(this.options.minZoom,Math.min(Math.floor(+xt),this.options.maxZoom+1))},gt.prototype._cluster=function(xt,Jt){for(var Ct=[],br=this.options,$r=br.radius,oe=br.extent,Ue=br.reduce,H=br.minPoints,U=$r/(oe*Math.pow(2,Jt)),de=0;de<xt.length;de++){var Xe=xt[de];if(!(Xe.zoom<=Jt)){Xe.zoom=Jt;for(var lt=this.trees[Jt+1],yt=lt.within(Xe.x,Xe.y,U),Vt=Xe.numPoints||1,pr=Vt,tn=0,Kr=yt;tn<Kr.length;tn+=1){var si=Kr[tn],xn=lt.points[si];xn.zoom>Jt&&(pr+=xn.numPoints||1)}if(pr>Vt&&pr>=H){for(var ii=Xe.x*Vt,Ra=Xe.y*Vt,Di=Ue&&Vt>1?this._map(Xe,!0):null,Pi=(de<<5)+(Jt+1)+this.points.length,ua=0,sa=yt;ua<sa.length;ua+=1){var Bi=sa[ua],Yn=lt.points[Bi];if(!(Yn.zoom<=Jt)){Yn.zoom=Jt;var bi=Yn.numPoints||1;ii+=Yn.x*bi,Ra+=Yn.y*bi,Yn.parentId=Pi,Ue&&(Di||(Di=this._map(Xe,!0)),Ue(Di,this._map(Yn)))}}Xe.parentId=Pi,Ct.push(Mt(ii/pr,Ra/pr,Pi,pr,Di))}else if(Ct.push(Xe),pr>1)for(var Ms=0,Ha=yt;Ms<Ha.length;Ms+=1){var eo=Ha[Ms],Rt=lt.points[eo];Rt.zoom<=Jt||(Rt.zoom=Jt,Ct.push(Rt))}}}return Ct},gt.prototype._getOriginId=function(xt){return xt-this.points.length>>5},gt.prototype._getOriginZoom=function(xt){return(xt-this.points.length)%32},gt.prototype._map=function(xt,Jt){if(xt.numPoints)return Jt?Cr({},xt.properties):xt.properties;var Ct=this.points[xt.index].properties,br=this.options.map(Ct);return Jt&&br===Ct?Cr({},br):br};function Mt(It,xt,Jt,Ct,br){return{x:at(It),y:at(xt),zoom:Infinity,id:Jt,parentId:-1,numPoints:Ct,properties:br}}function Ft(It,xt){var Jt=It.geometry.coordinates,Ct=Jt[0],br=Jt[1];return{x:at(hr(Ct)),y:at(qt(br)),zoom:Infinity,index:xt,parentId:-1}}function mr(It){return{type:"Feature",id:It.id,properties:jt(It),geometry:{type:"Point",coordinates:[Dt(It.x),Pt(It.y)]}}}function jt(It){var xt=It.numPoints,Jt=xt>=1e4?Math.round(xt/1e3)+"k":xt>=1e3?Math.round(xt/100)/10+"k":xt;return Cr(Cr({},It.properties),{cluster:!0,cluster_id:It.id,point_count:xt,point_count_abbreviated:Jt})}function hr(It){return It/360+.5}function qt(It){var xt=Math.sin(It*Math.PI/180),Jt=.5-.25*Math.log((1+xt)/(1-xt))/Math.PI;return Jt<0?0:Jt>1?1:Jt}function Dt(It){return(It-.5)*360}function Pt(It){var xt=(180-It*360)*Math.PI/180;return 360*Math.atan(Math.exp(xt))/Math.PI-90}function Cr(It,xt){for(var Jt in xt)It[Jt]=xt[Jt];return It}function ne(It){return It.x}function gr(It){return It.y}return gt})}}]);
